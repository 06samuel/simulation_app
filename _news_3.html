<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Green Valley Rentals - Aplikasi Monolith SPA</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🏡</text></svg>">
    <style>
        /* === 0. Reset CSS Dasar & Variabel Global === */
        :root {
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            --font-display: 'Poppins', var(--font-sans);
            /* Poppins untuk judul dan elemen display */

            /* Palet Warna Terang (Light Mode) - Green & Amber */
            --color-primary-light-val: 34, 197, 94;
            /* #22c55e (Hijau Lebih Cerah) */
            --color-primary-default-val: 5, 150, 105;
            /* #059669 (Hijau Utama) */
            --color-primary-dark-val: 4, 120, 87;
            /* #047857 (Hijau Lebih Gelap) */

            --color-secondary-light-val: 251, 191, 36;
            /* #fbb_f24 (Kuning Amber Cerah) */
            --color-secondary-default-val: 217, 119, 6;
            /* #d97706 (Kuning Amber Utama) */
            --color-secondary-dark-val: 180, 83, 9;
            /* #b45309 (Kuning Amber Gelap) */

            --color-background-light-val: 248, 250, 252;
            /* #f8fafc (slate-50) - Sangat terang */
            --color-surface-light-val: 255, 255, 255;
            /* #ffffff - Putih untuk card, modal */
            --color-text-light-val: 30, 41, 59;
            /* #1e293b (slate-800) - Teks utama */
            --color-border-light-val: 226, 232, 240;
            /* #e2e8f0 (slate-200) - Border halus */
            --color-muted-light-val: 100, 116, 139;
            /* #64748b (slate-500) - Teks sekunder/placeholder */

            /* Palet Warna Gelap (Dark Mode) - Akan di-override di .dark */
            --color-primary-light: rgb(var(--color-primary-light-val));
            --color-primary-default: rgb(var(--color-primary-default-val));
            --color-primary-dark: rgb(var(--color-primary-dark-val));

            --color-secondary-light: rgb(var(--color-secondary-light-val));
            --color-secondary-default: rgb(var(--color-secondary-default-val));
            --color-secondary-dark: rgb(var(--color-secondary-dark-val));

            --color-background: rgb(var(--color-background-light-val));
            --color-surface: rgb(var(--color-surface-light-val));
            --color-text-default: rgb(var(--color-text-light-val));
            --color-text-muted: rgb(var(--color-muted-light-val));
            --color-border: rgb(var(--color-border-light-val));

            /* Ukuran & Spasi - Menggunakan skala numerik untuk konsistensi */
            --spacing-unit: 0.25rem;
            /* 4px */
            --spacing-1: calc(1 * var(--spacing-unit));
            --spacing-2: calc(2 * var(--spacing-unit));
            --spacing-3: calc(3 * var(--spacing-unit));
            --spacing-4: calc(4 * var(--spacing-unit));
            --spacing-5: calc(5 * var(--spacing-unit));
            --spacing-6: calc(6 * var(--spacing-unit));
            --spacing-8: calc(8 * var(--spacing-unit));
            --spacing-10: calc(10 * var(--spacing-unit));
            --spacing-12: calc(12 * var(--spacing-unit));
            --spacing-16: calc(16 * var(--spacing-unit));

            --border-radius-sm: 0.25rem;
            /* 4px */
            --border-radius-md: 0.375rem;
            /* 6px */
            --border-radius-lg: 0.5rem;
            /* 8px */
            --border-radius-xl: 0.75rem;
            /* 12px */
            --border-radius-2xl: 1rem;
            /* 16px */
            --border-radius-full: 9999px;

            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --shadow-inner: inset 0 2px 4px 0 rgba(0, 0, 0, 0.05);

            --transition-duration-short: 150ms;
            --transition-duration-default: 300ms;
            --transition-duration-long: 500ms;
            --transition-timing-default: cubic-bezier(0.4, 0, 0.2, 1);
            /* Mirip ease-in-out Tailwind */

            /* Untuk Focus Ring Sederhana & Aksesibel */
            --ring-width: 2px;
            --ring-offset-width: 2px;
            --ring-color-default: rgba(var(--color-primary-default-val), 0.5);
            --ring-offset-color: var(--color-background);
            /* Warna background untuk offset */
        }

        .dark {
            --color-background-dark-val: 15, 23, 42;
            /* #0f172a (slate-900) - Background sangat gelap */
            --color-surface-dark-val: 30, 41, 59;
            /* #1e293b (slate-800) - Card, modal gelap */
            --color-text-dark-val: 226, 232, 240;
            /* #e2e8f0 (slate-200) - Teks terang */
            --color-border-dark-val: 51, 65, 85;
            /* #334155 (slate-700) - Border lebih jelas di gelap */
            --color-muted-dark-val: 148, 163, 184;
            /* #94a3b8 (slate-400) - Teks sekunder terang */

            --color-background: rgb(var(--color-background-dark-val));
            --color-surface: rgb(var(--color-surface-dark-val));
            --color-text-default: rgb(var(--color-text-dark-val));
            --color-text-muted: rgb(var(--color-muted-dark-val));
            --color-border: rgb(var(--color-border-dark-val));
            --ring-color-default: rgba(var(--color-primary-light-val), 0.6);
            --ring-offset-color: var(--color-background);
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            border-width: 0;
            /* Reset border width dari browser stylesheet */
            border-style: solid;
            /* Default border style, color diatur oleh variabel */
            border-color: var(--color-border);
            /* Default border color */
        }

        html {
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
            -moz-tab-size: 4;
            tab-size: 4;
            font-family: var(--font-sans);
            scroll-behavior: smooth;
            /* Mencegah FOUC (Flash of Unstyled Content) untuk tema */
            visibility: hidden;
        }

        html.theme-applied {
            visibility: visible;
        }


        body {
            font-family: var(--font-sans);
            background-color: var(--color-background);
            color: var(--color-text-default);
            transition: background-color var(--transition-duration-default) var(--transition-timing-default), color var(--transition-duration-default) var(--transition-timing-default);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            /* Teks lebih halus di Webkit */
            -moz-osx-font-smoothing: grayscale;
            /* Teks lebih halus di Firefox */
        }

        #app-root {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        main {
            flex-grow: 1;
        }

        /* Focus States Aksesibel */
        *:focus-visible {
            outline: var(--ring-width) solid var(--ring-color-default);
            outline-offset: var(--ring-offset-width);
            box-shadow: 0 0 0 var(--ring-offset-width) var(--ring-offset-color);
        }

        /* Khusus untuk elemen yang sudah punya styling focus sendiri (misal tombol) */
        .button-base:focus-visible,
        .form-input:focus-visible,
        .form-select:focus-visible,
        .form-textarea:focus-visible {
            /* Styling focus akan ditangani oleh kelas spesifik mereka */
        }


        /* === 1. Utilitas CSS (Mirip Tailwind, tapi Native) === */
        .hidden {
            display: none !important;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        .flex {
            display: flex;
        }

        .inline-flex {
            display: inline-flex;
        }

        .grid {
            display: grid;
        }

        .items-center {
            align-items: center;
        }

        .items-start {
            align-items: flex-start;
        }

        .items-end {
            align-items: flex-end;
        }

        .justify-center {
            justify-content: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-end {
            justify-content: flex-end;
        }

        .flex-col {
            flex-direction: column;
        }

        .flex-row {
            flex-direction: row;
        }

        .flex-grow {
            flex-grow: 1;
        }

        .flex-shrink-0 {
            flex-shrink: 0;
        }

        .space-x-1> :not([hidden])~ :not([hidden]) {
            margin-left: var(--spacing-1);
        }

        .space-x-2> :not([hidden])~ :not([hidden]) {
            margin-left: var(--spacing-2);
        }

        .space-x-3> :not([hidden])~ :not([hidden]) {
            margin-left: var(--spacing-3);
        }

        .space-x-4> :not([hidden])~ :not([hidden]) {
            margin-left: var(--spacing-4);
        }

        .space-y-1> :not([hidden])~ :not([hidden]) {
            margin-top: var(--spacing-1);
        }

        .space-y-2> :not([hidden])~ :not([hidden]) {
            margin-top: var(--spacing-2);
        }

        .space-y-3> :not([hidden])~ :not([hidden]) {
            margin-top: var(--spacing-3);
        }

        .space-y-4> :not([hidden])~ :not([hidden]) {
            margin-top: var(--spacing-4);
        }

        .space-y-6> :not([hidden])~ :not([hidden]) {
            margin-top: var(--spacing-6);
        }

        .space-y-8> :not([hidden])~ :not([hidden]) {
            margin-top: var(--spacing-8);
        }

        .space-y-12> :not([hidden])~ :not([hidden]) {
            margin-top: var(--spacing-12);
        }

        .gap-1 {
            gap: var(--spacing-1);
        }

        .gap-2 {
            gap: var(--spacing-2);
        }

        .gap-3 {
            gap: var(--spacing-3);
        }

        .gap-4 {
            gap: var(--spacing-4);
        }

        .gap-6 {
            gap: var(--spacing-6);
        }

        .gap-8 {
            gap: var(--spacing-8);
        }

        .p-1 {
            padding: var(--spacing-1);
        }

        .p-2 {
            padding: var(--spacing-2);
        }

        .p-3 {
            padding: var(--spacing-3);
        }

        .p-4 {
            padding: var(--spacing-4);
        }

        .p-6 {
            padding: var(--spacing-6);
        }

        .p-8 {
            padding: var(--spacing-8);
        }

        .py-1 {
            padding-top: var(--spacing-1);
            padding-bottom: var(--spacing-1);
        }

        .py-2 {
            padding-top: var(--spacing-2);
            padding-bottom: var(--spacing-2);
        }

        .py-3 {
            padding-top: var(--spacing-3);
            padding-bottom: var(--spacing-3);
        }

        .py-4 {
            padding-top: var(--spacing-4);
            padding-bottom: var(--spacing-4);
        }

        .py-8 {
            padding-top: var(--spacing-8);
            padding-bottom: var(--spacing-8);
        }

        .py-12 {
            padding-top: var(--spacing-12);
            padding-bottom: var(--spacing-12);
        }

        .py-16 {
            padding-top: var(--spacing-16);
            padding-bottom: var(--spacing-16);
        }

        .px-2 {
            padding-left: var(--spacing-2);
            padding-right: var(--spacing-2);
        }

        .px-3 {
            padding-left: var(--spacing-3);
            padding-right: var(--spacing-3);
        }

        .px-4 {
            padding-left: var(--spacing-4);
            padding-right: var(--spacing-4);
        }

        .px-6 {
            padding-left: var(--spacing-6);
            padding-right: var(--spacing-6);
        }

        .pt-2 {
            padding-top: var(--spacing-2);
        }

        .pt-3 {
            padding-top: var(--spacing-3);
        }

        .pt-4 {
            padding-top: var(--spacing-4);
        }

        .pb-2 {
            padding-bottom: var(--spacing-2);
        }

        .pb-3 {
            padding-bottom: var(--spacing-3);
        }

        .pb-4 {
            padding-bottom: var(--spacing-4);
        }

        .mb-1 {
            margin-bottom: var(--spacing-1);
        }

        .mb-2 {
            margin-bottom: var(--spacing-2);
        }

        .mb-3 {
            margin-bottom: var(--spacing-3);
        }

        .mb-4 {
            margin-bottom: var(--spacing-4);
        }

        .mb-6 {
            margin-bottom: var(--spacing-6);
        }

        .mb-8 {
            margin-bottom: var(--spacing-8);
        }

        .mt-1 {
            margin-top: var(--spacing-1);
        }

        .mt-2 {
            margin-top: var(--spacing-2);
        }

        .mt-4 {
            margin-top: var(--spacing-4);
        }

        .mt-auto {
            margin-top: auto;
        }

        .mr-1 {
            margin-right: var(--spacing-1);
        }

        .mr-1_5 {
            margin-right: calc(var(--spacing-1) * 1.5);
        }

        /* 6px */
        .mr-2 {
            margin-right: var(--spacing-2);
        }

        .mr-3 {
            margin-right: var(--spacing-3);
        }

        .ml-1 {
            margin-left: var(--spacing-1);
        }

        .ml-2 {
            margin-left: var(--spacing-2);
        }

        .ml-auto {
            margin-left: auto;
        }

        .mx-auto {
            margin-left: auto;
            margin-right: auto;
        }

        .text-xs {
            font-size: 0.75rem;
            line-height: 1rem;
        }

        /* 12px */
        .text-sm {
            font-size: 0.875rem;
            line-height: 1.25rem;
        }

        /* 14px */
        .text-base {
            font-size: 1rem;
            line-height: 1.5rem;
        }

        /* 16px */
        .text-lg {
            font-size: 1.125rem;
            line-height: 1.75rem;
        }

        /* 18px */
        .text-xl {
            font-size: 1.25rem;
            line-height: 1.75rem;
        }

        /* 20px */
        .text-2xl {
            font-size: 1.5rem;
            line-height: 2rem;
        }

        /* 24px */
        .text-3xl {
            font-size: 1.875rem;
            line-height: 2.25rem;
        }

        /* 30px */
        .text-4xl {
            font-size: 2.25rem;
            line-height: 2.5rem;
        }

        /* 36px */
        .text-5xl {
            font-size: 3rem;
            line-height: 1;
        }

        /* 48px */
        .text-6xl {
            font-size: 3.75rem;
            line-height: 1;
        }

        /* 60px */

        .font-normal {
            font-weight: 400;
        }

        .font-medium {
            font-weight: 500;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-bold {
            font-weight: 700;
        }

        .font-extrabold {
            font-weight: 800;
        }

        .font-black {
            font-weight: 900;
        }

        .font-display {
            font-family: var(--font-display);
        }

        .uppercase {
            text-transform: uppercase;
        }

        .tracking-wider {
            letter-spacing: 0.05em;
        }

        .text-center {
            text-align: center;
        }

        .truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
        }

        .line-clamp-3 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 3;
        }

        .text-white {
            color: #fff !important;
        }

        /* Untuk override di konteks spesifik */
        .text-primary {
            color: var(--color-primary-default);
        }

        .dark .text-primary-light {
            color: var(--color-primary-light);
        }

        .text-secondary {
            color: var(--color-secondary-default);
        }

        .dark .text-secondary-light {
            color: var(--color-secondary-light);
        }

        .text-slate-300 {
            color: #cbd5e1;
        }

        .text-slate-400 {
            color: #94a3b8;
        }

        .text-slate-500 {
            color: rgb(var(--color-muted-light-val));
        }

        .dark .text-slate-500 {
            color: rgb(var(--color-muted-dark-val));
        }

        .text-slate-600 {
            color: #475569;
        }

        .dark .text-slate-600 {
            color: #64748b;
        }

        .text-yellow-400 {
            color: #facc15;
        }

        .text-red-500 {
            color: #ef4444;
        }

        .text-text-default {
            color: var(--color-text-default);
        }

        .text-text-muted {
            color: var(--color-text-muted);
        }

        .bg-transparent {
            background-color: transparent;
        }

        .bg-primary {
            background-color: var(--color-primary-default);
        }

        .dark .bg-primary-light {
            background-color: var(--color-primary-light);
        }

        .bg-primary-dark {
            background-color: var(--color-primary-dark);
        }

        .bg-primary-opacity-10 {
            background-color: rgba(var(--color-primary-default-val), 0.1);
        }

        .dark .bg-primary-opacity-5 {
            background-color: rgba(var(--color-primary-default-val), 0.05);
        }

        .dark .bg-primary-opacity-20 {
            background-color: rgba(var(--color-primary-default-val), 0.2);
        }

        .bg-secondary {
            background-color: var(--color-secondary-default);
        }

        .bg-secondary-opacity-10 {
            background-color: rgba(var(--color-secondary-default-val), 0.1);
        }

        .dark .bg-secondary-opacity-5 {
            background-color: rgba(var(--color-secondary-default-val), 0.05);
        }

        .dark .bg-secondary-opacity-20 {
            background-color: rgba(var(--color-secondary-default-val), 0.2);
        }

        .bg-surface {
            background-color: var(--color-surface);
        }

        .bg-background {
            background-color: var(--color-background);
        }

        .bg-slate-50 {
            background-color: #f8fafc;
        }

        .dark .bg-slate-50 {
            background-color: var(--color-surface);
        }

        .dark .bg-slate-700-opacity-50 {
            background-color: rgba(51, 65, 85, 0.5);
        }

        .bg-black-opacity-50 {
            background-color: rgba(0, 0, 0, 0.5);
        }

        .bg-green-500 {
            background-color: #22c55e;
        }

        .bg-yellow-500 {
            background-color: #eab308;
        }

        .bg-blue-500 {
            background-color: #3b82f6;
        }

        .bg-red-500 {
            background-color: #ef4444;
        }

        .hover-bg-primary-dark:hover:not(:disabled) {
            background-color: var(--color-primary-dark);
        }

        .hover-bg-secondary-dark:hover:not(:disabled) {
            background-color: var(--color-secondary-dark);
        }

        .hover-bg-primary-opacity-10:hover:not(:disabled) {
            background-color: rgba(var(--color-primary-default-val), 0.1);
        }

        .dark .hover-bg-primary-opacity-10:hover:not(:disabled) {
            background-color: rgba(var(--color-primary-light-val), 0.15);
        }

        .hover-bg-slate-100:hover:not(:disabled) {
            background-color: #f1f5f9;
        }

        .dark .hover-bg-slate-700:hover:not(:disabled) {
            background-color: #334155;
        }

        .hover-bg-red-600:hover:not(:disabled) {
            background-color: #dc2626;
        }

        .hover-opacity-80:hover {
            opacity: 0.8;
        }

        .border {
            border-width: 1px;
        }

        .border-t {
            border-top-width: 1px;
        }

        .border-b {
            border-bottom-width: 1px;
        }

        .border-l-4 {
            border-left-width: 4px;
        }

        .border-blue-500 {
            border-color: #3b82f6 !important;
        }

        .border-green-500 {
            border-color: #22c55e !important;
        }

        .border-yellow-500 {
            border-color: #eab308 !important;
        }

        .border-red-500 {
            border-color: #ef4444 !important;
        }

        .rounded-sm {
            border-radius: var(--border-radius-sm);
        }

        .rounded-md {
            border-radius: var(--border-radius-md);
        }

        .rounded-lg {
            border-radius: var(--border-radius-lg);
        }

        .rounded-xl {
            border-radius: var(--border-radius-xl);
        }

        .rounded-2xl {
            border-radius: var(--border-radius-2xl);
        }

        .rounded-full {
            border-radius: var(--border-radius-full);
        }

        .rounded-t-lg {
            border-top-left-radius: var(--border-radius-lg);
            border-top-right-radius: var(--border-radius-lg);
        }

        .rounded-r-md {
            border-top-right-radius: var(--border-radius-md);
            border-bottom-right-radius: var(--border-radius-md);
        }

        .rounded-t {
            border-top-left-radius: var(--border-radius-md);
            border-top-right-radius: var(--border-radius-md);
        }

        .w-full {
            width: 100%;
        }

        .w-2 {
            width: var(--spacing-2);
        }

        .h-2 {
            height: var(--spacing-2);
        }

        .w-2_5 {
            width: 0.625rem;
        }

        .h-2_5 {
            height: 0.625rem;
        }

        /* 10px */
        .w-4 {
            width: var(--spacing-4);
        }

        .h-4 {
            height: var(--spacing-4);
        }

        .w-5 {
            width: 1.25rem;
        }

        .h-5 {
            height: 1.25rem;
        }

        /* 20px */
        .w-6 {
            width: var(--spacing-6);
        }

        .h-6 {
            height: var(--spacing-6);
        }

        .w-8 {
            width: var(--spacing-8);
        }

        .h-8 {
            height: var(--spacing-8);
        }

        .w-10 {
            width: var(--spacing-10);
        }

        .h-10 {
            height: var(--spacing-10);
        }

        /* 40px */
        .w-12 {
            width: var(--spacing-12);
        }

        .h-12 {
            height: var(--spacing-12);
        }

        .h-16 {
            height: var(--spacing-16);
        }

        /* 64px */
        .h-40 {
            height: 10rem;
        }

        /* 160px */
        .h-48 {
            height: 12rem;
        }

        /* 192px */
        .h-64 {
            height: 16rem;
        }

        /* 256px */
        .min-w-max {
            min-width: max-content;
        }

        .min-w-0 {
            min-width: 0;
        }

        .shadow-sm {
            box-shadow: var(--shadow-sm);
        }

        .shadow-md {
            box-shadow: var(--shadow-md);
        }

        .shadow-lg {
            box-shadow: var(--shadow-lg);
        }

        .shadow-xl {
            box-shadow: var(--shadow-xl);
        }

        .shadow-2xl {
            box-shadow: var(--shadow-2xl);
        }

        .shadow-inner {
            box-shadow: var(--shadow-inner);
        }

        .opacity-70 {
            opacity: 0.7;
        }

        .opacity-75 {
            opacity: 0.75;
        }

        .opacity-90 {
            opacity: 0.9;
        }

        .overflow-hidden {
            overflow: hidden;
        }

        .overflow-x-auto {
            overflow-x: auto;
        }

        .object-cover {
            object-fit: cover;
        }

        .cursor-pointer {
            cursor: pointer;
        }

        .cursor-not-allowed {
            cursor: not-allowed;
        }

        .backdrop-blur-sm {
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
        }

        .backdrop-blur-md {
            -webkit-backdrop-filter: blur(12px);
            backdrop-filter: blur(12px);
        }

        .transition-all {
            transition-property: all;
            transition-duration: var(--transition-duration-default);
            transition-timing-function: var(--transition-timing-default);
        }

        .transition-colors {
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, box-shadow;
            transition-duration: var(--transition-duration-default);
            transition-timing-function: var(--transition-timing-default);
        }

        .transition-shadow {
            transition-property: box-shadow;
            transition-duration: var(--transition-duration-default);
            transition-timing-function: var(--transition-timing-default);
        }

        .transition-transform {
            transition-property: transform;
            transition-duration: var(--transition-duration-default);
            transition-timing-function: var(--transition-timing-default);
        }

        .transition-opacity {
            transition-property: opacity;
            transition-duration: var(--transition-duration-default);
            transition-timing-function: var(--transition-timing-default);
        }

        .duration-200 {
            transition-duration: 200ms;
        }

        .duration-300 {
            transition-duration: 300ms;
        }

        .duration-500 {
            transition-duration: 500ms;
        }

        .ease-in-out {
            transition-timing-function: var(--transition-timing-default);
        }

        .ease-out {
            transition-timing-function: cubic-bezier(0, 0, 0.2, 1);
        }

        .transform {}

        /* Diperlukan untuk beberapa properti transform */
        .hover-scale-105:hover:not(:disabled) {
            transform: scale(1.05);
        }

        .hover-scale-110:hover:not(:disabled) {
            transform: scale(1.10);
        }

        .active-scale-95:active:not(:disabled) {
            transform: scale(0.95);
        }

        .sticky {
            position: sticky;
        }

        .fixed {
            position: fixed;
        }

        .absolute {
            position: absolute;
        }

        .relative {
            position: relative;
        }

        .top-0 {
            top: 0;
        }

        .top-2 {
            top: var(--spacing-2);
        }

        .right-0 {
            right: 0;
        }

        .right-2 {
            right: var(--spacing-2);
        }

        .inset-0 {
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }

        .z-10 {
            z-index: 10;
        }

        .z-20 {
            z-index: 20;
        }

        .z-30 {
            z-index: 30;
        }

        .z-40 {
            z-index: 40;
        }

        .z-50 {
            z-index: 50;
        }

        .group:hover .group-hover-font-semibold {
            font-weight: 600;
        }

        .container {
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            padding-left: var(--spacing-4);
            padding-right: var(--spacing-4);
        }

        @media (min-width: 640px) {

            /* sm */
            .container {
                max-width: 640px;
                padding-left: var(--spacing-6);
                padding-right: var(--spacing-6);
            }

            .sm-grid-cols-2 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .sm-inline {
                display: inline !important;
            }

            .sm-text-5xl {
                font-size: 3rem;
                line-height: 1;
            }

            .sm-space-x-2> :not([hidden])~ :not([hidden]) {
                margin-left: var(--spacing-2);
            }

            .sm-px-3 {
                padding-left: var(--spacing-3);
                padding-right: var(--spacing-3);
            }

            .sm-mr-1_5 {
                margin-right: calc(var(--spacing-1) * 1.5);
            }

            .sm-flex-row {
                flex-direction: row;
            }

            .sm-items-center {
                align-items: center;
            }

            .sm-mb-0 {
                margin-bottom: 0;
            }

            .sm-self-center {
                align-self: center;
            }
        }

        @media (min-width: 768px) {

            /* md */
            .container {
                max-width: 768px;
            }

            .md-grid-cols-2 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .md-grid-cols-3 {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
        }

        @media (min-width: 1024px) {

            /* lg */
            .container {
                max-width: 1024px;
                padding-left: var(--spacing-8);
                padding-right: var(--spacing-8);
            }

            .lg-grid-cols-3 {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }

            .lg-py-20 {
                padding-top: var(--spacing-16);
                padding-bottom: var(--spacing-16);
            }

            /* 5rem */
        }

        @media (min-width: 1280px) {

            /* xl */
            .container {
                max-width: 1280px;
            }
        }

        /* === 2. Animasi & Spinner === */
        @keyframes fadeIn {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        .animate-fade-in {
            animation: fadeIn var(--transition-duration-long) var(--transition-timing-default) forwards;
        }

        @keyframes slideUp {
            0% {
                transform: translateY(20px);
                opacity: 0;
            }

            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .animate-slide-up {
            animation: slideUp var(--transition-duration-long) var(--transition-timing-default) forwards;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        @keyframes bounce-slow {

            0%,
            100% {
                transform: translateY(-5%);
                animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
            }

            50% {
                transform: none;
                animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
            }
        }

        .animate-bounce-slow {
            animation: bounce-slow 1.5s infinite;
        }

        .spinner-ring {
            display: inline-block;
            border-radius: 50%;
            border-style: solid;
            border-top-color: transparent !important;
        }

        .spinner-sm {
            width: var(--spacing-4);
            height: var(--spacing-4);
            border-width: 2px;
        }

        .spinner-md {
            width: var(--spacing-6);
            height: var(--spacing-6);
            border-width: 3px;
        }

        /* Ukuran spinner medium disesuaikan */
        .spinner-lg {
            width: var(--spacing-8);
            height: var(--spacing-8);
            border-width: 4px;
        }


        /* === 3. Komponen Spesifik === */
        /* Tombol */
        .button-base {
            font-weight: var(--font-semibold);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            transition: all var(--transition-duration-short) var(--transition-timing-default);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            text-decoration: none;
            border-width: 1px;
            /* Batas tipis untuk semua tombol */
            border-color: transparent;
            /* Default, akan di-override oleh varian */
            outline: none;
            -webkit-tap-highlight-color: transparent;
            /* Hilangkan highlight biru di mobile */
        }

        .button-base:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .button-base:active:not(:disabled) {
            transform: translateY(0px);
            box-shadow: var(--shadow-sm);
        }

        .button-base:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: var(--shadow-sm);
        }

        .button-base:focus-visible {
            outline: none;
            box-shadow: 0 0 0 var(--ring-offset-width) var(--ring-offset-color),
                0 0 0 calc(var(--ring-offset-width) + var(--ring-width)) var(--_focus-ring-color, var(--ring-color-default));
        }

        .button-sz-sm {
            padding: var(--spacing-1) var(--spacing-3);
            font-size: var(--text-sm);
        }

        .button-sz-md {
            padding: var(--spacing-2) var(--spacing-4);
            font-size: var(--text-base);
        }

        .button-sz-lg {
            padding: var(--spacing-3) var(--spacing-6);
            font-size: var(--text-lg);
        }

        .button-primary {
            background-color: var(--color-primary-default);
            color: white;
            border-color: var(--color-primary-dark);
            --_focus-ring-color: var(--color-primary-default);
        }

        .button-primary:hover:not(:disabled) {
            background-color: var(--color-primary-dark);
        }

        .button-secondary {
            background-color: var(--color-secondary-default);
            color: white;
            border-color: var(--color-secondary-dark);
            --_focus-ring-color: var(--color-secondary-default);
        }

        .button-secondary:hover:not(:disabled) {
            background-color: var(--color-secondary-dark);
        }

        .button-ghost {
            background-color: transparent;
            color: var(--color-primary-default);
            box-shadow: none !important;
            /* Ghost button tidak punya shadow default */
            border-color: transparent;
            --_focus-ring-color: var(--color-primary-default);
        }

        .button-ghost:hover:not(:disabled) {
            background-color: rgba(var(--color-primary-default-val), 0.1);
            transform: none;
            /* Ghost button tidak perlu efek Y transform */
        }

        .dark .button-ghost {
            color: var(--color-primary-light);
        }

        .dark .button-ghost:hover:not(:disabled) {
            background-color: rgba(var(--color-primary-light-val), 0.15);
        }

        .button-danger {
            background-color: #ef4444;
            /* Red-500 */
            color: white;
            border-color: #dc2626;
            /* Red-600 */
            --_focus-ring-color: #ef4444;
        }

        .button-danger:hover:not(:disabled) {
            background-color: #dc2626;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(15, 23, 42, 0.7);
            /* slate-900 dengan opacity */
            -webkit-backdrop-filter: blur(8px);
            /* Backdrop blur lebih kuat */
            backdrop-filter: blur(8px);
            padding: var(--spacing-4);
            opacity: 0;
            /* Awalnya transparan untuk animasi */
            transition: opacity var(--transition-duration-default) var(--transition-timing-default);
        }

        .modal-overlay.open {
            opacity: 1;
        }

        .modal-content {
            background-color: var(--color-surface);
            border-radius: var(--border-radius-2xl);
            /* Lebih bulat */
            box-shadow: var(--shadow-2xl);
            padding: var(--spacing-6);
            width: 100%;
            max-height: calc(100vh - (2 * var(--spacing-4)));
            overflow-y: auto;
            transform: scale(0.95);
            /* Awalnya kecil untuk animasi */
            opacity: 0;
            transition: transform var(--transition-duration-default) var(--transition-timing-default),
                opacity var(--transition-duration-default) var(--transition-timing-default);
        }

        .modal-overlay.open .modal-content {
            transform: scale(1);
            opacity: 1;
        }

        .modal-content.size-sm {
            max-width: 28rem;
        }

        /* 448px */
        .modal-content.size-md {
            max-width: 36rem;
        }

        /* 576px */
        .modal-content.size-lg {
            max-width: 48rem;
        }

        /* 768px */
        .modal-content.size-xl {
            max-width: 60rem;
        }

        /* 960px */

        /* Header & Footer */
        .app-header {
            background-color: rgba(var(--color-surface-light-val), 0.85);
            /* Semi-transparan */
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 40;
            -webkit-backdrop-filter: blur(12px);
            backdrop-filter: blur(12px);
            transition: background-color var(--transition-duration-default) var(--transition-timing-default);
            border-bottom-width: 1px;
            /* Garis bawah halus */
        }

        .dark .app-header {
            background-color: rgba(var(--color-surface-dark-val), 0.85);
        }

        .app-footer {
            background-color: var(--color-surface);
            border-top-width: 1px;
            padding: var(--spacing-8) var(--spacing-4);
            text-align: center;
            flex-shrink: 0;
            transition: background-color var(--transition-duration-default) var(--transition-timing-default),
                border-color var(--transition-duration-default) var(--transition-timing-default);
        }

        /* Input Forms */
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: var(--spacing-2) var(--spacing-3);
            border-width: 1px;
            border-radius: var(--border-radius-md);
            background-color: var(--color-surface);
            color: var(--color-text-default);
            transition: border-color var(--transition-duration-short) var(--transition-timing-default),
                box-shadow var(--transition-duration-short) var(--transition-timing-default);
            font-size: var(--text-base);
            outline: none;
            /* Kita pakai box-shadow untuk focus */
        }

        .form-input:focus-visible,
        .form-select:focus-visible,
        .form-textarea:focus-visible {
            border-color: var(--color-primary-default);
            --_focus-ring-color: var(--color-primary-default);
            box-shadow: 0 0 0 var(--ring-offset-width) var(--ring-offset-color),
                0 0 0 calc(var(--ring-offset-width) + var(--ring-width)) var(--_focus-ring-color);
        }

        .dark .form-input:focus-visible,
        .dark .form-select:focus-visible,
        .dark .form-textarea:focus-visible {
            border-color: var(--color-primary-light);
            --_focus-ring-color: var(--color-primary-light);
        }

        .form-label {
            display: block;
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            color: var(--color-text-muted);
            margin-bottom: var(--spacing-1);
        }

        .form-input.is-invalid,
        .form-select.is-invalid,
        .form-textarea.is-invalid {
            border-color: #ef4444 !important;
            /* Red-500 */
        }

        .form-input.is-invalid:focus-visible,
        .form-select.is-invalid:focus-visible,
        .form-textarea.is-invalid:focus-visible {
            --_focus-ring-color: #ef4444;
        }

        .form-error-message {
            display: block;
            color: #ef4444;
            font-size: var(--text-xs);
            margin-top: var(--spacing-1);
        }


        /* Kartu Properti */
        .property-card {
            display: flex;
            flex-direction: column;
            height: 100%;
            /* Agar semua kartu sama tinggi dalam grid */
            background-color: var(--color-surface);
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            transition: box-shadow var(--transition-duration-default) var(--transition-timing-default),
                transform var(--transition-duration-default) var(--transition-timing-default);
        }

        .property-card.clickable:hover {
            box-shadow: var(--shadow-xl);
            transform: translateY(-4px) scale(1.02);
            /* Sedikit zoom dan naik */
        }

        .property-card-image-container {
            position: relative;
            height: var(--h-48);
            width: 100%;
            overflow: hidden;
            /* Penting untuk efek zoom gambar */
        }

        .property-card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-duration-long) var(--transition-timing-default);
        }

        .property-card.clickable:hover .property-card-image {
            transform: scale(1.1);
            /* Efek zoom pada gambar saat hover kartu */
        }

        .property-card-status-badge {
            position: absolute;
            top: var(--spacing-3);
            right: var(--spacing-3);
            padding: var(--spacing-1) var(--spacing-2);
            font-size: var(--text-xs);
            font-weight: var(--font-semibold);
            border-radius: var(--border-radius-md);
            color: white;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.3);
            /* Shadow lebih jelas */
            z-index: 1;
            /* Di atas gambar */
        }

        .property-card-status-badge.available {
            background-color: var(--color-primary-default);
        }

        .property-card-status-badge.rented {
            background-color: var(--color-secondary-default);
        }

        .property-card-content {
            padding: var(--spacing-4);
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            /* Agar konten mengisi sisa ruang */
        }

        .property-card-description {
            flex-grow: 1;
            /* Biarkan deskripsi mengisi ruang sebelum tombol */
        }

        /* Notifikasi Item */
        .notification-item {
            display: flex;
            align-items: flex-start;
            padding: var(--spacing-3);
            /* Padding dikurangi sedikit */
            border-left-width: 4px;
            border-style: solid;
            border-radius: 0 var(--border-radius-lg) var(--border-radius-lg) 0;
            /* rounded-r-lg */
            box-shadow: var(--shadow-sm);
            transition: background-color var(--transition-duration-short) var(--transition-timing-default),
                transform var(--transition-duration-short) var(--transition-timing-default);
            background-color: var(--color-surface);
        }

        .notification-item:hover {
            background-color: rgba(var(--color-primary-default-val), 0.05);
            transform: translateX(2px);
            /* Efek geser halus saat hover */
        }

        .dark .notification-item:hover {
            background-color: rgba(var(--color-primary-light-val), 0.08);
        }

        .notification-item.read {
            opacity: 0.7;
        }

        .notification-icon-wrapper {
            margin-right: var(--spacing-3);
            padding: var(--spacing-2);
            border-radius: var(--border-radius-full);
            color: white;
            flex-shrink: 0;
            display: flex;
            /* Untuk ikon di tengah */
            align-items: center;
            justify-content: center;
            width: var(--w-10);
            /* Ukuran tetap */
            height: var(--h-10);
        }

        .notification-content {
            flex: 1 1 0%;
            min-width: 0;
        }

        .notification-unread-dot {
            margin-left: var(--spacing-3);
            /* Jarak dari konten */
            width: var(--w-2_5);
            height: var(--h-2_5);
            background-color: var(--color-primary-default);
            border-radius: var(--border-radius-full);
            align-self: center;
            flex-shrink: 0;
            box-shadow: 0 0 5px 1px var(--color-primary-default);
            /* Efek glow halus */
        }

        .dark .notification-unread-dot {
            background-color: var(--color-primary-light);
            box-shadow: 0 0 5px 1px var(--color-primary-light);
        }

        /* Chart Sederhana */
        .simple-chart-bar-container {
            padding: var(--spacing-4);
            background-color: rgba(var(--color-muted-light-val), 0.05);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-inner);
            overflow-x: auto;
            /* Scrollbar yang lebih halus jika memungkinkan */
            scrollbar-width: thin;
            scrollbar-color: var(--color-muted-light-val) transparent;
        }

        .dark .simple-chart-bar-container {
            background-color: rgba(var(--color-muted-dark-val), 0.08);
            scrollbar-color: var(--color-muted-dark-val) transparent;
        }

        .simple-chart-bars {
            display: flex;
            gap: var(--spacing-2);
            align-items: flex-end;
            height: var(--h-40);
            /* Ketinggian chart */
            min-width: max-content;
            /* Untuk scrolling horizontal jika banyak bar */
            padding-bottom: var(--spacing-1);
            /* Ruang untuk label tidak terpotong */
        }

        .simple-chart-bar-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-shrink: 0;
            width: var(--w-10);
            /* Lebar bar + label */
            text-align: center;
            position: relative;
            /* Untuk tooltip */
        }

        .simple-chart-bar {
            width: 100%;
            background-image: linear-gradient(to top, var(--color-primary-default), var(--color-primary-light));
            border-radius: var(--border-radius-t);
            /* Hanya atas yang rounded */
            cursor: pointer;
            transition: height var(--transition-duration-default) var(--transition-timing-default),
                opacity var(--transition-duration-short) var(--transition-timing-default);
            position: relative;
            /* Untuk nilai di atas bar */
        }

        .dark .simple-chart-bar {
            background-image: linear-gradient(to top, var(--color-primary-dark), var(--color-primary-default));
        }

        .simple-chart-bar:hover {
            opacity: 0.85;
        }

        .simple-chart-bar-value {
            position: absolute;
            top: -1.5em;
            /* Di atas bar */
            left: 50%;
            transform: translateX(-50%);
            font-size: var(--text-xs);
            font-weight: var(--font-semibold);
            color: var(--color-primary-default);
            background-color: var(--color-surface);
            padding: var(--spacing-unit) var(--spacing-1);
            border-radius: var(--border-radius-sm);
            box-shadow: var(--shadow-sm);
            opacity: 0;
            transition: opacity var(--transition-duration-short) ease-in-out;
            white-space: nowrap;
            z-index: 10;
        }

        .dark .simple-chart-bar-value {
            color: var(--color-primary-light);
        }

        .simple-chart-bar-wrapper:hover .simple-chart-bar-value {
            opacity: 1;
        }

        .simple-chart-label {
            font-size: var(--text-xs);
            margin-top: var(--spacing-1);
            color: var(--color-text-muted);
            transition: font-weight var(--transition-duration-short) ease-in-out,
                color var(--transition-duration-short) ease-in-out;
        }

        .simple-chart-bar-wrapper:hover .simple-chart-label {
            font-weight: var(--font-semibold);
            color: var(--color-text-default);
        }
    </style>
</head>

<body>
    <div id="app-root">
        <!-- Konten aplikasi akan dirender di sini oleh JavaScript -->
    </div>

    <script type="module">
        // === PENJELASAN ARSITEKTUR ===
        // Aplikasi "Green Valley Rentals" ini adalah sebuah Single Page Application (SPA)
        // yang dibangun secara monolith (semua kode dalam satu file HTML, termasuk CSS dan JS).
        // Arsitektur internalnya mengikuti prinsip-prinsip modern:
        // 1. HTML5 Semantik: Penggunaan tag HTML yang tepat untuk struktur dan aksesibilitas.
        // 2. JavaScript Vanilla Native: Tidak ada framework/library eksternal untuk JS inti.
        // 3. CSS Kustom dengan Variabel & Utilitas: Memungkinkan tema (terang/gelap) dan styling konsisten.
        //    Kelas utilitas terinspirasi Tailwind CSS namun diimplementasikan secara native.
        // 4. Arsitektur Berbasis Komponen (Native SFC style): Fungsi JavaScript membuat elemen DOM
        //    yang berfungsi sebagai komponen UI reusable. Setiap komponen bertanggung jawab atas
        //    markup, styling (melalui kelas CSS), dan perilakunya sendiri.
        // 5. State Management Sederhana & Reaktif: Objek global `appState` menyimpan kondisi aplikasi.
        //    Perubahan pada `appState` akan memicu pemanggilan `renderApp()` untuk memperbarui UI.
        // 6. Routing Sisi Klien: Menggunakan URL hash (`#`) untuk navigasi antar "halaman" tanpa reload.
        // 7. Render Dinamis & Efisien (Relatif): `renderApp()` membangun ulang bagian UI yang relevan.
        //    Untuk aplikasi monolith sederhana ini, render ulang seluruh halaman atau bagian besar
        //    cukup efisien. Untuk skala besar, VDOM atau teknik diffing lebih lanjut diperlukan.
        // 8. Utilitas dan Layanan: Fungsi helper untuk tugas umum (format waktu, ikon) dan
        //    simulasi interaksi API (misalnya, Gemini AI).
        // 9. Prinsip Desain:
        //    - Bersih & Modern: Estetika visual yang menarik dan kontemporer.
        //    - Modular: Kode dipecah menjadi fungsi/komponen yang lebih kecil.
        //    - Responsif: Tampilan optimal di berbagai ukuran layar (mobile, tablet, desktop).
        //    - Interaktif: Pengalaman pengguna yang dinamis dengan feedback visual (hover, focus, transisi).
        //    - Aksesibel: Memperhatikan standar WCAG (misalnya, kontras, navigasi keyboard, ARIA).
        //    - Tema Terang/Gelap: Pilihan tema untuk preferensi pengguna.
        // 10. Hirarki Kode:
        //     - Inisialisasi & Konstanta
        //     - Definisi Ikon
        //     - Utilitas Global (timeAgo, dll.)
        //     - Mock Data
        //     - Manajemen Tema
        //     - Layanan Eksternal (Simulasi Gemini AI)
        //     - State Aplikasi Global
        //     - Fungsi Pembuat Komponen UI (Button, Card, Modal, dll.)
        //     - Fungsi Komponen Layout (Header, Footer)
        //     - Komponen Spesifik Fitur (PropertyCard, NotificationItem, dll.)
        //     - Komponen Halaman (HomePage, DashboardPage, dll.)
        //     - Helper State Modal
        //     - Logika Router SPA
        //     - Fungsi Render Utama Aplikasi
        //     - Inisialisasi Aplikasi
        // 11. Paradigma: Lebih ke arah Fungsional untuk pembuatan komponen (fungsi murni yang mengembalikan DOM)
        //     dan Imperatif untuk manipulasi DOM langsung serta manajemen state.
        // ==============================
        'use strict';

        // --- 0. Inisialisasi API Key & Polyfill ---
        // Polyfill sederhana untuk process.env jika tidak ada (misal di browser murni tanpa build tool)
        if (typeof globalThis.process === 'undefined') {
            globalThis.process = { env: {} };
        }
        // Kunci API Gemini sebaiknya disimpan sebagai variabel environment di server production
        // Untuk demo ini, kita gunakan placeholder atau bisa di-set manual.
        const GEMINI_API_KEY_PLACEHOLDER = "MASUKKAN_KUNCI_API_GEMINI_ANDA_DI_SINI";
        let geminiApiKey = globalThis.process.env.API_KEY || GEMINI_API_KEY_PLACEHOLDER;

        if (geminiApiKey === GEMINI_API_KEY_PLACEHOLDER && GEMINI_API_KEY_PLACEHOLDER !== "DISABLED") {
            console.warn("PERINGATAN: Kunci API Gemini tidak dikonfigurasi. Fitur AI (pembuatan deskripsi properti) tidak akan berfungsi. Anda bisa mengganti placeholder di kode atau mengatur variabel environment API_KEY. Untuk menonaktifkan fitur ini dan pesan ini, set GEMINI_API_KEY_PLACEHOLDER menjadi 'DISABLED'.");
        }
        const GEMINI_MODEL_NAME = 'gemini-1.5-flash-latest';

        // --- 1. Konstanta & Utilitas Global ---
        const APP_NAME = "Green Valley Rentals";

        // Fungsi untuk membuat elemen SVG dari string (dari kode pengguna, disempurnakan)
        const createSVGElement = (svgString) => {
            const template = document.createElement('template');
            template.innerHTML = svgString.trim();
            const firstChild = template.content.firstChild;
            if (firstChild instanceof SVGElement) return firstChild;
            if (firstChild instanceof HTMLElement && firstChild.querySelector('svg')) {
                return firstChild.querySelector('svg');
            }
            console.error("Gagal membuat elemen SVG dari string:", svgString);
            const fallbackSpan = document.createElement('span');
            fallbackSpan.textContent = '⚠️'; // Fallback ikon
            fallbackSpan.title = 'Ikon gagal dimuat';
            return fallbackSpan;
        };

        // Definisi Ikon SVG (Heroicons atau serupa, sebagai string)
        const SunIcon = (className = "w-6 h-6") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${className}"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-6.364-.386 1.591-1.591M3 12h2.25m.386-6.364 1.591 1.591" /></svg>`);
        const MoonIcon = (className = "w-6 h-6") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${className}"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" /></svg>`);
        const HomeIcon = (className = "w-5 h-5") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${className}"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h7.5" /></svg>`);
        const DashboardIcon = (className = "w-5 h-5") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${className}"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 8.25 20.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25A2.25 2.25 0 0 1 13.5 8.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25h-2.25a2.25 2.25 0 0 1-2.25-2.25v-2.25Z" /></svg>`);
        const BellIcon = (className = "w-5 h-5") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${className}"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" /></svg>`);
        const PlusIcon = (className = "w-5 h-5") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${className}"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>`);
        const SparklesIcon = (className = "w-4 h-4") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${className}"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L1.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L24 5.25l-.813 2.846a4.5 4.5 0 0 0-3.09 3.09L18.25 12ZM12 15.75l-2.846.813a4.5 4.5 0 0 0-3.09 3.09L5.25 21l.813-2.846a4.5 4.5 0 0 0 3.09-3.09L12 15.75Z" /></svg>`);
        const CloseIcon = (className = "w-6 h-6") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${className}"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>`);
        const ChevronDownIcon = (className = "w-5 h-5") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="${className}"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.25 4.25a.75.75 0 01-1.06 0L5.23 8.29a.75.75 0 01.02-1.06z" clip-rule="evenodd" /></svg>`);
        const TrashIcon = (className = "w-5 h-5") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${className}"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12.56 0c1.153 0 2.24.03 3.22.077Zm3.22.077L10.875 6M5.25 6H4.477c-.976 0-1.842.446-2.377 1.218H5.25v-.618Z" /></svg>`);
        const PencilIcon = (className = "w-5 h-5") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${className}"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" /></svg>`);

        // Utilitas format waktu relatif
        const timeAgo = (dateString) => {
            if (!dateString) return 'tanggal tidak valid';
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return 'tanggal tidak valid';

            const now = new Date();
            const seconds = Math.round((now.getTime() - date.getTime()) / 1000);
            const minutes = Math.round(seconds / 60);
            const hours = Math.round(minutes / 60);
            const days = Math.round(hours / 24);
            const months = Math.round(days / 30.44); // Rata-rata hari dalam sebulan
            const years = Math.round(days / 365.25); // Akun untuk tahun kabisat

            if (seconds < 5) return "baru saja";
            if (seconds < 60) return `${seconds} detik lalu`;
            if (minutes < 60) return `${minutes} menit lalu`;
            if (hours < 24) return `${hours} jam lalu`;
            if (days < 7) return `${days} hari lalu`;
            if (days < 30) return `${Math.round(days / 7)} minggu lalu`;
            if (months < 12) return `${months} bulan lalu`;
            return `${years} tahun lalu`;
        };

        // --- 2. Mock Data (Data Simulasi) ---
        const mockProperties = [
            { id: 'prop_1', name: 'Apartemen Lembah Asri', address: '123 Jl. Pinus Hijau, Green Valley', type: 'Apartemen', bedrooms: 2, bathrooms: 2, rentPrice: 1500, imageUrl: 'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8YXBhcnRtZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=600&q=80', description: 'Apartemen modern dengan pemandangan lembah yang menakjubkan. Fasilitas lengkap dan suasana tenang, cocok untuk profesional muda atau pasangan yang mencari kualitas hidup premium.', status: 'Tersedia', ownerId: 'user_admin' },
            { id: 'prop_2', name: 'Rumah Keluarga Harmoni', address: '456 Jl. Ek Teduh, Green Valley', type: 'Rumah', bedrooms: 3, bathrooms: 2.5, rentPrice: 2200, imageUrl: 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8aG91c2V8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=600&q=80', description: 'Rumah keluarga ideal dengan taman luas, dekat sekolah dan taman bermain. Dapur baru direnovasi dengan peralatan modern, siap untuk menciptakan kenangan indah.', status: 'Disewa', ownerId: 'user_admin' },
            { id: 'prop_3', name: 'Kondominium Urban Elegan', address: '789 Jl. Pusat Kota Ramai, Green Valley', type: 'Kondominium', bedrooms: 1, bathrooms: 1, rentPrice: 1200, imageUrl: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8Y29uZG98ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=600&q=80', description: 'Kondominium stylish di jantung kota. Akses mudah ke pertokoan, restoran, dan transportasi publik. Nikmati kehidupan urban terbaik dengan segala kemudahannya.', status: 'Tersedia', ownerId: 'user_another' },
            { id: 'prop_4', name: 'Villa Mewah Tepi Sungai', address: '101 Jl. Pinggir Sungai Indah, Green Valley', type: 'Rumah', bedrooms: 4, bathrooms: 3, rentPrice: 3000, imageUrl: 'https://images.unsplash.com/photo-1580587771525-78b9dba3b914?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTB8fGx1eHVyeSUyMGhvdXNlfGVufDB8fDB8fHww&auto=format&fit=crop&w=600&q=80', description: 'Villa luas dengan arsitektur menawan, kolam renang pribadi, dan garasi tiga mobil. Rasakan privasi dan kemewahan di lokasi prima, sempurna untuk relaksasi dan hiburan.', status: 'Tersedia', ownerId: 'user_admin' },
        ];
        const mockNotifications = [
            { id: 'n1', message: 'Permintaan sewa baru untuk "Apartemen Lembah Asri".', timestamp: new Date(Date.now() - 5 * 60 * 1000).toISOString(), read: false, type: 'info' },
            { id: 'n2', message: 'Pembayaran sewa $2200 diterima untuk "Rumah Keluarga Harmoni".', timestamp: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(), read: true, type: 'success' },
            { id: 'n3', message: 'Permintaan pemeliharaan untuk "Kondominium Urban Elegan": Keran bocor di dapur.', timestamp: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(), read: false, type: 'warning' },
            { id: 'n4', message: 'Sistem akan melakukan maintenance pada pukul 02:00 WIB.', timestamp: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(), read: true, type: 'error' },
        ];
        const mockIncomeData = [
            { month: 'Jan', amount: 2200 }, { month: 'Feb', amount: 1500 }, { month: 'Mar', amount: 3000 },
            { month: 'Apr', amount: 2000 }, { month: 'Mei', amount: 2780 }, { month: 'Jun', amount: 1890 },
            { month: 'Jul', amount: 3300 }, { month: 'Agu', amount: 2500 }, { month: 'Sep', amount: 3100 },
        ];
        const CURRENT_USER_ID = 'user_admin'; // Simulasi pengguna yang sedang login

        // --- 3. Manajemen Tema ---
        const Theme = { LIGHT: 'light', DARK: 'dark' };
        let currentTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? Theme.DARK : Theme.LIGHT);

        function applyTheme(theme, initial = false) {
            document.documentElement.classList.remove(Theme.LIGHT, Theme.DARK);
            document.documentElement.classList.add(theme);
            // Kelas dasar dari variabel CSS sudah menangani warna bg dan teks
            if (!initial) { // Hanya simpan ke localStorage jika bukan load awal (untuk menghormati prefers-color-scheme)
                localStorage.setItem('theme', theme);
            }
            currentTheme = theme;
            // Terapkan kelas setelah tema di-set untuk menghindari FOUC
            document.documentElement.classList.add('theme-applied');
        }

        function toggleThemeAndUpdateUI() {
            const newTheme = currentTheme === Theme.LIGHT ? Theme.DARK : Theme.LIGHT;
            applyTheme(newTheme);
            renderApp(); // Panggil renderApp untuk memperbarui komponen yang mungkin bergantung pada tema
        }

        // --- 4. Layanan Gemini AI (Simulasi) ---
        async function generatePropertyDescriptionWithGemini(propertyDetails) {
            if (geminiApiKey === GEMINI_API_KEY_PLACEHOLDER || !geminiApiKey || geminiApiKey === "DISABLED") {
                if (GEMINI_API_KEY_PLACEHOLDER !== "DISABLED") {
                    console.warn("Layanan AI tidak tersedia karena Kunci API Gemini tidak dikonfigurasi.");
                }
                return "Layanan AI tidak tersedia. Silakan tulis deskripsi secara manual.";
            }

            const prompt = `Buat deskripsi properti real estat yang menarik dan persuasif dalam Bahasa Indonesia untuk properti berikut. Deskripsi harus ringkas (2-3 kalimat), menyoroti fitur utama, dan menggunakan nada profesional namun hangat.
                Jenis Properti: ${propertyDetails.type || 'Tidak disebutkan'}
                Kamar Tidur: ${propertyDetails.bedrooms || 'Tidak disebutkan'}
                Kamar Mandi: ${propertyDetails.bathrooms || 'Tidak disebutkan'}
                Fitur Tambahan (jika ada): ${propertyDetails.features || 'Tidak ada fitur tambahan yang disebutkan.'}
                Target Penyewa: (Misal: profesional muda, keluarga, mahasiswa)
                Gaya Bahasa: Elegan, mengundang, dan informatif. Hindari klise berlebihan.
                Contoh Output: "Nikmati kenyamanan modern di [Jenis Properti] ini, menawarkan ${propertyDetails.bedrooms || 'beberapa'} kamar tidur dan ${propertyDetails.bathrooms || 'beberapa'} kamar mandi. Ideal untuk [Target Penyewa], properti ini terletak strategis di Green Valley, memberikan akses mudah ke berbagai fasilitas."`;

            try {
                // Simulasi delay API call
                await new Promise(resolve => setTimeout(resolve, 1500));

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL_NAME}:generateContent?key=${geminiApiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { temperature: 0.7, maxOutputTokens: 300 }
                    })
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error("Error dari Gemini API:", errorData);
                    throw new Error(`Gemini API error: ${response.status} - ${errorData.error?.message || 'Kesalahan tidak diketahui dari API'}`);
                }
                const data = await response.json();
                const generatedText = data.candidates?.[0]?.content.parts?.[0]?.text;
                return generatedText || "Deskripsi tidak dapat dihasilkan oleh AI saat ini. Coba lagi atau tulis manual.";
            } catch (error) {
                console.error("Gagal menghasilkan deskripsi properti dengan Gemini:", error);
                return `Gagal menghubungi layanan AI: ${error.message}. Silakan tulis deskripsi secara manual.`;
            }
        }

        // --- 5. State Aplikasi Global ---
        const appState = {
            currentPage: 'home', // Halaman aktif saat ini
            properties: JSON.parse(JSON.stringify(mockProperties)), // Salinan data properti
            notifications: JSON.parse(JSON.stringify(mockNotifications)), // Salinan data notifikasi
            selectedPropertyModal: { isOpen: false, propertyId: null }, // State untuk modal detail properti
            propertyFormModal: { isOpen: false, propertyToEditId: null, isGeneratingDesc: false, errors: {} }, // State untuk modal form properti
            isLoading: false, // Indikator loading global (jika diperlukan)
            // Bisa ditambahkan filter, sorting, dll. di sini
        };

        // Fungsi untuk memperbarui properti di state global dan mock data (simulasi persistensi sesi)
        function updateGlobalProperty(updatedProperty) {
            const index = appState.properties.findIndex(p => p.id === updatedProperty.id);
            if (index > -1) {
                appState.properties[index] = { ...appState.properties[index], ...updatedProperty };
            } else {
                appState.properties.unshift(updatedProperty); // Tambah di awal array
            }
            // Update mockProperties juga untuk "persistensi" dalam sesi ini
            const mockIndex = mockProperties.findIndex(p => p.id === updatedProperty.id);
            if (mockIndex > -1) mockProperties[mockIndex] = { ...mockProperties[mockIndex], ...updatedProperty };
            else mockProperties.unshift(updatedProperty);

            renderApp(); // Pemicu render ulang UI
        }

        // Fungsi untuk menghapus properti dari state global dan mock data
        function deleteGlobalProperty(propertyId) {
            appState.properties = appState.properties.filter(p => p.id !== propertyId);
            const mockIndex = mockProperties.findIndex(p => p.id === propertyId);
            if (mockIndex > -1) mockProperties.splice(mockIndex, 1);
            renderApp();
        }

        // --- 6. Fungsi Komponen UI ---
        // Komponen Tombol (ButtonComponent)
        function ButtonComponent({
            textContent, onClick, variant = 'primary', size = 'md',
            leftIcon, rightIcon, className = '', type = 'button',
            disabled = false, ariaLabel = '', title = ''
        }) {
            const el = document.createElement('button');
            el.type = type;
            el.disabled = disabled;

            // Set ARIA label: jika ada textContent, itu jadi label utama, jika tidak, ariaLabel wajib
            if (textContent) {
                el.setAttribute('aria-label', ariaLabel || textContent);
            } else if (ariaLabel) {
                el.setAttribute('aria-label', ariaLabel);
            } else {
                console.warn('Tombol tanpa textContent harus memiliki ariaLabel.');
                el.setAttribute('aria-label', 'Tombol tanpa label'); // Fallback
            }
            if (title) el.title = title;

            el.className = `button-base button-${variant} button-sz-${size} ${className}`;
            if (disabled) el.setAttribute('aria-disabled', 'true');

            if (leftIcon) {
                const iconSpan = document.createElement('span');
                iconSpan.className = textContent ? 'mr-2' : ''; // Margin jika ada teks
                if (leftIcon instanceof Node) iconSpan.appendChild(leftIcon);
                el.appendChild(iconSpan);
            }
            if (textContent) {
                el.appendChild(document.createTextNode(textContent));
            }
            if (rightIcon) {
                const iconSpan = document.createElement('span');
                iconSpan.className = textContent ? 'ml-2' : ''; // Margin jika ada teks
                if (rightIcon instanceof Node) iconSpan.appendChild(rightIcon);
                el.appendChild(iconSpan);
            }
            if (onClick) el.addEventListener('click', onClick);
            return el;
        }

        // Komponen Kartu (CardComponent)
        function CardComponent({ children, className = '', onClick, ariaLabelledby, role }) {
            const el = document.createElement(onClick ? 'button' : 'div'); // Jadi button jika bisa diklik
            el.className = `bg-surface rounded-xl shadow-lg p-6 ${className}`;

            if (onClick) {
                el.classList.add('cursor-pointer', 'hover-shadow-xl', 'transition-shadow', 'duration-300', 'text-left', 'w-full');
                el.addEventListener('click', onClick);
                el.setAttribute('role', role || 'button');
                // Tidak perlu tabIndex=0 jika sudah button
                // el.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') onClick(e); });
            } else if (role) {
                el.setAttribute('role', role);
            }

            if (ariaLabelledby) el.setAttribute('aria-labelledby', ariaLabelledby);

            if (typeof children === 'string') el.innerHTML = children;
            else if (children instanceof Node) el.appendChild(children);
            else if (Array.isArray(children)) children.forEach(child => child instanceof Node && el.appendChild(child));
            return el;
        }

        // Komponen Modal (ModalComponent) - Ditingkatkan dengan animasi dan fokus trapping
        let activeModal = null; // Untuk mengelola modal aktif dan fokus
        function ModalComponent({ isOpen, onClose, title, children, size = 'md', footerContent }) {
            if (!isOpen) {
                if (activeModal && activeModal.overlay === document.querySelector('.modal-overlay')) {
                    activeModal.cleanup(); // Pastikan cleanup jika modal ditutup secara eksternal
                    activeModal = null;
                }
                return null;
            }

            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'modal-overlay'; // Animasi via kelas 'open'
            modalOverlay.setAttribute('role', 'dialog');
            modalOverlay.setAttribute('aria-modal', 'true');
            const modalTitleId = `modal-title-${Date.now()}`;
            if (title) modalOverlay.setAttribute('aria-labelledby', modalTitleId);

            const modalContent = document.createElement('div');
            modalContent.className = `modal-content size-${size}`; // Animasi via kelas 'open' di overlay
            modalContent.addEventListener('click', (e) => e.stopPropagation()); // Mencegah close saat klik konten

            const headerDiv = document.createElement('div');
            headerDiv.className = 'flex justify-between items-center mb-4 pb-3 border-b border-border';
            if (title) {
                const titleEl = document.createElement('h2');
                titleEl.id = modalTitleId;
                titleEl.className = 'text-xl font-semibold text-text-default font-display';
                titleEl.textContent = title;
                headerDiv.appendChild(titleEl);
            }
            const closeButton = ButtonComponent({
                variant: 'ghost',
                className: 'p-1 -mr-2 -mt-2 text-text-muted hover-text-text-default', // Disesuaikan
                leftIcon: CloseIcon('w-5 h-5'),
                onClick: onClose,
                ariaLabel: 'Tutup modal'
            });
            headerDiv.appendChild(closeButton);
            modalContent.appendChild(headerDiv);

            const bodyDiv = document.createElement('div');
            bodyDiv.className = 'modal-body-content';
            if (typeof children === 'string') bodyDiv.innerHTML = children;
            else if (children instanceof Node) bodyDiv.appendChild(children);
            else if (Array.isArray(children)) children.forEach(child => child instanceof Node && bodyDiv.appendChild(child));
            modalContent.appendChild(bodyDiv);

            if (footerContent) {
                const footerDiv = document.createElement('div');
                footerDiv.className = 'mt-6 pt-4 border-t border-border flex justify-end space-x-3';
                if (footerContent instanceof Node) footerDiv.appendChild(footerContent);
                else if (Array.isArray(footerContent)) footerContent.forEach(child => child instanceof Node && footerDiv.appendChild(child));
                modalContent.appendChild(footerDiv);
            }

            modalOverlay.appendChild(modalContent);

            // Fokus Trapping dan Event Listeners
            let previouslyFocusedElement = document.activeElement;
            const focusableElementsString = 'a[href], button:not([disabled]), textarea, input, select';
            let focusableElements, firstFocusableElement, lastFocusableElement;

            const trapFocus = (e) => {
                if (e.key !== 'Tab') return;
                if (e.shiftKey) { // Shift + Tab
                    if (document.activeElement === firstFocusableElement) {
                        lastFocusableElement.focus();
                        e.preventDefault();
                    }
                } else { // Tab
                    if (document.activeElement === lastFocusableElement) {
                        firstFocusableElement.focus();
                        e.preventDefault();
                    }
                }
            };
            const handleEsc = (event) => { if (event.key === 'Escape') onClose(); };
            const closeOnOverlayClick = (e) => { if (e.target === modalOverlay) onClose(); };

            modalOverlay.cleanup = () => {
                document.removeEventListener('keydown', handleEsc);
                document.removeEventListener('keydown', trapFocus);
                modalOverlay.removeEventListener('click', closeOnOverlayClick);
                document.body.style.overflow = 'unset';
                previouslyFocusedElement?.focus(); // Kembalikan fokus
                if (modalOverlay.parentElement) modalOverlay.parentElement.removeChild(modalOverlay);
                if (activeModal && activeModal.overlay === modalOverlay) activeModal = null;
            };
            activeModal = { overlay: modalOverlay, cleanup: modalOverlay.cleanup }; // Set modal aktif

            // Tampilkan modal dengan animasi
            requestAnimationFrame(() => {
                modalOverlay.classList.add('open');
                modalContent.classList.add('open'); // Ini tidak perlu jika animasi scale ada di .modal-overlay.open .modal-content

                focusableElements = Array.from(modalContent.querySelectorAll(focusableElementsString));
                firstFocusableElement = focusableElements[0];
                lastFocusableElement = focusableElements[focusableElements.length - 1];

                if (firstFocusableElement) firstFocusableElement.focus();
                else closeButton.focus(); // Fallback jika tidak ada elemen fokus lain

                document.addEventListener('keydown', handleEsc);
                document.addEventListener('keydown', trapFocus);
                modalOverlay.addEventListener('click', closeOnOverlayClick);
                document.body.style.overflow = 'hidden'; // Cegah scroll background
            });

            return modalOverlay;
        }

        // Komponen Spinner (SpinnerComponent)
        function SpinnerComponent({ size = 'md', colorClass = 'border-primary dark:border-primary-light', srText = 'Memuat...' } = {}) {
            const spinnerDiv = document.createElement('div');
            spinnerDiv.className = 'inline-flex justify-center items-center';
            spinnerDiv.setAttribute('role', 'status');
            spinnerDiv.setAttribute('aria-live', 'polite');
            const ringDiv = document.createElement('div');
            // Pastikan warna border konsisten di light/dark jika colorClass pakai var CSS
            let finalColorClass = colorClass;
            if (colorClass.includes('border-primary')) { // Contoh penyesuaian
                finalColorClass = currentTheme === Theme.DARK ? 'border-primary-light' : 'border-primary';
            }
            ringDiv.className = `animate-spin spinner-ring spinner-${size} ${finalColorClass}`;
            spinnerDiv.appendChild(ringDiv);
            const srSpan = document.createElement('span');
            srSpan.className = 'sr-only';
            srSpan.textContent = srText;
            spinnerDiv.appendChild(srSpan);
            return spinnerDiv;
        }

        // Komponen Toggle Tema (ThemeToggleComponent)
        function ThemeToggleComponent() {
            const isLight = currentTheme === Theme.LIGHT;
            return ButtonComponent({
                onClick: toggleThemeAndUpdateUI,
                variant: 'ghost',
                ariaLabel: isLight ? 'Alihkan ke tema gelap' : 'Alihkan ke tema terang',
                title: isLight ? 'Tema Gelap' : 'Tema Terang',
                className: 'p-2 rounded-full text-text-muted hover-text-text-default', // Styling ikon
                leftIcon: isLight ? MoonIcon('w-5 h-5') : SunIcon('w-5 h-5')
            });
        }

        // --- 7. Fungsi Komponen Layout ---
        function HeaderComponent() {
            const header = document.createElement('header');
            header.className = 'app-header';

            const container = document.createElement('div');
            container.className = 'container mx-auto';
            header.appendChild(container);

            const flexContainer = document.createElement('div');
            flexContainer.className = 'flex items-center justify-between h-16'; // Tinggi header tetap
            container.appendChild(flexContainer);

            const logoLink = document.createElement('a');
            logoLink.href = '#home';
            logoLink.className = 'text-2xl font-bold font-display text-primary dark:text-primary-light hover-opacity-80 transition-opacity';
            logoLink.textContent = APP_NAME;
            logoLink.onclick = (e) => { e.preventDefault(); navigateTo('home'); };
            flexContainer.appendChild(logoLink);

            const nav = document.createElement('nav');
            nav.setAttribute('aria-label', 'Navigasi utama');
            nav.className = 'flex items-center space-x-1 sm-space-x-2'; // Spasi antar item nav

            const navLink = (path, iconElement, text) => {
                const link = document.createElement('a');
                link.href = `#${path}`;
                const isActive = appState.currentPage === path;
                // Kelas untuk active state lebih menonjol
                const activeClasses = 'bg-primary-opacity-10 dark:bg-primary-opacity-20 text-primary dark:text-primary-light font-semibold';
                const inactiveClasses = 'text-text-muted hover-bg-slate-100 dark:hover-bg-slate-700 hover-text-text-default';
                link.className = `inline-flex items-center px-2 py-2 sm-px-3 rounded-md text-sm font-medium transition-colors duration-200 ${isActive ? activeClasses : inactiveClasses}`;

                if (isActive) link.setAttribute('aria-current', 'page');
                link.onclick = (e) => { e.preventDefault(); navigateTo(path); };

                if (iconElement) {
                    const iconSpan = document.createElement('span');
                    // Untuk mobile, hanya ikon jika teks ada. Untuk desktop, ikon+teks.
                    iconSpan.className = text ? 'mr-0 sm-mr-1_5' : '';
                    iconSpan.appendChild(iconElement);
                    link.appendChild(iconSpan);
                }

                if (text) {
                    const textSpan = document.createElement('span');
                    textSpan.className = 'hidden sm-inline'; // Teks disembunyikan di layar kecil
                    textSpan.textContent = text;
                    link.appendChild(textSpan);
                }
                return link;
            };

            nav.appendChild(navLink('home', HomeIcon('w-5 h-5'), 'Beranda'));
            nav.appendChild(navLink('dashboard', DashboardIcon('w-5 h-5'), 'Dasbor'));
            nav.appendChild(navLink('notifications', BellIcon('w-5 h-5'), 'Notifikasi'));
            nav.appendChild(ThemeToggleComponent()); // Tombol tema
            flexContainer.appendChild(nav);

            return header;
        }

        function FooterComponent() {
            const footer = document.createElement('footer');
            footer.className = 'app-footer';

            const container = document.createElement('div');
            container.className = 'container mx-auto px-4';

            const p1 = document.createElement('p');
            p1.className = 'text-sm text-text-muted';
            p1.innerHTML = `&copy; ${new Date().getFullYear()} ${APP_NAME}. Dibuat dengan <span role="img" aria-label="cinta">❤️</span> dan kode vanilla.`;
            container.appendChild(p1);

            const p2 = document.createElement('p');
            p2.className = 'text-xs text-text-muted opacity-75 mt-1';
            p2.textContent = 'Hunian Impian Anda, Kini Lebih Mudah Ditemukan dan Dikelola.';
            container.appendChild(p2);

            footer.appendChild(container);
            return footer;
        }

        // --- Komponen Properti ---
        function PropertyCardComponent(property, onDetailsClick) {
            const cardEl = document.createElement('article'); // Lebih semantik
            cardEl.className = `property-card group ${onDetailsClick ? 'clickable' : ''}`;
            cardEl.setAttribute('aria-labelledby', `prop-name-${property.id}`);
            if (onDetailsClick) {
                cardEl.tabIndex = 0; // Bisa difokus keyboard
                cardEl.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') onDetailsClick(property.id); });
            }

            const imgContainer = document.createElement('div');
            imgContainer.className = 'property-card-image-container';
            const img = document.createElement('img');
            img.src = property.imageUrl;
            img.alt = `Tampilan eksterior ${property.name}`; // Alt text lebih deskriptif
            img.className = 'property-card-image';
            img.loading = 'lazy'; // Penting untuk performa
            imgContainer.appendChild(img);

            const statusBadge = document.createElement('div');
            statusBadge.className = `property-card-status-badge ${property.status === 'Tersedia' ? 'available' : 'rented'}`;
            statusBadge.textContent = property.status;
            imgContainer.appendChild(statusBadge);
            cardEl.appendChild(imgContainer);

            const contentDiv = document.createElement('div');
            contentDiv.className = 'property-card-content';

            const nameH3 = document.createElement('h3');
            nameH3.id = `prop-name-${property.id}`;
            nameH3.className = 'text-xl font-semibold font-display text-text-default mb-1 truncate group-hover-font-semibold'; // Judul lebih menonjol
            nameH3.title = property.name; // Tooltip untuk nama panjang
            nameH3.textContent = property.name;
            contentDiv.appendChild(nameH3);

            const addressP = document.createElement('p');
            addressP.className = 'text-sm text-text-muted mb-2 truncate';
            addressP.textContent = property.address;
            contentDiv.appendChild(addressP);

            const detailsP = document.createElement('p');
            detailsP.className = 'text-sm text-text-muted mb-3';
            detailsP.innerHTML = `${property.bedrooms} KT &middot; ${property.bathrooms} KM &middot; ${property.type}`; // Bullet point
            contentDiv.appendChild(detailsP);

            const priceP = document.createElement('p');
            priceP.className = 'text-2xl font-bold text-primary dark:text-primary-light mb-4'; // Harga lebih besar
            priceP.textContent = `$${Number(property.rentPrice).toLocaleString('id-ID')}/bulan`;
            contentDiv.appendChild(priceP);

            const descriptionP = document.createElement('p');
            descriptionP.className = 'text-sm text-text-default opacity-90 mb-4 line-clamp-3 property-card-description'; // line-clamp dari CSS
            descriptionP.textContent = property.description;
            contentDiv.appendChild(descriptionP);

            if (onDetailsClick) {
                const button = ButtonComponent({
                    textContent: 'Lihat Detail',
                    variant: 'primary', // Tombol utama
                    className: 'mt-auto w-full', // Dorong ke bawah
                    onClick: (e) => {
                        e.stopPropagation(); // Hindari trigger klik card jika tombol diklik
                        onDetailsClick(property.id);
                    }
                });
                contentDiv.appendChild(button);
            }
            cardEl.appendChild(contentDiv);

            // Klik seluruh kartu jika ada handler (kecuali targetnya adalah tombol di dalam)
            if (onDetailsClick) {
                cardEl.addEventListener('click', (e) => {
                    if (e.target.closest('button') === null) { // Cek apakah klik berasal dari tombol
                        onDetailsClick(property.id);
                    }
                });
            }
            return cardEl;
        }

        function PropertyListComponent(properties, onPropertyClick, emptyMessage = "Tidak ada properti yang tersedia saat ini.") {
            const listContainer = document.createElement('div');
            if (properties.length === 0) {
                const emptyState = document.createElement('p');
                emptyState.className = 'text-center text-text-muted py-12 text-lg';
                emptyState.textContent = emptyMessage;
                listContainer.appendChild(emptyState);
                return listContainer;
            }
            // Responsif grid: 1 kolom di mobile, 2 di sm, 3 di lg
            listContainer.className = 'grid grid-cols-1 sm-grid-cols-2 lg-grid-cols-3 gap-6';
            properties.forEach(prop => {
                const propCard = PropertyCardComponent(prop, onPropertyClick);
                propCard.classList.add('animate-fade-in'); // Animasi masuk untuk setiap kartu
                listContainer.appendChild(propCard);
            });
            return listContainer;
        }

        // --- Komponen Notifikasi ---
        function NotificationItemComponent(notification) {
            const itemDiv = document.createElement('div');
            const typeClasses = {
                info: { border: 'border-blue-500', bgIcon: 'bg-blue-500', icon: BellIcon },
                success: { border: 'border-green-500', bgIcon: 'bg-green-500', icon: BellIcon }, // Bisa ganti ikon
                warning: { border: 'border-yellow-500', bgIcon: 'bg-yellow-500', icon: BellIcon },
                error: { border: 'border-red-500', bgIcon: 'bg-red-500', icon: BellIcon }
            };
            const currentType = typeClasses[notification.type] || typeClasses.info; // Fallback ke info
            itemDiv.className = `notification-item ${notification.read ? 'read' : ''} ${currentType.border}`;

            const iconWrapper = document.createElement('div');
            iconWrapper.className = `notification-icon-wrapper ${currentType.bgIcon}`;
            const iconSvg = currentType.icon('w-5 h-5 text-white'); // Ikon putih di atas bg berwarna
            if (iconSvg) iconWrapper.appendChild(iconSvg);
            itemDiv.appendChild(iconWrapper);

            const contentDiv = document.createElement('div');
            contentDiv.className = 'notification-content';
            const msgP = document.createElement('p');
            msgP.className = 'text-sm text-text-default font-medium';
            msgP.textContent = notification.message;
            contentDiv.appendChild(msgP);

            const timeP = document.createElement('p');
            timeP.className = 'text-xs text-text-muted mt-1';
            timeP.textContent = timeAgo(notification.timestamp);
            contentDiv.appendChild(timeP);
            itemDiv.appendChild(contentDiv);

            if (!notification.read) {
                const unreadDot = document.createElement('div');
                unreadDot.className = 'notification-unread-dot';
                unreadDot.title = 'Tandai sebagai belum dibaca'; // Aksesibilitas
                itemDiv.appendChild(unreadDot);
            }
            return itemDiv;
        }

        function NotificationListComponent(notifications) {
            const listContainer = document.createElement('div');
            if (notifications.length === 0) {
                const emptyState = document.createElement('p');
                emptyState.className = 'text-center text-text-muted py-12 text-lg';
                emptyState.textContent = "Tidak ada notifikasi baru untuk Anda saat ini.";
                listContainer.appendChild(emptyState);
                return listContainer;
            }
            listContainer.className = 'space-y-3'; // Jarak antar notifikasi
            // Urutkan: belum dibaca dulu, lalu yang terbaru
            const sortedNotifications = [...notifications].sort((a, b) => {
                if (a.read !== b.read) return a.read ? 1 : -1; // false (belum dibaca) comes first
                return new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime(); // terbaru dulu
            });
            sortedNotifications.forEach(notif => {
                const notifItem = NotificationItemComponent(notif);
                notifItem.classList.add('animate-slide-up'); // Animasi masuk
                listContainer.appendChild(notifItem);
            });
            return listContainer;
        }

        // --- Komponen Dasbor ---
        function DashboardSectionComponent({ title, children, actionButton, className = '' }) {
            const sectionContent = document.createElement('div');
            sectionContent.className = 'space-y-4'; // Jarak antar elemen di dalam section card

            const headerDiv = document.createElement('div');
            headerDiv.className = 'flex flex-col sm-flex-row justify-between items-start sm-items-center mb-2 sm-mb-0'; // Disesuaikan margin
            const titleH2 = document.createElement('h2');
            titleH2.className = 'text-2xl font-semibold font-display text-text-default'; // Font display untuk judul section
            titleH2.textContent = title;
            headerDiv.appendChild(titleH2);
            if (actionButton) headerDiv.appendChild(actionButton); // Tombol aksi di kanan atas
            sectionContent.appendChild(headerDiv);

            const contentDiv = document.createElement('div');
            if (typeof children === 'string') contentDiv.innerHTML = children;
            else if (children instanceof Node) contentDiv.appendChild(children);
            else if (Array.isArray(children)) children.forEach(child => child instanceof Node && contentDiv.appendChild(child));
            sectionContent.appendChild(contentDiv);

            // Menggunakan CardComponent sebagai basis
            return CardComponent({
                children: sectionContent,
                className: `animate-slide-up ${className}`, // Animasi masuk
                role: 'region', // Semantik untuk section
                ariaLabelledby: titleH2.id = `dashboard-section-title-${title.toLowerCase().replace(/\s+/g, '-')}`
            });
        }

        let currentPropertyFormModal = null; // Untuk referensi modal form
        let propertyFormValidationTimer = null; // Timer untuk validasi on-the-fly

        // Validasi Form Properti
        function validatePropertyForm(formData, formElements) {
            const errors = {};
            if (!formData.name?.trim()) errors.name = "Nama properti tidak boleh kosong.";
            if (!formData.address?.trim()) errors.address = "Alamat tidak boleh kosong.";
            if (isNaN(parseFloat(formData.bedrooms)) || parseFloat(formData.bedrooms) < 0) errors.bedrooms = "Jumlah kamar tidur tidak valid.";
            if (isNaN(parseFloat(formData.bathrooms)) || parseFloat(formData.bathrooms) < 0) errors.bathrooms = "Jumlah kamar mandi tidak valid.";
            if (isNaN(parseFloat(formData.rentPrice)) || parseFloat(formData.rentPrice) <= 0) errors.rentPrice = "Harga sewa harus lebih dari 0.";
            if (!formData.description?.trim()) errors.description = "Deskripsi tidak boleh kosong.";
            else if (formData.description.trim().length < 20) errors.description = "Deskripsi minimal 20 karakter.";

            // Tampilkan/sembunyikan pesan error di UI
            Object.keys(formElements).forEach(key => {
                const inputEl = formElements[key];
                const errorMsgEl = inputEl.parentElement.querySelector('.form-error-message');
                if (errors[key]) {
                    inputEl.classList.add('is-invalid');
                    if (errorMsgEl) errorMsgEl.textContent = errors[key];
                    else { // Buat elemen error jika belum ada
                        const newErrorEl = document.createElement('span');
                        newErrorEl.className = 'form-error-message';
                        newErrorEl.textContent = errors[key];
                        inputEl.parentElement.appendChild(newErrorEl);
                    }
                } else {
                    inputEl.classList.remove('is-invalid');
                    if (errorMsgEl) errorMsgEl.textContent = '';
                }
            });
            return errors;
        }


        function PropertyFormModalComponent() {
            const { isOpen, propertyToEditId, isGeneratingDesc, errors: currentErrors } = appState.propertyFormModal;
            if (!isOpen) return null;

            const propertyToEdit = propertyToEditId ? appState.properties.find(p => p.id === propertyToEditId) : null;
            // Default image URL yang lebih bervariasi
            const defaultImageUrl = `https://source.unsplash.com/random/600x400/?house,modern,architecture&sig=${Date.now()}`;
            const initialFormState = { name: '', address: '', type: 'Apartemen', bedrooms: 1, bathrooms: 1, rentPrice: 1000, description: '', status: 'Tersedia', imageUrl: defaultImageUrl, ownerId: CURRENT_USER_ID };
            let formData = propertyToEdit ? { ...initialFormState, ...propertyToEdit } : { ...initialFormState };

            const form = document.createElement('form');
            form.className = 'space-y-4';
            form.setAttribute('novalidate', ''); // Validasi sisi klien via JS

            const formElements = {}; // Untuk menyimpan referensi elemen input untuk validasi

            const createFormField = (label, name, type = 'text', value, options = {}) => {
                const fieldId = `form-${name}-${Date.now()}`;
                const div = document.createElement('div');
                const labelEl = document.createElement('label');
                labelEl.htmlFor = fieldId;
                labelEl.className = 'form-label';
                labelEl.textContent = label + (options.required ? ' *' : '');
                div.appendChild(labelEl);

                let inputEl;
                const commonInputClasses = type === 'select' ? 'form-select' : (type === 'textarea' ? 'form-textarea' : 'form-input');

                if (type === 'select') {
                    const selectWrapper = document.createElement('div');
                    selectWrapper.className = 'relative'; // Untuk ikon dropdown
                    inputEl = document.createElement('select');
                    inputEl.className = `${commonInputClasses} appearance-none pr-8`; // Hilangkan default arrow, tambah padding kanan
                    options.choices?.forEach(opt => {
                        const optionEl = document.createElement('option');
                        optionEl.value = opt.value;
                        optionEl.textContent = opt.label;
                        if (opt.value === value) optionEl.selected = true;
                        inputEl.appendChild(optionEl);
                    });
                    selectWrapper.appendChild(inputEl);
                    const chevronIcon = ChevronDownIcon('w-5 h-5 text-text-muted absolute top-1/2 right-3 transform -translate-y-1/2 pointer-events-none');
                    selectWrapper.appendChild(chevronIcon);
                    div.appendChild(selectWrapper);
                } else if (type === 'textarea') {
                    inputEl = document.createElement('textarea');
                    inputEl.className = commonInputClasses;
                    inputEl.rows = options.rows || 3;
                    inputEl.value = value;
                } else {
                    inputEl = document.createElement('input');
                    inputEl.className = commonInputClasses;
                    inputEl.type = type;
                    if (options.min !== undefined) inputEl.min = options.min;
                    if (options.step !== undefined) inputEl.step = options.step;
                    if (options.placeholder) inputEl.placeholder = options.placeholder;
                    inputEl.value = value;
                }
                inputEl.name = name;
                inputEl.id = fieldId;
                if (options.required) inputEl.setAttribute('aria-required', 'true');
                formElements[name] = inputEl; // Simpan referensi

                inputEl.addEventListener('input', (e) => {
                    const val = e.target.value;
                    formData[name] = (type === 'number' || ['rentPrice', 'bedrooms', 'bathrooms'].includes(name)) ? parseFloat(val) || 0 : val;
                    // Debounce validasi
                    clearTimeout(propertyFormValidationTimer);
                    propertyFormValidationTimer = setTimeout(() => {
                        appState.propertyFormModal.errors = validatePropertyForm(formData, formElements);
                        // Tidak perlu re-render seluruh app, cukup update error messages
                        // Namun untuk sinkronisasi state, kita re-render bagian modal jika error berubah
                        if (JSON.stringify(appState.propertyFormModal.errors) !== JSON.stringify(currentErrors)) {
                            // Minimal re-render form atau modal jika error berubah
                            // Ini akan di-handle oleh renderApp() jika state errors berubah
                            // Untuk demo, kita re-render global
                            renderApp();
                        }
                    }, 500);
                });
                if (type !== 'select') div.appendChild(inputEl); // Untuk select, input sudah di dalam wrapper

                // Placeholder untuk pesan error
                const errorSpan = document.createElement('span');
                errorSpan.className = 'form-error-message text-xs';
                if (currentErrors && currentErrors[name]) {
                    errorSpan.textContent = currentErrors[name];
                    inputEl.classList.add('is-invalid');
                }
                div.appendChild(errorSpan);

                return div;
            };

            form.appendChild(createFormField('Nama Properti', 'name', 'text', formData.name, { required: true, placeholder: 'Mis: Apartemen Modern Pusat Kota' }));
            form.appendChild(createFormField('Alamat', 'address', 'text', formData.address, { required: true, placeholder: 'Mis: Jl. Sudirman No. 123, Jakarta' }));

            const gridDiv1 = document.createElement('div');
            gridDiv1.className = 'grid grid-cols-1 md-grid-cols-2 gap-4';
            gridDiv1.appendChild(createFormField('Tipe', 'type', 'select', formData.type, { choices: [{ value: 'Apartemen', label: 'Apartemen' }, { value: 'Rumah', label: 'Rumah' }, { value: 'Kondominium', label: 'Kondominium' }, { value: 'Villa', label: 'Villa' }] }));
            gridDiv1.appendChild(createFormField('Status', 'status', 'select', formData.status, { choices: [{ value: 'Tersedia', label: 'Tersedia' }, { value: 'Disewa', label: 'Disewa' }] }));
            form.appendChild(gridDiv1);

            const gridDiv2 = document.createElement('div');
            gridDiv2.className = 'grid grid-cols-1 md-grid-cols-3 gap-4';
            gridDiv2.appendChild(createFormField('Kamar Tidur', 'bedrooms', 'number', formData.bedrooms, { min: 0, required: true, placeholder: 'Jumlah KT' }));
            gridDiv2.appendChild(createFormField('Kamar Mandi', 'bathrooms', 'number', formData.bathrooms, { min: 0, step: 0.5, required: true, placeholder: 'Jumlah KM' }));
            gridDiv2.appendChild(createFormField('Harga Sewa ($/bulan)', 'rentPrice', 'number', formData.rentPrice, { min: 0, required: true, placeholder: 'Mis: 1500' }));
            form.appendChild(gridDiv2);

            const descFieldContainer = createFormField('Deskripsi', 'description', 'textarea', formData.description, { rows: 4, placeholder: 'Jelaskan fitur unik properti Anda, minimal 20 karakter...', required: true });
            const descTextarea = descFieldContainer.querySelector('textarea');

            const aiButtonContainer = document.createElement('div');
            aiButtonContainer.className = 'mt-2 flex items-center gap-2';
            const aiButton = ButtonComponent({
                textContent: isGeneratingDesc ? 'Menghasilkan...' : ' ',
                type: 'button', variant: 'ghost', size: 'sm', className: 'text-xs',
                leftIcon: isGeneratingDesc ? SpinnerComponent({ size: 'sm', colorClass: 'border-primary dark:border-primary-light' }) : null,
                disabled: isGeneratingDesc || geminiApiKey === GEMINI_API_KEY_PLACEHOLDER || geminiApiKey === "DISABLED",
                title: (geminiApiKey === GEMINI_API_KEY_PLACEHOLDER || geminiApiKey === "DISABLED") ? "Layanan AI tidak tersedia (cek API Key)" : "Gunakan AI untuk membuat deskripsi",
                onClick: async () => {
                    if (appState.propertyFormModal.isGeneratingDesc) return;
                    appState.propertyFormModal.isGeneratingDesc = true;
                    renderApp(); // Re-render untuk update tombol & spinner

                    const desc = await generatePropertyDescriptionWithGemini({ type: formData.type, bedrooms: formData.bedrooms, bathrooms: formData.bathrooms });
                    formData.description = desc; // Update formData internal

                    // Cari textarea terbaru di DOM (karena modal bisa dirender ulang)
                    const currentTextareaInDOM = document.getElementById(descTextarea.id);
                    if (currentTextareaInDOM) currentTextareaInDOM.value = desc;

                    appState.propertyFormModal.isGeneratingDesc = false;
                    appState.propertyFormModal.errors = validatePropertyForm(formData, formElements); // Validasi setelah AI mengisi
                    if (appState.propertyFormModal.isOpen) renderApp();
                }
            });
            aiButtonContainer.appendChild(aiButton);
            descFieldContainer.appendChild(aiButtonContainer);
            form.appendChild(descFieldContainer);

            // Footer untuk tombol aksi modal
            const modalFooter = [
                ButtonComponent({ textContent: 'Batal', type: 'button', variant: 'ghost', onClick: closePropertyFormModal }),
                ButtonComponent({ textContent: propertyToEdit ? 'Simpan Perubahan' : 'Tambah Properti', type: 'submit', variant: 'primary' })
            ];


            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const validationErrors = validatePropertyForm(formData, formElements);
                appState.propertyFormModal.errors = validationErrors;

                if (Object.keys(validationErrors).length > 0) {
                    renderApp(); // Re-render untuk menampilkan semua error
                    // Fokus ke field pertama yang error
                    const firstErrorKey = Object.keys(validationErrors)[0];
                    if (formElements[firstErrorKey]) {
                        formElements[firstErrorKey].focus();
                    }
                    return;
                }

                const propertyData = {
                    ...formData,
                    id: propertyToEdit?.id || `prop_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`,
                    imageUrl: propertyToEdit?.imageUrl || formData.imageUrl, // Gunakan imageUrl dari form jika ada, atau yang lama
                    ownerId: CURRENT_USER_ID,
                    rentPrice: parseFloat(formData.rentPrice) || 0, // Pastikan numerik
                    bedrooms: parseInt(formData.bedrooms) || 0,
                    bathrooms: parseFloat(formData.bathrooms) || 0,
                };
                updateGlobalProperty(propertyData);
                closePropertyFormModal();
            });

            const modalTitle = propertyToEdit ? 'Edit Properti' : 'Tambah Properti Baru';
            currentPropertyFormModal = ModalComponent({
                isOpen: true,
                onClose: closePropertyFormModal,
                title: modalTitle,
                size: 'lg', // Modal lebih besar untuk form
                children: form,
                footerContent: modalFooter
            });
            return currentPropertyFormModal;
        }


        function PropertyManagementWidgetComponent() {
            const ownerProperties = appState.properties.filter(p => p.ownerId === CURRENT_USER_ID);

            const content = document.createElement('div');
            if (ownerProperties.length === 0) {
                const emptyStateDiv = document.createElement('div');
                emptyStateDiv.className = 'text-center py-8';
                const emptyText = document.createElement('p');
                emptyText.className = 'text-text-muted text-lg mb-4';
                emptyText.textContent = "Anda belum memiliki properti yang terdaftar.";
                emptyStateDiv.appendChild(emptyText);
                emptyStateDiv.appendChild(ButtonComponent({
                    textContent: 'Daftarkan Properti Pertama Anda',
                    leftIcon: PlusIcon(),
                    onClick: () => openPropertyFormModal(null),
                    variant: 'primary'
                }));
                content.appendChild(emptyStateDiv);
            } else {
                const listDiv = document.createElement('div');
                listDiv.className = 'space-y-3'; // Jarak antar item
                ownerProperties.forEach(prop => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'p-4 bg-slate-50 dark:bg-slate-700-opacity-50 rounded-lg shadow-sm flex flex-col sm-flex-row justify-between items-start sm-items-center hover-shadow-md transition-shadow duration-200';

                    const infoDiv = document.createElement('div');
                    infoDiv.className = 'mb-3 sm-mb-0 flex-grow min-w-0 mr-4'; // min-w-0 untuk truncate
                    const nameH4 = document.createElement('h4');
                    nameH4.className = 'font-semibold text-lg text-text-default truncate';
                    nameH4.textContent = prop.name;
                    nameH4.title = prop.name;
                    infoDiv.appendChild(nameH4);
                    const detailsP = document.createElement('p');
                    detailsP.className = 'text-sm text-text-muted truncate';
                    detailsP.textContent = `${prop.address} - Status: ${prop.status}`;
                    detailsP.title = `${prop.address} - Status: ${prop.status}`;
                    infoDiv.appendChild(detailsP);
                    itemDiv.appendChild(infoDiv);

                    const actionsDiv = document.createElement('div');
                    actionsDiv.className = 'flex space-x-2 self-end sm-self-center flex-shrink-0';
                    actionsDiv.appendChild(ButtonComponent({
                        textContent: 'Edit', size: 'sm', variant: 'ghost',
                        leftIcon: PencilIcon('w-4 h-4'),
                        onClick: () => openPropertyFormModal(prop.id)
                    }));
                    actionsDiv.appendChild(ButtonComponent({
                        textContent: 'Hapus', size: 'sm', variant: 'ghost', className: 'text-red-500 hover-bg-red-500 hover-text-white',
                        leftIcon: TrashIcon('w-4 h-4'),
                        onClick: () => {
                            if (confirm(`Apakah Anda yakin ingin menghapus properti "${prop.name}"? Tindakan ini tidak dapat diurungkan.`)) {
                                deleteGlobalProperty(prop.id);
                            }
                        }
                    }));
                    itemDiv.appendChild(actionsDiv);
                    listDiv.appendChild(itemDiv);
                });
                content.appendChild(listDiv);
            }

            return DashboardSectionComponent({
                title: 'Manajemen Properti Saya',
                actionButton: ownerProperties.length > 0 ? ButtonComponent({ textContent: 'Tambah Baru', leftIcon: PlusIcon('w-4 h-4 mr-1'), onClick: () => openPropertyFormModal(null) }) : null,
                children: content
            });
        }

        function IncomeReportWidgetComponent() {
            const totalIncome = mockIncomeData.reduce((sum, item) => sum + item.amount, 0);
            const currentMonthIncome = mockIncomeData.length > 0 ? mockIncomeData[mockIncomeData.length - 1].amount : 0;

            const container = document.createElement('div');

            const statsGrid = document.createElement('div');
            statsGrid.className = 'grid grid-cols-1 md-grid-cols-2 gap-6 mb-8';

            const createStatCard = (title, amount, variant = 'primary', subtext = '') => {
                const card = document.createElement('div');
                const bgColorClass = variant === 'primary' ? 'bg-primary-opacity-10 dark:bg-primary-opacity-20' : 'bg-secondary-opacity-10 dark:bg-secondary-opacity-20';
                const textColorClass = variant === 'primary' ? 'text-primary dark:text-primary-light' : 'text-secondary dark:text-secondary-light';

                card.className = `p-6 ${bgColorClass} rounded-xl shadow-md`; // Shadow lebih halus

                const titleH4 = document.createElement('h4');
                titleH4.className = `text-sm font-medium ${textColorClass} uppercase tracking-wider`;
                titleH4.textContent = title;
                card.appendChild(titleH4);

                const amountP = document.createElement('p');
                amountP.className = `text-4xl font-bold ${textColorClass} mt-1`; // Ukuran amount lebih besar
                amountP.textContent = `$${Number(amount).toLocaleString('id-ID')}`;
                card.appendChild(amountP);

                if (subtext) {
                    const subtextP = document.createElement('p');
                    subtextP.className = `text-xs ${textColorClass} opacity-75 mt-1`;
                    subtextP.textContent = subtext;
                    card.appendChild(subtextP);
                }
                return card;
            };
            statsGrid.appendChild(createStatCard('Pendapatan Bulan Ini', currentMonthIncome, 'primary', `Untuk bulan ${mockIncomeData.length > 0 ? mockIncomeData[mockIncomeData.length - 1].month : '-'}`));
            statsGrid.appendChild(createStatCard('Total Pendapatan (YTD)', totalIncome, 'secondary', 'Akumulasi sejak awal tahun'));
            container.appendChild(statsGrid);

            const trendTitle = document.createElement('h3');
            trendTitle.className = 'text-xl font-semibold mb-4 text-text-default font-display';
            trendTitle.textContent = 'Tren Pendapatan Bulanan';
            container.appendChild(trendTitle);

            const chartOuterContainer = document.createElement('div');
            chartOuterContainer.className = 'simple-chart-bar-container';

            const chartDiv = document.createElement('div');
            chartDiv.className = 'simple-chart-bars';
            const maxAmount = Math.max(...mockIncomeData.map(d => d.amount), 1); // Hindari pembagian dengan nol

            mockIncomeData.forEach(item => {
                const barWrapper = document.createElement('div');
                barWrapper.className = 'simple-chart-bar-wrapper group'; // Group untuk hover tooltip

                const bar = document.createElement('div');
                const barHeight = maxAmount > 0 ? (item.amount / maxAmount) * 90 : 0; // Max 90% agar tidak full, sisakan ruang untuk nilai
                bar.style.height = `${Math.max(barHeight, 5)}%`; // Minimal height agar bar selalu terlihat
                bar.className = 'simple-chart-bar';

                // Tooltip/nilai di atas bar
                const valueSpan = document.createElement('span');
                valueSpan.className = 'simple-chart-bar-value';
                valueSpan.textContent = `$${item.amount.toLocaleString('id-ID')}`;
                bar.appendChild(valueSpan); // Masukkan ke dalam bar, CSS akan posisikan
                barWrapper.appendChild(bar);


                const label = document.createElement('div');
                label.className = 'simple-chart-label';
                label.textContent = item.month;
                barWrapper.appendChild(label);
                chartDiv.appendChild(barWrapper);
            });
            chartOuterContainer.appendChild(chartDiv);
            container.appendChild(chartOuterContainer);

            return DashboardSectionComponent({ title: 'Laporan Pendapatan', children: container });
        }


        // --- 8. Fungsi Komponen Halaman (Views) ---
        let currentPropertyDetailModal = null; // Untuk referensi modal detail

        function HomePageComponent() {
            const pageContainer = document.createElement('div');
            pageContainer.className = 'space-y-12 md-space-y-16 lg-space-y-20'; // Jarak antar section

            // Hero Section
            const heroSection = document.createElement('section');
            heroSection.className = 'text-center py-12 md-py-16 lg-py-20 bg-gradient-to-br from-primary-opacity-10 to-secondary-opacity-10 dark:from-primary-opacity-5 dark:to-secondary-opacity-5 rounded-2xl shadow-inner animate-fade-in';
            // Background gradien dinamis berdasarkan tema
            if (currentTheme === Theme.LIGHT) {
                heroSection.style.background = `linear-gradient(135deg, rgba(var(--color-primary-default-val), 0.07) 0%, rgba(var(--color-secondary-default-val), 0.07) 100%)`;
            } else {
                heroSection.style.background = `linear-gradient(135deg, rgba(var(--color-primary-light-val), 0.03) 0%, rgba(var(--color-secondary-light-val), 0.03) 100%)`;
            }

            const heroTitle = document.createElement('h1');
            heroTitle.className = 'text-4xl sm-text-5xl lg-text-6xl font-extrabold font-display text-primary dark:text-primary-light mb-6 leading-tight';
            heroTitle.innerHTML = `Temukan <span class="text-secondary dark:text-secondary-light">Hunian Impian</span> Anda di Green Valley`;
            heroSection.appendChild(heroTitle);

            const heroSubtitle = document.createElement('p');
            heroSubtitle.className = 'text-lg md-text-xl text-text-muted max-w-3xl mx-auto px-4 mb-8';
            heroSubtitle.textContent = 'Jelajahi beragam pilihan properti eksklusif. Dari apartemen modern hingga rumah keluarga yang nyaman, semua dirancang untuk gaya hidup berkualitas Anda.';
            heroSection.appendChild(heroSubtitle);

            const heroButton = ButtonComponent({
                textContent: 'Jelajahi Properti Sekarang',
                size: 'lg',
                variant: 'primary',
                className: 'mt-8 animate-bounce-slow', // Efek bounce halus
                onClick: () => {
                    const propertiesSectionEl = document.getElementById('available-properties-section');
                    if (propertiesSectionEl) {
                        propertiesSectionEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }
            });
            heroSection.appendChild(heroButton);
            pageContainer.appendChild(heroSection);

            // Properties Section
            const propertiesSection = document.createElement('section');
            propertiesSection.id = 'available-properties-section';
            propertiesSection.setAttribute('aria-labelledby', 'properties-title');
            const sectionTitle = document.createElement('h2');
            sectionTitle.id = 'properties-title';
            sectionTitle.className = 'text-3xl md-text-4xl font-bold font-display mb-8 md-mb-12 text-text-default text-center';
            sectionTitle.textContent = 'Properti Terbaik Untuk Anda';
            propertiesSection.appendChild(sectionTitle);
            propertiesSection.appendChild(PropertyListComponent(appState.properties.filter(p => p.status === 'Tersedia'), openPropertyDetailModal));
            pageContainer.appendChild(propertiesSection);

            return pageContainer;
        }

        function DashboardPageComponent() {
            const pageContainer = document.createElement('div');
            pageContainer.className = 'space-y-8 animate-fade-in'; // Animasi masuk untuk seluruh halaman dasbor
            const titleH1 = document.createElement('h1');
            titleH1.className = 'text-3xl md-text-4xl font-bold font-display text-text-default mb-2'; // Judul halaman lebih besar
            titleH1.textContent = 'Dasbor Pengelola Properti';
            pageContainer.appendChild(titleH1);

            pageContainer.appendChild(PropertyManagementWidgetComponent());
            pageContainer.appendChild(IncomeReportWidgetComponent());

            return pageContainer;
        }

        function NotificationsPageComponent() {
            const pageContainer = document.createElement('div');
            pageContainer.className = 'animate-fade-in';
            const titleH1 = document.createElement('h1');
            titleH1.className = 'text-3xl md-text-4xl font-bold font-display mb-8 text-text-default';
            titleH1.textContent = 'Notifikasi Terbaru';
            pageContainer.appendChild(titleH1);
            pageContainer.appendChild(NotificationListComponent(appState.notifications));
            return pageContainer;
        }

        // --- Helper State Modal ---
        function openPropertyDetailModal(propertyId) {
            appState.selectedPropertyModal = { isOpen: true, propertyId };
            renderApp();
        }
        function closePropertyDetailModal() {
            appState.selectedPropertyModal = { isOpen: false, propertyId: null };
            renderApp(); // Ini akan memanggil cleanup modal via ModalComponent
        }
        function openPropertyFormModal(propertyIdToEdit = null) {
            appState.propertyFormModal = { isOpen: true, propertyToEditId: propertyIdToEdit, isGeneratingDesc: false, errors: {} };
            renderApp();
        }
        function closePropertyFormModal() {
            appState.propertyFormModal = { isOpen: false, propertyToEditId: null, isGeneratingDesc: false, errors: {} };
            renderApp();
        }

        // --- 9. Logika Router SPA ---
        function navigateTo(path) {
            if (window.location.hash !== `#${path}`) {
                window.location.hash = path; // Ini akan trigger hashchange event
            } else {
                // Jika hash sama tapi perlu render ulang (misal state internal berubah)
                handleHashChange(true); // Force re-render
            }
        }

        function handleHashChange(forceRender = false) {
            const path = window.location.hash.replace(/^#\/?/, '') || 'home';
            const newPage = path.split('/')[0]; // Ambil bagian utama path untuk halaman

            if (appState.currentPage !== newPage || forceRender) {
                appState.currentPage = newPage;
                window.scrollTo(0, 0); // Scroll ke atas setiap pindah halaman
                renderApp();
            }
        }


        // --- 10. Fungsi Render Utama Aplikasi ---
        const appRoot = document.getElementById('app-root');
        let headerElement = null;
        let mainContentContainer = null;
        let footerElement = null;
        let globalModalsContainer = null; // Kontainer untuk modal global

        function renderApp() {
            // 1. Terapkan tema (sudah dilakukan di awal, tapi pastikan konsisten)
            // applyTheme(currentTheme); // Tidak perlu dipanggil lagi di sini jika sudah benar di awal

            // 2. Render/Update Header
            const newHeader = HeaderComponent();
            if (!headerElement) {
                appRoot.appendChild(newHeader);
            } else {
                headerElement.replaceWith(newHeader);
            }
            headerElement = newHeader;

            // 3. Render/Update Main Content Area
            if (!mainContentContainer) {
                mainContentContainer = document.createElement('main');
                mainContentContainer.className = 'flex-grow container mx-auto px-4 sm-px-6 lg-px-8 py-8 md-py-12';
                // Sisipkan setelah header atau sebelum footer jika sudah ada
                if (footerElement) appRoot.insertBefore(mainContentContainer, footerElement);
                else appRoot.appendChild(mainContentContainer);
            }
            mainContentContainer.innerHTML = ''; // Bersihkan konten utama sebelum render baru

            let pageComponent;
            switch (appState.currentPage) {
                case 'home': pageComponent = HomePageComponent(); break;
                case 'dashboard': pageComponent = DashboardPageComponent(); break;
                case 'notifications': pageComponent = NotificationsPageComponent(); break;
                default: // Halaman 404
                    pageComponent = document.createElement('div');
                    pageComponent.className = 'text-center py-16 animate-fade-in';
                    pageComponent.innerHTML = `
                        <h1 class="text-6xl font-black font-display text-primary dark:text-primary-light mb-4">404</h1>
                        <p class="text-2xl text-text-default font-semibold mb-2">Oops! Halaman Tidak Ditemukan</p>
                        <p class="text-lg text-text-muted mb-8">Maaf, halaman yang Anda cari sepertinya tersesat di lembah hijau.</p>
                        <a href="#home" onclick="event.preventDefault(); navigateTo('home');" class="button-base button-primary button-sz-lg">Kembali ke Beranda</a>`;
            }
            mainContentContainer.appendChild(pageComponent);

            // 4. Render/Update Footer
            if (!footerElement) {
                footerElement = FooterComponent();
                appRoot.appendChild(footerElement);
            } else {
                // Footer biasanya statis, tapi jika perlu update (misal tahun, bisa di sini)
                // const newFooter = FooterComponent();
                // footerElement.replaceWith(newFooter);
                // footerElement = newFooter;
            }

            // 5. Render Modals Global
            // Buat kontainer modal jika belum ada, pastikan selalu di akhir body untuk z-index
            if (!globalModalsContainer) {
                globalModalsContainer = document.createElement('div');
                globalModalsContainer.id = 'global-modals-container';
                document.body.appendChild(globalModalsContainer);
            }
            globalModalsContainer.innerHTML = ''; // Bersihkan modal lama

            // Modal Detail Properti
            if (appState.selectedPropertyModal.isOpen && appState.selectedPropertyModal.propertyId) {
                const property = appState.properties.find(p => p.id === appState.selectedPropertyModal.propertyId);
                if (property) {
                    const modalContentEl = document.createElement('div');
                    modalContentEl.className = 'space-y-4'; // Jarak antar item di modal

                    const img = document.createElement('img');
                    img.src = property.imageUrl;
                    img.alt = `Interior menawan dari ${property.name}`;
                    img.className = 'w-full h-64 object-cover rounded-lg mb-4 shadow-md';
                    modalContentEl.appendChild(img);

                    const createDetailItem = (label, value) => {
                        const p = document.createElement('p');
                        p.className = 'text-text-default text-sm md-text-base';
                        const strong = document.createElement('strong');
                        strong.className = 'text-text-muted font-medium';
                        strong.textContent = `${label}: `;
                        p.appendChild(strong);
                        p.appendChild(document.createTextNode(value));
                        return p;
                    };
                    modalContentEl.appendChild(createDetailItem('Alamat Lengkap', property.address));
                    modalContentEl.appendChild(createDetailItem('Tipe Properti', property.type));
                    modalContentEl.appendChild(createDetailItem('Kamar Tidur', `${property.bedrooms} unit`));
                    modalContentEl.appendChild(createDetailItem('Kamar Mandi', `${property.bathrooms} unit`));
                    modalContentEl.appendChild(createDetailItem('Harga Sewa', `$${Number(property.rentPrice).toLocaleString('id-ID')}/bulan`));

                    const descTitle = document.createElement('h4');
                    descTitle.className = 'text-md font-semibold text-text-muted mt-4 pt-3 border-t border-border';
                    descTitle.textContent = 'Deskripsi Lengkap:';
                    modalContentEl.appendChild(descTitle);
                    const descP = document.createElement('p');
                    descP.className = 'text-text-default whitespace-pre-line text-sm md-text-base'; // `whitespace-pre-line` untuk format baris baru
                    descP.textContent = property.description;
                    modalContentEl.appendChild(descP);

                    const modalFooter = [ButtonComponent({ textContent: 'Tutup', onClick: closePropertyDetailModal, variant: 'primary' })];

                    currentPropertyDetailModal = ModalComponent({
                        isOpen: true,
                        onClose: closePropertyDetailModal,
                        title: property.name,
                        size: 'lg',
                        children: modalContentEl,
                        footerContent: modalFooter
                    });
                    if (currentPropertyDetailModal) globalModalsContainer.appendChild(currentPropertyDetailModal);
                }
            }

            // Modal Form Properti
            if (appState.propertyFormModal.isOpen) {
                // PropertyFormModalComponent akan mengembalikan elemen modal yang sudah jadi
                currentPropertyFormModal = PropertyFormModalComponent();
                if (currentPropertyFormModal) globalModalsContainer.appendChild(currentPropertyFormModal);
            }
        }

        // --- 11. Inisialisasi Aplikasi ---
        window.addEventListener('hashchange', () => handleHashChange());
        document.addEventListener('DOMContentLoaded', () => {
            applyTheme(currentTheme, true); // Terapkan tema awal saat DOM siap
            handleHashChange(true); // Render halaman awal berdasarkan hash atau default, paksa render
        });

    </script>
</body>

</html>