<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ApertureFind - Dashboard Admin</title>
    <meta name="description"
        content="Dashboard administrasi modern untuk manajemen apartemen, pembayaran, dan penyewa dengan desain yang fancy dan intuitif." />
    <meta name="keywords"
        content="dashboard, admin, apartemen, manajemen, ApertureFind, vanilla js, spa, fancy design" />
    <meta name="author" content="Tim Developer Handal (Direvisi dan Dikembangkan oleh AI Canggih)" />
    <!-- Favicon menggunakan karakter Unicode (Gedung Kantor) sebagai data URI PNG sederhana untuk menghindari SVG -->
    <link rel="icon"
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAACQAAAAAQAAAJAAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAABCgAwAEAAAAAQAAABAAAAA63UA3AAAAaklEQVQ4EWP8//8/AwgwMjLWASCa/Q8WIIB4GoAbQDYHSAXCABpxAGz5AKQEAKSeA+I5ID4D8UEgmgsgBmB7AHErmGUAVhvgOYE3AHE3gLEfSKcB8SYQX0E8BcS3gHgcxH8OBhVwB8QLAKGNDzQqAELRAAAAAElFTkSuQmCC" />

    <!-- Font Awesome Icons (Online Gratis) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Chart.js (Library Grafik Eksternal yang Diizinkan untuk visualisasi data canggih) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Gaya Utama Aplikasi -->
    <style>
        /*=============================================
=               VARIABEL CSS GLOBAL             =
=============================================*/
        :root {
            /* Skema Warna Dasar (Mode Terang) - Layer Warna */
            --primary-color-rgb: 99, 102, 241;
            /* Indigo 500 RGB */
            --primary-color: #6366f1;
            /* Indigo 500 */
            --primary-color-hover: #4f46e5;
            /* Indigo 600 */
            --primary-color-light: #e0e7ff;
            /* Indigo 100 */
            --primary-color-lighter: #eef2ff;
            /* Indigo 50 */
            --primary-color-dark-text: #4338ca;
            /* Indigo 700 - Teks di atas bg terang primary */

            --secondary-color-rgb: 16, 185, 129;
            /* Emerald 500 RGB */
            --secondary-color: #10b981;
            /* Emerald 500 */
            --secondary-color-hover: #059669;
            /* Emerald 600 */
            --secondary-color-light: #d1fae5;
            /* Emerald 100 */

            --accent-color-rgb: 245, 158, 11;
            /* Amber 500 RGB */
            --accent-color: #f59e0b;
            /* Amber 500 */
            --accent-color-hover: #d97706;
            /* Amber 600 */
            --accent-color-light: #fef3c7;
            /* Amber 100 */

            --danger-color-rgb: 239, 68, 68;
            /* Red 500 RGB */
            --danger-color: #ef4444;
            /* Red 500 */
            --danger-color-hover: #dc2626;
            /* Red 600 */
            --danger-color-light: #fee2e2;
            /* Red 100 */

            --success-color-rgb: 34, 197, 94;
            /* Green 500 RGB */
            --success-color: #22c55e;
            /* Green 500 */
            --success-color-light: #dcfce7;
            /* Green 100 */
            --success-color-hover: #16a34a;
            /* Green 600 */

            --warning-color-rgb: 234, 179, 8;
            /* Yellow 500 RGB */
            --warning-color: #eab308;
            /* Yellow 500 */
            --warning-color-light: #fef9c3;
            /* Yellow 100 */
            --warning-color-hover: #ca8a04;
            /* Yellow 600 */

            --info-color-rgb: 59, 130, 246;
            /* Blue 500 RGB */
            --info-color: #3b82f6;
            /* Blue 500 */
            --info-color-light: #dbeafe;
            /* Blue 100 */
            --info-color-hover: #2563eb;
            /* Blue 600 */

            --bg-color: #f8fafc;
            /* Slate 50 - Background utama aplikasi */
            --bg-color-alt: #ffffff;
            /* White - Background alternatif (mis. kartu di atas bg utama) */
            --text-color: #1e293b;
            /* Slate 800 - Teks utama */
            --text-color-muted: #64748b;
            /* Slate 500 - Teks sekunder, sub-judul */
            --text-color-subtle: #94a3b8;
            /* Slate 400 - Teks placeholder, hint */
            --text-color-on-primary: #ffffff;
            /* Teks di atas warna primer solid */
            --text-color-on-secondary: #ffffff;
            /* Teks di atas warna sekunder solid */

            --border-color: #e2e8f0;
            /* Slate 200 - Border umum */
            --border-color-strong: #cbd5e1;
            /* Slate 300 - Border yang lebih tegas */
            --border-color-rgb: 226, 232, 240;
            /* Slate 200 RGB - untuk alpha di dark mode table */

            --card-bg-color: #ffffff;
            /* Background kartu */
            --card-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.07), 0 1px 2px -1px rgba(0, 0, 0, 0.05);
            --card-shadow-hover: 0 4px 12px -1px rgba(0, 0, 0, 0.08), 0 2px 8px -2px rgba(0, 0, 0, 0.06);
            --input-bg-color: #f1f5f9;
            /* Slate 100 - Background input field */
            --input-border-color: var(--border-color-strong);
            --focus-ring-color: rgba(var(--primary-color-rgb), 0.3);
            /* Warna ring fokus */

            /* Tipografi - Layer Tipografi */
            --font-family-sans: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            --font-size-base: 1rem;
            /* 16px default */
            --font-size-xs: 0.75rem;
            /* 12px */
            --font-size-sm: 0.875rem;
            /* 14px */
            --font-size-lg: 1.125rem;
            /* 18px */
            --font-size-xl: 1.25rem;
            /* 20px */
            --font-size-2xl: 1.5rem;
            /* 24px */
            --font-size-3xl: 1.875rem;
            /* 30px */
            --font-size-4xl: 2.25rem;
            /* 36px */
            --font-weight-light: 300;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;
            --line-height-normal: 1.65;
            --line-height-tight: 1.3;
            --line-height-snug: 1.5;

            /* Border Radius - Layer Bentuk */
            --border-radius-sm: 0.25rem;
            /* 4px */
            --border-radius-md: 0.5rem;
            /* 8px */
            --border-radius-lg: 0.75rem;
            /* 12px */
            --border-radius-xl: 1rem;
            /* 16px */
            --border-radius-full: 9999px;

            /* Spasi (menggunakan kelipatan 4px) - Layer Spasi */
            --spacing-unit: 0.25rem;
            /* 4px sebagai unit dasar */
            --spacing-px: 1px;
            --spacing-0: 0;
            --spacing-1: calc(1 * var(--spacing-unit));
            /* 4px */
            --spacing-2: calc(2 * var(--spacing-unit));
            /* 8px */
            --spacing-3: calc(3 * var(--spacing-unit));
            /* 12px */
            --spacing-4: calc(4 * var(--spacing-unit));
            /* 16px */
            --spacing-5: calc(5 * var(--spacing-unit));
            /* 20px */
            --spacing-6: calc(6 * var(--spacing-unit));
            /* 24px */
            --spacing-8: calc(8 * var(--spacing-unit));
            /* 32px */
            --spacing-10: calc(10 * var(--spacing-unit));
            /* 40px */
            --spacing-12: calc(12 * var(--spacing-unit));
            /* 48px */

            /* Transisi - Layer Animasi */
            --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);

            /* Layout - Layer Struktur */
            --max-width-container: 1320px;
            /* Sedikit lebih lebar untuk kesan modern */
            --header-height: 68px;
            --sidebar-width-desktop: 260px;
            --sidebar-width-collapsed: 80px;
            --footer-height: 80px;
            /* Perkiraan tinggi footer */
            --offcanvas-width: 320px;
            /* Lebar default off-canvas */
        }

        /* Skema Warna Mode Gelap */
        [data-theme="dark"] {
            --primary-color-rgb: 129, 140, 248;
            /* Indigo 400 RGB */
            --primary-color: #818cf8;
            /* Indigo 400 */
            --primary-color-hover: #a5b4fc;
            /* Indigo 300 */
            --primary-color-light: #3730a3;
            /* Indigo 800 */
            --primary-color-lighter: #4338ca;
            /* Indigo 700 (Disesuaikan agar lebih terang dari light di dark mode) */
            --primary-color-dark-text: #c7d2fe;
            /* Indigo 200 (Teks terang di atas BG primary) */

            --secondary-color-rgb: 52, 211, 153;
            /* Emerald 400 RGB */
            --secondary-color: #34d399;
            /* Emerald 400 */
            --secondary-color-hover: #6ee7b7;
            /* Emerald 300 */
            --secondary-color-light: #065f46;
            /* Emerald 800 */

            --accent-color-rgb: 251, 191, 36;
            /* Amber 400 RGB */
            --accent-color: #fbbf24;
            /* Amber 400 */
            --accent-color-hover: #fcd34d;
            /* Amber 300 */
            --accent-color-light: #78350f;
            /* Amber 800 */

            --danger-color-rgb: 248, 113, 113;
            /* Red 400 RGB */
            --danger-color: #f87171;
            /* Red 400 */
            --danger-color-hover: #fca5a5;
            /* Red 300 */
            --danger-color-light: #7f1d1d;
            /* Red 800 */

            --success-color-rgb: 74, 222, 128;
            /* Green 400 RGB */
            --success-color: #4ade80;
            /* Green 400 */
            --success-color-light: #166534;
            /* Green 800 */
            --success-color-hover: #86efac;
            /* Green 300 */

            --warning-color-rgb: 250, 204, 21;
            /* Yellow 400 RGB */
            --warning-color: #facc15;
            /* Yellow 400 */
            --warning-color-light: #713f12;
            /* Yellow 800 */
            --warning-color-hover: #fde047;
            /* Yellow 300 */

            --info-color-rgb: 96, 165, 250;
            /* Blue 400 RGB */
            --info-color: #60a5fa;
            /* Blue 400 */
            --info-color-light: #1e40af;
            /* Blue 800 */
            --info-color-hover: #93c5fd;
            /* Blue 300 */

            --bg-color: #0f172a;
            /* Slate 900 */
            --bg-color-alt: #1e293b;
            /* Slate 800 */
            --text-color: #e2e8f0;
            /* Slate 200 */
            --text-color-muted: #94a3b8;
            /* Slate 400 */
            --text-color-subtle: #64748b;
            /* Slate 500 */
            --text-color-on-primary: #0f172a;
            /* Teks gelap di atas warna primer terang (mis. primary color di dark mode) */
            --text-color-on-secondary: #0f172a;

            --border-color: #334155;
            /* Slate 700 */
            --border-color-strong: #475569;
            /* Slate 600 */
            --border-color-rgb: 51, 65, 85;
            /* Slate 700 RGB */

            --card-bg-color: var(--bg-color-alt);
            --input-bg-color: #334155;
            /* Slate 700 */
            --input-border-color: var(--border-color-strong);
            --focus-ring-color: rgba(var(--primary-color-rgb), 0.4);
            --card-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.2), 0 1px 2px -1px rgba(0, 0, 0, 0.15);
            --card-shadow-hover: 0 4px 12px -1px rgba(0, 0, 0, 0.25), 0 2px 8px -2px rgba(0, 0, 0, 0.20);
        }

        /*=============================================
=            RESET DASAR & GAYA GLOBAL        =
=============================================*/
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            border-width: 0;
            border-style: solid;
            border-color: var(--border-color);
        }

        html {
            font-size: 100%;
            scroll-behavior: smooth;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: var(--font-family-sans);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-normal);
            line-height: var(--line-height-normal);
            color: var(--text-color);
            background-color: var(--bg-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color var(--transition-normal), color var(--transition-normal);
            overflow-x: hidden;
            /* Mencegah scroll horizontal yang tidak diinginkan */
        }

        body.no-scroll {
            overflow-y: hidden;
            /* Mencegah scroll saat modal/overlay aktif */
        }

        #app-shell {
            display: flex;
            flex-grow: 1;
            position: relative;
            overflow-x: hidden;
            /* Penting untuk SPA layout */
        }

        #main-area-wrapper {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            width: 100%;
            /* Akan disesuaikan JS untuk margin sidebar */
            transition: margin-left var(--transition-normal), width var(--transition-normal);
            min-height: 100vh;
            /* Memastikan footer selalu di bawah */
            background-color: var(--bg-color);
            /* Memastikan background wrapper konsisten */
            position: relative;
            /* Untuk flash messages */
        }

        img,
        picture,
        video,
        canvas {
            display: block;
            max-width: 100%;
            height: auto;
        }

        input,
        button,
        textarea,
        select {
            font: inherit;
            outline: none;
            /* Dikelola :focus-visible */
        }

        button {
            cursor: pointer;
            background: none;
            color: inherit;
            padding: 0;
            /* Reset padding default button */
            -webkit-appearance: none;
            appearance: none;
        }

        a {
            text-decoration: none;
            color: var(--primary-color);
            transition: color var(--transition-fast);
        }

        a:hover {
            color: var(--primary-color-hover);
            text-decoration: underline;
        }

        ul,
        ol {
            list-style: none;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-weight: var(--font-weight-semibold);
            line-height: var(--line-height-tight);
            color: var(--text-color);
            margin-top: 0;
            /* Hapus margin atas default browser */
            letter-spacing: -0.02em;
            /* Sedikit kerning untuk judul */
        }

        h1 {
            font-size: var(--font-size-3xl);
            margin-bottom: var(--spacing-6);
        }

        h2 {
            font-size: var(--font-size-2xl);
            margin-bottom: var(--spacing-5);
        }

        h3 {
            font-size: var(--font-size-xl);
            margin-bottom: var(--spacing-4);
        }

        h4 {
            font-size: var(--font-size-lg);
            margin-bottom: var(--spacing-3);
        }

        p {
            line-height: var(--line-height-snug);
            margin-bottom: var(--spacing-4);
        }

        p:last-child {
            margin-bottom: 0;
        }

        /* Fokus Universal (Aksesibilitas) */
        *:focus-visible {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
            box-shadow: 0 0 0 4px var(--focus-ring-color);
            border-radius: var(--border-radius-sm);
            z-index: 1001;
            /* Di atas elemen lain, tapi di bawah sidebar/header jika perlu */
        }

        /* Untuk input/textarea/select agar border berubah warna juga saat fokus */
        input:focus-visible,
        textarea:focus-visible,
        select:focus-visible {
            border-color: var(--primary-color) !important;
            /* Overwrite border-color dari .form-control */
        }


        /*=============================================
=            LAYOUT CONTAINER             =
=============================================*/
        .container {
            width: 100%;
            max-width: var(--max-width-container);
            margin-left: auto;
            margin-right: auto;
            padding-left: var(--spacing-6);
            padding-right: var(--spacing-6);
        }

        @media (max-width: 767.98px) {

            /* Mobile */
            .container {
                padding-left: var(--spacing-4);
                padding-right: var(--spacing-4);
            }
        }

        /*=============================================
=               UTILITY CLASSES               =
=============================================*/
        /* Display */
        .d-none {
            display: none !important;
        }

        .d-block {
            display: block !important;
        }

        .d-inline {
            display: inline !important;
        }

        .d-inline-block {
            display: inline-block !important;
        }

        .d-flex {
            display: flex !important;
        }

        .d-grid {
            display: grid !important;
        }

        /* Flexbox */
        .flex-column {
            flex-direction: column !important;
        }

        .flex-row {
            flex-direction: row !important;
        }

        .justify-start {
            justify-content: flex-start !important;
        }

        .justify-end {
            justify-content: flex-end !important;
        }

        .justify-center {
            justify-content: center !important;
        }

        .justify-between {
            justify-content: space-between !important;
        }

        .justify-around {
            justify-content: space-around !important;
        }

        .align-start {
            align-items: flex-start !important;
        }

        .align-end {
            align-items: flex-end !important;
        }

        .align-center {
            align-items: center !important;
        }

        .align-stretch {
            align-items: stretch !important;
        }

        .flex-wrap {
            flex-wrap: wrap !important;
        }

        .flex-nowrap {
            flex-wrap: nowrap !important;
        }

        .flex-grow-1 {
            flex-grow: 1 !important;
        }

        /* Gap (untuk flex/grid) */
        .gap-1 {
            gap: var(--spacing-1);
        }

        .gap-2 {
            gap: var(--spacing-2);
        }

        .gap-3 {
            gap: var(--spacing-3);
        }

        .gap-4 {
            gap: var(--spacing-4);
        }

        .gap-6 {
            gap: var(--spacing-6);
        }

        .gap-8 {
            gap: var(--spacing-8);
        }

        /* Text Alignment */
        .text-center {
            text-align: center !important;
        }

        .text-left {
            text-align: left !important;
        }

        .text-right {
            text-align: right !important;
        }

        /* Sizing */
        .w-full {
            width: 100% !important;
        }

        .h-full {
            height: 100% !important;
        }

        /* Margin */
        .m-0 {
            margin: var(--spacing-0) !important;
        }

        .mt-auto {
            margin-top: auto !important;
        }

        .mt-1 {
            margin-top: var(--spacing-1) !important;
        }

        .mb-1 {
            margin-bottom: var(--spacing-1) !important;
        }

        .ml-1 {
            margin-left: var(--spacing-1) !important;
        }

        .mr-1 {
            margin-right: var(--spacing-1) !important;
        }

        .mt-2 {
            margin-top: var(--spacing-2) !important;
        }

        .mb-2 {
            margin-bottom: var(--spacing-2) !important;
        }

        .ml-2 {
            margin-left: var(--spacing-2) !important;
        }

        .mr-2 {
            margin-right: var(--spacing-2) !important;
        }

        .mt-3 {
            margin-top: var(--spacing-3) !important;
        }

        .mb-3 {
            margin-bottom: var(--spacing-3) !important;
        }

        .mt-4 {
            margin-top: var(--spacing-4) !important;
        }

        .mb-4 {
            margin-bottom: var(--spacing-4) !important;
        }

        .mt-6 {
            margin-top: var(--spacing-6) !important;
        }

        .mb-6 {
            margin-bottom: var(--spacing-6) !important;
        }

        .mt-8 {
            margin-top: var(--spacing-8) !important;
        }

        .mb-8 {
            margin-bottom: var(--spacing-8) !important;
        }

        /* Padding */
        .p-0 {
            padding: var(--spacing-0) !important;
        }

        .p-1 {
            padding: var(--spacing-1) !important;
        }

        .py-1 {
            padding-top: var(--spacing-1) !important;
            padding-bottom: var(--spacing-1) !important;
        }

        .px-1 {
            padding-left: var(--spacing-1) !important;
            padding-right: var(--spacing-1) !important;
        }

        .p-2 {
            padding: var(--spacing-2) !important;
        }

        .py-2 {
            padding-top: var(--spacing-2) !important;
            padding-bottom: var(--spacing-2) !important;
        }

        .px-2 {
            padding-left: var(--spacing-2) !important;
            padding-right: var(--spacing-2) !important;
        }

        .p-3 {
            padding: var(--spacing-3) !important;
        }

        .py-3 {
            padding-top: var(--spacing-3) !important;
            padding-bottom: var(--spacing-3) !important;
        }

        .px-3 {
            padding-left: var(--spacing-3) !important;
            padding-right: var(--spacing-3) !important;
        }

        .p-4 {
            padding: var(--spacing-4) !important;
        }

        .py-4 {
            padding-top: var(--spacing-4) !important;
            padding-bottom: var(--spacing-4) !important;
        }

        .px-4 {
            padding-left: var(--spacing-4) !important;
            padding-right: var(--spacing-4) !important;
        }

        .p-6 {
            padding: var(--spacing-6) !important;
        }

        .py-6 {
            padding-top: var(--spacing-6) !important;
            padding-bottom: var(--spacing-6) !important;
        }

        .px-6 {
            padding-left: var(--spacing-6) !important;
            padding-right: var(--spacing-6) !important;
        }

        /* Border Radius */
        .rounded-sm {
            border-radius: var(--border-radius-sm);
        }

        .rounded-md {
            border-radius: var(--border-radius-md);
        }

        .rounded-lg {
            border-radius: var(--border-radius-lg);
        }

        .rounded-xl {
            border-radius: var(--border-radius-xl);
        }

        .rounded-full {
            border-radius: var(--border-radius-full);
        }

        /* Shadows */
        .shadow-sm {
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        .shadow-md {
            box-shadow: var(--card-shadow);
        }

        .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }

        .shadow-xl {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -4px rgba(0, 0, 0, 0.25);
        }

        [data-theme="dark"] .shadow-xl {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 8px 10px -6px rgba(0, 0, 0, 0.25);
        }

        /* Text Color */
        .text-primary {
            color: var(--primary-color) !important;
        }

        .text-secondary {
            color: var(--secondary-color) !important;
        }

        .text-accent {
            color: var(--accent-color) !important;
        }

        .text-muted {
            color: var(--text-color-muted) !important;
        }

        .text-subtle {
            color: var(--text-color-subtle) !important;
        }

        .text-danger {
            color: var(--danger-color) !important;
        }

        .text-success {
            color: var(--success-color) !important;
        }

        .text-white {
            color: #ffffff !important;
        }

        .text-black {
            color: #000000 !important;
        }

        /* Font Weight */
        .fw-light {
            font-weight: var(--font-weight-light) !important;
        }

        .fw-normal {
            font-weight: var(--font-weight-normal) !important;
        }

        .fw-medium {
            font-weight: var(--font-weight-medium) !important;
        }

        .fw-semibold {
            font-weight: var(--font-weight-semibold) !important;
        }

        .fw-bold {
            font-weight: var(--font-weight-bold) !important;
        }

        /* Font Size */
        .fs-xs {
            font-size: var(--font-size-xs) !important;
        }

        .fs-sm {
            font-size: var(--font-size-sm) !important;
        }

        .fs-base {
            font-size: var(--font-size-base) !important;
        }

        .fs-lg {
            font-size: var(--font-size-lg) !important;
        }

        .fs-xl {
            font-size: var(--font-size-xl) !important;
        }

        /* Screen Reader Only */
        .sr-only {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            padding: 0 !important;
            margin: -1px !important;
            overflow: hidden !important;
            clip: rect(0, 0, 0, 0) !important;
            white-space: nowrap !important;
            border-width: 0 !important;
        }

        /* Responsive Display Utilities */
        @media (max-width: 575.98px) {

            /* Extra small devices (portrait phones, less than 576px) */
            .d-xs-none {
                display: none !important;
            }
        }

        @media (max-width: 767.98px) {

            /* Small devices (landscape phones, less than 768px) */
            .d-sm-none {
                display: none !important;
            }
        }

        @media (max-width: 991.98px) {

            /* Medium devices (tablets, less than 992px) */
            .d-md-none {
                display: none !important;
            }

            .d-md-block {
                display: block !important;
            }
        }

        @media (max-width: 1199.98px) {

            /* Large devices (desktops, less than 1200px) */
            .d-lg-none {
                display: none !important;
            }
        }

        @media (min-width: 992px) {

            /* Hanya muncul di desktop besar */
            .d-lg-block {
                display: block !important;
            }
        }


        /*=============================================
=            KOMPONEN SIDEBAR                 =
=============================================*/
        .app-sidebar {
            width: var(--sidebar-width-desktop);
            background-color: var(--card-bg-color);
            border-right-width: 1px;
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1100;
            /* Di atas overlay */
            transition: transform var(--transition-normal), width var(--transition-normal), box-shadow var(--transition-normal);
            overflow-y: auto;
            padding-bottom: var(--spacing-4);
            box-shadow: var(--card-shadow);
        }

        .sidebar-header {
            padding: var(--spacing-4);
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
            border-bottom-width: 1px;
            height: var(--header-height);
            flex-shrink: 0;
            position: sticky;
            /* Agar header sidebar tetap terlihat saat scroll */
            top: 0;
            background-color: var(--card-bg-color);
            /* Untuk menutupi konten di bawah saat scroll */
            z-index: 1;
            /* Di atas nav-list */
        }

        .sidebar-logo-icon {
            font-size: var(--font-size-2xl);
            color: var(--primary-color);
            transition: transform var(--transition-fast);
        }

        .sidebar-header:hover .sidebar-logo-icon {
            transform: rotate(-5deg) scale(1.1);
        }

        .sidebar-logo-text {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--text-color);
            transition: opacity var(--transition-fast);
            white-space: nowrap;
            /* Cegah teks logo wrap */
        }

        .sidebar-logo-highlight {
            color: var(--primary-color);
            font-weight: var(--font-weight-bold);
        }

        .sidebar-profile {
            padding: var(--spacing-4);
            border-bottom-width: 1px;
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
            flex-shrink: 0;
            transition: opacity var(--transition-fast), padding var(--transition-fast);
        }

        .sidebar-profile-img {
            width: 48px;
            height: 48px;
            border-radius: var(--border-radius-full);
            object-fit: cover;
            border: 3px solid var(--primary-color-light);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform var(--transition-fast), border-color var(--transition-fast);
        }

        .sidebar-profile:hover .sidebar-profile-img {
            transform: scale(1.05);
            border-color: var(--primary-color);
        }

        .sidebar-profile-info {
            white-space: nowrap;
            /* Cegah teks wrap */
            overflow: hidden;
            /* Sembunyikan teks yang berlebih */
        }

        .sidebar-profile-info .name {
            font-weight: var(--font-weight-semibold);
            color: var(--text-color);
            display: block;
            font-size: var(--font-size-base);
        }

        .sidebar-profile-info .role {
            font-size: var(--font-size-sm);
            color: var(--text-color-muted);
        }

        .sidebar-nav {
            flex-grow: 1;
            padding: var(--spacing-2) 0;
        }

        .sidebar-nav .nav-list {
            display: flex;
            flex-direction: column;
        }

        .sidebar-nav .nav-link {
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
            padding: var(--spacing-3) var(--spacing-4);
            color: var(--text-color-muted);
            font-weight: var(--font-weight-medium);
            transition: color var(--transition-fast), background-color var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast);
            text-decoration: none;
            border-left: 4px solid transparent;
            margin: var(--spacing-1) var(--spacing-3);
            border-radius: var(--border-radius-md);
            position: relative;
            white-space: nowrap;
            /* Cegah teks wrap */
            overflow: hidden;
            /* Sembunyikan teks berlebih */
        }

        .sidebar-nav .nav-link i {
            width: 20px;
            text-align: center;
            font-size: var(--font-size-lg);
            flex-shrink: 0;
            color: var(--text-color-subtle);
            transition: color var(--transition-fast), transform var(--transition-fast);
        }

        .sidebar-nav .nav-link .nav-text {
            transition: opacity var(--transition-fast), transform var(--transition-fast);
            white-space: nowrap;
            /* Pastikan tidak wrap */
        }

        .sidebar-nav .nav-link:hover {
            background-color: var(--primary-color-lighter);
            color: var(--primary-color-dark-text);
            /* Lebih jelas di hover */
            transform: translateX(3px);
            /* Efek geser kecil */
        }

        .sidebar-nav .nav-link:hover i {
            color: var(--primary-color);
            transform: scale(1.1);
        }

        .sidebar-nav .nav-link.active {
            color: var(--primary-color-dark-text);
            background-color: var(--primary-color-light);
            border-left-color: var(--primary-color);
            font-weight: var(--font-weight-semibold);
        }

        .sidebar-nav .nav-link.active i {
            color: var(--primary-color);
        }

        .sidebar-nav .nav-link .badge {
            margin-left: auto;
            background-color: var(--primary-color);
            color: var(--text-color-on-primary);
            font-size: var(--font-size-xs);
            padding: 2px var(--spacing-1);
            border-radius: var(--border-radius-full);
            font-weight: var(--font-weight-bold);
            line-height: 1;
            min-width: 20px;
            text-align: center;
            transition: opacity var(--transition-fast), transform var(--transition-fast);
        }

        [data-theme="dark"] .sidebar-nav .nav-link .badge {
            background-color: var(--primary-color-dark-text);
            color: var(--primary-color);
            /* Teks primary (terang di dark) di atas badge yang juga primary (sesuaikan jika perlu) */
        }


        /* Dark mode specific for sidebar nav links */
        [data-theme="dark"] .sidebar-nav .nav-link:hover {
            background-color: var(--primary-color-lighter);
            /* Warna lebih gelap di mode gelap */
            color: var(--primary-color);
            /* Teks utama di hover */
        }

        [data-theme="dark"] .sidebar-nav .nav-link.active {
            color: var(--primary-color-dark-text);
            /* Teks terang di bg aktif */
            background-color: rgba(var(--primary-color-rgb), 0.25);
            /* Transparan primary */
            border-left-color: var(--primary-color);
        }

        [data-theme="dark"] .sidebar-nav .nav-link:hover i,
        [data-theme="dark"] .sidebar-nav .nav-link.active i {
            color: var(--primary-color);
        }


        /* Sidebar Collapsed State (Desktop/Tablet) */
        .app-sidebar.collapsed {
            width: var(--sidebar-width-collapsed);
        }

        .app-sidebar.collapsed .sidebar-logo-text,
        .app-sidebar.collapsed .sidebar-profile-info,
        .app-sidebar.collapsed .nav-link .nav-text,
        .app-sidebar.collapsed .nav-link .badge {
            opacity: 0;
            width: 0;
            /* Penting untuk collapse total */
            overflow: hidden;
            pointer-events: none;
            /* Agar tidak bisa diinteraksi */
        }

        .app-sidebar.collapsed .sidebar-header,
        .app-sidebar.collapsed .sidebar-profile {
            justify-content: center;
            padding-left: 0;
            /* Hapus padding samping */
            padding-right: 0;
        }

        .app-sidebar.collapsed .sidebar-profile-img {
            margin: 0 auto;
            /* Pusatkan gambar profil */
        }

        .app-sidebar.collapsed .nav-link {
            justify-content: center;
            /* Pusatkan ikon */
            padding: var(--spacing-3);
            /* Padding seragam */
            margin: var(--spacing-1) var(--spacing-2);
            /* Margin lebih kecil */
            border-left-color: transparent !important;
            /* Hapus border kiri aktif */
        }

        .app-sidebar.collapsed .nav-link:hover {
            transform: none;
            /* Hapus efek geser */
        }

        .app-sidebar.collapsed .nav-link.active {
            background-color: var(--primary-color-light);
            /* BG aktif lebih jelas */
        }

        [data-theme="dark"] .app-sidebar.collapsed .nav-link.active {
            background-color: rgba(var(--primary-color-rgb), 0.25);
        }

        .app-sidebar.collapsed .nav-link i {
            margin-right: 0;
            /* Hapus margin kanan ikon */
        }


        /* Sidebar Mobile State */
        @media (max-width: 767.98px) {
            .app-sidebar {
                transform: translateX(-100%);
                /* Sembunyikan di luar layar */
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.15), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            }

            .app-sidebar.open {
                transform: translateX(0);
                /* Munculkan */
            }

            #main-area-wrapper {
                /* Pastikan konten utama tidak terpengaruh margin sidebar di mobile */
                margin-left: 0 !important;
                width: 100% !important;
            }

            /* Overlay untuk sidebar mobile (sudah ada di CSS, pastikan tampilannya benar) */
            .sidebar-overlay {
                /* Ini adalah overlay spesifik untuk sidebar saat mobile, berbeda dengan generic app-overlay */
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(15, 23, 42, 0.5);
                /* Warna overlay (Slate 900 dengan opacity) */
                z-index: 1099;
                /* Di bawah sidebar, di atas konten lain */
                opacity: 0;
                visibility: hidden;
                transition: opacity var(--transition-normal), visibility var(--transition-normal);
                /* backdrop-filter: blur(2px); /* Efek blur (opsional, bisa berat) */
            }

            .sidebar-overlay.active {
                opacity: 1;
                visibility: visible;
            }

            [data-theme="dark"] .sidebar-overlay {
                background-color: rgba(0, 0, 0, 0.6);
            }
        }

        /* Sidebar Desktop/Tablet State (Pengaruh ke Konten Utama) */
        @media (min-width: 768px) {
            #main-area-wrapper {
                /* Default: sidebar open */
                margin-left: var(--sidebar-width-desktop);
                width: calc(100% - var(--sidebar-width-desktop));
            }

            .app-sidebar.collapsed~#main-area-wrapper {
                /* Jika sidebar collapsed */
                margin-left: var(--sidebar-width-collapsed);
                width: calc(100% - var(--sidebar-width-collapsed));
            }
        }


        /*=============================================
=            KOMPONEN HEADER APLIKASI         =
=============================================*/
        .app-header {
            background-color: var(--card-bg-color);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03), 0 2px 4px rgba(0, 0, 0, 0.03);
            padding: 0 var(--spacing-4);
            /* Padding horizontal untuk header */
            height: var(--header-height);
            display: flex;
            align-items: center;
            position: sticky;
            /* Header tetap di atas saat scroll */
            top: 0;
            z-index: 1000;
            transition: background-color var(--transition-normal), box-shadow var(--transition-normal);
            width: 100%;
        }

        .header-container {
            /* Kontainer internal untuk header */
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            /* max-width: var(--max-width-container); Batasi lebar jika perlu, namun biasanya header full-width mengikuti main-area-wrapper */
            margin: 0 auto;
            /* padding: 0 var(--spacing-2); Padding internal kecil (Dihapus karena sudah ada padding di .app-header dan .container di konten) */
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
        }

        .sidebar-toggle-btn,
        .theme-toggle-btn-header {
            /* Tombol toggle sidebar dan tema di header */
            background-color: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-color-muted);
            width: 42px;
            /* Ukuran tombol seragam */
            height: 42px;
            border-radius: var(--border-radius-full);
            /* Bulat penuh */
            display: inline-flex;
            /* Untuk pusatkan ikon */
            justify-content: center;
            align-items: center;
            font-size: var(--font-size-lg);
            transition: var(--transition-fast), transform var(--transition-fast);
        }

        .sidebar-toggle-btn:hover,
        .theme-toggle-btn-header:hover {
            background-color: var(--primary-color-lighter);
            border-color: var(--primary-color-light);
            color: var(--primary-color);
            transform: translateY(-1px) scale(1.05);
            /* Efek hover subtil */
        }

        .sidebar-toggle-btn:active,
        .theme-toggle-btn-header:active {
            transform: translateY(0px) scale(1);
            /* Efek tekan */
        }

        [data-theme="dark"] .sidebar-toggle-btn,
        [data-theme="dark"] .theme-toggle-btn-header {
            border-color: var(--border-color-strong);
        }

        [data-theme="dark"] .sidebar-toggle-btn:hover,
        [data-theme="dark"] .theme-toggle-btn-header:hover {
            background-color: var(--bg-color-alt);
            /* Seharusnya var(--bg-color), tapi var(--bg-color-alt) sering jadi bg card */
            border-color: var(--border-color);
            color: var(--primary-color);
        }

        .app-header__search-wrapper {
            position: relative;
            margin-right: var(--spacing-2);
            /* Jarak dari tombol lain */
        }

        .app-header__search-input {
            padding: var(--spacing-2) var(--spacing-3) var(--spacing-2) calc(var(--spacing-2) + var(--spacing-6));
            /* Ruang untuk ikon */
            border: 1px solid var(--input-border-color);
            border-radius: var(--border-radius-lg);
            /* Radius lebih besar untuk kesan modern */
            background-color: var(--input-bg-color);
            color: var(--text-color);
            min-width: 250px;
            /* Lebar minimum */
            transition: border-color var(--transition-fast), background-color var(--transition-fast), box-shadow var(--transition-fast);
            font-size: var(--font-size-sm);
        }

        .app-header__search-input:focus {
            /* Fokus sudah ditangani :focus-visible global dan input:focus-visible */
            border-color: var(--primary-color);
            background-color: var(--card-bg-color);
            /* BG jadi putih saat fokus */
            box-shadow: 0 0 0 3px var(--focus-ring-color);
            /* Ring fokus standar */
        }

        .app-header__search-icon {
            position: absolute;
            left: var(--spacing-3);
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-color-muted);
            pointer-events: none;
            /* Agar ikon tidak mengganggu klik input */
        }

        @media (max-width: 991.98px) {

            /* Sembunyikan search bar di tablet ke bawah */
            .app-header__search-wrapper {
                display: none;
            }
        }


        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
        }

        /* Wrapper untuk tombol notifikasi agar badge bisa diposisikan */
        .notification-btn-wrapper {
            position: relative;
        }

        .header-actions .badge {
            /* Badge di tombol notifikasi header */
            background-color: var(--danger-color);
            color: white;
            font-size: var(--font-size-xs);
            padding: 3px 6px;
            border-radius: var(--border-radius-full);
            font-weight: var(--font-weight-bold);
            line-height: 1;
            min-width: 20px;
            text-align: center;
            position: absolute;
            top: -6px;
            right: -8px;
            border: 2px solid var(--card-bg-color);
            /* Border agar terlihat terpisah dari ikon */
            pointer-events: none;
            /* Badge tidak bisa diklik */
        }


        /*=============================================
=            KONTEN UTAMA & LOADER            =
=============================================*/
        .main-content {
            flex-grow: 1;
            padding: var(--spacing-6) var(--spacing-4);
            transition: opacity 0.3s ease-in-out;
            background-color: var(--bg-color);
            /* Background konten utama */
            min-height: calc(100vh - var(--header-height) - var(--footer-height));
            /* Pastikan konten mengisi ruang */
        }

        @media (min-width: 768px) {

            /* Padding lebih besar di desktop */
            .main-content {
                padding: var(--spacing-8) var(--spacing-6);
            }
        }

        .page-container {
            animation: fadeInPage 0.4s cubic-bezier(0.215, 0.610, 0.355, 1.000);
            /* Animasi masuk halaman */
        }

        @keyframes fadeInPage {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Loader untuk konten halaman (bukan initial loader) */
        .loader-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 300px;
            text-align: center;
            padding: var(--spacing-6);
        }

        .loader {
            /* Desain loader baru, lebih fancy */
            width: 50px;
            height: 50px;
            border-radius: 50%;
            position: relative;
            animation: spinLoader 1s linear infinite;
        }

        .loader::before,
        .loader::after {
            content: "";
            position: absolute;
            border-radius: 50%;
        }

        .loader::before {
            width: 100%;
            height: 100%;
            background-image: linear-gradient(90deg, var(--primary-color) 50%, transparent 50%);
            animation: spinLoaderPart1 2s linear infinite;
            /* Animasi bagian warna */
        }

        .loader::after {
            /* Bagian tengah untuk efek donat */
            width: 80%;
            height: 80%;
            background-color: var(--bg-color);
            /* Sesuaikan dengan background konten */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        [data-theme="dark"] .loader::after {
            /* Warna tengah loader di mode gelap */
            background-color: var(--bg-color);
        }

        @keyframes spinLoader {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes spinLoaderPart1 {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(720deg);
            }
        }


        /* Initial Loader (Full Screen) */
        .initial-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            z-index: 9999;
            /* Paling atas */
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            opacity: 1;
            visibility: visible;
            transition: opacity 0.5s ease-out 0.2s, visibility 0.5s ease-out 0.2s;
            /* Transisi fade out */
        }

        .initial-loader .loader {
            /* Loader lebih besar untuk initial load */
            width: 70px;
            height: 70px;
        }

        [data-theme="dark"] .initial-loader .loader::after {
            background-color: var(--bg-color);
        }

        .initial-loader p {
            margin-top: var(--spacing-6);
            color: var(--text-color-muted);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-medium);
            animation: pulseText 1.5s infinite alternate;
            /* Teks berdenyut */
        }

        @keyframes pulseText {
            from {
                opacity: 0.7;
            }

            to {
                opacity: 1;
            }
        }

        /*=============================================
=               KOMPONEN KARTU (CARD)          =
=============================================*/
        .card {
            background-color: var(--card-bg-color);
            border-radius: var(--border-radius-lg);
            /* Radius lebih besar */
            box-shadow: var(--card-shadow);
            padding: var(--spacing-6);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
            border-width: 1px;
            overflow: hidden;
            /* Mencegah konten keluar dari radius */
        }

        .card:hover {
            transform: translateY(-4px);
            /* Efek angkat sedikit */
            box-shadow: var(--card-shadow-hover);
        }

        .card-header {
            /* Margin negatif untuk menempel ke tepi card jika padding card ada */
            margin: calc(-1 * var(--spacing-6)) calc(-1 * var(--spacing-6)) var(--spacing-5) calc(-1 * var(--spacing-6));
            padding: var(--spacing-4) var(--spacing-6);
            border-bottom-width: 1px;
            background-color: transparent;
            /* Default transparan, bisa dioverride */
        }

        [data-theme="dark"] .card-header {
            /* Sedikit beda di dark mode jika perlu */
            background-color: transparent;
        }

        .card-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--spacing-1);
            /* Margin kecil jika ada subtitle */
        }

        .card-subtitle {
            font-size: var(--font-size-sm);
            color: var(--text-color-muted);
            margin-top: calc(-1 * var(--spacing-1));
            /* Menempel ke title */
            display: block;
        }

        .card-body {
            font-size: var(--font-size-base);
        }

        .card-footer {
            margin: var(--spacing-5) calc(-1 * var(--spacing-6)) calc(-1 * var(--spacing-6)) calc(-1 * var(--spacing-6));
            padding: var(--spacing-4) var(--spacing-6);
            border-top-width: 1px;
            background-color: transparent;
            display: flex;
            justify-content: flex-end;
            /* Default aksi di kanan */
            gap: var(--spacing-3);
        }

        [data-theme="dark"] .card-footer {
            background-color: transparent;
        }

        /* Variasi Card dengan Border Kiri */
        .card.card-border-left {
            padding-left: calc(var(--spacing-6) + 6px);
            /* Ruang untuk border */
            border-left-width: 6px;
            border-left-style: solid;
            border-top-left-radius: var(--border-radius-sm);
            /* Radius disesuaikan */
            border-bottom-left-radius: var(--border-radius-sm);
        }

        .card-info.card-border-left {
            border-left-color: var(--info-color);
        }

        .card-success.card-border-left {
            border-left-color: var(--success-color);
        }

        .card-warning.card-border-left {
            border-left-color: var(--warning-color);
        }

        .card-danger.card-border-left {
            border-left-color: var(--danger-color);
        }


        /*=============================================
=               KOMPONEN TOMBOL (BUTTON)      =
=============================================*/
        .btn {
            display: inline-flex;
            /* Agar ikon dan teks sejajar */
            align-items: center;
            justify-content: center;
            gap: var(--spacing-2);
            /* Jarak antara ikon dan teks */
            padding: var(--spacing-2) var(--spacing-4);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            border-radius: var(--border-radius-md);
            border-width: 1px;
            /* Border default, warna dari varian */
            transition: var(--transition-fast), transform var(--transition-fast);
            text-decoration: none;
            /* Hapus underline dari <a> yang jadi tombol */
            line-height: 1.5;
            user-select: none;
            /* Cegah seleksi teks di tombol */
            white-space: nowrap;
            /* Cegah teks tombol wrap */
        }

        .btn:focus-visible {
            /* Styling fokus khusus untuk tombol agar tidak bentrok dengan card */
            outline: 2px solid transparent;
            outline-offset: 2px;
            box-shadow: 0 0 0 3px var(--card-bg-color), 0 0 0 5px var(--primary-color);
        }

        .btn:hover {
            transform: translateY(-2px);
            /* Efek angkat */
            text-decoration: none;
            /* Tetap tanpa underline saat hover */
        }

        .btn:active {
            transform: translateY(0px) scale(0.98);
            /* Efek tekan */
        }

        .btn i,
        .btn .fas,
        .btn .far,
        .btn .fab {
            /* Styling ikon di dalam tombol */
            font-size: 1.05em;
            /* Ikon sedikit lebih besar dari teks */
            line-height: 1;
            /* Jaga agar ikon tidak mengacaukan tinggi baris */
        }

        /* Tombol Primary */
        .btn-primary {
            background-color: var(--primary-color);
            color: var(--text-color-on-primary);
            border-color: var(--primary-color);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            /* Shadow subtil */
        }

        .btn-primary:hover {
            background-color: var(--primary-color-hover);
            border-color: var(--primary-color-hover);
            color: var(--text-color-on-primary);
            /* Pastikan teks tetap kontras */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.07), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        [data-theme="dark"] .btn-primary {
            color: var(--text-color-on-primary);
            /* Sesuaikan jika warna primer dark mode sangat terang */
        }

        [data-theme="dark"] .btn-primary:hover {
            color: var(--text-color-on-primary);
        }

        /* Tombol Secondary */
        .btn-secondary {
            background-color: var(--secondary-color);
            color: var(--text-color-on-secondary);
            border-color: var(--secondary-color);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .btn-secondary:hover {
            background-color: var(--secondary-color-hover);
            border-color: var(--secondary-color-hover);
            color: var(--text-color-on-secondary);
        }

        /* Tombol Outline Primary */
        .btn-outline-primary {
            background-color: transparent;
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-outline-primary:hover {
            background-color: var(--primary-color-lighter);
            color: var(--primary-color-dark-text);
            /* Teks jadi lebih gelap */
        }

        [data-theme="dark"] .btn-outline-primary {
            color: var(--primary-color);
            /* Teks tetap primary di dark mode */
        }

        [data-theme="dark"] .btn-outline-primary:hover {
            background-color: rgba(var(--primary-color-rgb), 0.1);
            /* BG transparan primary */
            color: var(--primary-color);
        }

        /* Tombol Outline Secondary (Contoh Tambahan) */
        .btn-outline-secondary {
            background-color: transparent;
            color: var(--text-color-muted);
            border-color: var(--border-color-strong);
        }

        .btn-outline-secondary:hover {
            background-color: var(--bg-color);
            color: var(--text-color);
            border-color: var(--border-color);
        }

        [data-theme="dark"] .btn-outline-secondary {
            color: var(--text-color-subtle);
            border-color: var(--border-color);
        }

        [data-theme="dark"] .btn-outline-secondary:hover {
            background-color: var(--bg-color-alt);
            color: var(--text-color-muted);
            border-color: var(--border-color-strong);
        }


        /* Tombol Danger */
        .btn-danger {
            background-color: var(--danger-color);
            color: var(--text-color-on-primary);
            border-color: var(--danger-color);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .btn-danger:hover {
            background-color: var(--danger-color-hover);
            border-color: var(--danger-color-hover);
            color: var(--text-color-on-primary);
        }

        /* Tombol Success */
        .btn-success {
            background-color: var(--success-color);
            color: var(--text-color-on-primary);
            border-color: var(--success-color);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .btn-success:hover {
            background-color: var(--success-color-hover);
            border-color: var(--success-color-hover);
            color: var(--text-color-on-primary);
        }

        /* Tombol Info */
        .btn-info {
            background-color: var(--info-color);
            color: var(--text-color-on-primary);
            border-color: var(--info-color);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .btn-info:hover {
            background-color: var(--info-color-hover);
            border-color: var(--info-color-hover);
            color: var(--text-color-on-primary);
        }

        /* Tombol Warning */
        .btn-warning {
            background-color: var(--warning-color);
            color: var(--text-color);
            /* Biasanya teks gelap di atas BG kuning */
            border-color: var(--warning-color);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .btn-warning:hover {
            background-color: var(--warning-color-hover);
            border-color: var(--warning-color-hover);
            color: var(--text-color);
        }


        /* Ukuran Tombol */
        .btn-sm {
            padding: var(--spacing-1) var(--spacing-3);
            font-size: var(--font-size-sm);
        }

        .btn-lg {
            padding: var(--spacing-3) var(--spacing-6);
            font-size: var(--font-size-lg);
        }

        /* Tombol Block (Lebar Penuh) */
        .btn-block {
            width: 100%;
            display: flex;
            /* Pastikan justify-content center bekerja */
        }

        /* Tombol Icon Saja */
        .btn-icon-only {
            padding: var(--spacing-2);
            width: calc(var(--font-size-base) * 1.5 + var(--spacing-2) * 2 + 2px);
            /* Hitung lebar berdasarkan font + padding */
            height: calc(var(--font-size-base) * 1.5 + var(--spacing-2) * 2 + 2px);
            gap: 0;
        }

        .btn-icon-only i {
            margin: 0;
            /* Hapus margin jika ada */
            font-size: 1.2em;
            /* Ikon sedikit lebih besar */
        }


        /*=============================================
=                KOMPONEN FORMULIR            =
=============================================*/
        .form-group {
            margin-bottom: var(--spacing-5);
        }

        .form-label {
            display: block;
            font-weight: var(--font-weight-medium);
            margin-bottom: var(--spacing-2);
            color: var(--text-color);
            font-size: var(--font-size-sm);
        }

        .form-control {
            display: block;
            width: 100%;
            padding: var(--spacing-2) var(--spacing-3);
            font-size: var(--font-size-base);
            line-height: 1.5;
            color: var(--text-color);
            background-color: var(--input-bg-color);
            background-clip: padding-box;
            border-width: 1px;
            border-color: var(--input-border-color);
            appearance: none;
            /* Hapus tampilan default browser */
            border-radius: var(--border-radius-md);
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast), background-color var(--transition-fast);
        }

        .form-control:focus {
            /* Fokus sudah ditangani oleh :focus-visible dan input:focus-visible */
            border-color: var(--primary-color);
            outline: 0;
            box-shadow: 0 0 0 3px var(--focus-ring-color);
            background-color: var(--card-bg-color);
            /* BG jadi putih saat fokus */
        }

        .form-control::placeholder {
            color: var(--text-color-subtle);
            opacity: 1;
            /* Firefox butuh ini */
        }

        textarea.form-control {
            min-height: calc(1.5em * 4 + (var(--spacing-2) * 2) + 2px);
            /* Tinggi default sekitar 4 baris */
            resize: vertical;
            /* Hanya izinkan resize vertikal */
        }

        /* Ukuran Form Control Kecil (sm) */
        .form-control-sm {
            padding: var(--spacing-1) var(--spacing-2);
            font-size: var(--font-size-sm);
            border-radius: var(--border-radius-sm);
        }


        /* Styling untuk Select (Dropdown) */
        .select-wrapper {
            /* Wrapper untuk menempatkan ikon panah */
            position: relative;
        }

        select.form-control {
            padding-right: var(--spacing-10);
            /* Ruang untuk ikon panah */
            /* appearance: none; sudah di .form-control */
        }

        .select-wrapper::after {
            /* Ikon panah kustom */
            content: "\f078";
            /* Font Awesome chevron-down */
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            /* Solid icon */
            position: absolute;
            top: 50%;
            right: var(--spacing-3);
            transform: translateY(-50%);
            pointer-events: none;
            /* Agar tidak mengganggu klik select */
            color: var(--text-color-muted);
            font-size: var(--font-size-sm);
            transition: transform var(--transition-fast), color var(--transition-fast);
        }

        /* Select Small Size Adjustment */
        .select-wrapper select.form-control-sm {
            padding-right: var(--spacing-8);
            /* Ruang ikon lebih kecil untuk select-sm */
        }

        .select-wrapper select.form-control-sm+ ::after {
            /* Untuk select sm */
            right: var(--spacing-2);
            font-size: calc(var(--font-size-sm) * 0.85);
            /* Ikon lebih kecil */
        }

        .select-wrapper select.form-control:focus+ ::after,
        /* Ini tidak akan bekerja karena ::after di wrapper */
        .select-wrapper:focus-within::after {
            /* Saat select di dalam wrapper fokus */
            transform: translateY(-50%) rotate(180deg);
            /* Panah berputar saat fokus */
            color: var(--primary-color);
        }

        [data-theme="dark"] .select-wrapper::after {
            color: var(--text-color-subtle);
        }


        /* Kustom Checkbox dan Radio */
        .form-check {
            display: flex;
            /* Menggunakan flex agar lebih mudah alignment */
            align-items: center;
            gap: var(--spacing-2);
            margin-bottom: var(--spacing-3);
            position: relative;
            /* Untuk posisi pseudo-elements */
        }

        .form-check-input {
            /* Sembunyikan input asli */
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
            cursor: pointer;
        }

        .form-check-label {
            font-weight: var(--font-weight-normal);
            color: var(--text-color);
            cursor: pointer;
            font-size: var(--font-size-base);
            display: inline-flex;
            /* Agar label dan custom box sejajar */
            align-items: center;
            gap: var(--spacing-2);
            /* Jarak antara custom box dan teks label */
            padding-left: calc(1.5em + var(--spacing-1));
            /* Ruang untuk custom box */
            min-height: 1.5em;
            /* Pastikan tinggi cukup */
            position: relative;
            /* Untuk ::before dan ::after */
        }

        .form-check-label::before {
            /* Custom box */
            content: "";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 1.25em;
            /* Ukuran custom box */
            height: 1.25em;
            border: 2px solid var(--input-border-color);
            background-color: var(--input-bg-color);
            border-radius: var(--border-radius-sm);
            /* Kotak untuk checkbox */
            transition: var(--transition-fast);
        }

        .form-check-label::after {
            /* Custom checkmark/dot */
            content: "";
            /* Akan diisi oleh varian checkbox/radio */
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            /* Solid icon */
            position: absolute;
            left: 0.275em;
            /* Posisi checkmark di dalam box */
            top: 50%;
            transform: translateY(-50%) scale(0);
            /* Sembunyikan defaultnya */
            transition: transform var(--transition-fast) ease-in-out;
            color: var(--text-color-on-primary);
            /* Warna checkmark */
            font-size: 0.7em;
            /* Ukuran checkmark */
        }

        .form-check-input[type="checkbox"]+.form-check-label::after {
            content: "\f00c";
            /* Font Awesome check */
        }

        .form-check-input[type="radio"]+.form-check-label::before {
            border-radius: 50%;
            /* Lingkaran untuk radio */
        }

        .form-check-input[type="radio"]+.form-check-label::after {
            content: "\f111";
            /* Font Awesome circle (solid) - sebagai dot */
            font-size: 0.5em;
            /* Dot lebih kecil */
            left: 0.375em;
            /* Posisi dot di tengah */
        }

        .form-check-input:checked+.form-check-label::before {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .form-check-input:checked+.form-check-label::after {
            transform: translateY(-50%) scale(1);
            /* Tampilkan checkmark/dot */
        }

        /* Hover state untuk yang belum checked */
        .form-check-input:not(:checked):hover+.form-check-label::before {
            border-color: var(--primary-color-light);
        }

        [data-theme="dark"] .form-check-input:not(:checked):hover+.form-check-label::before {
            border-color: var(--primary-color);
        }

        /* Focus state (sudah ter-handle oleh :focus-visible pada .form-check-input) */
        .form-check-input:focus-visible+.form-check-label::before {
            outline: 2px solid transparent;
            /* Hapus outline default */
            box-shadow: 0 0 0 3px var(--focus-ring-color);
            /* Gunakan shadow sebagai ring fokus */
            border-color: var(--primary-color);
            /* Pertegas border saat fokus */
        }

        .form-text {
            /* Teks bantuan di bawah input */
            font-size: var(--font-size-sm);
            color: var(--text-color-muted);
            margin-top: var(--spacing-1);
            display: block;
        }


        /*=============================================
=            KOMPONEN ALERT (Enhancement)     =
=============================================*/
        .alert {
            padding: var(--spacing-3) var(--spacing-4);
            margin-bottom: var(--spacing-4);
            border-width: 1px;
            border-radius: var(--border-radius-md);
            display: flex;
            /* Untuk ikon dan teks sejajar */
            align-items: flex-start;
            /* Ikon dan teks mulai dari atas */
            gap: var(--spacing-3);
            /* Jarak antara ikon dan konten */
            font-size: var(--font-size-base);
            line-height: var(--line-height-snug);
            position: relative;
            /* Untuk tombol close */
            box-shadow: var(--shadow-sm);
            /* Shadow halus untuk alert */
        }

        .alert i,
        .alert .fas {
            /* Styling ikon di alert */
            font-size: var(--font-size-lg);
            flex-shrink: 0;
            /* Agar ikon tidak mengecil */
            margin-top: 2px;
            /* Penyesuaian vertikal kecil */
        }

        .alert-content {
            flex-grow: 1;
        }

        .alert-title {
            /* Opsi untuk judul alert */
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--spacing-1);
        }

        /* Alert Dismissible */
        .alert-dismissible {
            padding-right: calc(var(--spacing-4) + var(--spacing-6));
            /* Ruang untuk tombol close */
        }

        .alert-close-btn {
            position: absolute;
            top: var(--spacing-2);
            right: var(--spacing-2);
            background: transparent;
            border: none;
            font-size: var(--font-size-xl);
            color: inherit;
            /* Warna sama dengan teks alert */
            opacity: 0.7;
            padding: var(--spacing-1);
            line-height: 1;
            transition: opacity var(--transition-fast);
        }

        .alert-close-btn:hover {
            opacity: 1;
        }

        .alert-success {
            color: var(--success-color-hover);
            background-color: var(--success-color-light);
            border-color: var(--success-color);
        }

        .alert-success i {
            color: var(--success-color);
        }

        [data-theme="dark"] .alert-success {
            color: var(--text-color);
            background-color: rgba(var(--success-color-rgb), 0.2);
            border-color: var(--success-color);
        }

        .alert-danger {
            color: var(--danger-color-hover);
            background-color: var(--danger-color-light);
            border-color: var(--danger-color);
        }

        .alert-danger i {
            color: var(--danger-color);
        }

        [data-theme="dark"] .alert-danger {
            color: var(--text-color);
            background-color: rgba(var(--danger-color-rgb), 0.2);
            border-color: var(--danger-color);
        }

        .alert-info {
            color: var(--info-color-hover);
            background-color: var(--info-color-light);
            border-color: var(--info-color);
        }

        .alert-info i {
            color: var(--info-color);
        }

        [data-theme="dark"] .alert-info {
            color: var(--text-color);
            background-color: rgba(var(--info-color-rgb), 0.2);
            border-color: var(--info-color);
        }

        .alert-warning {
            color: var(--warning-color-hover);
            background-color: var(--warning-color-light);
            border-color: var(--warning-color);
        }

        .alert-warning i {
            color: var(--warning-color);
        }

        [data-theme="dark"] .alert-warning {
            color: var(--text-color);
            background-color: rgba(var(--warning-color-rgb), 0.2);
            border-color: var(--warning-color);
        }

        /*=============================================
=                 KOMPONEN OVERLAY            =
=============================================*/
        .app-overlay {
            /* Ini overlay generik untuk modal dan offcanvas */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(15, 23, 42, 0.6);
            /* Slate 900 dengan opacity */
            backdrop-filter: blur(3px);
            z-index: 1190;
            /* Di bawah modal/offcanvas tapi di atas konten */
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-normal), visibility var(--transition-normal);
        }

        .app-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        [data-theme="dark"] .app-overlay {
            background-color: rgba(0, 0, 0, 0.7);
            /* Lebih gelap di dark mode */
        }

        /*=============================================
=                 KOMPONEN MODAL              =
=============================================*/
        .modal-wrapper {
            /* Wrapper ini akan menjadi display:flex untuk centering */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1200;
            /* Di atas overlay */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-4);
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            /* Agar tidak menghalangi klik saat hidden */
            transition: opacity var(--transition-normal), visibility var(--transition-normal);
        }

        .modal-wrapper.active {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        .modal {
            background-color: var(--card-bg-color);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            /* Shadow lebih kuat untuk modal */
            max-width: 600px;
            /* Default size 'md' */
            width: 100%;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
            /* Maksimum tinggi modal */
            transform: scale(0.95) translateY(10px);
            transition: transform var(--transition-normal);
            overflow: hidden;
            /* Untuk border-radius di header/footer */
        }

        .modal-wrapper.active .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            padding: var(--spacing-4);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            /* Agar header tidak mengecil */
        }

        .modal-title {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            margin: 0;
        }

        .modal-close-btn {
            background: none;
            border: none;
            font-size: var(--font-size-2xl);
            color: var(--text-color-muted);
            padding: var(--spacing-1);
            line-height: 1;
            opacity: 0.8;
            transition: opacity var(--transition-fast), transform var(--transition-fast);
        }

        .modal-close-btn:hover {
            opacity: 1;
            transform: rotate(90deg);
            color: var(--danger-color);
        }

        .modal-body {
            padding: var(--spacing-6);
            overflow-y: auto;
            /* Scroll jika konten panjang */
            flex-grow: 1;
        }

        .modal-body p:last-child {
            margin-bottom: 0;
        }

        .modal-footer {
            padding: var(--spacing-4);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-3);
            background-color: var(--bg-color);
            /* Footer modal sedikit beda BG */
            flex-shrink: 0;
            /* Agar footer tidak mengecil */
        }

        [data-theme="dark"] .modal-footer {
            background-color: var(--bg-color-alt);
        }


        /*=============================================
=              KOMPONEN OFF-CANVAS            =
=============================================*/
        .offcanvas-panel {
            position: fixed;
            top: 0;
            height: 100%;
            width: var(--offcanvas-width);
            max-width: 90vw;
            /* Agar tidak terlalu lebar di mobile */
            background-color: var(--card-bg-color);
            box-shadow: var(--shadow-xl);
            /* Shadow lebih kuat untuk offcanvas */
            z-index: 1200;
            /* Di atas overlay */
            display: flex;
            flex-direction: column;
            transition: transform var(--transition-normal) cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            /* Mencegah konten keluar dari radius jika ada */
        }

        .offcanvas-panel.active {
            transform: translateX(0);
        }

        .offcanvas-panel--right {
            right: 0;
            border-left: 1px solid var(--border-color);
            transform: translateX(100%);
        }

        .offcanvas-panel--left {
            left: 0;
            border-right: 1px solid var(--border-color);
            transform: translateX(-100%);
        }

        .offcanvas-header {
            padding: var(--spacing-4);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .offcanvas-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            margin: 0;
        }

        .offcanvas-close-btn {
            /* Mirip modal close */
            background: none;
            border: none;
            font-size: var(--font-size-2xl);
            color: var(--text-color-muted);
            padding: var(--spacing-1);
            line-height: 1;
            opacity: 0.8;
            transition: opacity var(--transition-fast), transform var(--transition-fast);
        }

        .offcanvas-close-btn:hover {
            opacity: 1;
            transform: rotate(90deg);
            color: var(--danger-color);
        }

        .offcanvas-body {
            padding: var(--spacing-4);
            overflow-y: auto;
            flex-grow: 1;
        }

        /*=============================================
=                KOMPONEN TOAST               =
=============================================*/
        .toast-container {
            position: fixed;
            top: calc(var(--header-height) + var(--spacing-4));
            right: var(--spacing-4);
            z-index: 1300;
            /* Paling atas */
            width: 350px;
            max-width: calc(100vw - (var(--spacing-4) * 2));
            /* Agar tidak menempel di mobile */
            pointer-events: none;
            /* Agar tidak menghalangi klik di bawahnya saat kosong */
        }

        .toast {
            background-color: var(--card-bg-color);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-lg);
            margin-bottom: var(--spacing-3);
            border-left-width: 5px;
            /* Border lebih tebal agar "fancy" */
            border-left-style: solid;
            opacity: 0;
            transform: translateX(110%);
            /* Mulai dari luar layar lebih jauh */
            transition: opacity var(--transition-fast) ease-out, transform var(--transition-slow) cubic-bezier(0.215, 0.610, 0.355, 1.000);
            pointer-events: auto;
            /* Toast individual bisa diinteraksi */
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast-header {
            padding: var(--spacing-2) var(--spacing-3);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            font-size: var(--font-size-sm);
        }

        .toast-title {
            font-weight: var(--font-weight-semibold);
            flex-grow: 1;
        }

        .toast-header i {
            /* Ikon di header toast */
            font-size: var(--font-size-base);
            margin-right: var(--spacing-2);
        }

        .toast-timestamp {
            font-size: var(--font-size-xs);
            margin-left: var(--spacing-2);
            color: var(--text-color-subtle);
        }

        .toast-close-btn {
            background: none;
            border: none;
            font-size: var(--font-size-lg);
            color: var(--text-color-muted);
            padding: 0 var(--spacing-1);
            margin-left: var(--spacing-2);
            opacity: 0.7;
            transition: opacity var(--transition-fast);
        }

        .toast-close-btn:hover {
            opacity: 1;
        }

        .toast-body {
            padding: var(--spacing-3);
            font-size: var(--font-size-sm);
            line-height: var(--line-height-snug);
        }

        /* Toast Varian Warna (hanya border kiri dan ikon) */
        .toast--success {
            border-left-color: var(--success-color);
        }

        .toast--success .toast-header i {
            color: var(--success-color);
        }

        .toast--danger {
            border-left-color: var(--danger-color);
        }

        .toast--danger .toast-header i {
            color: var(--danger-color);
        }

        .toast--info {
            border-left-color: var(--info-color);
        }

        .toast--info .toast-header i {
            color: var(--info-color);
        }

        .toast--warning {
            border-left-color: var(--warning-color);
        }

        .toast--warning .toast-header i {
            color: var(--warning-color);
        }

        /*=============================================
=            KOMPONEN FLASH MESSAGE           =
=============================================*/
        #flash-message-container {
            position: sticky;
            /* Menempel di bawah header saat scroll */
            top: var(--header-height);
            /* Di bawah header */
            /* Kiri dan lebar diatur oleh parentnya (#main-area-wrapper) jadi mengikuti layout sidebar */
            width: 100%;
            z-index: 1050;
            /* Di atas konten, di bawah modal/offcanvas */
            padding: var(--spacing-4) var(--spacing-4) 0;
            /* Padding atas dan samping, bawah 0 */
            pointer-events: none;
            /* Biarkan klik tembus jika tidak ada flash message */
        }

        #flash-message-container .alert {
            /* Flash message menggunakan styling alert */
            pointer-events: auto;
            /* Bisa diinteraksi */
            box-shadow: var(--shadow-md);
            animation: fadeInDownFlash 0.4s cubic-bezier(0.215, 0.610, 0.355, 1.000);
        }

        @keyframes fadeInDownFlash {
            from {
                opacity: 0;
                transform: translateY(-25px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /*=============================================
=               GRID SYSTEM SEDERHANA         =
=============================================*/
        .grid {
            display: grid;
            gap: var(--spacing-6);
            /* Default gap */
        }

        /* Default untuk mobile-first, akan dioverride oleh breakpoint lebih besar */
        .grid-cols-1 {
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }

        .grid-cols-2 {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        .grid-cols-3 {
            grid-template-columns: repeat(3, minmax(0, 1fr));
        }

        .grid-cols-4 {
            grid-template-columns: repeat(4, minmax(0, 1fr));
        }

        .col-span-2 {
            grid-column: span 2 / span 2;
        }

        .col-span-3 {
            grid-column: span 3 / span 3;
        }

        .col-span-full {
            grid-column: 1 / -1;
        }

        /* Breakpoint Mobile (sm) - biasanya < 768px */
        @media (max-width: 767.98px) {
            .grid {
                gap: var(--spacing-4);
            }

            /* Gap lebih kecil di mobile */
            .sm-grid-cols-1 {
                grid-template-columns: repeat(1, minmax(0, 1fr));
            }

            .sm-grid-cols-2 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        /* Breakpoint Tablet (md) - 768px ke atas */
        @media (min-width: 768px) {
            .md-grid-cols-1 {
                grid-template-columns: repeat(1, minmax(0, 1fr));
            }

            .md-grid-cols-2 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .md-grid-cols-3 {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }

            .md-grid-cols-4 {
                grid-template-columns: repeat(4, minmax(0, 1fr));
            }

            .md-col-span-2 {
                grid-column: span 2 / span 2;
            }
        }

        /* Breakpoint Desktop (lg) - 992px ke atas */
        @media (min-width: 992px) {
            .lg-grid-cols-1 {
                grid-template-columns: repeat(1, minmax(0, 1fr));
            }

            .lg-grid-cols-2 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .lg-grid-cols-3 {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }

            .lg-grid-cols-4 {
                grid-template-columns: repeat(4, minmax(0, 1fr));
            }

            .lg-col-span-2 {
                grid-column: span 2 / span 2;
            }

            .lg-col-span-3 {
                grid-column: span 3 / span 3;
            }
        }


        /*=============================================
=            FOOTER APLIKASI                  =
=============================================*/
        .app-footer {
            background-color: var(--card-bg-color);
            color: var(--text-color-muted);
            padding: var(--spacing-6) 0;
            /* Padding atas bawah */
            text-align: center;
            font-size: var(--font-size-sm);
            border-top-width: 1px;
            transition: background-color var(--transition-normal), color var(--transition-normal), border-color var(--transition-normal);
            margin-top: auto;
            /* Mendorong footer ke bawah jika konten pendek */
            height: auto;
            /* Disesuaikan dengan konten, min-height jika perlu */
        }

        [data-theme="dark"] .app-footer {
            background-color: var(--bg-color);
            /* Warna beda di dark mode */
        }

        .app-footer p {
            margin-bottom: var(--spacing-1);
            line-height: var(--line-height-normal);
        }

        .app-footer p:last-child {
            margin-bottom: 0;
        }

        .app-footer .fas.fa-heart,
        .app-footer .fas.fa-mug-hot {
            /* Ikon di footer */
            transition: color var(--transition-fast), transform var(--transition-fast);
            display: inline-block;
            /* Untuk transform */
        }

        .app-footer .fas.fa-heart:hover,
        .app-footer .fas.fa-mug-hot:hover {
            transform: scale(1.2);
            /* Efek hover pada ikon */
        }

        .app-footer .fas.fa-heart {
            color: var(--danger-color);
        }

        .app-footer .fas.fa-mug-hot {
            color: var(--accent-color);
        }


        /*=============================================
=            HALAMAN SPESIFIK (CONTOH)        =
=============================================*/

        /* Halaman Dashboard (Stat Cards) */
        .stat-card {
            text-align: center;
            padding: var(--spacing-5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .stat-card .stat-icon {
            font-size: var(--font-size-3xl);
            margin-bottom: var(--spacing-3);
            display: inline-flex;
            width: 60px;
            height: 60px;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius-full);
            background-color: var(--primary-color-lighter);
            /* Default untuk type-primary */
            color: var(--primary-color);
            /* Default untuk type-primary */
            transition: transform var(--transition-fast), background-color var(--transition-fast);
        }

        .stat-card:hover .stat-icon {
            transform: scale(1.1) rotate(-5deg);
            /* Efek animasi ikon */
            background-color: var(--primary-color-light);
            /* Warna BG ikon berubah saat card hover */
        }

        /* Varian warna stat card */
        .stat-card.type-primary {
            border-left-color: var(--primary-color);
        }

        .stat-card.type-primary .stat-icon {
            background-color: var(--primary-color-lighter);
            color: var(--primary-color);
        }

        [data-theme="dark"] .stat-card.type-primary .stat-icon {
            background-color: rgba(var(--primary-color-rgb), 0.2);
            color: var(--primary-color);
        }

        .stat-card.type-secondary {
            border-left-color: var(--secondary-color);
        }

        .stat-card.type-secondary .stat-icon {
            background-color: var(--secondary-color-light);
            color: var(--secondary-color);
        }

        [data-theme="dark"] .stat-card.type-secondary .stat-icon {
            background-color: rgba(var(--secondary-color-rgb), 0.2);
            color: var(--secondary-color);
        }

        .stat-card.type-success {
            border-left-color: var(--success-color);
        }

        .stat-card.type-success .stat-icon {
            background-color: var(--success-color-light);
            color: var(--success-color);
        }

        [data-theme="dark"] .stat-card.type-success .stat-icon {
            background-color: rgba(var(--success-color-rgb), 0.2);
            color: var(--success-color);
        }

        .stat-card.type-danger {
            border-left-color: var(--danger-color);
        }

        .stat-card.type-danger .stat-icon {
            background-color: var(--danger-color-light);
            color: var(--danger-color);
        }

        [data-theme="dark"] .stat-card.type-danger .stat-icon {
            background-color: rgba(var(--danger-color-rgb), 0.2);
            color: var(--danger-color);
        }

        .stat-card.type-warning {
            border-left-color: var(--warning-color);
        }

        .stat-card.type-warning .stat-icon {
            background-color: var(--warning-color-light);
            color: var(--warning-color);
        }

        [data-theme="dark"] .stat-card.type-warning .stat-icon {
            background-color: rgba(var(--warning-color-rgb), 0.2);
            color: var(--warning-color);
        }


        .stat-card .stat-value {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            color: var(--text-color);
            display: block;
            margin-bottom: var(--spacing-1);
            line-height: 1;
            /* Jaga agar tidak terlalu tinggi */
        }

        .stat-card .stat-label {
            font-size: var(--font-size-sm);
            color: var(--text-color-muted);
            font-weight: var(--font-weight-medium);
        }

        .stat-card .stat-change {
            /* Indikator perubahan naik/turun */
            font-size: var(--font-size-xs);
            margin-top: var(--spacing-1);
            display: flex;
            align-items: center;
            gap: var(--spacing-1);
        }

        .stat-card .stat-change.positive {
            color: var(--success-color);
        }

        .stat-card .stat-change.negative {
            color: var(--danger-color);
        }


        /* Chart Container */
        .chart-container {
            position: relative;
            height: 350px;
            /* Tinggi default grafik */
            margin: var(--spacing-6) 0;
            /* Margin atas bawah */
        }

        /* Aktivitas Terbaru */
        .activity-list {
            list-style: none;
            padding: 0;
        }

        .activity-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: var(--spacing-4);
            padding-bottom: var(--spacing-3);
            border-bottom: 1px dashed var(--border-color);
            /* Pemisah halus */
        }

        .activity-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .activity-item__icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: var(--spacing-3);
            color: var(--text-color-on-primary);
            /* Teks putih di atas BG berwarna */
            flex-shrink: 0;
            font-size: var(--font-size-lg);
        }

        /* Warna ikon berdasarkan tipe aktivitas */
        .activity-item__icon--payment {
            background-color: var(--success-color);
        }

        .activity-item__icon--tenant {
            background-color: var(--info-color);
        }

        .activity-item__icon--maintenance {
            background-color: var(--warning-color);
        }

        .activity-item__content p {
            margin-bottom: var(--spacing-1);
            font-size: var(--font-size-sm);
            line-height: var(--line-height-snug);
        }

        .activity-item__content p strong {
            font-weight: var(--font-weight-semibold);
            color: var(--text-color);
        }

        .activity-item__content small {
            font-size: var(--font-size-xs);
            color: var(--text-color-subtle);
        }


        /* Tabel (umum, bisa digunakan di banyak halaman) */
        .table-responsive {
            overflow-x: auto;
            /* Scroll horizontal jika tabel lebar */
            -webkit-overflow-scrolling: touch;
            /* Scroll halus di iOS */
            border: 1px solid var(--border-color);
            /* Border keliling tabel */
            border-radius: var(--border-radius-md);
            /* Radius untuk tabel responsif */
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            /* Gabungkan border sel */
            margin-bottom: 0;
            /* Hapus margin bawah jika tabel di dalam .table-responsive */
            background-color: var(--card-bg-color);
            /* Jika tabel tidak di dalam card */
        }

        .table th,
        .table td {
            padding: var(--spacing-3) var(--spacing-4);
            /* Padding sel */
            vertical-align: middle;
            /* Sejajarkan konten sel secara vertikal */
            border-top: 1px solid var(--border-color);
            text-align: left;
            /* Default rata kiri */
            font-size: var(--font-size-sm);
            white-space: nowrap;
            /* Jaga agar konten tabel tidak wrap kecuali di-override */
        }

        .table td:first-child,
        .table th:first-child {
            padding-left: var(--spacing-5);
        }

        /* Padding lebih di kolom pertama */
        .table td:last-child,
        .table th:last-child {
            padding-right: var(--spacing-5);
        }

        /* Padding lebih di kolom terakhir */

        .table thead th {
            vertical-align: bottom;
            /* Header teks di bawah */
            border-bottom: 2px solid var(--border-color-strong);
            /* Border header lebih tebal */
            font-weight: var(--font-weight-semibold);
            color: var(--text-color-muted);
            text-transform: uppercase;
            /* Teks header kapital */
            font-size: var(--font-size-xs);
            letter-spacing: 0.5px;
            /* Spasi huruf sedikit */
            background-color: var(--bg-color);
            /* Header tabel sedikit berbeda BG */
            border-top: none;
            /* Hapus border atas di header */
        }

        [data-theme="dark"] .table thead th {
            background-color: var(--bg-color-alt);
            /* Header tabel di dark mode */
        }

        .table tbody tr:hover {
            /* Efek hover pada baris tabel */
            background-color: var(--primary-color-lighter);
        }

        [data-theme="dark"] .table tbody tr:hover {
            background-color: rgba(var(--primary-color-rgb), 0.1);
        }

        .table tbody tr:last-child td {
            /* Hapus border bawah di baris terakhir (jika border keliling dari .table-responsive) */
            /* border-bottom: none; */
            /* Dihapus karena border-top antar row sudah cukup */
        }

        /* Tabel Striped (Zebra) */
        .table--striped tbody tr:nth-of-type(odd) {
            /* Baris ganjil */
            background-color: var(--bg-color);
        }

        [data-theme="dark"] .table--striped tbody tr:nth-of-type(odd) {
            background-color: rgba(var(--border-color-rgb), 0.2);
            /* Atau warna lebih gelap dari --bg-color-alt */
        }

        /* Hover di atas striped harus lebih jelas */
        .table--striped tbody tr:nth-of-type(odd):hover {
            background-color: var(--primary-color-lighter);
            /* Sama dengan hover biasa */
        }

        [data-theme="dark"] .table--striped tbody tr:nth-of-type(odd):hover {
            background-color: rgba(var(--primary-color-rgb), 0.15);
            /* Sedikit lebih pekat */
        }


        /* Badge di dalam tabel */
        .table .badge {
            font-size: 0.8em;
            /* Badge lebih kecil di tabel */
            padding: 0.3em 0.6em;
            text-transform: capitalize;
            /* Status diawali huruf besar */
            border-radius: var(--border-radius-sm);
        }

        /* Varian badge status */
        .badge--dibayar,
        .badge--success {
            background-color: var(--success-color-light);
            color: var(--success-color-hover);
            border: 1px solid var(--success-color);
        }

        .badge--tertunda,
        .badge--warning {
            background-color: var(--warning-color-light);
            color: var(--warning-color-hover);
            border: 1px solid var(--warning-color);
        }

        .badge--gagal,
        .badge--danger {
            background-color: var(--danger-color-light);
            color: var(--danger-color-hover);
            border: 1px solid var(--danger-color);
        }

        .badge--info {
            background-color: var(--info-color-light);
            color: var(--info-color-hover);
            border: 1px solid var(--info-color);
        }

        [data-theme="dark"] .badge--dibayar,
        [data-theme="dark"] .badge--success {
            background-color: rgba(var(--success-color-rgb), 0.2);
            color: var(--success-color);
            border-color: rgba(var(--success-color-rgb), 0.5);
        }

        [data-theme="dark"] .badge--tertunda,
        [data-theme="dark"] .badge--warning {
            background-color: rgba(var(--warning-color-rgb), 0.2);
            color: var(--warning-color);
            border-color: rgba(var(--warning-color-rgb), 0.5);
        }

        [data-theme="dark"] .badge--gagal,
        [data-theme="dark"] .badge--danger {
            background-color: rgba(var(--danger-color-rgb), 0.2);
            color: var(--danger-color);
            border-color: rgba(var(--danger-color-rgb), 0.5);
        }

        [data-theme="dark"] .badge--info {
            background-color: rgba(var(--info-color-rgb), 0.2);
            color: var(--info-color);
            border-color: rgba(var(--info-color-rgb), 0.5);
        }


        /* Halaman Apartemen (Listing Cards) */
        .apartment-card {
            /* Ekstensi dari .card */
            display: flex;
            flex-direction: column;
            overflow: hidden;
            /* Untuk gambar tidak keluar dari radius */
        }

        .apartment-card .card-img-top-wrapper {
            overflow: hidden;
            /* Clip gambar yang membesar saat hover */
            border-top-left-radius: var(--border-radius-lg);
            /* Radius dari .card */
            border-top-right-radius: var(--border-radius-lg);
            height: 220px;
            /* Tinggi gambar tetap */
        }

        .apartment-card .card-img-top {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* Gambar mengisi area tanpa distorsi */
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            /* Transisi zoom halus */
            background-color: var(--border-color);
            /* Placeholder jika gambar lambat load */
        }

        .apartment-card:hover .card-img-top {
            transform: scale(1.08);
            /* Efek zoom pada gambar saat card hover */
        }

        .apartment-card .card-body {
            flex-grow: 1;
            /* Body mengisi sisa ruang */
            display: flex;
            flex-direction: column;
            /* Konten body vertikal */
            padding: var(--spacing-4);
            /* Padding body sedikit lebih kecil */
        }

        .apartment-card .card-title {
            /* Override sedikit jika perlu */
            font-size: var(--font-size-lg);
            margin-bottom: var(--spacing-1);
        }

        .apartment-card .details {
            /* Detail kamar, dll. */
            display: flex;
            justify-content: space-between;
            font-size: var(--font-size-sm);
            color: var(--text-color-muted);
            margin-top: var(--spacing-3);
            margin-bottom: var(--spacing-3);
            gap: var(--spacing-3);
            flex-wrap: wrap;
            border-top: 1px dashed var(--border-color);
            border-bottom: 1px dashed var(--border-color);
            padding: var(--spacing-2) 0;
        }

        .apartment-card .details span {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-1);
        }

        .apartment-card .details i {
            color: var(--primary-color);
        }

        /* Ikon detail berwarna primer */

        .apartment-card .price {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--primary-color);
            margin-top: auto;
            /* Dorong harga ke bawah jika deskripsi pendek */
            margin-bottom: var(--spacing-4);
            text-align: right;
            /* Harga rata kanan */
        }

        /* Filter & Pencarian di Halaman Apartemen */
        .apartment-search-filter {
            margin-bottom: var(--spacing-6);
            display: flex;
            gap: var(--spacing-3);
            align-items: center;
            /* Sejajarkan input dan tombol */
        }

        .apartment-search-filter .form-control {
            flex-grow: 1;
            /* Input mengisi ruang */
            max-width: 450px;
            /* Batasi lebar input pencarian */
        }

        /* Halaman Notifikasi */
        .notification-filters {
            margin-bottom: var(--spacing-6);
            display: flex;
            flex-wrap: wrap;
            /* Filter bisa wrap di mobile */
            gap: var(--spacing-4);
            align-items: flex-end;
            /* Label dan select align di bawah */
        }

        .notification-filters .form-group {
            margin-bottom: 0;
        }

        /* Hapus margin bawah default form-group */
        .notification-filters .form-control {
            /* Select filter */
            width: auto;
            /* Lebar otomatis */
            min-width: 200px;
            /* Lebar minimum */
            display: inline-block;
            /* Agar tidak full width */
        }

        #notification-list-container.card .card-body {
            padding: 0;
        }

        /* Hapus padding body card untuk list */

        .notification-item {
            display: flex;
            gap: var(--spacing-4);
            align-items: flex-start;
            border: none;
            /* Border diatur oleh item itu sendiri */
            padding: var(--spacing-4);
            border-bottom-width: 1px;
            /* Garis pemisah antar notifikasi */
            transition: background-color var(--transition-normal), box-shadow var(--transition-fast);
            position: relative;
            /* Untuk ::before atau ::after jika perlu */
        }

        .notification-item:last-child {
            border-bottom-width: 0;
        }

        /* Notifikasi terakhir tanpa border bawah */

        .notification-item:hover {
            background-color: var(--primary-color-lighter);
            box-shadow: inset 3px 0 0 0 var(--primary-color);
            /* Indikator hover di kiri */
        }

        [data-theme="dark"] .notification-item:hover {
            background-color: rgba(var(--primary-color-rgb), 0.1);
        }

        .notification-item .icon-wrapper {
            /* Wrapper untuk ikon notifikasi */
            font-size: var(--font-size-xl);
            padding-top: 2px;
            /* Penyesuaian vertikal */
            flex-shrink: 0;
            /* Ikon tidak mengecil */
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius-full);
            transition: transform var(--transition-fast);
        }

        .notification-item:hover .icon-wrapper {
            transform: scale(1.1);
        }

        /* Animasi ikon saat hover */

        /* Warna ikon notifikasi berdasarkan tipe */
        .notification-item .icon-wrapper.type-info {
            background-color: var(--info-color-light);
            color: var(--info-color);
        }

        .notification-item .icon-wrapper.type-success {
            background-color: var(--success-color-light);
            color: var(--success-color);
        }

        .notification-item .icon-wrapper.type-warning {
            background-color: var(--warning-color-light);
            color: var(--warning-color);
        }

        .notification-item .icon-wrapper.type-danger {
            background-color: var(--danger-color-light);
            color: var(--danger-color);
        }

        [data-theme="dark"] .notification-item .icon-wrapper.type-info {
            background-color: rgba(var(--info-color-rgb), 0.2);
            color: var(--info-color);
        }

        [data-theme="dark"] .notification-item .icon-wrapper.type-success {
            background-color: rgba(var(--success-color-rgb), 0.2);
            color: var(--success-color);
        }

        [data-theme="dark"] .notification-item .icon-wrapper.type-warning {
            background-color: rgba(var(--warning-color-rgb), 0.2);
            color: var(--warning-color);
        }

        [data-theme="dark"] .notification-item .icon-wrapper.type-danger {
            background-color: rgba(var(--danger-color-rgb), 0.2);
            color: var(--danger-color);
        }

        .notification-item .content {
            flex-grow: 1;
        }

        .notification-item .content h5.notification-title {
            margin-bottom: var(--spacing-1);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-semibold);
            color: var(--text-color);
        }

        .notification-item .content p.notification-message {
            font-size: var(--font-size-sm);
            color: var(--text-color-muted);
            line-height: var(--line-height-snug);
            margin-bottom: var(--spacing-2);
        }

        .notification-item .meta {
            /* Timestamp dan kategori */
            font-size: var(--font-size-xs);
            color: var(--text-color-subtle);
            margin-top: var(--spacing-1);
        }

        .notification-item.unread {
            /* Styling notifikasi belum dibaca */
            background-color: var(--primary-color-lighter);
            border-left: 4px solid var(--primary-color);
            /* Border kiri penanda belum dibaca */
            padding-left: calc(var(--spacing-4) - 4px);
            /* Sesuaikan padding karena ada border */
        }

        .notification-item.unread .content h5.notification-title {
            font-weight: var(--font-weight-bold);
            color: var(--primary-color-dark-text);
        }

        [data-theme="dark"] .notification-item.unread {
            background-color: rgba(var(--primary-color-rgb), 0.15);
            border-left-color: var(--primary-color);
        }

        [data-theme="dark"] .notification-item.unread .content h5.notification-title {
            color: var(--primary-color-dark-text);
            /* Pastikan kontras di dark mode */
        }

        .notification-item .actions {
            /* Tombol aksi di notifikasi (mark as read, delete) */
            margin-left: auto;
            /* Dorong ke kanan */
            padding-left: var(--spacing-3);
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
            opacity: 0;
            /* Sembunyikan default, tampilkan saat hover item */
            transition: opacity var(--transition-fast);
        }

        .notification-item:hover .actions {
            opacity: 1;
        }

        .notification-item .actions .btn {
            /* Tombol di dalam notifikasi */
            background-color: var(--card-bg-color);
            /* Agar serasi dengan card jika notif di dalam card */
        }

        [data-theme="dark"] .notification-item .actions .btn {
            background-color: var(--bg-color-alt);
        }

        /* Halaman Profil (Contoh Styling Tambahan) */
        #page-profile .card-body img.profile-avatar {
            border: 4px solid var(--primary-color-light);
            padding: 4px;
            /* Jarak antara border dan gambar */
            background-color: var(--card-bg-color);
            /* BG di belakang gambar, jaga-jaga jika gambar transparan */
            width: 120px;
            height: 120px;
            object-fit: cover;
        }

        [data-theme="dark"] #page-profile .card-body img.profile-avatar {
            border-color: var(--primary-color);
            /* Border lebih jelas di dark mode */
        }

        #page-profile .card-body h2.profile-name {
            /* Nama profil */
            color: var(--text-color);
        }

        #page-profile .profile-details-list li {
            /* List detail profil */
            padding: var(--spacing-3) 0;
            border-bottom: 1px dashed var(--border-color);
        }

        #page-profile .profile-details-list li:last-child {
            border-bottom: none;
        }

        /* Page Placeholder Styling (Untuk halaman yang belum jadi) */
        .page-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - var(--header-height) - var(--footer-height) - (var(--spacing-8) * 2));
            /* Tinggi viewport dikurangi header, footer, padding konten */
            text-align: center;
            padding: var(--spacing-8);
            /* Padding besar */
            background-color: var(--card-bg-color);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--card-shadow);
        }

        .page-placeholder__icon {
            font-size: 4rem;
            /* Ikon besar */
            color: var(--primary-color);
            margin-bottom: var(--spacing-6);
            /* Jarak ke judul */
            opacity: 0.7;
            animation: pulseIcon 2s infinite ease-in-out;
        }

        @keyframes pulseIcon {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        .page-placeholder__title {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--text-color);
            margin-bottom: var(--spacing-4);
        }

        .page-placeholder__message {
            font-size: var(--font-size-lg);
            color: var(--text-color-muted);
            max-width: 600px;
            /* Batasi lebar pesan */
            line-height: var(--line-height-snug);
        }

        .page-placeholder .btn {
            margin-top: var(--spacing-6);
            /* Jarak tombol dari teks */
        }
    </style>
</head>

<body data-theme="light"> <!-- Atribut data-theme untuk switching tema. Default 'light' -->

    <!-- Shell Aplikasi Utama (Struktur Dasar SPA) -->
    <div id="app-shell">

        <!-- Sidebar Aplikasi -->
        <aside class="app-sidebar" id="app-sidebar" aria-label="Navigasi Utama Aplikasi">
            <div class="sidebar-header">
                <i class="fas fa-building-user sidebar-logo-icon" aria-hidden="true"></i>
                <span class="sidebar-logo-text">Aperture<span class="sidebar-logo-highlight">Find</span></span>
            </div>
            <div class="sidebar-profile">
                <img src="https://i.pravatar.cc/96?u=adminUserFancy" alt="Foto Profil Pengguna"
                    class="sidebar-profile-img" id="sidebar-profile-img-el">
                <div class="sidebar-profile-info">
                    <span class="name" id="sidebar-profile-name-el">Admin Ganteng</span>
                    <span class="role" id="sidebar-profile-role-el">Administrator</span>
                </div>
            </div>
            <nav class="sidebar-nav">
                <ul class="nav-list" role="menu" aria-orientation="vertical">
                    <li class="nav-item" role="presentation"><a href="#/dashboard" class="nav-link"
                            data-route="dashboard" role="menuitem"><i class="fas fa-tachometer-alt fa-fw"
                                aria-hidden="true"></i> <span class="nav-text">Dashboard</span></a></li>
                    <li class="nav-item" role="presentation"><a href="#/apartments" class="nav-link"
                            data-route="apartments" role="menuitem"><i class="fas fa-city fa-fw" aria-hidden="true"></i>
                            <span class="nav-text">Apartemen</span></a></li>
                    <li class="nav-item" role="presentation"><a href="#/tenants" class="nav-link" data-route="tenants"
                            role="menuitem"><i class="fas fa-users fa-fw" aria-hidden="true"></i> <span
                                class="nav-text">Penyewa</span></a></li>
                    <li class="nav-item" role="presentation"><a href="#/payments" class="nav-link" data-route="payments"
                            role="menuitem"><i class="fas fa-credit-card fa-fw" aria-hidden="true"></i> <span
                                class="nav-text">Pembayaran</span></a></li>
                    <li class="nav-item" role="presentation"><a href="#/reports" class="nav-link" data-route="reports"
                            role="menuitem"><i class="fas fa-chart-pie fa-fw" aria-hidden="true"></i> <span
                                class="nav-text">Laporan</span></a></li>
                    <li class="nav-item" role="presentation"><a href="#/notifications" class="nav-link"
                            data-route="notifications" role="menuitem"><i class="fas fa-bell fa-fw"
                                aria-hidden="true"></i> <span class="nav-text">Notifikasi</span><span
                                class="badge d-none" id="notif-badge-count-sidebar">0</span></a></li>
                    <li class="nav-item" role="presentation"><a href="#/messages" class="nav-link" data-route="messages"
                            role="menuitem"><i class="fas fa-envelope fa-fw" aria-hidden="true"></i> <span
                                class="nav-text">Pesan</span><span class="badge d-none"
                                id="messages-badge-count">0</span></a></li>
                    <li class="nav-item" role="presentation"><a href="#/profile" class="nav-link" data-route="profile"
                            role="menuitem"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i> <span
                                class="nav-text">Profil Saya</span></a></li>
                    <li class="nav-item" role="presentation"><a href="#/settings" class="nav-link" data-route="settings"
                            role="menuitem"><i class="fas fa-cogs fa-fw" aria-hidden="true"></i> <span
                                class="nav-text">Pengaturan</span></a></li>
                </ul>
            </nav>
        </aside>
        <!-- Overlay SPESIFIK untuk sidebar mobile, BEDA dengan overlay generik untuk modal/offcanvas -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>


        <!-- Wrapper untuk Header dan Konten Utama -->
        <div id="main-area-wrapper">
            <!-- Header Aplikasi -->
            <header class="app-header" role="banner">
                <div class="header-container">
                    <div class="header-left">
                        <button id="sidebar-toggle-btn" class="sidebar-toggle-btn"
                            aria-label="Buka atau tutup navigasi sidebar" aria-expanded="true"
                            aria-controls="app-sidebar">
                            <i class="fas fa-bars" aria-hidden="true"></i>
                        </button>
                        <!-- Judul Halaman Dinamis, tampil di md ke atas -->
                        <h1 id="page-title-header" class="fs-xl fw-bold m-0 d-none d-md-block" aria-live="polite">
                            Dashboard</h1>
                    </div>

                    <div class="header-actions">
                        <div class="app-header__search-wrapper">
                            <input type="search" class="app-header__search-input" placeholder="Cari sesuatu..."
                                aria-label="Kolom Pencarian Global" id="global-search-input">
                            <i class="fas fa-search app-header__search-icon"></i>
                        </div>
                        <div class="notification-btn-wrapper">
                            <a href="#/notifications" class="theme-toggle-btn-header btn-icon-only"
                                aria-label="Lihat Notifikasi" title="Notifikasi">
                                <i class="fas fa-bell" aria-hidden="true"></i>
                                <span class="badge d-none" id="notif-badge-count-header">0</span>
                            </a>
                        </div>
                        <button id="theme-toggle-btn-header" class="theme-toggle-btn-header btn-icon-only"
                            aria-label="Ganti Tema Aplikasi" title="Ganti Tema">
                            <i class="fas fa-sun" aria-hidden="true"></i> <!-- Ikon akan berubah via JS -->
                        </button>
                    </div>
                </div>
            </header>

            <!-- Kontainer untuk Flash Messages -->
            <div id="flash-message-container"></div>

            <!-- Konten Utama (Dinamis, diisi oleh JavaScript Router) -->
            <main id="main-content" class="main-content" aria-live="polite" role="main">
                <!-- Konten halaman akan dimuat di sini oleh JavaScript. Loader awal bisa ditempatkan di sini sebelum render -->
            </main>

            <!-- Footer Aplikasi -->
            <footer class="app-footer" role="contentinfo">
                <div class="container">
                    <p> <span id="current-year">2024</span> ApertureFind. Semua hak cipta dilindungi.</p>
                    <p>Dirancang dengan <i class="fas fa-heart" aria-hidden="true" title="cinta"></i> dan <i
                            class="fas fa-mug-hot" aria-hidden="true" title="semangat kopi"></i> oleh Tim Developer
                        Handal.</p>
                </div>
            </footer>
        </div> <!-- Akhir #main-area-wrapper -->
    </div> <!-- Akhir #app-shell -->

    <!-- Loader Awal Aplikasi (Full Screen) -->
    <div class="initial-loader" id="initial-app-loader" aria-hidden="false" aria-live="assertive"
        aria-label="Memuat aplikasi ApertureFind">
        <div class="loader" role="status">
            <span class="sr-only">Memuat...</span>
        </div>
        <p>Memuat ApertureFind Dashboard...</p>
    </div>

    <!-- Template untuk Item Notifikasi (Digunakan oleh JavaScript untuk Render Dinamis) -->
    <template id="notification-item-template">
        <div class="notification-item" role="listitem"> <!-- Atribut dataset akan diisi JS -->
            <div class="icon-wrapper" aria-hidden="true">
                <i class=""></i> <!-- Kelas ikon dan warna diisi JS -->
            </div>
            <div class="content">
                <h5 class="notification-title"></h5> <!-- Judul notifikasi -->
                <p class="notification-message"></p> <!-- Pesan notifikasi -->
                <div class="meta">
                    <span class="timestamp"></span> | <span class="category"></span>
                </div>
            </div>
            <div class="actions"> <!-- Tombol aksi untuk notifikasi -->
                <button class="btn btn-sm btn-icon-only btn-outline-primary mark-as-read"
                    title="Tandai sebagai sudah dibaca"> <!-- Title & ikon akan di-update JS -->
                    <i class="fas fa-check"></i>
                    <span class="sr-only">Tandai sebagai sudah dibaca</span>
                </button>
                <button class="btn btn-sm btn-icon-only btn-danger delete-notification" title="Hapus notifikasi">
                    <i class="fas fa-trash-alt"></i>
                    <span class="sr-only">Hapus notifikasi</span>
                </button>
            </div>
        </div>
    </template>

    <!-- Struktur HTML untuk Komponen UI Baru (diletakkan di akhir body agar di atas konten lain jika fixed) -->

    <!-- Generic App Overlay (untuk Modal dan Offcanvas) -->
    <div class="app-overlay" id="app-generic-overlay"></div>

    <!-- Modal -->
    <div class="modal-wrapper" id="app-modal-wrapper">
        <div class="modal" id="app-modal" role="dialog" aria-modal="true" aria-labelledby="app-modal-title"
            aria-describedby="app-modal-body">
            <div class="modal-header">
                <h3 class="modal-title" id="app-modal-title">Judul Modal</h3>
                <button class="modal-close-btn" aria-label="Tutup Modal">&times;</button>
            </div>
            <div class="modal-body" id="app-modal-body">
                <p>Konten modal default.</p>
            </div>
            <div class="modal-footer" id="app-modal-footer">
                <button class="btn btn-outline-secondary modal-action-btn" data-action="cancel">Batal</button>
                <button class="btn btn-primary modal-action-btn" data-action="confirm">Konfirmasi</button>
            </div>
        </div>
    </div>

    <!-- Off-canvas Panel -->
    <aside class="offcanvas-panel offcanvas-panel--right" id="app-offcanvas" aria-labelledby="app-offcanvas-title"
        role="dialog" aria-modal="true">
        <div class="offcanvas-header">
            <h4 class="offcanvas-title" id="app-offcanvas-title">Judul Off-canvas</h4>
            <button class="offcanvas-close-btn" aria-label="Tutup Panel">&times;</button>
        </div>
        <div class="offcanvas-body" id="app-offcanvas-body">
            <p>Konten off-canvas default.</p>
        </div>
    </aside>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container" aria-live="polite" aria-atomic="false">
        <!-- Toasts akan dimasukkan di sini oleh JavaScript -->
    </div>


    <!-- Skrip Utama Aplikasi -->
    <script>
        // Menggunakan IIFE (Immediately Invoked Function Expression) untuk membuat scope lokal,
        // menghindari polusi global, dan memungkinkan penggunaan 'use strict'.
        (function () {
            'use strict';

            //=============================================
            //========= STATE APLIKASI & KONFIGURASI ======
            //=============================================
            const AppState = {
                currentTheme: localStorage.getItem('ApertureFindTheme') || 'light',
                activeRoute: '',
                activePageTitle: 'Dashboard',
                isSidebarOpenMobile: false,
                isSidebarCollapsedDesktop: localStorage.getItem('ApertureFindSidebarCollapsed') === 'true',
                userProfile: {
                    name: 'Admin Ganteng',
                    role: 'Administrator Utama',
                    photoUrl: 'https://i.pravatar.cc/96?u=adminUserFancy' // Avatar konsisten dengan seed
                },
                dashboardStats: {
                    occupancyRate: 78,
                    monthlyRevenue: 123000000,
                    pendingRequests: 3,
                    activeTenants: 152,
                    revenueChange: 5.2, // persentase positif
                    occupancyChange: -1.5, // persentase negatif
                    newRequestsToday: 1,
                    newTenants: 5,
                },
                apartments: [
                    { id: 1, name: 'Apartemen Mewah Pusat Kota', imageUrl: 'https://source.unsplash.com/random/600x400/?apartment,modern,interior', bedrooms: 2, bathrooms: 1, area: 75, price: 12000000, city: 'Jakarta Pusat', description: 'Apartemen modern dengan fasilitas lengkap di jantung kota, nikmati kemewahan dan kenyamanan urban.' },
                    { id: 2, name: 'Studio Nyaman Dekat CBD', imageUrl: 'https://source.unsplash.com/random/600x400/?apartment,studio,city', bedrooms: 1, bathrooms: 1, area: 35, price: 5500000, city: 'Jakarta Selatan', description: 'Studio ideal untuk profesional muda, lokasi strategis dekat kawasan bisnis utama dan transportasi publik.' },
                    { id: 3, name: 'Apartemen Keluarga Asri', imageUrl: 'https://source.unsplash.com/random/600x400/?apartment,family,suburban', bedrooms: 3, bathrooms: 2, area: 120, price: 25000000, city: 'Tangerang Selatan', description: 'Lingkungan hijau dan tenang dengan fasilitas ramah anak, sempurna untuk keluarga yang mencari kenyamanan.' },
                    { id: 4, name: 'Penthouse Eksklusif Sky View', imageUrl: 'https://source.unsplash.com/random/600x400/?apartment,luxury,penthouse', bedrooms: 4, bathrooms: 3, area: 250, price: 75000000, city: 'Jakarta Pusat', description: 'Kemewahan tertinggi dengan pemandangan kota 360 derajat, kolam renang pribadi, dan layanan premium.' },
                    { id: 5, name: 'Apartemen Minimalis Urban', imageUrl: 'https://source.unsplash.com/random/600x400/?apartment,minimalist,urban', bedrooms: 2, bathrooms: 1, area: 60, price: 9500000, city: 'Jakarta Barat', description: 'Desain minimalis fungsional di lokasi strategis, cocok untuk gaya hidup urban yang dinamis.' }
                ],
                recentPayments: [ // Data dummy pembayaran
                    { id: 'INV-2025001', tenant: 'Jane Smith', apartment: 'A-101', amount: 1200000, date: '2025-03-15', status: 'Dibayar' },
                    { id: 'INV-2025002', tenant: 'John Doe', apartment: 'B-203', amount: 1500000, date: '2025-03-14', status: 'Tertunda' },
                    { id: 'INV-2025003', tenant: 'Sarah Johnson', apartment: 'C-305', amount: 1350000, date: '2025-03-13', status: 'Gagal' },
                    { id: 'INV-2025004', tenant: 'Michael Bay', apartment: 'D-GF-01', amount: 2500000, date: '2025-03-12', status: 'Dibayar' },
                ],
                recentActivities: [ // Data dummy aktivitas
                    { icon: 'fas fa-credit-card', type: 'payment', text: 'Pembayaran baru dari <strong>Budi Santoso</strong> (Apt 101)', time: '5 menit lalu' },
                    { icon: 'fas fa-user-plus', type: 'tenant', text: 'Penyewa baru ditambahkan: <strong>Siti Aminah</strong>', time: '1 jam lalu' },
                    { icon: 'fas fa-tools', type: 'maintenance', text: 'Permintaan perbaikan dari <strong>Apt 205</strong> selesai', time: '3 jam lalu' },
                ],
                currentApartmentSearchTerm: '',
                notifications: [ // Data dummy notifikasi
                    { id: 1, title: 'Pembaruan Kebijakan Privasi Aplikasi', message: 'Kami telah memperbarui kebijakan privasi kami untuk meningkatkan perlindungan data Anda. Silakan tinjau perubahan tersebut.', type: 'info', icon: 'fas fa-info-circle', timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000), category: 'Umum', unread: true },
                    { id: 2, title: 'Pembayaran Tagihan Berhasil Diproses', message: 'Pembayaran tagihan sewa bulan Juli Anda sebesar Rp5.000.000 telah berhasil kami terima. Terima kasih!', type: 'success', icon: 'fas fa-check-circle', timestamp: new Date(Date.now() - 24 * 60 * 60 * 1000), category: 'Keuangan', unread: false },
                    { id: 3, title: 'Jadwal Perbaikan Lift Utama Gedung', message: 'Lift di lobi utama akan dalam perbaikan terjadwal pada tanggal 15 Agustus pukul 10:00 - 14:00. Mohon gunakan lift alternatif.', type: 'warning', icon: 'fas fa-triangle-exclamation', timestamp: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000), category: 'Pemeliharaan', unread: true },
                ],
                nextNotificationId: 4, // Untuk ID notifikasi baru
                currentNotificationFilter: 'all', // Filter notifikasi: all, unread, read
                currentNotificationCategory: 'all', // Filter kategori notifikasi
                unreadMessagesCount: 2, // Contoh badge pesan
                revenueChartInstance: null, // Instance Chart.js untuk pendapatan
            };

            //=============================================
            //========= ELEMEN DOM YANG SERING DIGUNAKAN ==
            //=============================================
            const DOM = {
                html: document.documentElement,
                body: document.body,
                appShell: document.getElementById('app-shell'),
                appSidebar: document.getElementById('app-sidebar'),
                sidebarToggleBtn: document.getElementById('sidebar-toggle-btn'),
                sidebarOverlay: document.getElementById('sidebar-overlay'), // Overlay SPESIFIK untuk sidebar mobile
                sidebarProfileImg: document.getElementById('sidebar-profile-img-el'),
                sidebarProfileName: document.getElementById('sidebar-profile-name-el'),
                sidebarProfileRole: document.getElementById('sidebar-profile-role-el'),
                mainAreaWrapper: document.getElementById('main-area-wrapper'),
                header: document.querySelector('.app-header'),
                pageTitleHeader: document.getElementById('page-title-header'),
                mainContent: document.getElementById('main-content'),
                themeToggleButtonHeader: document.getElementById('theme-toggle-btn-header'),
                allNavLinks: null, // Akan diisi di init
                currentYearSpan: document.getElementById('current-year'),
                initialAppLoader: document.getElementById('initial-app-loader'),
                notifBadgeCountHeader: document.getElementById('notif-badge-count-header'),
                notifBadgeCountSidebar: document.getElementById('notif-badge-count-sidebar'),
                messagesBadgeCount: document.getElementById('messages-badge-count'),
                notificationItemTemplate: document.getElementById('notification-item-template'),
                globalSearchInput: document.getElementById('global-search-input'),

                // Komponen UI Baru
                genericOverlay: document.getElementById('app-generic-overlay'), // Overlay untuk modal dan offcanvas umum
                modalWrapper: document.getElementById('app-modal-wrapper'),
                modal: document.getElementById('app-modal'),
                modalTitle: document.getElementById('app-modal-title'),
                modalBody: document.getElementById('app-modal-body'),
                modalFooter: document.getElementById('app-modal-footer'),
                modalCloseBtn: document.querySelector('#app-modal .modal-close-btn'),
                offcanvas: document.getElementById('app-offcanvas'),
                offcanvasTitle: document.getElementById('app-offcanvas-title'),
                offcanvasBody: document.getElementById('app-offcanvas-body'),
                offcanvasCloseBtn: document.querySelector('#app-offcanvas .offcanvas-close-btn'),
                toastContainer: document.getElementById('toast-container'),
                flashMessageContainer: document.getElementById('flash-message-container'),
            };
            // Inisialisasi DOM.allNavLinks setelah DOM siap
            function cacheNavLinks() {
                DOM.allNavLinks = DOM.appSidebar.querySelectorAll('.nav-link');
            }

            //=============================================
            //========= FUNGSI UTILITAS ===================
            //=============================================
            const Utils = {
                /**
                 * Fungsi debounce untuk menunda eksekusi fungsi.
                 * @param {Function} func - Fungsi yang akan dieksekusi.
                 * @param {number} delay - Waktu tunda dalam milidetik.
                 * @returns {Function} Fungsi yang sudah di-debounce.
                 */
                debounce: function (func, delay) {
                    let timeout;
                    return function (...args) {
                        clearTimeout(timeout);
                        timeout = setTimeout(() => func.apply(this, args), delay);
                    };
                },
                /**
                 * Melakukan escape karakter HTML khusus dalam string.
                 * @param {string} str - String yang akan di-escape.
                 * @returns {string} String yang sudah aman untuk ditampilkan di HTML.
                 */
                escapeHTML: function (str) {
                    if (str === null || typeof str === 'undefined') return '';
                    return String(str).replace(/[&<>"']/g, function (match) {
                        return { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[match];
                    });
                },
                /**
                * Mengonversi tanggal menjadi format waktu yang relatif (mis: "5 menit lalu").
                * @param {Date|string} dateInput - Objek Date atau string tanggal yang valid.
                * @returns {string} String representasi waktu relatif.
                */
                timeAgo: function (dateInput) {
                    const date = (dateInput instanceof Date) ? dateInput : new Date(dateInput);
                    if (isNaN(date.getTime())) return "Tanggal tidak valid"; // Penanganan error jika tanggal tidak valid

                    const now = new Date();
                    const seconds = Math.round(Math.abs(now - date) / 1000);
                    const minutes = Math.round(seconds / 60);
                    const hours = Math.round(minutes / 60);
                    const days = Math.round(hours / 24);
                    const months = Math.round(days / 30); // Perkiraan
                    const years = Math.round(days / 365); // Perkiraan


                    if (seconds < 5) return 'baru saja';
                    if (seconds < 60) return `${seconds} detik lalu`;
                    if (minutes === 1) return '1 menit lalu';
                    if (minutes < 60) return `${minutes} menit lalu`;
                    if (hours === 1) return '1 jam lalu';
                    if (hours < 24) return `${hours} jam lalu`;
                    if (days === 1) return 'kemarin';
                    if (days < 30) return `${days} hari lalu`;
                    if (months === 1) return '1 bulan lalu';
                    if (months < 12) return `${months} bulan lalu`;
                    if (years === 1) return '1 tahun lalu';
                    if (years > 1) return `${years} tahun lalu`;

                    // Fallback jika tanggal sangat lampau atau masa depan jauh
                    const options = { year: 'numeric', month: 'long', day: 'numeric' };
                    return date.toLocaleDateString('id-ID', options);
                },
                /**
                 * Memformat angka menjadi format mata uang IDR.
                 * @param {number} amount - Jumlah angka.
                 * @param {string} [currency='IDR'] - Kode mata uang.
                 * @returns {string} String mata uang yang diformat.
                 */
                formatCurrency: function (amount, currency = 'IDR') {
                    return new Intl.NumberFormat('id-ID', { style: 'currency', currency: currency, minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(amount);
                },
                /**
                 * Memformat perubahan persentase dengan ikon naik/turun.
                 * @param {number} value - Nilai persentase.
                 * @returns {string} HTML string untuk indikator perubahan.
                 */
                formatPercentageChange: function (value) {
                    const sign = value >= 0 ? '+' : '';
                    const icon = value >= 0 ? 'fas fa-arrow-trend-up' : 'fas fa-arrow-trend-down'; // Ikon lebih modern
                    const colorClass = value >= 0 ? 'text-success' : 'text-danger'; // Menggunakan kelas warna teks utilitas
                    return `<div class="stat-change ${colorClass}"><i class="${icon} mr-1"></i> ${sign}${Math.abs(value).toFixed(1)}% <span class="text-muted fs-xs d-none d-md-inline">vs bln lalu</span></div>`;
                },
                /**
                 * Mendapatkan judul halaman dari atribut data-route pada link navigasi.
                 * @param {string} routeKey - Kunci rute.
                 * @returns {string} Judul halaman.
                 */
                getPageTitleFromRoute: function (routeKey) {
                    const link = DOM.appSidebar.querySelector(`.nav-link[data-route="${routeKey}"]`);
                    if (link) {
                        const navText = link.querySelector('.nav-text');
                        if (navText) return navText.textContent.trim();
                    }
                    // Default jika tidak ada link atau untuk rute dashboard
                    if (routeKey === 'dashboard' || routeKey === '') return 'Dashboard';
                    // Kapitalisasi huruf pertama untuk judul default jika tidak ada di navigasi
                    return routeKey.charAt(0).toUpperCase() + routeKey.slice(1).replace(/-/g, ' ');
                },
                /**
                 * Mendapatkan nilai variabel CSS dari elemen root (html).
                 * @param {string} variableName - Nama variabel CSS (misalnya, '--primary-color').
                 * @returns {string} Nilai variabel CSS.
                 */
                getCssVariableValue: function (variableName) {
                    if (!DOM.html) DOM.html = document.documentElement;
                    return getComputedStyle(DOM.html).getPropertyValue(variableName).trim();
                },
                /**
                 * Mendapatkan semua elemen yang dapat difokuskan di dalam sebuah kontainer.
                 * @param {HTMLElement} container - Elemen kontainer.
                 * @returns {HTMLElement[]} Array elemen yang dapat difokuskan.
                 */
                getFocusableElements: function (container) {
                    return Array.from(
                        container.querySelectorAll(
                            'a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input:not([type="hidden"]):not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])'
                        )
                    ).filter(el => {
                        // Cek apakah elemen terlihat dan tidak memiliki atribut 'disabled' secara eksplisit
                        const style = window.getComputedStyle(el);
                        return style.display !== 'none' && style.visibility !== 'hidden' && !el.hasAttribute('disabled');
                    });
                },
                /**
                 * Menghasilkan ID unik sederhana dengan prefix.
                 * @param {string} [prefix='id-'] - Prefix untuk ID.
                 * @returns {string} ID unik.
                 */
                generateId: function (prefix = 'uid-') { // Ubah prefix agar lebih jelas sebagai Unique ID
                    return prefix + Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
                }
            };

            //=============================================
            //========= UI MANAGER (Modal, Offcanvas, Toast, Alert, Flash) =======
            //=============================================
            const UIManager = {
                _activeModal: null,
                _activeOffcanvas: null,
                _lastFocusedElement: null, // Untuk mengembalikan fokus setelah modal/offcanvas ditutup
                _focusTrapListener: null, // Listener tunggal untuk focus trap

                init: function () {
                    // Overlay generik untuk modal dan offcanvas
                    DOM.genericOverlay.addEventListener('click', () => {
                        if (this._activeModal) this.closeModal();
                        if (this._activeOffcanvas) this.closeOffcanvas();
                    });

                    // Tombol close Modal
                    DOM.modalCloseBtn.addEventListener('click', () => this.closeModal());

                    // Tombol close Offcanvas
                    DOM.offcanvasCloseBtn.addEventListener('click', () => this.closeOffcanvas());

                    // Handle tombol Escape untuk menutup modal/offcanvas
                    document.addEventListener('keydown', (event) => {
                        if (event.key === 'Escape') {
                            if (this._activeModal) this.closeModal();
                            if (this._activeOffcanvas) this.closeOffcanvas();
                        }
                    });
                },

                // --- Focus Trap ---
                _activateFocusTrap: function (container) {
                    this._lastFocusedElement = document.activeElement; // Simpan elemen yang sedang fokus
                    const focusableElements = Utils.getFocusableElements(container);
                    if (focusableElements.length === 0) return;

                    const firstFocusableElement = focusableElements[0];
                    const lastFocusableElement = focusableElements[focusableElements.length - 1];

                    firstFocusableElement.focus();

                    this._focusTrapListener = (event) => {
                        if (event.key === 'Tab') {
                            if (event.shiftKey) { // Shift + Tab
                                if (document.activeElement === firstFocusableElement) {
                                    lastFocusableElement.focus();
                                    event.preventDefault();
                                }
                            } else { // Tab
                                if (document.activeElement === lastFocusableElement) {
                                    firstFocusableElement.focus();
                                    event.preventDefault();
                                }
                            }
                        }
                    };
                    // Tambahkan listener ke kontainer modal/offcanvas, bukan document
                    container.addEventListener('keydown', this._focusTrapListener);
                },
                _deactivateFocusTrap: function (container) {
                    if (this._focusTrapListener) {
                        container.removeEventListener('keydown', this._focusTrapListener);
                        this._focusTrapListener = null;
                    }
                    // Kembalikan fokus ke elemen terakhir yang aktif sebelum modal/offcanvas dibuka
                    if (this._lastFocusedElement && typeof this._lastFocusedElement.focus === 'function') {
                        this._lastFocusedElement.focus();
                    }
                    this._lastFocusedElement = null;
                },

                // --- Overlay Methods ---
                showOverlay: function () {
                    DOM.genericOverlay.classList.add('active');
                    DOM.body.classList.add('no-scroll');
                },
                hideOverlay: function () {
                    // Hanya sembunyikan jika tidak ada komponen lain (modal/offcanvas) yang aktif dan membutuhkannya
                    if (!this._activeModal && !this._activeOffcanvas) {
                        DOM.genericOverlay.classList.remove('active');
                        DOM.body.classList.remove('no-scroll');
                    }
                },

                // --- Modal Methods ---
                openModal: function ({ title = 'Judul Modal', bodyContent = '<p>Konten modal.</p>', footerButtons = null, size = 'md' }) {
                    if (this._activeModal) return; // Mencegah beberapa modal terbuka bersamaan

                    DOM.modalTitle.innerHTML = Utils.escapeHTML(title); // Judul selalu di-escape
                    DOM.modalBody.innerHTML = bodyContent; // Asumsikan bodyContent adalah HTML yang aman atau sudah di-escape sebelumnya jika dari user input

                    // Atur ukuran modal
                    DOM.modal.style.maxWidth = size === 'lg' ? '800px' : (size === 'sm' ? '450px' : '600px');

                    // Hapus event listener lama dari tombol footer sebelum menambahkan yang baru
                    const oldFooterButtons = DOM.modalFooter.querySelectorAll('.modal-action-btn');
                    oldFooterButtons.forEach(btn => {
                        const newBtn = btn.cloneNode(true); // Clone untuk hapus listener
                        btn.parentNode.replaceChild(newBtn, btn);
                    });

                    if (footerButtons && Array.isArray(footerButtons)) {
                        DOM.modalFooter.innerHTML = ''; // Kosongkan footer
                        footerButtons.forEach(btnConfig => {
                            const button = document.createElement('button');
                            button.className = `btn ${Utils.escapeHTML(btnConfig.class) || 'btn-primary'} modal-action-btn`;
                            button.textContent = Utils.escapeHTML(btnConfig.text);
                            button.dataset.action = Utils.escapeHTML(btnConfig.action);
                            if (typeof btnConfig.onClick === 'function') {
                                button.addEventListener('click', () => {
                                    btnConfig.onClick();
                                    if (btnConfig.closesModal !== false) this.closeModal();
                                });
                            } else { // Default action: close modal
                                button.addEventListener('click', () => this.closeModal());
                            }
                            DOM.modalFooter.appendChild(button);
                        });
                    } else { // Footer default jika tidak ada konfigurasi
                        DOM.modalFooter.innerHTML = `
                            <button class="btn btn-outline-secondary modal-action-btn" data-action="cancel">Batal</button>
                            <button class="btn btn-primary modal-action-btn" data-action="confirm">Konfirmasi</button>`;
                        DOM.modalFooter.querySelector('[data-action="cancel"]').addEventListener('click', () => this.closeModal());
                        DOM.modalFooter.querySelector('[data-action="confirm"]').addEventListener('click', () => {
                            this.showToast({ title: 'Info', message: 'Aksi konfirmasi modal default dijalankan.', type: 'info' });
                            this.closeModal();
                        });
                    }

                    this.showOverlay();
                    DOM.modalWrapper.classList.add('active');
                    this._activeModal = DOM.modal;
                    this._activateFocusTrap(DOM.modal); // Aktifkan focus trap
                },
                closeModal: function () {
                    if (!this._activeModal) return;
                    this._deactivateFocusTrap(DOM.modal); // Nonaktifkan focus trap
                    DOM.modalWrapper.classList.remove('active');
                    this._activeModal = null;
                    this.hideOverlay();
                },

                // --- Off-canvas Methods ---
                openOffcanvas: function ({ title = 'Judul Panel', bodyContent = '<p>Konten panel.</p>', position = 'right' }) {
                    if (this._activeOffcanvas) return;

                    DOM.offcanvasTitle.innerHTML = Utils.escapeHTML(title);
                    DOM.offcanvasBody.innerHTML = bodyContent; // Asumsikan aman

                    DOM.offcanvas.className = 'offcanvas-panel'; // Reset kelas dasar
                    DOM.offcanvas.classList.add(`offcanvas-panel--${Utils.escapeHTML(position)}`);

                    this.showOverlay();
                    DOM.offcanvas.classList.add('active');
                    this._activeOffcanvas = DOM.offcanvas;
                    this._activateFocusTrap(DOM.offcanvas);
                },
                closeOffcanvas: function () {
                    if (!this._activeOffcanvas) return;
                    this._deactivateFocusTrap(DOM.offcanvas);
                    DOM.offcanvas.classList.remove('active');
                    this._activeOffcanvas = null;
                    this.hideOverlay();
                },

                // --- Alert Methods (untuk pesan di dalam konten halaman) ---
                createAlert: function ({
                    targetContainer = DOM.mainContent.querySelector('.page-container') || DOM.mainContent,
                    type = 'info',
                    iconClass = null,
                    title = null,
                    message, // Asumsikan sudah aman atau akan di-escape jika perlu
                    dismissible = true,
                    duration = null
                }) {
                    const alertId = Utils.generateId('alert-');
                    const alertEl = document.createElement('div');
                    alertEl.id = alertId;
                    alertEl.className = `alert alert-${Utils.escapeHTML(type)}`;
                    alertEl.setAttribute('role', 'alert');

                    const iconMap = {
                        success: 'fas fa-check-circle', danger: 'fas fa-exclamation-triangle',
                        warning: 'fas fa-exclamation-circle', info: 'fas fa-info-circle'
                    };
                    const finalIconClass = Utils.escapeHTML(iconClass || iconMap[type] || 'fas fa-info-circle');

                    let contentHTML = `<i class="${finalIconClass}" aria-hidden="true"></i> <div class="alert-content">`;
                    if (title) {
                        contentHTML += `<h5 class="alert-title">${Utils.escapeHTML(title)}</h5>`;
                    }
                    contentHTML += `${message}</div>`; // Message sudah diasumsikan aman

                    if (dismissible) {
                        alertEl.classList.add('alert-dismissible');
                        contentHTML += `<button type="button" class="alert-close-btn" aria-label="Tutup Alert" data-dismiss-alert="${alertId}">&times;</button>`;
                    }
                    alertEl.innerHTML = contentHTML;

                    if (targetContainer && targetContainer.firstChild) {
                        targetContainer.insertBefore(alertEl, targetContainer.firstChild);
                    } else if (targetContainer) {
                        targetContainer.appendChild(alertEl);
                    } else {
                        console.warn("Target container for alert not found. Appending to main content.");
                        DOM.mainContent.insertBefore(alertEl, DOM.mainContent.firstChild);
                    }


                    if (dismissible) {
                        const closeBtn = alertEl.querySelector(`[data-dismiss-alert="${alertId}"]`);
                        if (closeBtn) closeBtn.addEventListener('click', () => alertEl.remove());
                    }

                    if (duration) {
                        setTimeout(() => alertEl.remove(), duration);
                    }
                    return alertEl;
                },

                // --- Toast Methods ---
                showToast: function ({
                    title = 'Notifikasi',
                    message, // Asumsikan aman
                    type = 'info',
                    duration = 5000,
                    iconClass = null
                }) {
                    const toastId = Utils.generateId('toast-');
                    const toastEl = document.createElement('div');
                    toastEl.id = toastId;
                    toastEl.className = `toast toast--${Utils.escapeHTML(type)}`;
                    toastEl.setAttribute('role', 'alert');
                    toastEl.setAttribute('aria-live', 'assertive');
                    toastEl.setAttribute('aria-atomic', 'true');

                    const iconMap = {
                        success: 'fas fa-check-circle', danger: 'fas fa-exclamation-triangle',
                        warning: 'fas fa-exclamation-circle', info: 'fas fa-info-circle'
                    };
                    const finalIconClass = Utils.escapeHTML(iconClass || iconMap[type] || 'fas fa-info-circle');

                    toastEl.innerHTML = `
                        <div class="toast-header">
                            <i class="${finalIconClass}" aria-hidden="true"></i>
                            <strong class="toast-title">${Utils.escapeHTML(title)}</strong>
                            <small class="toast-timestamp text-muted">Baru saja</small>
                            <button type="button" class="toast-close-btn" aria-label="Tutup Toast">&times;</button>
                        </div>
                        <div class="toast-body">${message}</div>`;

                    DOM.toastContainer.appendChild(toastEl);
                    void toastEl.offsetWidth; // Trigger reflow
                    toastEl.classList.add('show');

                    const closeBtn = toastEl.querySelector('.toast-close-btn');
                    const removeToast = () => {
                        toastEl.classList.remove('show');
                        toastEl.addEventListener('transitionend', () => toastEl.remove(), { once: true });
                    };
                    if (closeBtn) closeBtn.addEventListener('click', removeToast);
                    if (duration) setTimeout(removeToast, duration);
                    return toastEl;
                },

                // --- Flash Message Methods (pesan di atas konten utama) ---
                showFlashMessage: function ({
                    message, // Asumsikan aman
                    type = 'info',
                    duration = 7000,
                    dismissible = true,
                    title = null
                }) {
                    const flashEl = this.createAlert({
                        targetContainer: DOM.flashMessageContainer,
                        type: type, title: title, message: message,
                        dismissible: dismissible, duration: duration
                    });
                    if (flashEl) flashEl.style.pointerEvents = 'auto';
                    return flashEl;
                }
            };


            //=============================================
            //========= MANAJEMEN TEMA ====================
            //=============================================
            const ThemeManager = {
                init: function () {
                    this.applyTheme(AppState.currentTheme);
                    DOM.themeToggleButtonHeader.addEventListener('click', () => this.toggleTheme());
                    // Observer untuk perubahan tema, jika ada elemen chart yang perlu di-update
                    const observer = new MutationObserver((mutationsList) => {
                        for (const mutation of mutationsList) {
                            if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
                                this._handleThemeChangeForCharts();
                            }
                        }
                    });
                    observer.observe(DOM.html, { attributes: true });
                },
                applyTheme: function (theme) {
                    DOM.html.setAttribute('data-theme', theme);
                    AppState.currentTheme = theme;
                    localStorage.setItem('ApertureFindTheme', theme);
                    this._updateThemeButtonIcon(theme);
                },
                toggleTheme: function () {
                    const newTheme = AppState.currentTheme === 'light' ? 'dark' : 'light';
                    this.applyTheme(newTheme);
                },
                _updateThemeButtonIcon: function (theme) {
                    const iconElement = DOM.themeToggleButtonHeader.querySelector('i');
                    if (iconElement) {
                        iconElement.className = theme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
                        DOM.themeToggleButtonHeader.setAttribute('aria-label', theme === 'dark' ? 'Ganti ke Tema Terang' : 'Ganti ke Tema Gelap');
                        DOM.themeToggleButtonHeader.title = theme === 'dark' ? 'Ganti ke Tema Terang' : 'Ganti ke Tema Gelap';
                    }
                },
                _handleThemeChangeForCharts: function () {
                    // Jika chart pendapatan ada dan halaman dashboard aktif
                    if ((AppState.activeRoute === 'dashboard' || AppState.activeRoute === '') && PageRenderer._initializeRevenueChart) {
                        if (AppState.revenueChartInstance) {
                            AppState.revenueChartInstance.destroy();
                            AppState.revenueChartInstance = null;
                        }
                        // Panggil fungsi render chart jika elemen canvas ada
                        if (document.getElementById('revenueChart')) {
                            PageRenderer._initializeRevenueChart();
                        }
                    }
                }
            };

            //=============================================
            //========= MANAJEMEN SIDEBAR ===============
            //=============================================
            const SidebarManager = {
                init: function () {
                    this.renderUserProfile();
                    DOM.sidebarToggleBtn.addEventListener('click', () => this.toggleSidebar());
                    DOM.sidebarOverlay.addEventListener('click', () => this.closeSidebarMobile()); // Overlay spesifik sidebar

                    DOM.allNavLinks.forEach(link => {
                        link.addEventListener('click', (e) => {
                            if (window.innerWidth < 768 && DOM.appSidebar.classList.contains('open')) {
                                this.closeSidebarMobile();
                            }
                        });
                    });
                    this.updateSidebarStateForWindowSize();
                    window.addEventListener('resize', Utils.debounce(() => this.updateSidebarStateForWindowSize(), 150));

                    if (window.innerWidth >= 768) {
                        if (AppState.isSidebarCollapsedDesktop) {
                            DOM.appSidebar.classList.add('collapsed');
                            DOM.sidebarToggleBtn.setAttribute('aria-expanded', 'false');
                        } else {
                            DOM.appSidebar.classList.remove('collapsed');
                            DOM.sidebarToggleBtn.setAttribute('aria-expanded', 'true');
                        }
                        this._updateMainAreaMargin();
                        this._updateSidebarToggleIcon();
                    }
                },
                renderUserProfile: function () {
                    DOM.sidebarProfileImg.src = Utils.escapeHTML(AppState.userProfile.photoUrl);
                    DOM.sidebarProfileImg.alt = `Foto profil ${Utils.escapeHTML(AppState.userProfile.name)}`;
                    DOM.sidebarProfileName.textContent = Utils.escapeHTML(AppState.userProfile.name);
                    DOM.sidebarProfileRole.textContent = Utils.escapeHTML(AppState.userProfile.role);
                },
                toggleSidebar: function () {
                    const isMobile = window.innerWidth < 768;
                    if (isMobile) {
                        DOM.appSidebar.classList.toggle('open');
                        DOM.sidebarOverlay.classList.toggle('active'); // Toggle overlay spesifik sidebar
                        AppState.isSidebarOpenMobile = DOM.appSidebar.classList.contains('open');
                        DOM.sidebarToggleBtn.setAttribute('aria-expanded', AppState.isSidebarOpenMobile.toString());
                        if (AppState.isSidebarOpenMobile) DOM.body.classList.add('no-scroll'); else DOM.body.classList.remove('no-scroll');
                    } else {
                        DOM.appSidebar.classList.toggle('collapsed');
                        AppState.isSidebarCollapsedDesktop = DOM.appSidebar.classList.contains('collapsed');
                        localStorage.setItem('ApertureFindSidebarCollapsed', AppState.isSidebarCollapsedDesktop);
                        DOM.sidebarToggleBtn.setAttribute('aria-expanded', (!AppState.isSidebarCollapsedDesktop).toString());
                        this._updateMainAreaMargin();
                    }
                    this._updateSidebarToggleIcon();
                },
                closeSidebarMobile: function () {
                    if (window.innerWidth < 768) {
                        DOM.appSidebar.classList.remove('open');
                        DOM.sidebarOverlay.classList.remove('active'); // Nonaktifkan overlay spesifik sidebar
                        AppState.isSidebarOpenMobile = false;
                        DOM.sidebarToggleBtn.setAttribute('aria-expanded', 'false');
                        DOM.body.classList.remove('no-scroll');
                        this._updateSidebarToggleIcon();
                    }
                },
                updateSidebarStateForWindowSize: function () {
                    const isMobile = window.innerWidth < 768;
                    if (isMobile) {
                        DOM.appSidebar.classList.remove('collapsed'); // Hapus state desktop
                        if (AppState.isSidebarOpenMobile) {
                            DOM.appSidebar.classList.add('open');
                            DOM.sidebarOverlay.classList.add('active');
                            DOM.sidebarToggleBtn.setAttribute('aria-expanded', 'true');
                            DOM.body.classList.add('no-scroll');
                        } else {
                            this.closeSidebarMobile();
                        }
                    } else {
                        DOM.sidebarOverlay.classList.remove('active'); // Pastikan overlay spesifik nonaktif
                        DOM.appSidebar.classList.remove('open');
                        AppState.isSidebarOpenMobile = false;
                        DOM.body.classList.remove('no-scroll');

                        if (AppState.isSidebarCollapsedDesktop) {
                            DOM.appSidebar.classList.add('collapsed');
                            DOM.sidebarToggleBtn.setAttribute('aria-expanded', 'false');
                        } else {
                            DOM.appSidebar.classList.remove('collapsed');
                            DOM.sidebarToggleBtn.setAttribute('aria-expanded', 'true');
                        }
                    }
                    this._updateMainAreaMargin();
                    this._updateSidebarToggleIcon();
                },
                _updateMainAreaMargin: function () {
                    let marginLeft = '0';
                    let width = '100%';
                    if (window.innerWidth >= 768) {
                        const sidebarWidthVar = AppState.isSidebarCollapsedDesktop ? '--sidebar-width-collapsed' : '--sidebar-width-desktop';
                        const currentSidebarWidth = Utils.getCssVariableValue(sidebarWidthVar);
                        marginLeft = currentSidebarWidth;
                        width = `calc(100% - ${currentSidebarWidth})`;
                    }
                    DOM.mainAreaWrapper.style.marginLeft = marginLeft;
                    DOM.mainAreaWrapper.style.width = width;
                },
                _updateSidebarToggleIcon: function () {
                    const iconElement = DOM.sidebarToggleBtn.querySelector('i');
                    let sidebarIsEffectivelyOpenOrExpanded;
                    if (window.innerWidth < 768) {
                        sidebarIsEffectivelyOpenOrExpanded = AppState.isSidebarOpenMobile;
                    } else {
                        sidebarIsEffectivelyOpenOrExpanded = !AppState.isSidebarCollapsedDesktop;
                    }
                    if (sidebarIsEffectivelyOpenOrExpanded) {
                        iconElement.classList.remove('fa-bars');
                        iconElement.classList.add('fa-times');
                        DOM.sidebarToggleBtn.setAttribute('aria-label', 'Tutup navigasi sidebar');
                    } else {
                        iconElement.classList.remove('fa-times');
                        iconElement.classList.add('fa-bars');
                        DOM.sidebarToggleBtn.setAttribute('aria-label', 'Buka navigasi sidebar');
                    }
                }
            };

            //=============================================
            //========= MANAJEMEN NOTIFIKASI & BADGE ======
            //=============================================
            const NotificationManager = {
                init: function () {
                    this.updateUnreadCountBadges();
                    this.updateUnreadMessageCountBadge();
                },
                updateUnreadCountBadges: function () {
                    const unreadCount = AppState.notifications.filter(n => n.unread).length;
                    const badges = [DOM.notifBadgeCountHeader, DOM.notifBadgeCountSidebar];
                    badges.forEach(badge => {
                        if (badge) {
                            if (unreadCount > 0) {
                                badge.textContent = unreadCount > 99 ? '99+' : unreadCount.toString();
                                badge.classList.remove('d-none');
                            } else {
                                badge.classList.add('d-none');
                            }
                        }
                    });
                },
                updateUnreadMessageCountBadge: function () {
                    const unreadMessages = AppState.unreadMessagesCount;
                    if (DOM.messagesBadgeCount) {
                        if (unreadMessages > 0) {
                            DOM.messagesBadgeCount.textContent = unreadMessages > 99 ? '99+' : unreadMessages.toString();
                            DOM.messagesBadgeCount.classList.remove('d-none');
                        } else {
                            DOM.messagesBadgeCount.classList.add('d-none');
                        }
                    }
                },
                markNotificationAsReadOrUnread: function (notificationId) {
                    const notification = AppState.notifications.find(n => n.id === notificationId);
                    if (notification) {
                        notification.unread = !notification.unread;
                        this.updateUnreadCountBadges();
                        if (AppState.activeRoute === 'notifications') {
                            PageRenderer.notifications(); // Re-render halaman notifikasi
                        }
                        UIManager.showToast({
                            title: 'Status Notifikasi Diubah',
                            message: `Notifikasi "${Utils.escapeHTML(notification.title)}" telah ditandai sebagai ${notification.unread ? 'belum dibaca' : 'sudah dibaca'}.`,
                            type: 'info'
                        });
                    }
                },
                deleteNotificationById: function (notificationId) {
                    const notification = AppState.notifications.find(n => n.id === notificationId);
                    if (notification) {
                        AppState.notifications = AppState.notifications.filter(n => n.id !== notificationId);
                        this.updateUnreadCountBadges();
                        UIManager.showToast({
                            title: 'Notifikasi Dihapus',
                            message: `Notifikasi "${Utils.escapeHTML(notification.title)}" telah dihapus.`,
                            type: 'success'
                        });
                        if (AppState.activeRoute === 'notifications') {
                            PageRenderer.notifications(); // Re-render halaman
                        }
                    }
                },
                addSampleNotification: function () {
                    const types = ['info', 'success', 'warning', 'danger'];
                    const icons = {
                        info: 'fas fa-info-circle', success: 'fas fa-check-circle',
                        warning: 'fas fa-triangle-exclamation', danger: 'fas fa-shield-alt' // Contoh ikon, bisa disesuaikan
                    };
                    const categories = ['Umum', 'Penting', 'Update Sistem', 'Promosi Acara', 'Keuangan', 'Pemeliharaan'];
                    const randomTypeIndex = Math.floor(Math.random() * types.length);
                    const randomType = types[randomTypeIndex];

                    const newNotif = {
                        id: AppState.nextNotificationId++,
                        title: `Contoh Notifikasi Baru #${AppState.nextNotificationId - 1} (${randomType})`,
                        message: "Ini adalah pesan notifikasi contoh yang ditambahkan secara dinamis. Perhatikan perubahan pada badge notifikasi dan tampilan list.",
                        type: randomType,
                        icon: icons[randomType],
                        timestamp: new Date(),
                        category: categories[Math.floor(Math.random() * categories.length)],
                        unread: true
                    };
                    AppState.notifications.unshift(newNotif); // Tambah di awal array agar muncul paling atas
                    this.updateUnreadCountBadges();

                    UIManager.showToast({
                        title: "Notifikasi Baru",
                        message: `Notifikasi "${Utils.escapeHTML(newNotif.title)}" berhasil ditambahkan.`,
                        type: "success"
                    });

                    if (AppState.activeRoute === 'notifications') {
                        PageRenderer.notifications(); // Re-render jika di halaman notifikasi
                    }
                },
                getFilteredNotifications: function () {
                    return AppState.notifications.filter(n => {
                        const filterMatch = (AppState.currentNotificationFilter === 'all') ||
                            (AppState.currentNotificationFilter === 'unread' && n.unread) ||
                            (AppState.currentNotificationFilter === 'read' && !n.unread);
                        const categoryMatch = (AppState.currentNotificationCategory === 'all') ||
                            (n.category === AppState.currentNotificationCategory);
                        return filterMatch && categoryMatch;
                    }).sort((a, b) => b.timestamp - a.timestamp); // Urutkan dari terbaru
                }
            };

            //=============================================
            //========= RENDERER HALAMAN ==================
            //=============================================
            const PageRenderer = {
                _showLoader: function () {
                    DOM.mainContent.innerHTML = `
                        <div class="loader-container" role="status" aria-live="polite">
                            <div class="loader"><span class="sr-only">Memuat konten...</span></div>
                            <p class="mt-3 text-muted">Sedang memuat halaman, mohon tunggu...</p>
                        </div>`;
                    DOM.mainContent.style.opacity = '0.5';
                },
                _hideLoader: function () {
                    DOM.mainContent.style.opacity = '1';
                },
                _renderPageStructure: function (pageTitle, contentHTML, pageSpecificId = '') {
                    AppState.activePageTitle = pageTitle;
                    document.title = `${Utils.escapeHTML(pageTitle)} | ApertureFind Admin`;
                    if (DOM.pageTitleHeader) {
                        DOM.pageTitleHeader.textContent = Utils.escapeHTML(pageTitle);
                    }
                    const pageContainerIdAttr = pageSpecificId ? ` id="${Utils.escapeHTML(pageSpecificId)}"` : '';
                    DOM.mainContent.innerHTML = `<div class="page-container container"${pageContainerIdAttr}>${contentHTML}</div>`;
                    this._hideLoader();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    DOM.mainContent.setAttribute('aria-label', `Konten halaman ${Utils.escapeHTML(pageTitle)} telah dimuat.`);
                },

                dashboard: function () {
                    const stats = AppState.dashboardStats;
                    const content = `
                        <h1 class="mb-6">Dashboard Ringkasan</h1>
                        <div class="grid grid-cols-1 sm-grid-cols-2 md-grid-cols-2 lg-grid-cols-4 gap-6">
                            <article class="card stat-card type-primary">
                                <i class="fas fa-chart-line stat-icon" aria-hidden="true"></i>
                                <span class="stat-value">${Utils.escapeHTML(stats.occupancyRate)}%</span>
                                <span class="stat-label">Tingkat Hunian</span>
                                ${Utils.formatPercentageChange(stats.occupancyChange)}
                            </article>
                            <article class="card stat-card type-secondary">
                                <i class="fas fa-coins stat-icon" aria-hidden="true"></i> <!-- Ikon diganti jadi lebih relevan -->
                                <span class="stat-value">${Utils.formatCurrency(stats.monthlyRevenue)}</span>
                                <span class="stat-label">Pendapatan Bulanan</span>
                                ${Utils.formatPercentageChange(stats.revenueChange)}
                            </article>
                            <article class="card stat-card type-warning">
                                <i class="fas fa-clipboard-list stat-icon" aria-hidden="true"></i> <!-- Ikon diganti -->
                                <span class="stat-value">${Utils.escapeHTML(stats.pendingRequests)}</span>
                                <span class="stat-label">Permintaan Tertunda</span>
                                <div class="stat-change positive"><i class="fas fa-plus-circle mr-1"></i> ${stats.newRequestsToday} baru hari ini</div>
                            </article>
                            <article class="card stat-card type-success">
                                <i class="fas fa-users-line stat-icon" aria-hidden="true"></i> <!-- Ikon diganti -->
                                <span class="stat-value">${Utils.escapeHTML(stats.activeTenants)}</span>
                                <span class="stat-label">Total Penyewa Aktif</span>
                                <div class="stat-change positive"><i class="fas fa-user-plus mr-1"></i> ${stats.newTenants} penyewa baru</div>
                            </article>
                        </div>

                        <div class="grid grid-cols-1 lg-grid-cols-3 gap-6 mt-8">
                            <div class="lg-col-span-2">
                                <article class="card">
                                    <div class="card-header d-flex justify-between align-center">
                                        <h3 class="card-title m-0">Grafik Pendapatan (6 Bulan Terakhir)</h3>
                                        <button class="btn btn-sm btn-outline-primary" onclick="UIManager.showToast({title: 'Info Grafik', message: 'Fitur filter dan detail data grafik akan segera hadir!', type: 'info'})"><i class="fas fa-filter mr-1"></i> Filter</button>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="revenueChart" aria-label="Grafik Pendapatan 6 Bulan Terakhir"></canvas>
                                        </div>
                                    </div>
                                </article>
                            </div>
                            <div class="lg-col-span-1">
                                <article class="card h-full"> <!-- h-full agar tinggi sama dengan chart -->
                                    <div class="card-header d-flex justify-between align-center">
                                        <h3 class="card-title m-0">Aktivitas Terbaru</h3>
                                        <a href="#/notifications" class="btn btn-sm btn-outline-primary">Lihat Semua</a>
                                    </div>
                                    <div class="card-body">
                                        ${AppState.recentActivities.length > 0 ? `
                                        <ul class="activity-list">
                                            ${AppState.recentActivities.map(activity => `
                                                <li class="activity-item">
                                                    <div class="activity-item__icon activity-item__icon--${Utils.escapeHTML(activity.type)}"><i class="${Utils.escapeHTML(activity.icon)}" aria-hidden="true"></i></div>
                                                    <div class="activity-item__content">
                                                        <p>${activity.text}</p> <!-- HTML dalam text sudah aman di sini -->
                                                        <small>${Utils.escapeHTML(Utils.timeAgo(activity.time))}</small> <!-- Menggunakan timeAgo -->
                                                    </div>
                                                </li>
                                            `).join('')}
                                        </ul>
                                        ` : `<p class="text-muted text-center py-4">Tidak ada aktivitas terbaru.</p>`}
                                    </div>
                                </article>
                            </div>
                        </div>

                        <section class="mt-8">
                            <article class="card">
                                <div class="card-header d-flex justify-between align-center">
                                     <h3 class="card-title m-0">Pembayaran Terbaru</h3>
                                     <a href="#/payments" class="btn btn-sm btn-outline-primary"><i class="fas fa-list-ul mr-1"></i> Lihat Semua Pembayaran</a>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table--striped" aria-label="Tabel Pembayaran Terbaru">
                                            <thead>
                                                <tr>
                                                    <th>ID Transaksi</th>
                                                    <th>Penyewa</th>
                                                    <th>Apartemen</th>
                                                    <th>Jumlah</th>
                                                    <th>Tanggal</th>
                                                    <th>Status</th>
                                                    <th class="text-center">Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                ${AppState.recentPayments.length > 0 ? AppState.recentPayments.map(payment => `
                                                    <tr>
                                                        <td><a href="#" onclick="UIManager.showFlashMessage({title: 'Info Detail', message: 'Detail transaksi ${Utils.escapeHTML(payment.id)} belum tersedia.', type: 'info'})" aria-label="Detail transaksi ${Utils.escapeHTML(payment.id)}">${Utils.escapeHTML(payment.id)}</a></td>
                                                        <td>${Utils.escapeHTML(payment.tenant)}</td>
                                                        <td>${Utils.escapeHTML(payment.apartment)}</td>
                                                        <td>${Utils.formatCurrency(payment.amount)}</td>
                                                        <td>${Utils.escapeHTML(new Date(payment.date).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' }))}</td>
                                                        <td><span class="badge badge--${Utils.escapeHTML(payment.status.toLowerCase().replace(' ', '-'))}">${Utils.escapeHTML(payment.status)}</span></td>
                                                        <td class="text-center"><button class="btn btn-sm btn-icon-only btn-outline-primary" aria-label="Lihat Detail Pembayaran ${Utils.escapeHTML(payment.id)}" title="Lihat Detail" onclick="UIManager.showFlashMessage({title: 'Info Detail', message: 'Detail transaksi ${Utils.escapeHTML(payment.id)} belum tersedia.', type: 'info'})"><i class="fas fa-eye"></i></button></td>
                                                    </tr>
                                                `).join('') : `<tr><td colspan="7" class="text-center py-4 text-muted">Tidak ada data pembayaran terbaru.</td></tr>`}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </article>
                        </section>
                    `;
                    this._renderPageStructure('Dashboard', content, 'page-dashboard');
                    this._initializeRevenueChart();
                },
                _initializeRevenueChart: function () {
                    const chartCanvas = document.getElementById('revenueChart');
                    if (!chartCanvas || typeof Chart === 'undefined') return;

                    if (AppState.revenueChartInstance) {
                        AppState.revenueChartInstance.destroy();
                    }
                    const isDarkMode = AppState.currentTheme === 'dark';
                    const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.07)';
                    const textColor = Utils.getCssVariableValue('--text-color');
                    const primaryColor = Utils.getCssVariableValue('--primary-color');
                    const primaryColorRgba = `rgba(${Utils.getCssVariableValue('--primary-color-rgb')}, 1)`;
                    const primaryColorFillRgba = `rgba(${Utils.getCssVariableValue('--primary-color-rgb')}, 0.2)`;
                    const cardBgColor = Utils.getCssVariableValue('--card-bg-color');

                    AppState.revenueChartInstance = new Chart(chartCanvas.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun'],
                            datasets: [{
                                label: 'Pendapatan (Juta Rp)',
                                data: [65, 59, 80, 81, 56, 95].map(d => d + Math.floor(Math.random() * 10 - 5)), // Data dengan sedikit variasi
                                borderColor: primaryColorRgba,
                                backgroundColor: primaryColorFillRgba,
                                tension: 0.4, fill: true,
                                pointBackgroundColor: primaryColorRgba,
                                pointBorderColor: cardBgColor,
                                pointRadius: 5, pointHoverRadius: 8,
                                pointHoverBackgroundColor: cardBgColor,
                                pointHoverBorderColor: primaryColorRgba,
                                pointHoverBorderWidth: 2.5,
                                borderWidth: 2.5,
                            }]
                        },
                        options: {
                            responsive: true, maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: { color: gridColor, borderColor: gridColor, drawBorder: false },
                                    ticks: {
                                        color: textColor, font: { family: Utils.getCssVariableValue('--font-family-sans'), size: 12 }, padding: 10,
                                        callback: function (value) { return value + ' Jt'; }
                                    }
                                },
                                x: {
                                    grid: { display: false },
                                    ticks: { color: textColor, font: { family: Utils.getCssVariableValue('--font-family-sans'), size: 12 }, padding: 10 }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: true, position: 'bottom', align: 'start',
                                    labels: { color: textColor, font: { family: Utils.getCssVariableValue('--font-family-sans'), size: 13 }, usePointStyle: true, boxWidth: 8, padding: 20 }
                                },
                                tooltip: {
                                    enabled: true, mode: 'index', intersect: false,
                                    backgroundColor: cardBgColor, titleColor: textColor, bodyColor: textColor,
                                    titleFont: { family: Utils.getCssVariableValue('--font-family-sans'), weight: 'bold', size: 14 },
                                    bodyFont: { family: Utils.getCssVariableValue('--font-family-sans'), size: 12 },
                                    padding: 12, cornerRadius: parseFloat(Utils.getCssVariableValue('--border-radius-md')),
                                    borderColor: Utils.getCssVariableValue('--border-color'), borderWidth: 1,
                                    displayColors: true, boxPadding: 4,
                                    callbacks: {
                                        label: function (context) {
                                            let label = context.dataset.label || '';
                                            if (label) { label += ': '; }
                                            if (context.parsed.y !== null) {
                                                label += Utils.formatCurrency(context.parsed.y * 1000000);
                                            }
                                            return label;
                                        }
                                    }
                                }
                            },
                            interaction: { mode: 'nearest', axis: 'x', intersect: false },
                        }
                    });
                },
                profile: function () {
                    const user = AppState.userProfile;
                    const content = `
                        <h1 class="mb-6">Profil Saya</h1>
                        <div class="card">
                            <div class="card-body d-flex flex-column align-center text-center p-6">
                                <img src="${Utils.escapeHTML(user.photoUrl)}" alt="Foto ${Utils.escapeHTML(user.name)}" class="rounded-full shadow-lg mb-4 profile-avatar">
                                <h2 class="fw-bold fs-2xl mb-1 profile-name">${Utils.escapeHTML(user.name)}</h2>
                                <p class="text-primary fw-medium fs-lg mb-4">${Utils.escapeHTML(user.role)}</p>
                                <button class="btn btn-primary btn-lg" onclick="UIManager.showToast({title: 'Info Profil', message: 'Fitur Edit Profil akan segera hadir dalam versi berikutnya!', type: 'info'})"><i class="fas fa-user-edit mr-2" aria-hidden="true"></i> Edit Profil</button>
                            </div>
                        </div>
                        <div class="card mt-6">
                            <div class="card-header"><h3 class="card-title">Informasi Akun Detail</h3></div>
                            <div class="card-body">
                                <ul class="list-unstyled profile-details-list">
                                    <li class="d-flex justify-between align-center flex-wrap gap-2">
                                        <span class="fw-medium text-muted">Email Terdaftar:</span>
                                        <span class="fw-semibold">${Utils.escapeHTML(user.name.toLowerCase().replace(/\s+/g, '.'))}@aperturefind.com</span>
                                    </li>
                                    <li class="d-flex justify-between align-center flex-wrap gap-2">
                                        <span class="fw-medium text-muted">Nomor Telepon:</span>
                                        <span class="fw-semibold">+62 812 3456 7890 (Contoh)</span>
                                    </li>
                                    <li class="d-flex justify-between align-center flex-wrap gap-2">
                                        <span class="fw-medium text-muted">Tanggal Bergabung:</span>
                                        <span class="fw-semibold">12 Januari 2023 (Contoh)</span>
                                    </li>
                                     <li class="d-flex justify-between align-center flex-wrap gap-2">
                                        <span class="fw-medium text-muted">Status Akun:</span>
                                        <span class="fw-semibold text-success"><i class="fas fa-check-circle mr-1"></i>Aktif Terverifikasi</span>
                                    </li>
                                </ul>
                                <p class="mt-6 fs-sm text-muted text-center">Fitur profil yang lebih lengkap dan kustomisasi akan segera hadir. Pantau terus pembaruan dari kami untuk pengalaman terbaik!</p>
                            </div>
                             <div class="card-footer">
                                <button class="btn btn-outline-danger" onclick="UIManager.showToast({title: 'Info Akun', message: 'Fitur Nonaktifkan Akun belum tersedia.', type: 'warning'})"><i class="fas fa-user-slash mr-2"></i> Nonaktifkan Akun</button>
                                <button class="btn btn-primary" onclick="UIManager.showToast({title: 'Info Keamanan', message: 'Fitur Ubah Kata Sandi akan segera hadir.', type: 'info'})"><i class="fas fa-key mr-2"></i> Ubah Kata Sandi</button>
                            </div>
                        </div>
                    `;
                    this._renderPageStructure('Profil Saya', content, 'page-profile');
                },
                apartments: function () {
                    const searchTerm = AppState.currentApartmentSearchTerm.toLowerCase();
                    const filteredApartments = AppState.apartments.filter(apt =>
                        apt.name.toLowerCase().includes(searchTerm) ||
                        apt.city.toLowerCase().includes(searchTerm) ||
                        apt.description.toLowerCase().includes(searchTerm)
                    );

                    let apartmentsHTML = `
                        <div class="d-flex justify-between align-center mb-6 flex-wrap gap-4">
                            <h1 class="m-0">Manajemen Apartemen</h1>
                            <div class="apartment-search-filter d-flex align-center gap-3" style="min-width: 300px;">
                                <div class="form-group flex-grow-1 m-0">
                                  <label for="apartment-search-input" class="sr-only">Cari Apartemen</label>
                                  <input type="search" id="apartment-search-input" class="form-control" placeholder="Cari nama, kota, deskripsi..." value="${Utils.escapeHTML(AppState.currentApartmentSearchTerm)}" aria-label="Pencarian Apartemen">
                                </div>
                                <button class="btn btn-primary" onclick="UIManager.showModal({ title: 'Tambah Unit Apartemen', bodyContent: '<p>Formulir tambah unit akan ditampilkan di sini. Fitur ini sedang dalam pengembangan.</p><div class=\'form-group\'><label for=\'aptNameModal\' class=\'form-label\'>Nama Apartemen:</label><input type=\'text\' id=\'aptNameModal\' class=\'form-control\' placeholder=\'Contoh: Apartemen Sejahtera Blok A1\'></div>', footerButtons: [{text: 'Simpan Unit', action:'save', class:'btn-success'},{text:'Batal', action:'cancel', class:'btn-outline-secondary'}] })"><i class="fas fa-plus mr-2"></i> Tambah Unit</button>
                            </div>
                        </div>
                    `;

                    if (filteredApartments.length === 0) {
                        apartmentsHTML += `
                            <div class="card text-center py-8">
                                <i class="fas fa-building-circle-xmark fa-4x text-muted mb-4" aria-hidden="true"></i>
                                <h3 class="text-muted fw-semibold">Oops! Apartemen Tidak Ditemukan</h3>
                                <p class="text-subtle fs-lg">Tidak ada apartemen yang cocok dengan pencarian "${Utils.escapeHTML(AppState.currentApartmentSearchTerm)}".</p>
                                <p class="text-subtle">Silakan coba kata kunci lain atau bersihkan filter pencarian.</p>
                            </div>`;
                    } else {
                        apartmentsHTML += `<div class="grid sm-grid-cols-1 md-grid-cols-2 lg-grid-cols-3 gap-6">`;
                        filteredApartments.forEach(apt => {
                            apartmentsHTML += `
                                <div class="card apartment-card">
                                    <div class="card-img-top-wrapper">
                                        <img src="${Utils.escapeHTML(apt.imageUrl)}&sig=${apt.id}" alt="${Utils.escapeHTML(apt.name)}" class="card-img-top">
                                    </div>
                                    <div class="card-body">
                                        <h3 class="card-title fw-bold">${Utils.escapeHTML(apt.name)}</h3>
                                        <p class="text-muted fs-sm mb-3"><i class="fas fa-map-marker-alt mr-1 text-primary" aria-hidden="true"></i> ${Utils.escapeHTML(apt.city)}</p>
                                        <p class="fs-sm mb-3 text-subtle" style="min-height: 60px;">${Utils.escapeHTML(apt.description.substring(0, 100))}...</p>
                                        <div class="details">
                                            <span><i class="fas fa-bed" aria-hidden="true"></i> ${Utils.escapeHTML(apt.bedrooms)} KT</span>
                                            <span><i class="fas fa-bath" aria-hidden="true"></i> ${Utils.escapeHTML(apt.bathrooms)} KM</span>
                                            <span><i class="fas fa-ruler-combined" aria-hidden="true"></i> ${Utils.escapeHTML(apt.area)} m</span>
                                        </div>
                                        <div class="d-flex justify-between align-center mt-auto">
                                            <p class="price m-0">${Utils.formatCurrency(apt.price)}<span class="fs-xs text-muted fw-normal"> / bulan</span></p>
                                            <button class="btn btn-primary btn-sm" onclick="UIManager.showFlashMessage({title: 'Info Apartemen', message: 'Fitur detail untuk ${Utils.escapeHTML(apt.name)} akan segera hadir.', type: 'info'})"><i class="fas fa-info-circle mr-1" aria-hidden="true"></i> Detail</button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        apartmentsHTML += '</div>';
                    }
                    this._renderPageStructure('Manajemen Apartemen', apartmentsHTML, 'page-apartments');

                    const searchInput = document.getElementById('apartment-search-input');
                    if (searchInput) {
                        searchInput.addEventListener('input', Utils.debounce((e) => {
                            AppState.currentApartmentSearchTerm = e.target.value;
                            PageRenderer.apartments();
                        }, 350));
                    }
                },
                _renderPlaceholderPage: function (title, iconClass, message, extraContent = '') {
                    const content = `
                        <div class="page-placeholder">
                            <i class="${iconClass} page-placeholder__icon" aria-hidden="true"></i>
                            <h2 class="page-placeholder__title">Halaman ${Utils.escapeHTML(title)}</h2>
                            <p class="page-placeholder__message">${Utils.escapeHTML(message)}</p>
                            <p class="text-subtle mt-3">Fitur ini sedang dalam tahap pengembangan intensif dan akan segera tersedia untuk Anda dengan pengalaman terbaik. Mohon bersabar!</p>
                            ${extraContent}
                            <a href="#/dashboard" class="btn btn-primary btn-lg mt-4"><i class="fas fa-arrow-left mr-2" aria-hidden="true"></i> Kembali ke Dashboard</a>
                        </div>`;
                    this._renderPageStructure(title, content, `page-${title.toLowerCase().replace(/\s+/g, '-')}`);
                },
                tenants: function () { this._renderPlaceholderPage('Manajemen Penyewa', 'fas fa-users-cog', 'Kelola data penyewa, kontrak, dan riwayat sewa secara terpusat dan efisien.'); },
                payments: function () { this._renderPlaceholderPage('Manajemen Pembayaran', 'fas fa-file-invoice-dollar', 'Lacak semua transaksi, kelola tagihan, dan integrasikan dengan gateway pembayaran.'); },
                reports: function () { this._renderPlaceholderPage('Laporan & Analitik', 'fas fa-chart-bar', 'Hasilkan laporan keuangan, operasional, dan analitik mendalam untuk pengambilan keputusan.'); },
                messages: function () { this._renderPlaceholderPage('Pusat Pesan', 'fas fa-headset', 'Komunikasi terintegrasi dengan penyewa dan tim internal, serta kelola tiket dukungan.'); },

                settings: function () {
                    const demoButtons = `
                        <div class="card mt-6">
                            <div class="card-header"><h3 class="card-title">Demo Komponen UI Terpadu</h3></div>
                            <div class="card-body d-flex flex-wrap gap-3 justify-center">
                                <button class="btn btn-primary" id="btnOpenModalDemo">Buka Modal</button>
                                <button class="btn btn-secondary" id="btnOpenModalLgDemo">Modal Besar (LG)</button>
                                <button class="btn btn-success" id="btnOpenOffcanvasRightDemo">Off-canvas Kanan</button>
                                <button class="btn btn-info" id="btnOpenOffcanvasLeftDemo">Off-canvas Kiri</button>
                                <button class="btn btn-warning" id="btnShowToastSuccessDemo">Toast Sukses</button>
                                <button class="btn btn-danger" id="btnShowToastErrorDemo">Toast Error</button>
                                <button class="btn btn-outline-primary" id="btnShowFlashInfoDemo">Flash Info Global</button>
                                <button class="btn btn-outline-secondary" id="btnShowDynamicAlertDemo">Alert Dinamis Lokal</button>
                            </div>
                        </div>`;
                    this._renderPlaceholderPage('Pengaturan Aplikasi', 'fas fa-sliders-h', 'Konfigurasi preferensi sistem, manajemen pengguna admin, peran, dan integrasi pihak ketiga.', demoButtons);
                    this._attachSettingsPageListeners(); // Pastikan listener terpasang setelah render
                },
                _attachSettingsPageListeners: function () {
                    // Pastikan elemen ada sebelum menambahkan listener
                    document.getElementById('btnOpenModalDemo')?.addEventListener('click', () => {
                        UIManager.openModal({
                            title: 'Modal Contoh Standar',
                            bodyContent: '<p>Ini adalah konten untuk modal standar. Anda bisa memasukkan <strong>HTML</strong> di sini.</p><div class="form-group mt-3"><label for="modalInputDemo" class="form-label">Input Contoh:</label><input type="text" id="modalInputDemo" class="form-control" placeholder="Ketik sesuatu..."></div>',
                            footerButtons: [
                                { text: 'Tutup Saja', action: 'close', class: 'btn-outline-secondary', closesModal: true },
                                { text: 'Aksi Kustom', action: 'custom', class: 'btn-success', onClick: () => UIManager.showToast({ title: 'Aksi Modal', message: 'Aksi kustom berhasil dilakukan!', type: 'success' }), closesModal: true }
                            ]
                        });
                    });
                    document.getElementById('btnOpenModalLgDemo')?.addEventListener('click', () => {
                        UIManager.openModal({
                            title: 'Modal Contoh Besar (LG)',
                            size: 'lg',
                            bodyContent: `<p>Ini adalah modal dengan ukuran besar. Cocok untuk form yang lebih kompleks atau menampilkan data tabel.</p>
                                         <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                                         <img src="https://source.unsplash.com/random/700x200/?office,desk" alt="Random desk image" class="rounded-md mt-3">`,
                            footerButtons: [{ text: 'OK', action: 'ok', class: 'btn-primary', closesModal: true }]
                        });
                    });
                    document.getElementById('btnOpenOffcanvasRightDemo')?.addEventListener('click', () => {
                        UIManager.openOffcanvas({
                            title: 'Panel Off-canvas Kanan',
                            bodyContent: '<h4>Pengaturan Cepat</h4><p>Ini adalah panel yang muncul dari sisi kanan. Berguna untuk menu tambahan, filter, atau form singkat.</p><div class="form-check"><input class="form-check-input" type="checkbox" value="" id="flexCheckDefaultOcDemo"><label class="form-check-label" for="flexCheckDefaultOcDemo">Aktifkan fitur X</label></div>',
                            position: 'right'
                        });
                    });
                    document.getElementById('btnOpenOffcanvasLeftDemo')?.addEventListener('click', () => {
                        UIManager.openOffcanvas({
                            title: 'Panel Off-canvas Kiri',
                            bodyContent: '<h4>Navigasi Tambahan</h4><p>Panel dari sisi kiri. Bisa untuk navigasi sekunder atau detail konteks.</p><ul><li><a href="#">Link 1</a></li><li><a href="#">Link 2</a></li></ul>',
                            position: 'left'
                        });
                    });
                    document.getElementById('btnShowToastSuccessDemo')?.addEventListener('click', () => {
                        UIManager.showToast({ title: 'Sukses!', message: 'Operasi berhasil dilakukan dengan gemilang.', type: 'success' });
                    });
                    document.getElementById('btnShowToastErrorDemo')?.addEventListener('click', () => {
                        UIManager.showToast({ title: 'Error!', message: 'Terjadi kesalahan saat memproses permintaan Anda.', type: 'danger', duration: 8000 });
                    });
                    document.getElementById('btnShowFlashInfoDemo')?.addEventListener('click', () => {
                        UIManager.showFlashMessage({ title: 'Informasi Penting!', message: 'Ini adalah pesan flash yang akan hilang setelah beberapa saat. Update sistem terjadwal malam ini pukul 02:00 WIB.', type: 'info' });
                    });
                    document.getElementById('btnShowDynamicAlertDemo')?.addEventListener('click', () => {
                        const targetForAlert = document.querySelector('#page-pengaturan-aplikasi .page-placeholder') || DOM.mainContent;
                        UIManager.createAlert({
                            targetContainer: targetForAlert,
                            title: 'Alert Dinamis Lokal',
                            message: 'Ini adalah alert yang dibuat secara dinamis oleh JavaScript dan disisipkan ke halaman ini. Bisa juga otomatis hilang jika durasi diset.',
                            type: 'warning',
                            dismissible: true,
                        });
                    });
                },

                notifications: function () {
                    this._showLoader();
                    const filteredNotifications = NotificationManager.getFilteredNotifications();
                    const uniqueCategories = [...new Set(AppState.notifications.map(n => n.category || 'Lainnya'))]; // Pastikan kategori tidak null

                    let notificationsHTML = `
                        <div class="d-flex justify-between align-center mb-6 flex-wrap gap-3">
                            <div>
                                <h1 class="m-0">Notifikasi</h1>
                                <p class="text-muted fs-sm m-0">Semua pemberitahuan dan update penting untuk Anda.</p>
                            </div>
                            <button id="addSampleNotificationPageBtn" class="btn btn-sm btn-primary"><i class="fas fa-plus-circle mr-1" aria-hidden="true"></i> Tambah Contoh Notifikasi</button>
                        </div>

                        <div class="card mb-6">
                            <div class="card-body notification-filters">
                                <div class="form-group mb-0 flex-grow-1" style="min-width: 180px;">
                                    <label for="filter-type" class="form-label fs-xs fw-medium text-subtle">Filter Status:</label>
                                    <div class="select-wrapper">
                                        <select id="filter-type" class="form-control form-control-sm" aria-label="Filter notifikasi berdasarkan status">
                                            <option value="all" ${AppState.currentNotificationFilter === 'all' ? 'selected' : ''}>Semua Status</option>
                                            <option value="unread" ${AppState.currentNotificationFilter === 'unread' ? 'selected' : ''}>Belum Dibaca</option>
                                            <option value="read" ${AppState.currentNotificationFilter === 'read' ? 'selected' : ''}>Sudah Dibaca</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group mb-0 flex-grow-1" style="min-width: 180px;">
                                    <label for="filter-category" class="form-label fs-xs fw-medium text-subtle">Filter Kategori:</label>
                                    <div class="select-wrapper">
                                        <select id="filter-category" class="form-control form-control-sm" aria-label="Filter notifikasi berdasarkan kategori">
                                            <option value="all" ${AppState.currentNotificationCategory === 'all' ? 'selected' : ''}>Semua Kategori</option>
                                            ${uniqueCategories.map(cat => `<option value="${Utils.escapeHTML(cat)}" ${AppState.currentNotificationCategory === cat ? 'selected' : ''}>${Utils.escapeHTML(cat)}</option>`).join('')}
                                        </select>
                                    </div>
                                </div>
                                <button id="clearNotificationFiltersBtn" class="btn btn-sm btn-outline-secondary"><i class="fas fa-filter-circle-xmark mr-1" aria-hidden="true"></i> Bersihkan Filter</button>
                            </div>
                        </div>
                    `;

                    if (filteredNotifications.length === 0) {
                        notificationsHTML += `<div class="card text-center py-8"><i class="fas fa-bell-slash fa-4x text-muted mb-4" aria-hidden="true"></i><h3 class="text-muted fw-semibold">Tidak Ada Notifikasi</h3><p class="text-subtle fs-lg">Saat ini tidak ada notifikasi yang sesuai dengan filter yang Anda pilih.</p></div>`;
                    } else {
                        notificationsHTML += '<div id="notification-list-container" role="list" class="card"><div class="card-body p-0">';
                        filteredNotifications.forEach(notif => {
                            const templateNode = DOM.notificationItemTemplate.content.cloneNode(true);
                            const notifElement = templateNode.querySelector('.notification-item');
                            notifElement.dataset.id = notif.id;
                            const markReadBtn = notifElement.querySelector('.mark-as-read');

                            if (notif.unread) {
                                notifElement.classList.add('unread');
                                markReadBtn.title = "Tandai sebagai sudah dibaca";
                                markReadBtn.querySelector('i').className = 'fas fa-check-circle';
                                markReadBtn.querySelector('.sr-only').textContent = "Tandai sebagai sudah dibaca";
                            } else {
                                notifElement.classList.remove('unread');
                                markReadBtn.title = "Tandai sebagai belum dibaca";
                                markReadBtn.querySelector('i').className = 'fas fa-envelope-open';
                                markReadBtn.querySelector('.sr-only').textContent = "Tandai sebagai belum dibaca";
                            }

                            const iconWrapper = notifElement.querySelector('.icon-wrapper');
                            iconWrapper.classList.add(`type-${Utils.escapeHTML(notif.type)}`);
                            iconWrapper.querySelector('i').className = Utils.escapeHTML(notif.icon);

                            notifElement.querySelector('.notification-title').textContent = Utils.escapeHTML(notif.title);
                            notifElement.querySelector('.notification-message').textContent = Utils.escapeHTML(notif.message);
                            notifElement.querySelector('.timestamp').textContent = Utils.timeAgo(notif.timestamp);
                            notifElement.querySelector('.category').textContent = Utils.escapeHTML(notif.category);

                            const srSummary = `${notif.title}, kategori ${notif.category}, ${Utils.timeAgo(notif.timestamp)}. ${notif.unread ? 'Belum dibaca.' : 'Sudah dibaca.'}`;
                            notifElement.setAttribute('aria-label', srSummary);

                            notificationsHTML += notifElement.outerHTML;
                        });
                        notificationsHTML += '</div></div>';
                    }
                    this._renderPageStructure('Notifikasi', notificationsHTML, 'page-notifications');
                    this._attachNotificationPageListeners();
                },
                _attachNotificationPageListeners: function () {
                    const container = document.getElementById('notification-list-container');
                    if (container) {
                        container.addEventListener('click', (event) => {
                            const targetButton = event.target.closest('button.btn');
                            if (!targetButton) return;
                            const item = targetButton.closest('.notification-item');
                            if (!item || !item.dataset.id) return;

                            const id = parseInt(item.dataset.id, 10);
                            const notification = AppState.notifications.find(n => n.id === id);
                            if (!notification) return; // Pastikan notifikasi ada

                            if (targetButton.classList.contains('mark-as-read')) {
                                NotificationManager.markNotificationAsReadOrUnread(id);
                            } else if (targetButton.classList.contains('delete-notification')) {
                                UIManager.openModal({
                                    title: 'Konfirmasi Hapus Notifikasi',
                                    bodyContent: `<p>Apakah Anda yakin ingin menghapus notifikasi ini: "<strong>${Utils.escapeHTML(notification.title)}</strong>"?</p><p class="text-danger mt-2"><i class="fas fa-exclamation-triangle mr-1"></i> Aksi ini tidak dapat diurungkan.</p>`,
                                    footerButtons: [
                                        { text: 'Batal', action: 'cancel', class: 'btn-outline-secondary' },
                                        { text: 'Ya, Hapus', action: 'delete', class: 'btn-danger', onClick: () => NotificationManager.deleteNotificationById(id) }
                                    ]
                                });
                            }
                        });
                    }
                    document.getElementById('filter-type')?.addEventListener('change', (e) => { AppState.currentNotificationFilter = e.target.value; PageRenderer.notifications(); });
                    document.getElementById('filter-category')?.addEventListener('change', (e) => { AppState.currentNotificationCategory = e.target.value; PageRenderer.notifications(); });
                    document.getElementById('addSampleNotificationPageBtn')?.addEventListener('click', () => NotificationManager.addSampleNotification());
                    document.getElementById('clearNotificationFiltersBtn')?.addEventListener('click', () => {
                        AppState.currentNotificationFilter = 'all';
                        AppState.currentNotificationCategory = 'all';
                        PageRenderer.notifications();
                    });
                },
                notFound: function () {
                    const content = `
                        <div class="page-placeholder">
                            <i class="fas fa-ghost page-placeholder__icon" style="font-size: 5rem; opacity:0.7;" aria-hidden="true"></i>
                            <h2 class="page-placeholder__title text-danger">404 - Halaman Tidak Ditemukan</h2>
                            <p class="page-placeholder__message">Oops! Sepertinya halaman yang Anda cari telah menghilang ke dimensi lain atau sedang berlibur.</p>
                            <a href="#/dashboard" class="btn btn-primary btn-lg"><i class="fas fa-home mr-2" aria-hidden="true"></i> Kembali ke Dashboard</a>
                        </div>`;
                    this._renderPageStructure('Halaman Tidak Ditemukan', content, 'page-notfound');
                }
            };

            //=============================================
            //========= ROUTER APLIKASI (SPA) =============
            //=============================================
            const AppRouter = {
                routes: {
                    '/': PageRenderer.dashboard.bind(PageRenderer),
                    '/dashboard': PageRenderer.dashboard.bind(PageRenderer),
                    '/profile': PageRenderer.profile.bind(PageRenderer),
                    '/apartments': PageRenderer.apartments.bind(PageRenderer),
                    '/tenants': PageRenderer.tenants.bind(PageRenderer),
                    '/payments': PageRenderer.payments.bind(PageRenderer),
                    '/reports': PageRenderer.reports.bind(PageRenderer),
                    '/notifications': PageRenderer.notifications.bind(PageRenderer),
                    '/messages': PageRenderer.messages.bind(PageRenderer),
                    '/settings': PageRenderer.settings.bind(PageRenderer)
                },
                init: function () {
                    window.addEventListener('hashchange', () => this.handleRouteChange());
                    window.addEventListener('DOMContentLoaded', () => {
                        if (DOM.initialAppLoader) {
                            setTimeout(() => {
                                DOM.initialAppLoader.style.opacity = '0';
                                DOM.initialAppLoader.style.visibility = 'hidden';
                                DOM.initialAppLoader.addEventListener('transitionend', () => {
                                    if (DOM.initialAppLoader) DOM.initialAppLoader.remove();
                                }, { once: true });
                            }, 500);
                        }
                        this.handleRouteChange();
                    });
                },
                handleRouteChange: function () {
                    if (UIManager._activeModal) UIManager.closeModal();
                    if (UIManager._activeOffcanvas) UIManager.closeOffcanvas();
                    if (DOM.flashMessageContainer) DOM.flashMessageContainer.innerHTML = '';

                    const rawPath = window.location.hash.slice(1) || '/';
                    const path = rawPath.split('?')[0];
                    const normalizedPath = path.startsWith('/') ? path : `/${path}`;
                    const routeKey = (normalizedPath === '/' || normalizedPath === '') ? 'dashboard' : normalizedPath.substring(1);
                    AppState.activeRoute = routeKey;
                    PageRenderer._showLoader();

                    setTimeout(() => {
                        const pageTitle = Utils.getPageTitleFromRoute(AppState.activeRoute);
                        let routeHandler = this.routes[normalizedPath] || this.routes[path] || ((normalizedPath === '/' || normalizedPath === '') ? this.routes['/'] : null);

                        if (routeHandler) {
                            routeHandler();
                            AppState.activePageTitle = pageTitle;
                        } else {
                            PageRenderer.notFound();
                            AppState.activeRoute = 'notFound';
                            AppState.activePageTitle = 'Halaman Tidak Ditemukan';
                        }
                        this.updateActiveNavLink();
                        if (DOM.pageTitleHeader) {
                            DOM.pageTitleHeader.textContent = Utils.escapeHTML(AppState.activePageTitle);
                        }
                    }, 150);
                },
                updateActiveNavLink: function () {
                    DOM.allNavLinks.forEach(link => {
                        link.classList.remove('active');
                        link.removeAttribute('aria-current');
                        const linkRoute = link.dataset.route;
                        if (linkRoute === AppState.activeRoute) {
                            link.classList.add('active');
                            link.setAttribute('aria-current', 'page');
                        }
                    });
                }
            };

            //=============================================
            //========= PENCARIAN GLOBAL ==================
            //=============================================
            const GlobalSearch = {
                init: function () {
                    if (DOM.globalSearchInput) {
                        DOM.globalSearchInput.addEventListener('keypress', (event) => {
                            if (event.key === 'Enter') {
                                const searchTerm = DOM.globalSearchInput.value.trim();
                                if (searchTerm) this.performSearch(searchTerm);
                            }
                        });
                    }
                },
                performSearch: function (term) {
                    if (AppState.activeRoute === 'apartments') {
                        AppState.currentApartmentSearchTerm = term;
                        PageRenderer.apartments();
                        UIManager.showToast({ title: 'Pencarian Apartemen', message: `Mencari apartemen dengan kata kunci: "${Utils.escapeHTML(term)}"`, type: 'info' });
                    } else {
                        // Navigasi ke halaman apartemen dan lakukan pencarian
                        AppState.currentApartmentSearchTerm = term;
                        window.location.hash = '#/apartments'; // Ini akan memicu router dan render ulang
                        // Pesan bisa ditampilkan setelah navigasi jika diperlukan, atau di halaman apartemen
                        UIManager.showFlashMessage({
                            title: 'Pencarian Global',
                            message: `Hasil pencarian untuk "${Utils.escapeHTML(term)}" ditampilkan di halaman Apartemen.`,
                            type: 'info'
                        });
                    }
                    // Pertimbangkan untuk tidak mengosongkan input agar user bisa refine
                    // DOM.globalSearchInput.value = '';
                }
            };


            //=============================================
            //========= INISIALISASI APLIKASI =============
            //=============================================
            function initializeApp() {
                cacheNavLinks();
                if (DOM.currentYearSpan) {
                    DOM.currentYearSpan.textContent = new Date().getFullYear().toString();
                }
                ThemeManager.init();
                SidebarManager.init();
                UIManager.init();
                NotificationManager.init();
                GlobalSearch.init();
                AppRouter.init();

                console.info('ApertureFind Admin Dashboard v1.5 (Fancy UI Enhanced) berhasil dimuat.');
                console.log('Initial App State:', {
                    theme: AppState.currentTheme,
                    sidebarOpenMobile: AppState.isSidebarOpenMobile,
                    sidebarCollapsedDesktop: AppState.isSidebarCollapsedDesktop,
                    activeRoute: AppState.activeRoute
                });

                UIManager.showFlashMessage({
                    title: "Selamat Datang Kembali!",
                    message: "ApertureFind Dashboard siap melayani Anda dengan tampilan dan fitur yang lebih canggih.",
                    type: "success",
                    duration: 8000
                });
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeApp);
            } else {
                initializeApp();
            }

        })();
    </script>
</body>

</html>