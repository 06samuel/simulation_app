<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Platform penyewaan apartemen modern dengan pencarian canggih dan UI intuitif. Temukan properti impian Anda dengan mudah.">
    <meta name="keywords" content="sewa apartemen, apartemen premium, Green Valley, properti, real estate">
    <meta name="author" content="Green Valley Team">
    <title>Green Valley | Sewa Apartemen & Manajemen Properti</title>

    <!-- Favicon (Contoh menggunakan emoji sebagai favicon, ganti dengan file .ico atau .png jika ada) -->
    <link rel="icon"
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACPUlEQVR4Ae2VA7TcQBSGP7QdASNADEA0AEYAMgAwAGQAGQCYAMgAMgAwADIAIgAyiCgwkEAmYJ6bN7e7ZKe5VO/U+fXf/r179s3Ozj5DQt+GUMgXqlC5i0rBPhJ2JS6r4hP4CmxEBH9R7B3YxAR+RPhA2JfgJESEFwB1YAPWgC+k9gBciPgd2BAh8XNkswYYBG2AS3l7NMAXYg6GcA07gAWwC9gTkZ0Md2AdOAJLwAuwANgT6Z9MGYAQwB14BTyA974APAVeA9dAARbARvAAuAfuBFxI/AF0gcvAfazpl4j3gVPAduBCRM85728p0AYIVATeA78CL6SAAUhbBZwD7kQ0gZ3Ab2BDRHkGfAROAE9T+xbAXSDQCp9T2d0FmhHhRmBfV7Y8PtaqYh5W5YaUPh7V2wJ2CVAnAnRhAd2YVHZNYKckJr9n24uLLmM/x4E7kSsC+CpAdjQkbQDvAOdGCBzZXSoPvKS+KjAZESeW286WpwFgePXWDYyJ27XgYVvAhPA8MvM7HoBnp7S7AsgN1AT4O1c66Ubqg54lVqPACYBR4I7H+u6RjsAGcB2wJbPEhjMAh4E3ImI1vUBjYBLmQ0wnwAD4C0L/xMJtH26BtwB3gJXEveA7cAhiL7tB0gG+hH8Jal3oC3gO+BWRJ1XzAcL5J9L+A4sAvZEXAMqYIzwAfgcvAGuBAxLZxpkUnAFuBNxFdGv8Wcb9jOB3A68C7gRkZ8kLMoPz0PfAUNIHQWY7xv4A9+3Z0ZzXRFoAAAAAElFTkSuQmCC">

    <!-- Icons - Font Awesome (Online Gratis) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Leaflet CSS (untuk peta, Online Gratis) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!-- Flatpickr CSS (untuk date picker, Online Gratis) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <style>
        /* === Design System & Global Styles === */
        :root {
            /* Palet Warna Utama */
            --primary-color: #2563eb;
            /* Biru modern */
            --primary-hover-color: #1d4ed8;
            /* Biru lebih gelap untuk hover */
            --secondary-color: #0ea5e9;
            /* Biru langit sebagai sekunder */
            --accent-color: #f97316;
            /* Oranye sebagai aksen */
            --success-color: #10b981;
            /* Hijau untuk sukses */
            --warning-color: #f59e0b;
            /* Kuning untuk peringatan */
            --danger-color: #ef4444;
            /* Merah untuk bahaya/error */

            /* Warna Netral */
            --light-color: #f8fafc;
            /* Putih keabu-abuan sangat terang */
            --white-color: #ffffff;
            --dark-color: #1e293b;
            /* Biru tua keabu-abuan (untuk teks utama) */
            --gray-color: #64748b;
            /* Abu-abu sedang (untuk teks sekunder) */
            --light-gray-color: #e2e8f0;
            /* Abu-abu terang (untuk border, divider) */
            --ultra-light-gray-color: #f1f5f9;
            /* Abu-abu sangat terang (untuk background section) */

            /* Tipografi */
            --font-family-sans: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            --text-xs: 0.75rem;
            /* 12px */
            --text-sm: 0.875rem;
            /* 14px */
            --text-base: 1rem;
            /* 16px */
            --text-lg: 1.125rem;
            /* 18px */
            --text-xl: 1.25rem;
            /* 20px */
            --text-2xl: 1.5rem;
            /* 24px */
            --text-3xl: 1.875rem;
            /* 30px */
            --text-4xl: 2.25rem;
            /* 36px */
            --font-light: 300;
            --font-normal: 400;
            --font-medium: 500;
            --font-semibold: 600;
            --font-bold: 700;
            --line-height-base: 1.6;
            --line-height-tight: 1.3;

            /* Spasi & Ukuran */
            --space-xxs: 0.25rem;
            /* 4px */
            --space-xs: 0.5rem;
            /* 8px */
            --space-sm: 0.75rem;
            /* 12px */
            --space-md: 1rem;
            /* 16px */
            --space-lg: 1.5rem;
            /* 24px */
            --space-xl: 2rem;
            /* 32px */
            --space-2xl: 3rem;
            /* 48px */
            --space-3xl: 4rem;
            /* 64px */

            /* Border & Radius */
            --border-width: 1px;
            --radius-sm: 0.25rem;
            /* 4px */
            --radius-md: 0.5rem;
            /* 8px */
            --radius-lg: 0.75rem;
            /* 12px */
            --radius-xl: 1rem;
            /* 16px */
            --radius-full: 9999px;

            /* Shadow */
            --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.03);
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.07), 0 1px 2px -1px rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.08), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 6px 10px -2px rgba(0, 0, 0, 0.08), 0 4px 6px -3px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.07);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.07);

            /* Transisi */
            --transition-fast: all 0.15s ease-in-out;
            --transition-base: all 0.25s ease-in-out;
            --transition-slow: all 0.4s ease-in-out;

            /* Z-index (Layering) */
            --z-index-dropdown: 1000;
            --z-index-sticky: 1020;
            --z-index-modal-backdrop: 1040;
            --z-index-modal: 1050;
            --z-index-popover: 1060;
            --z-index-tooltip: 1070;
        }

        /* Reset & Base Styles */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            font-size: 100%;
            /* Default 16px, basis untuk unit rem */
        }

        body {
            font-family: var(--font-family-sans);
            line-height: var(--line-height-base);
            color: var(--dark-color);
            background-color: var(--light-color);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            /* Mencegah scroll horizontal yang tidak diinginkan */
            min-height: 100vh;
            /* Memastikan footer menempel di bawah pada halaman pendek */
            display: flex;
            flex-direction: column;
        }

        main {
            flex-grow: 1;
            /* Konten utama mengisi ruang yang tersedia */
        }

        a {
            text-decoration: none;
            color: var(--primary-color);
            transition: var(--transition-base);
        }

        a:hover {
            color: var(--primary-hover-color);
            text-decoration: underline;
        }

        img,
        picture,
        video,
        canvas {
            max-width: 100%;
            height: auto;
            display: block;
        }

        button,
        input,
        select,
        textarea {
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
            color: inherit;
            border: var(--border-width) solid var(--light-gray-color);
            border-radius: var(--radius-md);
        }

        button {
            cursor: pointer;
            background-color: transparent;
            border: none;
            /* Reset border default tombol */
        }

        input[type="search"]::-webkit-search-decoration,
        input[type="search"]::-webkit-search-cancel-button,
        input[type="search"]::-webkit-search-results-button,
        input[type="search"]::-webkit-search-results-decoration {
            -webkit-appearance: none;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-weight: var(--font-bold);
            line-height: var(--line-height-tight);
            margin-bottom: var(--space-md);
        }

        h1 {
            font-size: var(--text-3xl);
        }

        h2 {
            font-size: var(--text-2xl);
        }

        h3 {
            font-size: var(--text-xl);
        }

        h4 {
            font-size: var(--text-lg);
        }

        p {
            margin-bottom: var(--space-md);
            max-width: 70ch;
            /* Meningkatkan keterbacaan paragraf */
        }

        ul,
        ol {
            list-style: none;
            padding-left: 0;
        }

        /* === Utilitas Umum === */
        .container {
            width: 100%;
            max-width: 1280px;
            /* Lebar kontainer umum */
            margin-left: auto;
            margin-right: auto;
            padding-left: var(--space-md);
            padding-right: var(--space-md);
        }

        .container-fluid {
            width: 100%;
            padding-left: var(--space-md);
            padding-right: var(--space-md);
        }

        /* Flexbox Utilities */
        .d-flex {
            display: flex;
        }

        .flex-column {
            flex-direction: column;
        }

        .flex-wrap {
            flex-wrap: wrap;
        }

        .justify-content-start {
            justify-content: flex-start;
        }

        .justify-content-center {
            justify-content: center;
        }

        .justify-content-end {
            justify-content: flex-end;
        }

        .justify-content-between {
            justify-content: space-between;
        }

        .justify-content-around {
            justify-content: space-around;
        }

        .align-items-start {
            align-items: flex-start;
        }

        .align-items-center {
            align-items: center;
        }

        .align-items-end {
            align-items: flex-end;
        }

        .align-items-stretch {
            align-items: stretch;
        }

        /* Gap Utilities */
        .gap-xxs {
            gap: var(--space-xxs);
        }

        .gap-xs {
            gap: var(--space-xs);
        }

        .gap-sm {
            gap: var(--space-sm);
        }

        .gap-md {
            gap: var(--space-md);
        }

        .gap-lg {
            gap: var(--space-lg);
        }

        .gap-xl {
            gap: var(--space-xl);
        }

        /* Text & Font Utilities */
        .text-center {
            text-align: center;
        }

        .text-left {
            text-align: left;
        }

        .text-right {
            text-align: right;
        }

        .font-bold {
            font-weight: var(--font-bold);
        }

        .font-semibold {
            font-weight: var(--font-semibold);
        }

        .font-medium {
            font-weight: var(--font-medium);
        }

        .text-primary {
            color: var(--primary-color);
        }

        .text-light {
            color: var(--light-color) !important;
        }

        /* Penting untuk override warna teks di background gelap */
        .text-gray {
            color: var(--gray-color);
        }

        .text-xs {
            font-size: var(--text-xs);
        }

        .text-sm {
            font-size: var(--text-sm);
        }

        .text-lg {
            font-size: var(--text-lg);
        }

        .text-xl {
            font-size: var(--text-xl);
        }

        .text-2xl {
            font-size: var(--text-2xl);
        }

        .text-3xl {
            font-size: var(--text-3xl);
        }

        /* Margin & Padding Utilities (contoh, bisa diperluas) */
        .m-0 {
            margin: 0 !important;
        }

        .mt-auto {
            margin-top: auto;
        }

        .mx-auto {
            margin-left: auto;
            margin-right: auto;
        }

        .mb-0 {
            margin-bottom: 0 !important;
        }

        .mb-xs {
            margin-bottom: var(--space-xs);
        }

        .mb-sm {
            margin-bottom: var(--space-sm);
        }

        .mb-md {
            margin-bottom: var(--space-md);
        }

        .mb-lg {
            margin-bottom: var(--space-lg);
        }

        .mb-xl {
            margin-bottom: var(--space-xl);
        }

        .mb-2xl {
            margin-bottom: var(--space-2xl);
        }

        .mt-xs {
            margin-top: var(--space-xs);
        }

        .mt-sm {
            margin-top: var(--space-sm);
        }

        .mt-md {
            margin-top: var(--space-md);
        }

        .mt-lg {
            margin-top: var(--space-lg);
        }

        .mt-xl {
            margin-top: var(--space-xl);
        }

        .p-lg {
            padding: var(--space-lg);
        }

        .mr-xs {
            margin-right: var(--space-xs);
        }

        /* Icon margin */

        /* Border Radius Utilities */
        .rounded-sm {
            border-radius: var(--radius-sm);
        }

        .rounded-md {
            border-radius: var(--radius-md);
        }

        .rounded-lg {
            border-radius: var(--radius-lg);
        }

        .rounded-xl {
            border-radius: var(--radius-xl);
        }

        .rounded-full {
            border-radius: var(--radius-full);
        }

        /* Shadow Utilities */
        .shadow-sm {
            box-shadow: var(--shadow-sm);
        }

        .shadow {
            box-shadow: var(--shadow);
        }

        .shadow-md {
            box-shadow: var(--shadow-md);
        }

        .shadow-lg {
            box-shadow: var(--shadow-lg);
        }

        /* Background Utilities */
        .bg-primary {
            background-color: var(--primary-color);
        }

        .bg-ultra-light-gray {
            background-color: var(--ultra-light-gray-color);
        }

        /* Display Utilities */
        .hidden {
            display: none !important;
        }

        .sr-only {
            /* Screen Reader Only */
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        .section-padding {
            padding-top: var(--space-2xl);
            padding-bottom: var(--space-2xl);
        }

        /* Focus styles untuk aksesibilitas */
        *:focus {
            outline: none;
        }

        /* Hapus outline default */
        a:focus-visible,
        button:focus-visible,
        input:focus-visible,
        select:focus-visible,
        textarea:focus-visible {
            outline: 3px solid var(--primary-color);
            outline-offset: 2px;
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.3);
        }


        /* === Komponen Spesifik === */

        /* Header */
        .app-header {
            background-color: var(--white-color);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: var(--z-index-sticky);
            padding: var(--space-md) 0;
        }

        .app-header .container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            font-size: var(--text-2xl);
            font-weight: var(--font-bold);
            color: var(--primary-color);
            display: flex;
            align-items: center;
            text-decoration: none !important;
            /* Override default link underline */
        }

        .logo:hover {
            color: var(--primary-hover-color);
            text-decoration: none !important;
        }

        .logo i {
            margin-right: var(--space-xs);
            font-size: var(--text-xl);
        }

        .nav-menu {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            /* Spasi antar item menu lebih kecil */
        }

        .nav-link {
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            font-weight: var(--font-medium);
            color: var(--dark-color);
            transition: var(--transition-base);
            position: relative;
            text-decoration: none !important;
            /* Override default link underline */
        }

        .nav-link:hover,
        .nav-link.active {
            background-color: rgba(37, 99, 235, 0.08);
            /* Warna background lebih lembut */
            color: var(--primary-color);
            text-decoration: none !important;
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            /* Sesuaikan agar dekat dengan teks, tergantung padding header */
            left: var(--space-md);
            right: var(--space-md);
            height: 3px;
            /* Underline lebih tebal */
            background-color: var(--primary-color);
            border-radius: 2px;
        }

        .mobile-menu-btn {
            display: none;
            /* Sembunyikan di desktop */
            background: none;
            border: none;
            font-size: var(--text-2xl);
            color: var(--dark-color);
            cursor: pointer;
            padding: var(--space-xs);
            z-index: var(--z-index-sticky) + 1;
            /* Di atas nav-menu jika overlay */
        }

        /* Tombol (Button) */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-sm) var(--space-lg);
            border-radius: var(--radius-md);
            font-weight: var(--font-semibold);
            cursor: pointer;
            transition: var(--transition-base);
            border: var(--border-width) solid transparent;
            font-size: var(--text-base);
            text-decoration: none !important;
            /* Untuk link yang di-style seperti tombol */
            white-space: nowrap;
            line-height: 1.5;
            /* Menjamin konsistensi tinggi tombol */
        }

        .btn i {
            margin-right: var(--space-xs);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: var(--white-color);
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: var(--primary-hover-color);
            border-color: var(--primary-hover-color);
            color: var(--white-color);
        }

        .btn-outline-primary {
            background-color: transparent;
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline-primary:hover {
            background-color: rgba(37, 99, 235, 0.08);
            color: var(--primary-color);
        }

        .btn-lg {
            padding: var(--space-md) var(--space-xl);
            font-size: var(--text-lg);
        }

        .btn-sm {
            padding: var(--space-xs) var(--space-md);
            font-size: var(--text-sm);
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        /* Hero Section */
        .hero-section {
            background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)),
                url('https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80') no-repeat center center/cover;
            color: var(--white-color);
            padding: var(--space-3xl) 0;
            text-align: center;
            display: flex;
            align-items: center;
            min-height: 70vh;
            /* Tinggi hero section */
        }

        .hero-content h1 {
            font-size: var(--text-4xl);
            margin-bottom: var(--space-md);
            color: var(--white-color);
        }

        .hero-content p {
            font-size: var(--text-xl);
            margin-bottom: var(--space-xl);
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            color: rgba(255, 255, 255, 0.9);
        }

        /* Search Form */
        .search-form-wrapper {
            background-color: var(--white-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: var(--space-lg);
            margin-top: calc(-1 * var(--space-3xl));
            /* Tarik ke atas agar overlap dengan hero */
            position: relative;
            z-index: 10;
            /* Di atas hero */
        }

        .search-form .grid {
            display: grid;
            gap: var(--space-md);
        }

        /* Default 1 kolom, responsif ke banyak kolom */
        .search-form .grid {
            grid-template-columns: 1fr;
        }

        @media (min-width: 768px) {

            /* Tablet */
            .search-form .grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {

            /* Desktop */
            .search-form .grid {
                grid-template-columns: repeat(4, 1fr);
                align-items: end;
                /* Tombol sejajar dengan input terakhir */
            }

            .search-form .form-group {
                margin-bottom: 0;
            }
        }

        .form-group {
            margin-bottom: var(--space-md);
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            display: block;
            margin-bottom: var(--space-xs);
            font-weight: var(--font-semibold);
            font-size: var(--text-sm);
            color: var(--dark-color);
        }

        .form-group label i {
            margin-right: var(--space-xxs);
            color: var(--primary-color);
        }

        .form-control {
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            border: var(--border-width) solid var(--light-gray-color);
            border-radius: var(--radius-md);
            transition: var(--transition-base);
            background-color: var(--white-color);
            font-size: var(--text-base);
            line-height: 1.5;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
            /* Custom focus shadow */
        }

        .form-control::placeholder {
            color: var(--gray-color);
            opacity: 0.7;
        }

        .form-control[type="checkbox"] {
            /* Styling khusus checkbox */
            width: auto;
            height: auto;
            margin-right: var(--space-xs);
            vertical-align: middle;
        }

        .form-group-inline {
            /* Untuk checkbox dan label sejajar */
            flex-direction: row;
            align-items: center;
        }

        .form-group-inline label {
            margin-bottom: 0;
            font-weight: var(--font-normal);
        }


        /* Card (untuk daftar apartemen, fitur, testimoni, dll.) */
        .card {
            background-color: var(--white-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: var(--transition-base);
            display: flex;
            flex-direction: column;
            height: 100%;
            /* Agar semua card sama tinggi dalam grid */
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card-img {
            width: 100%;
            height: 220px;
            object-fit: cover;
        }

        .card-body {
            padding: var(--space-lg);
            flex-grow: 1;
            /* Agar body mengisi ruang tersedia */
            display: flex;
            flex-direction: column;
        }

        .card-title {
            font-size: var(--text-xl);
            font-weight: var(--font-semibold);
            margin-bottom: var(--space-sm);
            color: var(--dark-color);
        }

        .card-text {
            color: var(--gray-color);
            margin-bottom: var(--space-md);
            font-size: var(--text-base);
            line-height: var(--line-height-base);
        }

        .card-footer {
            padding: var(--space-md) var(--space-lg);
            border-top: var(--border-width) solid var(--light-gray-color);
            background-color: var(--ultra-light-gray-color);
            margin-top: auto;
            /* Dorong footer card ke bawah */
        }

        .card-actions {
            /* Untuk tombol di dalam card body */
            margin-top: auto;
            /* Dorong tombol ke bawah jika card-body flex */
        }


        /* Grid Container */
        .grid-container {
            display: grid;
            gap: var(--space-lg);
            grid-template-columns: 1fr;
            /* Default 1 kolom */
        }

        @media (min-width: 640px) {

            /* sm */
            .grid-container.cols-2-sm {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 768px) {

            /* md */
            .grid-container.cols-2-md {
                grid-template-columns: repeat(2, 1fr);
            }

            .grid-container.cols-3-md {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1024px) {

            /* lg */
            .grid-container.cols-3-lg {
                grid-template-columns: repeat(3, 1fr);
            }

            .grid-container.cols-4-lg {
                grid-template-columns: repeat(4, 1fr);
            }
        }


        /* Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: var(--space-xxs) var(--space-sm);
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: var(--font-semibold);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            line-height: 1;
            /* Mencegah tinggi badge berubah karena ikon */
        }

        .badge-primary {
            background-color: var(--primary-color);
            color: var(--white-color);
        }

        .badge-success {
            background-color: var(--success-color);
            color: var(--white-color);
        }

        .badge-warning {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }

        .badge-danger {
            background-color: var(--danger-color);
            color: var(--white-color);
        }

        .badge-light {
            background-color: var(--light-gray-color);
            color: var(--dark-color);
        }

        .badge-accent {
            background-color: var(--accent-color);
            color: var(--white-color);
        }


        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(30, 41, 59, 0.8);
            /* --dark-color with more opacity */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-index-modal);
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-base), visibility 0s var(--transition-base);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
            transition-delay: 0s;
        }

        .modal-content {
            background-color: var(--white-color);
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 600px;
            /* Lebar modal standar */
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-xl);
            transform: translateY(20px) scale(0.95);
            transition: transform var(--transition-slow) ease-out, opacity var(--transition-slow) ease-out;
        }

        .modal.active .modal-content {
            transform: translateY(0) scale(1);
        }

        .modal-header {
            padding: var(--space-lg);
            border-bottom: var(--border-width) solid var(--light-gray-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: var(--text-xl);
            font-weight: var(--font-semibold);
            margin-bottom: 0;
        }

        .modal-close-btn {
            background: none;
            border: none;
            font-size: var(--text-2xl);
            color: var(--gray-color);
            cursor: pointer;
            padding: var(--space-xs);
            line-height: 1;
            transition: var(--transition-fast);
        }

        .modal-close-btn:hover {
            color: var(--dark-color);
            transform: scale(1.1);
        }

        .modal-body {
            padding: var(--space-lg);
            overflow-y: auto;
            /* Scroll jika konten panjang */
            flex-grow: 1;
        }

        .modal-footer {
            padding: var(--space-lg);
            border-top: var(--border-width) solid var(--light-gray-color);
            display: flex;
            justify-content: flex-end;
            gap: var(--space-sm);
            background-color: var(--ultra-light-gray-color);
            border-bottom-left-radius: var(--radius-lg);
            border-bottom-right-radius: var(--radius-lg);
        }

        /* Footer */
        .app-footer {
            background-color: var(--dark-color);
            color: var(--light-gray-color);
            padding: var(--space-2xl) 0;
            font-size: var(--text-sm);
            margin-top: auto;
            /* Memastikan footer selalu di bawah jika body flex */
        }

        .app-footer .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            /* Kolom lebih adaptif */
            gap: var(--space-lg);
        }

        .footer-col h4 {
            font-size: var(--text-lg);
            color: var(--white-color);
            margin-bottom: var(--space-md);
            position: relative;
            padding-bottom: var(--space-xs);
        }

        .footer-col h4::after {
            /* Underline dekoratif untuk judul footer */
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 40px;
            height: 2px;
            background-color: var(--primary-color);
        }

        .footer-col ul li {
            margin-bottom: var(--space-sm);
        }

        .footer-col ul li a {
            color: var(--light-gray-color);
            text-decoration: none;
        }

        .footer-col ul li a:hover {
            color: var(--white-color);
            text-decoration: underline;
            padding-left: var(--space-xxs);
            /* Efek hover kecil */
        }

        .footer-col p {
            color: var(--light-gray-color);
            /* Pastikan warna teks p di footer konsisten */
            max-width: none;
            /* Hapus batasan max-width paragraf di footer */
        }

        .footer-col p i {
            /* Ikon di info kontak footer */
            color: var(--primary-color);
            margin-right: var(--space-sm);
            width: 20px;
            /* Lebar tetap untuk alignment */
            text-align: center;
        }

        .footer-bottom {
            border-top: 1px solid var(--gray-color);
            padding-top: var(--space-lg);
            margin-top: var(--space-lg);
            text-align: center;
            font-size: var(--text-xs);
        }

        .social-icons a {
            color: var(--light-gray-color);
            margin-right: var(--space-md);
            font-size: var(--text-lg);
            transition: var(--transition-base);
        }

        .social-icons a:last-child {
            margin-right: 0;
        }

        .social-icons a:hover {
            color: var(--primary-color);
            transform: translateY(-2px);
        }


        /* === Sistem Manajemen Properti Styles === */
        .dashboard-grid {
            display: grid;
            gap: var(--space-lg);
        }

        @media (min-width: 768px) {

            /* md */
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {

            /* lg */
            .dashboard-grid.stats-grid {
                /* Untuk kartu statistik */
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }

        .stat-card {
            background-color: var(--white-color);
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            transition: var(--transition-base);
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .stat-card-icon {
            font-size: var(--text-2xl);
            /* Ukuran ikon disesuaikan */
            padding: var(--space-md);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            flex-shrink: 0;
            /* Mencegah ikon mengecil */
        }

        .stat-card-icon.bg-primary-light {
            background-color: rgba(37, 99, 235, 0.1);
            color: var(--primary-color);
        }

        .stat-card-icon.bg-success-light {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .stat-card-icon.bg-warning-light {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        .stat-card-icon.bg-danger-light {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        .stat-card-info h5 {
            font-size: var(--text-base);
            color: var(--gray-color);
            margin-bottom: var(--space-xs);
            font-weight: var(--font-medium);
            text-transform: uppercase;
            /* Lebih formal */
            letter-spacing: 0.5px;
        }

        .stat-card-info p {
            font-size: var(--text-2xl);
            font-weight: var(--font-bold);
            color: var(--dark-color);
            margin-bottom: 0;
        }

        .quick-actions .btn {
            width: 100%;
            margin-bottom: var(--space-sm);
        }

        @media (min-width: 768px) {
            .quick-actions {
                display: flex;
                gap: var(--space-md);
            }

            .quick-actions .btn {
                width: auto;
                flex-grow: 1;
                margin-bottom: 0;
            }
        }


        .activity-list .activity-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
            padding: var(--space-md) 0;
            border-bottom: var(--border-width) solid var(--light-gray-color);
        }

        .activity-list .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            font-size: var(--text-lg);
            color: var(--gray-color);
            margin-top: var(--space-xxs);
            flex-shrink: 0;
            width: 20px;
            text-align: center;
        }

        .activity-details p {
            margin-bottom: var(--space-xs);
            font-size: var(--text-base);
            max-width: none;
        }

        .activity-details .time {
            font-size: var(--text-sm);
            color: var(--gray-color);
        }

        .due-dates-list .due-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md);
            background-color: var(--ultra-light-gray-color);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-sm);
            border-left: 4px solid transparent;
            /* Indikator warna */
            transition: var(--transition-base);
        }

        .due-dates-list .due-item:hover {
            background-color: var(--light-gray-color);
        }

        .due-item.danger {
            border-left-color: var(--danger-color);
        }

        .due-item.warning {
            border-left-color: var(--warning-color);
        }

        .due-item.primary {
            border-left-color: var(--primary-color);
        }

        .due-item-info p {
            margin-bottom: 0;
            font-weight: var(--font-medium);
            max-width: none;
        }

        .due-item-info .subtext {
            font-size: var(--text-sm);
            color: var(--gray-color);
        }


        /* Animasi untuk SPA Page Transitions */
        .page {
            animation: fadeIn 0.4s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Adjustments */
        @media (max-width: 991px) {

            /* Di bawah lg, untuk menu mobile */
            .mobile-menu-btn {
                display: block;
            }

            .nav-menu {
                display: none;
                /* Sembunyikan menu utama */
                position: absolute;
                top: 100%;
                /* Di bawah header */
                left: 0;
                right: 0;
                background-color: var(--white-color);
                box-shadow: var(--shadow-md);
                flex-direction: column;
                padding: var(--space-md);
                gap: var(--space-sm);
                border-top: var(--border-width) solid var(--light-gray-color);
                max-height: calc(100vh - 70px);
                /* Tinggi maksimal menu mobile */
                overflow-y: auto;
            }

            .nav-menu.active {
                display: flex;
                /* Tampilkan saat aktif */
                animation: slideDown 0.3s ease-out;
            }

            .nav-link {
                width: 100%;
                text-align: left;
                padding: var(--space-md);
            }

            .nav-link.active::after {
                display: none;
            }

            /* Sembunyikan underline di mobile */
            .nav-link:hover,
            .nav-link.active {
                background-color: rgba(37, 99, 235, 0.05);
            }

            @keyframes slideDown {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }

                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        }

        @media (max-width: 767px) {

            /* md */
            .hero-section {
                padding: var(--space-2xl) 0;
                min-height: 60vh;
            }

            .hero-content h1 {
                font-size: var(--text-3xl);
            }

            .hero-content p {
                font-size: var(--text-lg);
            }

            .search-form-wrapper {
                margin-top: calc(-1 * var(--space-2xl));
                /* Kurangi overlap di mobile */
                padding: var(--space-md);
            }

            .section-padding {
                padding-top: var(--space-xl);
                padding-bottom: var(--space-xl);
            }

            .app-footer .container {
                text-align: center;
                /* Pusatkan konten footer di mobile */
            }

            .footer-col {
                margin-bottom: var(--space-lg);
            }

            .footer-col h4::after {
                left: 50%;
                transform: translateX(-50%);
            }

            /* Pusatkan underline judul footer */
            .footer-col p i {
                display: block;
                margin: 0 auto var(--space-xs);
            }

            /* Ikon di atas teks pada mobile */
        }

        @media (max-width: 480px) {

            /* xs */
            .hero-content h1 {
                font-size: var(--text-2xl);
            }

            .hero-content p {
                font-size: var(--text-base);
            }

            .btn-lg {
                padding: var(--space-sm) var(--space-lg);
                font-size: var(--text-base);
            }
        }

        /* Leaflet Map Customization */
        .leaflet-popup-content-wrapper {
            border-radius: var(--radius-md) !important;
        }

        .leaflet-popup-content {
            font-family: var(--font-family-sans);
            font-size: var(--text-sm);
            margin: var(--space-sm) !important;
            /* Perbaiki margin default leaflet */
            line-height: var(--line-height-base);
        }

        .leaflet-container {
            /* Menghilangkan outline focus leaflet */
            outline: none !important;
        }

        #mapApartments,
        #contactMap,
        #modalMap {
            z-index: 0;
            /* Pastikan peta di bawah elemen lain jika ada overlay aneh */
        }
    </style>
</head>

<body>
    <!-- Header Aplikasi -->
    <header class="app-header" id="appHeader">
        <div class="container">
            <a href="#home" class="logo" data-route="home">
                <i class="fas fa-city"></i> Green Valley <!-- Ikon diganti menjadi fas fa-city -->
            </a>

            <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle Menu" aria-expanded="false"
                aria-controls="navMenu">
                <i class="fas fa-bars" id="menuIconOpen"></i>
                <i class="fas fa-times hidden" id="menuIconClose"></i>
            </button>

            <nav class="nav-menu" id="navMenu" role="navigation">
                <a href="#home" class="nav-link active" data-route="home">Beranda</a>
                <a href="#search" class="nav-link" data-route="search">Cari Apartemen</a>
                <a href="#propertymanagement" class="nav-link hidden" data-route="propertymanagement"
                    id="navPropertyManagement">Manajemen Properti</a>
                <a href="#features" class="nav-link" data-route="features">Fitur</a>
                <a href="#contact" class="nav-link" data-route="contact">Kontak</a>
                <a href="#login" class="nav-link btn btn-outline-primary btn-sm" data-route="login"
                    id="authLink">Masuk/Daftar</a>
            </nav>
        </div>
    </header>

    <!-- Konten Utama Aplikasi (SPA content area) -->
    <main id="app-content" role="main">
        <!-- Konten akan dimuat di sini oleh JavaScript -->
    </main>

    <!-- Footer Aplikasi -->
    <footer class="app-footer">
        <div class="container">
            <div class="footer-col">
                <h4>Green Valley</h4>
                <p>Menyediakan pengalaman sewa apartemen premium yang tak terlupakan. Temukan kemewahan dan kenyamanan
                    di setiap sudut.</p>
                <div class="social-icons mt-md">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
            <div class="footer-col">
                <h4>Navigasi Cepat</h4>
                <ul>
                    <li><a href="#home" data-route="home">Beranda</a></li>
                    <li><a href="#search" data-route="search">Cari Apartemen</a></li>
                    <li><a href="#propertymanagement" data-route="propertymanagement" id="footerNavPropertyManagement"
                            class="hidden">Manajemen Properti</a></li>
                    <li><a href="#features" data-route="features">Fitur Unggulan</a></li>
                    <li><a href="#contact" data-route="contact">Hubungi Kami</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>Legal</h4>
                <ul>
                    <li><a href="#privacy" data-route="privacy">Kebijakan Privasi</a></li>
                    <li><a href="#terms" data-route="terms">Syarat & Ketentuan</a></li>
                    <li><a href="#faq" data-route="faq">FAQ</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>Kontak Kami</h4>
                <p><i class="fas fa-map-marker-alt"></i> Jl. Sudirman No. 123, Jakarta Pusat</p>
                <p><i class="fas fa-phone"></i> +62 21 1234 5678</p>
                <p><i class="fas fa-envelope"></i> info@Green Valley.com</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; <span id="currentYear"></span> Green Valley. Semua Hak Cipta Dilindungi.</p>
        </div>
    </footer>

    <!-- Modal Template (Contoh: Untuk Login/Register atau Detail) -->
    <div class="modal" id="appModal" aria-hidden="true" role="dialog" aria-labelledby="modalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Judul Modal</h3>
                <button class="modal-close-btn" id="modalCloseBtn" aria-label="Tutup Modal">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Konten modal akan diisi oleh JavaScript -->
                <p>Ini adalah konten placeholder untuk modal.</p>
            </div>
            <div class="modal-footer hidden" id="modalFooter">
                <button class="btn btn-outline-primary" id="modalCancelBtn">Batal</button>
                <button class="btn btn-primary" id="modalConfirmBtn">OK</button>
            </div>
        </div>
    </div>

    <!-- Script Eksternal (Library kecil yang diizinkan) -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/id.js"></script>
    <!-- Lokalisasi Indonesia untuk Flatpickr -->

    <script>
        // === SCRIPT APLIKASI UTAMA (Vanilla JavaScript - Monolith SPA) ===
        document.addEventListener('DOMContentLoaded', () => {

            // === State Aplikasi (Single Source of Truth) ===
            const appState = {
                currentPage: 'home', // Halaman default saat load
                user: null, // Informasi pengguna jika login (contoh: { email: 'user@example.com', name: 'Nama User' })
                apartments: [ // Data contoh untuk apartemen (biasanya dari API)
                    { id: 1, name: 'Apartemen Elegan Pusat Kota', location: 'Jakarta Pusat', price: 15000000, beds: 2, baths: 2, area: 80, image: 'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=870&q=80', featured: true, amenities: ['Kolam Renang', 'Gym', 'Parkir 24 Jam', 'Keamanan CCTV'], lat: -6.1754, lng: 106.8272, description: 'Apartemen mewah di jantung kota Jakarta dengan akses mudah ke pusat bisnis dan perbelanjaan. Nikmati fasilitas lengkap dan pemandangan kota yang menakjubkan.' },
                    { id: 2, name: 'Studio Modern Dekat CBD Kuningan', location: 'Jakarta Selatan', price: 8500000, beds: 1, baths: 1, area: 45, image: 'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=870&q=80', featured: true, amenities: ['Keamanan 24 Jam', 'Akses Kartu', 'Lobi Mewah', 'Internet Cepat'], lat: -6.2297, lng: 106.8297, description: 'Studio apartemen yang stylish dan fungsional, cocok untuk profesional muda. Terletak strategis di kawasan Kuningan dengan berbagai fasilitas pendukung.' },
                    { id: 3, name: 'Penthouse Mewah Pemandangan Pantai Kuta', location: 'Kuta, Bali', price: 35000000, beds: 3, baths: 3, area: 150, image: 'https://images.unsplash.com/photo-1613553507747-801345443554?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=774&q=80', featured: false, amenities: ['Private Lift', 'Infinity Pool Pribadi', 'Bar Tepi Kolam', 'Pelayan Pribadi'], lat: -8.7207, lng: 115.1687, description: 'Rasakan kemewahan tertinggi di penthouse eksklusif ini dengan pemandangan langsung ke Pantai Kuta. Dilengkapi fasilitas premium untuk pengalaman menginap tak terlupakan.' },
                    { id: 4, name: 'Apartemen Keluarga Nyaman di Surabaya Timur', location: 'Surabaya Timur', price: 12000000, beds: 3, baths: 2, area: 100, image: 'https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=780&q=80', featured: true, amenities: ['Playground Anak', 'Jogging Track', 'Taman Asri', 'Minimarket'], lat: -7.2807, lng: 112.7967, description: 'Apartemen luas dan nyaman, ideal untuk keluarga. Lingkungan yang aman dan fasilitas lengkap untuk menunjang aktivitas keluarga Anda.' },
                    { id: 5, name: 'Apartemen Minimalis Bandung Utara', location: 'Bandung Utara', price: 7000000, beds: 2, baths: 1, area: 60, image: 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=870&q=80', featured: false, amenities: ['Udara Sejuk', 'Pemandangan Pegunungan', 'Kafe Rooftop', 'Area BBQ'], lat: -6.8695, lng: 107.6107, description: 'Nikmati kesejukan udara Bandung Utara di apartemen minimalis ini. Desain modern dengan pemandangan alam yang indah, cocok untuk liburan atau tinggal jangka panjang.' }
                ],
                features: [ // Data contoh untuk fitur aplikasi
                    { icon: 'fas fa-search-location', title: 'Pencarian Canggih', description: 'Filter lokasi, harga, fasilitas, dan tipe properti untuk temuan yang presisi dan cepat.' },
                    { icon: 'fas fa-shield-alt', title: 'Transaksi Aman', description: 'Sistem pembayaran terenkripsi dan proses verifikasi data yang aman untuk kenyamanan Anda.' },
                    { icon: 'fas fa-headset', title: 'Dukungan Pelanggan 24/7', description: 'Tim profesional kami siap membantu Anda kapan saja, menjawab pertanyaan dan mengatasi masalah.' },
                    { icon: 'fas fa-vr-cardboard', title: 'Virtual Tour 360°', description: 'Lihat properti secara detail dari berbagai sudut melalui tur virtual interaktif sebelum kunjungan fisik.' },
                    { icon: 'fas fa-file-signature', title: 'Kontrak Digital Mudah', description: 'Proses penyewaan lebih efisien dengan sistem kontrak digital yang aman dan mengikat secara hukum.' },
                    { icon: 'fas fa-bell', title: 'Notifikasi Real-time', description: 'Dapatkan pemberitahuan instan untuk status booking, pembayaran, dan pesan baru dari pemilik properti.' }
                ],
                testimonials: [ // Data contoh untuk testimoni
                    { name: 'Rina S.', quote: 'Proses sewa di Green Valley sangat cepat dan mudah. Apartemennya bersih, sesuai foto, dan fasilitasnya lengkap. Sangat memuaskan!', avatar: 'https://i.pravatar.cc/150?img=1', city: 'Jakarta' },
                    { name: 'Budi P.', quote: 'Saya menemukan apartemen idaman di pusat kota melalui Green Valley. Fitur pencarian dan peta sangat membantu. Pelayanan customer service juga responsif.', avatar: 'https://i.pravatar.cc/150?img=3', city: 'Surabaya' },
                    { name: 'Citra W.', quote: 'Virtual tour 360° benar-benar game changer! Saya bisa melihat detail apartemen sebelum memutuskan untuk menyewa. Highly recommended!', avatar: 'https://i.pravatar.cc/150?img=5', city: 'Bandung' }
                ],
                filters: { // State untuk filter pencarian
                    location: '',
                    priceMin: '',
                    priceMax: '',
                    beds: ''
                }
            };

            // === Elemen DOM Utama ===
            const appContent = document.getElementById('app-content');
            const navLinks = document.querySelectorAll('.nav-link'); // Termasuk link di header
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const navMenu = document.getElementById('navMenu');
            const menuIconOpen = document.getElementById('menuIconOpen');
            const menuIconClose = document.getElementById('menuIconClose');
            const currentYearEl = document.getElementById('currentYear');
            const authLink = document.getElementById('authLink');
            const navPropertyManagement = document.getElementById('navPropertyManagement');
            const footerNavPropertyManagement = document.getElementById('footerNavPropertyManagement');

            // Elemen Modal
            const appModal = document.getElementById('appModal');
            const modalTitleEl = document.getElementById('modalTitle'); // Menggunakan El untuk elemen DOM
            const modalBodyEl = document.getElementById('modalBody');
            const modalFooterEl = document.getElementById('modalFooter');
            const modalCloseBtn = document.getElementById('modalCloseBtn');
            const modalCancelBtn = document.getElementById('modalCancelBtn');
            const modalConfirmBtn = document.getElementById('modalConfirmBtn');

            let leafletMapInstance = null; // Untuk menyimpan instance peta agar bisa di-remove/re-init

            // === Fungsi Utilitas ===
            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(amount);
            };

            const clearContent = () => {
                appContent.innerHTML = ''; // Membersihkan konten utama
                if (leafletMapInstance) { // Hapus instance peta sebelumnya jika ada
                    leafletMapInstance.remove();
                    leafletMapInstance = null;
                }
            };

            const updateActiveNav = (routeName) => {
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.route === routeName) {
                        link.classList.add('active');
                    }
                });
                // Jika menu mobile terbuka, tutup setelah navigasi
                if (navMenu.classList.contains('active')) {
                    toggleMobileMenu();
                }
            };

            // Fungsi untuk render kartu apartemen (reusable)
            const renderApartmentCard = (apt) => {
                return `
                <article class="card">
                    <img src="${apt.image}" alt="Tampilan ${apt.name}" class="card-img">
                    <div class="card-body">
                        <h3 class="card-title">${apt.name}</h3>
                        <p class="card-text text-sm mb-sm"><i class="fas fa-map-marker-alt text-primary mr-xs"></i> ${apt.location}</p>
                        <div class="d-flex justify-content-between text-sm mb-md text-gray">
                            <span><i class="fas fa-bed mr-xs"></i> ${apt.beds} K. Tidur</span>
                            <span><i class="fas fa-bath mr-xs"></i> ${apt.baths} K. Mandi</span>
                            <span><i class="fas fa-ruler-combined mr-xs"></i> ${apt.area} m²</span>
                        </div>
                        <p class="card-text font-bold text-lg text-primary mb-md">${formatCurrency(apt.price)} / bulan</p>
                        <div class="card-actions mt-auto">
                           <button class="btn btn-primary btn-sm btn-block" onclick="app.viewApartmentDetail(${apt.id})">
                             <i class="fas fa-eye"></i> Lihat Detail
                           </button>
                        </div>
                    </div>
                    ${apt.featured ? '<div class="badge badge-accent" style="position:absolute; top: var(--space-sm); left: var(--space-sm); z-index:1;">Unggulan</div>' : ''}
                </article>
            `;
            };

            // === Fungsi Render Halaman (Views) ===
            const pages = {
                home: () => {
                    clearContent();
                    const heroSectionHTML = `
                    <section class="hero-section">
                        <div class="container hero-content">
                            <h1>Temukan Apartemen Impian Anda Bersama Green Valley</h1>
                            <p>Platform sewa apartemen premium dengan fasilitas lengkap di lokasi strategis seluruh Indonesia. Mulai pencarian Anda sekarang dan rasakan kenyamanan tinggal yang sesungguhnya!</p>
                            <a href="#search" data-route="search" class="btn btn-primary btn-lg">
                                <i class="fas fa-search"></i> Cari Apartemen Sekarang
                            </a>
                        </div>
                    </section>
                    `;

                    const searchFormSectionHTML = `
                    <section class="search-form-wrapper container">
                        <form id="homeSearchForm" class="search-form">
                            <h2 class="text-2xl font-semibold mb-lg text-center">Pencarian Cepat Properti</h2>
                            <div class="grid">
                                <div class="form-group">
                                    <label for="homeLocation"><i class="fas fa-map-marked-alt"></i> Lokasi</label>
                                    <input type="text" id="homeLocation" class="form-control" placeholder="cth: Jakarta Selatan, Bali">
                                </div>
                                <div class="form-group">
                                    <label for="homeCheckin"><i class="fas fa-calendar-alt"></i> Tanggal Check-in</label>
                                    <input type="text" id="homeCheckin" class="form-control flatpickr-input" placeholder="Pilih Tanggal">
                                </div>
                                <div class="form-group">
                                    <label for="homeCheckout"><i class="fas fa-calendar-check"></i> Tanggal Check-out</label>
                                    <input type="text" id="homeCheckout" class="form-control flatpickr-input" placeholder="Pilih Tanggal">
                                </div>
                                <div class="form-group">
                                    <button type="submit" class="btn btn-primary btn-block mt-auto" style="padding-top: var(--space-sm); padding-bottom: var(--space-sm);">
                                        <i class="fas fa-search"></i> Cari
                                    </button>
                                </div>
                            </div>
                        </form>
                    </section>
                    `;

                    const featuredApartmentsSectionHTML = `
                    <section class="section-padding container page">
                        <h2 class="text-3xl font-bold text-center mb-xl">Apartemen Unggulan Kami</h2>
                        <div class="grid-container cols-1-sm cols-2-md cols-3-lg">
                            ${appState.apartments.filter(apt => apt.featured).slice(0, 3).map(renderApartmentCard).join('')}
                        </div>
                        <div class="text-center mt-xl">
                            <a href="#search" data-route="search" class="btn btn-outline-primary btn-lg">
                                <i class="fas fa-th-list"></i> Lihat Semua Apartemen
                            </a>
                        </div>
                    </section>
                    `;

                    const featuresSectionHTML = `
                    <section class="section-padding bg-ultra-light-gray page">
                        <div class="container">
                            <h2 class="text-3xl font-bold text-center mb-xl">Mengapa Memilih Green Valley?</h2>
                            <div class="grid-container cols-1-sm cols-2-md cols-3-lg">
                                ${appState.features.slice(0, 6).map(feature => `
                                    <article class="card text-center">
                                        <div class="card-body align-items-center">
                                            <i class="${feature.icon} text-primary text-3xl mb-md"></i>
                                            <h3 class="card-title">${feature.title}</h3>
                                            <p class="card-text text-sm">${feature.description}</p>
                                        </div>
                                    </article>
                                `).join('')}
                            </div>
                        </div>
                    </section>
                    `;

                    const testimonialsSectionHTML = `
                    <section class="section-padding container page">
                        <h2 class="text-3xl font-bold text-center mb-xl">Apa Kata Pelanggan Kami?</h2>
                        <div class="grid-container cols-1-sm cols-2-md cols-3-lg">
                            ${appState.testimonials.map(testimonial => `
                                <article class="card">
                                    <div class="card-body text-center">
                                        <img src="${testimonial.avatar}" alt="Foto ${testimonial.name}" class="rounded-full shadow-md mb-md mx-auto" style="width: 80px; height: 80px; object-fit: cover; border: 3px solid var(--primary-color);">
                                        <p class="card-text font-medium italic">"${testimonial.quote}"</p>
                                        <p class="font-semibold text-primary mt-auto mb-0">- ${testimonial.name}, <span class="text-gray font-normal">${testimonial.city}</span></p>
                                    </div>
                                </article>
                            `).join('')}
                        </div>
                    </section>
                    `;

                    appContent.innerHTML = heroSectionHTML + searchFormSectionHTML + featuredApartmentsSectionHTML + featuresSectionHTML + testimonialsSectionHTML;
                    initFlatpickr('#homeCheckin, #homeCheckout');
                    document.getElementById('homeSearchForm').addEventListener('submit', (e) => {
                        e.preventDefault();
                        const location = document.getElementById('homeLocation').value;
                        // Implementasi logika pencarian sederhana atau navigasi ke halaman search dengan parameter
                        router.navigateTo('search', { location: location });
                    });
                },
                search: (params = {}) => {
                    clearContent();
                    // Update state filter dari URL params atau biarkan default jika tidak ada
                    appState.filters.location = params.location || appState.filters.location || '';
                    appState.filters.priceMin = params.priceMin || appState.filters.priceMin || '';
                    appState.filters.priceMax = params.priceMax || appState.filters.priceMax || '';
                    appState.filters.beds = params.beds || appState.filters.beds || '';

                    // Lakukan filtering berdasarkan state filter
                    let filteredApartments = appState.apartments.filter(apt => {
                        const matchLocation = appState.filters.location ? apt.location.toLowerCase().includes(appState.filters.location.toLowerCase()) : true;
                        const matchPriceMin = appState.filters.priceMin ? apt.price >= parseInt(appState.filters.priceMin) : true;
                        const matchPriceMax = appState.filters.priceMax ? apt.price <= parseInt(appState.filters.priceMax) : true;
                        const matchBeds = appState.filters.beds ? (appState.filters.beds === '3+' ? apt.beds >= 3 : apt.beds == parseInt(appState.filters.beds)) : true;
                        return matchLocation && matchPriceMin && matchPriceMax && matchBeds;
                    });

                    const searchPageContentHTML = `
                    <section class="section-padding container page">
                        <h1 class="text-3xl font-bold mb-lg">Cari Apartemen Impian Anda</h1>
                        <form id="advancedSearchForm" class="search-form-wrapper mb-xl bg-ultra-light-gray shadow-sm">
                             <h2 class="text-xl font-semibold mb-md text-left">Filter Pencarian Lanjutan</h2>
                            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); align-items: end; gap: var(--space-md);">
                                <div class="form-group">
                                    <label for="searchLocation"><i class="fas fa-map-marked-alt"></i> Lokasi</label>
                                    <input type="text" id="searchLocation" class="form-control" placeholder="Kota atau area" value="${appState.filters.location}">
                                </div>
                                <div class="form-group">
                                    <label for="searchPriceMin"><i class="fas fa-dollar-sign"></i> Harga Min (IDR)</label>
                                    <input type="number" id="searchPriceMin" class="form-control" placeholder="cth: 5000000" value="${appState.filters.priceMin}">
                                </div>
                                <div class="form-group">
                                    <label for="searchPriceMax"><i class="fas fa-dollar-sign"></i> Harga Max (IDR)</label>
                                    <input type="number" id="searchPriceMax" class="form-control" placeholder="cth: 20000000" value="${appState.filters.priceMax}">
                                </div>
                                <div class="form-group">
                                    <label for="searchBeds"><i class="fas fa-bed"></i> Jumlah K. Tidur</label>
                                    <select id="searchBeds" class="form-control">
                                        <option value="" ${appState.filters.beds === '' ? 'selected' : ''}>Semua</option>
                                        <option value="1" ${appState.filters.beds === '1' ? 'selected' : ''}>1 Kamar</option>
                                        <option value="2" ${appState.filters.beds === '2' ? 'selected' : ''}>2 Kamar</option>
                                        <option value="3+" ${appState.filters.beds === '3+' ? 'selected' : ''}>3+ Kamar</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <button type="submit" class="btn btn-primary btn-block"><i class="fas fa-filter"></i> Terapkan Filter</button>
                                </div>
                            </div>
                        </form>

                        <h2 class="text-2xl font-semibold mb-md">Hasil Pencarian (${filteredApartments.length} properti ditemukan)</h2>
                        ${filteredApartments.length > 0 ? `
                            <div class="grid-container cols-1-sm cols-2-md cols-3-lg">
                                ${filteredApartments.map(renderApartmentCard).join('')}
                            </div>
                        ` : '<p class="text-lg text-gray text-center py-xl">Tidak ada apartemen yang sesuai dengan kriteria pencarian Anda saat ini. Silakan coba ubah filter Anda.</p>'}
                        
                        <div class="mt-2xl">
                            <h2 class="text-2xl font-semibold mb-md">Lihat Properti di Peta Interaktif</h2>
                            <div id="mapApartments" style="height: 500px; border-radius: var(--radius-lg); box-shadow: var(--shadow-md);"></div>
                        </div>
                    </section>
                    `;
                    appContent.innerHTML = searchPageContentHTML;

                    // Inisialisasi Peta Leaflet
                    const defaultMapView = filteredApartments.length > 0 && filteredApartments[0].lat && filteredApartments[0].lng ? [filteredApartments[0].lat, filteredApartments[0].lng] : [-6.200000, 106.816666];
                    const defaultMapZoom = filteredApartments.length > 0 && filteredApartments[0].lat && filteredApartments[0].lng ? 12 : 10;

                    leafletMapInstance = L.map('mapApartments').setView(defaultMapView, defaultMapZoom);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors | Green Valley'
                    }).addTo(leafletMapInstance);

                    const markers = [];
                    filteredApartments.forEach(apt => {
                        if (apt.lat && apt.lng) {
                            const marker = L.marker([apt.lat, apt.lng])
                                .bindPopup(`<b>${apt.name}</b><br>${apt.location}<br>${formatCurrency(apt.price)}/bulan<br><button class="btn btn-primary btn-sm mt-xs" onclick="app.viewApartmentDetail(${apt.id})">Lihat Detail</button>`);
                            markers.push(marker);
                        }
                    });
                    if (markers.length > 0) {
                        const group = new L.featureGroup(markers);
                        group.addTo(leafletMapInstance);
                        // Hanya fitBounds jika ada lebih dari satu marker, atau jika hanya ada satu tapi ingin zoom lebih dekat
                        if (markers.length > 0) {
                            leafletMapInstance.fitBounds(group.getBounds().pad(0.1)); // pad untuk sedikit margin
                        }
                    }


                    document.getElementById('advancedSearchForm').addEventListener('submit', (e) => {
                        e.preventDefault();
                        // Update state filter dari form
                        appState.filters.location = document.getElementById('searchLocation').value;
                        appState.filters.priceMin = document.getElementById('searchPriceMin').value;
                        appState.filters.priceMax = document.getElementById('searchPriceMax').value;
                        appState.filters.beds = document.getElementById('searchBeds').value;

                        // Bangun query string dari state filter
                        const queryParams = new URLSearchParams();
                        if (appState.filters.location) queryParams.set('location', appState.filters.location);
                        if (appState.filters.priceMin) queryParams.set('priceMin', appState.filters.priceMin);
                        if (appState.filters.priceMax) queryParams.set('priceMax', appState.filters.priceMax);
                        if (appState.filters.beds) queryParams.set('beds', appState.filters.beds);

                        // Navigasi ulang dengan parameter filter baru
                        router.navigateTo('search', Object.fromEntries(queryParams));
                    });
                },
                propertymanagement: () => {
                    if (!appState.user) { // Proteksi halaman, jika belum login, arahkan ke login
                        router.navigateTo('login');
                        app.openModal('authRequired');
                        return;
                    }
                    clearContent();
                    const dashboardContentHTML = `
                    <section class="section-padding container page">
                        <div class="d-flex justify-content-between align-items-center mb-lg flex-wrap gap-md">
                            <h1 class="text-3xl font-bold mb-0">Dasbor Manajemen Properti</h1>
                            <button class="btn btn-primary" onclick="app.openModal('addProperty')">
                                <i class="fas fa-plus-circle"></i> Tambah Properti Baru
                            </button>
                        </div>

                        <div class="dashboard-grid stats-grid mb-xl">
                            <article class="stat-card">
                                <div class="stat-card-icon bg-primary-light"><i class="fas fa-building"></i></div>
                                <div class="stat-card-info">
                                    <h5>Total Properti</h5>
                                    <p>12</p> <!-- Data dummy -->
                                </div>
                            </article>
                            <article class="stat-card">
                                <div class="stat-card-icon bg-success-light"><i class="fas fa-users"></i></div>
                                <div class="stat-card-info">
                                    <h5>Total Penyewa Aktif</h5>
                                    <p>87</p> <!-- Data dummy -->
                                </div>
                            </article>
                            <article class="stat-card">
                                <div class="stat-card-icon bg-warning-light"><i class="fas fa-hourglass-half"></i></div>
                                <div class="stat-card-info">
                                    <h5>Permintaan Tertunda</h5>
                                    <p>5</p> <!-- Data dummy -->
                                </div>
                            </article>
                            <article class="stat-card">
                                <div class="stat-card-icon bg-danger-light"><i class="fas fa-file-invoice-dollar"></i></div>
                                <div class="stat-card-info">
                                    <h5>Pembayaran Jatuh Tempo</h5>
                                    <p>3</p> <!-- Data dummy -->
                                </div>
                            </article>
                        </div>

                        <article class="card mb-xl">
                            <div class="card-body">
                                <h2 class="card-title text-xl">Aksi Cepat Manajemen</h2>
                                <div class="quick-actions">
                                    <button class="btn btn-outline-primary"><i class="fas fa-list-alt"></i> Lihat Semua Properti</button>
                                    <button class="btn btn-outline-primary"><i class="fas fa-user-plus"></i> Tambah Penyewa Baru</button>
                                    <button class="btn btn-outline-primary"><i class="fas fa-tools"></i> Kelola Pemeliharaan</button>
                                    <button class="btn btn-outline-primary"><i class="fas fa-chart-bar"></i> Laporan Keuangan</button>
                                </div>
                            </div>
                        </article>
                        
                        <div class="dashboard-grid">
                            <article class="card">
                                <div class="card-body">
                                    <h2 class="card-title text-xl">Aktivitas Terkini</h2>
                                    <div class="activity-list">
                                        <div class="activity-item">
                                            <i class="fas fa-user-check activity-icon text-success"></i>
                                            <div class="activity-details">
                                                <p>Penyewa baru: <strong>Andi Wijaya</strong> mendaftar untuk Apartemen Melati Unit A2.</p>
                                                <span class="time">2 jam lalu</span>
                                            </div>
                                        </div>
                                        <div class="activity-item">
                                            <i class="fas fa-money-bill-wave activity-icon text-primary"></i>
                                            <div class="activity-details">
                                                <p>Pembayaran sewa diterima dari <strong>Siti Aminah</strong> (Apt. Mawar B5) sebesar ${formatCurrency(10000000)}.</p>
                                                <span class="time">5 jam lalu</span>
                                            </div>
                                        </div>
                                        <div class="activity-item">
                                            <i class="fas fa-wrench activity-icon text-warning"></i>
                                            <div class="activity-details">
                                                <p>Permintaan pemeliharaan baru: <strong>Keran bocor</strong> di Apartemen Anggrek Unit C1.</p>
                                                <span class="time">1 hari lalu</span>
                                            </div>
                                        </div>
                                         <div class="activity-item">
                                            <i class="fas fa-file-signature activity-icon text-gray"></i>
                                            <div class="activity-details">
                                                <p>Kontrak sewa <strong>Bpk. Herman</strong> (Apt. Tulip D2) akan berakhir dalam 7 hari.</p>
                                                <span class="time">Kemarin</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </article>

                            <article class="card">
                                <div class="card-body">
                                    <h2 class="card-title text-xl">Tanggal Penting & Jatuh Tempo</h2>
                                    <div class="due-dates-list">
                                        <div class="due-item danger">
                                            <div class="due-item-info">
                                                <p>Pembayaran Sewa - Apt. Tulip C1</p>
                                                <span class="subtext">Penyewa: Rahmat H.</span>
                                            </div>
                                            <span class="badge badge-danger">Besok</span>
                                        </div>
                                        <div class="due-item warning">
                                            <div class="due-item-info">
                                                <p>Perpanjangan Kontrak - Bpk. Rudi</p>
                                                <span class="subtext">Apartemen Anggrek Unit D3</span>
                                            </div>
                                            <span class="badge badge-warning">3 Hari Lagi</span>
                                        </div>
                                        <div class="due-item primary">
                                            <div class="due-item-info">
                                                <p>Jadwal Pemeliharaan AC Periodik</p>
                                                <span class="subtext">Gedung Bougenville (Semua Unit)</span>
                                            </div>
                                            <span class="badge badge-primary">1 Minggu Lagi</span>
                                        </div>
                                    </div>
                                </div>
                            </article>
                        </div>
                    </section>
                    `;
                    appContent.innerHTML = dashboardContentHTML;
                },
                features: () => {
                    clearContent();
                    const featuresPageContentHTML = `
                    <section class="section-padding container page">
                        <div class="text-center mb-xl">
                            <h1 class="text-3xl font-bold">Fitur Unggulan Green Valley</h1>
                            <p class="text-lg text-gray max-w-3xl mx-auto">
                                Kami berkomitmen menyediakan platform terbaik dengan berbagai fitur canggih untuk memudahkan pencarian dan pengelolaan properti Anda, memastikan pengalaman yang mulus dan memuaskan.
                            </p>
                        </div>
                        <div class="grid-container cols-1-sm cols-2-md gap-xl">
                            ${appState.features.map(feature => `
                                <article class="card d-flex flex-row align-items-start gap-md p-lg">
                                    <i class="${feature.icon} text-primary text-3xl mt-xs" style="width: 40px; text-align:center; flex-shrink:0;"></i>
                                    <div>
                                        <h3 class="card-title text-xl mb-xs">${feature.title}</h3>
                                        <p class="card-text text-base mb-0">${feature.description}</p>
                                    </div>
                                </article>
                            `).join('')}
                        </div>
                    </section>
                    `;
                    appContent.innerHTML = featuresPageContentHTML;
                },
                contact: () => {
                    clearContent();
                    const contactPageContentHTML = `
                    <section class="section-padding container page">
                        <div class="text-center mb-xl">
                            <h1 class="text-3xl font-bold">Hubungi Tim Green Valley</h1>
                            <p class="text-lg text-gray">Kami selalu siap membantu Anda. Jangan ragu untuk mengirimkan pertanyaan, masukan, atau permintaan bantuan melalui form di bawah atau detail kontak yang tersedia.</p>
                        </div>
                        <div class="grid-container cols-1-md cols-2-lg gap-xl">
                            <article class="card">
                                <div class="card-body">
                                    <h2 class="text-2xl font-semibold mb-md">Kirim Pesan Langsung</h2>
                                    <form id="contactForm">
                                        <div class="form-group">
                                            <label for="contactName">Nama Lengkap Anda</label>
                                            <input type="text" id="contactName" class="form-control" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="contactEmail">Alamat Email Aktif</label>
                                            <input type="email" id="contactEmail" class="form-control" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="contactSubject">Subjek Pesan</label>
                                            <input type="text" id="contactSubject" class="form-control">
                                        </div>
                                        <div class="form-group">
                                            <label for="contactMessage">Isi Pesan Anda</label>
                                            <textarea id="contactMessage" class="form-control" rows="5" required></textarea>
                                        </div>
                                        <button type="submit" class="btn btn-primary btn-lg"><i class="fas fa-paper-plane"></i> Kirim Pesan</button>
                                    </form>
                                </div>
                            </article>
                            <aside>
                                <article class="card mb-lg">
                                    <div class="card-body">
                                        <h2 class="text-2xl font-semibold mb-md">Informasi Kontak Kami</h2>
                                        <div class="mb-lg">
                                            <p class="d-flex align-items-start gap-sm mb-sm"><i class="fas fa-map-marker-alt text-primary text-xl mt-xs"></i> <span>Jl. Apartemen Indah No. 45, Jakarta Selatan, DKI Jakarta 12345, Indonesia</span></p>
                                            <p class="d-flex align-items-center gap-sm mb-sm"><i class="fas fa-phone text-primary text-xl"></i> <a href="tel:+62215550123">(021) 555-0123</a></p>
                                            <p class="d-flex align-items-center gap-sm mb-sm"><i class="fas fa-envelope text-primary text-xl"></i> <a href="mailto:support@Green Valley.com">support@Green Valley.com</a></p>
                                            <p class="d-flex align-items-center gap-sm"><i class="fas fa-clock text-primary text-xl"></i> Jam Operasional: Senin - Jumat, 09:00 - 17:00 WIB</p>
                                        </div>
                                    </div>
                                </article>
                                <h3 class="text-xl font-semibold mb-md">Temukan Lokasi Kami di Peta</h3>
                                <div id="contactMap" style="height: 300px; border-radius: var(--radius-lg); box-shadow: var(--shadow-md);"></div>
                            </aside>
                        </div>
                    </section>
                    `;
                    appContent.innerHTML = contactPageContentHTML;

                    // Inisialisasi Peta Kontak
                    const contactMapCoords = [-6.241586, 106.826483]; // Contoh koordinat Jakarta Selatan
                    leafletMapInstance = L.map('contactMap').setView(contactMapCoords, 15);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(leafletMapInstance);
                    L.marker(contactMapCoords).addTo(leafletMapInstance)
                        .bindPopup('<b>Kantor Pusat Green Valley</b><br>Jl. Apartemen Indah No. 45')
                        .openPopup();

                    document.getElementById('contactForm').addEventListener('submit', (e) => {
                        e.preventDefault();
                        // Implementasi logika pengiriman form (misalnya, via AJAX atau mailto)
                        app.openModal('formSubmissionSuccess', { message: 'Pesan Anda telah berhasil terkirim! Tim kami akan segera menghubungi Anda.' });
                        e.target.reset(); // Reset form setelah submit
                    });
                },
                login: () => {
                    if (appState.user) { router.navigateTo('home'); return; } // Jika sudah login, redirect
                    clearContent();
                    const loginPageContentHTML = `
                    <section class="section-padding container page d-flex justify-content-center align-items-center" style="min-height: 70vh;">
                        <article class="card shadow-lg" style="max-width: 450px; width: 100%;">
                            <div class="card-body p-lg">
                                <h1 class="card-title text-center text-2xl mb-lg">Masuk ke Akun Green Valley Anda</h1>
                                <form id="loginForm">
                                    <div class="form-group">
                                        <label for="loginEmail">Alamat Email</label>
                                        <input type="email" id="loginEmail" class="form-control" required placeholder="nama@email.com">
                                    </div>
                                    <div class="form-group">
                                        <label for="loginPassword">Kata Sandi</label>
                                        <input type="password" id="loginPassword" class="form-control" required placeholder="********">
                                    </div>
                                    <div class="form-group d-flex justify-content-between align-items-center form-group-inline">
                                        <label for="rememberMe" class="text-sm font-normal d-flex align-items-center">
                                            <input type="checkbox" id="rememberMe" class="mr-xs"> Ingat Saya
                                        </label>
                                        <a href="#forgotpassword" data-route="forgotpassword" class="text-sm">Lupa Kata Sandi?</a>
                                    </div>
                                    <button type="submit" class="btn btn-primary btn-block btn-lg mt-lg mb-md">Masuk Sekarang</button>
                                    <p class="text-center text-sm">Belum punya akun? <a href="#register" data-route="register" class="font-semibold">Daftar Gratis di sini</a></p>
                                </form>
                            </div>
                        </article>
                    </section>
                    `;
                    appContent.innerHTML = loginPageContentHTML;
                    document.getElementById('loginForm').addEventListener('submit', (e) => {
                        e.preventDefault();
                        const email = document.getElementById('loginEmail').value;
                        // Simulasi login
                        appState.user = { email: email, name: email.split('@')[0] }; // Nama diambil dari bagian email sebelum @
                        updateAuthUI();
                        router.navigateTo('propertymanagement');
                        app.openModal('genericSuccess', { title: 'Login Berhasil', message: `Selamat datang kembali, ${appState.user.name}!` });
                    });
                },
                register: () => {
                    if (appState.user) { router.navigateTo('home'); return; } // Jika sudah login, redirect
                    clearContent();
                    const registerPageContentHTML = `
                    <section class="section-padding container page d-flex justify-content-center align-items-center" style="min-height: 70vh;">
                        <article class="card shadow-lg" style="max-width: 480px; width: 100%;">
                            <div class="card-body p-lg">
                                <h1 class="card-title text-center text-2xl mb-lg">Buat Akun Baru Green Valley</h1>
                                <form id="registerForm">
                                    <div class="form-group">
                                        <label for="registerName">Nama Lengkap</label>
                                        <input type="text" id="registerName" class="form-control" required placeholder="Masukkan nama lengkap Anda">
                                    </div>
                                    <div class="form-group">
                                        <label for="registerEmail">Alamat Email</label>
                                        <input type="email" id="registerEmail" class="form-control" required placeholder="nama@email.com">
                                    </div>
                                    <div class="form-group">
                                        <label for="registerPassword">Kata Sandi</label>
                                        <input type="password" id="registerPassword" class="form-control" required placeholder="Minimal 8 karakter, kombinasi huruf dan angka">
                                    </div>
                                     <div class="form-group">
                                        <label for="registerConfirmPassword">Konfirmasi Kata Sandi</label>
                                        <input type="password" id="registerConfirmPassword" class="form-control" required placeholder="Ulangi kata sandi Anda">
                                    </div>
                                    <div class="form-group form-group-inline">
                                        <input type="checkbox" id="agreeTerms" required class="mr-xs">
                                        <label for="agreeTerms" class="text-sm font-normal">Saya menyetujui <a href="#terms" data-route="terms" target="_blank">Syarat & Ketentuan</a> serta <a href="#privacy" data-route="privacy" target="_blank">Kebijakan Privasi</a>.</label>
                                    </div>
                                    <button type="submit" class="btn btn-primary btn-block btn-lg mt-lg mb-md">Daftar Sekarang</button>
                                    <p class="text-center text-sm">Sudah punya akun? <a href="#login" data-route="login" class="font-semibold">Masuk di sini</a></p>
                                </form>
                            </div>
                        </article>
                    </section>
                    `;
                    appContent.innerHTML = registerPageContentHTML;
                    document.getElementById('registerForm').addEventListener('submit', (e) => {
                        e.preventDefault();
                        const name = document.getElementById('registerName').value;
                        const email = document.getElementById('registerEmail').value;
                        const password = document.getElementById('registerPassword').value;
                        const confirmPassword = document.getElementById('registerConfirmPassword').value;

                        if (password !== confirmPassword) {
                            app.openModal('formValidationError', { message: 'Konfirmasi kata sandi tidak cocok!' });
                            return;
                        }
                        // Simulasi registrasi
                        appState.user = { email: email, name: name };
                        updateAuthUI();
                        router.navigateTo('home');
                        app.openModal('genericSuccess', { title: 'Registrasi Berhasil', message: `Selamat datang di Green Valley, ${name}! Akun Anda telah berhasil dibuat.` });
                    });
                },
                // Halaman statis sederhana (contoh)
                privacy: () => {
                    clearContent();
                    appContent.innerHTML = `
                    <section class="section-padding container page">
                        <h1 class="text-3xl font-bold mb-lg">Kebijakan Privasi</h1>
                        <p>Di Green Valley, kami menghargai privasi Anda dan berkomitmen untuk melindungi informasi pribadi Anda. Kebijakan Privasi ini menjelaskan bagaimana kami mengumpulkan, menggunakan, mengungkapkan, dan melindungi informasi Anda saat Anda mengunjungi situs web kami dan menggunakan layanan kami.</p>
                        
                        <h2 class="text-2xl font-semibold mt-xl mb-md">Informasi yang Kami Kumpulkan</h2>
                        <p>Kami dapat mengumpulkan informasi pribadi dari Anda dalam berbagai cara, termasuk, namun tidak terbatas pada, saat Anda mengunjungi situs kami, mendaftar di situs, melakukan pemesanan, berlangganan buletin, menanggapi survei atau komunikasi pemasaran, mengisi formulir, atau sehubungan dengan aktivitas, layanan, fitur, atau sumber daya lain yang kami sediakan di Situs kami.</p>
                        <ul>
                            <li class="mb-sm"><strong>Informasi Identifikasi Pribadi:</strong> Nama, alamat email, alamat surat, nomor telepon, dll.</li>
                            <li class="mb-sm"><strong>Informasi Non-Identifikasi Pribadi:</strong> Jenis browser, jenis komputer, informasi teknis tentang sarana koneksi Pengguna ke Situs kami, seperti sistem operasi dan penyedia layanan Internet yang digunakan, dan informasi serupa lainnya.</li>
                        </ul>

                        <h2 class="text-2xl font-semibold mt-xl mb-md">Bagaimana Kami Menggunakan Informasi Anda</h2>
                        <p>Green Valley dapat mengumpulkan dan menggunakan informasi pribadi Pengguna untuk tujuan berikut:</p>
                        <ul>
                            <li class="mb-sm">Untuk meningkatkan layanan pelanggan</li>
                            <li class="mb-sm">Untuk mempersonalisasi pengalaman pengguna</li>
                            <li class="mb-sm">Untuk meningkatkan Situs kami</li>
                            <li class="mb-sm">Untuk memproses pembayaran</li>
                            <li class="mb-sm">Untuk mengirim email berkala</li>
                        </ul>
                        <p class="mt-lg">Kebijakan ini dapat diperbarui dari waktu ke waktu. Kami menyarankan Anda untuk meninjau halaman ini secara berkala untuk setiap perubahan.</p>
                    </section>
                    `;
                },
                terms: () => {
                    clearContent();
                    appContent.innerHTML = `
                    <section class="section-padding container page">
                        <h1 class="text-3xl font-bold mb-lg">Syarat dan Ketentuan</h1>
                        <p>Selamat datang di Green Valley! Syarat dan Ketentuan ini mengatur penggunaan Anda atas situs web kami yang berlokasi di [URL Situs Anda] dan layanan terkait yang disediakan oleh Green Valley. Dengan mengakses atau menggunakan Layanan, Anda setuju untuk terikat oleh Syarat ini.</p>

                        <h2 class="text-2xl font-semibold mt-xl mb-md">1. Penggunaan Layanan</h2>
                        <p>Anda setuju untuk menggunakan Layanan hanya untuk tujuan yang sah dan sesuai dengan Syarat ini. Anda bertanggung jawab penuh atas semua aktivitas yang terjadi di bawah akun Anda.</p>

                        <h2 class="text-2xl font-semibold mt-xl mb-md">2. Pendaftaran Akun</h2>
                        <p>Untuk mengakses beberapa fitur Layanan, Anda mungkin diminta untuk mendaftarkan akun. Anda harus memberikan informasi yang akurat, terkini, dan lengkap selama proses pendaftaran dan memperbarui informasi tersebut agar tetap akurat, terkini, dan lengkap.</p>

                        <h2 class="text-2xl font-semibold mt-xl mb-md">3. Properti dan Pemesanan</h2>
                        <p>Green Valley bertindak sebagai platform untuk menghubungkan penyewa dengan pemilik properti. Kami tidak memiliki, mengontrol, atau mengelola properti apa pun yang terdaftar. Semua pemesanan tunduk pada ketersediaan dan konfirmasi dari pemilik properti.</p>
                        
                        <h2 class="text-2xl font-semibold mt-xl mb-md">4. Pembatalan dan Pengembalian Dana</h2>
                        <p>Kebijakan pembatalan dan pengembalian dana bervariasi tergantung pada properti dan akan ditentukan dalam syarat dan ketentuan pemesanan spesifik Anda.</p>

                        <h2 class="text-2xl font-semibold mt-xl mb-md">5. Batasan Tanggung Jawab</h2>
                        <p>Sejauh diizinkan oleh hukum yang berlaku, Green Valley tidak akan bertanggung jawab atas kerugian atau kerusakan tidak langsung, insidental, khusus, konsekuensial, atau hukuman, atau kerugian keuntungan atau pendapatan, baik yang timbul secara langsung maupun tidak langsung, atau kehilangan data, penggunaan, niat baik, atau kerugian tidak berwujud lainnya.</p>
                        
                        <p class="mt-lg">Syarat dan Ketentuan ini dapat diubah atau dimodifikasi oleh kami atas kebijakan kami sendiri kapan saja. Dengan terus menggunakan Layanan setelah perubahan tersebut diposting, Anda menerima Syarat yang dimodifikasi.</p>
                    </section>
                    `;
                },
                faq: () => {
                    clearContent();
                    appContent.innerHTML = `
                    <section class="section-padding container page">
                        <h1 class="text-3xl font-bold mb-lg text-center">Pertanyaan yang Sering Diajukan (FAQ)</h1>
                        
                        <div class="faq-item mb-lg">
                            <h2 class="text-xl font-semibold mb-sm">Bagaimana cara mencari apartemen di Green Valley?</h2>
                            <p>Anda dapat menggunakan bilah pencarian di Beranda atau halaman "Cari Apartemen". Masukkan lokasi, tanggal check-in/check-out, dan gunakan filter lanjutan untuk mempersempit hasil berdasarkan harga, jumlah kamar tidur, dan fasilitas.</p>
                        </div>

                        <div class="faq-item mb-lg">
                            <h2 class="text-xl font-semibold mb-sm">Apakah aman melakukan transaksi di Green Valley?</h2>
                            <p>Ya, kami menggunakan sistem enkripsi canggih untuk melindungi data pribadi dan transaksi pembayaran Anda. Kami juga melakukan verifikasi terhadap pemilik properti untuk memastikan keamanan.</p>
                        </div>

                        <div class="faq-item mb-lg">
                            <h2 class="text-xl font-semibold mb-sm">Bagaimana cara melakukan pemesanan apartemen?</h2>
                            <p>Setelah menemukan apartemen yang Anda inginkan, klik tombol "Lihat Detail" lalu ikuti instruksi untuk "Sewa Sekarang" atau hubungi agen (jika ada). Anda akan dipandu melalui proses pemesanan dan pembayaran.</p>
                        </div>

                        <div class="faq-item mb-lg">
                            <h2 class="text-xl font-semibold mb-sm">Apa yang harus saya lakukan jika ada masalah dengan properti yang saya sewa?</h2>
                            <p>Segera hubungi pemilik properti atau agen yang tertera pada detail pemesanan Anda. Jika Anda tidak mendapatkan respons atau bantuan yang memadai, silakan hubungi tim Dukungan Pelanggan Green Valley.</p>
                        </div>

                         <div class="faq-item mb-lg">
                            <h2 class="text-xl font-semibold mb-sm">Bisakah saya membatalkan pemesanan saya?</h2>
                            <p>Kebijakan pembatalan bervariasi tergantung pada properti dan pemilik. Harap tinjau syarat dan ketentuan pembatalan yang tertera pada halaman detail properti sebelum melakukan pemesanan.</p>
                        </div>
                        
                         <div class="faq-item mb-lg">
                            <h2 class="text-xl font-semibold mb-sm">Bagaimana cara mendaftarkan properti saya untuk disewakan di Green Valley?</h2>
                            <p>Jika Anda seorang pemilik properti, Anda dapat mendaftar dan kemudian menggunakan fitur "Manajemen Properti" untuk menambahkan dan mengelola listing properti Anda. Hubungi kami jika Anda memerlukan bantuan.</p>
                        </div>

                    </section>
                    `;
                },
                notFound: () => {
                    clearContent();
                    appContent.innerHTML = `
                    <section class="section-padding container text-center page d-flex flex-column justify-content-center align-items-center" style="min-height: 60vh;">
                        <i class="fas fa-compass-slash text-danger" style="font-size: 6rem; margin-bottom: var(--space-lg);"></i>
                        <h1 class="text-4xl font-bold mb-md">404 - Halaman Tidak Ditemukan</h1>
                        <p class="text-xl text-gray mb-xl">Maaf, halaman yang Anda cari tidak dapat ditemukan atau mungkin telah dipindahkan.</p>
                        <a href="#home" data-route="home" class="btn btn-primary btn-lg">
                            <i class="fas fa-home"></i> Kembali ke Beranda
                        </a>
                    </section>
                `;
                }
            };

            // === Router Sederhana untuk SPA ===
            const router = {
                routes: pages,
                currentParams: {}, // Menyimpan parameter URL
                navigateTo: (hashRoute, params = {}) => {
                    let routeName = hashRoute.startsWith('#') ? hashRoute.substring(1) : hashRoute;
                    let queryParamsString = '';

                    // Pisahkan routeName dan query string jika ada
                    if (routeName.includes('?')) {
                        [routeName, queryParamsString] = routeName.split('?', 2);
                        const urlParams = new URLSearchParams(queryParamsString);
                        for (const [key, value] of urlParams) {
                            params[key] = value; // Gabungkan params dari argumen dan URL
                        }
                    }

                    appState.currentPage = routeName;
                    router.currentParams = params; // Simpan parameter saat ini

                    // Set hash URL tanpa memicu hashchange lagi, jika params diubah secara internal
                    let newHash = `#${routeName}`;
                    if (Object.keys(params).length > 0) {
                        newHash += `?${new URLSearchParams(params).toString()}`;
                    }
                    // Hanya update hash jika berbeda untuk menghindari loop atau history ganda yang tidak perlu
                    if (window.location.hash !== newHash) {
                        history.pushState(null, '', newHash); // Menggunakan pushState untuk URL yang lebih bersih dan kontrol history
                    }


                    if (router.routes[routeName]) {
                        router.routes[routeName](params); // Panggil fungsi render halaman dengan params
                    } else {
                        router.routes.notFound();
                        routeName = 'notFound'; // Update routeName untuk activeNav
                    }
                    updateActiveNav(routeName);
                    window.scrollTo(0, 0); // Scroll ke atas halaman setiap navigasi
                },
                handleLocationChange: () => { // Dipanggil oleh event hashchange atau popstate
                    const hash = window.location.hash || '#home';
                    // Parse params dari hash
                    let routeName = hash.startsWith('#') ? hash.substring(1) : hash;
                    let params = {};
                    if (routeName.includes('?')) {
                        let queryParamsString;
                        [routeName, queryParamsString] = routeName.split('?', 2);
                        const urlParams = new URLSearchParams(queryParamsString);
                        for (const [key, value] of urlParams) {
                            params[key] = value;
                        }
                    }
                    router.navigateTo(routeName, params);
                }
            };

            // === Fungsi Modal ===
            const openModal = (type, data = {}) => {
                // Reset modal content
                modalTitleEl.textContent = '';
                modalBodyEl.innerHTML = '';
                modalFooterEl.classList.add('hidden'); // Sembunyikan footer default
                modalConfirmBtn.onclick = null; // Reset event handler confirm
                modalCancelBtn.textContent = 'Tutup'; // Default tombol cancel
                modalConfirmBtn.classList.remove('hidden'); // Pastikan tombol confirm terlihat
                modalCancelBtn.classList.remove('btn-outline-primary'); // Reset style cancel
                modalCancelBtn.classList.add('btn-outline-primary');   // Default style cancel

                // Set ARIA attributes
                appModal.setAttribute('aria-hidden', 'false');

                switch (type) {
                    case 'addProperty':
                        modalTitleEl.textContent = 'Tambah Properti Baru';
                        modalBodyEl.innerHTML = `
                        <form id="addPropertyForm">
                            <div class="form-group">
                                <label for="propName">Nama Properti</label>
                                <input type="text" id="propName" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="propLocation">Lokasi</label>
                                <input type="text" id="propLocation" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="propType">Tipe Properti</label>
                                <select id="propType" class="form-control">
                                    <option value="apartemen">Apartemen</option>
                                    <option value="rumah">Rumah</option>
                                    <option value="villa">Villa</option>
                                </select>
                            </div>
                             <div class="form-group">
                                <label for="propPrice">Harga Sewa (per bulan)</label>
                                <input type="number" id="propPrice" class="form-control" required placeholder="cth: 10000000">
                            </div>
                        </form>
                        `;
                        modalFooterEl.classList.remove('hidden');
                        modalConfirmBtn.textContent = 'Simpan Properti';
                        modalCancelBtn.textContent = 'Batal';
                        modalConfirmBtn.onclick = () => {
                            const form = document.getElementById('addPropertyForm');
                            if (form.checkValidity()) {
                                // Logika simpan properti (simulasi)
                                console.log('Properti disimpan:', {
                                    name: form.propName.value,
                                    location: form.propLocation.value,
                                    type: form.propType.value,
                                    price: form.propPrice.value
                                });
                                closeModal();
                                openModal('genericSuccess', { title: 'Sukses!', message: 'Properti baru berhasil ditambahkan (simulasi).' });
                                form.reset();
                            } else {
                                openModal('formValidationError', { message: 'Mohon isi semua field yang wajib diisi dengan benar.' });
                                form.reportValidity();
                            }
                        };
                        break;
                    case 'apartmentDetail':
                        const apt = appState.apartments.find(a => a.id === data.apartmentId);
                        if (!apt) {
                            modalTitleEl.textContent = 'Error';
                            modalBodyEl.innerHTML = '<p>Detail apartemen tidak ditemukan.</p>';
                        } else {
                            modalTitleEl.textContent = apt.name;
                            modalBodyEl.innerHTML = `
                            <img src="${apt.image}" alt="${apt.name}" class="rounded-lg mb-md" style="width:100%; max-height: 300px; object-fit:cover;">
                            <p class="text-lg font-semibold text-primary">${formatCurrency(apt.price)} / bulan</p>
                            <p><strong><i class="fas fa-map-marker-alt mr-xs"></i> Lokasi:</strong> ${apt.location}</p>
                            <p><strong><i class="fas fa-ruler-combined mr-xs"></i> Ukuran:</strong> ${apt.area} m² | <strong><i class="fas fa-bed mr-xs"></i> Kamar Tidur:</strong> ${apt.beds} | <strong><i class="fas fa-bath mr-xs"></i> Kamar Mandi:</strong> ${apt.baths}</p>
                            <p><strong><i class="fas fa-info-circle mr-xs"></i> Deskripsi:</strong> ${apt.description || 'Tidak ada deskripsi tambahan.'}</p>
                            <p><strong><i class="fas fa-concierge-bell mr-xs"></i> Fasilitas:</strong> ${apt.amenities.join(', ')}</p>
                            <div id="modalMap" style="height: 250px; margin-top: var(--space-md); border-radius: var(--radius-md);"></div>
                            `;
                            modalFooterEl.classList.remove('hidden');
                            modalConfirmBtn.textContent = 'Sewa Sekarang';
                            modalCancelBtn.textContent = 'Tutup';
                            modalConfirmBtn.onclick = () => {
                                if (!appState.user) {
                                    closeModal();
                                    router.navigateTo('login');
                                    openModal('authRequired', { action: `menyewa ${apt.name}` });
                                } else {
                                    openModal('genericSuccess', { title: 'Permintaan Sewa Terkirim', message: `Permintaan sewa untuk ${apt.name} telah kami terima! Tim kami akan segera menghubungi Anda. (simulasi)` });
                                    closeModal(); // Tutup modal detail setelah konfirmasi
                                }
                            };
                            // Inisialisasi peta di modal
                            setTimeout(() => { // Delay untuk memastikan DOM siap & modal terlihat
                                if (document.getElementById('modalMap') && apt.lat && apt.lng) {
                                    const modalMapInstance = L.map('modalMap').setView([apt.lat, apt.lng], 15);
                                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(modalMapInstance);
                                    L.marker([apt.lat, apt.lng]).addTo(modalMapInstance).bindPopup(apt.name);
                                    // Paksa redraw peta jika tidak muncul dengan benar di modal
                                    setTimeout(() => modalMapInstance.invalidateSize(), 200);
                                }
                            }, 150); // Sedikit lebih lama untuk memastikan transisi modal selesai
                        }
                        break;
                    case 'authRequired':
                        modalTitleEl.textContent = 'Autentikasi Diperlukan';
                        modalBodyEl.innerHTML = `<p>Anda harus masuk terlebih dahulu untuk ${data.action || 'melakukan tindakan ini'}. Silakan masuk atau daftar.</p>`;
                        modalFooterEl.classList.remove('hidden');
                        modalConfirmBtn.textContent = 'Masuk Sekarang';
                        modalConfirmBtn.onclick = () => {
                            closeModal();
                            router.navigateTo('login');
                        };
                        modalCancelBtn.textContent = 'Nanti Saja';
                        break;
                    case 'formSubmissionSuccess':
                        modalTitleEl.textContent = data.title || 'Pesan Terkirim!';
                        modalBodyEl.innerHTML = `<div class="text-center"><i class="fas fa-check-circle text-success text-3xl mb-md"></i><p>${data.message || 'Terima kasih! Pesan Anda telah berhasil dikirim.'}</p></div>`;
                        modalFooterEl.classList.remove('hidden');
                        modalConfirmBtn.classList.add('hidden'); // Hanya tombol tutup
                        modalCancelBtn.textContent = 'Oke';
                        break;
                    case 'formValidationError':
                        modalTitleEl.textContent = data.title || 'Validasi Gagal';
                        modalBodyEl.innerHTML = `<div class="text-center"><i class="fas fa-exclamation-triangle text-danger text-3xl mb-md"></i><p>${data.message || 'Terdapat kesalahan pada input Anda. Mohon periksa kembali.'}</p></div>`;
                        modalFooterEl.classList.remove('hidden');
                        modalConfirmBtn.classList.add('hidden');
                        modalCancelBtn.textContent = 'Mengerti';
                        break;
                    case 'genericSuccess':
                        modalTitleEl.textContent = data.title || 'Sukses!';
                        modalBodyEl.innerHTML = `<div class="text-center"><i class="fas fa-check-circle text-success text-3xl mb-md"></i><p>${data.message || 'Operasi berhasil dilakukan.'}</p></div>`;
                        modalFooterEl.classList.remove('hidden');
                        modalConfirmBtn.classList.add('hidden');
                        modalCancelBtn.textContent = 'Lanjutkan';
                        break;
                    default:
                        modalTitleEl.textContent = 'Informasi';
                        modalBodyEl.innerHTML = '<p>Konten modal default.</p>';
                }

                appModal.classList.add('active');
                document.body.style.overflow = 'hidden'; // Mencegah scroll background
                modalCloseBtn.focus(); // Fokus ke tombol tutup untuk aksesibilitas
            };

            const closeModal = () => {
                appModal.classList.remove('active');
                appModal.setAttribute('aria-hidden', 'true');
                document.body.style.overflow = ''; // Kembalikan scroll background
                if (leafletMapInstance && document.getElementById('modalMap')) { // Hapus instance peta modal
                    // Tidak perlu remove global instance, hanya yang di modal
                }
            };

            // Event listener untuk menutup modal
            modalCloseBtn.addEventListener('click', closeModal);
            modalCancelBtn.addEventListener('click', closeModal);
            appModal.addEventListener('click', (event) => { // Klik di luar area konten modal
                if (event.target === appModal) closeModal();
            });
            document.addEventListener('keydown', (event) => { // Tombol Escape
                if (event.key === 'Escape' && appModal.classList.contains('active')) closeModal();
            });

            // Expose fungsi penting ke global scope `app` untuk onclick di HTML
            window.app = {
                viewApartmentDetail: (apartmentId) => openModal('apartmentDetail', { apartmentId }),
                openModal: openModal // Untuk penggunaan lain jika diperlukan
            };

            // === Fungsi UI Tambahan ===
            const toggleMobileMenu = () => {
                const isActive = navMenu.classList.toggle('active');
                mobileMenuBtn.setAttribute('aria-expanded', isActive.toString());
                menuIconOpen.classList.toggle('hidden', isActive);
                menuIconClose.classList.toggle('hidden', !isActive);
                // Cegah scroll body saat menu mobile aktif
                document.body.style.overflow = isActive ? 'hidden' : '';
            };

            const updateAuthUI = () => { // Mengatur tampilan UI berdasarkan status login
                if (appState.user) {
                    authLink.innerHTML = `<i class="fas fa-sign-out-alt mr-xs"></i> Keluar (${appState.user.name})`;
                    authLink.href = '#logout';
                    authLink.dataset.route = 'logout';
                    authLink.classList.remove('btn-outline-primary', 'btn-sm'); // Jadi link biasa
                    navPropertyManagement.classList.remove('hidden');
                    footerNavPropertyManagement.classList.remove('hidden');
                } else {
                    authLink.innerHTML = 'Masuk/Daftar';
                    authLink.href = '#login';
                    authLink.dataset.route = 'login';
                    authLink.classList.add('btn-outline-primary', 'btn-sm'); // Kembali jadi tombol
                    navPropertyManagement.classList.add('hidden');
                    footerNavPropertyManagement.classList.add('hidden');
                }
            };

            const initFlatpickr = (selector) => {
                flatpickr(selector, {
                    altInput: true,
                    altFormat: "j F Y", // Format tampilan: 1 Januari 2024
                    dateFormat: "Y-m-d",  // Format data: 2024-01-01
                    locale: "id",         // Menggunakan lokalisasi Indonesia
                    disableMobile: "true", // Menggunakan UI Flatpickr di mobile, bukan native picker
                    minDate: "today"      // Mencegah pemilihan tanggal lampau
                });
            };

            // === Inisialisasi Aplikasi ===
            const initApp = () => {
                // Event listener untuk navigasi (hashchange dan popstate untuk back/forward browser)
                window.addEventListener('hashchange', router.handleLocationChange);
                window.addEventListener('popstate', router.handleLocationChange); // Handle back/forward

                // Event listener untuk klik link internal SPA (delegasi event ke body)
                document.body.addEventListener('click', e => {
                    const targetLink = e.target.closest('a[data-route]');
                    if (targetLink) {
                        e.preventDefault();
                        const route = targetLink.dataset.route;
                        const href = targetLink.getAttribute('href');

                        if (route === 'logout') {
                            appState.user = null;
                            updateAuthUI();
                            router.navigateTo('home');
                            openModal('genericSuccess', { title: 'Logout Berhasil', message: 'Anda telah berhasil keluar dari akun Anda.' });
                            return;
                        }

                        // Navigasi normal, biarkan router.navigateTo yang menangani hash
                        router.navigateTo(href);
                    }
                });

                mobileMenuBtn.addEventListener('click', toggleMobileMenu);

                if (currentYearEl) {
                    currentYearEl.textContent = new Date().getFullYear();
                }

                updateAuthUI(); // Inisialisasi UI autentikasi saat load
                router.handleLocationChange(); // Muat halaman awal berdasarkan hash atau default
            };

            initApp(); // Jalankan aplikasi Green Valley
        });
    </script>
</body>

</html>