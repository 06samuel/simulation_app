<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green Valley Properties</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .hero-bg {
            background-image: url('https://picsum.photos/1920/1080?grayscale&blur=2&random=1');
        }

        .property-card img {
            aspect-ratio: 16 / 10;
            object-fit: cover;
        }

        /* Minimal global styles; prefer Tailwind. Dark mode handled by Tailwind's dark: prefix */
        .dark .dark\:bg-gray-850 {
            background-color: #161e2d;
            /* Slightly different dark for sections */
        }

        .dark .dark\:bg-gray-750 {
            background-color: #2d3748;
            /* Slightly different dark for advanced filters */
        }

        /* Custom Scrollbar for Webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .dark ::-webkit-scrollbar-track {
            background: #2d3748;
            /* Darker track for dark mode */
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #555;
            /* Darker thumb for dark mode */
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .dark ::-webkit-scrollbar-thumb:hover {
            background: #777;
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200 transition-colors duration-300">
    <div id="root">
        <!-- App will be rendered here -->
        <div class="min-h-screen flex flex-col items-center justify-center">
            <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-emerald-500"></div>
            <p class="mt-4 text-lg text-gray-600 dark:text-gray-400">Loading Green Valley Properties...</p>
        </div>
    </div>

    <script type="module">
        // --- Polyfill/Stub for process.env.API_KEY ---
        // IMPORTANT: In a real application, API keys should NEVER be hardcoded or exposed in client-side code.
        // This is a placeholder for demonstration purposes only.
        // For a production app, use a backend proxy to handle API calls securely.
        const process = { env: { API_KEY: "YOUR_GEMINI_API_KEY_HERE" } };

        // --- Gemini Service (Illustrative, actual calls might be limited in this setup) ---
        class MockGoogleGenAI {
            constructor(config) {
                this.apiKey = config.apiKey;
                this.models = {
                    generateContent: async ({ model, contents, config: modelConfig }) => {
                        console.log("Mock Gemini: generateContent called", { model, contents, modelConfig });
                        if (!this.apiKey || this.apiKey === "YOUR_GEMINI_API_KEY_HERE") {
                            return { text: "Gemini API key not configured. This is a mock response." };
                        }
                        await new Promise(resolve => setTimeout(resolve, 800 + Math.random() * 500));
                        if (typeof contents === 'string') {
                            if (contents.toLowerCase().includes("story")) {
                                return { text: "In a verdant valley, nestled among rolling hills, lay a charming cottage waiting for its new story to begin..." };
                            }
                            if (contents.toLowerCase().includes("greeting")) {
                                return { text: "Welcome to Green Valley! Your dream home awaits." };
                            }
                            if (contents.toLowerCase().includes("real estate listing description")) {
                                return { text: `\n**Discover Your Sanctuary!**\n\nNestled in the heart of ${modelConfig?.property?.location || 'a prime location'}, this stunning ${modelConfig?.property?.type || 'property'} offers an unparalleled living experience. Boasting ${modelConfig?.property?.beds || 'spacious'} bedrooms and ${modelConfig?.property?.baths || 'modern'} bathrooms, this home is perfect for families or those seeking a luxurious retreat.\n\nThe expansive ${modelConfig?.property?.area || ''} sqm layout features [mention a key feature like 'an open-plan living area', 'a gourmet kitchen', or 'breathtaking views']. Step outside to enjoy [mention an outdoor feature like 'a private garden', 'a sun-drenched balcony', or 'access to community amenities'].\n\nWith amenities like ${modelConfig?.property?.amenities?.join(', ') || 'top-tier facilities'} and a price of $${(modelConfig?.property?.price || 0).toLocaleString()}, this gem won't last long. Schedule your viewing today and make this dream home yours!` };
                            }
                        }
                        return { text: `Mock AI response for: ${String(contents).substring(0, 70)}...` };
                    }
                };
            }
        }
        const GoogleGenAI = MockGoogleGenAI;

        const geminiService = {
            ai: null,
            initialize: () => {
                if (process.env.API_KEY && process.env.API_KEY !== "YOUR_GEMINI_API_KEY_HERE") {
                    geminiService.ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                    console.log("Gemini Service Initialized (using configured key - mock for browser)");
                } else {
                    console.warn("Gemini API Key not provided or is placeholder. GeminiService will use mock responses.");
                    geminiService.ai = new GoogleGenAI({ apiKey: "YOUR_GEMINI_API_KEY_HERE" });
                }
            },
            generateText: async (prompt, propertyDetailsForContext = null) => {
                if (!geminiService.ai) geminiService.initialize();
                try {
                    // Pass propertyDetails as part of the config for the mock to use
                    const response = await geminiService.ai.models.generateContent({
                        model: 'gemini-2.5-flash-preview-04-17',
                        contents: prompt,
                        config: { property: propertyDetailsForContext } // For mock context
                    });
                    return response.text;
                } catch (error) {
                    console.error("Error generating text with Gemini:", error);
                    return "Error generating content.";
                }
            }
        };
        geminiService.initialize();

        // --- Simple Virtual DOM & Component Logic ---
        let _state = [];
        let _stateIndex = 0;
        let _effects = [];
        let _effectIndex = 0;
        let _rootComponent = null;
        let _rootElement = null;

        const debounce = (func, delay) => {
            let timeout;
            return (...args) => {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), delay);
            };
        };

        const renderApp = debounce(() => {
            if (!_rootComponent || !_rootElement) return;
            _stateIndex = 0;
            const prevEffects = [..._effects]; // Capture effects from the just-completed render cycle
            _effectIndex = 0;
            _effects = []; // Reset effects for the new render cycle, they will be repopulated

            _rootElement.innerHTML = '';
            const newVDom = _rootComponent();
            _rootElement.appendChild(newVDom);

            // Run cleanups for effects that are no longer present or whose dependencies changed
            prevEffects.forEach((prevEffect, i) => {
                const currentEffect = _effects[i]; //This logic is a bit off, _effects is new list
                // Correct approach: track effects by a key or rely on order if components are stable
                // Simplified: Assume effect order is stable. If an effect at an index has new deps, or no deps, run cleanup.
                // A more robust system would involve unique IDs per effect or component instance.
                if (prevEffect.cleanup && (!currentEffect || !areDepsEqual(prevEffect.deps, currentEffect.deps))) {
                    prevEffect.cleanup();
                }
            });

            // Execute effects collected during this render pass
            _effects.forEach(effect => {
                if (!effect.hasRun || (effect.deps && !areDepsEqual(effect.deps, effect.prevDeps))) {
                    if (effect.hasRun && effect.cleanup) effect.cleanup(); // cleanup from previous run of this specific effect if deps changed
                    effect.cleanup = effect.callback();
                    effect.hasRun = true;
                    effect.prevDeps = effect.deps ? [...effect.deps] : null;
                }
            });
        }, 16); // Debounce rendering (roughly 60fps)

        function useState(initialValue) {
            const currentIndex = _stateIndex;
            _stateIndex++;

            if (_state[currentIndex] === undefined) {
                _state[currentIndex] = typeof initialValue === 'function' ? initialValue() : initialValue;
            }

            const value = _state[currentIndex];
            const setValue = (newValue) => {
                const actualNewValue = typeof newValue === 'function' ? newValue(_state[currentIndex]) : newValue;
                if (!Object.is(_state[currentIndex], actualNewValue)) { // Use Object.is for comparison
                    _state[currentIndex] = actualNewValue;
                    renderApp();
                }
            };
            return [value, setValue];
        }

        function areDepsEqual(depsA, depsB) {
            if (!depsA && !depsB) return true; // Both undefined/null, considered equal for "no deps" case.
            if (!depsA || !depsB || depsA.length !== depsB.length) return false;
            for (let i = 0; i < depsA.length; i++) {
                if (!Object.is(depsA[i], depsB[i])) return false;
            }
            return true;
        }

        function useEffect(callback, deps) {
            const currentIndex = _effectIndex;
            _effectIndex++;

            const oldEffectData = _effects[currentIndex]; // Get data from *this render cycle's* growing _effects array
            // if it was already populated by a previous call to useEffect in same component.
            // This logic needs to be careful.

            // Store the effect, it will be processed after the render pass
            // The logic here is subtle: _effects gets rebuilt each render. We just add to it.
            // The comparison with prevDeps happens in renderApp.
            _effects[currentIndex] = { //This will overwrite if called multiple times in one component, _effectIndex needs care.
                // Better: _effects.push({...}) and manage matching in renderApp.
                // For this simple model, assuming one useEffect per "component level" and order is stable.
                callback,
                deps, // current dependencies
                hasRun: oldEffectData ? oldEffectData.hasRun : false, // preserve previous run status
                cleanup: oldEffectData ? oldEffectData.cleanup : null, // preserve previous cleanup
                prevDeps: oldEffectData ? oldEffectData.prevDeps : null // preserve previous dependencies
            };
        }


        function createElement(tag, props = {}, ...children) {
            const element = document.createElement(tag);
            Object.entries(props || {}).forEach(([key, value]) => {
                if (key.startsWith('on') && typeof value === 'function') {
                    element.addEventListener(key.substring(2).toLowerCase(), value);
                } else if (key === 'className') {
                    element.setAttribute('class', value);
                } else if (key === 'style' && typeof value === 'object') {
                    Object.assign(element.style, value);
                } else if (key === 'dangerouslySetInnerHTML' && value && typeof value.__html === 'string') {
                    element.innerHTML = value.__html;
                } else if (key === 'value' && (tag === 'input' || tag === 'select' || tag === 'textarea')) {
                    element.value = value; // Set value property for form elements
                } else if (key === 'checked' && tag === 'input' && (props.type === 'checkbox' || props.type === 'radio')) {
                    element.checked = !!value;
                } else if (key === 'disabled' && typeof value === 'boolean') {
                    if (value) element.setAttribute('disabled', ''); else element.removeAttribute('disabled');
                } else if (typeof value === 'boolean' && value) {
                    element.setAttribute(key, '');
                } else if (value !== null && value !== undefined && typeof value !== 'object' && typeof value !== 'function') {
                    element.setAttribute(key, value);
                }
            });
            children.flat().forEach(child => {
                if (child instanceof Node) {
                    element.appendChild(child);
                } else if (child !== null && child !== undefined) {
                    element.appendChild(document.createTextNode(String(child)));
                }
            });
            return element;
        }

        // --- Mock Data ---
        const mockProperties = [
            { id: 1, name: 'Modern Villa with Ocean View', type: 'Villa', location: 'Sunset Cliffs', price: 1200000, beds: 4, baths: 3, area: 320, image: 'https://picsum.photos/seed/prop1/600/400', featured: true, amenities: ['Pool', 'Garage', 'Ocean View', 'Smart Home', 'Air Conditioning'] },
            { id: 2, name: 'Cozy Downtown Apartment', type: 'Apartment', location: 'City Center', price: 450000, beds: 2, baths: 1, area: 90, image: 'https://picsum.photos/seed/prop2/600/400', featured: true, amenities: ['Gym', 'Concierge', 'Balcony', 'City View'] },
            { id: 3, name: 'Spacious Suburban House', type: 'House', location: 'Green Meadows', price: 750000, beds: 5, baths: 3.5, area: 400, image: 'https://picsum.photos/seed/prop3/600/400', featured: true, amenities: ['Garden', 'Fireplace', 'Pet Friendly', 'Garage', 'Patio'] },
            { id: 4, name: 'Luxury Penthouse Suite', type: 'Penthouse', location: 'Skyline Towers', price: 2500000, beds: 3, baths: 4, area: 300, image: 'https://picsum.photos/seed/prop4/600/400', featured: false, amenities: ['Rooftop Terrace', 'Jacuzzi', 'City View', 'Private Elevator', 'Gym'] },
            { id: 5, name: 'Charming Countryside Cottage', type: 'Cottage', location: 'Willow Creek', price: 320000, beds: 2, baths: 1, area: 120, image: 'https://picsum.photos/seed/prop5/600/400', featured: true, amenities: ['Large Garden', 'Quiet Area', 'Historic', 'Fireplace'] },
            { id: 6, name: 'Urban Loft with Industrial Design', type: 'Loft', location: 'Art District', price: 680000, beds: 1, baths: 1.5, area: 150, image: 'https://picsum.photos/seed/prop6/600/400', featured: false, amenities: ['Open Concept', 'High Ceilings', 'Exposed Brick', 'Balcony'] }
        ];

        // --- Components ---
        function Icon({ path, size = '6', className = '', viewBox = '0 0 24 24' }) {
            return createElement('svg', {
                className: `w-${size} h-${size} ${className}`,
                fill: 'currentColor',
                viewBox: viewBox,
                xmlns: 'http://www.w3.org/2000/svg'
            }, createElement('path', { 'd': path, 'fill-rule': 'evenodd', 'clip-rule': 'evenodd' }));
        }

        const ICONS = {
            search: "M10.707 12.121a1 1 0 011.414 0l5.293 5.293a1 1 0 01-1.414 1.414l-5.293-5.293a1 1 0 010-1.414z M11.5 4a7.5 7.5 0 11-15 0 7.5 7.5 0 0115 0zm-1.5 0a6 6 0 10-12 0 6 6 0 0012 0z",
            location: "M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z",
            home: "M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5z",
            dollar: "M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.59 3.48 3.58 3.99 2.01.51 3.11 1.11 3.11 2.35 0 1.21-1.04 2.02-2.82 2.02-1.92 0-2.94-1.06-3.03-2.33H5.1c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.62 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z",
            menu: "M4 6h16M4 12h16M4 18h16",
            moon: "M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z",
            sun: "M12 5a.5.5 0 01.5.5v1a.5.5 0 01-1 0v-1a.5.5 0 01.5-.5zM12 17.5a.5.5 0 01.5.5v1a.5.5 0 01-1 0v-1a.5.5 0 01.5-.5zM9.343 7.257a.5.5 0 01.707-.707l.707.707a.5.5 0 01-.707.707l-.707-.707zM6.257 9.343a.5.5 0 01.707 0l.707.707a.5.5 0 010 .707l-.707.707a.5.5 0 01-.707-.707l.707-.707zM12 15a3 3 0 100-6 3 3 0 000 6zM17.743 9.343a.5.5 0 010 .707l-.707.707a.5.5 0 01-.707-.707l.707-.707a.5.5 0 01.707 0zM14.743 12.25a.5.5 0 01.707 0l.707.707a.5.5 0 010 .707l-.707.707a.5.5 0 01-.707-.707l.707-.707zM7.257 14.657a.5.5 0 01.707.707l-.707.707a.5.5 0 11-.707-.707l.707-.707zM12 7a5 5 0 100 10 5 5 0 000-10zM4.5 12a.5.5 0 01-.5-.5H3a.5.5 0 010-1h1a.5.5 0 01.5.5v.5zM19.5 12a.5.5 0 01-.5-.5h-1a.5.5 0 010-1h1a.5.5 0 01.5.5v.5z",
            user: "M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",
            testimonial: "M4.583 17.417C2.689 17.417.917 15.645.917 13.75S2.689 10.083 4.583 10.083c1.207 0 2.28.67 2.804 1.674.05.09.11.17.19.24.14.14.36.17.53.06.2-.11.28-.38.17-.59C7.521 10.197 6.158 9.25 4.583 9.25c-2.393 0-4.333 1.94-4.333 4.333s1.94 4.334 4.333 4.334c.511 0 .997-.088 1.448-.252.237-.087.385-.324.338-.568a.498.498 0 00-.558-.396c-.33.12-.684.183-1.045.183zm10 0C12.689 17.417 10.917 15.645 10.917 13.75s1.772-3.667 3.666-3.667c1.207 0 2.28.67 2.804 1.674.05.09.11.17.19.24.14.14.36.17.53.06.2-.11.28-.38.17-.59C17.521 10.197 16.158 9.25 14.583 9.25c-2.393 0-4.333 1.94-4.333 4.333s1.94 4.334 4.333 4.334c.511 0 .997-.088 1.448-.252.237-.087.385-.324.338-.568a.498.498 0 00-.558-.396c-.33.12-.684.183-1.045.183z",
            filter: "M3 4h18M7 12h10M10 20h4",
            bath: "M19 4H5C3.89543 4 3 4.89543 3 6V17C3 18.1046 3.89543 19 5 19H8V21H10V19H14V21H16V19H19C20.1046 19 21 18.1046 21 17V6C21 4.89543 20.1046 4 19 4ZM5 6H19V8H5V6ZM5 10H19V17H5V10Z",
            area: "M21 8V3H16M3 8V3H8M21 16V21H16M3 16V21H8M3 12H21M12 3V21",
            gemini: "M10.5 5a4.5 4.5 0 100 9 4.5 4.5 0 000-9zM2 10.5a8.5 8.5 0 1117 0 8.5 8.5 0 01-17 0zM14 10.5a.5.5 0 00-.5-.5h-2.5a.5.5 0 000 1h2.5a.5.5 0 00.5-.5zM10 14a.5.5 0 00.5.5v2.5a.5.5 0 001 0V14.5A.5.5 0 0011 14h-1zm-4.5-.5a.5.5 0 000 1H8a.5.5 0 000-1H5.5zM10 2a.5.5 0 00-.5.5V5a.5.5 0 001 0V2.5A.5.5 0 0010 2z",
            arrowLeft: "M15.75 19.5L8.25 12l7.5-7.5"
        };

        function Navbar({ currentPath, onNavigate, isDarkMode, toggleDarkMode }) {
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

            return createElement('header', { className: 'bg-white dark:bg-gray-800 shadow-md sticky top-0 z-50' },
                createElement('nav', { className: 'container mx-auto px-4 sm:px-6 lg:px-8' },
                    createElement('div', { className: 'flex items-center justify-between h-16' },
                        createElement('div', { className: 'flex items-center' },
                            createElement('a', { href: '#/', onClick: (e) => { e.preventDefault(); onNavigate('/'); setMobileMenuOpen(false); }, className: 'flex-shrink-0 text-2xl font-bold text-emerald-600 dark:text-emerald-400' }, 'Green Valley'),
                            createElement('div', { className: 'hidden md:block' },
                                createElement('div', { className: 'ml-10 flex items-baseline space-x-4' },
                                    createElement('a', { href: '#/', onClick: (e) => { e.preventDefault(); onNavigate('/'); }, className: `px-3 py-2 rounded-md text-sm font-medium ${currentPath === '/' ? 'bg-emerald-500 text-white dark:bg-emerald-600' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700'}` }, 'Home'),
                                    createElement('a', { href: '#/search', onClick: (e) => { e.preventDefault(); onNavigate('/search'); }, className: `px-3 py-2 rounded-md text-sm font-medium ${currentPath === '/search' || currentPath.startsWith('/property/') ? 'bg-emerald-500 text-white dark:bg-emerald-600' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700'}` }, 'Properties'),
                                    createElement('a', { href: '#/about', onClick: (e) => { e.preventDefault(); onNavigate('/about'); }, className: `px-3 py-2 rounded-md text-sm font-medium ${currentPath === '/about' ? 'bg-emerald-500 text-white dark:bg-emerald-600' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700'}` }, 'About Us')
                                )
                            )
                        ),
                        createElement('div', { className: 'flex items-center' },
                            createElement('button', {
                                onClick: toggleDarkMode,
                                className: 'p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none mr-3',
                                title: isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'
                            }, isDarkMode ? Icon({ path: ICONS.sun, size: '5' }) : Icon({ path: ICONS.moon, size: '5' })
                            ),
                            createElement('button', {
                                onClick: () => { alert('Login functionality not implemented yet.'); },
                                className: 'hidden md:block bg-emerald-500 hover:bg-emerald-600 text-white dark:bg-emerald-600 dark:hover:bg-emerald-700 px-4 py-2 rounded-md text-sm font-medium transition duration-150 ease-in-out'
                            }, 'Masuk'),
                            createElement('div', { className: 'md:hidden ml-2' },
                                createElement('button', {
                                    onClick: () => setMobileMenuOpen(!mobileMenuOpen),
                                    className: 'inline-flex items-center justify-center p-2 rounded-md text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-white hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-emerald-500',
                                    'aria-expanded': mobileMenuOpen,
                                    'aria-controls': 'mobile-menu'
                                },
                                    Icon({ path: ICONS.menu, size: '6' })
                                )
                            )
                        )
                    ),
                    createElement('div', { id: 'mobile-menu', className: `${mobileMenuOpen ? 'block' : 'hidden'} md:hidden pb-3 transition-all duration-300 ease-in-out max-h-96 overflow-hidden ${mobileMenuOpen ? 'max-h-96 opacity-100' : 'max-h-0 opacity-0'}` },
                        createElement('div', { className: 'px-2 pt-2 pb-3 space-y-1 sm:px-3' },
                            createElement('a', { href: '#/', onClick: (e) => { e.preventDefault(); onNavigate('/'); setMobileMenuOpen(false); }, className: `block px-3 py-2 rounded-md text-base font-medium ${currentPath === '/' ? 'bg-emerald-500 text-white dark:bg-emerald-600' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700'}` }, 'Home'),
                            createElement('a', { href: '#/search', onClick: (e) => { e.preventDefault(); onNavigate('/search'); setMobileMenuOpen(false); }, className: `block px-3 py-2 rounded-md text-base font-medium ${currentPath === '/search' || currentPath.startsWith('/property/') ? 'bg-emerald-500 text-white dark:bg-emerald-600' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700'}` }, 'Properties'),
                            createElement('a', { href: '#/about', onClick: (e) => { e.preventDefault(); onNavigate('/about'); setMobileMenuOpen(false); }, className: `block px-3 py-2 rounded-md text-base font-medium ${currentPath === '/about' ? 'bg-emerald-500 text-white dark:bg-emerald-600' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700'}` }, 'About Us'),
                            createElement('button', {
                                onClick: () => { alert('Login functionality not implemented yet.'); setMobileMenuOpen(false); },
                                className: 'w-full mt-2 bg-emerald-500 hover:bg-emerald-600 text-white dark:bg-emerald-600 dark:hover:bg-emerald-700 px-4 py-2 rounded-md text-sm font-medium transition duration-150 ease-in-out'
                            }, 'Masuk')
                        )
                    )
                )
            );
        }

        function HeroSection({ onSearch }) {
            const [location, setLocation] = useState('');
            const [type, setType] = useState('');
            const [isFocused, setIsFocused] = useState(false);

            const handleSearch = (e) => {
                e.preventDefault();
                onSearch({ location, type });
            };

            return createElement('section', { className: 'hero-bg bg-cover bg-center relative h-[calc(100vh-4rem)] min-h-[500px] flex items-center justify-center' },
                createElement('div', { className: 'absolute inset-0 bg-black opacity-60' }),
                createElement('div', { className: 'relative z-10 text-center p-6' },
                    createElement('h1', { className: 'text-4xl sm:text-5xl md:text-6xl font-bold text-white mb-6 animate-fade-in-down' },
                        'Find Your Dream Home in ',
                        createElement('span', { className: 'text-emerald-400' }, 'Green Valley')
                    ),
                    createElement('p', { className: 'text-lg sm:text-xl text-gray-200 mb-10 animate-fade-in-up' }, 'Discover a place you\'ll love to live, explore our curated listings.'),
                    createElement('form', {
                        onSubmit: handleSearch,
                        onFocusCapture: () => setIsFocused(true), // Use capture phase for parent focus
                        onBlurCapture: () => setIsFocused(false),  // Use capture phase for parent blur
                        className: `bg-white dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-xl w-full max-w-3xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-4 items-end transition-all duration-300 transform ${isFocused ? 'scale-105 shadow-2xl' : 'scale-100'} animate-zoom-in`
                    },
                        createElement('div', { className: 'md:col-span-1' }, // Changed from md:col-span-2
                            createElement('label', { htmlFor: 'hero-location', className: 'block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1' }, 'Location'),
                            createElement('div', { className: 'relative' },
                                createElement('div', { className: 'absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none' }, Icon({ path: ICONS.location, size: '5', className: 'text-gray-400' })),
                                createElement('input', { type: 'text', id: 'hero-location', value: location, onInput: (e) => setLocation(e.target.value), placeholder: 'e.g., City Center', className: 'w-full pl-10 pr-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500 dark:bg-gray-700 dark:text-white' })
                            )
                        ),
                        createElement('div', {},
                            createElement('label', { htmlFor: 'hero-type', className: 'block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1' }, 'Type'),
                            createElement('div', { className: 'relative' },
                                createElement('div', { className: 'absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none' }, Icon({ path: ICONS.home, size: '5', className: 'text-gray-400' })),
                                createElement('select', { id: 'hero-type', value: type, onChange: (e) => setType(e.target.value), className: 'w-full pl-10 pr-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500 dark:bg-gray-700 dark:text-white' },
                                    createElement('option', { value: '' }, 'Any Type'),
                                    createElement('option', { value: 'House' }, 'House'),
                                    createElement('option', { value: 'Apartment' }, 'Apartment'),
                                    createElement('option', { value: 'Villa' }, 'Villa'),
                                    createElement('option', { value: 'Cottage' }, 'Cottage'),
                                    createElement('option', { value: 'Penthouse' }, 'Penthouse'),
                                    createElement('option', { value: 'Loft' }, 'Loft')
                                )
                            )
                        ),
                        createElement('button', { type: 'submit', className: 'md:col-span-1 w-full bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-2.5 px-4 rounded-md shadow-md flex items-center justify-center space-x-2 transition duration-150 ease-in-out transform hover:scale-105' },
                            Icon({ path: ICONS.search, size: '5' }),
                            createElement('span', {}, 'Search')
                        )
                    )
                )
            );
        }

        function PropertyCard({ property, onDetails }) {
            return createElement('article', {
                className: 'property-card bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden transition-all duration-300 transform hover:shadow-xl hover:-translate-y-1 cursor-pointer flex flex-col',
                onClick: () => onDetails(property.id)
            },
                createElement('div', { className: 'relative' },
                    createElement('img', { src: property.image, alt: property.name, className: 'w-full h-48 object-cover' }),
                    property.featured && createElement('div', { className: `absolute top-2 right-2 bg-emerald-500 text-white text-xs font-semibold px-2 py-1 rounded transition-opacity duration-300` }, 'Featured')
                ),
                createElement('div', { className: 'p-4 sm:p-6 flex flex-col flex-grow' },
                    createElement('h3', { className: 'text-xl font-semibold text-gray-800 dark:text-white mb-1 truncate', title: property.name }, property.name),
                    createElement('p', { className: 'text-emerald-600 dark:text-emerald-400 text-lg font-bold mb-2' }, `$${property.price.toLocaleString()}`),
                    createElement('div', { className: 'flex items-center text-sm text-gray-600 dark:text-gray-400 mb-1 truncate' },
                        Icon({ path: ICONS.location, size: '4', className: 'mr-2 text-emerald-500 flex-shrink-0' }),
                        createElement('span', { className: 'truncate' }, property.location)
                    ),
                    createElement('div', { className: 'flex items-center text-sm text-gray-600 dark:text-gray-400 mb-3' },
                        Icon({ path: ICONS.home, size: '4', className: 'mr-2 text-emerald-500 flex-shrink-0' }),
                        `${property.beds} Beds • ${property.baths} Baths • ${property.area} m²`
                    ),
                    createElement('div', { className: 'mt-auto pt-3' }, // Ensures button is at the bottom
                        createElement('button', {
                            onClick: (e) => { e.stopPropagation(); onDetails(property.id); },
                            className: 'w-full bg-emerald-500 hover:bg-emerald-600 text-white font-medium py-2 px-4 rounded-md transition duration-150 ease-in-out text-sm'
                        }, 'View Details')
                    )
                )
            );
        }

        function FeaturedProperties({ properties, onDetails, onSearch }) {
            const featured = properties.filter(p => p.featured).slice(0, 3);
            return createElement('section', { id: 'featured-properties', className: 'py-12 md:py-20 bg-gray-50 dark:bg-gray-850' },
                createElement('div', { className: 'container mx-auto px-4 sm:px-6 lg:px-8' },
                    createElement('div', { className: 'text-center mb-10 md:mb-16' },
                        createElement('h2', { className: 'text-3xl sm:text-4xl font-bold text-gray-800 dark:text-white mb-3' }, 'Properti Unggulan'),
                        createElement('p', { className: 'text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto' }, 'Jelajahi pilihan properti terbaik kami yang dipilih khusus untuk Anda.')
                    ),
                    featured.length > 0
                        ? createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8' },
                            ...featured.map(prop => PropertyCard({ property: prop, onDetails }))
                        )
                        : createElement('p', { className: 'text-center text-gray-500 dark:text-gray-400 text-lg' }, 'No featured properties available at the moment.'),
                    createElement('div', { className: 'text-center mt-12' },
                        createElement('button', {
                            onClick: () => onSearch({}),
                            className: 'bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-105 text-lg'
                        }, 'Lihat Semua Properti')
                    )
                )
            );
        }

        function TestimonialCard({ testimonial }) {
            return createElement('div', { className: 'bg-white dark:bg-gray-700 p-6 rounded-lg shadow-lg h-full flex flex-col transition-all duration-300 hover:shadow-xl' },
                createElement('div', { className: 'flex-shrink-0 mb-4' }, Icon({ path: ICONS.testimonial, size: '8', className: 'text-emerald-500 dark:text-emerald-400' })),
                createElement('p', { className: 'text-gray-600 dark:text-gray-300 italic mb-4 flex-grow text-sm sm:text-base' }, `"${testimonial.quote}"`),
                createElement('div', { className: 'flex items-center mt-auto' },
                    createElement('img', { src: testimonial.avatar, alt: testimonial.name, className: 'w-12 h-12 rounded-full mr-4 object-cover' }),
                    createElement('div', {},
                        createElement('p', { className: 'font-semibold text-gray-800 dark:text-white' }, testimonial.name),
                        createElement('p', { className: 'text-sm text-gray-500 dark:text-gray-400' }, testimonial.title)
                    )
                )
            );
        }

        function TestimonialsSection() {
            const testimonials = [
                { name: 'Jane Doe', title: 'Happy Homeowner', quote: 'Green Valley helped me find my dream home! The process was smooth and the agents were very professional. The attention to detail was impressive.', avatar: 'https://picsum.photos/seed/user1/100/100' },
                { name: 'John Smith', title: 'Satisfied Seller', quote: 'Selling my property through Green Valley was a breeze. They found a buyer quickly and at a great price. I couldn\'t be happier with the outcome.', avatar: 'https://picsum.photos/seed/user2/100/100' },
                { name: 'Alice Brown', title: 'First-time Buyer', quote: 'As a first-time buyer, I was nervous, but Green Valley guided me every step of the way. Their team is knowledgeable and patient. Highly recommended!', avatar: 'https://picsum.photos/seed/user3/100/100' }
            ];

            return createElement('section', { className: 'py-12 md:py-20 bg-white dark:bg-gray-900' },
                createElement('div', { className: 'container mx-auto px-4 sm:px-6 lg:px-8' },
                    createElement('div', { className: 'text-center mb-10 md:mb-16' },
                        createElement('h2', { className: 'text-3xl sm:text-4xl font-bold text-gray-800 dark:text-white mb-3' }, 'Apa Kata Mereka?'),
                        createElement('p', { className: 'text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto' }, 'Dengarkan dari klien kami yang puas tentang pengalaman mereka dengan Green Valley.')
                    ),
                    createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8' },
                        ...testimonials.map(testimonial => TestimonialCard({ testimonial }))
                    )
                )
            );
        }

        function Footer() {
            return createElement('footer', { className: 'bg-gray-800 dark:bg-black text-gray-300 dark:text-gray-400 py-12' },
                createElement('div', { className: 'container mx-auto px-4 sm:px-6 lg:px-8' },
                    createElement('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-8 mb-8' },
                        createElement('div', {},
                            createElement('h5', { className: 'text-xl font-semibold text-white mb-4' }, 'Green Valley'),
                            createElement('p', { className: 'text-sm mb-4' }, 'Your trusted partner in finding the perfect property. We are committed to providing exceptional service and expertise in the real estate market.'),
                            createElement('p', { className: 'text-sm' }, `© ${new Date().getFullYear()} Green Valley Properties. All rights reserved.`)
                        ),
                        createElement('div', {},
                            createElement('h5', { className: 'text-lg font-semibold text-white mb-4' }, 'Quick Links'),
                            createElement('ul', { className: 'space-y-2 text-sm' },
                                createElement('li', {}, createElement('a', { href: '#/search', onClick: (e) => { e.preventDefault(); router.navigateTo('/search'); }, className: 'hover:text-emerald-400 transition-colors' }, 'Property Search')),
                                createElement('li', {}, createElement('a', { href: '#/about', onClick: (e) => { e.preventDefault(); router.navigateTo('/about'); }, className: 'hover:text-emerald-400 transition-colors' }, 'About Us')),
                                createElement('li', {}, createElement('a', { href: '#/contact', onClick: (e) => { e.preventDefault(); router.navigateTo('/contact'); }, className: 'hover:text-emerald-400 transition-colors' }, 'Contact Us')),
                                createElement('li', {}, createElement('a', { href: '#/terms', onClick: (e) => { e.preventDefault(); router.navigateTo('/terms'); }, className: 'hover:text-emerald-400 transition-colors' }, 'Terms of Service'))
                            )
                        ),
                        createElement('div', {},
                            createElement('h5', { className: 'text-lg font-semibold text-white mb-4' }, 'Contact Us'),
                            createElement('ul', { className: 'space-y-2 text-sm' },
                                createElement('li', {}, '123 Green Valley Rd, Meadowville, PV 12345'),
                                createElement('li', {}, 'Email: info@greenvalley.example.com'),
                                createElement('li', {}, 'Phone: (123) 456-7890')
                            ),
                            createElement('div', { className: 'mt-4 flex space-x-4' },
                                createElement('a', { href: '#', title: "Twitter / X", className: 'text-gray-400 hover:text-emerald-400 transition-colors' }, Icon({ path: 'M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z', size: '5', viewBox: '0 0 24 24' })),
                                createElement('a', { href: '#', title: "Facebook", className: 'text-gray-400 hover:text-emerald-400 transition-colors' }, Icon({ path: 'M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05h2.03v-2.217c0-2.003 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z', size: '5' })),
                                createElement('a', { href: '#', title: "Instagram", className: 'text-gray-400 hover:text-emerald-400 transition-colors' }, Icon({ path: 'M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.011 3.584-.069 4.85c-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07s-3.584-.012-4.85-.07c-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.85s.012-3.584.07-4.85c.149-3.227 1.664-4.771 4.919-4.919C8.416 2.175 8.796 2.163 12 2.163m0-1.623C8.726.54 8.316.527 7.062.478 4.42.331 2.653 1.153.999 2.808.333 4.461.151 6.228.042 8.87C-.011 10.123-.024 10.533-.024 12s.013 1.877.066 3.132c.109 2.641.291 4.408 1.946 6.063 1.654 1.654 3.421 1.836 6.062 1.946 1.254.054 1.665.066 3.93.066s2.675-.012 3.93-.066c2.641-.11 4.407-.292 6.062-1.946 1.655-1.655 1.837-3.422 1.946-6.063.054-1.254.066-1.664.066-3.93s-.012-2.676-.066-3.93c-.109-2.641-.291-4.408-1.946-6.063C21.347 1.153 19.579.331 16.938.042 15.687-.011 15.276-.024 12-.024zM12 6.865A5.135 5.135 0 1012 17.135 5.135 5.135 0 0012 6.865zm0 8.405a3.27 3.27 0 110-6.54 3.27 3.27 0 010 6.54zm5.491-8.88a1.227 1.227 0 100-2.454 1.227 1.227 0 000 2.454z', size: '5' }))
                            )
                        )
                    )
                )
            );
        }

        function HomePage({ onSearch, onDetails, properties }) {
            return createElement('div', null,
                HeroSection({ onSearch }),
                FeaturedProperties({ properties, onDetails, onSearch }),
                TestimonialsSection()
            );
        }

        function SearchPage({ initialFilters, properties, onDetails }) {
            const [filters, setFilters] = useState(() => ({
                location: initialFilters?.location || '',
                type: initialFilters?.type || '',
                sort: 'featured',
                beds: '',
                baths: '',
                minArea: '',
                amenities: []
            }));
            const [searchResults, setSearchResults] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [showAdvancedFilters, setShowAdvancedFilters] = useState(false);

            const allAmenities = [...new Set(properties.flatMap(p => p.amenities || []))].sort();

            const handleFilterChange = (filterName, value) => {
                setFilters(prev => ({ ...prev, [filterName]: value }));
            };

            const handleAmenityChange = (amenity) => {
                setFilters(prev => ({
                    ...prev,
                    amenities: prev.amenities.includes(amenity)
                        ? prev.amenities.filter(a => a !== amenity)
                        : [...prev.amenities, amenity]
                }));
            };

            useEffect(() => {
                setIsLoading(true);
                // Simulate API call / filtering
                const filterTimeout = setTimeout(() => {
                    let filtered = properties.filter(p => {
                        const term = (filters.location || '').toLowerCase();
                        const type = (filters.type || '').toLowerCase();

                        const matchesLocation = !term ||
                            p.name.toLowerCase().includes(term) ||
                            p.location.toLowerCase().includes(term);
                        const matchesType = !type || p.type.toLowerCase() === type;
                        const matchesBeds = !filters.beds || p.beds >= parseInt(filters.beds);
                        const matchesBaths = !filters.baths || p.baths >= parseInt(filters.baths);
                        const matchesArea = !filters.minArea || p.area >= parseInt(filters.minArea);
                        const matchesAmenities = filters.amenities.length === 0 || filters.amenities.every(am => p.amenities && p.amenities.includes(am));

                        return matchesLocation && matchesType && matchesBeds && matchesBaths && matchesArea && matchesAmenities;
                    });

                    if (filters.sort === 'price_asc') {
                        filtered.sort((a, b) => a.price - b.price);
                    } else if (filters.sort === 'price_desc') {
                        filtered.sort((a, b) => b.price - a.price);
                    } else if (filters.sort === 'newest') {
                        filtered.sort((a, b) => b.id - a.id);
                    } else {
                        filtered.sort((a, b) => (b.featured ? 1 : 0) - (a.featured ? 1 : 0) || b.id - a.id);
                    }

                    setSearchResults(filtered);
                    setIsLoading(false);
                }, 300 + Math.random() * 200); // Simulate network delay
                return () => clearTimeout(filterTimeout); // Cleanup timeout
                // eslint-disable-next-line react-hooks/exhaustive-deps
            }, [filters, properties]); // Note: properties is stable in this mock

            // Update filters if initialFilters change (e.g., from hero search)
            useEffect(() => {
                setFilters(prev => ({
                    ...prev, // Keep existing advanced filters
                    location: initialFilters?.location || prev.location,
                    type: initialFilters?.type || prev.type,
                }));
                // eslint-disable-next-line react-hooks/exhaustive-deps
            }, [initialFilters?.location, initialFilters?.type]);


            return createElement('main', { className: 'container mx-auto px-4 sm:px-6 lg:px-8 py-8 min-h-[60vh]' },
                createElement('div', { className: 'bg-white dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md mb-8' },
                    createElement('h1', { className: 'text-2xl sm:text-3xl font-bold text-gray-800 dark:text-white mb-6' }, 'Search Properties'),
                    createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4 items-end' },
                        createElement('div', { className: 'md:col-span-1 lg:col-span-1' }, // Adjusted span
                            createElement('label', { htmlFor: 'search-term', className: 'block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1' }, 'Keyword / Location'),
                            createElement('input', { type: 'text', id: 'search-term', value: filters.location, onInput: (e) => handleFilterChange('location', e.target.value), placeholder: 'Search by name, location...', className: 'w-full p-2.5 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 focus:ring-emerald-500 focus:border-emerald-500' })
                        ),
                        createElement('div', {},
                            createElement('label', { htmlFor: 'search-type', className: 'block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1' }, 'Property Type'),
                            createElement('select', { id: 'search-type', value: filters.type, onChange: (e) => handleFilterChange('type', e.target.value), className: 'w-full p-2.5 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 focus:ring-emerald-500 focus:border-emerald-500' },
                                createElement('option', { value: '' }, 'Any Type'),
                                ...[...new Set(properties.map(p => p.type))].sort().map(type => createElement('option', { value: type }, type))
                            )
                        ),
                        createElement('div', {},
                            createElement('label', { htmlFor: 'search-sort', className: 'block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1' }, 'Sort By'),
                            createElement('select', { id: 'search-sort', value: filters.sort, onChange: (e) => handleFilterChange('sort', e.target.value), className: 'w-full p-2.5 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 focus:ring-emerald-500 focus:border-emerald-500' },
                                createElement('option', { value: 'featured' }, 'Featured'),
                                createElement('option', { value: 'price_asc' }, 'Price: Low to High'),
                                createElement('option', { value: 'price_desc' }, 'Price: High to Low'),
                                createElement('option', { value: 'newest' }, 'Newest Listings')
                            )
                        )
                    ),
                    createElement('button', {
                        onClick: () => setShowAdvancedFilters(prev => !prev),
                        className: 'text-emerald-600 dark:text-emerald-400 hover:underline mb-4 inline-flex items-center text-sm'
                    },
                        Icon({ path: ICONS.filter, size: '5', className: 'mr-2' }),
                        showAdvancedFilters ? 'Hide Advanced Filters' : 'Show Advanced Filters'
                    ),
                    createElement('div', { className: `transition-all duration-300 ease-in-out overflow-hidden ${showAdvancedFilters ? 'max-h-[1000px] opacity-100' : 'max-h-0 opacity-0'}` },
                        createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4 p-4 border border-gray-200 dark:border-gray-700 rounded-md bg-gray-50 dark:bg-gray-750' },
                            createElement('div', {},
                                createElement('label', { htmlFor: 'search-beds', className: 'block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1' }, 'Min. Bedrooms'),
                                createElement('input', { type: 'number', id: 'search-beds', min: "0", value: filters.beds, onInput: (e) => handleFilterChange('beds', e.target.value), placeholder: 'Any', className: 'w-full p-2.5 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 focus:ring-emerald-500 focus:border-emerald-500' })
                            ),
                            createElement('div', {},
                                createElement('label', { htmlFor: 'search-baths', className: 'block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1' }, 'Min. Bathrooms'),
                                createElement('input', { type: 'number', id: 'search-baths', min: "0", step: "0.5", value: filters.baths, onInput: (e) => handleFilterChange('baths', e.target.value), placeholder: 'Any', className: 'w-full p-2.5 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 focus:ring-emerald-500 focus:border-emerald-500' })
                            ),
                            createElement('div', {},
                                createElement('label', { htmlFor: 'search-area', className: 'block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1' }, 'Min. Area (m²)'),
                                createElement('input', { type: 'number', id: 'search-area', min: "0", value: filters.minArea, onInput: (e) => handleFilterChange('minArea', e.target.value), placeholder: 'Any', className: 'w-full p-2.5 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 focus:ring-emerald-500 focus:border-emerald-500' })
                            ),
                            createElement('div', { className: 'md:col-span-2 lg:col-span-3' },
                                createElement('label', { className: 'block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2' }, 'Amenities'),
                                createElement('div', { className: 'grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-x-4 gap-y-2' },
                                    ...allAmenities.map(amenity =>
                                        createElement('label', { className: 'flex items-center space-x-2 p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer select-none' },
                                            createElement('input', {
                                                type: 'checkbox',
                                                checked: filters.amenities.includes(amenity),
                                                onChange: () => handleAmenityChange(amenity),
                                                className: 'h-4 w-4 rounded text-emerald-500 border-gray-300 dark:border-gray-500 focus:ring-emerald-400 dark:bg-gray-600 dark:checked:bg-emerald-500'
                                            }),
                                            createElement('span', { className: 'text-sm text-gray-700 dark:text-gray-300' }, amenity)
                                        )
                                    )
                                )
                            )
                        )
                    )
                ),
                isLoading
                    ? createElement('div', { className: 'text-center py-10' },
                        createElement('div', { className: 'animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-500 mx-auto' }),
                        createElement('p', { className: 'mt-4 text-gray-600 dark:text-gray-400' }, 'Loading properties...')
                    )
                    : searchResults.length > 0
                        ? createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8' },
                            ...searchResults.map(prop => PropertyCard({ property: prop, onDetails }))
                        )
                        : createElement('div', { className: 'text-center py-10' },
                            createElement('p', { className: 'text-xl text-gray-500 dark:text-gray-400' }, 'No properties match your criteria.'),
                            createElement('p', { className: 'mt-2 text-gray-500 dark:text-gray-400' }, 'Try adjusting your filters or searching for a different location.')
                        )
            );
        }

        function PropertyDetailPage({ propertyId, properties, onBack }) {
            const [property, setProperty] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [error, setError] = useState('');
            const [geminiDescription, setGeminiDescription] = useState('');
            const [isGeminiLoading, setIsGeminiLoading] = useState(false);

            useEffect(() => {
                setIsLoading(true);
                setError('');
                setGeminiDescription(''); // Reset Gemini description on new property
                const detailTimeout = setTimeout(() => {
                    const foundProperty = properties.find(p => p.id === parseInt(propertyId));
                    if (foundProperty) {
                        setProperty(foundProperty);
                    } else {
                        setError('Property not found.');
                    }
                    setIsLoading(false);
                }, 300);
                return () => clearTimeout(detailTimeout); // Cleanup timeout
                // eslint-disable-next-line react-hooks/exhaustive-deps
            }, [propertyId, properties]); // properties is stable here

            const fetchGeminiDescription = async () => {
                if (!property || !geminiService.ai) {
                    setGeminiDescription("Property details needed or Gemini service not ready.");
                    return;
                }
                if (process.env.API_KEY === "YOUR_GEMINI_API_KEY_HERE") {
                    setGeminiDescription("AI descriptions require a configured Gemini API Key. Please see console for placeholder key.");
                    return;
                }
                setIsGeminiLoading(true);
                setGeminiDescription('');
                const prompt = `Write an engaging and creative real estate listing description for the following property. Highlight its key features and unique selling points. Be persuasive and paint a picture for potential buyers. Use markdown for formatting if appropriate (bold, lists). Property: ${property.name}.`;
                try {
                    const desc = await geminiService.generateText(prompt, property); // Pass property for mock context
                    setGeminiDescription(desc);
                } catch (e) {
                    console.error("Gemini fetch error:", e);
                    setGeminiDescription("Could not generate AI description at this time.");
                } finally {
                    setIsGeminiLoading(false);
                }
            };

            if (isLoading) return createElement('div', { className: 'text-center py-20 min-h-[60vh] flex flex-col justify-center items-center' },
                createElement('div', { className: 'animate-spin rounded-full h-16 w-16 border-b-2 border-emerald-500 mx-auto' }),
                createElement('p', { className: 'mt-4 text-gray-600 dark:text-gray-400 text-lg' }, 'Loading property details...')
            );
            if (error) return createElement('div', { className: 'text-center py-20 min-h-[60vh] flex flex-col justify-center items-center' },
                createElement('p', { className: 'text-2xl text-red-500' }, error),
                createElement('button', { onClick: onBack, className: 'mt-4 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-2 px-4 rounded' }, 'Go Back')
            );
            if (!property) return null;

            return createElement('main', { className: 'container mx-auto px-4 sm:px-6 lg:px-8 py-8' },
                createElement('button', { onClick: onBack, className: 'mb-6 inline-flex items-center text-emerald-600 dark:text-emerald-400 hover:underline font-medium' },
                    Icon({ path: ICONS.arrowLeft, strokeWidth: 2, className: 'mr-2 stroke-current', fill: 'none' }), // Use stroke for this icon
                    'Back to Listings'
                ),
                createElement('div', { className: 'bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden' },
                    createElement('img', { src: property.image.replace('/600/400', '/1200/600') + `&v=${property.id}`, alt: property.name, className: 'w-full h-64 md:h-96 object-cover' }),
                    createElement('div', { className: 'p-6 md:p-10' },
                        createElement('h1', { className: 'text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2' }, property.name),
                        createElement('p', { className: 'text-xl text-gray-600 dark:text-gray-400 mb-4 flex items-center' },
                            Icon({ path: ICONS.location, size: '5', className: 'mr-2 text-emerald-500 flex-shrink-0' }),
                            property.location
                        ),
                        createElement('p', { className: 'text-3xl font-bold text-emerald-600 dark:text-emerald-400 mb-6' }, `$${property.price.toLocaleString()}`),

                        createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-6 text-gray-700 dark:text-gray-300' },
                            createElement('div', { className: 'flex items-center space-x-2 p-3 bg-gray-100 dark:bg-gray-700 rounded-lg' }, Icon({ path: ICONS.home, size: '6', className: 'text-emerald-500 flex-shrink-0' }), createElement('span', {}, `${property.beds} Bedrooms`)),
                            createElement('div', { className: 'flex items-center space-x-2 p-3 bg-gray-100 dark:bg-gray-700 rounded-lg' }, Icon({ path: ICONS.bath, size: '6', className: 'text-emerald-500 flex-shrink-0' }), createElement('span', {}, `${property.baths} Bathrooms`)),
                            createElement('div', { className: 'flex items-center space-x-2 p-3 bg-gray-100 dark:bg-gray-700 rounded-lg' }, Icon({ path: ICONS.area, size: '6', className: 'text-emerald-500 flex-shrink-0' }), createElement('span', {}, `${property.area} m² Area`))
                        ),

                        property.amenities && property.amenities.length > 0 && createElement('div', { className: 'mb-6' },
                            createElement('h3', { className: 'text-xl font-semibold text-gray-800 dark:text-white mb-3' }, 'Amenities'),
                            createElement('ul', { className: 'list-none grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-2 text-gray-700 dark:text-gray-300' },
                                ...property.amenities.map(amenity => createElement('li', { className: 'flex items-center' },
                                    createElement('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 20 20", fill: "currentColor", className: "w-4 h-4 mr-2 text-emerald-500 flex-shrink-0" }, createElement('path', { fillRule: "evenodd", d: "M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z", clipRule: "evenodd" })),
                                    amenity
                                ))
                            )
                        ),

                        createElement('div', { className: 'mt-8 pt-6 border-t border-gray-200 dark:border-gray-700' },
                            createElement('h3', { className: 'text-xl font-semibold text-gray-800 dark:text-white mb-3 flex items-center' },
                                Icon({ path: ICONS.gemini, size: '6', className: 'mr-2 text-blue-500', viewBox: '0 0 20 20' }),
                                'AI Generated Description'
                            ),
                            isGeminiLoading && createElement('div', { className: 'flex items-center space-x-2 text-gray-600 dark:text-gray-400' },
                                createElement('div', { className: 'animate-spin rounded-full h-5 w-5 border-b-2 border-emerald-500' }),
                                createElement('span', {}, 'Generating description with Gemini AI...')
                            ),
                            !isGeminiLoading && geminiDescription && createElement('div', { className: 'prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 whitespace-pre-line' },
                                // Basic markdown parsing (bold and lists)
                                ...geminiDescription.split('\n').map(line => {
                                    if (line.startsWith('* ')) return createElement('li', {}, line.substring(2));
                                    if (line.startsWith('- ')) return createElement('li', {}, line.substring(2));
                                    let currentLine = line;
                                    currentLine = currentLine.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); // Bold
                                    currentLine = currentLine.replace(/\*(.*?)\*/g, '<em>$1</em>');     // Italics
                                    return createElement('p', { dangerouslySetInnerHTML: { __html: currentLine } });
                                })
                            ),
                            !isGeminiLoading && !geminiDescription && createElement('button', {
                                onClick: fetchGeminiDescription,
                                className: `bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded inline-flex items-center space-x-2 ${process.env.API_KEY === "YOUR_GEMINI_API_KEY_HERE" ? "opacity-50 cursor-not-allowed" : ""}`,
                                disabled: process.env.API_KEY === "YOUR_GEMINI_API_KEY_HERE"
                            },
                                Icon({ path: ICONS.gemini, size: '5', className: 'mr-1', viewBox: '0 0 20 20' }),
                                createElement('span', {}, process.env.API_KEY === "YOUR_GEMINI_API_KEY_HERE" ? "Configure API Key for AI" : "Generate with Gemini AI")
                            ),
                            process.env.API_KEY === "YOUR_GEMINI_API_KEY_HERE" && !geminiDescription && !isGeminiLoading && createElement('p', { className: 'text-sm text-gray-500 dark:text-gray-400 mt-2' }, 'Note: Gemini AI features require a valid API key. This is a demo and uses a placeholder key.')
                        ),

                        createElement('div', { className: 'mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-center' },
                            createElement('button', {
                                onClick: () => alert('Contact agent functionality not implemented.'),
                                className: 'bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 px-8 rounded-lg text-lg transition duration-150 ease-in-out transform hover:scale-105'
                            }, 'Contact Agent')
                        )
                    )
                )
            );
        }

        function PlaceholderPage({ title, message }) {
            return createElement('main', { className: 'container mx-auto px-4 sm:px-6 lg:px-8 py-20 text-center min-h-[60vh] flex flex-col justify-center items-center' },
                createElement('h1', { className: 'text-4xl font-bold text-gray-800 dark:text-white mb-4' }, title),
                createElement('p', { className: 'text-xl text-gray-600 dark:text-gray-400' }, message || 'This page is under construction.'),
                createElement('button', {
                    onClick: () => router.navigateTo('/'),
                    className: 'mt-8 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-2 px-6 rounded-lg'
                }, 'Go to Homepage')
            );
        }

        const router = {
            routes: {},
            currentPath: '',
            currentParams: {},
            lastNavigatedPath: '', // To help PropertyDetail go back to search if it came from there
            addRoute: (path, component) => {
                router.routes[path] = component;
            },
            resolveRoute: (rawPath) => {
                let path = rawPath || window.location.hash.slice(1) || '/';
                let params = {};

                for (const routePath in router.routes) {
                    const routeParts = routePath.split('/');
                    const pathParts = path.split('/');
                    if (routeParts.length === pathParts.length) {
                        let match = true;
                        let currentParams = {};
                        for (let i = 0; i < routeParts.length; i++) {
                            if (routeParts[i].startsWith(':')) {
                                currentParams[routeParts[i].substring(1)] = pathParts[i];
                            } else if (routeParts[i] !== pathParts[i]) {
                                match = false;
                                break;
                            }
                        }
                        if (match) {
                            router.currentPath = routePath;
                            router.currentParams = currentParams;
                            return router.routes[routePath];
                        }
                    }
                }
                router.currentPath = path;
                router.currentParams = {};
                return router.routes[path] || router.routes['/404'];
            },
            navigateTo: (path, params = {}) => {
                let targetPath = path;
                if (path.includes(':')) {
                    for (const key in params) {
                        targetPath = targetPath.replace(`:${key}`, params[key]);
                    }
                }
                router.lastNavigatedPath = window.location.hash.slice(1) || '/'; // Store where we are coming from
                window.location.hash = targetPath;
                // The hashchange event will trigger the render, no need to call resolveRoute here
            }
        };

        function App() {
            const [currentRouteInfo, setCurrentRouteInfo] = useState(() => {
                const initialPath = window.location.hash.slice(1) || '/';
                return { Component: router.resolveRoute(initialPath), path: router.currentPath, params: router.currentParams };
            });
            const [searchFiltersForDetailPage, setSearchFiltersForDetailPage] = useState({}); // To pass to SearchPage
            const [isDarkMode, setIsDarkMode] = useState(() => {
                if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    return true;
                }
                return false;
            });

            const handleNavigation = (path, params = {}) => {
                router.navigateTo(path, params);
            };

            const handleSearchFromHero = (filters) => {
                setSearchFiltersForDetailPage(filters); // Store filters for potential navigation back to SearchPage
                router.navigateTo('/search'); // Let SearchPage handle its own initial filter state based on this.
            };

            const handleViewDetails = (propertyId) => {
                router.navigateTo(`/property/:id`, { id: propertyId });
            };

            const toggleDarkMode = () => {
                setIsDarkMode(prevMode => {
                    const newMode = !prevMode;
                    if (newMode) {
                        document.documentElement.classList.add('dark');
                        localStorage.theme = 'dark';
                    } else {
                        document.documentElement.classList.remove('dark');
                        localStorage.theme = 'light';
                    }
                    return newMode;
                });
            };

            useEffect(() => {
                if (isDarkMode) document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');

                const GREETING_KEY = 'greenValleyGreetingShown';
                if (!sessionStorage.getItem(GREETING_KEY) && geminiService.ai && process.env.API_KEY !== "YOUR_GEMINI_API_KEY_HERE") {
                    geminiService.generateText("Write a very short, friendly, and welcoming greeting message for a user visiting the 'Green Valley' real estate website for the first time. Max 1 concise sentence.")
                        .then(greeting => {
                            if (greeting && !greeting.toLowerCase().includes("error") && !greeting.toLowerCase().includes("mock")) {
                                // For a more user-friendly approach, consider a small, dismissible toast notification.
                                console.info("Green Valley AI Welcome:", greeting);
                                sessionStorage.setItem(GREETING_KEY, 'true');
                            }
                        }).catch(err => console.error("AI Greeting Error:", err));
                }
                // eslint-disable-next-line react-hooks/exhaustive-deps
            }, []);

            useEffect(() => {
                const handleHashChange = () => {
                    const newPath = window.location.hash.slice(1) || '/';
                    setCurrentRouteInfo({ Component: router.resolveRoute(newPath), path: router.currentPath, params: router.currentParams });
                    window.scrollTo(0, 0);
                };
                window.addEventListener('hashchange', handleHashChange);
                // Initial call to set component based on current hash, if any (e.g. page refresh)
                handleHashChange();
                return () => window.removeEventListener('hashchange', handleHashChange);
                // eslint-disable-next-line react-hooks/exhaustive-deps
            }, []);

            let pageContent;
            const { Component, path: currentDisplayPath, params: currentDisplayParams } = currentRouteInfo;

            if (currentDisplayPath === '/') {
                pageContent = HomePage({ onSearch: handleSearchFromHero, onDetails: handleViewDetails, properties: mockProperties });
            } else if (currentDisplayPath === '/search') {
                // SearchPage now gets initial filters from `searchFiltersForDetailPage` if navigating from hero, or empty if direct nav.
                pageContent = SearchPage({ initialFilters: searchFiltersForDetailPage, properties: mockProperties, onDetails: handleViewDetails });
            } else if (currentDisplayPath === '/property/:id') {
                pageContent = PropertyDetailPage({
                    propertyId: currentDisplayParams.id,
                    properties: mockProperties,
                    onBack: () => router.navigateTo(router.lastNavigatedPath.startsWith('/search') ? router.lastNavigatedPath : '/search')
                });
            } else if (currentDisplayPath === '/about') {
                pageContent = PlaceholderPage({ title: 'About Green Valley', message: 'We are dedicated to helping you find your perfect home with transparency and expertise in the vibrant Green Valley area.' });
            } else if (currentDisplayPath === '/contact') {
                pageContent = PlaceholderPage({ title: 'Contact Us', message: 'Get in touch with our team for any inquiries or to schedule a viewing. We are here to assist you!' });
            } else if (currentDisplayPath === '/terms') {
                pageContent = PlaceholderPage({ title: 'Terms of Service', message: 'Please read our terms and conditions carefully before using our services.' });
            }
            else {
                pageContent = PlaceholderPage({ title: '404 - Page Not Found', message: 'Oops! The page you are looking for does not exist or may have been moved.' });
            }

            return createElement('div', { className: 'flex flex-col min-h-screen' },
                Navbar({ currentPath: currentDisplayPath, onNavigate: handleNavigation, isDarkMode, toggleDarkMode }),
                createElement('main', { className: 'flex-grow relative' }, // Added relative for potential future absolute positioned elements within pages
                    pageContent
                ),
                Footer()
            );
        }

        router.addRoute('/', HomePage);
        router.addRoute('/search', SearchPage);
        router.addRoute('/property/:id', PropertyDetailPage);
        router.addRoute('/about', () => PlaceholderPage({ title: 'About Us' })); // These simple routes can be direct functions
        router.addRoute('/contact', () => PlaceholderPage({ title: 'Contact Us' }));
        router.addRoute('/terms', () => PlaceholderPage({ title: 'Terms of Service' }));
        router.addRoute('/404', () => PlaceholderPage({ title: '404 - Page Not Found' }));

        _rootComponent = App;
        _rootElement = document.getElementById('root');

        renderApp(); // Initial Render

        // Animations defined via JS (or can be in <style>)
        const dynamicStyles = `
            @keyframes fade-in-down { 0% { opacity: 0; transform: translateY(-20px); } 100% { opacity: 1; transform: translateY(0); } }
            .animate-fade-in-down { animation: fade-in-down 0.6s ease-out forwards; }

            @keyframes fade-in-up { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } }
            .animate-fade-in-up { animation: fade-in-up 0.6s ease-out 0.2s forwards; }

            @keyframes zoom-in { 0% { opacity: 0; transform: scale(0.95); } 100% { opacity: 1; transform: scale(1); } }
            .animate-zoom-in { animation: zoom-in 0.5s ease-out 0.4s forwards; }
        `;
        const styleSheet = document.createElement("style");
        styleSheet.innerText = dynamicStyles;
        document.head.appendChild(styleSheet);

    </script>
</body>

</html>