<!DOCTYPE html>
<html lang="id" class="light"> <!-- Tema awal diatur oleh JS, bisa default ke light -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apartemen Green Valley</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        primary: { light: '#4CAF50', DEFAULT: '#388E3C', dark: '#2E7D32' },
                        secondary: { light: '#AED581', DEFAULT: '#8BC34A', dark: '#689F38' },
                        accent: { light: '#FFC107', DEFAULT: '#FF9800', dark: '#F57C00' },
                        background: { light: '#F7FAFC', dark: '#1A202C' },
                        card: { light: '#FFFFFF', dark: '#2D3748' },
                        text: { light: '#2D3748', dark: '#E2E8F0' },
                        border: { light: '#E2E8F0', dark: '#4A5568' }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: 'Poppins', sans-serif;
        }

        .hidden-content {
            display: none !important;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #388E3C;
            /* primary.DEFAULT */
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Smooth transitions for theme changes */
        body,
        .bg-card-light,
        .bg-background-light,
        #navbar-container,
        #footer-container {
            transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out, border-color 0.3s ease-in-out;
        }

        .transition-colors {
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
        }

        .duration-300 {
            transition-duration: 300ms;
        }
    </style>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.1.0",
    "react-dom/": "https://esm.sh/react-dom@^19.1.0/",
    "react/": "https://esm.sh/react@^19.1.0/",
    "react-router-dom": "https://esm.sh/react-router-dom@^7.6.1"
  }
}
</script>
</head>

<body class="bg-background-light text-text-light">

    <div id="app-container" class="flex flex-col min-h-screen">
        <header id="navbar-container" class="sticky top-0 z-50 shadow-md"></header>
        <main id="page-content-container" class="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">
            <!-- Konten halaman akan dimuat di sini -->
        </main>
        <footer id="footer-container" class="border-t py-8 text-center"></footer>
    </div>

    <script type="module">
        // --- KONSTANTA DAN DATA ---
        const NAV_LINKS = [
            { name: 'Dasbor', path: '#/' },
            { name: 'Properti', path: '#/properti' },
            { name: 'Kelola Daftar', path: '#/kelola' },
        ];

        const PROPERTY_TYPES_OPTIONS = ['semua', 'Apartemen', 'Rumah', 'Kondominium', 'Townhouse'];
        const BEDROOM_OPTIONS_SELECT = ['semua', 1, 2, 3, 4, 5];

        const MOCK_PROPERTIES_DATA = [
            {
                id: '1',
                nama: 'Apartemen Sunny Meadows',
                lokasi: 'Jl. Green Valley No. 123, SpringField',
                harga: 18000000, // Rupiah
                kamarTidur: 2,
                kamarMandi: 1,
                luas: 78, // m¬≤
                tipe: 'Apartemen',
                imageUrl: 'https://picsum.photos/seed/prop1/600/400',
                deskripsi: 'Apartemen cerah dan lapang dengan sentuhan modern dan balkon menghadap taman.',
                fasilitas: ['Parkir', 'Gym', 'Kolam Renang', 'Ramah Hewan'],
                tersediaMulai: '2024-08-01',
            },
            {
                id: '2',
                nama: 'Rumah Keluarga Oakwood',
                lokasi: 'Jl. Oak No. 456, Willow Creek',
                harga: 37500000,
                kamarTidur: 4,
                kamarMandi: 2.5,
                luas: 204,
                tipe: 'Rumah',
                imageUrl: 'https://picsum.photos/seed/prop2/600/400',
                deskripsi: 'Rumah keluarga luas dengan halaman belakang besar, cocok untuk aktivitas luar ruangan.',
                fasilitas: ['Garasi', 'Taman', 'Perapian', 'Ruang Cuci'],
                tersediaMulai: '2024-09-15',
            },
            {
                id: '3',
                nama: 'Kondominium Modern Pusat Kota',
                lokasi: 'Jl. Central No. 789, Metro City',
                harga: 27000000,
                kamarTidur: 1,
                kamarMandi: 1,
                luas: 55,
                tipe: 'Kondominium',
                imageUrl: 'https://picsum.photos/seed/prop3/600/400',
                deskripsi: 'Kondominium bergaya di jantung kota, dekat dengan semua fasilitas dan hiburan malam.',
                fasilitas: ['Teras Atap', 'Concierge', 'Pusat Kebugaran', 'Keamanan 24 Jam'],
                tersediaMulai: '2024-07-20',
            },
            {
                id: '4',
                nama: 'Townhouse Tepi Sungai',
                lokasi: 'Jl. Riverbend No. 101, Lakeside',
                harga: 30000000,
                kamarTidur: 3,
                kamarMandi: 2,
                luas: 139,
                tipe: 'Townhouse',
                imageUrl: 'https://picsum.photos/seed/prop4/600/400',
                deskripsi: 'Townhouse menawan dengan pemandangan sungai dan patio pribadi.',
                fasilitas: ['Patio', 'Kolam Renang Komunitas', 'Jalur Jalan Kaki', 'Garasi Terhubung'],
                tersediaMulai: '2024-10-01',
            },
            {
                id: '5',
                nama: 'Apartemen Studio Nyaman',
                lokasi: 'Jl. Pine No. 222, Northwood',
                harga: 14250000,
                kamarTidur: 1,
                kamarMandi: 1,
                luas: 41,
                tipe: 'Apartemen',
                imageUrl: 'https://picsum.photos/seed/prop5/600/400',
                deskripsi: 'Studio ringkas dan nyaman, ideal untuk profesional lajang atau mahasiswa.',
                fasilitas: ['Laundry di Tempat', 'Penyimpanan Sepeda', 'Termasuk Utilitas (sebagian)'],
                tersediaMulai: '2024-08-10',
            }
        ];

        // --- STATUS APLIKASI ---
        const appState = {
            theme: localStorage.getItem('green-valley-theme-native') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'),
            currentPage: getCurrentPath(),
            properties: [...MOCK_PROPERTIES_DATA],
            filteredProperties: [...MOCK_PROPERTIES_DATA],
            filters: {
                searchTerm: '',
                bedrooms: 'semua',
                propertyType: 'semua',
                minPrice: '',
                maxPrice: '',
            },
            isLoading: false,
            isMobileMenuOpen: false,
        };

        // --- PEMILIH DOM ---
        const htmlElement = document.documentElement;
        const bodyElement = document.body;
        const navbarContainer = document.getElementById('navbar-container');
        const pageContentContainer = document.getElementById('page-content-container');
        const footerContainer = document.getElementById('footer-container');

        // --- FUNGSI TEMA ---
        function applyTheme() {
            htmlElement.classList.remove(appState.theme === 'light' ? 'dark' : 'light');
            htmlElement.classList.add(appState.theme);
            // Tailwind dark: prefix akan menangani styling elemen body dan lainnya
            localStorage.setItem('green-valley-theme-native', appState.theme);
            renderNavbar(); // Render ulang navbar untuk ikon tema
        }

        function toggleTheme() {
            appState.theme = appState.theme === 'light' ? 'dark' : 'light';
            applyTheme();
        }

        // --- KOMPONEN IKON (SVG Strings) ---
        const SunIcon = (className = "w-6 h-6") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg>`;
        const MoonIcon = (className = "w-6 h-6") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>`;
        const SearchIcon = (className = "h-5 w-5 text-gray-400") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>`;
        const FilterIcon = (className = "h-5 w-5 mr-2") => `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>`;
        const MenuIcon = (className = "block h-6 w-6") => `<svg class="${className}" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>`;
        const CloseIcon = (className = "block h-6 w-6") => `<svg class="${className}" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>`;

        // --- FUNGSI RENDER KOMPONEN UI ---
        function renderNavbar() {
            const linksHTML = NAV_LINKS.map(link => `
                <a href="${link.path}" 
                   class="nav-link px-3 py-2 rounded-md text-sm font-medium transition-colors 
                          ${appState.currentPage === link.path.slice(1) || (appState.currentPage === '/' && link.path === '#/')
                    ? 'bg-primary text-white dark:bg-primary-dark dark:text-gray-100'
                    : 'text-text-light dark:text-text-dark hover:bg-gray-100 dark:hover:bg-gray-700'}"
                   aria-current="${appState.currentPage === link.path.slice(1) ? 'page' : 'false'}">
                  ${link.name}
                </a>
            `).join('');

            navbarContainer.className = "bg-card-light dark:bg-card-dark shadow-md sticky top-0 z-50 transition-colors duration-300";
            navbarContainer.innerHTML = `
                <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex items-center justify-between h-16">
                        <div class="flex items-center">
                            <a href="#/" class="flex-shrink-0">
                                <span class="text-2xl font-bold font-display text-primary dark:text-primary-light">
                                    GreenValley
                                </span>
                            </a>
                        </div>
                        <div class="hidden md:block">
                            <div class="ml-10 flex items-baseline space-x-4">
                                ${linksHTML}
                            </div>
                        </div>
                        <div class="flex items-center">
                            <button id="theme-toggle-button" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-primary-dark dark:text-primary-light transition-colors"
                                    aria-label="${appState.theme === 'light' ? 'Ganti ke tema gelap' : 'Ganti ke tema terang'}">
                                ${appState.theme === 'light' ? MoonIcon() : SunIcon()}
                            </button>
                            <div class="md:hidden ml-2">
                                <button id="mobile-menu-button" type="button" 
                                        class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-text-dark dark:hover:text-text-light hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary" 
                                        aria-controls="mobile-menu-dropdown" aria-expanded="${appState.isMobileMenuOpen}">
                                    <span class="sr-only">Buka menu utama</span>
                                    ${appState.isMobileMenuOpen ? CloseIcon() : MenuIcon()}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="${appState.isMobileMenuOpen ? '' : 'hidden'} md:hidden" id="mobile-menu-dropdown">
                    <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                        ${linksHTML}
                    </div>
                </div>
            `;
            document.getElementById('theme-toggle-button')?.addEventListener('click', toggleTheme);
            document.getElementById('mobile-menu-button')?.addEventListener('click', toggleMobileMenu);
            navbarContainer.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', () => {
                    if (appState.isMobileMenuOpen) {
                        toggleMobileMenu(); // Close mobile menu on navigation
                    }
                });
            });
        }

        function toggleMobileMenu() {
            appState.isMobileMenuOpen = !appState.isMobileMenuOpen;
            renderNavbar(); // Re-render navbar to update mobile menu state and icon
        }

        function renderFooter() {
            footerContainer.className = "bg-card-light dark:bg-card-dark border-t border-border-light dark:border-border-dark py-8 text-center transition-colors duration-300";
            footerContainer.innerHTML = `
                <div class="container mx-auto px-4">
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                        &copy; ${new Date().getFullYear()} Apartemen Green Valley. Hak cipta dilindungi.
                    </p>
                    <p class="text-xs text-gray-500 dark:text-gray-500 mt-1">
                        Dibuat dengan HTML, Tailwind CSS, dan JavaScript native ‚ù§Ô∏è
                    </p>
                </div>
            `;
        }

        function createPropertyCard(property) {
            const formattedPrice = `Rp ${property.harga.toLocaleString('id-ID')}`;
            return `
                <div class="bg-card-light dark:bg-card-dark rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300 flex flex-col">
                    <img class="w-full h-56 object-cover" src="${property.imageUrl}" alt="${property.nama}">
                    <div class="p-6 flex flex-col flex-grow">
                        <h3 class="text-xl font-semibold font-display text-primary dark:text-primary-light mb-2">${property.nama}</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">${property.lokasi}</p>
                        <p class="text-lg font-bold text-secondary dark:text-secondary-light mb-3">${formattedPrice}/bulan</p>
                        
                        <div class="grid grid-cols-2 gap-2 text-sm text-gray-700 dark:text-gray-300 mb-4">
                            <span>üõèÔ∏è ${property.kamarTidur} Kamar Tidur</span>
                            <span>üõÅ ${property.kamarMandi} Kamar Mandi</span>
                            <span>üìê ${property.luas} m¬≤</span>
                            <span>üè¢ ${property.tipe}</span>
                        </div>

                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 h-16 overflow-hidden text-ellipsis flex-grow">${property.deskripsi}</p>
                        
                        <div class="flex flex-wrap gap-2 mb-4">
                            ${property.fasilitas.slice(0, 3).map(amenity => `
                                <span class="text-xs bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-2 py-1 rounded-full">${amenity}</span>
                            `).join('')}
                            ${property.fasilitas.length > 3 ? `<span class="text-xs bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-2 py-1 rounded-full">+${property.fasilitas.length - 3} lainnya</span>` : ''}
                        </div>

                        <button data-property-id="${property.id}" class="mt-auto w-full bg-primary hover:bg-primary-dark text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-primary-light dark:focus:ring-primary-dark">
                            Lihat Detail
                        </button>
                    </div>
                </div>
            `;
        }

        function renderSearchBar() {
            const { searchTerm, bedrooms, propertyType, minPrice, maxPrice } = appState.filters;
            return `
                <form id="filter-form" class="bg-card-light dark:bg-card-dark p-6 rounded-lg shadow-md mb-8 space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end">
                        <div>
                            <label for="searchTerm" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Cari Nama/Lokasi</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">${SearchIcon()}</div>
                                <input type="text" name="searchTerm" id="searchTerm" value="${searchTerm}" placeholder="cth., Sunny Meadows, Springfield"
                                       class="w-full pl-10 pr-3 py-2 border border-border-light dark:border-border-dark rounded-md shadow-sm focus:ring-primary focus:border-primary dark:bg-gray-700 dark:text-white sm:text-sm">
                            </div>
                        </div>
                        <div>
                            <label for="bedrooms" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Kamar Tidur</label>
                            <select name="bedrooms" id="bedrooms" value="${bedrooms}" class="w-full py-2 px-3 border border-border-light dark:border-border-dark rounded-md shadow-sm focus:ring-primary focus:border-primary dark:bg-gray-700 dark:text-white sm:text-sm">
                                ${BEDROOM_OPTIONS_SELECT.map(opt => `<option value="${opt}">${opt === 'semua' ? 'Semua' : `${opt} Kamar`}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label for="propertyType" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Tipe Properti</label>
                            <select name="propertyType" id="propertyType" value="${propertyType}" class="w-full py-2 px-3 border border-border-light dark:border-border-dark rounded-md shadow-sm focus:ring-primary focus:border-primary dark:bg-gray-700 dark:text-white sm:text-sm">
                                ${PROPERTY_TYPES_OPTIONS.map(type => `<option value="${type}">${type === 'semua' ? 'Semua Tipe' : type}</option>`).join('')}
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                           <div>
                                <label for="minPrice" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Harga Min (Rp)</label>
                                <input type="number" name="minPrice" id="minPrice" value="${minPrice}" placeholder="0" class="w-full py-2 px-3 border border-border-light dark:border-border-dark rounded-md shadow-sm focus:ring-primary focus:border-primary dark:bg-gray-700 dark:text-white sm:text-sm">
                           </div>
                           <div>
                                <label for="maxPrice" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Harga Max (Rp)</label>
                                <input type="number" name="maxPrice" id="maxPrice" value="${maxPrice}" placeholder="Semua" class="w-full py-2 px-3 border border-border-light dark:border-border-dark rounded-md shadow-sm focus:ring-primary focus:border-primary dark:bg-gray-700 dark:text-white sm:text-sm">
                           </div>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <button type="submit" class="flex items-center bg-primary hover:bg-primary-dark text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-primary-light dark:focus:ring-primary-dark">
                            ${FilterIcon()} Terapkan Filter
                        </button>
                    </div>
                </form>
            `;
        }

        // --- FUNGSI RENDER HALAMAN ---
        function renderDashboardPage() {
            pageContentContainer.innerHTML = `
                <div class="space-y-8">
                    <header class="bg-card-light dark:bg-card-dark shadow rounded-lg p-6">
                        <h1 class="text-3xl font-bold font-display text-primary dark:text-primary-light">Dasbor</h1>
                        <p class="mt-2 text-gray-600 dark:text-gray-400">Selamat datang di Manajemen Apartemen Green Valley.</p>
                    </header>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="bg-card-light dark:bg-card-dark shadow rounded-lg p-6">
                            <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-200">Total Properti</h2>
                            <p class="text-3xl font-bold text-primary dark:text-primary-light mt-2">125</p>
                        </div>
                        <div class="bg-card-light dark:bg-card-dark shadow rounded-lg p-6">
                            <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-200">Tingkat Hunian</h2>
                            <p class="text-3xl font-bold text-secondary dark:text-secondary-light mt-2">88%</p>
                        </div>
                        <div class="bg-card-light dark:bg-card-dark shadow rounded-lg p-6">
                            <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-200">Aplikasi Tertunda</h2>
                            <p class="text-3xl font-bold text-accent dark:text-accent-light mt-2">12</p>
                        </div>
                    </div>
                    <div class="bg-card-light dark:bg-card-dark shadow rounded-lg p-6">
                        <h2 class="text-xl font-semibold font-display text-gray-700 dark:text-gray-200 mb-4">Aktivitas Terkini</h2>
                        <ul class="space-y-3 text-gray-600 dark:text-gray-400">
                            <li class="border-b border-border-light dark:border-border-dark pb-2">Sewa baru ditandatangani untuk Apt 3B.</li>
                            <li class="border-b border-border-light dark:border-border-dark pb-2">Permintaan perawatan untuk Unit 12A selesai.</li>
                            <li>3 daftar properti baru ditambahkan.</li>
                        </ul>
                    </div>
                    <div class="mt-8 text-center">
                        <img src="https://picsum.photos/seed/dashboard/800/300" alt="Lembah hijau nan indah" class="rounded-lg shadow-md mx-auto">
                        <p class="mt-4 text-gray-600 dark:text-gray-400">Nikmati pemandangan Green Valley yang menenangkan.</p>
                    </div>
                </div>
            `;
        }

        function renderPropertiesPage() {
            let contentHTML = `
                <div class="space-y-8">
                    <header class="bg-card-light dark:bg-card-dark shadow rounded-lg p-6">
                        <h1 class="text-3xl font-bold font-display text-primary dark:text-primary-light">Temukan Apartemen Ideal Anda</h1>
                        <p class="mt-2 text-gray-600 dark:text-gray-400">Jelajahi daftar properti pilihan kami yang tersedia.</p>
                    </header>
                    ${renderSearchBar()}
            `;

            if (appState.isLoading) {
                contentHTML += `
                    <div class="flex flex-col justify-center items-center h-64">
                        <div class="spinner"></div>
                        <p class="ml-4 text-lg text-gray-600 dark:text-gray-400 mt-4">Memuat properti...</p>
                    </div>`;
            } else if (appState.filteredProperties.length > 0) {
                contentHTML += `<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${appState.filteredProperties.map(prop => createPropertyCard(prop)).join('')}
                </div>`;
            } else {
                contentHTML += `
                    <div class="text-center py-10 bg-card-light dark:bg-card-dark rounded-lg shadow">
                        <img src="https://picsum.photos/seed/noresult/300/200" alt="Tidak ada hasil" class="mx-auto mb-4 rounded"/>
                        <h2 class="text-2xl font-semibold text-gray-700 dark:text-gray-200 mb-2">Properti Tidak Ditemukan</h2>
                        <p class="text-gray-500 dark:text-gray-400">Coba sesuaikan filter pencarian Anda atau periksa kembali nanti.</p>
                    </div>`;
            }
            contentHTML += `</div>`;
            pageContentContainer.innerHTML = contentHTML;
            attachDynamicEventListeners(); // Penting untuk filter dan tombol kartu
        }

        function renderAdminCrudPage() {
            pageContentContainer.innerHTML = `
                <div class="space-y-8">
                    <header class="bg-card-light dark:bg-card-dark shadow rounded-lg p-6">
                        <h1 class="text-3xl font-bold font-display text-primary dark:text-primary-light">Kelola Daftar Properti</h1>
                        <p class="mt-2 text-gray-600 dark:text-gray-400">Tambah, edit, atau hapus daftar properti dari sistem.</p>
                    </header>
                    <div class="bg-card-light dark:bg-card-dark shadow rounded-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-200">Daftar Saat Ini</h2>
                            <button class="bg-primary hover:bg-primary-dark text-white font-bold py-2 px-4 rounded-lg transition-colors">
                                Tambah Properti Baru
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-800">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Nama</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Lokasi</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Harga</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                        <th scope="col" class="relative px-6 py-3"><span class="sr-only">Edit</span></th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-card-dark divide-y divide-gray-200 dark:divide-gray-700">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">Apartemen Sunny Meadows</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">Jl. Green Valley No. 123</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">Rp 18.000.000</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-700 dark:text-green-100">Tersedia</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                            <a href="#" class="text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-200">Edit</a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="5" class="px-6 py-10 text-center text-sm text-gray-500 dark:text-gray-400">
                                            Saat ini tidak ada daftar untuk ditampilkan. Klik "Tambah Properti Baru" untuk memulai.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="mt-8 text-center">
                        <img src="https://picsum.photos/seed/admin/800/250" alt="Panel kontrol admin" class="rounded-lg shadow-md mx-auto" />
                        <p class="mt-4 text-gray-600 dark:text-gray-400">Kelola portofolio properti Anda secara efisien.</p>
                    </div>
                </div>
            `;
        }

        // --- LOGIKA ROUTING ---
        function getCurrentPath() {
            return window.location.hash.slice(1) || '/';
        }

        function handleRouteChange() {
            appState.currentPage = getCurrentPath();
            renderCurrentPage();
            renderNavbar(); // Update active link in navbar
        }

        function renderCurrentPage() {
            pageContentContainer.innerHTML = ''; // Bersihkan konten lama
            appState.isLoading = true; // Setel loading sebelum operasi

            // Untuk UX yang lebih baik, tampilkan spinner jika render halaman membutuhkan waktu
            // pageContentContainer.innerHTML = `<div class="flex justify-center items-center h-64"><div class="spinner"></div><p class="ml-2">Memuat...</p></div>`;

            // Simulasi penundaan singkat untuk memungkinkan spinner dirender jika konten cepat
            // setTimeout(() => {
            switch (appState.currentPage) {
                case '/':
                    renderDashboardPage();
                    break;
                case '/properti':
                    renderPropertiesPage(); // Fungsi ini akan menangani status loading internalnya
                    break;
                case '/kelola':
                    renderAdminCrudPage();
                    break;
                default: // Halaman tidak ditemukan atau fallback ke dasbor
                    pageContentContainer.innerHTML = '<h1 class="text-2xl text-center py-10">404 - Halaman tidak ditemukan</h1>';
            }
            // appState.isLoading = false; // Diatur oleh renderPropertiesPage jika perlu
            attachDynamicEventListeners(); // Lampirkan listener untuk konten baru
            // }, 10); 
        }

        // --- PENANGAN EVENT DINAMIS ---
        function attachDynamicEventListeners() {
            const filterForm = document.getElementById('filter-form');
            if (filterForm) {
                filterForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    appState.filters.searchTerm = document.getElementById('searchTerm')?.value || '';
                    appState.filters.bedrooms = document.getElementById('bedrooms')?.value || 'semua';
                    appState.filters.propertyType = document.getElementById('propertyType')?.value || 'semua';
                    appState.filters.minPrice = document.getElementById('minPrice')?.value || '';
                    appState.filters.maxPrice = document.getElementById('maxPrice')?.value || '';
                    applyFiltersAndRenderProperties();
                });
            }

            document.querySelectorAll('.property-details-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const propertyId = e.currentTarget.dataset.propertyId;
                    alert(`Tombol "Lihat Detail" untuk properti ID: ${propertyId} diklik. Fitur ini dapat dikembangkan lebih lanjut.`);
                    // Contoh: window.location.hash = `#/properti/${propertyId}`;
                });
            });
        }

        function applyFiltersAndRenderProperties() {
            appState.isLoading = true;
            if (appState.currentPage === '/properti') renderPropertiesPage(); // Render ulang dengan spinner

            setTimeout(() => { // Simulasi panggilan API
                let tempProperties = [...MOCK_PROPERTIES_DATA];
                const { searchTerm, bedrooms, propertyType, minPrice, maxPrice } = appState.filters;

                if (searchTerm) {
                    const termLower = searchTerm.toLowerCase();
                    tempProperties = tempProperties.filter(p =>
                        p.nama.toLowerCase().includes(termLower) ||
                        p.lokasi.toLowerCase().includes(termLower)
                    );
                }
                if (bedrooms !== 'semua') {
                    tempProperties = tempProperties.filter(p => p.kamarTidur === parseInt(bedrooms));
                }
                if (propertyType !== 'semua') {
                    tempProperties = tempProperties.filter(p => p.tipe === propertyType);
                }

                const numMinPrice = Number(minPrice);
                if (minPrice !== '' && !isNaN(numMinPrice)) {
                    tempProperties = tempProperties.filter(p => p.harga >= numMinPrice);
                }
                const numMaxPrice = Number(maxPrice);
                if (maxPrice !== '' && !isNaN(numMaxPrice)) {
                    tempProperties = tempProperties.filter(p => p.harga <= numMaxPrice);
                }

                appState.filteredProperties = tempProperties;
                appState.isLoading = false;
                if (appState.currentPage === '/properti') renderPropertiesPage(); // Render ulang dengan data terfilter
            }, 500);
        }

        // --- INISIALISASI APLIKASI ---
        function init() {
            applyTheme(); // Terapkan tema awal
            renderNavbar();
            renderFooter();
            window.addEventListener('hashchange', handleRouteChange);
            handleRouteChange(); // Render halaman awal berdasarkan hash
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>