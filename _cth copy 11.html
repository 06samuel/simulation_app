<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ApartemenKita - Dashboard Sewa Apartemen</title>
    <meta name="description"
        content="Platform lengkap untuk manajemen dan pencarian sewa apartemen. Dashboard modern, notifikasi, dan listing properti.">
    <meta name="keywords" content="rental, apartemen, sewa, properti, dashboard, notifikasi, booking">
    <meta name="author" content="ApartemenKita DevTeam">

    <!-- Favicon (Menggunakan Favicon Google untuk menghindari SVG langsung, ganti dengan domain Anda jika sudah deploy) -->
    <link rel="icon" href="https://www.google.com/s2/favicons?domain=example.com&sz=32" type="image/png">

    <!-- Icon Bootstrap via CDN (Font Icons) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <!-- Font Awesome untuk beberapa ikon tambahan jika diperlukan (opsional) -->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"> -->


    <style>
        /* --- ROOT VARIABLES & GLOBAL STYLES --- */
        :root {
            --primary-color: #6366f1;
            /* Indigo */
            --primary-hover-color: #4f46e5;
            --primary-text-color: #ffffff;

            --secondary-color: #10b981;
            /* Emerald */
            --secondary-hover-color: #059669;
            --secondary-text-color: #ffffff;

            --accent-color: #f59e0b;
            /* Amber */
            --accent-hover-color: #d97706;
            --accent-text-color: #1f2937;
            /* Darker text for better contrast on Amber */

            --neutral-bg-color: #f8fafc;
            /* Slate 50 */
            --neutral-light-bg-color: #f1f5f9;
            /* Slate 100 */
            --neutral-text-color: #0f172a;
            /* Slate 900 */
            --neutral-subtle-text-color: #64748b;
            /* Slate 500 */
            --neutral-border-color: #e5e7eb;
            /* Gray 200 */

            --card-bg-color: #ffffff;
            --card-border-color: var(--neutral-border-color);
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.07), 0 2px 4px -2px rgba(0, 0, 0, 0.07);
            --card-hover-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);

            --success-color: #22c55e;
            /* Green 500 */
            --warning-color: #facc15;
            /* Yellow 400 */
            --danger-color: #ef4444;
            /* Red 500 */
            --info-color: #3b82f6;
            /* Blue 500 */

            --font-family-sans: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-size-base: 1rem;
            /* 16px */
            --font-size-sm: 0.875rem;
            /* 14px */
            --font-size-lg: 1.125rem;
            /* 18px */
            --font-size-xl: 1.25rem;
            /* 20px */
            --font-size-2xl: 1.5rem;
            /* 24px */
            --font-size-3xl: 1.875rem;
            /* 30px */

            --line-height-base: 1.6;
            --border-radius-sm: 0.25rem;
            --border-radius-md: 0.5rem;
            --border-radius-lg: 0.75rem;

            --spacing-xs: 0.25rem;
            /* 4px */
            --spacing-sm: 0.5rem;
            /* 8px */
            --spacing-md: 1rem;
            /* 16px */
            --spacing-lg: 1.5rem;
            /* 24px */
            --spacing-xl: 2rem;
            /* 32px */
            --spacing-2xl: 3rem;
            /* 48px */

            --sidebar-width: 260px;
            --sidebar-width-collapsed: 80px;
            --header-height: 70px;

            --transition-duration: 0.2s;
            --transition-timing: ease-in-out;
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: var(--font-size-base);
            line-height: var(--line-height-base);
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-family-sans);
            background-color: var(--neutral-bg-color);
            color: var(--neutral-text-color);
            min-height: 100vh;
            display: flex;
            overflow-x: hidden;
            /* Mencegah scroll horizontal karena transisi sidebar */
        }

        /* --- UTILITIES --- */
        .container-fluid {
            width: 100%;
            padding-left: var(--spacing-md);
            padding-right: var(--spacing-md);
        }

        .container {
            width: 100%;
            max-width: 1280px;
            /* Lebih lebar untuk dashboard */
            margin-left: auto;
            margin-right: auto;
            padding-left: var(--spacing-md);
            padding-right: var(--spacing-md);
        }

        .d-flex {
            display: flex;
        }

        .flex-column {
            flex-direction: column;
        }

        .flex-row {
            flex-direction: row;
        }

        .justify-content-start {
            justify-content: flex-start;
        }

        .justify-content-center {
            justify-content: center;
        }

        .justify-content-end {
            justify-content: flex-end;
        }

        .justify-content-between {
            justify-content: space-between;
        }

        .align-items-start {
            align-items: flex-start;
        }

        .align-items-center {
            align-items: center;
        }

        .align-items-end {
            align-items: flex-end;
        }

        .align-items-stretch {
            align-items: stretch;
        }

        .flex-grow-1 {
            flex-grow: 1;
        }

        .flex-wrap {
            flex-wrap: wrap;
        }

        .text-center {
            text-align: center;
        }

        .text-left {
            text-align: left;
        }

        .text-right {
            text-align: right;
        }

        .m-0 {
            margin: 0;
        }

        .mt-auto {
            margin-top: auto;
        }

        .mb-1 {
            margin-bottom: var(--spacing-sm);
        }

        .mb-2 {
            margin-bottom: var(--spacing-md);
        }

        .mb-3 {
            margin-bottom: var(--spacing-lg);
        }

        .mt-1 {
            margin-top: var(--spacing-sm);
        }

        .mt-2 {
            margin-top: var(--spacing-md);
        }

        .ml-1 {
            margin-left: var(--spacing-sm);
        }

        .mr-1 {
            margin-right: var(--spacing-sm);
        }

        .p-1 {
            padding: var(--spacing-sm);
        }

        .p-2 {
            padding: var(--spacing-md);
        }

        .p-3 {
            padding: var(--spacing-lg);
        }

        .fw-bold {
            font-weight: 600;
        }

        .fw-semibold {
            font-weight: 500;
        }

        .text-muted {
            color: var(--neutral-subtle-text-color);
        }

        .text-primary {
            color: var(--primary-color);
        }

        .text-success {
            color: var(--success-color);
        }

        .text-danger {
            color: var(--danger-color);
        }

        .text-warning {
            color: var(--warning-color);
        }

        .rounded-sm {
            border-radius: var(--border-radius-sm);
        }

        .rounded-md {
            border-radius: var(--border-radius-md);
        }

        .rounded-lg {
            border-radius: var(--border-radius-lg);
        }

        .rounded-circle {
            border-radius: 50%;
        }

        .shadow-sm {
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        .shadow-md {
            box-shadow: var(--card-shadow);
        }

        .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .w-100 {
            width: 100%;
        }

        .h-100 {
            height: 100%;
        }

        .clickable {
            cursor: pointer;
        }

        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* --- BUTTONS --- */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: var(--font-size-base);
            font-weight: 500;
            line-height: 1.5;
            text-align: center;
            text-decoration: none;
            white-space: nowrap;
            vertical-align: middle;
            cursor: pointer;
            user-select: none;
            border: 1px solid transparent;
            border-radius: var(--border-radius-md);
            transition: color var(--transition-duration) var(--transition-timing),
                background-color var(--transition-duration) var(--transition-timing),
                border-color var(--transition-duration) var(--transition-timing),
                box-shadow var(--transition-duration) var(--transition-timing);
        }

        .btn:hover {
            text-decoration: none;
        }

        .btn:focus-visible {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        .btn-primary {
            color: var(--primary-text-color);
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: var(--primary-hover-color);
            border-color: var(--primary-hover-color);
        }

        .btn-secondary {
            color: var(--secondary-text-color);
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .btn-secondary:hover {
            background-color: var(--secondary-hover-color);
            border-color: var(--secondary-hover-color);
        }

        .btn-accent {
            color: var(--accent-text-color);
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }

        .btn-accent:hover {
            background-color: var(--accent-hover-color);
            border-color: var(--accent-hover-color);
        }

        .btn-outline-danger {
            color: var(--danger-color);
            border-color: var(--danger-color);
            background-color: transparent;
        }

        .btn-outline-danger:hover {
            color: var(--primary-text-color);
            background-color: var(--danger-color);
        }

        .btn-light {
            color: var(--neutral-text-color);
            background-color: var(--neutral-light-bg-color);
            border-color: var(--neutral-border-color);
        }

        .btn-light:hover {
            background-color: #e2e8f0;
        }

        /* Slate 200 */
        .btn-sm {
            padding: var(--spacing-xs) var(--spacing-sm);
            font-size: var(--font-size-sm);
        }

        .btn-lg {
            padding: var(--spacing-md) var(--spacing-lg);
            font-size: var(--font-size-lg);
        }

        .btn-icon {
            padding: var(--spacing-xs);
            width: 2.5rem;
            height: 2.5rem;
            font-size: 1.2rem;
        }

        .btn-icon.btn-sm {
            width: 2rem;
            height: 2rem;
            font-size: 1rem;
        }

        .btn i {
            margin-right: var(--spacing-sm);
        }

        .btn.btn-icon i {
            margin-right: 0;
        }


        /* --- BADGES --- */
        .badge {
            display: inline-block;
            padding: 0.35em 0.65em;
            font-size: 0.75em;
            font-weight: 700;
            line-height: 1;
            color: var(--primary-text-color);
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: var(--border-radius-sm);
        }

        .badge-primary {
            background-color: var(--primary-color);
        }

        .badge-secondary {
            background-color: var(--secondary-color);
        }

        .badge-accent {
            background-color: var(--accent-color);
            color: var(--accent-text-color);
        }

        .badge-success {
            background-color: var(--success-color);
        }

        .badge-warning {
            background-color: var(--warning-color);
            color: var(--neutral-text-color);
        }

        .badge-danger {
            background-color: var(--danger-color);
        }

        .badge-info {
            background-color: var(--info-color);
        }

        /* --- FORM ELEMENTS --- */
        .form-control {
            display: block;
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: var(--font-size-base);
            font-weight: 400;
            line-height: 1.5;
            color: var(--neutral-text-color);
            background-color: var(--card-bg-color);
            background-clip: padding-box;
            border: 1px solid var(--neutral-border-color);
            appearance: none;
            border-radius: var(--border-radius-md);
            transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            outline: 0;
            box-shadow: 0 0 0 0.25rem rgba(var(--primary-color-rgb, 99, 102, 241), 0.25);
            /* Perlu var(--primary-color-rgb) */
        }

        .form-label {
            margin-bottom: var(--spacing-xs);
            font-weight: 500;
        }

        /* --- CARD --- */
        .card {
            background-color: var(--card-bg-color);
            border: 1px solid var(--card-border-color);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--card-shadow);
            margin-bottom: var(--spacing-lg);
            overflow: hidden;
            /* Untuk card image */
        }

        .card-header {
            padding: var(--spacing-md);
            background-color: var(--neutral-light-bg-color);
            border-bottom: 1px solid var(--card-border-color);
            font-size: var(--font-size-lg);
            font-weight: 600;
        }

        .card-header+.card-body {
            padding-top: var(--spacing-md);
        }

        .card-body {
            padding: var(--spacing-md);
        }

        .card-footer {
            padding: var(--spacing-md);
            background-color: var(--neutral-light-bg-color);
            border-top: 1px solid var(--card-border-color);
        }

        .card-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }

        .card-subtitle {
            font-size: var(--font-size-base);
            color: var(--neutral-subtle-text-color);
            margin-bottom: var(--spacing-md);
        }

        .card-img-top {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 1px solid var(--card-border-color);
        }

        .card-hover-effect {
            transition: transform var(--transition-duration) var(--transition-timing),
                box-shadow var(--transition-duration) var(--transition-timing);
        }

        .card-hover-effect:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow);
        }


        /* --- GRID SYSTEM (Sederhana) --- */
        .row {
            display: flex;
            flex-wrap: wrap;
            margin-left: calc(-1 * var(--spacing-md) / 2);
            margin-right: calc(-1 * var(--spacing-md) / 2);
        }

        .col,
        .col-1,
        .col-2,
        .col-3,
        .col-4,
        .col-5,
        .col-6,
        .col-7,
        .col-8,
        .col-9,
        .col-10,
        .col-11,
        .col-12,
        .col-sm-1,
        .col-sm-2,
        .col-sm-3,
        .col-sm-4,
        .col-sm-5,
        .col-sm-6,
        .col-sm-7,
        .col-sm-8,
        .col-sm-9,
        .col-sm-10,
        .col-sm-11,
        .col-sm-12,
        .col-md-1,
        .col-md-2,
        .col-md-3,
        .col-md-4,
        .col-md-5,
        .col-md-6,
        .col-md-7,
        .col-md-8,
        .col-md-9,
        .col-md-10,
        .col-md-11,
        .col-md-12,
        .col-lg-1,
        .col-lg-2,
        .col-lg-3,
        .col-lg-4,
        .col-lg-5,
        .col-lg-6,
        .col-lg-7,
        .col-lg-8,
        .col-lg-9,
        .col-lg-10,
        .col-lg-11,
        .col-lg-12,
        .col-xl-1,
        .col-xl-2,
        .col-xl-3,
        .col-xl-4,
        .col-xl-5,
        .col-xl-6,
        .col-xl-7,
        .col-xl-8,
        .col-xl-9,
        .col-xl-10,
        .col-xl-11,
        .col-xl-12 {
            position: relative;
            width: 100%;
            padding-left: calc(var(--spacing-md) / 2);
            padding-right: calc(var(--spacing-md) / 2);
            margin-bottom: var(--spacing-md);
            /* Gutter bottom */
        }

        .col {
            flex-basis: 0;
            flex-grow: 1;
            max-width: 100%;
        }

        .col-auto {
            flex: 0 0 auto;
            width: auto;
            max-width: 100%;
        }

        .col-1 {
            flex: 0 0 8.333333%;
            max-width: 8.333333%;
        }

        .col-2 {
            flex: 0 0 16.666667%;
            max-width: 16.666667%;
        }

        .col-3 {
            flex: 0 0 25%;
            max-width: 25%;
        }

        .col-4 {
            flex: 0 0 33.333333%;
            max-width: 33.333333%;
        }

        .col-5 {
            flex: 0 0 41.666667%;
            max-width: 41.666667%;
        }

        .col-6 {
            flex: 0 0 50%;
            max-width: 50%;
        }

        /* ... dan seterusnya untuk 12 kolom ... */
        .col-12 {
            flex: 0 0 100%;
            max-width: 100%;
        }


        @media (min-width: 576px) {

            /* sm */
            .col-sm-3 {
                flex: 0 0 25%;
                max-width: 25%;
            }

            .col-sm-4 {
                flex: 0 0 33.333333%;
                max-width: 33.333333%;
            }

            .col-sm-6 {
                flex: 0 0 50%;
                max-width: 50%;
            }

            .col-sm-12 {
                flex: 0 0 100%;
                max-width: 100%;
            }
        }

        @media (min-width: 768px) {

            /* md */
            .col-md-3 {
                flex: 0 0 25%;
                max-width: 25%;
            }

            .col-md-4 {
                flex: 0 0 33.333333%;
                max-width: 33.333333%;
            }

            .col-md-6 {
                flex: 0 0 50%;
                max-width: 50%;
            }

            .col-md-8 {
                flex: 0 0 66.666667%;
                max-width: 66.666667%;
            }

            .col-md-12 {
                flex: 0 0 100%;
                max-width: 100%;
            }
        }

        @media (min-width: 992px) {

            /* lg */
            .col-lg-3 {
                flex: 0 0 25%;
                max-width: 25%;
            }

            .col-lg-4 {
                flex: 0 0 33.333333%;
                max-width: 33.333333%;
            }

            .col-lg-6 {
                flex: 0 0 50%;
                max-width: 50%;
            }

            .col-lg-12 {
                flex: 0 0 100%;
                max-width: 100%;
            }
        }

        @media (min-width: 1200px) {

            /* xl */
            .col-xl-3 {
                flex: 0 0 25%;
                max-width: 25%;
            }

            .col-xl-4 {
                flex: 0 0 33.333333%;
                max-width: 33.333333%;
            }

            /* ... etc ... */
        }


        /* --- LAYOUT UTAMA APLIKASI --- */
        #app-shell {
            display: flex;
            width: 100vw;
            height: 100vh;
        }

        /* SIDEBAR */
        .app-sidebar {
            width: var(--sidebar-width);
            background-color: var(--neutral-text-color);
            /* Dark sidebar */
            color: var(--neutral-bg-color);
            padding: var(--spacing-md);
            display: flex;
            flex-direction: column;
            transition: width var(--transition-duration) var(--transition-timing);
            height: 100vh;
            position: fixed;
            /* Fixed sidebar */
            top: 0;
            left: 0;
            z-index: 1000;
            overflow-y: auto;
        }

        .app-sidebar.collapsed {
            width: var(--sidebar-width-collapsed);
        }

        .app-sidebar.collapsed .sidebar-logo-text,
        .app-sidebar.collapsed .nav-link-text,
        .app-sidebar.collapsed .user-profile-name,
        .app-sidebar.collapsed .user-profile-email {
            display: none;
        }

        .app-sidebar.collapsed .nav-link i {
            font-size: 1.5rem;
            /* Icon lebih besar saat collapsed */
            margin-right: 0;
        }

        .app-sidebar.collapsed .nav-link {
            justify-content: center;
        }

        .app-sidebar.collapsed .sidebar-user-profile {
            padding: var(--spacing-md) 0;
        }

        .app-sidebar.collapsed .user-avatar {
            width: 40px;
            height: 40px;
            margin-bottom: 0;
        }


        .sidebar-header {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-sm) 0;
            /* Sedikit padding atas bawah */
            border-bottom: 1px solid var(--neutral-subtle-text-color);
        }

        .sidebar-logo-icon {
            font-size: var(--font-size-2xl);
            color: var(--primary-color);
            margin-right: var(--spacing-sm);
            transition: margin var(--transition-duration) var(--transition-timing);
        }

        .sidebar-logo-text {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--primary-text-color);
            white-space: nowrap;
        }

        .sidebar-user-profile {
            text-align: center;
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--neutral-subtle-text-color);
        }

        .user-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto var(--spacing-sm) auto;
            border: 2px solid var(--primary-color);
        }

        .user-profile-name {
            font-weight: 600;
            font-size: var(--font-size-lg);
            color: var(--primary-text-color);
            white-space: nowrap;
        }

        .user-profile-email {
            font-size: var(--font-size-sm);
            color: var(--neutral-subtle-text-color);
            white-space: nowrap;
        }


        .app-nav {
            list-style: none;
            padding: 0;
            margin: 0;
            flex-grow: 1;
        }

        .nav-item {
            margin-bottom: var(--spacing-xs);
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: var(--spacing-sm) var(--spacing-md);
            color: var(--neutral-light-bg-color);
            text-decoration: none;
            border-radius: var(--border-radius-md);
            transition: background-color var(--transition-duration) var(--transition-timing), color var(--transition-duration) var(--transition-timing);
            white-space: nowrap;
        }

        .nav-link i {
            margin-right: var(--spacing-md);
            font-size: var(--font-size-lg);
            width: 24px;
            /* Jaga alignment ikon */
            text-align: center;
        }

        .nav-link:hover,
        .nav-link.active {
            background-color: var(--primary-color);
            color: var(--primary-text-color);
        }

        .nav-link.active i {
            color: var(--primary-text-color);
        }

        .sidebar-footer {
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--neutral-subtle-text-color);
        }


        /* MAIN CONTENT AREA */
        .app-main-wrapper {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            margin-left: var(--sidebar-width);
            /* Sesuaikan dengan lebar sidebar */
            transition: margin-left var(--transition-duration) var(--transition-timing);
        }

        .app-main-wrapper.sidebar-collapsed {
            margin-left: var(--sidebar-width-collapsed);
        }

        .app-header {
            height: var(--header-height);
            background-color: var(--card-bg-color);
            padding: 0 var(--spacing-lg);
            box-shadow: var(--card-shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            /* Atau fixed jika ingin header selalu terlihat saat scroll konten utama */
            top: 0;
            z-index: 900;
            /* Di bawah sidebar */
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .sidebar-toggle-btn {
            font-size: 1.5rem;
            color: var(--neutral-text-color);
            margin-right: var(--spacing-md);
        }

        .page-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
        }

        .header-right {
            display: flex;
            align-items: center;
        }

        .header-action-btn {
            color: var(--neutral-subtle-text-color);
            font-size: 1.3rem;
            margin-left: var(--spacing-md);
        }

        .header-action-btn:hover {
            color: var(--primary-color);
        }


        .app-main-content {
            flex-grow: 1;
            padding: var(--spacing-lg);
            overflow-y: auto;
            /* Konten utama bisa di-scroll */
        }

        /* --- DASHBOARD SPECIFIC STYLES --- */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-2xl);
        }

        .stat-card {
            background-color: var(--card-bg-color);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--card-shadow);
            display: flex;
            align-items: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow);
        }

        .stat-card-icon {
            font-size: 2.5rem;
            padding: var(--spacing-md);
            border-radius: 50%;
            margin-right: var(--spacing-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
        }

        .stat-card-icon.bg-primary {
            background-color: rgba(var(--primary-color-rgb, 99, 102, 241), 0.1);
            color: var(--primary-color);
        }

        .stat-card-icon.bg-success {
            background-color: rgba(var(--success-color-rgb, 34, 197, 94), 0.1);
            color: var(--success-color);
        }

        .stat-card-icon.bg-warning {
            background-color: rgba(var(--warning-color-rgb, 250, 204, 21), 0.1);
            color: var(--warning-color);
        }

        .stat-card-icon.bg-danger {
            background-color: rgba(var(--danger-color-rgb, 239, 68, 68), 0.1);
            color: var(--danger-color);
        }

        .stat-card-info h3 {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin: 0 0 var(--spacing-xs) 0;
        }

        .stat-card-info p {
            font-size: var(--font-size-sm);
            color: var(--neutral-subtle-text-color);
            margin: 0;
        }

        /* --- APARTMENT LISTING STYLES --- */
        .apartment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-lg);
        }

        .apartment-card {
            /* Menggunakan .card umum, tambahkan spesifik jika perlu */
        }

        .apartment-card .card-body {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .apartment-card .apartment-price {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: var(--spacing-sm);
        }

        .apartment-features {
            display: flex;
            justify-content: space-around;
            margin-bottom: var(--spacing-md);
            font-size: var(--font-size-sm);
            color: var(--neutral-subtle-text-color);
        }

        .apartment-features span {
            display: inline-flex;
            align-items: center;
        }

        .apartment-features i {
            margin-right: var(--spacing-xs);
        }

        .apartment-card .btn-favorite {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            color: var(--neutral-subtle-text-color);
        }

        .apartment-card .btn-favorite.favorited {
            color: var(--danger-color);
            background-color: rgba(239, 68, 68, 0.1);
        }


        /* --- NOTIFICATION SECTION (adaptasi dari kode asli) --- */
        .notifications-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            gap: var(--spacing-md);
        }

        .filter-buttons button {
            margin-left: var(--spacing-sm);
        }

        .filter-buttons button.active {
            background-color: var(--primary-hover-color);
            border-color: var(--primary-hover-color);
        }

        .notification-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            /* Sedikit lebih lebar */
            gap: var(--spacing-lg);
        }

        .notification-card {
            background-color: var(--card-bg-color);
            border: 1px solid var(--card-border-color);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--card-shadow);
            padding: var(--spacing-md);
            display: flex;
            flex-direction: column;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInCard 0.5s forwards;
        }

        @keyframes fadeInCard {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .notification-card.is-read {
            opacity: 0.7;
            background-color: #f9fafb;
        }

        .notification-card.is-read .notification-title {
            color: var(--neutral-subtle-text-color);
        }

        .notification-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--card-hover-shadow);
        }

        .notification-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-sm);
        }

        .notification-type-icon {
            font-size: var(--font-size-xl);
            margin-right: var(--spacing-sm);
            color: var(--primary-color);
        }

        .notification-type-icon.type-booking {
            color: var(--primary-color);
        }

        .notification-type-icon.type-payment {
            color: var(--success-color);
        }

        .notification-type-icon.type-maintenance {
            color: var(--accent-color);
        }

        .notification-type-icon.type-info {
            color: var(--info-color);
        }

        .notification-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            flex-grow: 1;
        }

        .notification-actions button {
            margin-left: var(--spacing-xs);
            color: var(--neutral-subtle-text-color);
            background: transparent;
            border: none;
        }

        .notification-actions button:hover {
            color: var(--primary-color);
        }

        .notification-body {
            font-size: var(--font-size-base);
            margin-bottom: var(--spacing-md);
            flex-grow: 1;
        }

        .notification-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, margin-top 0.3s ease-out;
            font-size: var(--font-size-sm);
            color: var(--neutral-subtle-text-color);
        }

        .notification-content.expanded {
            max-height: 200px;
            margin-top: var(--spacing-sm);
        }

        .notification-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: var(--font-size-sm);
            color: var(--neutral-subtle-text-color);
            border-top: 1px solid var(--card-border-color);
            padding-top: var(--spacing-sm);
            margin-top: auto;
        }

        .no-notifications {
            text-align: center;
            padding: var(--spacing-2xl);
            color: var(--neutral-subtle-text-color);
            border: 2px dashed var(--card-border-color);
            border-radius: var(--border-radius-lg);
        }

        .no-notifications i {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
            display: block;
        }

        /* PROFILE PAGE */
        .profile-card {
            max-width: 600px;
            margin: 0 auto;
        }

        .profile-avatar-lg {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto var(--spacing-lg) auto;
            border: 3px solid var(--primary-color);
            display: block;
        }

        .profile-details dt {
            font-weight: 600;
            color: var(--neutral-text-color);
        }

        .profile-details dd {
            color: var(--neutral-subtle-text-color);
            margin-bottom: var(--spacing-sm);
        }

        /* Placeholder for other pages */
        .placeholder-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 60vh;
            /* Fill most of the content area */
            text-align: center;
            color: var(--neutral-subtle-text-color);
        }

        .placeholder-page i {
            font-size: 4rem;
            margin-bottom: var(--spacing-lg);
            color: var(--neutral-border-color);
        }

        .placeholder-page h2 {
            font-size: var(--font-size-2xl);
            margin-bottom: var(--spacing-sm);
            color: var(--neutral-text-color);
        }

        /* FOOTER (bisa disembunyikan jika konten penuh) */
        .app-footer {
            background-color: var(--neutral-light-bg-color);
            color: var(--neutral-subtle-text-color);
            padding: var(--spacing-md) 0;
            text-align: center;
            font-size: var(--font-size-sm);
            border-top: 1px solid var(--neutral-border-color);
        }


        /* --- RESPONSIVE DESIGN --- */
        @media (max-width: 992px) {

            /* Medium devices (tablets, less than 992px) */
            .app-sidebar {
                width: var(--sidebar-width-collapsed);
                /* Default collapsed on smaller screens */
            }

            .app-sidebar:not(.manual-open) .sidebar-logo-text,
            .app-sidebar:not(.manual-open) .nav-link-text,
            .app-sidebar:not(.manual-open) .user-profile-name,
            .app-sidebar:not(.manual-open) .user-profile-email {
                display: none;
            }

            .app-sidebar:not(.manual-open) .nav-link i {
                font-size: 1.5rem;
                margin-right: 0;
            }

            .app-sidebar:not(.manual-open) .nav-link {
                justify-content: center;
            }

            .app-sidebar:not(.manual-open) .sidebar-user-profile {
                padding: var(--spacing-md) 0;
            }

            .app-sidebar:not(.manual-open) .user-avatar {
                width: 40px;
                height: 40px;
                margin-bottom: 0;
            }

            .app-main-wrapper {
                margin-left: var(--sidebar-width-collapsed);
            }

            .app-sidebar.manual-open {
                /* When manually opened on small screens */
                width: var(--sidebar-width);
                box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            }

            .app-sidebar.manual-open .sidebar-logo-text,
            .app-sidebar.manual-open .nav-link-text,
            .app-sidebar.manual-open .user-profile-name,
            .app-sidebar.manual-open .user-profile-email {
                display: block;
                /* Or inline / inline-block as appropriate */
            }

            .app-sidebar.manual-open .nav-link i {
                font-size: var(--font-size-lg);
                margin-right: var(--spacing-md);
            }

            .app-sidebar.manual-open .nav-link {
                justify-content: flex-start;
            }

            .app-sidebar.manual-open .sidebar-user-profile {
                padding: var(--spacing-md);
            }

            .app-sidebar.manual-open .user-avatar {
                width: 70px;
                height: 70px;
                margin-bottom: var(--spacing-sm);
            }


            .page-title {
                font-size: var(--font-size-lg);
            }
        }

        @media (max-width: 768px) {
            :root {
                --font-size-base: 0.9375rem;
                /* 15px */
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            /* Stack stat cards */
            .notifications-header {
                flex-direction: column;
                align-items: stretch;
            }

            .notifications-title {
                text-align: center;
                margin-bottom: var(--spacing-md);
            }

            .filter-buttons {
                display: flex;
                justify-content: center;
                flex-wrap: wrap;
                gap: var(--spacing-xs);
            }

            .filter-buttons button {
                margin-left: 0;
                flex-grow: 1;
            }

            .apartment-grid {
                grid-template-columns: 1fr;
            }

            .app-header {
                padding: 0 var(--spacing-md);
            }
        }

        @media (max-width: 480px) {
            .notification-grid {
                grid-template-columns: 1fr;
            }

            .btn {
                padding: var(--spacing-sm) var(--spacing-sm);
            }

            .app-main-content {
                padding: var(--spacing-md);
            }

            :root {
                --sidebar-width: 220px;
                /* Slightly narrower sidebar for small screens when open */
            }
        }
    </style>
</head>

<body>

    <div id="app-shell">
        <!-- Semantic Sidebar -->
        <aside class="app-sidebar" id="appSidebar" role="navigation" aria-label="Navigasi Utama">
            <div class="sidebar-header">
                <i class="bi bi-buildings-fill sidebar-logo-icon"></i>
                <span class="sidebar-logo-text">ApartemenKita</span>
            </div>

            <div class="sidebar-user-profile">
                <img src="https://i.pravatar.cc/150?u=pengguna1" alt="Foto Profil Pengguna" class="user-avatar"
                    id="userProfileAvatar">
                <h3 class="user-profile-name" id="userProfileName">Nama Pengguna</h3>
                <p class="user-profile-email" id="userProfileEmail">email@pengguna.com</p>
            </div>

            <ul class="app-nav">
                <li class="nav-item">
                    <a href="#dashboard" class="nav-link active" data-page="dashboard" aria-current="page">
                        <i class="bi bi-grid-1x2-fill"></i> <span class="nav-link-text">Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#profile" class="nav-link" data-page="profile">
                        <i class="bi bi-person-circle"></i> <span class="nav-link-text">Profil</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#apartments" class="nav-link" data-page="apartments">
                        <i class="bi bi-building"></i> <span class="nav-link-text">Apartemen</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#bookings" class="nav-link" data-page="bookings">
                        <i class="bi bi-calendar-check-fill"></i> <span class="nav-link-text">Booking</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#favorites" class="nav-link" data-page="favorites">
                        <i class="bi bi-heart-fill"></i> <span class="nav-link-text">Favorit</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#payments" class="nav-link" data-page="payments">
                        <i class="bi bi-credit-card-fill"></i> <span class="nav-link-text">Pembayaran</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#maintenance" class="nav-link" data-page="maintenance">
                        <i class="bi bi-tools"></i> <span class="nav-link-text">Maintenance</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#notifications" class="nav-link" data-page="notifications">
                        <i class="bi bi-bell-fill"></i> <span class="nav-link-text">Notifikasi</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#messages" class="nav-link" data-page="messages">
                        <i class="bi bi-chat-left-text-fill"></i> <span class="nav-link-text">Pesan</span>
                    </a>
                </li>
            </ul>

            <div class="sidebar-footer mt-auto">
                <a href="#settings" class="nav-link" data-page="settings">
                    <i class="bi bi-gear-fill"></i> <span class="nav-link-text">Pengaturan</span>
                </a>
                <a href="#logout" class="nav-link" id="logoutButton">
                    <i class="bi bi-box-arrow-right"></i> <span class="nav-link-text">Keluar</span>
                </a>
            </div>
        </aside>

        <!-- Wrapper untuk Header dan Konten Utama -->
        <div class="app-main-wrapper" id="appMainWrapper">
            <!-- Semantic Header Aplikasi -->
            <header class="app-header" role="banner">
                <div class="header-left">
                    <button class="btn btn-icon btn-light sidebar-toggle-btn" id="sidebarToggleBtn"
                        aria-label="Toggle Sidebar" aria-expanded="false">
                        <i class="bi bi-list"></i>
                    </button>
                    <h1 class="page-title" id="currentPageTitle">Dashboard</h1>
                </div>
                <div class="header-right">
                    <button id="addSampleNotificationBtnHeader" class="btn btn-secondary btn-sm"
                        title="Tambah Notifikasi Contoh">
                        <i class="bi bi-plus-circle-fill"></i> <span class="d-none d-md-inline">Tambah Contoh</span>
                    </button>
                    <a href="#notifications" class="header-action-btn" aria-label="Lihat Notifikasi"
                        data-page="notifications">
                        <i class="bi bi-bell"></i>
                    </a>
                    <a href="#profile" class="header-action-btn" aria-label="Profil Pengguna" data-page="profile">
                        <i class="bi bi-person-circle"></i>
                    </a>
                </div>
            </header>

            <!-- Semantic Main Content Area (Konten akan dirender di sini) -->
            <main id="app-root" class="app-main-content" role="main">
                <!-- Konten dinamis akan dimuat di sini -->
            </main>

            <!-- Semantic Footer (Opsional, bisa di dalam app-main-content jika per halaman) -->
            <footer class="app-footer" role="contentinfo">
                <div class="container-fluid">
                    <p>© <span id="currentYear"></span> ApartemenKita. Semua hak cipta dilindungi.</p>
                    <p>Dirancang dengan <i class="bi bi-heart-fill" style="color: var(--danger-color);"></i> untuk
                        kemudahan Anda.</p>
                </div>
            </footer>
        </div>
    </div>


    <!-- TEMPLATES UNTUK KONTEN DINAMIS -->

    <!-- Template Halaman Dashboard -->
    <template id="template-dashboard">
        <section id="dashboard-section" aria-labelledby="dashboard-title">
            <h2 id="dashboard-title" class="visually-hidden">Ringkasan Dashboard</h2>
            <div class="stats-grid" id="dashboardStatsGrid">
                <!-- Kartu statistik akan dirender di sini -->
            </div>
            <div class="row">
                <div class="col-md-7">
                    <div class="card">
                        <div class="card-header">Apartemen Terbaru</div>
                        <div class="card-body" id="dashboardRecentApartments">
                            <p>Memuat apartemen terbaru...</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="card">
                        <div class="card-header">Notifikasi Penting</div>
                        <div class="card-body" id="dashboardImportantNotifications">
                            <p>Memuat notifikasi...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </template>
    <template id="template-stat-card">
        <div class="stat-card">
            <div class="stat-card-icon">
                <i class="bi"></i> <!-- Icon diisi JS -->
            </div>
            <div class="stat-card-info">
                <h3 data-stat="value">0</h3>
                <p data-stat="label">Label Statistik</p>
            </div>
        </div>
    </template>

    <!-- Template Halaman Profil -->
    <template id="template-profile">
        <section id="profile-section" aria-labelledby="profile-title-main" class="container">
            <h2 id="profile-title-main" class="visually-hidden">Profil Pengguna</h2>
            <div class="card profile-card">
                <div class="card-body text-center">
                    <img src="" alt="Foto Profil Pengguna" class="profile-avatar-lg" id="profilePageAvatar">
                    <h3 class="card-title" id="profilePageName"></h3>
                    <p class="text-muted" id="profilePageEmail"></p>
                </div>
                <div class="card-body">
                    <h4>Detail Pengguna:</h4>
                    <dl class="row profile-details">
                        <dt class="col-sm-4">Nama Lengkap</dt>
                        <dd class="col-sm-8" id="profileDetailFullName">Nama Pengguna Lengkap</dd>

                        <dt class="col-sm-4">Nomor Telepon</dt>
                        <dd class="col-sm-8" id="profileDetailPhone">(021) 123-4567</dd>

                        <dt class="col-sm-4">Alamat</dt>
                        <dd class="col-sm-8" id="profileDetailAddress">Jl. Apartemen Indah No. 1, Jakarta</dd>

                        <dt class="col-sm-4">Tanggal Bergabung</dt>
                        <dd class="col-sm-8" id="profileDetailJoinDate">01 Januari 2023</dd>
                    </dl>
                    <button class="btn btn-primary w-100 mt-2">Edit Profil</button>
                </div>
            </div>
        </section>
    </template>

    <!-- Template Halaman Apartemen -->
    <template id="template-apartments">
        <section id="apartments-section" aria-labelledby="apartments-title">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 id="apartments-title" class="page-section-title">Daftar Apartemen</h2>
                <div class="d-flex">
                    <input type="search" id="apartmentSearchInput" class="form-control form-control-sm mr-1"
                        placeholder="Cari apartemen...">
                    <button class="btn btn-primary btn-sm" id="addApartmentBtn"><i class="bi bi-plus-lg"></i>
                        Tambah</button>
                </div>
            </div>
            <div class="apartment-grid" id="apartmentListContainer">
                <!-- Kartu apartemen dirender di sini -->
            </div>
            <div id="no-apartments-message" class="no-notifications" style="display: none;">
                <i class="bi bi-search"></i>
                <p>Tidak ada apartemen yang cocok dengan pencarian Anda atau belum ada apartemen.</p>
            </div>
        </section>
    </template>
    <template id="template-apartment-card">
        <article class="card apartment-card card-hover-effect" role="listitem">
            <img src="https://via.placeholder.com/300x200.png?text=Apartemen" alt="Gambar Apartemen"
                class="card-img-top">
            <button class="btn btn-icon btn-light btn-favorite" aria-label="Tambahkan ke favorit">
                <i class="bi bi-heart"></i>
            </button>
            <div class="card-body">
                <h3 class="card-title apartment-name">Nama Apartemen Indah</h3>
                <p class="apartment-price">Rp 5.000.000 / bulan</p>
                <div class="apartment-features text-muted">
                    <span><i class="bi bi-door-open"></i> <span class="feature-beds">2</span> KT</span>
                    <span><i class="bi bi-droplet"></i> <span class="feature-baths">1</span> KM</span>
                    <span><i class="bi bi-rulers"></i> <span class="feature-area">75</span> m²</span>
                </div>
                <p class="apartment-summary text-muted mb-2">Deskripsi singkat tentang apartemen yang menarik ini.</p>
                <button class="btn btn-primary btn-sm mt-auto view-details-btn">Lihat Detail</button>
            </div>
        </article>
    </template>

    <!-- Template Halaman Notifikasi (menggunakan yang lama sebagai dasar) -->
    <template id="template-notifications">
        <section id="notifications-section" aria-labelledby="notifications-page-title">
            <div class="notifications-header">
                <h2 id="notifications-page-title" class="page-section-title">Notifikasi Terbaru</h2>
                <div class="filter-buttons" role="group" aria-label="Filter notifikasi">
                    <button type="button" class="btn btn-primary btn-sm active" data-filter="all">Semua</button>
                    <button type="button" class="btn btn-primary btn-sm" data-filter="booking">Booking</button>
                    <button type="button" class="btn btn-primary btn-sm" data-filter="payment">Pembayaran</button>
                    <button type="button" class="btn btn-primary btn-sm" data-filter="maintenance">Perawatan</button>
                    <button type="button" class="btn btn-primary btn-sm" data-filter="unread">Belum Dibaca</button>
                </div>
            </div>
            <div id="notification-list" class="notification-grid">
                <!-- Kartu notifikasi akan dirender di sini oleh JavaScript -->
            </div>
            <div id="no-notifications-message" class="no-notifications" style="display: none;">
                <i class="bi bi-bell-slash"></i>
                <p>Tidak ada notifikasi saat ini.</p>
            </div>
        </section>
    </template>
    <template id="notification-card-template"> <!-- Template ini sama dengan yang di kode awal -->
        <article class="notification-card" role="listitem" tabindex="0">
            <div class="notification-card-header">
                <div class="d-flex align-items-start">
                    <i class="notification-type-icon bi"></i>
                    <div>
                        <h3 class="notification-title"></h3>
                        <span class="badge"></span>
                    </div>
                </div>
                <div class="notification-actions">
                    <button class="btn btn-icon btn-sm mark-read-btn" aria-label="Tandai sebagai sudah dibaca">
                        <i class="bi bi-check-circle"></i>
                    </button>
                    <button class="btn btn-icon btn-sm expand-btn" aria-label="Lihat detail" aria-expanded="false">
                        <i class="bi bi-chevron-down"></i>
                    </button>
                    <button class="btn btn-icon btn-sm delete-btn" aria-label="Hapus notifikasi">
                        <i class="bi bi-trash3"></i>
                    </button>
                </div>
            </div>
            <div class="notification-body">
                <p class="notification-summary"></p>
                <div class="notification-content">
                    <p class="notification-details"></p>
                </div>
            </div>
            <div class="notification-footer">
                <small class="notification-timestamp"></small>
                <span class="status-indicator" aria-hidden="true"></span>
            </div>
        </article>
    </template>

    <!-- Template untuk Halaman Placeholder -->
    <template id="template-placeholder-page">
        <div class="placeholder-page">
            <i class="bi"></i> <!-- Icon diisi JS -->
            <h2 data-placeholder="title">Judul Halaman</h2>
            <p data-placeholder="message">Fitur ini sedang dalam pengembangan. Silakan cek kembali nanti!</p>
        </div>
    </template>

    <script>
        // --- APLIKASI SPA VANILLA JAVASCRIPT ---
        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE APLIKASI GLOBAL ---
            const appState = {
                currentPage: 'dashboard', // Halaman default
                isSidebarCollapsed: window.innerWidth < 992, // Kolaps default di layar kecil
                user: {
                    name: 'Pengguna Terhormat',
                    email: 'pengguna@apartemenkita.id',
                    avatar: 'https://i.pravatar.cc/150?u=pengguna1', // Ganti dengan URL avatar default
                    fullName: 'Pengguna Terhormat Aplikasi',
                    phone: '(021) 555-0123',
                    address: 'Jl. Kebahagiaan No. 123, Kota Harmoni',
                    joinDate: new Date(2023, 0, 15) // Contoh tanggal bergabung
                },
                notifications: [],
                nextNotificationId: 1,
                currentNotificationFilter: 'all',
                apartments: [],
                nextApartmentId: 1,
                favoriteApartmentIds: [], // Menyimpan ID apartemen yang difavoritkan
                dashboardStats: [
                    { id: 'activeBookings', label: 'Booking Aktif', value: 0, icon: 'bi-calendar2-check', colorClass: 'bg-primary' },
                    { id: 'pendingPayments', label: 'Pembayaran Tertunda', value: 0, icon: 'bi-hourglass-split', colorClass: 'bg-warning' },
                    { id: 'maintenanceRequests', label: 'Permintaan Maintenance', value: 0, icon: 'bi-tools', colorClass: 'bg-danger' },
                    { id: 'savedProperties', label: 'Properti Tersimpan', value: 0, icon: 'bi-heart', colorClass: 'bg-success' }
                ],
                // Variabel untuk menyimpan referensi ke elemen DOM yang sering diakses
                dom: {
                    appRoot: document.getElementById('app-root'),
                    appSidebar: document.getElementById('appSidebar'),
                    appMainWrapper: document.getElementById('appMainWrapper'),
                    sidebarToggleBtn: document.getElementById('sidebarToggleBtn'),
                    currentPageTitle: document.getElementById('currentPageTitle'),
                    navLinks: document.querySelectorAll('.app-nav .nav-link'),
                    userProfileAvatar: document.getElementById('userProfileAvatar'),
                    userProfileName: document.getElementById('userProfileName'),
                    userProfileEmail: document.getElementById('userProfileEmail'),
                    currentYearSpan: document.getElementById('currentYear'),
                    addSampleNotificationBtnHeader: document.getElementById('addSampleNotificationBtnHeader'),
                    // Akan diisi lebih lanjut di initDOMReferences
                },
                // Variabel untuk menyimpan referensi ke template
                templates: {}
            };

            // --- KONFIGURASI RGB WARNA (untuk background transparan dengan warna solid) ---
            // Ini perlu disesuaikan jika warna di CSS root berubah
            const colorRGB = {
                primary: '99, 102, 241',
                success: '34, 197, 94',
                warning: '250, 204, 21',
                danger: '239, 68, 68'
            };
            document.documentElement.style.setProperty('--primary-color-rgb', colorRGB.primary);
            document.documentElement.style.setProperty('--success-color-rgb', colorRGB.success);
            document.documentElement.style.setProperty('--warning-color-rgb', colorRGB.warning);
            document.documentElement.style.setProperty('--danger-color-rgb', colorRGB.danger);


            // --- UTILITIES ---
            const utils = {
                getIconForNotifType: (type) => {
                    switch (type.toLowerCase()) {
                        case 'booking': return 'bi-calendar-check-fill type-booking';
                        case 'payment': return 'bi-credit-card-2-front-fill type-payment';
                        case 'maintenance': return 'bi-tools type-maintenance';
                        case 'info': return 'bi-info-circle-fill type-info';
                        default: return 'bi-bell-fill';
                    }
                },
                getBadgeClassForNotifType: (type) => {
                    switch (type.toLowerCase()) {
                        case 'booking': return 'badge-primary';
                        case 'payment': return 'badge-success';
                        case 'maintenance': return 'badge-accent';
                        case 'info': return 'badge-info';
                        default: return 'badge-secondary';
                    }
                },
                timeAgo: (date) => {
                    const seconds = Math.floor((new Date() - date) / 1000);
                    let interval = Math.floor(seconds / 31536000);
                    if (interval > 1) return interval + " tahun lalu";
                    interval = Math.floor(seconds / 2592000);
                    if (interval > 1) return interval + " bulan lalu";
                    interval = Math.floor(seconds / 86400);
                    if (interval > 1) return interval + " hari lalu";
                    interval = Math.floor(seconds / 3600);
                    if (interval > 1) return interval + " jam lalu";
                    interval = Math.floor(seconds / 60);
                    if (interval > 1) return interval + " menit lalu";
                    if (seconds < 10) return "baru saja";
                    return Math.floor(seconds) + " detik lalu";
                },
                formatCurrency: (amount, currency = 'IDR') => {
                    return new Intl.NumberFormat('id-ID', { style: 'currency', currency: currency, minimumFractionDigits: 0 }).format(amount);
                },
                truncateText: (text, maxLength) => {
                    if (text.length <= maxLength) return text;
                    return text.substr(0, text.lastIndexOf(' ', maxLength)) + '...';
                },
                // Fungsi untuk mendapatkan konten dari template
                getTemplateContent: (templateId) => {
                    const template = appState.templates[templateId];
                    if (template) {
                        return template.content.cloneNode(true);
                    }
                    console.error(`Template dengan ID "${templateId}" tidak ditemukan.`);
                    return document.createDocumentFragment(); // Kembalikan fragment kosong jika tidak ada
                }
            };

            // --- MANAJEMEN STATE & LOCALSTORAGE ---
            const storageKey = 'apartmentAppSPAState';
            function loadState() {
                const storedState = localStorage.getItem(storageKey);
                if (storedState) {
                    const parsed = JSON.parse(storedState);
                    // Gabungkan state yang disimpan dengan hati-hati, jangan timpa fungsi/DOM refs
                    appState.user = { ...appState.user, ...parsed.user };
                    appState.notifications = parsed.notifications.map(n => ({ ...n, timestamp: new Date(n.timestamp) })) || [];
                    appState.nextNotificationId = parsed.nextNotificationId || 1;
                    appState.apartments = parsed.apartments || [];
                    appState.nextApartmentId = parsed.nextApartmentId || 1;
                    appState.favoriteApartmentIds = parsed.favoriteApartmentIds || [];
                    // Statistik tidak disimpan, akan di-generate atau di-fetch
                }
                // Tambahkan data mock jika kosong
                if (appState.notifications.length === 0) {
                    addInitialNotifications(true); // silent add
                }
                if (appState.apartments.length === 0) {
                    addInitialApartments(true); // silent add
                }
                updateDashboardStats(); // Update stats berdasarkan data yang ada
            }

            function saveState() {
                // Hanya simpan data yang relevan dan bisa di-serialize
                const stateToSave = {
                    user: appState.user, // Simpan data user jika ada perubahan
                    notifications: appState.notifications,
                    nextNotificationId: appState.nextNotificationId,
                    apartments: appState.apartments,
                    nextApartmentId: appState.nextApartmentId,
                    favoriteApartmentIds: appState.favoriteApartmentIds
                };
                localStorage.setItem(storageKey, JSON.stringify(stateToSave));
            }

            // --- FUNGSI RENDER GLOBAL ---
            function renderApp() {
                updateSidebarState();
                updateUserProfileDisplay();
                renderCurrentPage();
                updateActiveNavLink();
            }

            function renderCurrentPage() {
                appState.dom.appRoot.innerHTML = ''; // Kosongkan konten sebelum render
                let pageContent;
                const pageTitle = appState.dom.navLinks // Cari judul dari link navigasi
                    .find(link => link.dataset.page === appState.currentPage)
                    ?.querySelector('.nav-link-text')?.textContent || 'ApartemenKita';
                appState.dom.currentPageTitle.textContent = pageTitle;

                switch (appState.currentPage) {
                    case 'dashboard':
                        pageContent = utils.getTemplateContent('template-dashboard');
                        renderDashboardView(pageContent);
                        break;
                    case 'profile':
                        pageContent = utils.getTemplateContent('template-profile');
                        renderProfileView(pageContent);
                        break;
                    case 'apartments':
                    case 'favorites': // Halaman favorit akan memfilter dari apartments
                        pageContent = utils.getTemplateContent('template-apartments');
                        renderApartmentsView(pageContent, appState.currentPage === 'favorites');
                        break;
                    case 'notifications':
                        pageContent = utils.getTemplateContent('template-notifications');
                        // DOM elemen untuk notifikasi akan di-cache di sini
                        appState.dom.notificationList = pageContent.getElementById('notification-list');
                        appState.dom.noNotificationsMessage = pageContent.getElementById('no-notifications-message');
                        appState.dom.notificationFilterButtons = pageContent.querySelector('.filter-buttons');
                        renderNotificationsView(); // Panggil fungsi render spesifik notifikasi
                        break;
                    case 'bookings':
                    case 'payments':
                    case 'maintenance':
                    case 'messages':
                    case 'settings':
                        pageContent = utils.getTemplateContent('template-placeholder-page');
                        renderPlaceholderView(pageContent, appState.currentPage);
                        break;
                    default:
                        pageContent = document.createElement('p');
                        pageContent.textContent = 'Halaman tidak ditemukan.';
                }
                if (pageContent) {
                    appState.dom.appRoot.appendChild(pageContent);
                }
            }

            // --- FUNGSI RENDER SPESIFIK PER HALAMAN ---

            // DASHBOARD
            function renderDashboardView(contentElement) {
                const statsGrid = contentElement.getElementById('dashboardStatsGrid');
                statsGrid.innerHTML = '';
                appState.dashboardStats.forEach(stat => {
                    const statCardClone = utils.getTemplateContent('template-stat-card');
                    const card = statCardClone.querySelector('.stat-card');
                    const iconContainer = card.querySelector('.stat-card-icon');
                    iconContainer.classList.add(stat.colorClass);
                    iconContainer.querySelector('i').className = `bi ${stat.icon}`;
                    card.querySelector('[data-stat="value"]').textContent = stat.value;
                    card.querySelector('[data-stat="label"]').textContent = stat.label;
                    statsGrid.appendChild(card);
                });

                // Render apartemen terbaru (misal 3 teratas)
                const recentApartmentsContainer = contentElement.getElementById('dashboardRecentApartments');
                recentApartmentsContainer.innerHTML = '';
                const recentApartments = [...appState.apartments].sort((a, b) => b.id - a.id).slice(0, 3);
                if (recentApartments.length > 0) {
                    const list = document.createElement('ul');
                    list.className = 'list-group list-group-flush';
                    recentApartments.forEach(apt => {
                        const listItem = document.createElement('li');
                        listItem.className = 'list-group-item d-flex justify-content-between align-items-center';
                        listItem.innerHTML = `<span>${apt.name}</span> <a href="#apartments" data-page="apartments" data-apartment-id="${apt.id}" class="btn btn-sm btn-outline-primary">Lihat</a>`;
                        list.appendChild(listItem);
                    });
                    recentApartmentsContainer.appendChild(list);
                } else {
                    recentApartmentsContainer.innerHTML = '<p class="text-muted">Belum ada apartemen.</p>';
                }

                // Render notifikasi penting (misal 3 belum dibaca)
                const importantNotificationsContainer = contentElement.getElementById('dashboardImportantNotifications');
                importantNotificationsContainer.innerHTML = '';
                const importantNotifs = appState.notifications.filter(n => !n.isRead).sort((a, b) => b.timestamp - a.timestamp).slice(0, 3);
                if (importantNotifs.length > 0) {
                    const list = document.createElement('ul');
                    list.className = 'list-group list-group-flush';
                    importantNotifs.forEach(notif => {
                        const listItem = document.createElement('li');
                        listItem.className = 'list-group-item';
                        listItem.innerHTML = `
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">${notif.title}</h6>
                                <small>${utils.timeAgo(notif.timestamp)}</small>
                            </div>
                            <p class="mb-1 small">${utils.truncateText(notif.summary, 50)}</p>
                            <small class="text-muted">Tipe: ${notif.type}</small>`;
                        list.appendChild(listItem);
                    });
                    importantNotificationsContainer.appendChild(list);
                } else {
                    importantNotificationsContainer.innerHTML = '<p class="text-muted">Tidak ada notifikasi baru.</p>';
                }
            }
            function updateDashboardStats() {
                const stats = appState.dashboardStats;
                stats.find(s => s.id === 'activeBookings').value = Math.floor(Math.random() * 10); // Mock
                stats.find(s => s.id === 'pendingPayments').value = appState.notifications.filter(n => n.type === 'payment' && !n.isRead).length;
                stats.find(s => s.id === 'maintenanceRequests').value = appState.notifications.filter(n => n.type === 'maintenance').length;
                stats.find(s => s.id === 'savedProperties').value = appState.favoriteApartmentIds.length;
            }


            // PROFIL
            function renderProfileView(contentElement) {
                contentElement.getElementById('profilePageAvatar').src = appState.user.avatar;
                contentElement.getElementById('profilePageAvatar').alt = `Foto profil ${appState.user.name}`;
                contentElement.getElementById('profilePageName').textContent = appState.user.name;
                contentElement.getElementById('profilePageEmail').textContent = appState.user.email;

                contentElement.getElementById('profileDetailFullName').textContent = appState.user.fullName;
                contentElement.getElementById('profileDetailPhone').textContent = appState.user.phone;
                contentElement.getElementById('profileDetailAddress').textContent = appState.user.address;
                contentElement.getElementById('profileDetailJoinDate').textContent = appState.user.joinDate.toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' });
            }
            function updateUserProfileDisplay() {
                appState.dom.userProfileAvatar.src = appState.user.avatar;
                appState.dom.userProfileAvatar.alt = `Foto profil ${appState.user.name}`;
                appState.dom.userProfileName.textContent = appState.user.name;
                appState.dom.userProfileEmail.textContent = appState.user.email;
            }

            // APARTEMEN & FAVORIT
            function renderApartmentsView(contentElement, showFavoritesOnly = false) {
                const apartmentListContainer = contentElement.getElementById('apartmentListContainer');
                const noApartmentsMessage = contentElement.getElementById('no-apartments-message');
                const searchInput = contentElement.getElementById('apartmentSearchInput');
                const pageTitle = contentElement.getElementById('apartments-title');

                if (showFavoritesOnly) {
                    pageTitle.textContent = "Apartemen Favorit Anda";
                    searchInput.style.display = 'none'; // Sembunyikan search di favorit
                    contentElement.getElementById('addApartmentBtn').style.display = 'none';
                } else {
                    pageTitle.textContent = "Daftar Apartemen";
                    searchInput.style.display = 'block';
                    contentElement.getElementById('addApartmentBtn').style.display = 'flex';
                }

                apartmentListContainer.innerHTML = '';

                const searchTerm = searchInput.value.toLowerCase();
                let filteredApartments = appState.apartments.filter(apt => {
                    const matchesSearch = apt.name.toLowerCase().includes(searchTerm) || apt.summary.toLowerCase().includes(searchTerm);
                    if (showFavoritesOnly) {
                        return appState.favoriteApartmentIds.includes(apt.id) && matchesSearch;
                    }
                    return matchesSearch;
                });

                if (filteredApartments.length === 0) {
                    noApartmentsMessage.style.display = 'block';
                    if (showFavoritesOnly) {
                        noApartmentsMessage.querySelector('p').textContent = "Anda belum memiliki apartemen favorit.";
                        noApartmentsMessage.querySelector('i').className = "bi bi-heartbreak";
                    } else {
                        noApartmentsMessage.querySelector('p').textContent = "Tidak ada apartemen yang cocok dengan pencarian Anda atau belum ada apartemen.";
                        noApartmentsMessage.querySelector('i').className = "bi bi-search";
                    }
                } else {
                    noApartmentsMessage.style.display = 'none';
                    filteredApartments.forEach(apt => {
                        const cardClone = utils.getTemplateContent('template-apartment-card');
                        const cardElement = cardClone.querySelector('.apartment-card');
                        cardElement.dataset.id = apt.id;

                        cardElement.querySelector('.card-img-top').src = apt.image;
                        cardElement.querySelector('.card-img-top').alt = `Gambar ${apt.name}`;
                        cardElement.querySelector('.apartment-name').textContent = apt.name;
                        cardElement.querySelector('.apartment-price').textContent = `${utils.formatCurrency(apt.price)} / bulan`;
                        cardElement.querySelector('.feature-beds').textContent = apt.features.beds;
                        cardElement.querySelector('.feature-baths').textContent = apt.features.baths;
                        cardElement.querySelector('.feature-area').textContent = apt.features.area;
                        cardElement.querySelector('.apartment-summary').textContent = utils.truncateText(apt.summary, 100);

                        const favButton = cardElement.querySelector('.btn-favorite');
                        favButton.dataset.apartmentId = apt.id;
                        if (appState.favoriteApartmentIds.includes(apt.id)) {
                            favButton.classList.add('favorited');
                            favButton.innerHTML = '<i class="bi bi-heart-fill"></i>';
                            favButton.setAttribute('aria-label', 'Hapus dari favorit');
                        } else {
                            favButton.classList.remove('favorited');
                            favButton.innerHTML = '<i class="bi bi-heart"></i>';
                            favButton.setAttribute('aria-label', 'Tambahkan ke favorit');
                        }

                        apartmentListContainer.appendChild(cardClone);
                    });
                }
                // Re-attach event listener untuk search input jika belum ada
                if (!searchInput.dataset.listenerAttached) {
                    searchInput.addEventListener('input', () => renderApartmentsView(contentElement, showFavoritesOnly));
                    searchInput.dataset.listenerAttached = 'true';
                }
            }

            function addApartment(aptData, silent = false) {
                const newApartment = {
                    id: appState.nextApartmentId++,
                    image: 'https://source.unsplash.com/random/400x300/?apartment,' + appState.nextApartmentId, // Gambar acak
                    ...aptData
                };
                appState.apartments.unshift(newApartment);
                if (!silent) {
                    if (appState.currentPage === 'apartments' || appState.currentPage === 'dashboard') {
                        renderCurrentPage(); // Re-render halaman apartemen atau dashboard jika aktif
                    }
                }
                saveState();
            }
            function addInitialApartments(silent = false) {
                const sampleApartments = [
                    { name: 'Apartemen Serene Heights', price: 7500000, features: { beds: 2, baths: 1, area: 65 }, summary: 'Apartemen modern dengan pemandangan kota yang menakjubkan, cocok untuk profesional muda.' },
                    { name: 'Cozy Studio Downtown', price: 4200000, features: { beds: 1, baths: 1, area: 35 }, summary: 'Studio minimalis di pusat kota, akses mudah ke transportasi dan hiburan.' },
                    { name: 'Family Garden Residence', price: 12000000, features: { beds: 3, baths: 2, area: 110 }, summary: 'Hunian luas dengan taman pribadi, ideal untuk keluarga yang mencari kenyamanan.' },
                    { name: 'Urban Loft Living', price: 9800000, features: { beds: 1, baths: 2, area: 80 }, summary: 'Loft stylish dengan desain industrial, langit-langit tinggi dan jendela besar.' },
                ];
                sampleApartments.forEach(apt => addApartment(apt, silent));
            }
            function toggleFavoriteApartment(apartmentId) {
                const id = parseInt(apartmentId);
                const index = appState.favoriteApartmentIds.indexOf(id);
                if (index > -1) {
                    appState.favoriteApartmentIds.splice(index, 1);
                } else {
                    appState.favoriteApartmentIds.push(id);
                }
                updateDashboardStats(); // Update stat properti tersimpan
                saveState();
                // Re-render jika di halaman apartemen atau favorit
                if (appState.currentPage === 'apartments' || appState.currentPage === 'favorites' || appState.currentPage === 'dashboard') {
                    renderCurrentPage();
                }
            }


            // NOTIFIKASI (menggunakan struktur yang sudah ada dan disesuaikan)
            function renderNotificationsView() {
                const notificationList = appState.dom.notificationList;
                const noNotificationsMessage = appState.dom.noNotificationsMessage;
                const filterButtonsContainer = appState.dom.notificationFilterButtons;

                if (!notificationList || !noNotificationsMessage || !filterButtonsContainer) {
                    console.error("Elemen DOM untuk notifikasi tidak ditemukan. Pastikan template-notifications dimuat dengan benar.");
                    return;
                }

                notificationList.innerHTML = '';

                const filteredNotifications = appState.notifications.filter(n => {
                    if (appState.currentNotificationFilter === 'all') return true;
                    if (appState.currentNotificationFilter === 'unread') return !n.isRead;
                    return n.type.toLowerCase() === appState.currentNotificationFilter;
                }).sort((a, b) => b.timestamp - a.timestamp);

                if (filteredNotifications.length === 0) {
                    noNotificationsMessage.style.display = 'block';
                } else {
                    noNotificationsMessage.style.display = 'none';
                    filteredNotifications.forEach(notif => {
                        const cardClone = utils.getTemplateContent('notification-card-template');
                        const cardElement = cardClone.querySelector('.notification-card');

                        cardElement.dataset.id = notif.id;
                        if (notif.isRead) cardElement.classList.add('is-read');

                        cardClone.querySelector('.notification-type-icon').className = `notification-type-icon bi ${utils.getIconForNotifType(notif.type)}`;
                        cardClone.querySelector('.notification-title').textContent = notif.title;
                        const badge = cardClone.querySelector('.badge');
                        badge.textContent = notif.type.charAt(0).toUpperCase() + notif.type.slice(1);
                        badge.className = `badge ${utils.getBadgeClassForNotifType(notif.type)}`;
                        cardClone.querySelector('.notification-summary').textContent = notif.summary;
                        cardClone.querySelector('.notification-details').textContent = notif.details;
                        cardClone.querySelector('.notification-timestamp').textContent = utils.timeAgo(notif.timestamp);

                        const markReadBtn = cardClone.querySelector('.mark-read-btn');
                        if (notif.isRead) {
                            markReadBtn.innerHTML = '<i class="bi bi-envelope-open"></i>';
                            markReadBtn.setAttribute('aria-label', 'Tandai sebagai belum dibaca');
                            cardClone.querySelector('.status-indicator').textContent = 'Sudah dibaca';
                        } else {
                            markReadBtn.innerHTML = '<i class="bi bi-check-circle"></i>';
                            markReadBtn.setAttribute('aria-label', 'Tandai sebagai sudah dibaca');
                            cardClone.querySelector('.status-indicator').textContent = 'Baru';
                            cardClone.querySelector('.status-indicator').style.color = 'var(--primary-color)';
                            cardClone.querySelector('.status-indicator').style.fontWeight = 'bold';
                        }
                        notificationList.appendChild(cardClone);
                    });
                }
                updateNotificationFilterButtons(filterButtonsContainer);
            }

            function updateNotificationFilterButtons(container) {
                if (!container) return;
                container.querySelectorAll('button').forEach(button => {
                    if (button.dataset.filter === appState.currentNotificationFilter) {
                        button.classList.add('active');
                    } else {
                        button.classList.remove('active');
                    }
                });
            }

            function addNotification(notifData, silent = false) {
                const newNotification = {
                    id: appState.nextNotificationId++,
                    timestamp: new Date(),
                    isRead: false,
                    ...notifData
                };
                appState.notifications.unshift(newNotification);
                if (!silent) {
                    if (appState.currentPage === 'notifications') renderNotificationsView();
                    if (appState.currentPage === 'dashboard') renderCurrentPage(); // update important notifs
                }
                updateDashboardStats(); // Update stat pembayaran tertunda
                saveState();
            }
            function deleteNotification(id) {
                appState.notifications = appState.notifications.filter(n => n.id !== id);
                if (appState.currentPage === 'notifications') renderNotificationsView();
                if (appState.currentPage === 'dashboard') renderCurrentPage();
                updateDashboardStats();
                saveState();
            }
            function toggleNotificationReadStatus(id) {
                const notification = appState.notifications.find(n => n.id === id);
                if (notification) {
                    notification.isRead = !notification.isRead;
                    if (appState.currentPage === 'notifications') renderNotificationsView();
                    if (appState.currentPage === 'dashboard') renderCurrentPage();
                    updateDashboardStats();
                    saveState();
                }
            }
            function addInitialNotifications(silent = false) {
                addNotification({ title: 'Selamat Datang!', summary: 'Ini adalah pusat notifikasi rental apartemen Anda.', details: 'Anda dapat melihat semua pembaruan terkait booking, pembayaran, dan perawatan di sini.', type: 'info' }, silent);
                addNotification({ title: 'Pembayaran Jatuh Tempo', summary: 'Sewa Apartemen A-01 jatuh tempo 3 hari lagi.', details: 'Segera lakukan pembayaran sewa bulanan unit A-01 sebelum tanggal 25.', type: 'payment' }, silent);
                addNotification({ title: 'Permintaan Perbaikan', summary: 'Laporan kerusakan keran unit B-12.', details: 'Tim teknisi akan menjadwalkan kunjungan untuk perbaikan keran di kamar mandi unit B-12.', type: 'maintenance' }, silent);
            }


            // PLACEHOLDER PAGES
            function renderPlaceholderView(contentElement, pageKey) {
                const titles = {
                    bookings: "Manajemen Booking",
                    payments: "Riwayat Pembayaran",
                    maintenance: "Jadwal & Permintaan Maintenance",
                    messages: "Pusat Pesan",
                    settings: "Pengaturan Akun & Aplikasi"
                };
                const icons = {
                    bookings: "bi-calendar-range",
                    payments: "bi-wallet2",
                    maintenance: "bi-wrench-adjustable-circle",
                    messages: "bi-send-exclamation",
                    settings: "bi-sliders"
                }
                contentElement.querySelector('i').className = `bi ${icons[pageKey] || 'bi-cone-striped'}`;
                contentElement.querySelector('[data-placeholder="title"]').textContent = titles[pageKey] || "Segera Hadir";
                if (pageKey === 'messages') {
                    contentElement.querySelector('[data-placeholder="message"]').textContent = "Fitur perpesanan langsung akan segera tersedia untuk komunikasi yang lebih mudah.";
                }
            }

            // --- MANAJEMEN SIDEBAR ---
            function updateSidebarState() {
                if (appState.isSidebarCollapsed) {
                    appState.dom.appSidebar.classList.add('collapsed');
                    appState.dom.appMainWrapper.classList.add('sidebar-collapsed');
                    appState.dom.sidebarToggleBtn.setAttribute('aria-expanded', 'false');
                    appState.dom.sidebarToggleBtn.innerHTML = '<i class="bi bi-list"></i>';
                } else {
                    appState.dom.appSidebar.classList.remove('collapsed');
                    appState.dom.appMainWrapper.classList.remove('sidebar-collapsed');
                    appState.dom.sidebarToggleBtn.setAttribute('aria-expanded', 'true');
                    appState.dom.sidebarToggleBtn.innerHTML = '<i class="bi bi-x-lg"></i>';
                }
            }
            function toggleSidebar() {
                appState.isSidebarCollapsed = !appState.isSidebarCollapsed;
                // Jika di layar kecil dan sidebar dibuka manual, tambahkan class khusus
                if (window.innerWidth < 992 && !appState.isSidebarCollapsed) {
                    appState.dom.appSidebar.classList.add('manual-open');
                } else {
                    appState.dom.appSidebar.classList.remove('manual-open');
                }
                updateSidebarState();
            }

            // --- NAVIGASI & ROUTING (Hash-based) ---
            function handleNavigation(hash) {
                const page = hash.substring(1) || 'dashboard'; // Hapus '#'
                if (appState.currentPage !== page) {
                    appState.currentPage = page;
                    renderApp();
                }
                // Jika sidebar terbuka manual di layar kecil, tutup setelah navigasi
                if (window.innerWidth < 992 && appState.dom.appSidebar.classList.contains('manual-open')) {
                    appState.isSidebarCollapsed = true; // Set state agar tertutup
                    appState.dom.appSidebar.classList.remove('manual-open');
                    updateSidebarState();
                }
            }
            function updateActiveNavLink() {
                appState.dom.navLinks.forEach(link => {
                    if (link.dataset.page === appState.currentPage) {
                        link.classList.add('active');
                        link.setAttribute('aria-current', 'page');
                    } else {
                        link.classList.remove('active');
                        link.removeAttribute('aria-current');
                    }
                });
            }

            // --- EVENT LISTENERS ---
            function setupEventListeners() {
                // Navigasi Sidebar & Header
                appState.dom.navLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        // Tidak perlu e.preventDefault() karena kita pakai href="#page"
                        // Perubahan hash akan ditangani oleh 'hashchange' listener
                        // Cukup pastikan state halaman berubah untuk update UI jika hash sama
                        const page = e.currentTarget.dataset.page;
                        if (appState.currentPage === page && window.location.hash === `#${page}`) {
                            // Jika halaman sama dan hash sama, paksa render (misal dari klik header icon)
                            renderCurrentPage();
                        }
                    });
                });
                // Tombol navigasi di header
                appState.dom.appHeader.addEventListener('click', (e) => {
                    const targetLink = e.target.closest('a[data-page]');
                    if (targetLink) {
                        // Biarkan hashchange menangani ini
                    }
                });


                window.addEventListener('hashchange', () => handleNavigation(window.location.hash));
                window.addEventListener('popstate', () => handleNavigation(window.location.hash)); // Untuk tombol back/forward browser

                appState.dom.sidebarToggleBtn.addEventListener('click', toggleSidebar);

                // Listener untuk tombol tambah notifikasi contoh di header
                if (appState.dom.addSampleNotificationBtnHeader) {
                    appState.dom.addSampleNotificationBtnHeader.addEventListener('click', addSampleNotificationFromAnywhere);
                }

                // Event delegation untuk aksi dinamis di dalam #app-root
                appState.dom.appRoot.addEventListener('click', (event) => {
                    const target = event.target;

                    // Aksi untuk Notifikasi (jika halaman notifikasi aktif)
                    if (appState.currentPage === 'notifications') {
                        const notifCard = target.closest('.notification-card');
                        if (notifCard) {
                            const notificationId = parseInt(notifCard.dataset.id, 10);
                            if (target.closest('.delete-btn')) {
                                if (confirm('Apakah Anda yakin ingin menghapus notifikasi ini?')) {
                                    deleteNotification(notificationId);
                                }
                            } else if (target.closest('.mark-read-btn')) {
                                toggleNotificationReadStatus(notificationId);
                            } else if (target.closest('.expand-btn')) {
                                const content = notifCard.querySelector('.notification-content');
                                const icon = target.closest('.expand-btn').querySelector('i');
                                const isExpanded = content.classList.toggle('expanded');
                                target.closest('.expand-btn').setAttribute('aria-expanded', isExpanded);
                                icon.className = isExpanded ? 'bi bi-chevron-up' : 'bi bi-chevron-down';
                            }
                        }
                        // Filter notifikasi
                        if (target.matches('.filter-buttons button[data-filter]')) {
                            appState.currentNotificationFilter = target.dataset.filter;
                            renderNotificationsView();
                        }
                    }

                    // Aksi untuk Apartemen
                    if (appState.currentPage === 'apartments' || appState.currentPage === 'favorites' || appState.currentPage === 'dashboard') {
                        const favButton = target.closest('.btn-favorite');
                        if (favButton && favButton.dataset.apartmentId) {
                            toggleFavoriteApartment(favButton.dataset.apartmentId);
                        }
                        const detailButton = target.closest('.view-details-btn');
                        if (detailButton) {
                            const aptCard = target.closest('.apartment-card');
                            if (aptCard && aptCard.dataset.id) {
                                alert(`Menampilkan detail untuk apartemen ID: ${aptCard.dataset.id}. Fitur detail belum diimplementasikan sepenuhnya.`);
                            }
                        }
                        // Tombol "Tambah Apartemen"
                        if (target.id === 'addApartmentBtn' || target.closest('#addApartmentBtn')) {
                            const name = prompt("Masukkan nama apartemen baru:", "Apartemen Mewah Contoh");
                            if (name) {
                                addApartment({
                                    name: name,
                                    price: Math.floor(Math.random() * 10000000) + 3000000,
                                    features: { beds: Math.floor(Math.random() * 2) + 1, baths: Math.floor(Math.random() * 1) + 1, area: Math.floor(Math.random() * 70) + 30 },
                                    summary: 'Deskripsi default untuk apartemen baru yang ditambahkan.'
                                });
                            }
                        }
                    }
                    // Link di dashboard untuk lihat apartemen
                    if (appState.currentPage === 'dashboard') {
                        const aptLink = target.closest('a[data-apartment-id]');
                        if (aptLink) {
                            // Biarkan hashchange menangani navigasi ke #apartments
                            // e.preventDefault(); // Tidak perlu jika href="#apartments"
                            // appState.currentPage = 'apartments';
                            // renderApp();
                            // Tambahan: mungkin scroll ke apartemen spesifik nanti
                        }
                    }
                });

                // Listener keyboard untuk aksesibilitas pada daftar notifikasi (jika ada)
                appState.dom.appRoot.addEventListener('keydown', (event) => {
                    if (appState.currentPage === 'notifications') {
                        const card = event.target.closest('.notification-card');
                        if (card && (event.key === 'Enter' || event.key === ' ')) {
                            if (event.target === card) { // Jika fokus pada kartu itu sendiri
                                event.preventDefault();
                                const expandButton = card.querySelector('.expand-btn');
                                if (expandButton) expandButton.click();
                            }
                        }
                    }
                });

                document.getElementById('logoutButton').addEventListener('click', (e) => {
                    e.preventDefault();
                    if (confirm("Apakah Anda yakin ingin keluar?")) {
                        // Logika logout: hapus state, kembali ke halaman login (disimulasikan)
                        localStorage.removeItem(storageKey);
                        // Hapus semua data dari appState, set ke default
                        appState.notifications = [];
                        appState.apartments = [];
                        appState.favoriteApartmentIds = [];
                        // dll.
                        alert("Anda telah keluar. Aplikasi akan di-reset.");
                        window.location.hash = '#dashboard'; // Kembali ke dashboard
                        initializeApp(); // Re-inisialisasi aplikasi (akan memuat data awal jika kosong)
                    }
                });
            }

            function addSampleNotificationFromAnywhere() {
                const sampleTypes = ['booking', 'payment', 'maintenance', 'info'];
                const randomType = sampleTypes[Math.floor(Math.random() * sampleTypes.length)];
                let sampleData;

                switch (randomType) {
                    case 'booking':
                        sampleData = {
                            title: 'Booking Baru Diterima',
                            summary: `Permintaan booking untuk Apartemen C-${Math.floor(Math.random() * 20) + 10}.`,
                            details: `Detail permintaan booking baru...`,
                            type: 'booking'
                        };
                        break;

                    case 'payment':
                        sampleData = {
                            title: 'Pembayaran Sukses',
                            summary: 'Pembayaran sewa unit B-05 telah diverifikasi.',
                            details: 'Detail pembayaran berhasil...',
                            type: 'payment'
                        };
                        break;

                    case 'maintenance':
                        sampleData = {
                            title: 'Jadwal Perawatan',
                            summary: 'Perawatan AC unit D-11 besok.',
                            details: 'Detail jadwal perawatan...',
                            type: 'maintenance'
                        };
                        break;

                    default:
                        sampleData = {
                            title: 'Info Penting',
                            summary: 'Update peraturan penggunaan fasilitas.',
                            details: 'Detail informasi umum...',
                            type: 'info'
                        };
                        break;
                }

                addNotification(sampleData);

                if (appState.currentPage !== 'notifications' && appState.currentPage !== 'dashboard') {
                    alert(`Notifikasi "${sampleData.title}" telah ditambahkan. Cek halaman Notifikasi.`);
                }
            }


            // --- INISIALISASI APLIKASI ---
            function initDOMReferences() {
                // Template caching
                const templateElements = document.querySelectorAll('template');
                templateElements.forEach(tmpl => {
                    appState.templates[tmpl.id] = tmpl;
                });

                // Menyimpan referensi DOM yang lebih spesifik, terutama yang dinamis atau di dalam template
                // Contoh: appState.dom.notificationList, dll. akan diisi saat render halaman notifikasi
            }

            function initializeApp() {
                initDOMReferences();
                loadState(); // Muat state dari localStorage

                if (appState.dom.currentYearSpan) {
                    appState.dom.currentYearSpan.textContent = new Date().getFullYear();
                }

                // Set halaman awal berdasarkan hash atau default
                handleNavigation(window.location.hash || '#dashboard');
                // Render awal
                renderApp();
                // Setup event listener setelah semua siap
                setupEventListeners();
            }

            initializeApp();
        });
    </script>

</body>

</html>