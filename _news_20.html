<!DOCTYPE html>
<html lang="id" data-theme="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <meta name="description"
    content="RentEase - Platform sewa apartemen modern dan terpercaya. Temukan apartemen impian Anda dengan mudah.">
  <meta name="keywords" content="sewa apartemen, apartemen, rental, properti, RentEase">
  <meta name="author" content="RentEase">
  <!-- Kebijakan Keamanan Konten (CSP) - Disesuaikan untuk Font Awesome & Google Fonts -->
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' https://via.placeholder.com data:; script-src 'self' 'unsafe-inline'; object-src 'none'; base-uri 'self'; form-action 'self';">
  <!-- Mencegah browser dari menebak tipe MIME -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <!-- Mencegah halaman dimuat dalam frame atau iframe dari domain lain -->
  <meta http-equiv="X-Frame-Options" content="DENY">
  <!-- Kontrol Referrer Policy -->
  <meta name="referrer" content="strict-origin-when-cross-origin">

  <title>RentEase - Platform Sewa Apartemen Modern</title>

  <!-- Favicon (Contoh, ganti dengan path favicon Anda) -->
  <link rel="icon"
    href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAACQAAAAAQAAAJAAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAABCgAwAEAAAAAQAAABAAAAAAVHRzTwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAAAMBJREFUOE9jZGBgEBRgYPADiP8DEG8CMQ4g9gAxDxD7AbECCQTEDUD8DMRPgFgNiPVA7ATE7UBsCsTugAQEZgOxAxALALELEEAB2H8g1gBiNyAWBmLnBNQEiL0A8X4gNgS6AAsQgwL4HQh9ALEHkEAREA0k8A2IHkBCgFgViD2AWAtQgwQYgHgKEP8FQg0kqAUG0DMAcQ8gewdtJoA0GAg2AAkzYGIQkDkAbgByAEg2A0kDIGsDaS4DySQLDkAb0AHIqISu5AAAAABJRU5ErkJggg=="
    type="image/x-icon">

  <!-- Font Awesome - Icon Library (Online & Gratis) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous" referrerpolicy="no-referrer">

  <!-- Google Fonts - Inter & Poppins (Online & Gratis) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@500;600;700;800&display=swap"
    rel="stylesheet">

  <style>
    /* Reset CSS & Konfigurasi Dasar */
    *,
    *::before,
    *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    :root {
      /* Palet Warna Dasar - Mode Terang */
      --primary-hue: 217;
      /* Biru */
      --primary-saturation: 91%;
      --primary-lightness: 60%;
      --primary: hsl(var(--primary-hue), var(--primary-saturation), var(--primary-lightness));
      /* #3b82f6 */
      --primary-light: hsl(var(--primary-hue), var(--primary-saturation), calc(var(--primary-lightness) + 10%));
      --primary-dark: hsl(var(--primary-hue), var(--primary-saturation), calc(var(--primary-lightness) - 10%));
      /* #2563eb */

      --secondary-hue: 215;
      --secondary-saturation: 14%;
      --secondary-lightness: 95%;
      --secondary: hsl(var(--secondary-hue), var(--secondary-saturation), var(--secondary-lightness));
      /* #f1f5f9 */

      --accent-hue: 42;
      /* Kuning untuk aksen (bisa disesuaikan) */
      --accent-saturation: 95%;
      --accent-lightness: 58%;
      --accent: hsl(var(--accent-hue), var(--accent-saturation), var(--accent-lightness));
      /* #f59e0b */

      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6;

      --background: hsl(210, 40%, 98%);
      /* #f8fafc */
      --foreground: hsl(222, 47%, 11%);
      /* #0f172a */
      --card: #ffffff;
      --card-foreground: var(--foreground);
      --border: hsl(215, 20%, 90%);
      /* #e2e8f0 */
      --muted: hsl(215, 16%, 47%);
      /* #64748b */
      --muted-foreground: hsl(215, 16%, 67%);

      /* Tipografi */
      --font-primary: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      --font-secondary: 'Poppins', sans-serif;
      --font-size-xs: clamp(0.75rem, 0.7rem + 0.25vw, 0.875rem);
      --font-size-sm: clamp(0.875rem, 0.8rem + 0.375vw, 1rem);
      --font-size-base: clamp(1rem, 0.9rem + 0.5vw, 1.125rem);
      --font-size-lg: clamp(1.125rem, 1rem + 0.625vw, 1.25rem);
      --font-size-xl: clamp(1.25rem, 1.1rem + 0.75vw, 1.5rem);
      --font-size-2xl: clamp(1.5rem, 1.3rem + 1vw, 2.25rem);
      --font-size-3xl: clamp(2rem, 1.7rem + 1.5vw, 3rem);
      --font-weight-light: 300;
      --font-weight-normal: 400;
      --font-weight-medium: 500;
      --font-weight-semibold: 600;
      --font-weight-bold: 700;
      --font-weight-extrabold: 800;

      /* Spasi & Ukuran */
      --spacing-0-5: clamp(0.125rem, 0.1rem + 0.125vw, 0.25rem);
      --spacing-1: clamp(0.25rem, 0.2rem + 0.25vw, 0.5rem);
      --spacing-2: clamp(0.5rem, 0.4rem + 0.5vw, 0.75rem);
      --spacing-3: clamp(0.75rem, 0.6rem + 0.75vw, 1rem);
      --spacing-4: clamp(1rem, 0.8rem + 1vw, 1.5rem);
      --spacing-5: clamp(1.5rem, 1.2rem + 1.5vw, 2rem);
      --spacing-6: clamp(2rem, 1.6rem + 2vw, 3rem);

      /* Border Radius */
      --radius-sm: 0.25rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;
      --radius-full: 9999px;

      /* Shadow */
      --shadow-color: 220 3% 15%;
      --shadow-strength: 1%;
      --shadow-sm: 0 1px 2px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 9%));
      --shadow-md: 0 3px 5px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 9%)),
        0 1px 3px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 6%));
      --shadow-lg: 0 10px 15px -3px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 9%)),
        0 4px 6px -2px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 6%));
      --shadow-xl: 0 20px 25px -5px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 9%)),
        0 10px 10px -5px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 6%));

      /* Transisi */
      --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-base: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);

      /* Layout */
      --sidebar-width: clamp(16rem, 14rem + 10vw, 20rem);
      --header-height: 4.5rem;
      --container-padding: var(--spacing-4);
      --content-max-width: 1200px;
    }

    /* Konfigurasi Mode Gelap */
    [data-theme="dark"] {
      --primary-lightness: 50%;
      /* Sesuaikan lightness untuk kontras di dark mode */

      --secondary-hue: 220;
      --secondary-saturation: 13%;
      --secondary-lightness: 15%;
      /* #1e293b */

      --background: hsl(222, 47%, 8%);
      /* #0b111e lebih gelap dari foreground */
      --foreground: hsl(210, 40%, 96%);
      /* #f1f5f9 */
      --card: hsl(222, 40%, 13%);
      /* #1e293b */
      --card-foreground: var(--foreground);
      --border: hsl(215, 28%, 20%);
      /* #334155 */
      --muted: hsl(217, 10%, 60%);
      /* #94a3b8 */
      --muted-foreground: hsl(217, 10%, 40%);

      --shadow-color: 220 40% 2%;
      --shadow-strength: 25%;
    }

    /* Gaya Dasar Body */
    body {
      background-color: var(--background);
      color: var(--foreground);
      font-family: var(--font-primary);
      font-size: var(--font-size-base);
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
      /* Mencegah scroll horizontal yang tidak diinginkan */
      transition: background-color var(--transition-base), color var(--transition-base);
    }

    /* Utilitas Umum */
    .d-flex {
      display: flex;
    }

    .align-items-center {
      align-items: center;
    }

    .justify-content-between {
      justify-content: space-between;
    }

    .justify-content-center {
      justify-content: center;
    }

    .flex-column {
      flex-direction: column;
    }

    .gap-1 {
      gap: var(--spacing-1);
    }

    .gap-2 {
      gap: var(--spacing-2);
    }

    .gap-3 {
      gap: var(--spacing-3);
    }

    .gap-4 {
      gap: var(--spacing-4);
    }

    .text-center {
      text-align: center;
    }

    .w-100 {
      width: 100%;
    }

    .p-relative {
      position: relative;
    }

    .sr-only {
      /* Untuk aksesibilitas, menyembunyikan elemen secara visual tapi tetap dibaca screen reader */
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }

    /* App Container - Menggunakan CSS Grid untuk layout utama */
    .app-container {
      display: grid;
      grid-template-columns: var(--sidebar-width) 1fr;
      grid-template-rows: 1fr;
      /* Header akan menjadi bagian dari main-wrapper */
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      background-color: var(--card);
      border-right: 1px solid var(--border);
      height: 100vh;
      position: fixed;
      /* Fixed agar tetap di tempat saat scroll */
      top: 0;
      left: 0;
      z-index: 1000;
      width: var(--sidebar-width);
      display: flex;
      flex-direction: column;
      padding: var(--spacing-4) var(--spacing-3);
      transition: transform var(--transition-base), background-color var(--transition-base), border-color var(--transition-base);
    }

    .sidebar.collapsed {
      /* Untuk mobile, defaultnya tersembunyi */
      transform: translateX(-100%);
    }

    .sidebar-brand {
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
      font-family: var(--font-secondary);
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-bold);
      color: var(--primary);
      margin-bottom: var(--spacing-5);
      padding: var(--spacing-2) 0;
    }

    .sidebar-brand i {
      font-size: var(--font-size-2xl);
    }

    .nav-menu {
      list-style: none;
      flex-grow: 1;
      /* Agar menu mengambil sisa ruang */
    }

    .nav-item {
      margin-bottom: var(--spacing-1);
    }

    .nav-link {
      display: flex;
      align-items: center;
      padding: var(--spacing-2) var(--spacing-3);
      color: var(--muted);
      border-radius: var(--radius-md);
      transition: var(--transition-fast);
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-medium);
      text-decoration: none;
      /* Hapus underline default dari link */
    }

    .nav-link i {
      margin-right: var(--spacing-3);
      width: 20px;
      /* Jaga konsistensi lebar ikon */
      text-align: center;
      font-size: var(--font-size-lg);
      color: var(--muted-foreground);
      transition: color var(--transition-fast);
    }

    .nav-link:hover,
    .nav-link.active {
      background-color: var(--primary);
      color: white;
      /* Pastikan teks kontras dengan background primary */
      font-weight: var(--font-weight-semibold);
    }

    .nav-link:hover i,
    .nav-link.active i {
      color: white;
    }

    /* Main Wrapper - Mengisi sisa ruang */
    .main-wrapper {
      grid-column: 2 / 3;
      /* Posisi di grid kolom kedua */
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      /* Scroll hanya di main content jika perlu */
      transition: margin-left var(--transition-base);
      /* Untuk animasi saat sidebar hide/show di desktop (jika diperlukan) */
    }

    /* App Header */
    .app-header {
      height: var(--header-height);
      background-color: var(--card);
      border-bottom: 1px solid var(--border);
      padding: 0 var(--container-padding);
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      /* Header tetap di atas saat scroll */
      top: 0;
      z-index: 900;
      box-shadow: var(--shadow-sm);
      transition: background-color var(--transition-base), border-color var(--transition-base);
    }

    .header-left,
    .header-right {
      display: flex;
      align-items: center;
      gap: var(--spacing-3);
    }

    .sidebar-toggle-btn {
      /* Tombol untuk toggle sidebar di mobile */
      display: none;
      /* Defaultnya tersembunyi, muncul di mobile */
      background: transparent;
      border: none;
      color: var(--foreground);
      font-size: var(--font-size-xl);
      padding: var(--spacing-2);
      cursor: pointer;
      border-radius: var(--radius-md);
    }

    .sidebar-toggle-btn:hover {
      background-color: var(--secondary);
    }

    .search-bar {
      display: flex;
      align-items: center;
      background-color: var(--secondary);
      padding: var(--spacing-1-5, 0.375rem) var(--spacing-2);
      /* Custom spacing */
      border-radius: var(--radius-full);
      /* Rounded search bar */
      border: 1px solid var(--border);
      transition: var(--transition-base);
    }

    .search-bar:focus-within {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px hsl(var(--primary-hue), var(--primary-saturation), var(--primary-lightness), 0.3);
    }

    .search-bar i {
      color: var(--muted);
      margin-right: var(--spacing-2);
      font-size: var(--font-size-sm);
    }

    .search-bar input {
      border: none;
      background-color: transparent;
      outline: none;
      color: var(--foreground);
      font-size: var(--font-size-sm);
      min-width: 200px;
      /* Lebar minimal search input */
    }

    .search-bar input::placeholder {
      color: var(--muted-foreground);
    }

    .profile-dropdown {
      position: relative;
    }

    .profile-dropdown-toggle {
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
      cursor: pointer;
      padding: var(--spacing-2);
      border-radius: var(--radius-md);
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-medium);
      transition: background-color var(--transition-fast);
    }

    .profile-dropdown-toggle:hover {
      background-color: var(--secondary);
    }

    .profile-dropdown-toggle i {
      font-size: var(--font-size-lg);
      color: var(--primary);
    }

    .profile-dropdown-menu {
      position: absolute;
      top: calc(100% + var(--spacing-1));
      right: 0;
      background-color: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      min-width: 200px;
      z-index: 1010;
      opacity: 0;
      visibility: hidden;
      transform: translateY(10px);
      transition: opacity var(--transition-fast), visibility var(--transition-fast), transform var(--transition-fast);
    }

    .profile-dropdown-menu.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .profile-dropdown-item {
      display: flex;
      /* Agar ikon dan teks sejajar */
      align-items: center;
      gap: var(--spacing-2);
      padding: var(--spacing-2) var(--spacing-3);
      color: var(--foreground);
      text-decoration: none;
      font-size: var(--font-size-sm);
      transition: background-color var(--transition-fast), color var(--transition-fast);
    }

    .profile-dropdown-item i {
      width: 16px;
      text-align: center;
      color: var(--muted);
      transition: color var(--transition-fast);
    }

    .profile-dropdown-item:hover {
      background-color: var(--primary-light);
      color: var(--primary-dark);
      /* Atau white jika kontras lebih baik */
    }

    .profile-dropdown-item:hover i {
      color: var(--primary-dark);
      /* Atau white */
    }

    .profile-dropdown-divider {
      height: 1px;
      background-color: var(--border);
      margin: var(--spacing-1) 0;
    }

    .theme-toggle-btn {
      cursor: pointer;
      padding: var(--spacing-2);
      background-color: var(--secondary);
      border-radius: var(--radius-full);
      border: 1px solid var(--border);
      color: var(--foreground);
      font-size: var(--font-size-lg);
      transition: var(--transition-base);
    }

    .theme-toggle-btn:hover {
      background-color: var(--border);
      border-color: var(--muted);
    }

    /* Main Content Area */
    .main-content {
      padding: var(--container-padding);
      flex-grow: 1;
      /* Konten mengisi sisa ruang vertikal */
      max-width: var(--content-max-width);
      margin-left: auto;
      margin-right: auto;
      width: 100%;
    }

    .page {
      /* Styling untuk setiap halaman/section konten */
      animation: fadeIn 0.5s ease-out;
      /* Animasi masuk halaman */
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .page h2 {
      font-family: var(--font-secondary);
      font-size: var(--font-size-2xl);
      font-weight: var(--font-weight-bold);
      margin-bottom: var(--spacing-4);
      color: var(--primary-dark);
    }

    [data-theme="dark"] .page h2 {
      color: var(--primary-light);
    }

    .page p {
      margin-bottom: var(--spacing-3);
      color: var(--muted);
    }

    /* Grid Statistik */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      /* Responsif */
      gap: var(--spacing-4);
      margin-bottom: var(--spacing-5);
    }

    /* Card Component */
    .card {
      background-color: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      padding: var(--spacing-4);
      transition: transform var(--transition-base), box-shadow var(--transition-base),
        background-color var(--transition-base), border-color var(--transition-base);
      overflow: hidden;
      /* Untuk border-radius pada image di dalam card */
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .card-header {
      margin-bottom: var(--spacing-3);
      padding-bottom: var(--spacing-3);
      border-bottom: 1px solid var(--border);
    }

    .card-title,
    .card h3 {
      font-family: var(--font-secondary);
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-semibold);
      color: var(--card-foreground);
      margin-bottom: var(--spacing-1);
    }

    .card p {
      font-size: var(--font-size-sm);
      color: var(--muted);
    }

    .stats-grid .card h3 {
      font-size: var(--font-size-sm);
      color: var(--muted);
      font-weight: var(--font-weight-medium);
      margin-bottom: var(--spacing-1);
    }

    .stats-grid .card p[data-stat] {
      font-size: var(--font-size-2xl);
      font-weight: var(--font-weight-bold);
      color: var(--primary);
      margin-bottom: 0;
    }

    [data-theme="dark"] .stats-grid .card p[data-stat] {
      color: var(--primary-light);
    }

    /* Grid Apartemen */
    .apartments-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      /* Responsif */
      gap: var(--spacing-4);
      margin-top: var(--spacing-4);
    }

    .apartment-card img {
      width: 100%;
      height: 200px;
      /* Tinggi gambar konsisten */
      object-fit: cover;
      /* Gambar mengisi area tanpa distorsi */
      border-radius: var(--radius-md);
      /* Radius di gambar jika tidak ada .card-img-top */
      margin-bottom: var(--spacing-3);
      border: 1px solid var(--border);
      /* Border halus pada gambar */
    }

    .apartment-card .card-body {
      padding: 0;
      /* Hapus padding default jika ada, atau sesuaikan */
    }

    .apartment-card h3 {
      /* Judul apartemen */
      font-size: var(--font-size-lg);
      margin-bottom: var(--spacing-1);
    }

    .apartment-card p {
      /* Deskripsi singkat */
      font-size: var(--font-size-sm);
      margin-bottom: var(--spacing-0-5);
    }

    .apartment-card .price {
      font-weight: var(--font-weight-semibold);
      color: var(--primary);
      margin-bottom: var(--spacing-2);
    }

    /* Filter Section */
    .filter-section {
      display: flex;
      flex-wrap: wrap;
      /* Agar filter pindah baris di layar kecil */
      gap: var(--spacing-3);
      margin-bottom: var(--spacing-4);
      padding: var(--spacing-3);
      background-color: var(--secondary);
      border-radius: var(--radius-lg);
    }

    .filter-section select,
    .filter-section .btn {
      padding: var(--spacing-2) var(--spacing-3);
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background-color: var(--card);
      font-size: var(--font-size-sm);
      min-width: 150px;
      /* Agar select tidak terlalu kecil */
    }

    .filter-section select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px hsl(var(--primary-hue), var(--primary-saturation), var(--primary-lightness), 0.2);
    }

    /* Table Styling */
    .table-container {
      overflow-x: auto;
      /* Scroll horizontal untuk tabel di layar kecil */
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      background-color: var(--card);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      /* Gabungkan border sel */
    }

    th,
    td {
      padding: var(--spacing-3) var(--spacing-4);
      text-align: left;
      border-bottom: 1px solid var(--border);
      font-size: var(--font-size-sm);
    }

    th {
      /* Header tabel */
      background-color: var(--primary-light);
      color: var(--primary-dark);
      font-weight: var(--font-weight-semibold);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    [data-theme="dark"] th {
      background-color: hsl(var(--primary-hue), var(--primary-saturation), calc(var(--primary-lightness) * 0.3));
      color: var(--primary-light);
    }

    tr:last-child td {
      border-bottom: none;
      /* Hapus border bawah di baris terakhir */
    }

    tr:hover {
      background-color: var(--secondary);
      /* Efek hover pada baris tabel */
    }

    [data-theme="dark"] tr:hover {
      background-color: hsl(var(--secondary-hue), var(--secondary-saturation), calc(var(--secondary-lightness) * 1.2));
    }

    /* Badge Component */
    .badge {
      display: inline-block;
      padding: var(--spacing-0-5) var(--spacing-2);
      border-radius: var(--radius-full);
      /* Badge bulat */
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-semibold);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: white;
      /* Default teks putih untuk kontras */
    }

    .badge.active {
      background-color: var(--success);
    }

    .badge.pending {
      background-color: var(--warning);
      color: var(--foreground);
    }

    /* Kuning mungkin butuh teks gelap */
    .badge.due {
      background-color: var(--danger);
    }

    .badge.info {
      background-color: var(--info);
    }


    /* Modal Component */
    .modal-overlay {
      /* Backdrop untuk modal */
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: hsla(0, 0%, 0%, 0.6);
      /* Hitam transparan */
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1100;
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition-base), visibility var(--transition-base);
    }

    .modal-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .modal-dialog {
      max-width: 550px;
      /* Lebar maksimum modal */
      width: calc(100% - var(--spacing-6));
      /* Responsif dengan padding di sisi */
      transform: translateY(-20px) scale(0.95);
      transition: transform var(--transition-base);
    }

    .modal-overlay.show .modal-dialog {
      transform: translateY(0) scale(1);
    }

    .modal-content {
      background-color: var(--card);
      border-radius: var(--radius-xl);
      /* Radius lebih besar untuk modal */
      box-shadow: var(--shadow-xl);
      padding: var(--spacing-5);
      position: relative;
      /* Untuk tombol close */
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-4);
      padding-bottom: var(--spacing-3);
      border-bottom: 1px solid var(--border);
    }

    .modal-title {
      font-family: var(--font-secondary);
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-semibold);
      color: var(--card-foreground);
    }

    .btn-close-modal {
      /* Tombol close di dalam modal */
      background: transparent;
      border: none;
      font-size: var(--font-size-xl);
      color: var(--muted);
      cursor: pointer;
      padding: var(--spacing-1);
      line-height: 1;
      /* Hapus spasi ekstra */
    }

    .btn-close-modal:hover {
      color: var(--danger);
    }

    .modal-body {
      margin-bottom: var(--spacing-4);
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      /* Tombol di kanan */
      gap: var(--spacing-2);
      padding-top: var(--spacing-3);
      border-top: 1px solid var(--border);
    }

    /* Form Elements Styling */
    .form-group {
      margin-bottom: var(--spacing-3);
    }

    .form-label {
      font-weight: var(--font-weight-medium);
      margin-bottom: var(--spacing-1);
      display: block;
      font-size: var(--font-size-sm);
      color: var(--card-foreground);
    }

    .form-control {
      width: 100%;
      padding: var(--spacing-2) var(--spacing-3);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      background-color: var(--background);
      /* Background berbeda dari card agar terlihat */
      color: var(--foreground);
      font-size: var(--font-size-sm);
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
    }

    [data-theme="dark"] .form-control {
      background-color: var(--secondary);
      /* Lebih gelap dari card di dark mode */
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px hsl(var(--primary-hue), var(--primary-saturation), var(--primary-lightness), 0.3);
    }

    .form-control.is-invalid {
      /* Untuk validasi error */
      border-color: var(--danger);
    }

    .form-control.is-invalid:focus {
      box-shadow: 0 0 0 3px hsla(var(--danger-hue, 0), 84%, 60%, 0.3);
      /* Perlu definisikan --danger-hue jika tidak ada */
    }

    .invalid-feedback {
      display: none;
      /* Sembunyikan default */
      font-size: var(--font-size-xs);
      color: var(--danger);
      margin-top: var(--spacing-1);
    }

    .form-control.is-invalid+.invalid-feedback {
      display: block;
      /* Tampilkan jika invalid */
    }

    /* Button Component */
    .btn {
      display: inline-flex;
      /* Agar ikon dan teks align */
      align-items: center;
      justify-content: center;
      gap: var(--spacing-1-5, 0.375rem);
      padding: var(--spacing-2) var(--spacing-4);
      border-radius: var(--radius-md);
      border: 1px solid transparent;
      cursor: pointer;
      transition: var(--transition-fast);
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-medium);
      text-decoration: none;
      /* Untuk link yang di-style sebagai button */
      white-space: nowrap;
      /* Mencegah teks button wrap */
    }

    .btn i {
      /* Ikon dalam button */
      font-size: inherit;
      /* Ukuran ikon mengikuti teks */
    }

    .btn-primary {
      background-color: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .btn-primary:hover {
      background-color: var(--primary-dark);
      border-color: var(--primary-dark);
      transform: translateY(-1px);
      box-shadow: 0 2px 4px hsla(0, 0%, 0%, 0.1);
    }

    .btn-secondary {
      background-color: var(--secondary);
      color: var(--foreground);
      border-color: var(--border);
    }

    .btn-secondary:hover {
      background-color: var(--border);
      border-color: var(--muted-foreground);
    }

    .btn-danger {
      background-color: var(--danger);
      color: white;
      border-color: var(--danger);
    }

    .btn-danger:hover {
      background-color: hsl(0, 70%, 50%);
      /* Sedikit lebih gelap dari danger */
      border-color: hsl(0, 70%, 50%);
    }

    .btn-sm {
      /* Button kecil */
      padding: var(--spacing-1) var(--spacing-2);
      font-size: var(--font-size-xs);
    }

    .btn-lg {
      /* Button besar */
      padding: var(--spacing-3) var(--spacing-5);
      font-size: var(--font-size-base);
    }

    .btn-block {
      width: 100%;
      display: block;
    }

    /* Notification Toast Component */
    .notification-toast-container {
      position: fixed;
      top: var(--spacing-4);
      right: var(--spacing-4);
      z-index: 1200;
      display: flex;
      flex-direction: column;
      gap: var(--spacing-2);
    }

    .notification-toast {
      background-color: var(--card);
      border: 1px solid var(--border);
      border-left-width: 5px;
      /* Border kiri sebagai indikator tipe */
      padding: var(--spacing-3);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: flex-start;
      /* Agar close button align dengan baik */
      gap: var(--spacing-2);
      min-width: 280px;
      max-width: 350px;
      opacity: 0;
      transform: translateX(100%);
      transition: opacity var(--transition-slow), transform var(--transition-slow);
    }

    .notification-toast.show {
      opacity: 1;
      transform: translateX(0);
    }

    .notification-toast-icon {
      font-size: var(--font-size-lg);
      margin-top: var(--spacing-0-5);
      /* Sedikit penyesuaian vertikal */
    }

    .notification-toast-content {
      flex-grow: 1;
    }

    .notification-toast-title {
      font-weight: var(--font-weight-semibold);
      font-size: var(--font-size-base);
      margin-bottom: var(--spacing-0-5);
    }

    .notification-toast-body {
      font-size: var(--font-size-sm);
      color: var(--muted);
    }

    .btn-close-toast {
      background: transparent;
      border: none;
      font-size: var(--font-size-lg);
      color: var(--muted);
      cursor: pointer;
      padding: var(--spacing-0-5);
      line-height: 1;
      margin-left: auto;
      /* Dorong ke kanan */
    }

    .btn-close-toast:hover {
      color: var(--foreground);
    }

    /* Variasi Toast berdasarkan tipe */
    .notification-toast.info {
      border-left-color: var(--info);
    }

    .notification-toast.info .notification-toast-icon {
      color: var(--info);
    }

    .notification-toast.success {
      border-left-color: var(--success);
    }

    .notification-toast.success .notification-toast-icon {
      color: var(--success);
    }

    .notification-toast.warning {
      border-left-color: var(--warning);
    }

    .notification-toast.warning .notification-toast-icon {
      color: var(--warning);
    }

    .notification-toast.danger {
      border-left-color: var(--danger);
    }

    .notification-toast.danger .notification-toast-icon {
      color: var(--danger);
    }

    /* Splash Screen */
    .splash-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--background);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      transition: opacity 0.7s ease-out, visibility 0.7s ease-out;
      color: var(--primary);
    }

    .splash-screen.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      /* Agar tidak bisa diklik saat tersembunyi */
    }

    .splash-logo {
      font-size: calc(var(--font-size-3xl) * 2);
      /* Logo lebih besar */
      margin-bottom: var(--spacing-3);
      animation: pulse 2s infinite ease-in-out;
    }

    @keyframes pulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.1);
      }
    }

    .splash-screen h1 {
      font-family: var(--font-secondary);
      font-size: var(--font-size-2xl);
      font-weight: var(--font-weight-bold);
      margin-bottom: var(--spacing-1);
    }

    .splash-screen p {
      font-size: var(--font-size-lg);
      color: var(--muted);
    }

    /* Tabs Component */
    .tabs-list {
      display: flex;
      gap: var(--spacing-1);
      /* Spasi antar tab trigger */
      margin-bottom: var(--spacing-4);
      border-bottom: 2px solid var(--border);
    }

    .tab-trigger {
      padding: var(--spacing-2) var(--spacing-4);
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-medium);
      color: var(--muted);
      cursor: pointer;
      transition: var(--transition-fast);
      border-bottom: 3px solid transparent;
      /* Indikator aktif */
      position: relative;
      bottom: -2px;
      /* Agar border bawah menyatu dengan border tabs-list */
    }

    .tab-trigger:hover {
      color: var(--primary);
    }

    .tab-trigger.active {
      color: var(--primary);
      font-weight: var(--font-weight-semibold);
      border-bottom-color: var(--primary);
    }

    .tab-content {
      display: none;
      /* Defaultnya tersembunyi */
      animation: fadeIn 0.3s ease-out;
    }

    .tab-content.active {
      display: block;
      /* Tampilkan konten tab aktif */
    }

    /* Footer Aplikasi */
    .app-footer {
      padding: var(--spacing-4) var(--container-padding);
      border-top: 1px solid var(--border);
      background-color: var(--card);
      margin-top: auto;
      /* Dorong footer ke bawah jika konten pendek */
    }

    .app-footer small {
      color: var(--muted);
      font-size: var(--font-size-sm);
    }

    /* Responsivitas */
    @media (max-width: 991.98px) {

      /* Tablet dan Mobile */
      .app-container {
        grid-template-columns: 1fr;
        /* Hanya main content, sidebar overlay */
      }

      .sidebar {
        transform: translateX(-100%);
        /* Sembunyikan sidebar by default */
        box-shadow: var(--shadow-lg);
        /* Shadow saat sidebar terbuka di mobile */
      }

      .sidebar.show {
        /* Kelas untuk menampilkan sidebar */
        transform: translateX(0);
      }

      .main-wrapper {
        grid-column: 1 / 2;
        /* Main wrapper mengambil seluruh kolom */
        margin-left: 0;
        /* Hapus margin kiri dari sidebar */
      }

      .sidebar-toggle-btn {
        display: block;
        /* Tampilkan tombol toggle sidebar */
      }

      .search-bar input {
        min-width: 150px;
        /* Kurangi lebar search input */
      }

      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }

      .apartments-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        /* Atau 1fr untuk full width di mobile */
      }

      .filter-section {
        flex-direction: column;
        /* Filter jadi vertikal */
        align-items: stretch;
        /* Agar select full width */
      }

      .filter-section select,
      .filter-section .btn {
        width: 100%;
        /* Full width */
      }

      .app-header {
        padding: 0 var(--spacing-3);
      }

      .main-content {
        padding: var(--spacing-3);
      }
    }

    @media (max-width: 575.98px) {

      /* Mobile Kecil */
      :root {
        /* Ukuran font lebih kecil di mobile */
        --font-size-base: clamp(0.9rem, 0.85rem + 0.5vw, 1rem);
      }

      .stats-grid {
        grid-template-columns: 1fr;
        /* Satu kartu per baris */
      }

      .apartments-grid {
        grid-template-columns: 1fr;
        /* Satu kartu per baris */
      }

      .profile-dropdown-toggle span {
        /* Sembunyikan nama di mobile kecil, hanya ikon */
        display: none;
      }

      .modal-dialog {
        width: calc(100% - var(--spacing-4));
        /* Modal lebih sempit */
      }

      .splash-logo {
        font-size: calc(var(--font-size-3xl) * 1.5);
      }

      .splash-screen h1 {
        font-size: var(--font-size-xl);
      }

      .splash-screen p {
        font-size: var(--font-size-base);
      }
    }

    /* Gaya untuk Cetak */
    @media print {
      body {
        background-color: white;
        color: black;
        font-size: 10pt;
        /* Ukuran font umum untuk cetak */
      }

      .sidebar,
      .app-header,
      .notification-toast-container,
      .modal-overlay,
      .app-footer,
      .filter-section,
      .tabs-list,
      .btn {
        display: none !important;
        /* Sembunyikan elemen yang tidak relevan untuk cetak */
      }

      .main-wrapper,
      .main-content,
      .page {
        margin: 0 !important;
        padding: 0 !important;
        width: 100% !important;
        max-width: 100% !important;
        box-shadow: none !important;
        border: none !important;
      }

      .card {
        box-shadow: none !important;
        border: 1px solid #ccc !important;
        page-break-inside: avoid;
        /* Hindari card terpotong antar halaman */
      }

      table,
      th,
      td {
        border: 1px solid #ccc !important;
        font-size: 9pt;
      }

      th {
        background-color: #eee !important;
        color: black !important;
      }

      a {
        text-decoration: none;
        color: black;
      }

      img {
        max-width: 100% !important;
        /* Pastikan gambar tidak overflow */
      }
    }
  </style>
</head>

<body>
  <!-- Splash Screen: Tampilan awal saat aplikasi dimuat -->
  <div class="splash-screen" id="splashScreen" aria-live="polite" aria-atomic="true">
    <div class="splash-logo" aria-hidden="true"><i class="fas fa-city"></i></div>
    <h1>RentEase</h1>
    <p>Platform Sewa Apartemen Terpercaya</p>
  </div>

  <!-- Container Utama Aplikasi -->
  <div class="app-container" id="appContainer" style="display: none;">
    <!-- Sidebar Navigasi Utama -->
    <aside class="sidebar" id="appSidebar" aria-label="Navigasi Utama">
      <div class="sidebar-brand">
        <i class="fas fa-city" aria-hidden="true"></i>
        <span>RentEase</span>
      </div>
      <nav>
        <ul class="nav-menu">
          <li class="nav-item"><a href="#dashboard" class="nav-link active" data-page="dashboard"><i
                class="fas fa-tachometer-alt fa-fw" aria-hidden="true"></i> Beranda</a></li>
          <li class="nav-item"><a href="#apartemen" class="nav-link" data-page="apartemen"><i
                class="fas fa-building fa-fw" aria-hidden="true"></i> Apartemen</a></li>
          <li class="nav-item"><a href="#riwayat" class="nav-link" data-page="riwayat"><i class="fas fa-history fa-fw"
                aria-hidden="true"></i> Riwayat Sewa</a></li>
          <li class="nav-item"><a href="#pembayaran" class="nav-link" data-page="pembayaran"><i
                class="fas fa-credit-card fa-fw" aria-hidden="true"></i> Pembayaran</a></li>
          <li class="nav-item"><a href="#notifikasi" class="nav-link" data-page="notifikasi"><i
                class="fas fa-bell fa-fw" aria-hidden="true"></i> Notifikasi <span class="badge info"
                id="notificationCount" style="display:none;">0</span></a></li>
          <li class="nav-item"><a href="#pengaturan" class="nav-link" data-page="pengaturan"><i class="fas fa-cog fa-fw"
                aria-hidden="true"></i> Pengaturan</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Wrapper Konten Utama (Header + Main Content) -->
    <div class="main-wrapper" id="mainWrapper">
      <!-- Header Aplikasi -->
      <header class="app-header">
        <div class="header-left">
          <button class="sidebar-toggle-btn" id="sidebarToggleBtn" aria-label="Buka/Tutup Navigasi"
            aria-expanded="false" aria-controls="appSidebar">
            <i class="fas fa-bars"></i>
          </button>
          <div class="search-bar">
            <i class="fas fa-search" aria-hidden="true"></i>
            <input type="search" id="mainSearchInput" placeholder="Cari apartemen, lokasi..."
              aria-label="Pencarian apartemen">
          </div>
        </div>
        <div class="header-right">
          <div class="profile-dropdown">
            <button class="profile-dropdown-toggle" id="profileDropdownToggle" aria-haspopup="true"
              aria-expanded="false" aria-controls="profileDropdownMenu">
              <i class="fas fa-user-circle" aria-hidden="true"></i>
              <span>John Doe</span> <!-- Nama Pengguna -->
              <i class="fas fa-chevron-down fa-xs" aria-hidden="true"></i> <!-- Indikator dropdown -->
            </button>
            <div class="profile-dropdown-menu" id="profileDropdownMenu" role="menu"
              aria-labelledby="profileDropdownToggle">
              <a href="#profil" class="profile-dropdown-item" role="menuitem"><i class="fas fa-user-edit fa-fw"
                  aria-hidden="true"></i> Profil Saya</a>
              <a href="#bantuan" class="profile-dropdown-item" role="menuitem"><i class="fas fa-question-circle fa-fw"
                  aria-hidden="true"></i> Pusat Bantuan</a>
              <div class="profile-dropdown-divider" role="separator"></div>
              <a href="#logout" id="logoutBtn" class="profile-dropdown-item" role="menuitem"><i
                  class="fas fa-sign-out-alt fa-fw" aria-hidden="true"></i> Keluar</a>
            </div>
          </div>
          <button class="theme-toggle-btn" id="themeToggleBtn" aria-label="Ganti Tema">
            <i class="fas fa-moon" aria-hidden="true"></i> <!-- Ikon akan diubah oleh JS -->
          </button>
        </div>
      </header>

      <!-- Konten Utama Halaman (SPA) -->
      <main class="main-content" id="pageContentContainer" role="main">
        <!-- Halaman Beranda -->
        <section id="dashboardPage" class="page active" aria-labelledby="dashboardTitle">
          <h2 id="dashboardTitle">Beranda Analitik</h2>
          <p>Selamat datang kembali, John Doe! Kelola penyewaan apartemen Anda dengan lebih efisien.</p>
          <div class="stats-grid">
            <div class="card">
              <h3>Apartemen Disewa</h3>
              <p data-stat="activeApartments" id="statActiveApartments">0</p>
            </div>
            <div class="card">
              <h3>Pembayaran Mendatang</h3>
              <p data-stat="upcomingPayments" id="statUpcomingPayments">0</p>
            </div>
            <div class="card">
              <h3>Notifikasi Baru</h3>
              <p data-stat="newNotifications" id="statNewNotifications">0</p>
            </div>
            <div class="card">
              <h3>Total Pengeluaran (Bulan Ini)</h3>
              <p data-stat="totalExpenses" id="statTotalExpenses">Rp 0</p>
            </div>
          </div>
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h3 class="card-title">Aktivitas Terbaru</h3>
              <button class="btn btn-primary btn-sm" id="addActivityBtn"><i class="fas fa-plus"></i> Tambah
                Aktivitas</button>
            </div>
            <div class="table-container">
              <table aria-label="Tabel Aktivitas Terbaru">
                <thead>
                  <tr>
                    <th scope="col">Tanggal</th>
                    <th scope="col">Apartemen</th>
                    <th scope="col">Aktivitas</th>
                    <th scope="col">Status</th>
                    <th scope="col">Aksi</th>
                  </tr>
                </thead>
                <tbody id="activityTableBody">
                  <!-- Data aktivitas akan dimuat oleh JavaScript -->
                  <tr>
                    <td colspan="5" class="text-center">Belum ada aktivitas.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Halaman Apartemen -->
        <section id="apartemenPage" class="page" style="display: none;" aria-labelledby="apartemenTitle">
          <h2 id="apartemenTitle">Daftar Apartemen Saya</h2>
          <div class="filter-section">
            <select id="filterPriceRange" aria-label="Filter Rentang Harga">
              <option value="">Semua Harga</option>
              <option value="0-5000000">Rp 0 - 5jt</option>
              <option value="5000001-10000000">Rp 5jt - 10jt</option>
              <option value="10000001-max">Diatas Rp 10jt</option>
            </select>
            <select id="filterBedrooms" aria-label="Filter Jumlah Kamar Tidur">
              <option value="">Semua Kamar</option>
              <option value="1">1 Kamar Tidur</option>
              <option value="2">2 Kamar Tidur</option>
              <option value="3">3+ Kamar Tidur</option>
            </select>
            <select id="filterLocation" aria-label="Filter Lokasi">
              <option value="">Semua Lokasi</option>
              <option value="Jakarta Pusat">Jakarta Pusat</option>
              <option value="Jakarta Barat">Jakarta Barat</option>
              <option value="Jakarta Selatan">Jakarta Selatan</option>
            </select>
            <button class="btn btn-primary" id="applyFilterBtn"><i class="fas fa-filter"></i> Terapkan Filter</button>
            <button class="btn btn-secondary" id="resetFilterBtn"><i class="fas fa-undo"></i> Reset Filter</button>
          </div>
          <div class="tabs">
            <div class="tabs-list" role="tablist" aria-label="Kategori Apartemen">
              <button class="tab-trigger active" id="tab-semua-apartemen" data-tab="semua-apartemen" role="tab"
                aria-selected="true" aria-controls="panel-semua-apartemen">Semua (<span
                  id="countSemuaApartemen">0</span>)</button>
              <button class="tab-trigger" id="tab-aktif-apartemen" data-tab="aktif-apartemen" role="tab"
                aria-selected="false" aria-controls="panel-aktif-apartemen">Aktif (<span
                  id="countAktifApartemen">0</span>)</button>
              <button class="tab-trigger" id="tab-selesai-apartemen" data-tab="selesai-apartemen" role="tab"
                aria-selected="false" aria-controls="panel-selesai-apartemen">Selesai (<span
                  id="countSelesaiApartemen">0</span>)</button>
            </div>
            <div class="tab-content active" id="panel-semua-apartemen" role="tabpanel"
              aria-labelledby="tab-semua-apartemen">
              <div class="apartments-grid" id="allApartmentsGrid">
                <!-- Data apartemen akan dimuat oleh JavaScript -->
                <p class="text-center" style="grid-column: 1 / -1;">Memuat data apartemen...</p>
              </div>
            </div>
            <div class="tab-content" id="panel-aktif-apartemen" role="tabpanel" aria-labelledby="tab-aktif-apartemen"
              style="display:none;">
              <div class="apartments-grid" id="activeApartmentsGrid">
                <p class="text-center" style="grid-column: 1 / -1;">Tidak ada apartemen aktif.</p>
              </div>
            </div>
            <div class="tab-content" id="panel-selesai-apartemen" role="tabpanel"
              aria-labelledby="tab-selesai-apartemen" style="display:none;">
              <div class="apartments-grid" id="finishedApartmentsGrid">
                <p class="text-center" style="grid-column: 1 / -1;">Tidak ada apartemen yang telah selesai disewa.</p>
              </div>
            </div>
          </div>

          <h3 style="margin-top: var(--spacing-5); margin-bottom: var(--spacing-3);">Baru Dilihat</h3>
          <div class="apartments-grid" id="recentlyViewedGrid">
            <p class="text-center" style="grid-column: 1 / -1;">Anda belum melihat apartemen apapun.</p>
          </div>
        </section>

        <!-- Halaman Riwayat Sewa -->
        <section id="riwayatPage" class="page" style="display: none;" aria-labelledby="riwayatTitle">
          <h2 id="riwayatTitle">Riwayat Penyewaan</h2>
          <div class="card">
            <h3 class="card-title">Daftar Lengkap Riwayat Sewa Anda</h3>
            <div class="table-container">
              <table aria-label="Tabel Riwayat Sewa">
                <thead>
                  <tr>
                    <th scope="col">ID Sewa</th>
                    <th scope="col">Nama Apartemen</th>
                    <th scope="col">Tanggal Mulai</th>
                    <th scope="col">Tanggal Selesai</th>
                    <th scope="col">Status</th>
                    <th scope="col">Total Biaya</th>
                  </tr>
                </thead>
                <tbody id="rentalHistoryTableBody">
                  <tr>
                    <td colspan="6" class="text-center">Belum ada riwayat sewa.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Halaman Pembayaran -->
        <section id="pembayaranPage" class="page" style="display: none;" aria-labelledby="pembayaranTitle">
          <h2 id="pembayaranTitle">Manajemen Pembayaran</h2>
          <div class="card">
            <h3 class="card-title">Riwayat Transaksi Pembayaran</h3>
            <div class="table-container">
              <table aria-label="Tabel Riwayat Pembayaran">
                <thead>
                  <tr>
                    <th scope="col">ID Transaksi</th>
                    <th scope="col">Tanggal</th>
                    <th scope="col">Deskripsi</th>
                    <th scope="col">Jumlah</th>
                    <th scope="col">Status</th>
                    <th scope="col">Metode</th>
                  </tr>
                </thead>
                <tbody id="paymentHistoryTableBody">
                  <tr>
                    <td colspan="6" class="text-center">Belum ada riwayat pembayaran.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Halaman Notifikasi -->
        <section id="notifikasiPage" class="page" style="display: none;" aria-labelledby="notifikasiTitle">
          <h2 id="notifikasiTitle">Pusat Notifikasi</h2>
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h3 class="card-title">Daftar Notifikasi Anda</h3>
              <button class="btn btn-secondary btn-sm" id="markAllNotificationsReadBtn">
                <i class="fas fa-check-double"></i> Tandai Semua Dibaca
              </button>
            </div>
            <ul class="list-group" id="notificationListContainer" style="list-style: none; padding: 0;">
              <!-- Notifikasi akan dimuat oleh JavaScript -->
              <li class="list-group-item text-center">Tidak ada notifikasi baru.</li>
            </ul>
          </div>
        </section>

        <!-- Halaman Pengaturan -->
        <section id="pengaturanPage" class="page" style="display: none;" aria-labelledby="pengaturanTitle">
          <h2 id="pengaturanTitle">Pengaturan Akun & Preferensi</h2>
          <div class="card">
            <h3 class="card-title">Informasi Akun</h3>
            <form id="accountSettingsForm">
              <div class="form-group">
                <label for="profileName" class="form-label">Nama Lengkap</label>
                <input type="text" class="form-control" id="profileName" value="John Doe" required>
              </div>
              <div class="form-group">
                <label for="profileEmail" class="form-label">Alamat Email</label>
                <input type="email" class="form-control" id="profileEmail" value="john.doe@example.com" required>
              </div>
              <div class="form-group">
                <label for="profilePhone" class="form-label">Nomor Telepon</label>
                <input type="tel" class="form-control" id="profilePhone" value="081234567890">
              </div>
              <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Simpan Perubahan</button>
            </form>
          </div>
          <div class="card" style="margin-top: var(--spacing-4);">
            <h3 class="card-title">Preferensi Notifikasi</h3>
            <div class="form-group">
              <input type="checkbox" id="emailNotifications" checked>
              <label for="emailNotifications"> Terima notifikasi email untuk pembaruan penting.</label>
            </div>
            <div class="form-group">
              <input type="checkbox" id="pushNotifications">
              <label for="pushNotifications"> Aktifkan notifikasi push (jika didukung).</label>
            </div>
          </div>
        </section>
      </main>

      <!-- Footer Aplikasi -->
      <footer class="app-footer text-center">
        <small>&copy; <span id="currentYear">2024</span> RentEase. Hak Cipta Dilindungi Undang-Undang. Dirancang dengan
          <i class="fas fa-heart" style="color: var(--danger);"></i> untuk kemudahan Anda.</small>
      </footer>
    </div>
  </div>

  <!-- Modal untuk Tambah/Edit Booking/Aktivitas -->
  <div class="modal-overlay" id="bookingModal" aria-labelledby="bookingModalLabel" aria-hidden="true" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="bookingForm" novalidate>
          <input type="hidden" id="bookingId"> <!-- Untuk mode edit -->
          <div class="modal-header">
            <h5 class="modal-title" id="bookingModalLabel">Tambah Booking Baru</h5>
            <button type="button" class="btn-close-modal" data-dismiss="modal" aria-label="Tutup Modal">
              <i class="fas fa-times" aria-hidden="true"></i>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="tenantName" class="form-label">Nama Penyewa <span aria-hidden="true"
                  style="color:var(--danger)">*</span></label>
              <input type="text" class="form-control" id="tenantName" placeholder="Masukkan nama penyewa" required>
              <div class="invalid-feedback">Nama penyewa wajib diisi.</div>
            </div>
            <div class="form-group">
              <label for="apartmentName" class="form-label">Nama Apartemen <span aria-hidden="true"
                  style="color:var(--danger)">*</span></label>
              <input type="text" class="form-control" id="apartmentName" placeholder="Contoh: The Peak Apartment"
                required>
              <div class="invalid-feedback">Nama apartemen wajib diisi.</div>
            </div>
            <div class="form-group">
              <label for="bookingDate" class="form-label">Tanggal Booking <span aria-hidden="true"
                  style="color:var(--danger)">*</span></label>
              <input type="date" class="form-control" id="bookingDate" required>
              <div class="invalid-feedback">Tanggal booking wajib diisi.</div>
            </div>
            <div class="form-group">
              <label for="bookingStatus" class="form-label">Status Booking <span aria-hidden="true"
                  style="color:var(--danger)">*</span></label>
              <select id="bookingStatus" class="form-control" required>
                <option value="Aktif">Aktif</option>
                <option value="Tertunda">Tertunda</option>
                <option value="Selesai">Selesai</option>
                <option value="Batal">Dibatalkan</option>
              </select>
              <div class="invalid-feedback">Status booking wajib dipilih.</div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Batal</button>
            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Simpan Booking</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Kontainer untuk Notifikasi Toast -->
  <div class="notification-toast-container" id="notificationToastContainer" aria-live="assertive" aria-atomic="true">
    <!-- Toast akan ditambahkan oleh JavaScript di sini -->
  </div>

  <script>
    // Melindungi scope variabel dan fungsi, best practice untuk vanilla JS
    (function () {
      'use strict'; // Mengaktifkan mode ketat JavaScript untuk kualitas kode yang lebih baik

      /**
       * @typedef {Object} AppState
       * @property {string} currentTheme - Tema saat ini ('light' atau 'dark').
       * @property {boolean} isSidebarOpen - Status sidebar (terbuka/tertutup).
       * @property {string} activePage - Halaman yang sedang aktif.
       * @property {string} activeTabApartemen - Tab aktif di halaman apartemen.
       * @property {Array<Object>} bookings - Data booking/aktivitas.
       * @property {Array<Object>} apartments - Data apartemen.
       * @property {Array<Object>} recentlyViewed - Data apartemen yang baru dilihat.
       * @property {Array<Object>} notifications - Data notifikasi.
       * @property {string|null} editingBookingId - ID booking yang sedang diedit.
       * @property {Object} stats - Data statistik untuk dashboard.
       */

      /** @type {AppState} */
      const AppState = {
        currentTheme: localStorage.getItem('rentease-theme') || 'light',
        isSidebarOpen: window.innerWidth >= 992,
        activePage: 'dashboard',
        activeTabApartemen: 'semua-apartemen',
        bookings: [
          // Data contoh, idealnya dari API
          { id: 'bk001', tenantName: 'Sarah Wijayanti', apartmentName: 'Taman Anggrek Residence', date: '2024-05-27', status: 'Aktif' },
          { id: 'bk002', tenantName: 'Riko Ramadhan', apartmentName: 'Sudirman Park Tower A', date: '2024-05-26', status: 'Tertunda' },
          { id: 'bk003', tenantName: 'Lina Marlina', apartmentName: 'Kemang Village View', date: '2024-04-15', status: 'Selesai' },
        ],
        apartments: [ // Data contoh apartemen
          { id: 'apt001', name: 'Taman Anggrek Residence', location: 'Jakarta Barat', price: 8500000, bedrooms: 2, image: 'https://via.placeholder.com/400x250/87CEEB/000000?text=Apartemen+Mewah', status: 'Aktif', rating: 4.5, facilities: ['Kolam Renang', 'Gym', 'Parkir'] },
          { id: 'apt002', name: 'Sudirman Park Tower A', location: 'Jakarta Pusat', price: 6200000, bedrooms: 1, image: 'https://via.placeholder.com/400x250/90EE90/000000?text=Apartemen+Nyaman', status: 'Aktif', rating: 4.2, facilities: ['Keamanan 24 Jam', 'Minimarket'] },
          { id: 'apt003', name: 'Kemang Village View', location: 'Jakarta Selatan', price: 12000000, bedrooms: 3, image: 'https://via.placeholder.com/400x250/FFB6C1/000000?text=Apartemen+Luas', status: 'Selesai', rating: 4.8, facilities: ['Akses Mall', 'Jogging Track'] },
          { id: 'apt004', name: 'Bassura City Tower Cattleya', location: 'Jakarta Timur', price: 4500000, bedrooms: 1, image: 'https://via.placeholder.com/400x250/DDA0DD/000000?text=Apartemen+Modern', status: 'Aktif', rating: 4.0, facilities: ['Food Court', 'Kolam Anak'] }
        ],
        recentlyViewed: JSON.parse(localStorage.getItem('rentease-recentlyViewed')) || [],
        notifications: [
          { id: 'notif001', title: 'Pembayaran Berhasil', message: 'Pembayaran untuk sewa Taman Anggrek Residence telah dikonfirmasi.', date: new Date().toISOString(), read: false, type: 'success' },
          { id: 'notif002', title: 'Sewa Segera Berakhir', message: 'Sewa Anda untuk Sudirman Park Tower A akan berakhir dalam 7 hari.', date: new Date(Date.now() - 86400000).toISOString(), read: true, type: 'warning' },
        ],
        editingBookingId: null,
        stats: { activeApartments: 0, upcomingPayments: 0, newNotifications: 0, totalExpenses: 0 }
      };

      // Cache elemen DOM yang sering digunakan untuk performa
      const DOM = {
        html: document.documentElement,
        body: document.body,
        splashScreen: document.getElementById('splashScreen'),
        appContainer: document.getElementById('appContainer'),
        sidebar: document.getElementById('appSidebar'),
        sidebarToggleBtn: document.getElementById('sidebarToggleBtn'),
        mainWrapper: document.getElementById('mainWrapper'),
        themeToggleBtn: document.getElementById('themeToggleBtn'),
        profileDropdownToggle: document.getElementById('profileDropdownToggle'),
        profileDropdownMenu: document.getElementById('profileDropdownMenu'),

        // Modal Booking
        bookingModal: document.getElementById('bookingModal'),
        bookingForm: document.getElementById('bookingForm'),
        bookingModalLabel: document.getElementById('bookingModalLabel'),
        bookingIdInput: document.getElementById('bookingId'),
        tenantNameInput: document.getElementById('tenantName'),
        apartmentNameInput: document.getElementById('apartmentName'), // Dulu apartmentNumber
        bookingDateInput: document.getElementById('bookingDate'),
        bookingStatusInput: document.getElementById('bookingStatus'),
        addActivityBtn: document.getElementById('addActivityBtn'),

        // Halaman Dashboard
        activityTableBody: document.getElementById('activityTableBody'),
        statActiveApartments: document.getElementById('statActiveApartments'),
        statUpcomingPayments: document.getElementById('statUpcomingPayments'),
        statNewNotifications: document.getElementById('statNewNotifications'),
        statTotalExpenses: document.getElementById('statTotalExpenses'),

        // Halaman Apartemen
        applyFilterBtn: document.getElementById('applyFilterBtn'),
        resetFilterBtn: document.getElementById('resetFilterBtn'),
        allApartmentsGrid: document.getElementById('allApartmentsGrid'),
        activeApartmentsGrid: document.getElementById('activeApartmentsGrid'),
        finishedApartmentsGrid: document.getElementById('finishedApartmentsGrid'),
        recentlyViewedGrid: document.getElementById('recentlyViewedGrid'),
        countSemuaApartemen: document.getElementById('countSemuaApartemen'),
        countAktifApartemen: document.getElementById('countAktifApartemen'),
        countSelesaiApartemen: document.getElementById('countSelesaiApartemen'),
        filterPriceRange: document.getElementById('filterPriceRange'),
        filterBedrooms: document.getElementById('filterBedrooms'),
        filterLocation: document.getElementById('filterLocation'),


        // Halaman Riwayat
        rentalHistoryTableBody: document.getElementById('rentalHistoryTableBody'),
        // Halaman Pembayaran
        paymentHistoryTableBody: document.getElementById('paymentHistoryTableBody'),
        // Halaman Notifikasi
        notificationListContainer: document.getElementById('notificationListContainer'),
        notificationCountBadge: document.getElementById('notificationCount'),
        markAllNotificationsReadBtn: document.getElementById('markAllNotificationsReadBtn'),
        // Halaman Pengaturan
        accountSettingsForm: document.getElementById('accountSettingsForm'),

        // Lainnya
        notificationToastContainer: document.getElementById('notificationToastContainer'),
        currentYearSpan: document.getElementById('currentYear'),
        navLinks: document.querySelectorAll('.nav-link'),
        pageSections: document.querySelectorAll('.page'), // Dulu 'sections'
        tabTriggers: document.querySelectorAll('.tab-trigger'),
        tabContents: document.querySelectorAll('.tab-content'),
        logoutBtn: document.getElementById('logoutBtn'),
      };

      // Objek utama aplikasi
      const App = {
        init() {
          if (!this.validateDOM()) return; // Validasi elemen DOM esensial

          this.applyTheme(AppState.currentTheme, true); // Terapkan tema dari localStorage
          this.updateCurrentYear();
          this.setupEventListeners();

          // Navigasi awal berdasarkan hash atau default ke dashboard
          const initialHash = window.location.hash || '#dashboard';
          this.navigateTo(initialHash, true);

          this.renderAllData(); // Render data awal
          this.updateDashboardStats(); // Update statistik
          this.updateNotificationCount(); // Update jumlah notifikasi

          this.showSplashScreen(); // Tampilkan splash screen, lalu sembunyikan

          console.info('RentEase Application Initialized Successfully. Welcome!');
        },

        validateDOM() {
          // Periksa apakah semua elemen DOM yang penting telah ditemukan
          const essentialDOMs = ['splashScreen', 'appContainer', 'sidebar', 'mainWrapper', 'pageContentContainer'];
          for (const key of essentialDOMs) {
            if (!DOM[key]) {
              console.error(`Critical DOM element '${key}' not found. Application cannot start.`);
              // Mungkin tampilkan pesan error ke pengguna di sini jika splashScreen tidak ada
              if (DOM.splashScreen) DOM.splashScreen.innerHTML = '<p style="color:red; text-align:center; padding:20px;">Error: Aplikasi tidak dapat dimuat. Elemen penting hilang.</p>';
              return false;
            }
          }
          return true;
        },

        setupEventListeners() {
          // Event listener global
          window.addEventListener('hashchange', () => this.navigateTo(window.location.hash || '#dashboard'));
          window.addEventListener('resize', Utility.debounce(() => this.handleResize(), 200)); // Debounce untuk performa
          document.addEventListener('click', (e) => this.handleGlobalClick(e)); // Untuk menutup dropdown/modal
          document.addEventListener('keydown', (e) => this.handleGlobalKeydown(e)); // Untuk Esc pada modal

          // Event listener spesifik elemen
          DOM.themeToggleBtn?.addEventListener('click', () => this.toggleTheme());
          DOM.sidebarToggleBtn?.addEventListener('click', () => this.toggleSidebar());
          DOM.profileDropdownToggle?.addEventListener('click', (e) => {
            e.stopPropagation(); // Hindari global click handler menutup ini langsung
            this.toggleProfileDropdown();
          });
          DOM.logoutBtn?.addEventListener('click', (e) => {
            e.preventDefault();
            this.logout();
          });

          // Navigasi utama
          DOM.navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
              e.preventDefault();
              const targetPage = link.getAttribute('href');
              this.navigateTo(targetPage);
              if (window.innerWidth < 992 && AppState.isSidebarOpen) {
                this.closeSidebar();
              }
            });
          });

          // Tabs di halaman Apartemen
          DOM.tabTriggers.forEach(trigger => {
            trigger.addEventListener('click', () => this.switchApartmentTab(trigger.dataset.tab));
          });

          // Form Booking/Aktivitas
          DOM.bookingForm?.addEventListener('submit', (e) => this.handleBookingFormSubmit(e));
          DOM.addActivityBtn?.addEventListener('click', () => this.openBookingModal());

          // Tombol dismiss modal (semua tombol dengan atribut data-dismiss="modal")
          document.querySelectorAll('[data-dismiss="modal"]').forEach(btn => {
            btn.addEventListener('click', () => {
              const modalId = btn.closest('.modal-overlay')?.id || btn.closest('.modal-dialog')?.parentElement.id;
              if (modalId === DOM.bookingModal.id) this.closeBookingModal();
              // Tambahkan else if untuk modal lain jika ada
            });
          });

          // Filter di halaman Apartemen
          DOM.applyFilterBtn?.addEventListener('click', () => this.renderApartments());
          DOM.resetFilterBtn?.addEventListener('click', () => {
            DOM.filterPriceRange.value = "";
            DOM.filterBedrooms.value = "";
            DOM.filterLocation.value = "";
            this.renderApartments();
            this.showNotification('Filter direset.', 'Info', 'info');
          });

          // Halaman pengaturan
          DOM.accountSettingsForm?.addEventListener('submit', (e) => this.handleAccountSettingsSubmit(e));

          // Halaman Notifikasi
          DOM.markAllNotificationsReadBtn?.addEventListener('click', () => this.markAllNotificationsAsRead());
          DOM.notificationListContainer?.addEventListener('click', (e) => { // Event delegation
            if (e.target.closest('.mark-notif-read-btn')) {
              const notifId = e.target.closest('.notification-item').dataset.id;
              this.markNotificationAsRead(notifId);
            }
          });
        },

        renderAllData() {
          // Panggil semua fungsi render yang diperlukan saat inisialisasi atau perubahan data besar
          this.renderBookingsTable();
          this.renderApartments(); // Ini juga akan memanggil renderRecentlyViewed
          this.renderRentalHistory();
          this.renderPaymentHistory();
          this.renderNotifications();
        },

        // --- Splash Screen Logic ---
        showSplashScreen() {
          DOM.appContainer.style.display = 'none'; // Sembunyikan konten utama dulu
          DOM.splashScreen.classList.remove('hidden');

          // Simulasi waktu loading
          setTimeout(() => {
            DOM.splashScreen.classList.add('hidden');
            // Setelah splash screen hilang, tampilkan container aplikasi
            // Transisi display none ke block tidak bisa di CSS, jadi pakai timeout kecil
            DOM.splashScreen.addEventListener('transitionend', () => {
              DOM.appContainer.style.display = 'grid'; // Atau 'block' jika tidak pakai grid di level ini
            }, { once: true });

          }, 1500); // Durasi splash screen (misal 1.5 detik)
        },

        // --- Theme Logic ---
        applyTheme(theme, instant = false) {
          DOM.html.setAttribute('data-theme', theme);
          DOM.themeToggleBtn.innerHTML = `<i class="fas fa-${theme === 'light' ? 'moon' : 'sun'}" aria-hidden="true"></i>`;
          DOM.themeToggleBtn.setAttribute('aria-label', `Ganti ke tema ${theme === 'light' ? 'Gelap' : 'Terang'}`);
          AppState.currentTheme = theme;
          localStorage.setItem('rentease-theme', theme);

          if (!instant) { // Tambahkan transisi sementara untuk body agar smooth
            DOM.body.style.transition = 'background-color 0.3s ease, color 0.3s ease';
            setTimeout(() => DOM.body.style.transition = '', 300);
          }
        },
        toggleTheme() {
          const newTheme = AppState.currentTheme === 'light' ? 'dark' : 'light';
          this.applyTheme(newTheme);
          this.showNotification(`Tema diubah ke ${newTheme === 'light' ? 'Terang' : 'Gelap'}.`, 'Sukses', 'success');
        },

        // --- Sidebar Logic ---
        toggleSidebar() {
          AppState.isSidebarOpen = !AppState.isSidebarOpen;
          DOM.sidebar.classList.toggle('show', AppState.isSidebarOpen);
          DOM.sidebarToggleBtn.setAttribute('aria-expanded', AppState.isSidebarOpen.toString());
          // Untuk mobile, cegah scroll body saat sidebar terbuka
          if (window.innerWidth < 992) {
            DOM.body.style.overflow = AppState.isSidebarOpen ? 'hidden' : '';
          }
        },
        closeSidebar() {
          if (AppState.isSidebarOpen) { // Hanya tutup jika terbuka
            AppState.isSidebarOpen = false;
            DOM.sidebar.classList.remove('show');
            DOM.sidebarToggleBtn.setAttribute('aria-expanded', 'false');
            if (window.innerWidth < 992) {
              DOM.body.style.overflow = '';
            }
          }
        },
        handleResize() {
          // Atur ulang state sidebar berdasarkan ukuran window
          if (window.innerWidth >= 992) {
            AppState.isSidebarOpen = true; // Sidebar selalu ada di desktop
            DOM.sidebar.classList.remove('collapsed'); // Hapus collapsed jika ada
            DOM.sidebar.classList.add('show'); // Pastikan show
            DOM.sidebarToggleBtn.setAttribute('aria-expanded', 'true');
            DOM.body.style.overflow = ''; // Pastikan body bisa scroll
            DOM.mainWrapper.style.marginLeft = DOM.sidebar.offsetWidth + 'px'; // Untuk layout grid
            DOM.appContainer.style.gridTemplateColumns = `${DOM.sidebar.offsetWidth}px 1fr`;

          } else { // Untuk mobile/tablet
            // Jika sidebar sedang terbuka, biarkan terbuka. Jika tidak, pastikan tersembunyi.
            if (!AppState.isSidebarOpen) { // Jika user menutupnya manual sebelumnya
              this.closeSidebar(); // Gunakan fungsi closeSidebar
            }
            DOM.sidebar.classList.add('collapsed');
            DOM.mainWrapper.style.marginLeft = '0';
            DOM.appContainer.style.gridTemplateColumns = `1fr`;
          }
        },


        // --- Profile Dropdown Logic ---
        toggleProfileDropdown() {
          const isShown = DOM.profileDropdownMenu.classList.toggle('show');
          DOM.profileDropdownToggle.setAttribute('aria-expanded', isShown.toString());
        },
        closeProfileDropdown() {
          if (DOM.profileDropdownMenu.classList.contains('show')) {
            DOM.profileDropdownMenu.classList.remove('show');
            DOM.profileDropdownToggle.setAttribute('aria-expanded', 'false');
          }
        },

        // --- SPA Navigation Logic ---
        navigateTo(hash, isInitialLoad = false) {
          this.closeProfileDropdown(); // Tutup dropdown saat navigasi
          if (window.innerWidth < 992) this.closeSidebar(); // Tutup sidebar di mobile saat navigasi

          const pageId = (hash.startsWith('#') ? hash.substring(1) : hash) || 'dashboard';

          if (AppState.activePage === pageId && !isInitialLoad) return; // Jangan navigasi ke halaman yang sama

          AppState.activePage = pageId;
          if (!isInitialLoad) {
            window.location.hash = pageId; // Update hash jika bukan load awal
          }

          // Sembunyikan semua halaman, lalu tampilkan yang aktif
          DOM.pageSections.forEach(section => {
            const isActive = section.id === `${pageId}Page`;
            section.style.display = isActive ? 'block' : 'none';
            section.classList.toggle('active', isActive);
            if (isActive) {
              section.setAttribute('aria-hidden', 'false');
              // Fokus ke judul halaman untuk aksesibilitas
              const pageTitle = section.querySelector('h2');
              pageTitle?.focus(); // Pastikan h2 punya tabindex="-1" jika belum fokusabel
            } else {
              section.setAttribute('aria-hidden', 'true');
            }
          });

          // Update link navigasi aktif
          DOM.navLinks.forEach(link => {
            link.classList.toggle('active', link.getAttribute('data-page') === pageId);
            link.setAttribute('aria-current', link.getAttribute('data-page') === pageId ? 'page' : 'false');
          });

          // Logika spesifik per halaman setelah navigasi (jika perlu)
          // Contoh: if (pageId === 'apartemen') this.renderApartments();
          // Atau panggil fungsi render umum jika data mungkin berubah
          this.renderAllData();
          this.updateDashboardStats(); // selalu update stats saat navigasi
        },

        // --- Apartment Tabs Logic ---
        switchApartmentTab(tabId) {
          if (AppState.activeTabApartemen === tabId) return;

          AppState.activeTabApartemen = tabId;
          DOM.tabTriggers.forEach(trigger => {
            const isActive = trigger.dataset.tab === tabId;
            trigger.classList.toggle('active', isActive);
            trigger.setAttribute('aria-selected', isActive.toString());
          });
          DOM.tabContents.forEach(content => {
            const isActive = content.id === `panel-${tabId}`;
            content.style.display = isActive ? 'block' : 'none'; // Ganti dari class 'active' ke display
            content.classList.toggle('active', isActive); // Tetap pakai class active untuk styling lain jika ada
            content.setAttribute('aria-hidden', (!isActive).toString());
          });
          // Render ulang apartemen berdasarkan tab yang aktif (jika filter berbeda per tab)
          this.renderApartments();
        },

        // --- Notification Logic ---
        showNotification(message, title = 'Notifikasi', type = 'info', duration = 5000) {
          // type bisa 'info', 'success', 'warning', 'danger'
          const toastId = 'toast-' + Date.now();
          const toast = document.createElement('div');
          toast.className = `notification-toast ${type}`;
          toast.id = toastId;
          toast.setAttribute('role', 'alert');
          toast.setAttribute('aria-live', 'assertive'); // Penting untuk screen reader

          const iconClass = {
            info: 'fa-circle-info',
            success: 'fa-check-circle',
            warning: 'fa-exclamation-triangle',
            danger: 'fa-times-circle'
          }[type];

          toast.innerHTML = `
                        <i class="fas ${iconClass} notification-toast-icon" aria-hidden="true"></i>
                        <div class="notification-toast-content">
                            <strong class="notification-toast-title">${Utility.sanitize(title)}</strong>
                            <p class="notification-toast-body">${Utility.sanitize(message)}</p>
                        </div>
                        <button class="btn-close-toast" aria-label="Tutup Notifikasi">&times;</button>
                    `;

          DOM.notificationToastContainer.appendChild(toast);

          // Trigger animasi masuk
          requestAnimationFrame(() => {
            toast.classList.add('show');
          });

          const closeButton = toast.querySelector('.btn-close-toast');
          closeButton.addEventListener('click', () => this.hideNotification(toastId));

          if (duration > 0) {
            setTimeout(() => this.hideNotification(toastId), duration);
          }
        },
        hideNotification(toastId) {
          const toast = document.getElementById(toastId);
          if (toast) {
            toast.classList.remove('show');
            // Hapus elemen dari DOM setelah transisi selesai
            toast.addEventListener('transitionend', () => toast.remove(), { once: true });
          }
        },
        renderNotifications() {
          if (!DOM.notificationListContainer) return;
          DOM.notificationListContainer.innerHTML = '';
          if (AppState.notifications.length === 0) {
            DOM.notificationListContainer.innerHTML = '<li class="list-group-item text-center" style="padding: var(--spacing-3); border: none;">Tidak ada notifikasi.</li>';
            return;
          }

          AppState.notifications.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(notif => {
            const item = document.createElement('li');
            item.className = `notification-item d-flex align-items-center gap-3 p-3 border-bottom ${notif.read ? 'read' : 'unread'}`;
            item.style.backgroundColor = notif.read ? 'transparent' : 'var(--secondary)';
            item.dataset.id = notif.id;

            const iconClass = {
              info: 'fa-circle-info text-info',
              success: 'fa-check-circle text-success',
              warning: 'fa-exclamation-triangle text-warning',
              danger: 'fa-times-circle text-danger'
            }[notif.type || 'info'];

            item.innerHTML = `
                            <i class="fas ${iconClass} fa-lg" aria-hidden="true"></i>
                            <div class="flex-grow-1">
                                <h6 class="mb-1" style="font-weight: ${notif.read ? 'normal' : 'bold'};">${Utility.sanitize(notif.title)}</h6>
                                <p class="mb-1 small text-muted">${Utility.sanitize(notif.message)}</p>
                                <small class="text-muted">${Utility.timeAgo(notif.date)}</small>
                            </div>
                            ${!notif.read ? `<button class="btn btn-sm btn-outline-primary mark-notif-read-btn" aria-label="Tandai sebagai sudah dibaca: ${notif.title}">Dibaca</button>` : ''}
                        `;
            DOM.notificationListContainer.appendChild(item);
          });
          this.updateNotificationCount();
        },
        markNotificationAsRead(notifId) {
          const notif = AppState.notifications.find(n => n.id === notifId);
          if (notif && !notif.read) {
            notif.read = true;
            this.renderNotifications(); // Re-render
            this.updateNotificationCount();
            this.showNotification(`Notifikasi "${notif.title}" ditandai sudah dibaca.`, 'Info', 'info', 2000);
          }
        },
        markAllNotificationsAsRead() {
          let markedCount = 0;
          AppState.notifications.forEach(notif => {
            if (!notif.read) {
              notif.read = true;
              markedCount++;
            }
          });
          if (markedCount > 0) {
            this.renderNotifications();
            this.updateNotificationCount();
            this.showNotification('Semua notifikasi ditandai sudah dibaca.', 'Info', 'info');
          } else {
            this.showNotification('Tidak ada notifikasi baru untuk ditandai.', 'Info', 'info', 2000);
          }
        },
        updateNotificationCount() {
          const unreadCount = AppState.notifications.filter(n => !n.read).length;
          DOM.statNewNotifications.textContent = unreadCount; // Untuk dashboard
          if (DOM.notificationCountBadge) {
            DOM.notificationCountBadge.textContent = unreadCount;
            DOM.notificationCountBadge.style.display = unreadCount > 0 ? 'inline-block' : 'none';
          }
        },

        // --- Booking/Activity Logic ---
        renderBookingsTable() {
          if (!DOM.activityTableBody) return; // Pastikan elemen ada
          DOM.activityTableBody.innerHTML = ''; // Kosongkan tabel sebelum mengisi

          if (AppState.bookings.length === 0) {
            DOM.activityTableBody.innerHTML = `<tr><td colspan="5" class="text-center p-4">Belum ada aktivitas booking. Klik 'Tambah Aktivitas' untuk memulai.</td></tr>`;
            return;
          }

          // Urutkan berdasarkan tanggal terbaru
          const sortedBookings = [...AppState.bookings].sort((a, b) => new Date(b.date) - new Date(a.date));

          sortedBookings.forEach(booking => {
            const row = DOM.activityTableBody.insertRow();
            row.innerHTML = `
                            <td>${Utility.formatDate(booking.date)}</td>
                            <td>${Utility.sanitize(booking.apartmentName)}</td>
                            <td>Booking oleh ${Utility.sanitize(booking.tenantName)}</td>
                            <td><span class="badge ${booking.status.toLowerCase()}">${Utility.sanitize(booking.status)}</span></td>
                            <td>
                                <button class="btn btn-sm btn-secondary edit-booking-btn" data-id="${booking.id}" aria-label="Edit booking ${booking.apartmentName}"><i class="fas fa-edit"></i></button>
                                <button class="btn btn-sm btn-danger delete-booking-btn" data-id="${booking.id}" aria-label="Hapus booking ${booking.apartmentName}"><i class="fas fa-trash"></i></button>
                            </td>
                        `;
            // Tambahkan event listener untuk tombol edit dan hapus
            row.querySelector('.edit-booking-btn').addEventListener('click', (e) => this.openBookingModal(e.currentTarget.dataset.id));
            row.querySelector('.delete-booking-btn').addEventListener('click', (e) => this.deleteBooking(e.currentTarget.dataset.id));
          });
        },
        handleBookingFormSubmit(event) {
          event.preventDefault();
          if (!DOM.bookingForm.checkValidity()) { // Gunakan HTML5 form validation API
            // Tampilkan error kustom jika perlu atau biarkan browser menangani
            DOM.bookingForm.classList.add('was-validated'); // Bootstrap-like class untuk styling error
            this.showNotification('Harap lengkapi semua field yang wajib diisi dengan benar.', 'Validasi Gagal', 'warning');
            // Fokus ke input pertama yang invalid
            const firstInvalid = DOM.bookingForm.querySelector(':invalid');
            firstInvalid?.focus();
            return;
          }

          const bookingData = {
            id: DOM.bookingIdInput.value || 'bk' + Date.now().toString().slice(-7), // ID baru jika kosong
            tenantName: DOM.tenantNameInput.value.trim(),
            apartmentName: DOM.apartmentNameInput.value.trim(),
            date: DOM.bookingDateInput.value,
            status: DOM.bookingStatusInput.value
          };

          if (AppState.editingBookingId) { // Mode Edit
            const index = AppState.bookings.findIndex(b => b.id === AppState.editingBookingId);
            if (index !== -1) {
              AppState.bookings[index] = bookingData;
              this.showNotification(`Booking untuk ${bookingData.apartmentName} berhasil diperbarui.`, 'Sukses', 'success');
            }
          } else { // Mode Tambah
            AppState.bookings.unshift(bookingData); // Tambah ke awal array
            this.showNotification(`Booking baru untuk ${bookingData.apartmentName} berhasil ditambahkan.`, 'Sukses', 'success');
          }

          this.renderBookingsTable();
          this.updateDashboardStats();
          this.closeBookingModal();
        },
        openBookingModal(bookingId = null) {
          DOM.bookingForm.reset(); // Reset form
          DOM.bookingForm.classList.remove('was-validated'); // Hapus kelas validasi
          Utility.clearFormValidation(DOM.bookingForm); // Bersihkan pesan error manual jika ada

          if (bookingId) { // Mode Edit
            const booking = AppState.bookings.find(b => b.id === bookingId);
            if (!booking) {
              this.showNotification('Data booking tidak ditemukan.', 'Error', 'danger');
              return;
            }
            AppState.editingBookingId = bookingId;
            DOM.bookingModalLabel.textContent = 'Edit Booking';
            DOM.bookingIdInput.value = booking.id;
            DOM.tenantNameInput.value = booking.tenantName;
            DOM.apartmentNameInput.value = booking.apartmentName;
            DOM.bookingDateInput.value = booking.date;
            DOM.bookingStatusInput.value = booking.status;
          } else { // Mode Tambah
            AppState.editingBookingId = null;
            DOM.bookingModalLabel.textContent = 'Tambah Booking Baru';
            DOM.bookingIdInput.value = ''; // Kosongkan ID
            // Set tanggal default ke hari ini
            DOM.bookingDateInput.valueAsDate = new Date();
          }

          DOM.bookingModal.classList.add('show');
          DOM.bookingModal.setAttribute('aria-hidden', 'false');
          DOM.body.style.overflow = 'hidden'; // Cegah scroll background
          DOM.tenantNameInput.focus(); // Fokus ke input pertama
        },
        closeBookingModal() {
          DOM.bookingModal.classList.remove('show');
          DOM.bookingModal.setAttribute('aria-hidden', 'true');
          DOM.body.style.overflow = ''; // Kembalikan scroll background
          AppState.editingBookingId = null; // Reset ID edit
        },
        deleteBooking(bookingId) {
          const booking = AppState.bookings.find(b => b.id === bookingId);
          if (!booking) return;

          // Konfirmasi sebelum hapus
          if (confirm(`Apakah Anda yakin ingin menghapus booking untuk "${Utility.sanitize(booking.apartmentName)}"?`)) {
            AppState.bookings = AppState.bookings.filter(b => b.id !== bookingId);
            this.renderBookingsTable();
            this.updateDashboardStats();
            this.showNotification(`Booking untuk ${Utility.sanitize(booking.apartmentName)} berhasil dihapus.`, 'Sukses', 'success');
          }
        },

        // --- Apartment Listing & Filter Logic ---
        renderApartments() {
          // Dapatkan nilai filter
          const priceFilter = DOM.filterPriceRange.value;
          const bedroomFilter = parseInt(DOM.filterBedrooms.value) || 0;
          const locationFilter = DOM.filterLocation.value;

          let filteredApartments = AppState.apartments.filter(apt => {
            let matchPrice = true;
            if (priceFilter) {
              const [min, maxStr] = priceFilter.split('-');
              const max = maxStr === 'max' ? Infinity : parseInt(maxStr);
              matchPrice = apt.price >= parseInt(min) && apt.price <= max;
            }
            const matchBedrooms = bedroomFilter ? (bedroomFilter === 3 ? apt.bedrooms >= 3 : apt.bedrooms === bedroomFilter) : true;
            const matchLocation = locationFilter ? apt.location === locationFilter : true;

            return matchPrice && matchBedrooms && matchLocation;
          });

          // Render ke grid yang sesuai dengan tab aktif
          if (DOM.allApartmentsGrid) this.populateApartmentGrid(DOM.allApartmentsGrid, filteredApartments, 'semua-apartemen');
          if (DOM.activeApartmentsGrid) this.populateApartmentGrid(DOM.activeApartmentsGrid, filteredApartments.filter(a => a.status === 'Aktif'), 'aktif-apartemen');
          if (DOM.finishedApartmentsGrid) this.populateApartmentGrid(DOM.finishedApartmentsGrid, filteredApartments.filter(a => a.status === 'Selesai'), 'selesai-apartemen');

          // Update count di tab
          DOM.countSemuaApartemen.textContent = filteredApartments.length;
          DOM.countAktifApartemen.textContent = filteredApartments.filter(a => a.status === 'Aktif').length;
          DOM.countSelesaiApartemen.textContent = filteredApartments.filter(a => a.status === 'Selesai').length;

          this.renderRecentlyViewed(); // Selalu render recently viewed setelah render apartemen
        },
        populateApartmentGrid(gridElement, apartments, tabContext) {
          if (!gridElement) return;
          gridElement.innerHTML = ''; // Kosongkan grid

          if (AppState.activeTabApartemen !== tabContext) return; // Hanya render jika tabnya aktif

          if (apartments.length === 0) {
            gridElement.innerHTML = `<p class="text-center" style="grid-column: 1 / -1; padding: var(--spacing-4);">Tidak ada apartemen yang sesuai dengan filter atau kriteria ini.</p>`;
            return;
          }

          apartments.forEach(apt => {
            const card = document.createElement('div');
            card.className = 'apartment-card card'; // Kelas card umum dan spesifik
            card.dataset.id = apt.id;
            card.innerHTML = `
                            <img src="${Utility.sanitize(apt.image)}" alt="Tampilan ${Utility.sanitize(apt.name)}">
                            <div class="card-body">
                                <h3>${Utility.sanitize(apt.name)}</h3>
                                <p><i class="fas fa-map-marker-alt fa-fw text-muted"></i> ${Utility.sanitize(apt.location)}</p>
                                <p><i class="fas fa-bed fa-fw text-muted"></i> ${apt.bedrooms} Kamar Tidur</p>
                                <p class="price"><i class="fas fa-tags fa-fw text-muted"></i> ${Utility.formatCurrency(apt.price)}/bulan</p>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-primary btn-sm detail-apt-btn" data-id="${apt.id}"><i class="fas fa-eye"></i> Detail</button>
                                    <button class="btn btn-secondary btn-sm save-apt-btn" data-id="${apt.id}" aria-label="Simpan ${apt.name}"><i class="far fa-heart"></i> Simpan</button>
                                </div>
                            </div>
                        `;
            // Event listener untuk tombol detail & simpan (gunakan event delegation di parent jika banyak)
            card.querySelector('.detail-apt-btn').addEventListener('click', (e) => this.viewApartmentDetail(e.currentTarget.dataset.id));
            card.querySelector('.save-apt-btn').addEventListener('click', (e) => this.toggleSaveApartment(e.currentTarget.dataset.id, e.currentTarget));

            gridElement.appendChild(card);
          });
        },
        viewApartmentDetail(apartmentId) {
          const apartment = AppState.apartments.find(apt => apt.id === apartmentId);
          if (!apartment) return;

          this.addToRecentlyViewed(apartment);
          // Untuk SPA sejati, ini akan navigasi ke halaman detail apartemen.
          // Untuk contoh ini, kita tampilkan notifikasi saja.
          this.showNotification(`Membuka detail untuk ${Utility.sanitize(apartment.name)}.`, 'Info', 'info');
          // Implementasi modal detail atau navigasi ke halaman baru:
          // window.location.hash = `apartemen/${apartmentId}`;
        },
        toggleSaveApartment(apartmentId, buttonElement) {
          // Logika untuk menyimpan/membatalkan simpan apartemen (favorit)
          const icon = buttonElement.querySelector('i');
          const isSaved = icon.classList.contains('fas'); // 'fas fa-heart' = saved
          if (isSaved) {
            icon.classList.remove('fas');
            icon.classList.add('far'); // 'far fa-heart' = not saved
            buttonElement.setAttribute('aria-label', `Simpan ${buttonElement.closest('.apartment-card').querySelector('h3').textContent}`);
            this.showNotification('Apartemen dihapus dari favorit.', 'Info', 'info', 2000);
          } else {
            icon.classList.remove('far');
            icon.classList.add('fas');
            buttonElement.setAttribute('aria-label', `Hapus dari favorit: ${buttonElement.closest('.apartment-card').querySelector('h3').textContent}`);
            this.showNotification('Apartemen disimpan ke favorit.', 'Sukses', 'success', 2000);
          }
          // Update state favorit di AppState jika perlu
        },

        // --- Recently Viewed Logic ---
        addToRecentlyViewed(apartment) {
          // Hapus jika sudah ada agar pindah ke depan
          AppState.recentlyViewed = AppState.recentlyViewed.filter(item => item.id !== apartment.id);
          // Tambahkan ke awal array
          AppState.recentlyViewed.unshift({ id: apartment.id, name: apartment.name, image: apartment.image, location: apartment.location });
          // Batasi jumlah item
          if (AppState.recentlyViewed.length > 4) {
            AppState.recentlyViewed.pop();
          }
          localStorage.setItem('rentease-recentlyViewed', JSON.stringify(AppState.recentlyViewed));
          this.renderRecentlyViewed();
        },
        renderRecentlyViewed() {
          if (!DOM.recentlyViewedGrid) return;
          DOM.recentlyViewedGrid.innerHTML = ''; // Kosongkan dulu

          if (AppState.recentlyViewed.length === 0) {
            DOM.recentlyViewedGrid.innerHTML = `<p class="text-center" style="grid-column: 1 / -1; padding: var(--spacing-3);">Anda belum melihat apartemen apapun baru-baru ini.</p>`;
            return;
          }

          AppState.recentlyViewed.forEach(apt => {
            const card = document.createElement('div');
            card.className = 'apartment-card card card-sm'; // card-sm untuk versi lebih kecil jika ada
            card.dataset.id = apt.id;
            card.innerHTML = `
                            <img src="${Utility.sanitize(apt.image)}" alt="Tampilan ${Utility.sanitize(apt.name)}" style="height: 120px;">
                            <div class="card-body" style="padding: var(--spacing-2);">
                                <h4 style="font-size: var(--font-size-sm); margin-bottom: var(--spacing-1);">${Utility.sanitize(apt.name)}</h4>
                                <p style="font-size: var(--font-size-xs);"><i class="fas fa-map-marker-alt fa-fw text-muted"></i> ${Utility.sanitize(apt.location)}</p>
                                <button class="btn btn-primary btn-sm detail-apt-btn mt-2 w-100" data-id="${apt.id}"><i class="fas fa-eye"></i> Lihat Lagi</button>
                            </div>
                        `;
            card.querySelector('.detail-apt-btn').addEventListener('click', (e) => this.viewApartmentDetail(e.currentTarget.dataset.id));
            DOM.recentlyViewedGrid.appendChild(card);
          });
        },

        // --- Dashboard Stats Logic ---
        updateDashboardStats() {
          AppState.stats.activeApartments = AppState.bookings.filter(b => b.status === 'Aktif').length;
          AppState.stats.upcomingPayments = AppState.bookings.filter(b => b.status === 'Tertunda').length; // Asumsi 'Tertunda' = 'Mendatang'
          AppState.stats.newNotifications = AppState.notifications.filter(n => !n.read).length;

          // Simulasi total pengeluaran (bisa dari data payment history)
          const totalPaid = AppState.apartments
            .filter(apt => AppState.bookings.some(b => b.apartmentName === apt.name && (b.status === 'Aktif' || b.status === 'Selesai')))
            .reduce((sum, apt) => sum + apt.price, 0);
          AppState.stats.totalExpenses = totalPaid;

          DOM.statActiveApartments.textContent = AppState.stats.activeApartments;
          DOM.statUpcomingPayments.textContent = AppState.stats.upcomingPayments;
          DOM.statNewNotifications.textContent = AppState.stats.newNotifications;
          DOM.statTotalExpenses.textContent = Utility.formatCurrency(AppState.stats.totalExpenses);
        },

        // --- Dummy Data Rendering for Other Pages ---
        renderRentalHistory() {
          if (!DOM.rentalHistoryTableBody) return;
          DOM.rentalHistoryTableBody.innerHTML = '';
          if (AppState.bookings.length === 0) { // Contoh pakai data booking
            DOM.rentalHistoryTableBody.innerHTML = `<tr><td colspan="6" class="text-center p-4">Tidak ada riwayat sewa.</td></tr>`;
            return;
          }
          AppState.bookings.forEach(b => {
            const apt = AppState.apartments.find(a => a.name === b.apartmentName) || { price: 0 };
            const endDate = new Date(b.date);
            endDate.setMonth(endDate.getMonth() + 1); // Asumsi sewa 1 bulan

            const row = DOM.rentalHistoryTableBody.insertRow();
            row.innerHTML = `
                            <td>${Utility.sanitize(b.id)}</td>
                            <td>${Utility.sanitize(b.apartmentName)}</td>
                            <td>${Utility.formatDate(b.date)}</td>
                            <td>${Utility.formatDate(endDate.toISOString().split('T')[0])}</td>
                            <td><span class="badge ${b.status.toLowerCase()}">${Utility.sanitize(b.status)}</span></td>
                            <td>${Utility.formatCurrency(apt.price)}</td>
                        `;
          });
        },
        renderPaymentHistory() {
          if (!DOM.paymentHistoryTableBody) return;
          DOM.paymentHistoryTableBody.innerHTML = '';
          const payments = AppState.bookings.filter(b => b.status === 'Selesai' || b.status === 'Aktif').map(b => {
            const apt = AppState.apartments.find(a => a.name === b.apartmentName) || { price: 0 };
            return {
              id: 'TRX' + b.id.slice(-4),
              date: b.date,
              description: `Sewa ${b.apartmentName}`,
              amount: apt.price,
              status: 'Lunas',
              method: 'Transfer Bank'
            };
          });

          if (payments.length === 0) {
            DOM.paymentHistoryTableBody.innerHTML = `<tr><td colspan="6" class="text-center p-4">Tidak ada riwayat pembayaran.</td></tr>`;
            return;
          }
          payments.forEach(p => {
            const row = DOM.paymentHistoryTableBody.insertRow();
            row.innerHTML = `
                            <td>${Utility.sanitize(p.id)}</td>
                            <td>${Utility.formatDate(p.date)}</td>
                            <td>${Utility.sanitize(p.description)}</td>
                            <td>${Utility.formatCurrency(p.amount)}</td>
                            <td><span class="badge success">${Utility.sanitize(p.status)}</span></td>
                            <td>${Utility.sanitize(p.method)}</td>
                        `;
          });
        },

        // --- Settings Page Logic ---
        handleAccountSettingsSubmit(event) {
          event.preventDefault();
          // Ambil data dari form
          const name = DOM.accountSettingsForm.querySelector('#profileName').value;
          const email = DOM.accountSettingsForm.querySelector('#profileEmail').value;
          // Lakukan validasi jika perlu
          if (!name || !email) {
            this.showNotification('Nama dan Email tidak boleh kosong.', 'Validasi Gagal', 'warning');
            return;
          }
          // Simpan perubahan (simulasi)
          console.log('Pengaturan disimpan:', { name, email });
          // Update UI jika nama user ditampilkan di tempat lain (misal di header)
          DOM.profileDropdownToggle.querySelector('span').textContent = Utility.sanitize(name);
          this.showNotification('Pengaturan akun berhasil disimpan.', 'Sukses', 'success');
        },

        // --- Global Event Handlers ---
        handleGlobalClick(event) {
          // Tutup dropdown profil jika klik di luar
          if (DOM.profileDropdownMenu && !DOM.profileDropdownMenu.contains(event.target) && !DOM.profileDropdownToggle.contains(event.target)) {
            this.closeProfileDropdown();
          }
          // Bisa ditambahkan untuk menutup modal jika klik di luar modal-content (di overlay)
          if (DOM.bookingModal.classList.contains('show') && event.target === DOM.bookingModal) {
            this.closeBookingModal();
          }
        },
        handleGlobalKeydown(event) {
          // Tutup modal dengan tombol Escape
          if (event.key === 'Escape') {
            if (DOM.bookingModal.classList.contains('show')) {
              this.closeBookingModal();
            }
            // Tambahkan untuk modal lain jika ada
          }
        },

        // --- Utility functions ---
        updateCurrentYear() {
          if (DOM.currentYearSpan) {
            DOM.currentYearSpan.textContent = new Date().getFullYear();
          }
        },
        logout() {
          // Implementasi logika logout
          console.log('Pengguna keluar...');
          // Hapus data sesi/localStorage
          localStorage.removeItem('rentease-theme');
          localStorage.removeItem('rentease-recentlyViewed');
          // Redirect ke halaman login atau tampilkan pesan
          this.showNotification('Anda telah berhasil keluar.', 'Info', 'info', 3000);
          // Untuk SPA sejati, mungkin akan mereset state dan navigasi ke halaman login
          // window.location.href = '/login.html'; // Contoh jika ada halaman login terpisah
          // Untuk demo ini, kita bisa reload saja atau kembali ke dashboard
          setTimeout(() => window.location.reload(), 1000);
        }
      };

      // Namespace untuk fungsi utilitas
      const Utility = {
        sanitize(str) {
          if (typeof str !== 'string') return '';
          const temp = document.createElement('div');
          temp.textContent = str;
          return temp.innerHTML;
        },
        formatCurrency(amount, currency = 'IDR') {
          return new Intl.NumberFormat('id-ID', { style: 'currency', currency: currency, minimumFractionDigits: 0 }).format(amount);
        },
        formatDate(dateString) {
          if (!dateString) return '-';
          const date = new Date(dateString);
          return date.toLocaleDateString('id-ID', { day: '2-digit', month: 'short', year: 'numeric' });
        },
        timeAgo(dateString) {
          const date = new Date(dateString);
          const now = new Date();
          const seconds = Math.round((now - date) / 1000);
          const minutes = Math.round(seconds / 60);
          const hours = Math.round(minutes / 60);
          const days = Math.round(hours / 24);

          if (seconds < 60) return `${seconds} detik lalu`;
          if (minutes < 60) return `${minutes} menit lalu`;
          if (hours < 24) return `${hours} jam lalu`;
          if (days < 7) return `${days} hari lalu`;
          return this.formatDate(dateString); // Jika lebih dari seminggu, tampilkan tanggal biasa
        },
        debounce(func, delay) {
          let timeout;
          return function (...args) {
            const context = this;
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(context, args), delay);
          };
        },
        clearFormValidation(formElement) {
          formElement.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
          formElement.querySelectorAll('.invalid-feedback').forEach(el => el.style.display = 'none');
          formElement.classList.remove('was-validated');
        },
      };

      // Inisialisasi aplikasi setelah DOM sepenuhnya dimuat
      document.addEventListener('DOMContentLoaded', () => App.init());

      // Expose App ke global scope untuk debugging (opsional, hapus untuk production)
      // window.RentEaseApp = App;
      // window.RentEaseState = AppState;

    })();
  </script>
</body>

</html>