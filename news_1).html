<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Platform penyewaan properti Green Valley dengan pencarian lanjutan, pemesanan, dan manajemen pengguna. Dibuat dengan Vanilla HTML, CSS, dan JavaScript sebagai Single Page Application (SPA) modern.">
    <title>Green Valley Property Rentals | Fancy SPA</title>

    <!-- Favicon (contoh, ganti dengan favicon Anda) -->
    <link rel="icon" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/pngs/solid/mountain-sun.png"
        type="image/png">

    <!-- Google Fonts: Inter untuk teks umum, Poppins untuk heading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Font Awesome Icons (Gratis Online) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Bootstrap CSS (Hanya untuk Grid System, beberapa komponen dasar, dan utilities jika diperlukan) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <style>
        /* === :: ROOT VARIABLES & THEME :: === */
        :root {
            --warna-utama: #2E7D32;
            /* Hijau Tua Modern */
            --warna-utama-terang: #4CAF50;
            /* Hijau Cerah */
            --warna-utama-gelap: #1B5E20;
            /* Hijau Sangat Tua */
            --warna-sekunder: #0277BD;
            /* Biru Modern */
            --warna-sekunder-terang: #29B6F6;
            /* Biru Cerah */
            --warna-aksen: #FF8F00;
            /* Oranye Aksen */
            --warna-aksen-terang: #FFCA28;
            /* Kuning Aksen */

            --warna-teks: #212121;
            /* Abu-abu Gelap untuk Teks */
            --warna-teks-sekunder: #616161;
            /* Abu-abu Sedang */
            --warna-teks-terang: #FFFFFF;
            --warna-latar: #F5F5F5;
            /* Abu-abu Sangat Terang untuk Latar Utama */
            --warna-permukaan: #FFFFFF;
            /* Putih untuk Kartu, Modal, dll. */
            --warna-garis: #E0E0E0;
            /* Abu-abu Terang untuk Garis Pemisah */

            --hijau-sukses: #388E3C;
            --merah-bahaya: #D32F2F;
            --kuning-peringatan: #FBC02D;
            --biru-info: #1976D2;

            --font-utama: 'Inter', sans-serif;
            --font-heading: 'Poppins', sans-serif;

            --spasi-xs: 0.25rem;
            /* 4px */
            --spasi-s: 0.5rem;
            /* 8px */
            --spasi-m: 1rem;
            /* 16px */
            --spasi-l: 1.5rem;
            /* 24px */
            --spasi-xl: 2rem;
            /* 32px */
            --spasi-xxl: 3rem;
            /* 48px */

            --radius-kecil: 0.25rem;
            /* 4px */
            --radius-standar: 0.5rem;
            /* 8px */
            --radius-besar: 1rem;
            /* 16px */
            --radius-bulat: 50%;

            --bayangan-lembut: 0 2px 4px rgba(0, 0, 0, 0.05);
            --bayangan-standar: 0 4px 12px rgba(0, 0, 0, 0.1);
            --bayangan-jelas: 0 8px 24px rgba(0, 0, 0, 0.15);

            --transisi-cepat: all 0.2s ease-in-out;
            --transisi-standar: all 0.3s ease-in-out;

            --tinggi-header: 70px;
            --lebar-sidebar: 260px;
            --lebar-sidebar-ciut: 80px;
            /* Untuk potensi sidebar ciut di masa depan */
        }

        /* === :: GLOBAL STYLES & RESETS :: === */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
            /* Base font size */
        }

        body {
            font-family: var(--font-utama);
            background-color: var(--warna-latar);
            color: var(--warna-teks);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            /* Mencegah scroll horizontal yang tidak diinginkan */
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: var(--font-heading);
            font-weight: 600;
            line-height: 1.3;
            color: var(--warna-teks);
            /* Lebih spesifik */
        }

        h1 {
            font-size: 2.25rem;
        }

        h2 {
            font-size: 1.75rem;
        }

        h3 {
            font-size: 1.5rem;
        }

        h4 {
            font-size: 1.25rem;
        }

        h5 {
            font-size: 1rem;
        }

        h6 {
            font-size: 0.875rem;
        }


        a {
            color: var(--warna-utama);
            text-decoration: none;
            transition: var(--transisi-cepat);
        }

        a:hover {
            color: var(--warna-utama-gelap);
            text-decoration: underline;
        }

        img {
            max-width: 100%;
            height: auto;
            display: block;
        }

        button {
            cursor: pointer;
            font-family: inherit;
        }

        input,
        select,
        textarea {
            font-family: inherit;
        }

        /* === :: UTILITIES (FANCY) :: === */
        .gradient-teks {
            background: linear-gradient(90deg, var(--warna-utama), var(--warna-sekunder));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }

        .hover-lift {
            transition: var(--transisi-standar);
        }

        .hover-lift:hover {
            transform: translateY(-5px);
            box-shadow: var(--bayangan-jelas);
        }

        .ikon-teks {
            vertical-align: middle;
            margin-right: var(--spasi-s);
        }

        .ikon-teks-kanan {
            vertical-align: middle;
            margin-left: var(--spasi-s);
        }

        /* === :: LAYOUT STRUCTURE (FANCY GRID & FLEXBOX) :: === */
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .app-header {
            position: sticky;
            top: 0;
            z-index: 1030;
            background-color: var(--warna-permukaan);
            border-bottom: 1px solid var(--warna-garis);
            padding: 0 var(--spasi-l);
            height: var(--tinggi-header);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--bayangan-lembut);
        }

        .app-header .logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--warna-utama);
        }

        .app-header .logo i {
            margin-right: var(--spasi-s);
            font-size: 1.8rem;
            /* Sedikit lebih besar untuk ikon logo */
        }

        .app-header .logo .nama-brand-tebal {
            font-weight: 800;
        }

        .app-header .logo .nama-brand-tipis {
            font-weight: 400;
            color: var(--warna-teks-sekunder);
        }

        .header-nav-actions {
            display: flex;
            align-items: center;
            gap: var(--spasi-m);
        }

        .header-nav-actions .btn-icon {
            background: none;
            border: none;
            color: var(--warna-teks-sekunder);
            font-size: 1.25rem;
            padding: var(--spasi-s);
            border-radius: var(--radius-bulat);
            transition: var(--transisi-cepat);
        }

        .header-nav-actions .btn-icon:hover {
            background-color: var(--warna-latar);
            color: var(--warna-utama);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-bulat);
            object-fit: cover;
            border: 2px solid var(--warna-utama-terang);
            cursor: pointer;
        }

        .app-main-content {
            display: flex;
            flex-grow: 1;
            position: relative;
            /* Untuk sidebar absolut jika diperlukan */
        }

        .app-sidebar {
            width: var(--lebar-sidebar);
            background-color: var(--warna-permukaan);
            border-right: 1px solid var(--warna-garis);
            padding: var(--spasi-l) var(--spasi-m);
            height: calc(100vh - var(--tinggi-header));
            position: sticky;
            top: var(--tinggi-header);
            overflow-y: auto;
            transition: var(--transisi-standar);
            flex-shrink: 0;
            /* Mencegah sidebar menyusut */
        }

        .app-sidebar .nav-link {
            display: flex;
            align-items: center;
            padding: var(--spasi-s) var(--spasi-m);
            margin-bottom: var(--spasi-s);
            border-radius: var(--radius-standar);
            color: var(--warna-teks-sekunder);
            font-weight: 500;
            transition: var(--transisi-cepat);
        }

        .app-sidebar .nav-link .nav-icon {
            width: 24px;
            /* Lebar ikon konsisten */
            margin-right: var(--spasi-m);
            font-size: 1.1rem;
            text-align: center;
        }

        .app-sidebar .nav-link:hover {
            background-color: var(--warna-latar);
            color: var(--warna-utama);
        }

        .app-sidebar .nav-link.active {
            background-color: var(--warna-utama);
            color: var(--warna-teks-terang);
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(46, 125, 50, 0.3);
        }

        .app-sidebar .nav-link.active .nav-icon {
            color: var(--warna-teks-terang);
            /* Pastikan ikon juga berubah warna */
        }

        .app-page-content {
            flex-grow: 1;
            padding: var(--spasi-l);
            overflow-y: auto;
            /* height: calc(100vh - var(--tinggi-header)); Mungkin tidak perlu jika sidebar sticky */
        }

        .app-footer {
            background-color: var(--warna-permukaan);
            border-top: 1px solid var(--warna-garis);
            padding: var(--spasi-m) var(--spasi-l);
            text-align: center;
            color: var(--warna-teks-sekunder);
            font-size: 0.875rem;
        }

        /* === :: PAGE VISIBILITY (SPA) :: === */
        .page {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* === :: COMPONENTS (FANCY DESIGN) :: === */
        .card-fancy {
            background-color: var(--warna-permukaan);
            border: 1px solid var(--warna-garis);
            border-radius: var(--radius-besar);
            box-shadow: var(--bayangan-lembut);
            overflow: hidden;
            /* Untuk gambar di card */
            transition: var(--transisi-standar);
        }

        .card-fancy .card-img-top-fancy {
            width: 100%;
            height: 220px;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .card-fancy:hover .card-img-top-fancy {
            transform: scale(1.05);
        }

        .card-fancy .card-body-fancy {
            padding: var(--spasi-l);
        }

        .card-fancy .card-title-fancy {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: var(--spasi-s);
        }

        .card-fancy .card-text-fancy {
            color: var(--warna-teks-sekunder);
            font-size: 0.9rem;
            margin-bottom: var(--spasi-m);
        }

        .btn-fancy {
            padding: var(--spasi-s) var(--spasi-l);
            border-radius: var(--radius-standar);
            font-weight: 600;
            transition: var(--transisi-cepat);
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spasi-s);
        }

        .btn-fancy-primary {
            background-color: var(--warna-utama);
            color: var(--warna-teks-terang);
        }

        .btn-fancy-primary:hover {
            background-color: var(--warna-utama-gelap);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .btn-fancy-secondary {
            background-color: var(--warna-sekunder);
            color: var(--warna-teks-terang);
        }

        .btn-fancy-secondary:hover {
            background-color: var(--warna-sekunder-terang);
            /* Mungkin lebih gelap? */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .btn-fancy-outline-primary {
            background-color: transparent;
            color: var(--warna-utama);
            border: 2px solid var(--warna-utama);
        }

        .btn-fancy-outline-primary:hover {
            background-color: var(--warna-utama);
            color: var(--warna-teks-terang);
        }

        .btn-fancy-outline-danger {
            background-color: transparent;
            color: var(--merah-bahaya);
            border: 2px solid var(--merah-bahaya);
        }

        .btn-fancy-outline-danger:hover {
            background-color: var(--merah-bahaya);
            color: var(--warna-teks-terang);
        }

        .btn-fancy-sm {
            padding: calc(var(--spasi-s) * 0.8) calc(var(--spasi-m) * 0.8);
            font-size: 0.875rem;
        }


        /* Form Controls */
        .form-control-fancy {
            display: block;
            width: 100%;
            padding: var(--spasi-s) var(--spasi-m);
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: var(--warna-teks);
            background-color: var(--warna-permukaan);
            background-clip: padding-box;
            border: 1px solid var(--warna-garis);
            appearance: none;
            border-radius: var(--radius-standar);
            transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
        }

        .form-control-fancy:focus {
            color: var(--warna-teks);
            background-color: var(--warna-permukaan);
            border-color: var(--warna-utama-terang);
            outline: 0;
            box-shadow: 0 0 0 0.25rem rgba(var(--warna-utama-rgb), 0.25);
            /* Perlu --warna-utama-rgb */
        }

        .form-label-fancy {
            margin-bottom: var(--spasi-s);
            font-weight: 500;
        }

        .form-select-fancy {
            /* Mirip form-control-fancy tapi untuk select */
            display: block;
            width: 100%;
            padding: var(--spasi-s) var(--spasi-m);
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: var(--warna-teks);
            background-color: var(--warna-permukaan);
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right var(--spasi-m) center;
            background-size: 16px 12px;
            border: 1px solid var(--warna-garis);
            border-radius: var(--radius-standar);
            appearance: none;
        }

        .form-select-fancy:focus {
            border-color: var(--warna-utama-terang);
            outline: 0;
            box-shadow: 0 0 0 0.25rem rgba(var(--warna-utama-rgb), 0.25);
        }

        /* Untuk warna RGB dari warna utama */
        :root {
            --warna-utama-rgb: 46, 125, 50;
            /* RGB dari #2E7D32 */
        }


        /* Detail Properti Galeri */
        .detail-gallery-image-utama {
            width: 100%;
            height: 450px;
            /* Lebih tinggi */
            object-fit: cover;
            border-radius: var(--radius-besar);
            margin-bottom: var(--spasi-m);
            box-shadow: var(--bayangan-standar);
        }

        .thumbnail-container {
            display: flex;
            gap: var(--spasi-s);
            overflow-x: auto;
            /* Jika banyak thumbnail */
            padding-bottom: var(--spasi-s);
            /* Ruang untuk scrollbar */
        }

        .thumbnail-detail {
            width: 100px;
            height: 75px;
            object-fit: cover;
            border-radius: var(--radius-standar);
            cursor: pointer;
            border: 3px solid transparent;
            transition: var(--transisi-cepat);
            opacity: 0.7;
        }

        .thumbnail-detail:hover,
        .thumbnail-detail.active-thumb-detail {
            opacity: 1;
            border-color: var(--warna-utama);
            transform: scale(1.05);
        }

        /* Map Placeholder */
        .map-placeholder-fancy {
            background: linear-gradient(135deg, var(--warna-latar), #E0E0E0);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--warna-teks-sekunder);
            font-weight: 500;
            min-height: 250px;
            border-radius: var(--radius-besar);
            text-align: center;
            padding: var(--spasi-l);
        }

        /* Modal (Menggunakan struktur Bootstrap, tapi bisa di-style ulang) */
        .modal-content-fancy {
            border-radius: var(--radius-besar);
            border: none;
            box-shadow: var(--bayangan-jelas);
        }

        .modal-header-fancy {
            background-color: var(--warna-utama);
            color: var(--warna-teks-terang);
            border-bottom: none;
            padding: var(--spasi-m) var(--spasi-l);
        }

        .modal-header-fancy .btn-close {
            filter: invert(1) grayscale(100%) brightness(200%);
            /* Agar tombol close putih */
        }

        .modal-title-fancy {
            font-weight: 700;
        }

        /* Statistik Dashboard */
        .stats-grid .card-fancy {
            text-align: center;
        }

        .stats-grid .card-title-fancy {
            font-size: 1rem;
            color: var(--warna-teks-sekunder);
            font-weight: 500;
        }

        .stats-grid .card-text-stat {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--warna-utama);
        }

        /* Chat Box */
        .chat-container {
            height: 300px;
            /* Lebih tinggi */
            border: 1px solid var(--warna-garis);
            padding: var(--spasi-m);
            border-radius: var(--radius-standar);
            margin-bottom: var(--spasi-m);
            background-color: var(--warna-permukaan);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .chat-bubble {
            padding: var(--spasi-s) var(--spasi-m);
            border-radius: 18px;
            /* Lebih bulat */
            max-width: 75%;
            word-wrap: break-word;
            margin-bottom: var(--spasi-s);
            line-height: 1.4;
            font-size: 0.9rem;
        }

        .user-message .chat-bubble {
            background-color: var(--warna-utama);
            color: var(--warna-teks-terang);
            margin-left: auto;
            border-bottom-right-radius: var(--radius-kecil);
        }

        .owner-message .chat-bubble {
            background-color: var(--warna-latar);
            color: var(--warna-teks);
            margin-right: auto;
            border-bottom-left-radius: var(--radius-kecil);
        }

        .chat-time {
            font-size: 0.75rem;
            opacity: 0.7;
            display: block;
            margin-top: var(--spasi-xs);
        }

        .user-message .chat-time {
            text-align: right;
        }

        .owner-message .chat-time {
            text-align: left;
        }


        /* Table Fancy */
        .table-fancy {
            width: 100%;
            margin-bottom: var(--spasi-m);
            color: var(--warna-teks);
            border-collapse: collapse;
            /* Untuk border yang lebih baik */
        }

        .table-fancy th,
        .table-fancy td {
            padding: var(--spasi-m);
            vertical-align: middle;
            border-top: 1px solid var(--warna-garis);
        }

        .table-fancy thead th {
            vertical-align: bottom;
            border-bottom: 2px solid var(--warna-garis);
            background-color: var(--warna-latar);
            /* Header tabel sedikit berbeda */
            font-weight: 600;
            text-align: left;
            /* Umumnya teks header rata kiri */
        }

        .table-fancy tbody tr:hover {
            background-color: rgba(var(--warna-utama-rgb), 0.05);
            /* Hover lembut */
        }

        .table-fancy .badge-status {
            padding: var(--spasi-xs) var(--spasi-s);
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: var(--radius-kecil);
        }

        .badge-status.status-dikonfirmasi {
            background-color: var(--hijau-sukses);
            color: var(--warna-teks-terang);
        }

        .badge-status.status-menunggu {
            background-color: var(--kuning-peringatan);
            color: var(--warna-teks);
        }

        .badge-status.status-dibatalkan {
            background-color: var(--merah-bahaya);
            color: var(--warna-teks-terang);
        }


        /* === :: RESPONSIVE DESIGN ADJUSTMENTS :: === */
        @media (max-width: 992px) {

            /* Medium devices (tablets, less than 992px) */
            .app-sidebar {
                position: fixed;
                /* Atau absolute jika lebih mudah */
                left: -100%;
                /* Sembunyikan di luar layar */
                z-index: 1035;
                /* Di atas konten, di bawah header jika ada overlay */
                box-shadow: var(--bayangan-jelas);
                /* Tambahkan tombol untuk toggle sidebar di header */
            }

            .app-sidebar.open {
                left: 0;
            }

            .app-page-content {
                /* Beri ruang jika sidebar toggle-able di layar kecil */
            }

            .header-nav-actions .btn-icon.d-lg-none {
                /* Tombol toggle sidebar */
                display: inline-block !important;
            }
        }

        @media (max-width: 768px) {

            /* Small devices (landscape phones, 768px and down) */
            :root {
                --tinggi-header: 60px;
            }

            h1 {
                font-size: 1.8rem;
            }

            h2 {
                font-size: 1.5rem;
            }

            .app-page-content {
                padding: var(--spasi-m);
            }

            .detail-gallery-image-utama {
                height: 300px;
            }

            .thumbnail-detail {
                width: 80px;
                height: 60px;
            }

            /* Kolom pada detail properti bisa stack */
            #detail-properti .row>div[class*="col-"] {
                margin-bottom: var(--spasi-l);
            }

            .app-header .logo .nama-brand-tipis {
                display: none;
            }

            /* Hemat ruang */
            .app-header .logo .nama-brand-tebal {
                font-size: 1.3rem;
            }
        }

        @media (max-width: 576px) {

            /* Extra small devices (portrait phones, less than 576px) */
            .stats-grid .card-text-stat {
                font-size: 2rem;
            }

            .form-pencarian-fancy .row>div[class*="col-"] {
                flex: 0 0 100%;
                /* Semua input filter jadi full width */
                max-width: 100%;
            }

            .btn-fancy {
                width: 100%;
                margin-bottom: var(--spasi-s);
            }

            /* Tombol jadi full-width */
            .btn-fancy:last-child {
                margin-bottom: 0;
            }

            .header-nav-actions {
                gap: var(--spasi-s);
            }

            /* Kurangi gap di header */
        }

        /* Reduced motion preference */
        @media (prefers-reduced-motion: reduce) {
            html {
                scroll-behavior: auto;
            }

            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- === :: HEADER APLIKASI :: === -->
        <header class="app-header">
            <a href="#beranda" class="logo" data-route="beranda">
                <i class="fas fa-mountain-sun"></i>
                <div>
                    <span class="nama-brand-tebal">Green</span><span class="nama-brand-tipis">Valley</span>
                </div>
            </a>
            <div class="header-nav-actions">
                <button class="btn-icon d-lg-none" id="tombol-toggle-sidebar" aria-label="Buka Menu Navigasi">
                    <i class="fas fa-bars"></i>
                </button>
                <button class="btn-icon position-relative" aria-label="Notifikasi">
                    <i class="fas fa-bell"></i>
                    <span
                        class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle"
                        style="font-size:0.6rem; padding: .3rem !important;">
                        <span class="visually-hidden">Notifikasi baru</span>
                    </span>
                </button>
                <img src="https://i.pravatar.cc/40?u=penggunaAplikasi" alt="Avatar Pengguna" class="user-avatar"
                    id="user-avatar-header">
            </div>
        </header>

        <div class="app-main-content">
            <!-- === :: SIDEBAR NAVIGASI :: === -->
            <aside class="app-sidebar" id="appSidebar">
                <nav class="nav flex-column">
                    <a class="nav-link active" href="#beranda" data-route="beranda"><i
                            class="fas fa-home nav-icon"></i>Beranda</a>
                    <a class="nav-link" href="#properti" data-route="properti"><i
                            class="fas fa-city nav-icon"></i>Properti</a>
                    <a class="nav-link" href="#penyewa" data-route="penyewa"><i
                            class="fas fa-users nav-icon"></i>Penyewa</a>
                    <a class="nav-link" href="#pemesanan" data-route="pemesanan"><i
                            class="fas fa-calendar-check nav-icon"></i>Pemesanan</a>
                    <a class="nav-link" href="#akun" data-route="akun"><i class="fas fa-user-circle nav-icon"></i>Akun
                        Saya</a>
                    <a class="nav-link" href="#dukungan" data-route="dukungan"><i
                            class="fas fa-headset nav-icon"></i>Dukungan</a>
                </nav>
            </aside>

            <!-- === :: KONTEN UTAMA HALAMAN (SPA) :: === -->
            <main class="app-page-content">
                <!-- Halaman Beranda -->
                <section id="beranda" class="page active">
                    <h2 class="mb-4 display-6 gradient-teks">Selamat Datang di Green Valley!</h2>
                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mb-4 stats-grid">
                        <div class="col">
                            <article class="card-fancy h-100 hover-lift">
                                <div class="card-body-fancy">
                                    <h3 class="card-title-fancy"><i
                                            class="fas fa-building ikon-teks text-success"></i>Total Properti</h3>
                                    <p class="card-text-stat" id="stat-properti">0</p>
                                </div>
                            </article>
                        </div>
                        <div class="col">
                            <article class="card-fancy h-100 hover-lift">
                                <div class="card-body-fancy">
                                    <h3 class="card-title-fancy"><i
                                            class="fas fa-calendar-alt ikon-teks text-info"></i>Pemesanan Aktif</h3>
                                    <p class="card-text-stat" id="stat-pemesanan">0</p>
                                </div>
                            </article>
                        </div>
                        <div class="col">
                            <article class="card-fancy h-100 hover-lift">
                                <div class="card-body-fancy">
                                    <h3 class="card-title-fancy"><i
                                            class="fas fa-users ikon-teks text-warning"></i>Penyewa Terdaftar</h3>
                                    <p class="card-text-stat" id="stat-penyewa">0</p>
                                </div>
                            </article>
                        </div>
                    </div>

                    <form id="form-pencarian-utama" class="card-fancy p-4 mb-4 form-pencarian-fancy">
                        <h3 class="mb-3 h4">Cari Properti Impian Anda</h3>
                        <div class="row g-3">
                            <div class="col-md-7">
                                <label for="lokasi-cari" class="form-label-fancy">Lokasi Tujuan</label>
                                <input type="text" class="form-control-fancy" id="lokasi-cari"
                                    placeholder="Contoh: Puncak Pass, Ciwidey, Sentul">
                            </div>
                            <div class="col-md-5">
                                <label for="radius-cari" class="form-label-fancy">Radius Pencarian</label>
                                <select id="radius-cari" class="form-select-fancy">
                                    <option value="5">Dalam 5 km</option>
                                    <option value="10" selected>Dalam 10 km</option>
                                    <option value="25">Dalam 25 km</option>
                                    <option value="50">Dalam 50 km</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="check-in-cari" class="form-label-fancy">Tanggal Masuk</label>
                                <input type="date" class="form-control-fancy" id="check-in-cari">
                            </div>
                            <div class="col-md-6">
                                <label for="check-out-cari" class="form-label-fancy">Tanggal Keluar</label>
                                <input type="date" class="form-control-fancy" id="check-out-cari">
                            </div>
                            <div class="col-md-4">
                                <label for="harga-max-cari" class="form-label-fancy">Harga Maks (Rp/malam)</label>
                                <input type="number" class="form-control-fancy" id="harga-max-cari" min="0" step="50000"
                                    placeholder="1.500.000">
                            </div>
                            <div class="col-md-4">
                                <label for="tipe-properti-cari" class="form-label-fancy">Tipe Properti</label>
                                <select id="tipe-properti-cari" class="form-select-fancy">
                                    <option value="">Semua Tipe</option>
                                    <option value="villa">Villa</option>
                                    <option value="cottage">Cottage</option>
                                    <option value="apartemen">Apartemen</option>
                                    <option value="glamping">Glamping</option>
                                    <option value="resort">Resort</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="jumlah-tamu-cari" class="form-label-fancy">Jumlah Tamu</label>
                                <input type="number" class="form-control-fancy" id="jumlah-tamu-cari" min="1"
                                    placeholder="2">
                            </div>
                        </div>
                        <button type="submit" class="btn-fancy btn-fancy-primary mt-4 w-100">
                            <i class="fas fa-search"></i>Cari Properti Sekarang
                        </button>
                    </form>

                    <section id="peta-area-simulasi" class="map-placeholder-fancy mb-4 p-5 text-center">
                        <i class="fas fa-map-marked-alt fa-3x text-success mb-3"></i><br>
                        Peta Lokasi Properti Akan Tampil di Sini (Simulasi)<br>
                        <small>Area Green Valley mencakup beberapa destinasi populer.</small>
                    </section>

                    <h3 class="mb-3 mt-5 h4">✨ Properti Unggulan Pilihan Kami</h3>
                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="unggulan-properti-container">
                        <!-- Konten properti unggulan dimuat oleh JavaScript -->
                    </div>
                </section>

                <!-- Halaman Daftar Properti -->
                <section id="properti" class="page">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="h3">Jelajahi Semua Properti</h2>
                        <button class="btn-fancy btn-fancy-outline-primary btn-fancy-sm"
                            onclick="navigasiKe('beranda')">
                            <i class="fas fa-filter"></i> Ubah Filter Pencarian
                        </button>
                    </div>
                    <div id="filter-info-properti" class="alert alert-info d-none" role="alert">
                        Menampilkan properti berdasarkan filter: <strong id="filter-info-teks"></strong>
                    </div>
                    <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-4" id="daftar-properti-container">
                        <!-- Konten daftar properti dimuat oleh JavaScript -->
                    </div>
                    <div id="properti-tidak-ditemukan" class="text-center py-5 d-none">
                        <i class="fas fa-house-damage fa-3x text-muted mb-3"></i>
                        <h4 class="text-muted">Oops! Properti Tidak Ditemukan</h4>
                        <p>Coba ubah kriteria pencarian Anda atau jelajahi semua properti.</p>
                        <button class="btn-fancy btn-fancy-primary mt-2" onclick="muatSemuaProperti()">
                            <i class="fas fa-list"></i> Lihat Semua Properti
                        </button>
                    </div>
                </section>

                <!-- Halaman Detail Properti -->
                <section id="detail-properti" class="page">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 id="detail-nama-properti-judul" class="h3">Detail Properti</h2>
                        <button class="btn-fancy btn-fancy-outline-primary btn-fancy-sm"
                            onclick="navigasiKe('properti')">
                            <i class="fas fa-arrow-left"></i> Kembali ke Daftar
                        </button>
                    </div>

                    <div class="card-fancy mb-4">
                        <div class="card-body-fancy">
                            <div class="row">
                                <div class="col-lg-7 mb-4 mb-lg-0">
                                    <figure class="position-relative">
                                        <img src="https://via.placeholder.com/800x500/A9D18E/333333?text=Gambar+Utama+Properti"
                                            alt="Galeri utama properti" class="img-fluid detail-gallery-image-utama"
                                            id="detail-gambar-utama-properti" loading="lazy">
                                        <figcaption
                                            class="position-absolute bottom-0 start-0 bg-dark bg-opacity-75 text-white p-2 m-2 rounded-3 small">
                                            <i class="fas fa-vr-cardboard me-1"></i> Tur 360° Virtual Tersedia
                                            (Simulasi)
                                        </figcaption>
                                    </figure>
                                    <div class="thumbnail-container" id="detail-thumbnails-container">
                                        <!-- Thumbnails dimuat oleh JavaScript -->
                                    </div>
                                </div>
                                <div class="col-lg-5">
                                    <h3 id="detail-judul-utama-properti" class="h4 fw-bold mb-1">Nama Properti
                                        Placeholder</h3>
                                    <p id="detail-lokasi-lengkap-properti" class="text-muted mb-1 small">
                                        <i class="fas fa-map-marker-alt me-1 text-success"></i> Lokasi Placeholder
                                    </p>
                                    <p id="detail-info-pemilik-properti" class="text-muted mb-3 small">
                                        Dikelola oleh: Pemilik Terverifikasi <i
                                            class="fas fa-check-circle text-success"></i>
                                    </p>

                                    <div class="d-flex align-items-center mb-3">
                                        <span id="detail-rating-properti" class="badge bg-warning text-dark me-2 p-2"><i
                                                class="fas fa-star"></i> 0.0</span>
                                        <span id="detail-jumlah-ulasan-properti" class="text-muted small">(0
                                            ulasan)</span>
                                    </div>

                                    <p id="detail-deskripsi-lengkap-properti" class="mb-3">Deskripsi lengkap properti
                                        akan muncul di sini.</p>

                                    <div class="mb-3">
                                        <strong>Fasilitas Utama:</strong>
                                        <div id="detail-fasilitas-list-properti" class="mt-2 d-flex flex-wrap gap-2">
                                            <!-- Fasilitas dimuat JavaScript -->
                                        </div>
                                    </div>

                                    <h4 id="detail-harga-per-malam-properti" class="h5 text-success fw-bold mb-3">Harga
                                        Placeholder</h4>

                                    <form id="form-pemesanan-properti">
                                        <h5 class="mb-3 fw-semibold">Pesan Sekarang Juga!</h5>
                                        <div class="row g-3 mb-3">
                                            <div class="col-md-6">
                                                <label for="booking-check-in-detail" class="form-label-fancy">Tanggal
                                                    Masuk</label>
                                                <input type="date" class="form-control-fancy"
                                                    id="booking-check-in-detail" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="booking-check-out-detail" class="form-label-fancy">Tanggal
                                                    Keluar</label>
                                                <input type="date" class="form-control-fancy"
                                                    id="booking-check-out-detail" required>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="metode-pembayaran-detail" class="form-label-fancy">Metode
                                                Pembayaran</label>
                                            <select id="metode-pembayaran-detail" class="form-select-fancy" required>
                                                <option value="" disabled selected>Pilih Metode</option>
                                                <option value="kartu-kredit">Kartu Kredit/Debit</option>
                                                <option value="transfer-bank">Transfer Bank Virtual Account</option>
                                                <option value="dompet-digital">Dompet Digital (GoPay, OVO, Dana)
                                                </option>
                                            </select>
                                        </div>
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox"
                                                id="asuransi-perjalanan-detail">
                                            <label class="form-check-label" for="asuransi-perjalanan-detail">
                                                Tambah Asuransi Perjalanan (+Rp50.000)
                                            </label>
                                        </div>
                                        <div id="perincian-biaya-detail" class="mb-3 p-3 bg-light rounded-3 border">
                                            <p class="mb-1">Harga Dasar (<span id="jumlah-malam-detail">1</span> malam):
                                                <strong class="float-end" id="biaya-dasar-detail">Rp0</strong>
                                            </p>
                                            <p class="mb-1">Pajak & Biaya Layanan (11%): <strong class="float-end"
                                                    id="biaya-pajak-detail">Rp0</strong></p>
                                            <p class="mb-1">Asuransi Perjalanan: <strong class="float-end"
                                                    id="biaya-asuransi-detail">Rp0</strong></p>
                                            <hr class="my-2">
                                            <p class="fw-bold mb-0 h5">Total Estimasi: <strong
                                                    class="float-end text-success" id="biaya-total-detail">Rp0</strong>
                                            </p>
                                        </div>
                                        <p class="text-success small mb-3"><i class="fas fa-shield-alt me-1"></i>
                                            Pembayaran Anda 100% aman dan terenkripsi.</p>
                                        <button type="submit" class="btn-fancy btn-fancy-primary w-100 mb-2">
                                            <i class="fas fa-calendar-plus"></i>Konfirmasi & Lanjutkan Pembayaran
                                        </button>
                                        <button type="button" class="btn-fancy btn-fancy-outline-danger w-100"
                                            data-bs-toggle="modal" data-bs-target="#modalLaporanMasalah">
                                            <i class="fas fa-flag"></i>Laporkan Masalah Properti
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-7 mb-4 mb-lg-0">
                            <section id="ulasan-pelanggan" class="card-fancy h-100">
                                <div class="card-body-fancy">
                                    <h4 class="card-title-fancy mb-3"><i class="fas fa-comments ikon-teks"></i>Ulasan
                                        Pelanggan</h4>
                                    <div id="daftar-ulasan-container">
                                        <!-- Ulasan dimuat JavaScript -->
                                        <p class="text-muted">Belum ada ulasan untuk properti ini.</p>
                                    </div>
                                    <button class="btn-fancy btn-fancy-outline-primary btn-fancy-sm mt-3"
                                        id="btn-tambah-ulasan" data-bs-toggle="modal"
                                        data-bs-target="#modalTambahUlasan">
                                        <i class="fas fa-plus"></i> Tambah Ulasan Anda
                                    </button>
                                </div>
                            </section>
                        </div>
                        <div class="col-lg-5">
                            <section id="chat-dengan-pemilik" class="card-fancy h-100">
                                <div class="card-body-fancy d-flex flex-column">
                                    <h4 class="card-title-fancy mb-3"><i class="fas fa-headset ikon-teks"></i>Chat
                                        dengan Pemilik/CS</h4>
                                    <div id="pesan-chat-container" class="chat-container flex-grow-1 mb-3">
                                        <!-- Pesan chat dimuat JavaScript -->
                                    </div>
                                    <form id="form-kirim-chat" class="d-flex gap-2">
                                        <input type="text" id="input-pesan-chat" class="form-control-fancy flex-grow-1"
                                            placeholder="Ketik pesan Anda di sini..." required>
                                        <button type="submit" class="btn-fancy btn-fancy-primary px-3"><i
                                                class="fas fa-paper-plane"></i></button>
                                    </form>
                                </div>
                            </section>
                        </div>
                    </div>
                </section>

                <!-- Halaman Manajemen Penyewa -->
                <section id="penyewa" class="page">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="h3">Manajemen Data Penyewa</h2>
                        <button class="btn-fancy btn-fancy-primary" id="btn-modal-tambah-penyewa">
                            <i class="fas fa-user-plus"></i>Tambah Penyewa Baru
                        </button>
                    </div>
                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="daftar-penyewa-container">
                        <!-- Daftar penyewa dimuat JavaScript -->
                        <p class="text-muted col-12">Belum ada data penyewa.</p>
                    </div>
                </section>

                <!-- Halaman Riwayat Pemesanan -->
                <section id="pemesanan" class="page">
                    <h2 class="mb-4 h3">Riwayat Pemesanan Anda</h2>
                    <div class="table-responsive card-fancy p-0"> <!-- p-0 untuk table flush dengan card -->
                        <table class="table-fancy align-middle mb-0">
                            <!-- mb-0 jika table adalah child terakhir card -->
                            <thead>
                                <tr>
                                    <th>ID Pesanan</th>
                                    <th>Nama Properti</th>
                                    <th>Tanggal Menginap</th>
                                    <th>Status</th>
                                    <th>Total Biaya</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="daftar-pemesanan-container">
                                <!-- Daftar pemesanan dimuat JavaScript -->
                                <tr>
                                    <td colspan="6" class="text-center text-muted py-4">Belum ada riwayat pemesanan.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Halaman Akun Pengguna -->
                <section id="akun" class="page">
                    <h2 class="mb-4 h3">Pengaturan Akun Saya</h2>
                    <div class="card-fancy">
                        <div class="card-body-fancy">
                            <div class="row">
                                <div class="col-md-4 text-center mb-4 mb-md-0 border-end-md">
                                    <img src="https://i.pravatar.cc/150?u=penggunaAplikasi" alt="Foto Profil Pengguna"
                                        class="rounded-circle mb-3 border border-3 border-success shadow-sm"
                                        style="width:120px; height:120px;" id="akun-foto-profil-display">
                                    <h4 id="akun-nama-lengkap-display" class="h5">Nama Pengguna</h4>
                                    <p class="text-muted small" id="akun-email-display">email@example.com</p>
                                    <button class="btn-fancy btn-fancy-outline-primary btn-fancy-sm mb-3">
                                        <i class="fas fa-camera"></i> Ganti Foto Profil
                                    </button>
                                    <hr class="my-3">
                                    <p class="mb-1"><strong><i class="fas fa-star text-warning"></i> Poin
                                            Loyalitas:</strong></p>
                                    <p><span id="akun-poin-loyalitas" class="badge bg-success fs-5 p-2">0</span> Poin
                                    </p>
                                </div>
                                <div class="col-md-8 ps-md-4">
                                    <h3 class="h5 mb-3 fw-semibold">Edit Informasi Profil</h3>
                                    <form id="form-edit-profil">
                                        <div class="mb-3">
                                            <label for="akun-nama-profil-input" class="form-label-fancy">Nama
                                                Lengkap</label>
                                            <input type="text" class="form-control-fancy" id="akun-nama-profil-input"
                                                value="Nama Pengguna" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="akun-email-profil-input" class="form-label-fancy">Alamat
                                                Email</label>
                                            <input type="email" class="form-control-fancy" id="akun-email-profil-input"
                                                value="email@example.com" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="akun-telepon-profil-input" class="form-label-fancy">Nomor
                                                Telepon</label>
                                            <input type="tel" class="form-control-fancy" id="akun-telepon-profil-input"
                                                placeholder="Contoh: 081234567890">
                                        </div>
                                        <button type="submit" class="btn-fancy btn-fancy-primary">
                                            <i class="fas fa-save"></i>Simpan Perubahan Profil
                                        </button>
                                    </form>
                                    <hr class="my-4">
                                    <h3 class="h5 mt-4 mb-3 fw-semibold">Keamanan Akun</h3>
                                    <div class="d-flex flex-wrap gap-2">
                                        <button class="btn-fancy btn-fancy-outline-primary">
                                            <i class="fas fa-key"></i>Ubah Kata Sandi
                                        </button>
                                        <button class="btn-fancy btn-fancy-outline-danger">
                                            <i class="fas fa-user-slash"></i>Nonaktifkan Akun Saya
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Halaman Dukungan & Bantuan -->
                <section id="dukungan" class="page">
                    <h2 class="mb-4 h3">Pusat Bantuan & Dukungan Pelanggan</h2>
                    <div class="row">
                        <div class="col-lg-7 mb-4 mb-lg-0">
                            <div class="card-fancy h-100">
                                <div class="card-body-fancy">
                                    <h3 class="card-title-fancy h5"><i
                                            class="fas fa-question-circle me-2 text-primary"></i>FAQ (Pertanyaan yang
                                        Sering Diajukan)</h3>
                                    <div class="accordion accordion-flush" id="accordionFAQContainer">
                                        <!-- Item FAQ dimuat JavaScript -->
                                        <p class="text-muted">Memuat daftar pertanyaan...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-5">
                            <div class="card-fancy h-100">
                                <div class="card-body-fancy">
                                    <h3 class="card-title-fancy h5"><i
                                            class="fas fa-headset me-2 text-success"></i>Hubungi Tim Dukungan Kami 24/7
                                    </h3>
                                    <p>Jika Anda tidak menemukan jawaban di FAQ atau memerlukan bantuan lebih lanjut,
                                        tim kami siap membantu Anda:</p>
                                    <ul class="list-unstyled">
                                        <li class="mb-2"><a href="#"
                                                class="text-decoration-none link-success fw-medium"><i
                                                    class="fas fa-comments me-2 fa-fw"></i> Chat Langsung (Online
                                                Sekarang)</a></li>
                                        <li class="mb-2"><a href="mailto:support@greenvalley.id"
                                                class="text-decoration-none link-success fw-medium"><i
                                                    class="fas fa-envelope me-2 fa-fw"></i> support@greenvalley.id</a>
                                        </li>
                                        <li class="mb-2"><a href="tel:+6281122334455"
                                                class="text-decoration-none link-success fw-medium"><i
                                                    class="fas fa-phone-alt me-2 fa-fw"></i> +62 811 2233 4455 (WhatsApp
                                                Tersedia)</a></li>
                                    </ul>
                                    <p class="small text-muted mt-3">Kami berkomitmen untuk memberikan pengalaman
                                        terbaik bagi Anda.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- === :: MODALS (Menggunakan struktur Bootstrap, di-style ulang dengan Fancy) :: === -->
                <!-- Modal Laporan Masalah Properti -->
                <div class="modal fade" id="modalLaporanMasalah" tabindex="-1"
                    aria-labelledby="modalLaporanMasalahLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content modal-content-fancy">
                            <div class="modal-header modal-header-fancy">
                                <h5 class="modal-title modal-title-fancy" id="modalLaporanMasalahLabel"><i
                                        class="fas fa-flag me-2"></i>Laporkan Masalah Properti</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Tutup"></button>
                            </div>
                            <div class="modal-body p-4">
                                <form id="form-laporan-masalah">
                                    <div class="mb-3">
                                        <label for="kategori-laporan-modal" class="form-label-fancy">Kategori
                                            Masalah</label>
                                        <select id="kategori-laporan-modal" class="form-select-fancy" required>
                                            <option value="" disabled selected>Pilih Kategori</option>
                                            <option value="kebersihan">Kebersihan Tidak Sesuai</option>
                                            <option value="fasilitas">Fasilitas Rusak/Tidak Lengkap</option>
                                            <option value="keamanan">Masalah Keamanan</option>
                                            <option value="deskripsi">Deskripsi Tidak Akurat</option>
                                            <option value="lainnya">Lainnya (Jelaskan di bawah)</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="detail-masalah-laporan-modal" class="form-label-fancy">Jelaskan
                                            Masalah Secara Rinci</label>
                                        <textarea class="form-control-fancy" id="detail-masalah-laporan-modal" rows="4"
                                            placeholder="Contoh: AC di kamar utama tidak dingin dan mengeluarkan suara berisik."
                                            required></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label for="lampiran-foto-laporan-modal" class="form-label-fancy">Lampirkan Foto
                                            Bukti (Opsional)</label>
                                        <input class="form-control-fancy" type="file" id="lampiran-foto-laporan-modal"
                                            accept="image/*">
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer p-3 bg-light border-top-0">
                                <button type="button" class="btn-fancy btn-fancy-outline-primary"
                                    data-bs-dismiss="modal">Batal</button>
                                <button type="submit" form="form-laporan-masalah" class="btn-fancy btn-fancy-primary"
                                    style="background-color: var(--merah-bahaya);"><i
                                        class="fas fa-paper-plane me-2"></i>Kirim Laporan</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal Tambah Ulasan -->
                <div class="modal fade" id="modalTambahUlasan" tabindex="-1" aria-labelledby="modalTambahUlasanLabel"
                    aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content modal-content-fancy">
                            <div class="modal-header modal-header-fancy">
                                <h5 class="modal-title modal-title-fancy" id="modalTambahUlasanLabel"><i
                                        class="fas fa-star-half-alt me-2"></i>Bagikan Pengalaman Anda</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Tutup"></button>
                            </div>
                            <div class="modal-body p-4">
                                <form id="form-tambah-ulasan">
                                    <div class="mb-3">
                                        <label class="form-label-fancy">Rating Keseluruhan</label>
                                        <div id="rating-bintang-input" class="d-flex fs-3"
                                            style="color: var(--kuning-peringatan);">
                                            <i class="far fa-star" data-value="1"></i>
                                            <i class="far fa-star" data-value="2"></i>
                                            <i class="far fa-star" data-value="3"></i>
                                            <i class="far fa-star" data-value="4"></i>
                                            <i class="far fa-star" data-value="5"></i>
                                        </div>
                                        <input type="hidden" id="rating-value-input" name="rating" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="judul-ulasan-modal" class="form-label-fancy">Judul Ulasan</label>
                                        <input type="text" class="form-control-fancy" id="judul-ulasan-modal"
                                            placeholder="Contoh: Pengalaman Menginap Terbaik!" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="isi-ulasan-modal" class="form-label-fancy">Ulasan Anda</label>
                                        <textarea class="form-control-fancy" id="isi-ulasan-modal" rows="4"
                                            placeholder="Ceritakan lebih detail tentang pengalaman Anda..."
                                            required></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer p-3 bg-light border-top-0">
                                <button type="button" class="btn-fancy btn-fancy-outline-primary"
                                    data-bs-dismiss="modal">Batal</button>
                                <button type="submit" form="form-tambah-ulasan" class="btn-fancy btn-fancy-primary"><i
                                        class="fas fa-paper-plane me-2"></i>Kirim Ulasan</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal Tambah/Edit Penyewa -->
                <div class="modal fade" id="modalManajemenPenyewa" tabindex="-1"
                    aria-labelledby="modalManajemenPenyewaLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content modal-content-fancy">
                            <div class="modal-header modal-header-fancy">
                                <h5 class="modal-title modal-title-fancy" id="modalManajemenPenyewaLabel"><i
                                        class="fas fa-user-edit me-2"></i>Manajemen Data Penyewa</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Tutup"></button>
                            </div>
                            <div class="modal-body p-4">
                                <form id="form-manajemen-penyewa">
                                    <input type="hidden" id="id-penyewa-modal">
                                    <div class="mb-3">
                                        <label for="nama-penyewa-modal" class="form-label-fancy">Nama Lengkap
                                            Penyewa</label>
                                        <input type="text" class="form-control-fancy" id="nama-penyewa-modal" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="email-penyewa-modal" class="form-label-fancy">Alamat Email</label>
                                        <input type="email" class="form-control-fancy" id="email-penyewa-modal"
                                            required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="telepon-penyewa-modal" class="form-label-fancy">Nomor
                                            Telepon</label>
                                        <input type="tel" class="form-control-fancy" id="telepon-penyewa-modal"
                                            required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="sejak-penyewa-modal" class="form-label-fancy">Terdaftar
                                            Sejak</label>
                                        <input type="date" class="form-control-fancy" id="sejak-penyewa-modal" required>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer p-3 bg-light border-top-0">
                                <button type="button" class="btn-fancy btn-fancy-outline-primary"
                                    data-bs-dismiss="modal">Batal</button>
                                <button type="submit" form="form-manajemen-penyewa"
                                    class="btn-fancy btn-fancy-primary"><i class="fas fa-save me-2"></i>Simpan Data
                                    Penyewa</button>
                            </div>
                        </div>
                    </div>
                </div>

            </main>
        </div>

        <!-- === :: FOOTER APLIKASI :: === -->
        <footer class="app-footer">
            Hak Cipta &copy; <span id="tahun-sekarang"></span> Green Valley Property Rentals. Seluruh hak cipta
            dilindungi.
            <br><small>Dirancang dengan <i class="fas fa-heart text-danger"></i> oleh AI untuk tujuan
                demonstrasi.</small>
        </footer>
    </div>

    <!-- Bootstrap JS Bundle (diperlukan untuk Modal, Collapse/Accordion, dll.) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <script>
        // === :: APLIKASI GREEN VALLEY SPA :: ===
        // --- Konfigurasi Global & State Aplikasi ---
        const AppState = {
            halamanAktif: 'beranda',
            idPropertiDetailSaatIni: null,
            dataPengguna: {
                nama: 'Andi Pratama',
                email: 'andi.p@greenvalley.id',
                telepon: '081122334455',
                poinLoyalitas: 1250,
                avatar: 'https://i.pravatar.cc/150?u=penggunaAplikasi'
            },
            properti: [
                { id: 1, nama: 'Villa Panorama Puncak', lokasi: 'Puncak Pass, Bogor', harga: 1750000, rating: 4.9, ulasan: 15, gambar: ['https://images.unsplash.com/photo-1580587771525-78b9dba3b914?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8dmlsbGF8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=800&q=60', 'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8OHx8dmlsbGF8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=800&q=60', 'https://images.unsplash.com/photo-1613977257363-707ba9348227?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8dmlsbGElMjBpbnRlcmlvcnxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=800&q=60'], fasilitas: ['wifi', 'kolam-renang', 'parkir-luas', 'dapur-lengkap', 'bbq-area', 'pemandangan-gunung'], tipe: 'villa', kapasitas: 8, deskripsi: 'Villa mewah dengan 4 kamar tidur, kolam renang pribadi, dan pemandangan gunung yang menakjubkan. Sempurna untuk liburan keluarga besar atau acara spesial.' },
                { id: 2, nama: 'Cottage Asri Ciwidey', lokasi: 'Ciwidey, Bandung Selatan', harga: 950000, rating: 4.7, ulasan: 22, gambar: ['https://images.unsplash.com/photo-1518780664697-55e3ad937233?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NXx8Y290dGFnZXxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=800&q=60', 'https://images.unsplash.com/photo-1570129477492-45c003edd2e0?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8aG91c2V8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=800&q=60'], fasilitas: ['wifi', 'parkir', 'ac', 'water-heater', 'kebun-teh'], tipe: 'cottage', kapasitas: 4, deskripsi: 'Cottage menawan di tengah perkebunan teh Ciwidey. Nikmati udara segar, ketenangan, dan akses mudah ke berbagai objek wisata alam.' },
                { id: 3, nama: 'Glamping Forest View Sukabumi', lokasi: 'Situ Gunung, Sukabumi', harga: 1200000, rating: 4.8, ulasan: 18, gambar: ['https://images.unsplash.com/photo-1593604341244-687676903899?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8Z2xhbXBpbmd8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=800&q=60', 'https://images.unsplash.com/photo-1601591283783-7944554bab7b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTV8fGdsYW1waW5nfGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=60'], fasilitas: ['sarapan-gratis', 'api-unggun', 'trekking-guide', 'kamar-mandi-dalam'], tipe: 'glamping', kapasitas: 3, deskripsi: 'Pengalaman berkemah mewah di tengah hutan pinus dengan fasilitas lengkap. Ideal untuk pasangan atau keluarga kecil yang mencari petualangan.' },
                { id: 4, nama: 'Apartemen Urban Sentul', lokasi: 'Sentul City, Bogor', harga: 750000, rating: 4.5, ulasan: 30, gambar: ['https://images.unsplash.com/photo-1493809842364-78817add7ffb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8OXx8YXBhcnRtZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=60', 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8YXBhcnRtZW50JTIwaW50ZXJpb3J8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=800&q=60'], fasilitas: ['wifi', 'kolam-renang-umum', 'gym', 'ac-sentral', 'akses-mall'], tipe: 'apartemen', kapasitas: 2, deskripsi: 'Apartemen studio modern dan stylish di jantung Sentul City. Akses mudah ke pusat perbelanjaan, restoran, dan berbagai atraksi.' },
                { id: 5, nama: 'Resort Tepi Pantai Carita', lokasi: 'Carita, Banten', harga: 2100000, rating: 4.6, ulasan: 25, gambar: ['https://images.unsplash.com/photo-1571003123894-1f0594d2b5d9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MjB8fGJlYWNoJTIwcmVzb3J0fGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=60', 'https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8YmVhY2glMjByZXNvcnR8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=800&q=60'], fasilitas: ['private-beach', 'restoran-seafood', 'spa', 'water-sports', 'kids-club'], tipe: 'resort', kapasitas: 6, deskripsi: 'Resort eksklusif dengan akses pantai pribadi di Carita. Menawarkan berbagai fasilitas rekreasi air dan kenyamanan bintang lima.' }
            ],
            pemesanan: [
                { id: 'GV24001', idProperti: 1, namaProperti: 'Villa Panorama Puncak', checkIn: '2024-08-15', checkOut: '2024-08-17', status: 'Dikonfirmasi', totalBiaya: 3850000, tamu: 6 },
                { id: 'GV24002', idProperti: 3, namaProperti: 'Glamping Forest View Sukabumi', checkIn: '2024-09-01', checkOut: '2024-09-03', status: 'Menunggu Pembayaran', totalBiaya: 2640000, tamu: 2 },
                { id: 'GV24003', idProperti: 2, namaProperti: 'Cottage Asri Ciwidey', checkIn: '2024-07-20', checkOut: '2024-07-22', status: 'Dibatalkan', totalBiaya: 2090000, tamu: 4 }
            ],
            penyewa: [
                { id: 1, nama: 'Budi Santoso', email: 'budi.s@example.com', telepon: '081234567890', sejak: '2023-05-10', totalPemesanan: 3, avatar: 'https://i.pravatar.cc/80?u=budi' },
                { id: 2, nama: 'Citra Ayu Lestari', email: 'citra.ayu@example.com', telepon: '087654321098', sejak: '2024-01-15', totalPemesanan: 1, avatar: 'https://i.pravatar.cc/80?u=citra' },
                { id: 3, nama: 'Rahmat Hidayat', email: 'rahmat.h@example.com', telepon: '085712345678', sejak: '2023-11-20', totalPemesanan: 2, avatar: 'https://i.pravatar.cc/80?u=rahmat' }
            ],
            chat: {
                // Chat akan per properti, atau umum. Di sini kita buat umum dulu.
                properti_1: [ // Contoh untuk properti dengan ID 1
                    { pengirim: 'Pemilik', teks: 'Selamat datang di Villa Panorama Puncak! Ada yang bisa kami bantu?', waktu: new Date(Date.now() - 300000) },
                    { pengirim: 'Pengguna', teks: 'Halo, saya mau tanya ketersediaan untuk tanggal 17-19 Agustus.', waktu: new Date(Date.now() - 180000) },
                    { pengirim: 'Pemilik', teks: 'Baik, akan segera kami cek. Mohon ditunggu sebentar ya.', waktu: new Date(Date.now() - 60000) }
                ],
                umum: [
                    { pengirim: 'CS GreenValley', teks: 'Halo! Selamat datang di layanan pelanggan Green Valley. Ada yang bisa kami bantu?', waktu: new Date(Date.now() - 60000 * 5) },
                ]
            },
            faq: [
                { tanya: "Bagaimana cara melakukan pemesanan properti di Green Valley?", jawab: "Anda dapat mencari properti melalui halaman Beranda atau Properti. Gunakan filter untuk menemukan properti yang sesuai, pilih tanggal menginap, lalu klik tombol 'Pesan Sekarang'. Ikuti langkah-langkah selanjutnya untuk menyelesaikan pemesanan dan pembayaran." },
                { tanya: "Metode pembayaran apa saja yang diterima?", jawab: "Kami menerima berbagai metode pembayaran, termasuk Kartu Kredit/Debit (Visa, Mastercard, JCB), Transfer Bank melalui Virtual Account (BCA, Mandiri, BRI, BNI, dll.), serta Dompet Digital populer seperti GoPay, OVO, dan Dana." },
                { tanya: "Apakah saya bisa membatalkan atau mengubah jadwal pemesanan?", jawab: "Kebijakan pembatalan dan perubahan jadwal bervariasi tergantung pada masing-masing properti. Informasi detail mengenai kebijakan ini dapat Anda temukan di halaman detail properti sebelum melakukan pemesanan, atau di email konfirmasi setelah pemesanan berhasil." },
                { tanya: "Bagaimana jika saya menemukan masalah dengan properti saat check-in?", jawab: "Segera hubungi pemilik properti melalui fitur chat yang tersedia atau kontak yang tertera di detail pemesanan Anda. Jika masalah tidak terselesaikan, Anda dapat menghubungi tim Dukungan Pelanggan Green Valley melalui halaman 'Dukungan' untuk bantuan lebih lanjut. Jangan lupa untuk menggunakan fitur 'Laporkan Masalah' di halaman detail properti jika diperlukan." },
                { tanya: "Apakah harga yang tertera sudah termasuk semua biaya?", jawab: "Harga per malam yang ditampilkan biasanya adalah harga dasar sewa properti. Biaya tambahan seperti pajak, biaya layanan, dan asuransi (jika dipilih) akan dirinci pada halaman konfirmasi pemesanan sebelum Anda melakukan pembayaran. Pastikan untuk memeriksa rincian biaya dengan cermat." }
            ],
            filterPencarianSaatIni: null
        };

        // --- Utilitas Umum ---
        const $ = (selektor) => document.querySelector(selektor);
        const $$ = (selektor) => document.querySelectorAll(selektor);

        const formatRupiah = (angka, denganRp = true) => {
            if (isNaN(angka) || angka === null) return (denganRp ? 'Rp' : '') + '0';
            return (denganRp ? 'Rp' : '') + Number(angka).toLocaleString('id-ID');
        };

        const formatDateID = (dateString, opsi = { day: 'numeric', month: 'long', year: 'numeric' }) => {
            if (!dateString) return 'N/A';
            return new Date(dateString).toLocaleDateString('id-ID', opsi);
        };

        const formatTimeID = (dateObj) => {
            if (!dateObj) return '';
            return new Date(dateObj).toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
        }

        const getNamaFasilitas = (key) => {
            const kamus = {
                'wifi': 'Wi-Fi Cepat', 'kolam-renang': 'Kolam Renang Pribadi', 'parkir-luas': 'Parkir Luas',
                'dapur-lengkap': 'Dapur Lengkap', 'bbq-area': 'Area BBQ', 'pemandangan-gunung': 'Pemandangan Gunung',
                'ac': 'AC Dingin', 'water-heater': 'Pemanas Air', 'kebun-teh': 'Dekat Kebun Teh',
                'sarapan-gratis': 'Sarapan Gratis', 'api-unggun': 'Area Api Unggun', 'trekking-guide': 'Pemandu Trekking',
                'kamar-mandi-dalam': 'Kamar Mandi Dalam', 'gym': 'Akses Gym', 'akses-mall': 'Akses ke Mall',
                'private-beach': 'Pantai Pribadi', 'restoran-seafood': 'Restoran Seafood', 'spa': 'Layanan Spa',
                'water-sports': 'Olahraga Air', 'kids-club': 'Klub Anak'
            };
            return kamus[key] || key.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        };

        // --- Logika SPA & Navigasi ---
        function navigasiKe(idHalaman, params = null) {
            $$('.page').forEach(h => h.classList.remove('active'));
            const halamanTarget = $(`#${idHalaman}`);
            if (halamanTarget) {
                halamanTarget.classList.add('active');
                AppState.halamanAktif = idHalaman;
                history.pushState({ page: idHalaman, params: params }, `Green Valley - ${idHalaman}`, `#${idHalaman}${params ? '?' + new URLSearchParams(params).toString() : ''}`);

                // Update link aktif di sidebar
                $$('.app-sidebar .nav-link').forEach(link => {
                    link.classList.toggle('active', link.dataset.route === idHalaman);
                });

                // Panggil fungsi render spesifik untuk halaman
                switch (idHalaman) {
                    case 'beranda':
                        renderBeranda();
                        break;
                    case 'properti':
                        // Jika ada parameter dari pencarian, gunakan itu. Jika tidak, tampilkan semua.
                        if (params && params.hasilFilter) {
                            renderDaftarProperti(AppState.filterPencarianSaatIni ? params.hasilFilter : AppState.properti, AppState.filterPencarianSaatIni);
                        } else {
                            muatSemuaProperti(); // Memanggil fungsi yang merender semua properti
                        }
                        break;
                    case 'detail-properti':
                        if (params && params.id) {
                            AppState.idPropertiDetailSaatIni = parseInt(params.id);
                            renderDetailProperti(AppState.idPropertiDetailSaatIni);
                        } else {
                            console.error("ID Properti tidak ditemukan untuk halaman detail.");
                            navigasiKe('properti'); // Kembali ke daftar properti jika ID tidak ada
                        }
                        break;
                    case 'penyewa':
                        renderDaftarPenyewa();
                        break;
                    case 'pemesanan':
                        renderRiwayatPemesanan();
                        break;
                    case 'akun':
                        renderHalamanAkun();
                        break;
                    case 'dukungan':
                        renderHalamanDukungan();
                        break;
                }
                window.scrollTo(0, 0); // Gulir ke atas halaman
            } else {
                console.error(`Halaman dengan ID "${idHalaman}" tidak ditemukan.`);
                navigasiKe('beranda'); // Fallback ke beranda
            }
            // Tutup sidebar jika terbuka di layar kecil setelah navigasi
            if (window.innerWidth < 992) {
                $('#appSidebar').classList.remove('open');
            }
        }

        // --- Fungsi Render Konten Dinamis ---

        // BERANDA
        function renderBeranda() {
            updateStatistikDashboard();
            renderPropertiUnggulan();
            // Reset form pencarian jika diperlukan
            $('#form-pencarian-utama').reset();
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);
            $('#check-in-cari').min = today.toISOString().split('T')[0];
            $('#check-out-cari').min = tomorrow.toISOString().split('T')[0];
        }

        function updateStatistikDashboard() {
            $('#stat-properti').textContent = AppState.properti.length;
            $('#stat-pemesanan').textContent = AppState.pemesanan.filter(p => p.status === 'Dikonfirmasi').length;
            $('#stat-penyewa').textContent = AppState.penyewa.length;
        }

        function renderPropertiUnggulan() {
            const container = $('#unggulan-properti-container');
            if (!container) return;
            // Ambil 3 properti dengan rating tertinggi sebagai unggulan
            const propertiUnggulan = [...AppState.properti].sort((a, b) => b.rating - a.rating).slice(0, 3);

            if (propertiUnggulan.length === 0) {
                container.innerHTML = '<p class="text-muted col-12">Belum ada properti unggulan saat ini.</p>';
                return;
            }

            container.innerHTML = propertiUnggulan.map(p => buatKartuPropertiHTML(p)).join('');
            tambahkanEventListenerKartu();
        }

        // DAFTAR PROPERTI
        function renderDaftarProperti(daftar, filterInfo = null) {
            const container = $('#daftar-properti-container');
            const infoFilterContainer = $('#filter-info-properti');
            const teksInfoFilter = $('#filter-info-teks');
            const propertiTidakDitemukanEl = $('#properti-tidak-ditemukan');

            if (!container || !infoFilterContainer || !teksInfoFilter || !propertiTidakDitemukanEl) return;

            container.innerHTML = ''; // Kosongkan dulu

            if (filterInfo) {
                let info = [];
                if (filterInfo.lokasi) info.push(`Lokasi: ${filterInfo.lokasi}`);
                if (filterInfo.tipe) info.push(`Tipe: ${filterInfo.tipe}`);
                if (filterInfo.hargaMax) info.push(`Harga Maks: ${formatRupiah(filterInfo.hargaMax)}`);
                teksInfoFilter.textContent = info.join(', ') || "Semua Properti";
                infoFilterContainer.classList.remove('d-none');
            } else {
                infoFilterContainer.classList.add('d-none');
            }

            if (daftar.length === 0) {
                container.classList.add('d-none');
                propertiTidakDitemukanEl.classList.remove('d-none');
            } else {
                container.classList.remove('d-none');
                propertiTidakDitemukanEl.classList.add('d-none');
                container.innerHTML = daftar.map(p => buatKartuPropertiHTML(p)).join('');
                tambahkanEventListenerKartu();
            }
        }

        function muatSemuaProperti() {
            AppState.filterPencarianSaatIni = null; // Reset filter
            renderDaftarProperti(AppState.properti);
        }


        function buatKartuPropertiHTML(properti) {
            return `
                <div class="col">
                    <article class="card-fancy h-100 hover-lift property-card" data-id-properti="${properti.id}">
                        <img src="${properti.gambar[0]}" alt="Gambar ${properti.nama}" class="card-img-top-fancy" loading="lazy">
                        <div class="card-body-fancy d-flex flex-column">
                            <h5 class="card-title-fancy">${properti.nama}</h5>
                            <p class="card-text-fancy small text-muted mb-2">
                                <i class="fas fa-map-marker-alt ikon-teks text-success"></i>${properti.lokasi}
                            </p>
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <span class="fw-bold text-success fs-5">${formatRupiah(properti.harga)}<small>/malam</small></span>
                                <span class="badge bg-warning text-dark p-2"><i class="fas fa-star"></i> ${properti.rating} (${properti.ulasan})</span>
                            </div>
                            <p class="card-text-fancy flex-grow-1 small">${properti.deskripsi.substring(0, 80)}...</p>
                            <button class="btn-fancy btn-fancy-primary w-100 mt-auto lihat-detail-btn" data-id-properti="${properti.id}">
                                Lihat Detail & Pesan <i class="fas fa-arrow-right ikon-teks-kanan"></i>
                            </button>
                        </div>
                    </article>
                </div>
            `;
        }

        function tambahkanEventListenerKartu() {
            $$('.lihat-detail-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const idProperti = this.dataset.idProperti;
                    navigasiKe('detail-properti', { id: idProperti });
                });
            });
        }

        // DETAIL PROPERTI
        function renderDetailProperti(idProperti) {
            const properti = AppState.properti.find(p => p.id === idProperti);
            if (!properti) {
                $('#detail-properti').innerHTML = '<p class="alert alert-danger">Properti tidak ditemukan.</p>';
                return;
            }

            AppState.idPropertiDetailSaatIni = idProperti; // Set ID properti saat ini untuk konteks

            $('#detail-nama-properti-judul').textContent = properti.nama;
            $('#detail-gambar-utama-properti').src = properti.gambar[0];
            $('#detail-gambar-utama-properti').alt = `Gambar utama ${properti.nama}`;

            const thumbnailsContainer = $('#detail-thumbnails-container');
            thumbnailsContainer.innerHTML = properti.gambar.map((g, index) => `
                <img src="${g}" alt="Thumbnail ${properti.nama} ${index + 1}" 
                     class="thumbnail-detail ${index === 0 ? 'active-thumb-detail' : ''}" 
                     data-src-besar="${g}" loading="lazy">
            `).join('');

            $$('#detail-thumbnails-container .thumbnail-detail').forEach(thumb => {
                thumb.addEventListener('click', function () {
                    $('#detail-gambar-utama-properti').src = this.dataset.srcBesar;
                    $$('#detail-thumbnails-container .thumbnail-detail').forEach(t => t.classList.remove('active-thumb-detail'));
                    this.classList.add('active-thumb-detail');
                });
            });

            $('#detail-judul-utama-properti').textContent = properti.nama;
            $('#detail-lokasi-lengkap-properti').innerHTML = `<i class="fas fa-map-marker-alt me-1 text-success"></i> ${properti.lokasi}`;
            // $('#detail-info-pemilik-properti') // Bisa diisi jika ada data pemilik
            $('#detail-rating-properti').innerHTML = `<i class="fas fa-star"></i> ${properti.rating}`;
            $('#detail-jumlah-ulasan-properti').textContent = `(${properti.ulasan} ulasan)`;
            $('#detail-deskripsi-lengkap-properti').textContent = properti.deskripsi;

            const fasilitasContainer = $('#detail-fasilitas-list-properti');
            fasilitasContainer.innerHTML = properti.fasilitas.slice(0, 6).map(f => `
                <span class="badge bg-light text-dark border p-2"><i class="fas fa-check-circle text-success me-1"></i>${getNamaFasilitas(f)}</span>
            `).join('');
            if (properti.fasilitas.length > 6) {
                fasilitasContainer.innerHTML += `<span class="badge bg-light text-dark border p-2">+${properti.fasilitas.length - 6} lainnya</span>`;
            }


            $('#detail-harga-per-malam-properti').textContent = `${formatRupiah(properti.harga)} / malam`;

            // Reset dan prefill form pemesanan
            const formPemesanan = $('#form-pemesanan-properti');
            formPemesanan.reset();
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);
            const dayAfterTomorrow = new Date(today);
            dayAfterTomorrow.setDate(today.getDate() + 2);

            $('#booking-check-in-detail').min = today.toISOString().split('T')[0];
            $('#booking-check-in-detail').value = tomorrow.toISOString().split('T')[0];
            $('#booking-check-out-detail').min = dayAfterTomorrow.toISOString().split('T')[0];
            $('#booking-check-out-detail').value = dayAfterTomorrow.toISOString().split('T')[0];

            perbaruiRincianBiaya(properti.harga); // Kalkulasi awal
            renderUlasanUntukProperti(idProperti);
            renderChatUntukProperti(idProperti); // Atau chat umum jika tidak spesifik
        }

        function perbaruiRincianBiaya(hargaDasarPerMalam) {
            const checkIn = $('#booking-check-in-detail').value;
            const checkOut = $('#booking-check-out-detail').value;
            const tambahAsuransi = $('#asuransi-perjalanan-detail').checked;

            if (!checkIn || !checkOut) {
                // Reset biaya jika tanggal tidak valid
                $('#jumlah-malam-detail').textContent = '0';
                $('#biaya-dasar-detail').textContent = formatRupiah(0);
                $('#biaya-pajak-detail').textContent = formatRupiah(0);
                $('#biaya-asuransi-detail').textContent = formatRupiah(0);
                $('#biaya-total-detail').textContent = formatRupiah(0);
                return;
            }

            const tglMasuk = new Date(checkIn);
            const tglKeluar = new Date(checkOut);

            if (tglKeluar <= tglMasuk) {
                $('#jumlah-malam-detail').textContent = '0';
                $('#biaya-dasar-detail').textContent = formatRupiah(0);
                // ... (reset lainnya)
                return; // Atau tampilkan pesan error
            }

            const selisihHari = Math.ceil((tglKeluar - tglMasuk) / (1000 * 60 * 60 * 24));

            const subtotal = hargaDasarPerMalam * selisihHari;
            const pajakLayanan = subtotal * 0.11; // 11% pajak dan layanan
            const biayaAsuransi = tambahAsuransi ? 50000 : 0; // Biaya asuransi tetap
            const totalBiaya = subtotal + pajakLayanan + biayaAsuransi;

            $('#jumlah-malam-detail').textContent = selisihHari;
            $('#biaya-dasar-detail').textContent = formatRupiah(subtotal);
            $('#biaya-pajak-detail').textContent = formatRupiah(pajakLayanan);
            $('#biaya-asuransi-detail').textContent = formatRupiah(biayaAsuransi);
            $('#biaya-total-detail').textContent = formatRupiah(totalBiaya);
        }

        function renderUlasanUntukProperti(idProperti) {
            const container = $('#daftar-ulasan-container');
            // Simulasi ulasan, idealnya ini dari AppState.properti[X].ulasanList atau API
            const ulasanContoh = [
                { nama: 'Diana R.', rating: 5, judul: 'Sangat Memuaskan!', isi: 'Villanya bersih, pemandangan indah, fasilitas lengkap. Anak-anak senang sekali berenang. Pasti kembali lagi!', tanggal: '2024-07-15' },
                { nama: 'Bambang P.', rating: 4, judul: 'Tempat yang Nyaman', isi: 'Lokasi strategis, mudah dijangkau. Hanya saja air panas kadang tidak stabil. Overall oke.', tanggal: '2024-06-28' }
            ];

            if (ulasanContoh.length === 0) {
                container.innerHTML = '<p class="text-muted">Belum ada ulasan untuk properti ini.</p>';
                return;
            }

            container.innerHTML = ulasanContoh.map(u => `
                <div class="border-bottom pb-3 mb-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-0 fw-bold">${u.nama} <small class="text-muted fw-normal">- ${formatDateID(u.tanggal)}</small></h6>
                        <span class="badge bg-warning text-dark">${'<i class="fas fa-star"></i> '.repeat(u.rating)}${'<i class="far fa-star"></i> '.repeat(5 - u.rating)}</span>
                    </div>
                    <p class="fw-semibold mt-1 mb-1">${u.judul}</p>
                    <p class="small mb-0 text-muted">${u.isi}</p>
                </div>
            `).join('');
        }

        function renderChatUntukProperti(idProperti) {
            const container = $('#pesan-chat-container');
            const chatKey = `properti_${idProperti}`;
            const pesan = AppState.chat[chatKey] || AppState.chat.umum; // Fallback ke chat umum

            container.innerHTML = pesan.map(msg => `
                <div class="d-flex ${msg.pengirim === 'Pengguna' ? 'justify-content-end user-message' : 'owner-message'} mb-2">
                    <div class="chat-bubble">
                        <span class="fw-bold small">${msg.pengirim === 'Pengguna' ? AppState.dataPengguna.nama : msg.pengirim}</span><br>
                        ${msg.teks}
                        <span class="chat-time">${formatTimeID(msg.waktu)}</span>
                    </div>
                </div>
            `).join('');
            container.scrollTop = container.scrollHeight; // Auto scroll ke bawah
        }

        // MANAJEMEN PENYEWA
        function renderDaftarPenyewa() {
            const container = $('#daftar-penyewa-container');
            if (!container) return;

            if (AppState.penyewa.length === 0) {
                container.innerHTML = '<p class="text-muted col-12">Belum ada data penyewa yang terdaftar.</p>';
                return;
            }

            container.innerHTML = AppState.penyewa.map(p => `
                <div class="col">
                    <article class="card-fancy h-100">
                        <div class="card-body-fancy">
                            <div class="d-flex align-items-center mb-3">
                                <img src="${p.avatar || 'https://i.pravatar.cc/80?u=' + p.email}" alt="Avatar ${p.nama}" class="rounded-circle me-3" style="width: 60px; height: 60px; object-fit: cover;">
                                <div>
                                    <h5 class="card-title-fancy mb-0">${p.nama}</h5>
                                    <p class="card-text-fancy small text-muted mb-0">Penyewa sejak: ${formatDateID(p.sejak)}</p>
                                </div>
                            </div>
                            <p class="card-text-fancy small mb-1"><i class="fas fa-envelope ikon-teks"></i> ${p.email}</p>
                            <p class="card-text-fancy small mb-2"><i class="fas fa-phone ikon-teks"></i> ${p.telepon}</p>
                            <p class="card-text-fancy small">Total Pemesanan: <span class="badge bg-primary">${p.totalPemesanan}</span></p>
                            <div class="mt-3 pt-3 border-top d-flex gap-2">
                                <button class="btn-fancy btn-fancy-outline-primary btn-fancy-sm flex-grow-1 btn-edit-penyewa" data-id-penyewa="${p.id}">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn-fancy btn-fancy-outline-danger btn-fancy-sm flex-grow-1 btn-hapus-penyewa" data-id-penyewa="${p.id}">
                                    <i class="fas fa-trash"></i> Hapus
                                </button>
                            </div>
                        </div>
                    </article>
                </div>
            `).join('');

            // Tambah event listener untuk tombol edit dan hapus
            $$('.btn-edit-penyewa').forEach(btn => btn.addEventListener('click', handleEditPenyewa));
            $$('.btn-hapus-penyewa').forEach(btn => btn.addEventListener('click', handleHapusPenyewa));
        }

        // RIWAYAT PEMESANAN
        function renderRiwayatPemesanan() {
            const container = $('#daftar-pemesanan-container');
            if (!container) return;

            if (AppState.pemesanan.length === 0) {
                container.innerHTML = '<tr><td colspan="6" class="text-center text-muted py-4">Belum ada riwayat pemesanan.</td></tr>';
                return;
            }

            // Urutkan berdasarkan tanggal checkIn terbaru
            const pemesananTerurut = [...AppState.pemesanan].sort((a, b) => new Date(b.checkIn) - new Date(a.checkIn));

            container.innerHTML = pemesananTerurut.map(p => {
                let statusClass = '';
                switch (p.status.toLowerCase()) {
                    case 'dikonfirmasi': statusClass = 'status-dikonfirmasi'; break;
                    case 'menunggu pembayaran': statusClass = 'status-menunggu'; break;
                    case 'dibatalkan': statusClass = 'status-dibatalkan'; break;
                    default: statusClass = 'bg-secondary text-white';
                }
                return `
                    <tr>
                        <td><strong>${p.id}</strong></td>
                        <td>${p.namaProperti}</td>
                        <td>${formatDateID(p.checkIn)} - ${formatDateID(p.checkOut)}</td>
                        <td><span class="badge-status ${statusClass}">${p.status}</span></td>
                        <td>${formatRupiah(p.totalBiaya)}</td>
                        <td>
                            <button class="btn-fancy btn-fancy-outline-primary btn-fancy-sm me-1" title="Lihat Detail Pemesanan" onclick="lihatDetailPemesanan('${p.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${p.status.toLowerCase() === 'menunggu pembayaran' ? `
                                <button class="btn-fancy btn-fancy-primary btn-fancy-sm" style="background-color: var(--hijau-sukses);" title="Lakukan Pembayaran">
                                    <i class="fas fa-credit-card"></i> Bayar
                                </button>` : ''
                    }
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // HALAMAN AKUN
        function renderHalamanAkun() {
            const pengguna = AppState.dataPengguna;
            $('#akun-foto-profil-display').src = pengguna.avatar;
            $('#akun-nama-lengkap-display').textContent = pengguna.nama;
            $('#akun-email-display').textContent = pengguna.email;
            $('#akun-poin-loyalitas').textContent = pengguna.poinLoyalitas.toLocaleString('id-ID');

            $('#akun-nama-profil-input').value = pengguna.nama;
            $('#akun-email-profil-input').value = pengguna.email;
            $('#akun-telepon-profil-input').value = pengguna.telepon || '';
        }

        // HALAMAN DUKUNGAN
        function renderHalamanDukungan() {
            const faqContainer = $('#accordionFAQContainer');
            if (!faqContainer) return;

            if (AppState.faq.length === 0) {
                faqContainer.innerHTML = '<p class="text-muted">Daftar FAQ tidak tersedia saat ini.</p>';
                return;
            }

            faqContainer.innerHTML = AppState.faq.map((item, index) => `
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faq-heading-${index}">
                        <button class="accordion-button collapsed fw-medium" type="button" data-bs-toggle="collapse" 
                                data-bs-target="#faq-collapse-${index}" aria-expanded="false" aria-controls="faq-collapse-${index}">
                            ${item.tanya}
                        </button>
                    </h2>
                    <div id="faq-collapse-${index}" class="accordion-collapse collapse" 
                         aria-labelledby="faq-heading-${index}" data-bs-parent="#accordionFAQContainer">
                        <div class="accordion-body">
                            ${item.jawab}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // --- Event Handlers & Logika Aplikasi ---
        function handlePencarianProperti(event) {
            event.preventDefault();
            const lokasi = $('#lokasi-cari').value.trim().toLowerCase();
            // Radius, tanggal, dll. bisa ditambahkan untuk filter lebih lanjut
            const tipe = $('#tipe-properti-cari').value;
            const hargaMax = parseFloat($('#harga-max-cari').value) || Infinity;
            // const jumlahTamu = parseInt($('#jumlah-tamu-cari').value) || 0;

            AppState.filterPencarianSaatIni = { lokasi, tipe, hargaMax /*, jumlahTamu */ };

            const hasilFilter = AppState.properti.filter(p => {
                const cocokLokasi = !lokasi || p.lokasi.toLowerCase().includes(lokasi) || p.nama.toLowerCase().includes(lokasi);
                const cocokTipe = !tipe || p.tipe === tipe;
                const cocokHarga = p.harga <= hargaMax;
                // const cocokKapasitas = !jumlahTamu || p.kapasitas >= jumlahTamu;
                return cocokLokasi && cocokTipe && cocokHarga /* && cocokKapasitas */;
            });

            navigasiKe('properti', { hasilFilter: hasilFilter });
        }

        function handlePemesananProperti(event) {
            event.preventDefault();
            const idProperti = AppState.idPropertiDetailSaatIni;
            if (!idProperti) {
                alert('Gagal memproses pemesanan: ID properti tidak ditemukan.');
                return;
            }
            const properti = AppState.properti.find(p => p.id === idProperti);

            const checkIn = $('#booking-check-in-detail').value;
            const checkOut = $('#booking-check-out-detail').value;
            const metodeBayar = $('#metode-pembayaran-detail').value;

            if (!checkIn || !checkOut || !metodeBayar) {
                alert('Harap lengkapi semua field yang diperlukan (tanggal dan metode pembayaran).');
                return;
            }
            if (new Date(checkOut) <= new Date(checkIn)) {
                alert('Tanggal keluar harus setelah tanggal masuk.');
                return;
            }

            // Simulasi validasi konflik tanggal (perlu logika lebih kompleks di production)
            const konflik = AppState.pemesanan.some(b =>
                b.idProperti === idProperti && b.status === "Dikonfirmasi" &&
                (new Date(checkIn) < new Date(b.checkOut) && new Date(checkOut) > new Date(b.checkIn))
            );

            if (konflik) {
                alert('Maaf, tanggal yang Anda pilih sudah tidak tersedia atau tumpang tindih dengan pemesanan lain.');
                return;
            }

            const totalBiaya = parseFloat($('#biaya-total-detail').textContent.replace(/[^0-9]/g, ''));
            const poinDidapat = Math.floor(totalBiaya / 50000); // Contoh: 1 poin per Rp50.000

            const pemesananBaru = {
                id: 'GV' + Date.now().toString().slice(-7),
                idProperti: idProperti,
                namaProperti: properti.nama,
                checkIn: checkIn,
                checkOut: checkOut,
                status: 'Menunggu Pembayaran', // Status awal
                totalBiaya: totalBiaya,
                tamu: parseInt($('#jumlah-tamu-cari').value) || 2 // ambil dari form pencarian atau form khusus tamu
            };

            AppState.pemesanan.push(pemesananBaru);
            AppState.dataPengguna.poinLoyalitas += poinDidapat;
            properti.ulasan += 1; // Anggap setelah pesan, ada potensi ulasan (ini bisa di-trigger setelah check-out)

            alert(`Pemesanan untuk ${properti.nama} berhasil diajukan dengan ID ${pemesananBaru.id}!\nStatus: ${pemesananBaru.status}.\nAnda mendapatkan ${poinDidapat} poin loyalitas.`);

            updateStatistikDashboard();
            renderHalamanAkun(); // Update poin di halaman akun
            navigasiKe('pemesanan'); // Arahkan ke riwayat pemesanan
        }

        function handleKirimChat(event) {
            event.preventDefault();
            const inputPesan = $('#input-pesan-chat');
            const teksPesan = inputPesan.value.trim();
            if (!teksPesan) return;

            const idProperti = AppState.idPropertiDetailSaatIni;
            const chatKey = idProperti ? `properti_${idProperti}` : 'umum';
            if (!AppState.chat[chatKey]) AppState.chat[chatKey] = [];

            AppState.chat[chatKey].push({ pengirim: 'Pengguna', teks: teksPesan, waktu: new Date() });
            inputPesan.value = '';
            renderChatUntukProperti(idProperti); // Re-render chat

            // Simulasi balasan dari CS/Pemilik
            setTimeout(() => {
                const balasan = "Terima kasih atas pesan Anda. Tim kami akan segera merespons.";
                AppState.chat[chatKey].push({ pengirim: idProperti ? 'Pemilik Properti' : 'CS GreenValley', teks: balasan, waktu: new Date() });
                renderChatUntukProperti(idProperti);
            }, 1500 + Math.random() * 1000);
        }

        function handleSimpanProfil(event) {
            event.preventDefault();
            AppState.dataPengguna.nama = $('#akun-nama-profil-input').value;
            AppState.dataPengguna.email = $('#akun-email-profil-input').value;
            AppState.dataPengguna.telepon = $('#akun-telepon-profil-input').value;
            alert('Informasi profil berhasil diperbarui!');
            renderHalamanAkun(); // Re-render halaman akun
        }

        function handleKirimLaporan(event) {
            event.preventDefault();
            const kategori = $('#kategori-laporan-modal').value;
            const detail = $('#detail-masalah-laporan-modal').value.trim();
            // const lampiran = $('#lampiran-foto-laporan-modal').files[0]; // Handle file upload jika perlu

            if (!kategori || !detail) {
                alert('Harap pilih kategori dan jelaskan masalah secara rinci.');
                return;
            }
            // Di sini logika pengiriman laporan ke backend (simulasi)
            console.log("Laporan Dikirim:", {
                idProperti: AppState.idPropertiDetailSaatIni,
                kategori,
                detail,
                // namaFileLampiran: lampiran ? lampiran.name : 'Tidak ada' 
            });
            alert('Laporan Anda telah berhasil dikirim. Tim kami akan segera menindaklanjuti. Terima kasih!');

            const modalLaporan = bootstrap.Modal.getInstance($('#modalLaporanMasalah'));
            modalLaporan.hide();
            $('#form-laporan-masalah').reset();
        }

        function handleTambahUlasan(event) {
            event.preventDefault();
            const rating = parseInt($('#rating-value-input').value);
            const judul = $('#judul-ulasan-modal').value.trim();
            const isi = $('#isi-ulasan-modal').value.trim();

            if (!rating || !judul || !isi) {
                alert('Harap isi semua field: rating, judul, dan isi ulasan.');
                return;
            }
            // Logika simpan ulasan (simulasi)
            // Idealnya, ini akan ditambahkan ke data properti yang sesuai
            console.log("Ulasan Baru:", {
                idProperti: AppState.idPropertiDetailSaatIni,
                rating,
                judul,
                isi,
                pengguna: AppState.dataPengguna.nama,
                tanggal: new Date().toISOString().split('T')[0]
            });

            // Update jumlah ulasan di AppState (jika ada fieldnya)
            const propertiTerkait = AppState.properti.find(p => p.id === AppState.idPropertiDetailSaatIni);
            if (propertiTerkait) {
                propertiTerkait.ulasan = (propertiTerkait.ulasan || 0) + 1;
                // Update juga rata-rata rating (logika lebih kompleks)
            }

            alert('Terima kasih atas ulasan Anda! Ulasan Anda sangat berharga bagi kami.');

            const modalUlasan = bootstrap.Modal.getInstance($('#modalTambahUlasan'));
            modalUlasan.hide();
            $('#form-tambah-ulasan').reset();
            resetRatingBintang();
            renderDetailProperti(AppState.idPropertiDetailSaatIni); // Re-render detail untuk update jumlah ulasan
        }

        // CRUD Penyewa
        let modalPenyewaInstance = null; // Untuk Bootstrap Modal
        function handleBukaModalPenyewa(idToEdit = null) {
            const form = $('#form-manajemen-penyewa');
            form.reset();
            $('#id-penyewa-modal').value = '';
            $('#sejak-penyewa-modal').value = new Date().toISOString().split('T')[0]; // Default tanggal hari ini

            if (idToEdit) {
                const penyewa = AppState.penyewa.find(p => p.id === idToEdit);
                if (penyewa) {
                    $('#modalManajemenPenyewaLabel').innerHTML = '<i class="fas fa-user-edit me-2"></i>Edit Data Penyewa';
                    $('#id-penyewa-modal').value = penyewa.id;
                    $('#nama-penyewa-modal').value = penyewa.nama;
                    $('#email-penyewa-modal').value = penyewa.email;
                    $('#telepon-penyewa-modal').value = penyewa.telepon;
                    $('#sejak-penyewa-modal').value = penyewa.sejak;
                }
            } else {
                $('#modalManajemenPenyewaLabel').innerHTML = '<i class="fas fa-user-plus me-2"></i>Tambah Penyewa Baru';
            }
            if (!modalPenyewaInstance) {
                modalPenyewaInstance = new bootstrap.Modal($('#modalManajemenPenyewa'));
            }
            modalPenyewaInstance.show();
        }

        function handleSimpanPenyewa(event) {
            event.preventDefault();
            const id = parseInt($('#id-penyewa-modal').value);
            const nama = $('#nama-penyewa-modal').value.trim();
            const email = $('#email-penyewa-modal').value.trim();
            const telepon = $('#telepon-penyewa-modal').value.trim();
            const sejak = $('#sejak-penyewa-modal').value;

            if (!nama || !email || !telepon || !sejak) {
                alert('Semua field wajib diisi!');
                return;
            }

            if (id) { // Edit mode
                const index = AppState.penyewa.findIndex(p => p.id === id);
                if (index > -1) {
                    AppState.penyewa[index] = { ...AppState.penyewa[index], nama, email, telepon, sejak };
                }
            } else { // Add mode
                const idPenyewaBaru = AppState.penyewa.length > 0 ? Math.max(...AppState.penyewa.map(p => p.id)) + 1 : 1;
                AppState.penyewa.push({ id: idPenyewaBaru, nama, email, telepon, sejak, totalPemesanan: 0, avatar: `https://i.pravatar.cc/80?u=${email}` });
            }
            renderDaftarPenyewa();
            updateStatistikDashboard();
            modalPenyewaInstance.hide();
        }

        function handleEditPenyewa(event) {
            const idToEdit = parseInt(event.currentTarget.dataset.idPenyewa);
            handleBukaModalPenyewa(idToEdit);
        }

        function handleHapusPenyewa(event) {
            const idToDelete = parseInt(event.currentTarget.dataset.idPenyewa);
            const penyewa = AppState.penyewa.find(p => p.id === idToDelete);
            if (penyewa && confirm(`Apakah Anda yakin ingin menghapus penyewa "${penyewa.nama}"? Aksi ini tidak dapat dibatalkan.`)) {
                AppState.penyewa = AppState.penyewa.filter(p => p.id !== idToDelete);
                renderDaftarPenyewa();
                updateStatistikDashboard();
                alert(`Penyewa "${penyewa.nama}" berhasil dihapus.`);
            }
        }

        // Lihat Detail Pemesanan (Contoh sederhana)
        function lihatDetailPemesanan(idPemesanan) {
            const pemesanan = AppState.pemesanan.find(p => p.id === idPemesanan);
            if (pemesanan) {
                // Bisa buka modal atau navigasi ke halaman detail pemesanan khusus
                alert(`Detail Pemesanan:\nID: ${pemesanan.id}\nProperti: ${pemesanan.namaProperti}\nCheck-in: ${formatDateID(pemesanan.checkIn)}\nCheck-out: ${formatDateID(pemesanan.checkOut)}\nStatus: ${pemesanan.status}\nTotal: ${formatRupiah(pemesanan.totalBiaya)}`);
                // Arahkan ke detail properti terkait jika ada
                if (pemesanan.idProperti) {
                    navigasiKe('detail-properti', { id: pemesanan.idProperti });
                }
            } else {
                alert('Detail pemesanan tidak ditemukan.');
            }
        }


        // Rating Bintang Interaktif
        function setupRatingBintang() {
            const bintangContainer = $('#rating-bintang-input');
            if (!bintangContainer) return;
            const bintangInputs = bintangContainer.querySelectorAll('i');
            const ratingValueInput = $('#rating-value-input');

            bintangInputs.forEach(bintang => {
                bintang.addEventListener('mouseover', function () {
                    highlightBintang(this.dataset.value);
                });
                bintang.addEventListener('mouseout', function () {
                    highlightBintang(ratingValueInput.value || 0);
                });
                bintang.addEventListener('click', function () {
                    ratingValueInput.value = this.dataset.value;
                    highlightBintang(this.dataset.value);
                });
            });
        }
        function highlightBintang(rating) {
            const bintangInputs = $$('#rating-bintang-input i');
            bintangInputs.forEach(bintang => {
                if (bintang.dataset.value <= rating) {
                    bintang.classList.remove('far'); // Kosong
                    bintang.classList.add('fas');   // Penuh
                } else {
                    bintang.classList.remove('fas');
                    bintang.classList.add('far');
                }
            });
        }
        function resetRatingBintang() {
            $('#rating-value-input').value = '';
            highlightBintang(0);
        }


        // --- Inisialisasi Aplikasi ---
        function inisialisasiAplikasi() {
            $('#tahun-sekarang').textContent = new Date().getFullYear();
            $('#user-avatar-header').src = AppState.dataPengguna.avatar;
            $('#user-avatar-header').alt = `Avatar ${AppState.dataPengguna.nama}`;

            // Event listener untuk navigasi utama sidebar dan logo
            $$('.app-sidebar .nav-link, .app-header .logo').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const idHalaman = e.currentTarget.dataset.route;
                    if (idHalaman) navigasiKe(idHalaman);
                });
            });

            // Event listener untuk toggle sidebar di layar kecil
            $('#tombol-toggle-sidebar').addEventListener('click', () => {
                $('#appSidebar').classList.toggle('open');
            });
            // Tutup sidebar jika klik di luar area sidebar (overlay effect)
            document.addEventListener('click', (e) => {
                const sidebar = $('#appSidebar');
                const toggleButton = $('#tombol-toggle-sidebar');
                if (sidebar.classList.contains('open') && !sidebar.contains(e.target) && !toggleButton.contains(e.target)) {
                    sidebar.classList.remove('open');
                }
            });


            // Event listener untuk form-form
            $('#form-pencarian-utama').addEventListener('submit', handlePencarianProperti);
            $('#form-pemesanan-properti').addEventListener('submit', handlePemesananProperti);
            // Listener untuk update biaya saat tanggal atau asuransi berubah
            $('#booking-check-in-detail').addEventListener('change', () => perbaruiRincianBiaya(AppState.properti.find(p => p.id === AppState.idPropertiDetailSaatIni)?.harga || 0));
            $('#booking-check-out-detail').addEventListener('change', () => perbaruiRincianBiaya(AppState.properti.find(p => p.id === AppState.idPropertiDetailSaatIni)?.harga || 0));
            $('#asuransi-perjalanan-detail').addEventListener('change', () => perbaruiRincianBiaya(AppState.properti.find(p => p.id === AppState.idPropertiDetailSaatIni)?.harga || 0));

            $('#form-kirim-chat').addEventListener('submit', handleKirimChat);
            $('#form-edit-profil').addEventListener('submit', handleSimpanProfil);
            $('#form-laporan-masalah').addEventListener('submit', handleKirimLaporan);
            $('#form-tambah-ulasan').addEventListener('submit', handleTambahUlasan);

            // Listener untuk modal manajemen penyewa
            $('#btn-modal-tambah-penyewa').addEventListener('click', () => handleBukaModalPenyewa());
            $('#form-manajemen-penyewa').addEventListener('submit', handleSimpanPenyewa);

            setupRatingBintang(); // Inisialisasi rating bintang interaktif

            // Routing berdasarkan hash URL saat load awal
            window.addEventListener('popstate', (event) => {
                if (event.state && event.state.page) {
                    navigasiKe(event.state.page, event.state.params);
                } else {
                    // Jika tidak ada state (misal, refresh halaman dengan hash)
                    const hash = window.location.hash.substring(1);
                    const [pageName, queryString] = hash.split('?');
                    let params = null;
                    if (queryString) {
                        const urlParams = new URLSearchParams(queryString);
                        params = Object.fromEntries(urlParams.entries());
                        if (params.id) params.id = parseInt(params.id); // Konversi ID ke integer jika ada
                    }
                    navigasiKe(pageName || 'beranda', params);
                }
            });

            // Trigger navigasi awal berdasarkan hash saat ini atau default ke beranda
            const initialHash = window.location.hash.substring(1);
            if (initialHash) {
                const [pageName, queryString] = initialHash.split('?');
                let params = null;
                if (queryString) {
                    const urlParams = new URLSearchParams(queryString);
                    params = Object.fromEntries(urlParams.entries());
                    if (params.id) params.id = parseInt(params.id);
                }
                navigasiKe(pageName || 'beranda', params);
            } else {
                navigasiKe('beranda');
            }
        }

        // Jalankan aplikasi setelah DOM siap
        document.addEventListener('DOMContentLoaded', inisialisasiAplikasi);

    </script>
</body>

</html>