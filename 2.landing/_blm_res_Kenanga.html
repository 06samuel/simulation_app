<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description"
    content="Dashboard Manajemen Properti Premium Lembah Hijau: Kelola apartemen, transaksi, dan laporan Anda dengan mudah, elegan, dan efisien.">
  <meta name="keywords"
    content="dashboard properti, manajemen apartemen, sewa properti, real estate, investasi properti, aplikasi properti, lembah hijau, vanilla js, spa">
  <meta name="author" content="Pengembang Aplikasi Properti Lembah Hijau (AI Generated & Refined)">
  <meta name="robots" content="index, follow">
  <meta name="theme-color" content="#0A7C4D"> <!-- Warna tema utama untuk UI browser di mobile -->
  <title>Lembah Hijau | Dashboard Properti Premium</title>

  <!-- Ikon Favicon (Menggunakan Emoji sebagai alternatif non-SVG yang ringan dan universal) -->
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè¢</text></svg>">

  <!-- Preload Font Penting dan Ikon Font Awesome untuk Performa Optimal -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload"
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0;1,400..700&display=swap"
    as="style" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" as="style"
    onload="this.onload=null;this.rel='stylesheet'"
    integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
    crossorigin="anonymous" referrerpolicy="no-referrer">

  <!-- Fallback untuk browser yang tidak mendukung preload atau JavaScript dinonaktifkan -->
  <noscript>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0;1,400..700&display=swap"
      rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
      crossorigin="anonymous" referrerpolicy="no-referrer">
  </noscript>

  <style>
    /* === VARIABEL CSS GLOBAL UNTUK KONSISTENSI DAN FLEKSIBILITAS === */
    :root {
      /* Palet Warna Harmonis dan Mewah */
      --warna-primer: #0A7C4D;
      /* Hijau Tua Lembah - Elegan & Menenangkan */
      --warna-primer-terang: #1E8E5E;
      --warna-primer-gelap: #065A3A;
      --warna-sekunder: #D4AF37;
      /* Emas - Sentuhan Kemewahan */
      --warna-aksen: #F0E68C;
      /* Khaki Cerah - Untuk Highlight Halus */
      --warna-latar: #F0F4F8;
      /* Abu-abu Sangat Cerah - Bersih & Modern */
      --warna-permukaan: #FFFFFF;
      /* Putih Bersih - Untuk Kartu & Konten */
      --warna-teks-utama: #1A2529;
      /* Hitam Arang - Kontras Baik */
      --warna-teks-sekunder: #5A6B73;
      /* Abu-abu Tua - Untuk Info Tambahan */
      --warna-teks-tersier: #8899A6;
      /* Abu-abu Lebih Cerah */
      --warna-batas: #DDE4E8;
      /* Abu-abu Cerah untuk Batas Halus */
      --warna-error: #D32F2F;
      --warna-sukses: #2E7D32;
      --warna-info: #1976D2;
      --warna-peringatan: #FFA000;

      /* Tipografi yang Elegan dan Mudah Dibaca */
      --font-utama: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      --font-judul: 'Playfair Display', Georgia, serif;
      --ukuran-teks-xs: 0.75rem;
      /* 12px */
      --ukuran-teks-sm: 0.875rem;
      /* 14px */
      --ukuran-teks-base: 1rem;
      /* 16px */
      --ukuran-teks-lg: 1.125rem;
      /* 18px */
      --ukuran-teks-xl: 1.25rem;
      /* 20px */
      --ukuran-teks-2xl: 1.5rem;
      /* 24px */
      --ukuran-teks-3xl: 1.875rem;
      /* 30px (disesuaikan sedikit) */
      --ukuran-teks-4xl: 2.25rem;
      /* 36px (disesuaikan sedikit) */
      --ukuran-teks-5xl: 3rem;
      /* 48px (disesuaikan sedikit) */

      /* Spasi yang Konsisten (Skala Modular) */
      --spasi-xs: 0.25rem;
      /* 4px */
      --spasi-sm: 0.5rem;
      /* 8px */
      --spasi-md: 1rem;
      /* 16px */
      --spasi-lg: 1.5rem;
      /* 24px */
      --spasi-xl: 2rem;
      /* 32px */
      --spasi-2xl: 3rem;
      /* 48px */
      --spasi-3xl: 4rem;
      /* 64px */

      /* Efek Visual Halus dan Modern */
      --bayangan-sm: 0 2px 4px rgba(0, 0, 0, 0.06);
      --bayangan-md: 0 5px 15px rgba(0, 0, 0, 0.08);
      --bayangan-lg: 0 12px 30px rgba(0, 0, 0, 0.1);
      --radius-sm: 0.3rem;
      /* 4.8px (lebih halus) */
      --radius-md: 0.6rem;
      /* 9.6px */
      --radius-lg: 1rem;
      /* 16px */
      --radius-lingkaran: 50%;
      --transisi-cepat: all 0.2s ease-out;
      --transisi-standar: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --transisi-lambat: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);

      /* Z-Index Hirarki (Untuk Lapisan) */
      --z-dasar: 1;
      --z-konten: 10;
      --z-dropdown: 1000;
      --z-sidebar: 1500;
      --z-header-aplikasi: 1600;
      --z-modal-latar: 2000;
      --z-modal: 2100;
      --z-notifikasi-toast: 3000;
      --z-loading-overlay: 9999;

      /* Lebar Sidebar */
      --lebar-sidebar: 270px;
      /* Sedikit lebih lebar untuk kenyamanan */
      --lebar-sidebar-mini: 75px;
      /* Sedikit lebih lebar untuk ikon */
    }

    /* === DARK MODE VARIABLES === */
    body.dark-mode {
      --warna-latar: #1A202C;
      /* Abu-abu Gelap Kebiruan (mirip Tailwind Dark) */
      --warna-permukaan: #2D3748;
      /* Abu-abu Lebih Cerah untuk Kartu */
      --warna-teks-utama: #E2E8F0;
      /* Putih Kebiruan */
      --warna-teks-sekunder: #A0AEC0;
      /* Abu-abu Cerah */
      --warna-teks-tersier: #718096;
      --warna-batas: #4A5568;
      /* Batas Lebih Gelap */
      --bayangan-sm: 0 2px 4px rgba(0, 0, 0, 0.15);
      --bayangan-md: 0 5px 15px rgba(0, 0, 0, 0.20);
      --bayangan-lg: 0 12px 30px rgba(0, 0, 0, 0.25);
    }

    /* === RESET CSS DAN GAYA DASAR YANG DISEMPURNAKAN === */
    *,
    *::before,
    *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      font-size: 100%;
      /* 16px default */
      scroll-behavior: smooth;
      -webkit-text-size-adjust: 100%;
      -webkit-tap-highlight-color: transparent;
      /* Hilangkan highlight biru di mobile saat tap */
    }

    body {
      font-family: var(--font-utama);
      color: var(--warna-teks-utama);
      background-color: var(--warna-latar);
      line-height: 1.65;
      /* Sedikit lebih lega */
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
      overflow-x: hidden;
      /* Mencegah scroll horizontal yang tidak diinginkan */
      display: flex;
      /* Untuk layout sidebar + konten utama */
      transition: background-color var(--transisi-standar), color var(--transisi-standar);
    }

    /* === AKSESIBILITAS: Fokus yang terlihat jelas === */
    :focus-visible {
      outline: 3px solid var(--warna-sekunder);
      outline-offset: 3px;
      /* Lebih jelas */
      box-shadow: 0 0 0 5px rgba(212, 175, 55, 0.35);
      border-radius: var(--radius-sm);
    }

    *:focus:not(:focus-visible) {
      /* Hilangkan outline default jika bukan :focus-visible */
      outline: none;
    }

    /* === TIPOGRAFI YANG LEBIH FANCY DAN KONSISTEN === */
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-family: var(--font-judul);
      font-weight: 700;
      line-height: 1.3;
      color: var(--warna-primer-gelap);
      margin-top: 0;
      /* Reset margin atas default */
      margin-bottom: var(--spasi-md);
      letter-spacing: -0.5px;
      /* Sentuhan halus */
    }

    body.dark-mode h1,
    body.dark-mode h2,
    body.dark-mode h3,
    body.dark-mode h4,
    body.dark-mode h5,
    body.dark-mode h6 {
      color: var(--warna-aksen);
    }

    h1 {
      font-size: var(--ukuran-teks-4xl);
    }

    h2 {
      font-size: var(--ukuran-teks-3xl);
    }

    h3 {
      font-size: var(--ukuran-teks-2xl);
    }

    h4 {
      font-size: var(--ukuran-teks-xl);
    }

    h5 {
      font-size: var(--ukuran-teks-lg);
    }

    h6 {
      font-size: var(--ukuran-teks-base);
      font-weight: 600;
    }

    p {
      margin-bottom: var(--spasi-md);
      max-width: 70ch;
      /* Batas lebar untuk keterbacaan */
      color: var(--warna-teks-sekunder);
    }

    body.dark-mode p {
      color: var(--warna-teks-sekunder);
    }

    a {
      color: var(--warna-primer);
      text-decoration: none;
      transition: color var(--transisi-cepat), text-decoration-color var(--transisi-cepat);
    }

    a:hover {
      color: var(--warna-primer-gelap);
      text-decoration: underline;
      text-decoration-color: var(--warna-primer-terang);
    }

    body.dark-mode a {
      color: var(--warna-primer-terang);
    }

    body.dark-mode a:hover {
      color: var(--warna-aksen);
      text-decoration-color: var(--warna-sekunder);
    }

    img,
    video,
    canvas {
      max-width: 100%;
      height: auto;
      display: block;
      object-fit: cover;
      /* Umumnya lebih baik dari contain untuk UI cards */
      border-style: none;
      /* Hilangkan border default pada gambar di IE */
    }

    .icon-header {
      /* Untuk ikon di samping judul halaman */
      margin-right: var(--spasi-sm);
      color: var(--warna-primer);
      font-size: 0.9em;
      /* Relatif terhadap ukuran H1 */
    }

    body.dark-mode .icon-header {
      color: var(--warna-aksen);
    }

    /* === UTILITAS LAYOUT DAN PEMBANTU === */
    .container-fluid {
      width: 100%;
      padding-left: var(--spasi-lg);
      padding-right: var(--spasi-lg);
      margin-left: auto;
      margin-right: auto;
    }

    .container {
      max-width: 1280px;
      /* Sedikit lebih lebar untuk tampilan modern */
      padding-left: var(--spasi-lg);
      padding-right: var(--spasi-lg);
      margin-left: auto;
      margin-right: auto;
    }

    .section-padding {
      padding-top: var(--spasi-2xl);
      padding-bottom: var(--spasi-2xl);
    }

    .text-center {
      text-align: center;
    }

    .margin-bottom-lg {
      margin-bottom: var(--spasi-lg);
    }

    .hidden {
      display: none !important;
      visibility: hidden !important;
    }

    .visually-hidden {
      /* Untuk aksesibilitas, sembunyikan visual tapi tetap dibaca screen reader */
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Flexbox Utilities (sudah cukup baik, mungkin perlu sedikit penyesuaian gap) */
    .d-flex {
      display: flex;
    }

    .flex-column {
      flex-direction: column;
    }

    .justify-content-start {
      justify-content: flex-start;
    }

    .justify-content-end {
      justify-content: flex-end;
    }

    .justify-content-center {
      justify-content: center;
    }

    .justify-content-between {
      justify-content: space-between;
    }

    .justify-content-around {
      justify-content: space-around;
    }

    .align-items-start {
      align-items: flex-start;
    }

    .align-items-end {
      align-items: flex-end;
    }

    .align-items-center {
      align-items: center;
    }

    .align-items-baseline {
      align-items: baseline;
    }

    .flex-grow-1 {
      flex-grow: 1;
    }

    .gap-xs {
      gap: var(--spasi-xs);
    }

    .gap-sm {
      gap: var(--spasi-sm);
    }

    .gap-md {
      gap: var(--spasi-md);
    }

    .gap-lg {
      gap: var(--spasi-lg);
    }

    .gap-xl {
      gap: var(--spasi-xl);
    }

    /* Grid Utilities (sudah cukup baik) */
    .grid-container {
      display: grid;
      gap: var(--spasi-lg);
    }

    .grid-cols-1 {
      grid-template-columns: repeat(1, minmax(0, 1fr));
    }

    .grid-cols-2 {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    .grid-cols-3 {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }

    .grid-cols-4 {
      grid-template-columns: repeat(4, minmax(0, 1fr));
    }

    .property-grid {
      /* Responsive grid untuk daftar properti */
      display: grid;
      gap: var(--spasi-lg);
      grid-template-columns: repeat(auto-fit, minmax(min(100%, 320px), 1fr));
      /* Ukuran min properti lebih besar */
    }

    /* === SIDEBAR NAVIGASI YANG LEBIH FANCY === */
    .sidebar {
      width: var(--lebar-sidebar);
      height: 100vh;
      background-color: var(--warna-permukaan);
      border-right: 1px solid var(--warna-batas);
      padding: var(--spasi-lg) var(--spasi-md);
      position: fixed;
      top: 0;
      left: 0;
      z-index: var(--z-sidebar);
      transition: width var(--transisi-standar), padding var(--transisi-standar), transform var(--transisi-standar);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      box-shadow: var(--bayangan-sm);
    }

    .sidebar.mini {
      width: var(--lebar-sidebar-mini);
      padding: var(--spasi-lg) var(--spasi-sm);
    }

    .sidebar .logo-details {
      display: flex;
      align-items: center;
      gap: var(--spasi-md);
      /* Sedikit lebih besar */
      margin-bottom: var(--spasi-2xl);
      padding: var(--spasi-sm) 0;
      min-height: 50px;
      /* Agar stabil saat mini */
    }

    .sidebar .logo-details .logo-icon {
      font-size: var(--ukuran-teks-3xl);
      color: var(--warna-primer);
      min-width: 45px;
      /* Disesuaikan dengan --lebar-sidebar-mini */
      text-align: center;
      transition: transform var(--transisi-cepat);
    }

    .sidebar:not(.mini) .logo-details .logo-icon:hover {
      transform: rotate(-10deg) scale(1.1);
    }

    .sidebar .logo-details .logo-name {
      font-family: var(--font-judul);
      font-size: var(--ukuran-teks-2xl);
      color: var(--warna-primer-gelap);
      font-weight: 700;
      white-space: nowrap;
      opacity: 1;
      transition: opacity var(--transisi-cepat) 0.1s;
      /* Delay agar tidak hilang terlalu cepat */
    }

    .sidebar.mini .logo-details .logo-name {
      opacity: 0;
      pointer-events: none;
    }

    .sidebar .nav-list {
      list-style: none;
      flex-grow: 1;
    }

    .sidebar .nav-list .nav-link {
      display: flex;
      align-items: center;
      padding: calc(var(--spasi-sm) + 2px) var(--spasi-md);
      /* Lebih tinggi sedikit */
      margin-bottom: var(--spasi-sm);
      border-radius: var(--radius-md);
      color: var(--warna-teks-sekunder);
      transition: background-color var(--transisi-cepat), color var(--transisi-cepat), box-shadow var(--transisi-cepat), transform var(--transisi-cepat);
      white-space: nowrap;
      overflow: hidden;
      position: relative;
      /* Untuk pseudo-element ::before */
    }

    .sidebar .nav-list .nav-link .icon {
      font-size: var(--ukuran-teks-lg);
      margin-right: var(--spasi-md);
      min-width: 28px;
      /* Sedikit lebih besar */
      text-align: center;
      transition: margin-right var(--transisi-cepat);
      z-index: 2;
    }

    .sidebar.mini .nav-list .nav-link .icon {
      margin-right: 0;
    }

    .sidebar .nav-list .nav-link .link-name {
      opacity: 1;
      transition: opacity var(--transisi-cepat) 0.1s;
      z-index: 2;
    }

    .sidebar.mini .nav-list .nav-link .link-name {
      opacity: 0;
      pointer-events: none;
    }

    .sidebar .nav-list .nav-link:hover {
      background-color: var(--warna-primer-terang);
      color: var(--warna-permukaan);
      transform: translateX(5px);
      box-shadow: var(--bayangan-sm);
    }

    .sidebar .nav-list .nav-link.active {
      background-color: var(--warna-primer);
      color: var(--warna-permukaan);
      font-weight: 600;
      box-shadow: var(--bayangan-md);
    }

    .sidebar .nav-list .nav-link.active::before {
      /* Indikator aktif yang fancy */
      content: '';
      position: absolute;
      left: 0;
      top: 15%;
      bottom: 15%;
      width: 4px;
      background-color: var(--warna-sekunder);
      border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
    }

    body.dark-mode .sidebar .nav-list .nav-link:hover {
      background-color: var(--warna-primer);
    }

    body.dark-mode .sidebar .nav-list .nav-link.active {
      background-color: var(--warna-primer-gelap);
    }

    /* Badge notifikasi di sidebar */
    .sidebar .nav-list .nav-link .badge-nav {
      margin-left: auto;
      font-size: 0.7rem;
      padding: 3px 7px;
      border-radius: var(--radius-lingkaran);
      background-color: var(--warna-error);
      color: white;
      font-weight: bold;
      line-height: 1;
      transition: opacity var(--transisi-cepat) 0.1s;
      z-index: 2;
    }

    .sidebar.mini .nav-list .nav-link .badge-nav {
      opacity: 0;
      pointer-events: none;
    }


    .sidebar .profile-details {
      margin-top: auto;
      padding: var(--spasi-md) 0;
      border-top: 1px solid var(--warna-batas);
    }

    .sidebar .profile-link {
      display: flex;
      align-items: center;
      padding: var(--spasi-sm);
      border-radius: var(--radius-md);
      color: var(--warna-teks-sekunder);
      transition: background-color var(--transisi-cepat);
    }

    .sidebar.mini .profile-link {
      justify-content: center;
    }

    .sidebar .profile-link:hover {
      background-color: rgba(0, 0, 0, 0.04);
    }

    body.dark-mode .sidebar .profile-link:hover {
      background-color: rgba(255, 255, 255, 0.04);
    }

    .sidebar .profile-link .profile-image {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-lingkaran);
      object-fit: cover;
      margin-right: var(--spasi-sm);
      border: 2px solid var(--warna-sekunder);
      transition: transform var(--transisi-cepat);
    }

    .sidebar .profile-link:hover .profile-image {
      transform: scale(1.1);
    }

    .sidebar.mini .profile-link .profile-image {
      margin-right: 0;
    }

    .sidebar .profile-link .profile-content {
      display: flex;
      flex-direction: column;
      white-space: nowrap;
      opacity: 1;
      transition: opacity var(--transisi-cepat) 0.1s;
    }

    .sidebar.mini .profile-link .profile-content {
      opacity: 0;
      pointer-events: none;
    }

    .sidebar .profile-link .name {
      font-weight: 600;
      font-size: var(--ukuran-teks-base);
    }

    .sidebar .profile-link .role {
      font-size: var(--ukuran-teks-xs);
      color: var(--warna-teks-tersier);
    }

    /* === KONTEN UTAMA === */
    .main-wrapper {
      margin-left: var(--lebar-sidebar);
      width: calc(100% - var(--lebar-sidebar));
      min-height: 100vh;
      transition: margin-left var(--transisi-standar), width var(--transisi-standar);
      display: flex;
      flex-direction: column;
      background-color: var(--warna-latar);
      /* Pastikan latar konten juga berubah */
    }

    .main-wrapper.sidebar-mini {
      margin-left: var(--lebar-sidebar-mini);
      width: calc(100% - var(--lebar-sidebar-mini));
    }

    /* Header Aplikasi di Konten Utama */
    .app-header {
      background-color: var(--warna-permukaan);
      padding: var(--spasi-md) var(--spasi-lg);
      border-bottom: 1px solid var(--warna-batas);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: var(--z-header-aplikasi);
      box-shadow: var(--bayangan-sm);
    }

    .app-header .header-left {
      display: flex;
      align-items: center;
      gap: var(--spasi-md);
    }

    .app-header #sidebar-toggle {
      font-size: var(--ukuran-teks-xl);
      background: none;
      border: none;
      color: var(--warna-teks-sekunder);
      cursor: pointer;
      padding: var(--spasi-sm);
      border-radius: var(--radius-sm);
      transition: background-color var(--transisi-cepat), color var(--transisi-cepat);
    }

    .app-header #sidebar-toggle:hover {
      background-color: rgba(0, 0, 0, 0.05);
      color: var(--warna-primer);
    }

    body.dark-mode .app-header #sidebar-toggle:hover {
      background-color: rgba(255, 255, 255, 0.05);
      color: var(--warna-primer-terang);
    }

    .app-header .search-bar {
      position: relative;
    }

    .app-header .search-bar input {
      padding: var(--spasi-sm) var(--spasi-md);
      padding-left: calc(var(--spasi-md) + var(--spasi-lg) + var(--spasi-xs));
      /* Ruang untuk ikon lebih banyak */
      border: 1px solid var(--warna-batas);
      border-radius: var(--radius-md);
      min-width: 300px;
      /* Lebih lebar */
      font-size: var(--ukuran-teks-sm);
      background-color: var(--warna-latar);
      transition: border-color var(--transisi-cepat), box-shadow var(--transisi-cepat);
    }

    .app-header .search-bar input:focus {
      border-color: var(--warna-primer);
      box-shadow: 0 0 0 3px rgba(10, 124, 77, 0.15);
    }

    body.dark-mode .app-header .search-bar input {
      background-color: var(--warna-teks-utama);
      color: var(--warna-latar);
      border-color: var(--warna-teks-sekunder);
    }

    body.dark-mode .app-header .search-bar input:focus {
      border-color: var(--warna-primer-terang);
      box-shadow: 0 0 0 3px rgba(30, 142, 94, 0.15);
    }

    .app-header .search-bar .search-icon {
      position: absolute;
      left: var(--spasi-md);
      top: 50%;
      transform: translateY(-50%);
      color: var(--warna-teks-tersier);
      pointer-events: none;
      /* Agar tidak mengganggu klik input */
    }

    .app-header .header-right {
      display: flex;
      align-items: center;
      gap: var(--spasi-md);
    }

    /* Gap lebih kecil */
    .app-header .icon-button {
      background: none;
      border: none;
      color: var(--warna-teks-sekunder);
      font-size: var(--ukuran-teks-xl);
      cursor: pointer;
      width: 40px;
      height: 40px;
      /* Ukuran tetap untuk alignment */
      border-radius: var(--radius-lingkaran);
      /* Lingkaran penuh */
      position: relative;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      transition: background-color var(--transisi-cepat), color var(--transisi-cepat);
    }

    .app-header .icon-button:hover {
      background-color: rgba(0, 0, 0, 0.05);
      color: var(--warna-primer);
    }

    body.dark-mode .app-header .icon-button:hover {
      background-color: rgba(255, 255, 255, 0.05);
      color: var(--warna-primer-terang);
    }

    .app-header .icon-button .badge {
      position: absolute;
      top: 4px;
      right: 4px;
      /* Disesuaikan untuk lingkaran */
      background-color: var(--warna-error);
      color: white;
      font-size: 0.65rem;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      border: 2px solid var(--warna-permukaan);
      /* Efek "cutout" */
      line-height: 1;
    }

    #main-content-area {
      padding: var(--spasi-xl);
      /* Padding lebih konsisten */
      flex-grow: 1;
    }

    /* === FOOTER APLIKASI === */
    .app-footer {
      text-align: center;
      padding: var(--spasi-lg);
      border-top: 1px solid var(--warna-batas);
      background-color: var(--warna-permukaan);
      font-size: var(--ukuran-teks-sm);
      color: var(--warna-teks-tersier);
    }

    /* === KARTU (CARD) YANG LEBIH FANCY === */
    .card {
      background-color: var(--warna-permukaan);
      border-radius: var(--radius-lg);
      box-shadow: var(--bayangan-md);
      padding: var(--spasi-lg);
      transition: box-shadow var(--transisi-standar), transform var(--transisi-standar);
      margin-bottom: var(--spasi-lg);
    }

    .card:hover {
      transform: translateY(-5px) scale(1.01);
      /* Efek angkat lebih jelas */
      box-shadow: var(--bayangan-lg);
    }

    .card-header {
      padding-bottom: var(--spasi-md);
      margin-bottom: var(--spasi-md);
      border-bottom: 1px solid var(--warna-batas);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card-header h3,
    .card-header h4 {
      margin-bottom: 0;
    }

    .card-title {
      font-family: var(--font-judul);
      font-size: var(--ukuran-teks-xl);
      color: var(--warna-primer-gelap);
      margin-bottom: var(--spasi-sm);
    }

    body.dark-mode .card-title {
      color: var(--warna-aksen);
    }

    .card-subtitle {
      font-size: var(--ukuran-teks-sm);
      color: var(--warna-teks-sekunder);
      margin-bottom: var(--spasi-md);
    }

    /* === TOMBOL (BUTTON) YANG LEBIH FANCY === */
    .button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--spasi-sm);
      padding: calc(var(--spasi-sm) + 2px) var(--spasi-lg);
      /* Padding vertikal sedikit lebih */
      font-size: var(--ukuran-teks-base);
      font-weight: 600;
      border-radius: var(--radius-md);
      border: 1px solid transparent;
      cursor: pointer;
      transition: var(--transisi-standar);
      text-transform: capitalize;
      letter-spacing: 0.5px;
      white-space: nowrap;
      box-shadow: var(--bayangan-sm);
      position: relative;
      /* Untuk efek ripple/shine jika ditambahkan */
      overflow: hidden;
    }

    .button .icon {
      font-size: 1.1em;
      /* Relatif terhadap font tombol */
    }

    .button-primary {
      background-color: var(--warna-primer);
      color: #fff;
      border-color: var(--warna-primer);
    }

    .button-primary:hover {
      background-color: var(--warna-primer-gelap);
      border-color: var(--warna-primer-gelap);
      box-shadow: var(--bayangan-md);
      transform: translateY(-2px);
    }

    .button-secondary {
      background-color: var(--warna-sekunder);
      color: var(--warna-teks-utama);
      border-color: var(--warna-sekunder);
    }

    .button-secondary:hover {
      background-color: #B89A2E;
      border-color: #B89A2E;
      box-shadow: var(--bayangan-md);
      transform: translateY(-2px);
    }

    body.dark-mode .button-secondary {
      color: var(--warna-teks-utama);
    }

    /* Pastikan kontras di dark mode */

    .button-outline-primary {
      background-color: transparent;
      color: var(--warna-primer);
      border-color: var(--warna-primer);
    }

    .button-outline-primary:hover {
      background-color: var(--warna-primer);
      color: #fff;
      transform: translateY(-2px);
    }

    body.dark-mode .button-outline-primary {
      color: var(--warna-primer-terang);
      border-color: var(--warna-primer-terang);
    }

    body.dark-mode .button-outline-primary:hover {
      background-color: var(--warna-primer-terang);
      color: var(--warna-teks-utama);
    }

    .button-danger {
      background-color: var(--warna-error);
      color: #fff;
      border-color: var(--warna-error);
    }

    .button-danger:hover {
      background-color: #A02323;
      border-color: #A02323;
      box-shadow: var(--bayangan-md);
      transform: translateY(-2px);
    }

    .button-sm {
      padding: var(--spasi-xs) var(--spasi-sm);
      font-size: var(--ukuran-teks-sm);
    }

    .button-lg {
      padding: var(--spasi-md) var(--spasi-xl);
      font-size: var(--ukuran-teks-lg);
    }

    .button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .button-group {
      display: flex;
      gap: var(--spasi-sm);
    }

    /* === FORMULIR YANG LEBIH FANCY === */
    .form-group {
      margin-bottom: var(--spasi-lg);
    }

    .form-label {
      display: block;
      font-weight: 600;
      margin-bottom: var(--spasi-sm);
      color: var(--warna-teks-utama);
      /* Label lebih jelas */
      font-size: var(--ukuran-teks-sm);
    }

    body.dark-mode .form-label {
      color: var(--warna-teks-utama);
    }

    .form-control {
      display: block;
      width: 100%;
      padding: var(--spasi-sm) var(--spasi-md);
      font-size: var(--ukuran-teks-base);
      line-height: 1.5;
      color: var(--warna-teks-utama);
      background-color: var(--warna-permukaan);
      background-clip: padding-box;
      border: 1px solid var(--warna-batas);
      border-radius: var(--radius-md);
      transition: border-color var(--transisi-cepat), box-shadow var(--transisi-cepat);
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
      /* Sedikit inner shadow */
    }

    .form-control:focus {
      border-color: var(--warna-primer);
      outline: 0;
      box-shadow: 0 0 0 0.25rem rgba(10, 124, 77, 0.2);
      /* Shadow lebih halus */
    }

    body.dark-mode .form-control {
      background-color: var(--warna-latar);
      color: var(--warna-teks-utama);
      border-color: var(--warna-teks-sekunder);
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .form-control:focus {
      border-color: var(--warna-primer-terang);
      box-shadow: 0 0 0 0.25rem rgba(30, 142, 94, 0.2);
    }

    .form-control.is-invalid {
      border-color: var(--warna-error) !important;
    }

    /* Important untuk override fokus */
    .form-control.is-invalid:focus {
      box-shadow: 0 0 0 0.25rem rgba(211, 47, 47, 0.2);
    }

    .error-message {
      display: block;
      color: var(--warna-error);
      font-size: var(--ukuran-teks-sm);
      margin-top: var(--spasi-xs);
      font-weight: 500;
    }

    textarea.form-control {
      min-height: 120px;
      resize: vertical;
    }

    /* === MODAL YANG LEBIH FANCY === */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(26, 37, 41, 0.7);
      /* Warna latar lebih gelap dan solid */
      backdrop-filter: blur(8px);
      /* Efek blur lebih kuat */
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: var(--z-modal-latar);
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transisi-standar), visibility 0s var(--transisi-standar);
    }

    .modal.active {
      opacity: 1;
      visibility: visible;
      transition-delay: 0s;
    }

    .modal-dialog {
      background-color: var(--warna-permukaan);
      border-radius: var(--radius-lg);
      box-shadow: var(--bayangan-lg);
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow: hidden;
      /* Untuk border-radius pada header/footer */
      display: flex;
      flex-direction: column;
      transform: scale(0.9) translateY(20px);
      /* Efek muncul lebih dinamis */
      transition: transform var(--transisi-standar) 0.05s, opacity var(--transisi-standar);
      opacity: 0;
    }

    .modal.active .modal-dialog {
      transform: scale(1) translateY(0);
      opacity: 1;
    }

    .modal-header {
      padding: var(--spasi-lg);
      border-bottom: 1px solid var(--warna-batas);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-family: var(--font-judul);
      font-size: var(--ukuran-teks-2xl);
      color: var(--warna-primer-gelap);
      margin: 0;
    }

    body.dark-mode .modal-title {
      color: var(--warna-aksen);
    }

    .modal-header .close-button {
      background: none;
      border: none;
      font-size: var(--ukuran-teks-2xl);
      color: var(--warna-teks-tersier);
      cursor: pointer;
      padding: var(--spasi-xs);
      line-height: 1;
      /* Pastikan tinggi tombol konsisten */
      transition: color var(--transisi-cepat), transform var(--transisi-cepat);
    }

    .modal-header .close-button:hover {
      color: var(--warna-error);
      transform: rotate(90deg);
    }

    .modal-body {
      padding: var(--spasi-lg);
      flex-grow: 1;
      overflow-y: auto;
    }

    .modal-footer {
      padding: var(--spasi-lg);
      border-top: 1px solid var(--warna-batas);
      display: flex;
      justify-content: flex-end;
      gap: var(--spasi-md);
      background-color: var(--warna-latar);
      /* Footer modal dengan warna beda sedikit */
    }

    body.dark-mode .modal-footer {
      background-color: #2D3748;
      /* Disesuaikan dengan --warna-permukaan dark */
    }

    /* === KARTU PROPERTI (Contoh spesifik) === */
    .property-card {
      display: flex;
      flex-direction: column;
      overflow: hidden;
      cursor: pointer;
    }

    .property-card-image-wrapper {
      width: 100%;
      aspect-ratio: 16 / 10;
      overflow: hidden;
      border-bottom: 3px solid var(--warna-sekunder);
      /* Aksen warna */
    }

    .property-card-image-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
      /* Transisi lebih smooth */
    }

    .property-card:hover .property-card-image-wrapper img {
      transform: scale(1.1);
    }

    .property-card-content {
      padding: var(--spasi-md);
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .property-card-content h3 {
      font-size: var(--ukuran-teks-lg);
      margin-bottom: var(--spasi-sm);
      color: var(--warna-primer-gelap);
      /* Pastikan warna judul properti */
    }

    body.dark-mode .property-card-content h3 {
      color: var(--warna-aksen);
    }

    .property-card-content p {
      font-size: var(--ukuran-teks-sm);
      color: var(--warna-teks-sekunder);
      margin-bottom: var(--spasi-xs);
      display: flex;
      align-items: center;
      gap: var(--spasi-xs);
      /* Gap lebih kecil */
    }

    .property-card-content p .icon {
      color: var(--warna-primer);
      font-size: 0.9em;
    }

    .property-card-content .price {
      font-size: var(--ukuran-teks-lg);
      font-weight: 700;
      color: var(--warna-sekunder);
      margin-top: var(--spasi-sm);
      margin-bottom: var(--spasi-md);
    }

    .property-actions {
      margin-top: auto;
      padding-top: var(--spasi-md);
      border-top: 1px solid var(--warna-batas);
      display: flex;
      gap: var(--spasi-sm);
      justify-content: flex-end;
      /* Tombol ke kanan */
    }

    .property-actions .button {
      font-size: var(--ukuran-teks-sm);
      padding: var(--spasi-xs) var(--spasi-sm);
    }

    /* Pesan Informasi/Error/Sukses Global */
    .info-message,
    .error-global-message,
    .success-global-message,
    .warning-global-message {
      padding: var(--spasi-md);
      border-radius: var(--radius-md);
      margin-bottom: var(--spasi-lg);
      display: flex;
      align-items: center;
      gap: var(--spasi-md);
      font-weight: 500;
    }

    .info-message {
      background-color: #E0F7FA;
      color: #006064;
      border: 1px solid #B2EBF2;
    }

    body.dark-mode .info-message {
      background-color: #00303A;
      color: #B2EBF2;
      border-color: #004D40;
    }

    .error-global-message {
      background-color: #FFEBEE;
      color: #C62828;
      border: 1px solid #FFCDD2;
    }

    body.dark-mode .error-global-message {
      background-color: #4E1216;
      color: #FFCDD2;
      border-color: #C62828;
    }

    .success-global-message {
      background-color: #E8F5E9;
      color: #2E7D32;
      border: 1px solid #C8E6C9;
    }

    body.dark-mode .success-global-message {
      background-color: #153B1B;
      color: #C8E6C9;
      border-color: #2E7D32;
    }

    .warning-global-message {
      background-color: #FFF8E1;
      color: #FF8F00;
      border: 1px solid #FFECB3;
    }

    body.dark-mode .warning-global-message {
      background-color: #533100;
      color: #FFECB3;
      border-color: #FF8F00;
    }


    /* Notifikasi Toast yang Lebih Fancy */
    .toast-notifications {
      position: fixed;
      bottom: var(--spasi-lg);
      /* Pindah ke bawah agar tidak menutupi header */
      right: var(--spasi-lg);
      z-index: var(--z-notifikasi-toast);
      display: flex;
      flex-direction: column;
      gap: var(--spasi-md);
    }

    .toast {
      background-color: var(--warna-permukaan);
      color: var(--warna-teks-utama);
      padding: var(--spasi-md) var(--spasi-lg);
      border-radius: var(--radius-md);
      box-shadow: var(--bayangan-lg);
      min-width: 300px;
      max-width: 380px;
      opacity: 0;
      transform: translateX(120%);
      /* Mulai dari luar kanan */
      transition: opacity 0.4s ease, transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      /* Transisi dengan bounce */
      display: flex;
      align-items: flex-start;
      /* Align start untuk teks panjang */
      gap: var(--spasi-md);
      border-left: 5px solid;
      /* Indikator tipe */
    }

    .toast.show {
      opacity: 1;
      transform: translateX(0);
    }

    .toast .toast-icon {
      font-size: var(--ukuran-teks-xl);
      margin-top: 2px;
    }

    .toast.success {
      border-left-color: var(--warna-sukses);
    }

    .toast.success .toast-icon {
      color: var(--warna-sukses);
    }

    .toast.error {
      border-left-color: var(--warna-error);
    }

    .toast.error .toast-icon {
      color: var(--warna-error);
    }

    .toast.info {
      border-left-color: var(--warna-info);
    }

    .toast.info .toast-icon {
      color: var(--warna-info);
    }

    .toast.warning {
      border-left-color: var(--warna-peringatan);
    }

    .toast.warning .toast-icon {
      color: var(--warna-peringatan);
    }

    .toast .toast-message {
      flex-grow: 1;
      font-size: var(--ukuran-teks-sm);
    }

    /* Loading Placeholder yang Elegan */
    #loading-placeholder {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--warna-latar);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: var(--z-loading-overlay);
      transition: opacity var(--transisi-lambat), visibility 0s var(--transisi-lambat);
    }

    #loading-placeholder .spinner {
      width: 70px;
      height: 70px;
      border: 6px solid var(--warna-batas);
      border-top-color: var(--warna-primer);
      border-radius: 50%;
      animation: spin 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
    }

    body.dark-mode #loading-placeholder .spinner {
      border-color: var(--warna-batas);
      border-top-color: var(--warna-primer-terang);
    }

    #loading-placeholder p {
      margin-top: var(--spasi-lg);
      font-size: var(--ukuran-teks-lg);
      color: var(--warna-primer);
      font-family: var(--font-judul);
      letter-spacing: 0.5px;
    }

    body.dark-mode #loading-placeholder p {
      color: var(--warna-primer-terang);
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Halaman Laporan (contoh styling) */
    .report-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: var(--spasi-lg);
      margin-bottom: var(--spasi-2xl);
    }

    .stat-card {
      background-color: var(--warna-permukaan);
      padding: var(--spasi-lg);
      border-radius: var(--radius-md);
      box-shadow: var(--bayangan-sm);
      display: flex;
      align-items: center;
      gap: var(--spasi-lg);
      transition: transform var(--transisi-cepat), box-shadow var(--transisi-cepat);
    }

    .stat-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--bayangan-md);
    }

    .stat-card .stat-icon {
      font-size: var(--ukuran-teks-3xl);
      color: var(--warna-primer);
      padding: var(--spasi-md);
      /* Padding lebih besar */
      background-color: rgba(10, 124, 77, 0.1);
      border-radius: var(--radius-lingkaran);
    }

    body.dark-mode .stat-card .stat-icon {
      background-color: rgba(30, 142, 94, 0.2);
      color: var(--warna-primer-terang);
    }

    .stat-card .stat-info h4 {
      font-size: var(--ukuran-teks-2xl);
      font-family: var(--font-utama);
      color: var(--warna-teks-utama);
      margin-bottom: var(--spasi-xs);
      font-weight: 700;
    }

    .stat-card .stat-info p {
      font-size: var(--ukuran-teks-sm);
      color: var(--warna-teks-sekunder);
      margin-bottom: 0;
    }

    .transaction-list {
      list-style: none;
      padding: 0;
    }

    .transaction-list li {
      background-color: var(--warna-permukaan);
      padding: var(--spasi-md) var(--spasi-lg);
      border-radius: var(--radius-md);
      margin-bottom: var(--spasi-md);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid var(--warna-batas);
      transition: box-shadow var(--transisi-cepat);
    }

    .transaction-list li:hover {
      box-shadow: var(--bayangan-sm);
    }

    .transaction-list li:last-child {
      margin-bottom: 0;
    }

    .transaction-list .transaction-details strong {
      color: var(--warna-teks-utama);
    }

    .transaction-amount-income {
      color: var(--warna-sukses);
      font-weight: 700;
      font-size: var(--ukuran-teks-lg);
    }

    .transaction-amount-expense {
      color: var(--warna-error);
      font-weight: 700;
      font-size: var(--ukuran-teks-lg);
    }

    /* Halaman Notifikasi */
    .notification-list {
      list-style: none;
      padding: 0;
    }

    .notification-item {
      background-color: var(--warna-permukaan);
      padding: var(--spasi-lg);
      border-radius: var(--radius-md);
      margin-bottom: var(--spasi-md);
      border-left: 5px solid var(--warna-info);
      /* Border lebih tebal */
      display: flex;
      gap: var(--spasi-md);
      align-items: flex-start;
      box-shadow: var(--bayangan-sm);
      transition: box-shadow var(--transisi-cepat);
      position: relative;
    }

    .notification-item:hover {
      box-shadow: var(--bayangan-md);
    }

    .notification-item.type-success {
      border-left-color: var(--warna-sukses);
    }

    .notification-item.type-warning {
      border-left-color: var(--warna-peringatan);
    }

    .notification-item.type-error {
      border-left-color: var(--warna-error);
    }

    .notification-item.read {
      opacity: 0.7;
      background-color: var(--warna-latar);
    }

    /* Visual untuk notif terbaca */
    body.dark-mode .notification-item.read {
      background-color: #232B38;
    }

    .notification-icon {
      font-size: var(--ukuran-teks-xl);
      padding-top: 2px;
      /* Alignment vertikal halus */
      min-width: 24px;
      /* Untuk konsistensi */
    }

    .notification-item.type-info .notification-icon {
      color: var(--warna-info);
    }

    .notification-item.type-success .notification-icon {
      color: var(--warna-sukses);
    }

    .notification-item.type-warning .notification-icon {
      color: var(--warna-peringatan);
    }

    .notification-item.type-error .notification-icon {
      color: var(--warna-error);
    }

    .notification-message {
      flex-grow: 1;
    }

    .notification-timestamp {
      font-size: var(--ukuran-teks-xs);
      color: var(--warna-teks-tersier);
      margin-top: var(--spasi-xs);
    }

    .notification-item .mark-read-btn {
      position: absolute;
      top: var(--spasi-sm);
      right: var(--spasi-sm);
      padding: var(--spasi-xs) var(--spasi-sm);
    }

    /* === RESPONSIVE DESIGN === */
    @media (max-width: 1024px) {

      /* Tablet landscape dan di bawahnya */
      .app-header .search-bar {
        min-width: 200px;
      }

      .property-grid {
        grid-template-columns: repeat(auto-fit, minmax(min(100%, 280px), 1fr));
      }
    }

    @media (max-width: 992px) {

      /* Tablet portrait dan di bawahnya */
      .sidebar {
        /* Default jadi mini di tablet, atau bisa di-overlay juga */
        /* Untuk versi ini, kita buat dia bisa transform keluar masuk */
        transform: translateX(-100%);
        box-shadow: var(--bayangan-lg);
        /* Shadow saat overlay */
      }

      .sidebar.open {
        transform: translateX(0);
        width: var(--lebar-sidebar);
        /* Pastikan lebar penuh saat terbuka */
      }

      /* Saat sidebar.open (overlay), konten utama tidak perlu margin-left */
      .main-wrapper {
        margin-left: 0;
        /* Sidebar akan overlay */
        width: 100%;
      }

      .main-wrapper.sidebar-mini {
        /* Class ini jadi tidak relevan saat sidebar overlay */
        margin-left: 0;
        width: 100%;
      }

      .app-header .search-bar {
        display: none;
      }

      /* Sembunyikan search bar, bisa diganti tombol search */
      .app-header .header-left {
        gap: var(--spasi-sm);
      }
    }

    @media (max-width: 768px) {

      /* Mobile */
      :root {
        /* Ukuran font lebih kecil di mobile */
        --ukuran-teks-base: 0.9375rem;
        /* 15px */
        --ukuran-teks-lg: 1.0625rem;
        /* 17px */
        --ukuran-teks-xl: 1.1875rem;
        /* 19px */
        --ukuran-teks-2xl: 1.375rem;
        /* 22px */
        --ukuran-teks-3xl: 1.625rem;
        /* 26px */
        --ukuran-teks-4xl: 1.875rem;
        /* 30px */
      }

      #main-content-area {
        padding: var(--spasi-lg);
      }

      /* Padding lebih konsisten di mobile */
      .app-header .header-right {
        gap: var(--spasi-xs);
      }

      /* Gap sangat kecil di mobile untuk ikon */
      .app-header .icon-button {
        width: 36px;
        height: 36px;
        font-size: var(--ukuran-teks-lg);
      }

      .app-header .icon-button .badge {
        top: 2px;
        right: 2px;
        width: 16px;
        height: 16px;
        font-size: 0.6rem;
      }

      .modal-dialog {
        width: 95%;
        margin: var(--spasi-sm);
        max-height: 95vh;
      }

      .modal-footer {
        flex-direction: column;
        gap: var(--spasi-sm);
      }

      .modal-footer .button {
        width: 100%;
      }

      .button-group {
        flex-direction: column;
      }

      .button-group .button {
        width: 100%;
      }

      .report-stats-grid {
        grid-template-columns: 1fr;
      }

      /* Satu kartu per baris di mobile */
      .toast-notifications {
        right: var(--spasi-sm);
        bottom: var(--spasi-sm);
        width: calc(100% - (2 * var(--spasi-sm)));
      }

      .toast {
        min-width: unset;
        width: 100%;
      }
    }
  </style>
</head>

<body>

  <div id="loading-placeholder" aria-label="Memuat aplikasi" role="status">
    <div class="spinner"></div>
    <p>Memuat Dashboard Lembah Hijau...</p>
  </div>

  <aside class="sidebar" id="app-sidebar" aria-label="Navigasi Utama">
    <div class="logo-details">
      <span class="logo-icon" aria-hidden="true"><i class="fas fa-building-columns"></i></span>
      <span class="logo-name">LembahHijau</span>
    </div>

    <ul class="nav-list" role="navigation">
      <li>
        <a href="#properti" class="nav-link active" data-route="properti" aria-current="page">
          <span class="icon" aria-hidden="true"><i class="fas fa-home-lg-alt fa-fw"></i></span>
          <span class="link-name">Properti Saya</span>
        </a>
      </li>
      <li>
        <a href="#laporan" class="nav-link" data-route="laporan">
          <span class="icon" aria-hidden="true"><i class="fas fa-chart-pie fa-fw"></i></span>
          <span class="link-name">Laporan Keuangan</span>
        </a>
      </li>
      <li>
        <a href="#notifikasi" class="nav-link" data-route="notifikasi">
          <span class="icon" aria-hidden="true"><i class="fas fa-bell fa-fw"></i></span>
          <span class="link-name">Notifikasi</span>
          <span class="badge-nav" style="display:none;" aria-label="Jumlah notifikasi belum dibaca"></span>
        </a>
      </li>
      <li>
        <a href="#profil" class="nav-link" data-route="profil">
          <span class="icon" aria-hidden="true"><i class="fas fa-user-circle fa-fw"></i></span>
          <span class="link-name">Profil Saya</span>
        </a>
      </li>
    </ul>

    <div class="profile-details">
      <a href="#profil" class="profile-link" data-route="profil" aria-label="Buka halaman profil Manajer Properti">
        <img src="https://i.pravatar.cc/48?u=ManajerPropertiLH" alt="Foto Profil Pengguna" class="profile-image">
        <div class="profile-content">
          <div class="name">Manajer Properti</div>
          <div class="role">Admin Utama</div>
        </div>
      </a>
    </div>
  </aside>

  <div class="main-wrapper" id="main-wrapper">
    <header class="app-header">
      <div class="header-left">
        <button id="sidebar-toggle" aria-label="Toggle Navigasi Sidebar" aria-expanded="false"
          aria-controls="app-sidebar">
          <i class="fas fa-bars"></i>
        </button>
        <div class="search-bar" role="search">
          <input type="search" id="global-search" placeholder="Cari properti, transaksi..."
            aria-label="Pencarian global">
          <span class="search-icon" aria-hidden="true"><i class="fas fa-search"></i></span>
        </div>
      </div>
      <div class="header-right">
        <button id="theme-toggle" class="icon-button" aria-label="Ganti ke Mode Gelap">
          <span class="icon" aria-hidden="true"><i class="fas fa-moon"></i></span>
          <span class="text visually-hidden">Ganti Tema</span>
        </button>
        <button id="show-notifications-header" class="icon-button" aria-label="Lihat Notifikasi">
          <i class="fas fa-bell" aria-hidden="true"></i>
          <span class="badge" style="display:none;" aria-label="Jumlah notifikasi belum dibaca">0</span>
        </button>
      </div>
    </header>

    <main id="main-content-area" class="container-fluid" role="main" aria-live="polite">
      <!-- Konten halaman akan dimuat di sini oleh JavaScript -->
    </main>

    <footer class="app-footer">
      <p>&copy; <span id="current-year"></span> Lembah Hijau Property Management. Dibuat dengan <i class="fas fa-heart"
          style="color: var(--warna-error);" aria-hidden="true"></i> untuk properti Anda.</p>
    </footer>
  </div>

  <!-- TEMPLATE HALAMAN SPA -->
  <template id="properti-page-template">
    <section class="page-content" aria-labelledby="properti-page-title">
      <div class="d-flex justify-content-between align-items-center margin-bottom-lg">
        <h1 id="properti-page-title"><i class="fas fa-home-lg-alt icon-header" aria-hidden="true"></i>Properti Saya</h1>
        <button class="button button-primary" id="add-property-button">
          <i class="fas fa-plus-circle" aria-hidden="true"></i> Tambah Properti
        </button>
      </div>
      <div id="no-properties-message" class="info-message hidden">
        <i class="fas fa-info-circle fa-lg" aria-hidden="true" style="margin-right: var(--spasi-sm);"></i>
        <span>Anda belum memiliki properti. Klik "Tambah Properti" untuk memulai.</span>
      </div>
      <div class="property-grid" id="property-list-container" aria-live="polite">
        <!-- Kartu properti akan dimuat di sini -->
      </div>
    </section>
  </template>

  <template id="laporan-page-template">
    <section class="page-content" aria-labelledby="laporan-page-title">
      <h1 id="laporan-page-title"><i class="fas fa-chart-pie icon-header" aria-hidden="true"></i>Laporan Keuangan</h1>
      <div class="report-stats-grid margin-bottom-lg">
        <div class="stat-card">
          <div class="stat-icon" aria-hidden="true"><i class="fas fa-wallet"></i></div>
          <div class="stat-info">
            <h4 id="total-revenue">Rp 0</h4>
            <p>Total Pendapatan (Simulasi)</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" aria-hidden="true"><i class="fas fa-file-invoice-dollar"></i></div>
          <div class="stat-info">
            <h4 id="completed-transactions">0</h4>
            <p>Booking Selesai</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" aria-hidden="true"><i class="fas fa-building-user"></i></div>
          <div class="stat-info">
            <h4 id="active-properties-count">0</h4>
            <p>Total Properti Terdaftar</p>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3>Riwayat Booking Terbaru (Simulasi)</h3>
        </div>
        <div class="card-body">
          <div id="no-transactions-message" class="info-message hidden">
            <i class="fas fa-receipt fa-lg" aria-hidden="true" style="margin-right: var(--spasi-sm);"></i>
            <span>Belum ada booking yang tercatat.</span>
          </div>
          <ul class="transaction-list" id="transaction-items" aria-live="polite">
            <!-- Item transaksi akan dimuat di sini -->
          </ul>
        </div>
      </div>
    </section>
  </template>

  <template id="notifikasi-page-template">
    <section class="page-content" aria-labelledby="notifikasi-page-title">
      <h1 id="notifikasi-page-title"><i class="fas fa-bell icon-header" aria-hidden="true"></i>Notifikasi</h1>
      <div id="no-notifications-message" class="info-message hidden">
        <i class="fas fa-envelope-open-text fa-lg" aria-hidden="true" style="margin-right: var(--spasi-sm);"></i>
        <span>Tidak ada notifikasi baru untuk Anda saat ini.</span>
      </div>
      <ul class="notification-list" id="notification-items-list" aria-live="polite">
        <!-- Item notifikasi akan dimuat di sini -->
      </ul>
    </section>
  </template>

  <template id="profil-page-template">
    <section class="page-content" aria-labelledby="profil-page-title">
      <h1 id="profil-page-title"><i class="fas fa-user-circle icon-header" aria-hidden="true"></i>Profil Saya</h1>
      <div class="card">
        <div class="card-body d-flex align-items-center gap-lg">
          <img src="https://i.pravatar.cc/150?u=ManajerPropertiLH" alt="Foto Profil Manajer Properti"
            style="width:120px; height:120px; border-radius:var(--radius-lingkaran); border: 4px solid var(--warna-sekunder);">
          <div>
            <h2>Manajer Properti</h2>
            <p class="text-muted" style="margin-bottom: var(--spasi-sm);">Admin Utama Sistem Manajemen Properti Lembah
              Hijau</p>
            <p><i class="fas fa-envelope icon" style="color:var(--warna-primer)"></i> manager@lembahhijau.dev (Contoh
              Email)</p>
            <p><i class="fas fa-briefcase icon" style="color:var(--warna-primer)"></i> Aktif sejak: 1 Januari 2023</p>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <h3>Pengaturan Akun (Contoh)</h3>
        </div>
        <div class="card-body">
          <p>Fitur pengaturan akun seperti ganti kata sandi, preferensi notifikasi, dan lainnya akan tersedia di sini
            pada pembaruan mendatang.</p>
          <button class="button button-secondary" disabled><i class="fas fa-edit"></i> Edit Profil (Segera
            Hadir)</button>
        </div>
      </div>
    </section>
  </template>

  <!-- MODAL FORM PROPERTI (Tambah/Edit) -->
  <div class="modal" id="property-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title-property">
    <div class="modal-dialog">
      <form id="property-form" novalidate>
        <input type="hidden" id="property-id">
        <div class="modal-header">
          <h2 class="modal-title" id="modal-title-property">Tambah Properti Baru</h2>
          <button type="button" class="close-button" aria-label="Tutup Modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="property-name" class="form-label">Nama Properti <span aria-hidden="true"
                style="color:var(--warna-error)">*</span></label>
            <input type="text" id="property-name" class="form-control" required
              placeholder="Contoh: Apartemen Green Valley Tower A" aria-describedby="error-property-name">
            <small class="error-message hidden" id="error-property-name" role="alert"></small>
          </div>
          <div class="form-group">
            <label for="property-location" class="form-label">Lokasi <span aria-hidden="true"
                style="color:var(--warna-error)">*</span></label>
            <input type="text" id="property-location" class="form-control" required
              placeholder="Contoh: Jl. Sudirman No. 123, Jakarta Pusat" aria-describedby="error-property-location">
            <small class="error-message hidden" id="error-property-location" role="alert"></small>
          </div>
          <div class="form-group">
            <label for="property-price" class="form-label">Harga Sewa (per bulan, Rp) <span aria-hidden="true"
                style="color:var(--warna-error)">*</span></label>
            <input type="number" id="property-price" class="form-control" required placeholder="Contoh: 5000000" min="0"
              aria-describedby="error-property-price">
            <small class="error-message hidden" id="error-property-price" role="alert"></small>
          </div>
          <div class="form-group">
            <label for="property-image" class="form-label">URL Gambar Properti</label>
            <input type="url" id="property-image" class="form-control"
              placeholder="Contoh: https://images.unsplash.com/..." aria-describedby="error-property-image">
            <small class="error-message hidden" id="error-property-image" role="alert"></small>
            <small class="form-text text-muted"
              style="font-size: var(--ukuran-teks-xs); margin-top: var(--spasi-xs); display:block;">Gunakan URL gambar
              valid dari Unsplash, Pexels, dll. Jika kosong, gambar default akan digunakan.</small>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="button button-outline-primary close-button">Batal</button>
          <button type="submit" class="button button-primary" id="save-property-button">
            <i class="fas fa-plus-circle" aria-hidden="true"></i> Tambah Properti
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL DETAIL PROPERTI & BOOKING (CONTOH) -->
  <div class="modal" id="detail-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title-detail">
    <div class="modal-dialog" style="max-width: 750px;">
      <div class="modal-header">
        <h2 class="modal-title" id="modal-title-detail">Detail Properti</h2>
        <button type="button" class="close-button" aria-label="Tutup Modal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="grid-container grid-cols-1" style="gap: var(--spasi-xl);  ">
          <!-- Di JS akan diatur menjadi 2 kolom jika layar cukup lebar -->
          <div id="detail-content-wrapper" class="d-flex flex-column" style="gap:var(--spasi-lg);">
            <div>
              <img id="detail-image" src="" alt="Gambar Properti Detail"
                style="width:100%; max-height:350px; object-fit:cover; border-radius: var(--radius-md); margin-bottom: var(--spasi-lg); box-shadow: var(--bayangan-sm);">
              <h3 id="detail-name" style="font-size: var(--ukuran-teks-2xl); margin-bottom: var(--spasi-xs);">Nama
                Properti</h3>
              <p id="detail-location"
                style="color: var(--warna-teks-sekunder); margin-bottom: var(--spasi-sm); font-size: var(--ukuran-teks-sm);">
                <i class="fas fa-map-marker-alt" aria-hidden="true"></i> Lokasi
              </p>
              <p id="detail-price"
                style="font-size: var(--ukuran-teks-xl); color: var(--warna-sekunder); font-weight: bold; margin-bottom: var(--spasi-lg);">
                Harga</p>
              <div id="detail-map" class="card"
                style="padding: var(--spasi-md); background-color: var(--warna-latar); text-align: center; border: 1px dashed var(--warna-batas);">
                <p style="margin:0; font-size:var(--ukuran-teks-sm);"><i class="fas fa-map-marked-alt"
                    aria-hidden="true"></i> Peta lokasi akan ditampilkan di sini (Integrasi layanan peta di masa depan)
                </p>
              </div>
            </div>

            <div class="card" style="margin-top:var(--spasi-lg);">
              <div class="card-header">
                <h4 style="margin:0;">Formulir Booking (Simulasi)</h4>
              </div>
              <div class="card-body">
                <form id="booking-form" novalidate>
                  <input type="hidden" id="booking-property-id">
                  <div class="form-group">
                    <label for="booking-name" class="form-label">Nama Lengkap Penyewa <span aria-hidden="true"
                        style="color:var(--warna-error)">*</span></label>
                    <input type="text" id="booking-name" class="form-control" required placeholder="Nama Anda"
                      aria-describedby="error-booking-name">
                    <small class="error-message hidden" id="error-booking-name" role="alert"></small>
                  </div>
                  <div class="form-group">
                    <label for="booking-email" class="form-label">Email <span aria-hidden="true"
                        style="color:var(--warna-error)">*</span></label>
                    <input type="email" id="booking-email" class="form-control" required placeholder="email@anda.com"
                      aria-describedby="error-booking-email">
                    <small class="error-message hidden" id="error-booking-email" role="alert"></small>
                  </div>
                  <div class="form-group">
                    <label for="booking-duration" class="form-label">Durasi Sewa (bulan) <span aria-hidden="true"
                        style="color:var(--warna-error)">*</span></label>
                    <input type="number" id="booking-duration" class="form-control" required min="1" value="1"
                      aria-describedby="error-booking-duration">
                    <small class="error-message hidden" id="error-booking-duration" role="alert"></small>
                  </div>
                  <button type="submit" class="button button-primary" id="submit-booking-button" style="width:100%;">
                    <i class="fas fa-credit-card" aria-hidden="true"></i> Proses Booking & Pembayaran
                  </button>
                  <div id="payment-status" class="status-message hidden" role="status"
                    style="margin-top:var(--spasi-md); padding:var(--spasi-sm); border-radius:var(--radius-sm); text-align:center;">
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="toast-notifications-container" class="toast-notifications" aria-live="assertive" aria-atomic="true">
    <!-- Toast akan ditambahkan di sini oleh JS -->
  </div>

  <script>
    // "KODE RAPI, TEROPTIMASI, REUSABLE, DAN FANCY" - VERSI VANILLA JS
    (function ApplicationScope() {
      "use strict";

      const appState = {
        properties: [
          { id: 'prop_1700000000000_abc123', name: 'Apartemen Emerald Sky View', location: 'Jl. Merdeka No. 1, Jakarta Selatan', price: 12000000, imageUrl: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?q=80&w=1470&auto=format&fit=crop' },
          { id: 'prop_1700000000001_def456', name: 'Residensi Urban Oasis Modern', location: 'Jl. Pelangi Indah Blok C2, Surabaya Pusat', price: 8500000, imageUrl: 'https://images.unsplash.com/photo-1580587771525-78b9dba3b914?q=80&w=1374&auto=format&fit=crop' },
          { id: 'prop_1700000000002_ghi789', name: 'Studio Harmoni Minimalis', location: 'Jl. Pendidikan Utama Kav. 7, Yogyakarta Kota', price: 4200000, imageUrl: 'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?q=80&w=1470&auto=format&fit=crop' },
        ],
        transactions: [], // Akan berisi {id, propertyId, propertyName, customerName, amount, date}
        notifications: [
          { id: UTILS.generateId('notif'), message: 'Selamat datang di Dashboard Lembah Hijau! Kelola properti Anda dengan mudah.', type: 'info', timestamp: new Date(Date.now() - 3600000 * 3).toISOString(), read: true },
          { id: UTILS.generateId('notif'), message: 'Tip: Gunakan foto berkualitas tinggi untuk properti Anda agar lebih menarik calon penyewa.', type: 'info', timestamp: new Date(Date.now() - 3600000).toISOString(), read: false },
        ],
        currentRoute: '',
        editingPropertyId: null,
        isSidebarMini: false, // Dikelola berdasarkan localStorage dan ukuran layar
        isSidebarOpenMobile: false, // Khusus untuk mobile view (overlay)
        isDarkMode: false,
      };

      const CONFIG = {
        defaultRoute: 'properti',
        defaultImageUrl: 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?q=80&w=1470&auto=format&fit=crop',
        themeStorageKey: 'lembahHijauDashboardTheme_v2',
        sidebarStateKey: 'lembahHijauSidebarState_v2', // State untuk mini/full di desktop
        notificationIcons: {
          info: 'fas fa-info-circle', success: 'fas fa-check-circle',
          warning: 'fas fa-exclamation-triangle', error: 'fas fa-times-circle',
          payment: 'fas fa-credit-card'
        },
        toastDuration: 5000, // Durasi toast lebih lama
        mobileBreakpoint: 992, // Batas untuk sidebar overlay
      };

      const DOM = { // Cache elemen DOM untuk performa
        body: document.body,
        loadingPlaceholder: document.getElementById('loading-placeholder'),
        appSidebar: document.getElementById('app-sidebar'),
        mainWrapper: document.getElementById('main-wrapper'),
        mainContentArea: document.getElementById('main-content-area'),
        currentYearSpan: document.getElementById('current-year'),
        sidebarToggleBtn: document.getElementById('sidebar-toggle'),
        sidebarToggleIcon: document.querySelector('#sidebar-toggle i'),
        navLinks: document.querySelectorAll('.sidebar .nav-link'),
        themeToggleButton: document.getElementById('theme-toggle'),
        themeToggleIcon: document.querySelector('#theme-toggle .icon i'),
        themeToggleText: document.querySelector('#theme-toggle .text'),
        notificationsHeaderBtn: document.getElementById('show-notifications-header'),
        notificationsHeaderBadge: document.querySelector('#show-notifications-header .badge'),
        navNotificationLinkBadge: document.querySelector('.sidebar .nav-link[data-route="notifikasi"] .badge-nav'),

        propertyModal: document.getElementById('property-modal'),
        propertyModalTitle: document.getElementById('modal-title-property'),
        propertyForm: document.getElementById('property-form'),
        propertyIdInput: document.getElementById('property-id'),
        propertyNameInput: document.getElementById('property-name'),
        propertyLocationInput: document.getElementById('property-location'),
        propertyPriceInput: document.getElementById('property-price'),
        propertyImageInput: document.getElementById('property-image'),
        savePropertyButton: document.getElementById('save-property-button'),

        detailModal: document.getElementById('detail-modal'),
        detailModalTitle: document.getElementById('modal-title-detail'),
        detailImage: document.getElementById('detail-image'),
        detailName: document.getElementById('detail-name'),
        detailLocation: document.getElementById('detail-location'),
        detailPrice: document.getElementById('detail-price'),
        detailMapPlaceholder: document.getElementById('detail-map'),
        detailContentWrapper: document.getElementById('detail-content-wrapper'),
        bookingForm: document.getElementById('booking-form'),
        bookingPropertyIdInput: document.getElementById('booking-property-id'),
        bookingNameInput: document.getElementById('booking-name'),
        bookingEmailInput: document.getElementById('booking-email'),
        bookingDurationInput: document.getElementById('booking-duration'),
        paymentStatusDiv: document.getElementById('payment-status'),
        submitBookingButton: document.getElementById('submit-booking-button'),

        closeModalButtons: document.querySelectorAll('.modal .close-button'),

        propertiPageTemplate: document.getElementById('properti-page-template'),
        laporanPageTemplate: document.getElementById('laporan-page-template'),
        notifikasiPageTemplate: document.getElementById('notifikasi-page-template'),
        profilPageTemplate: document.getElementById('profil-page-template'),

        toastContainer: document.getElementById('toast-notifications-container'),
      };

      const UTILS = {
        formatCurrency: (amount) => {
          if (typeof amount !== 'number' || isNaN(amount)) return 'Rp -';
          return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(amount);
        },
        generateId: (prefix = 'id_') => `${prefix}${Date.now()}_${Math.random().toString(36).substring(2, 9)}`,
        sanitizeHTML: (str) => {
          if (typeof str !== 'string') return '';
          const temp = document.createElement('div');
          temp.textContent = str;
          return temp.innerHTML;
        },
        escapeHTML: (str) => { // Lebih aman untuk atribut
          if (typeof str !== 'string') return '';
          return str.replace(/[&<>"']/g, function (match) {
            return {
              '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
            }[match];
          });
        },
        toggleElementVisibility: (element, show) => {
          if (element) {
            element.classList.toggle('hidden', !show);
            element.setAttribute('aria-hidden', String(!show));
          }
        },
        showFieldError: (fieldId, message) => {
          const field = DOM[`${fieldId}Input`] || document.getElementById(fieldId); // Coba dari DOM cache dulu
          const errorElement = document.getElementById(`error-${fieldId}`);
          if (field && errorElement) {
            field.classList.add('is-invalid');
            field.setAttribute('aria-invalid', 'true');
            field.setAttribute('aria-describedby', `error-${fieldId}`);
            errorElement.textContent = message;
            UTILS.toggleElementVisibility(errorElement, true);
          }
        },
        clearFieldError: (fieldId) => {
          const field = DOM[`${fieldId}Input`] || document.getElementById(fieldId);
          const errorElement = document.getElementById(`error-${fieldId}`);
          if (field && errorElement) {
            field.classList.remove('is-invalid');
            field.removeAttribute('aria-invalid');
            field.removeAttribute('aria-describedby');
            UTILS.toggleElementVisibility(errorElement, false);
          }
        },
        clearFormErrors: (formElement) => {
          formElement.querySelectorAll('.error-message').forEach(el => UTILS.toggleElementVisibility(el, false));
          formElement.querySelectorAll('.is-invalid').forEach(el => {
            el.classList.remove('is-invalid');
            el.removeAttribute('aria-invalid');
            el.removeAttribute('aria-describedby');
          });
        },
        addNotification: (message, type = 'info', showToast = true) => {
          const newNotification = {
            id: UTILS.generateId('notif'),
            message: UTILS.sanitizeHTML(message),
            type: type,
            timestamp: new Date().toISOString(),
            read: false
          };
          appState.notifications.unshift(newNotification);
          RENDER.updateNotificationBadges();
          if (appState.currentRoute === 'notifikasi' && DOM.mainContentArea.querySelector('#notification-items-list')) {
            RENDER.notifications();
          }
          if (showToast) UTILS.showToast(message, type);
        },
        showToast: (message, type = 'info') => {
          if (!DOM.toastContainer) return;
          const toastId = UTILS.generateId('toast');
          const toast = document.createElement('div');
          toast.className = `toast ${type}`;
          toast.id = toastId;
          toast.setAttribute('role', 'alert');
          toast.setAttribute('aria-live', 'assertive');

          const iconClass = CONFIG.notificationIcons[type] || CONFIG.notificationIcons.info;
          toast.innerHTML = `
            <span class="toast-icon" aria-hidden="true"><i class="${iconClass}"></i></span>
            <div class="toast-message">${UTILS.sanitizeHTML(message)}</div>
          `;
          DOM.toastContainer.appendChild(toast);
          setTimeout(() => toast.classList.add('show'), 50);
          setTimeout(() => {
            toast.classList.remove('show');
            toast.addEventListener('transitionend', () => toast.remove(), { once: true });
          }, CONFIG.toastDuration);
        },
        timeAgo: (dateString) => {
          const date = new Date(dateString);
          const now = new Date();
          const seconds = Math.round((now - date) / 1000);
          const minutes = Math.round(seconds / 60);
          const hours = Math.round(minutes / 60);
          const days = Math.round(hours / 24);

          if (seconds < 5) return "baru saja";
          if (seconds < 60) return `${seconds} detik lalu`;
          if (minutes < 60) return `${minutes} menit lalu`;
          if (hours < 24) return `${hours} jam lalu`;
          if (days === 1) return "kemarin";
          if (days < 7) return `${days} hari lalu`;
          return date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
        },
        isValidURL: (string) => {
          try {
            new URL(string);
            return true;
          } catch (_) {
            return false;
          }
        }
      };

      const RENDER = {
        page: (routeName) => {
          DOM.mainContentArea.innerHTML = '';
          let template, pageTitleId;
          switch (routeName) {
            case 'properti':
              template = DOM.propertiPageTemplate.content.cloneNode(true);
              pageTitleId = 'properti-page-title';
              DOM.mainContentArea.appendChild(template);
              RENDER.properties();
              const addPropertyBtn = DOM.mainContentArea.querySelector('#add-property-button');
              if (addPropertyBtn) addPropertyBtn.addEventListener('click', HANDLERS.openAddPropertyModal);
              break;
            case 'laporan':
              template = DOM.laporanPageTemplate.content.cloneNode(true);
              pageTitleId = 'laporan-page-title';
              DOM.mainContentArea.appendChild(template);
              RENDER.reports();
              break;
            case 'notifikasi':
              template = DOM.notifikasiPageTemplate.content.cloneNode(true);
              pageTitleId = 'notifikasi-page-title';
              DOM.mainContentArea.appendChild(template);
              RENDER.notifications();
              break;
            case 'profil':
              template = DOM.profilPageTemplate.content.cloneNode(true);
              pageTitleId = 'profil-page-title';
              DOM.mainContentArea.appendChild(template);
              // Tidak ada render khusus untuk profil saat ini
              break;
            default:
              DOM.mainContentArea.innerHTML = `<div class="card"><div class="card-body text-center"><h1><i class="fas fa-exclamation-triangle icon-header"></i>Halaman Tidak Ditemukan</h1><p>Maaf, halaman yang Anda cari tidak tersedia. Silakan kembali ke <a href="#${CONFIG.defaultRoute}" class="nav-link-inline">Dashboard</a>.</p></div></div>`;
              routeName = CONFIG.defaultRoute; // Set ke default
          }

          DOM.navLinks.forEach(link => {
            const isActive = link.dataset.route === routeName;
            link.classList.toggle('active', isActive);
            link.setAttribute('aria-current', isActive ? 'page' : 'false');
          });
          appState.currentRoute = routeName;
          document.title = `Lembah Hijau | ${routeName.charAt(0).toUpperCase() + routeName.slice(1)}`;
          if (pageTitleId && DOM.mainContentArea.querySelector(`#${pageTitleId}`)) {
            DOM.mainContentArea.querySelector(`#${pageTitleId}`).setAttribute('tabindex', '-1');
            DOM.mainContentArea.querySelector(`#${pageTitleId}`).focus();
          }
          window.scrollTo(0, 0);
        },

        properties: () => {
          const container = DOM.mainContentArea.querySelector('#property-list-container');
          const msgEl = DOM.mainContentArea.querySelector('#no-properties-message');
          if (!container || !msgEl) return;

          container.innerHTML = '';
          UTILS.toggleElementVisibility(msgEl, appState.properties.length === 0);

          if (appState.properties.length > 0) {
            const fragment = document.createDocumentFragment();
            appState.properties.forEach(property => {
              const card = document.createElement('article');
              card.className = 'card property-card';
              card.dataset.id = property.id;
              card.setAttribute('tabindex', '0');
              card.setAttribute('role', 'button');
              card.setAttribute('aria-labelledby', `prop-name-${property.id}`);
              card.setAttribute('aria-describedby', `prop-loc-${property.id} prop-price-${property.id}`);

              const safeName = UTILS.escapeHTML(property.name);
              const safeLocation = UTILS.escapeHTML(property.location);
              const safeImageUrl = UTILS.escapeHTML(property.imageUrl) || CONFIG.defaultImageUrl;

              card.innerHTML = `
                <div class="property-card-image-wrapper">
                  <img src="${safeImageUrl}" alt="Gambar ${safeName}" loading="lazy">
                </div>
                <div class="property-card-content">
                  <h3 id="prop-name-${property.id}">${safeName}</h3>
                  <p id="prop-loc-${property.id}" style="color: var(--warna-teks-sekunder);"><i class="fas fa-map-marker-alt icon" aria-hidden="true"></i> ${safeLocation}</p>
                  <p id="prop-price-${property.id}" class="price">${UTILS.formatCurrency(property.price)} / bulan</p>
                  <div class="property-actions button-group">
                    <button class="button button-outline-primary button-sm edit-button" data-action="edit" aria-label="Edit properti ${safeName}"><i class="fas fa-edit" aria-hidden="true"></i> Edit</button>
                    <button class="button button-danger button-sm delete-button" data-action="delete" aria-label="Hapus properti ${safeName}"><i class="fas fa-trash-alt" aria-hidden="true"></i> Hapus</button>
                  </div>
                </div>
              `;
              // Event listener di sini agar tidak query DOM berulang
              card.addEventListener('click', (e) => HANDLERS.handlePropertyCardClick(e, property.id));
              card.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') HANDLERS.handlePropertyCardClick(e, property.id); });
              fragment.appendChild(card);
            });
            container.appendChild(fragment);
          }
        },
        reports: () => {
          const totalRevenueEl = DOM.mainContentArea.querySelector('#total-revenue');
          const completedTransactionsEl = DOM.mainContentArea.querySelector('#completed-transactions');
          const activePropertiesCountEl = DOM.mainContentArea.querySelector('#active-properties-count');
          const transactionItemsList = DOM.mainContentArea.querySelector('#transaction-items');
          const noTransactionsMsg = DOM.mainContentArea.querySelector('#no-transactions-message');

          if (!totalRevenueEl || !completedTransactionsEl || !activePropertiesCountEl || !transactionItemsList || !noTransactionsMsg) return;

          const totalRevenue = appState.transactions.reduce((sum, t) => sum + t.amount, 0);
          totalRevenueEl.textContent = UTILS.formatCurrency(totalRevenue);
          completedTransactionsEl.textContent = appState.transactions.length;
          activePropertiesCountEl.textContent = appState.properties.length;

          UTILS.toggleElementVisibility(noTransactionsMsg, appState.transactions.length === 0);
          transactionItemsList.innerHTML = '';

          if (appState.transactions.length > 0) {
            const fragment = document.createDocumentFragment();
            appState.transactions.slice().reverse().forEach(transaction => {
              const li = document.createElement('li');
              const transactionDate = new Date(transaction.date).toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' });
              const safePropName = UTILS.escapeHTML(transaction.propertyName);
              const safeCustName = UTILS.escapeHTML(transaction.customerName);
              li.innerHTML = `
                <div class="transaction-details">
                  <span>Booking untuk <strong>${safePropName}</strong> oleh ${safeCustName}</span>
                  <small style="display:block; color:var(--warna-teks-tersier); font-size:var(--ukuran-teks-xs);">${transactionDate}</small>
                </div>
                <span class="transaction-amount-income">${UTILS.formatCurrency(transaction.amount)}</span>
              `;
              fragment.appendChild(li);
            });
            transactionItemsList.appendChild(fragment);
          }
        },
        notifications: () => {
          const listEl = DOM.mainContentArea.querySelector('#notification-items-list');
          const msgEl = DOM.mainContentArea.querySelector('#no-notifications-message');
          if (!listEl || !msgEl) return;

          UTILS.toggleElementVisibility(msgEl, appState.notifications.length === 0);
          listEl.innerHTML = '';

          if (appState.notifications.length > 0) {
            const fragment = document.createDocumentFragment();
            appState.notifications.forEach(notification => {
              const li = document.createElement('li');
              li.className = `notification-item type-${notification.type} ${notification.read ? 'read' : 'unread'}`;
              li.dataset.id = notification.id;
              const iconClass = CONFIG.notificationIcons[notification.type] || CONFIG.notificationIcons.info;
              li.innerHTML = `
                <span class="notification-icon" aria-hidden="true"><i class="${iconClass}"></i></span>
                <div class="notification-message">
                  ${notification.message} <!-- Pesan sudah disanitasi -->
                  <div class="notification-timestamp">${UTILS.timeAgo(notification.timestamp)}</div>
                </div>
                ${!notification.read ? `<button class="button button-sm button-outline-primary mark-read-btn" data-id="${notification.id}" aria-label="Tandai notifikasi sebagai sudah dibaca: ${UTILS.escapeHTML(notification.message.substring(0, 50))}">Dibaca</button>` : ''}
              `;
              fragment.appendChild(li);
            });
            listEl.appendChild(fragment);
            listEl.querySelectorAll('.mark-read-btn').forEach(btn => btn.addEventListener('click', HANDLERS.markNotificationAsRead));
          }
          RENDER.updateNotificationBadges();
        },
        updateNotificationBadges: () => {
          const unreadCount = appState.notifications.filter(n => !n.read).length;
          const displayCount = unreadCount > 9 ? '9+' : String(unreadCount);
          [DOM.notificationsHeaderBadge, DOM.navNotificationLinkBadge].forEach(badge => {
            if (badge) {
              if (unreadCount > 0) {
                badge.textContent = displayCount;
                badge.style.display = 'flex';
                if (badge === DOM.notificationsHeaderBadge) badge.setAttribute('aria-label', `${unreadCount} notifikasi belum dibaca`);
              } else {
                badge.style.display = 'none';
                if (badge === DOM.notificationsHeaderBadge) badge.setAttribute('aria-label', `Tidak ada notifikasi belum dibaca`);
              }
            }
          });
        },
        updateSidebarToggleIcon: () => {
          if (window.innerWidth <= CONFIG.mobileBreakpoint) {
            DOM.sidebarToggleIcon.className = appState.isSidebarOpenMobile ? 'fas fa-times' : 'fas fa-bars';
          } else {
            DOM.sidebarToggleIcon.className = appState.isSidebarMini ? 'fas fa-bars' : 'fas fa-times';
          }
        }
      };

      const MODALS = {
        activeModal: null,
        lastFocusedElement: null,
        open: (modalElement, onOpenCallback) => {
          if (!modalElement || MODALS.activeModal) return;
          MODALS.lastFocusedElement = document.activeElement;
          modalElement.classList.add('active');
          DOM.body.style.overflow = 'hidden';
          MODALS.activeModal = modalElement;
          modalElement.setAttribute('aria-hidden', 'false');

          const focusableElements = modalElement.querySelectorAll('button, [href], input:not([type="hidden"]), select, textarea, [tabindex]:not([tabindex="-1"])');
          if (focusableElements.length > 0) focusableElements[0].focus();
          if (typeof onOpenCallback === 'function') onOpenCallback();
        },
        close: () => {
          if (!MODALS.activeModal) return;
          MODALS.activeModal.classList.remove('active');
          DOM.body.style.overflow = '';
          MODALS.activeModal.setAttribute('aria-hidden', 'true');
          if (MODALS.lastFocusedElement) MODALS.lastFocusedElement.focus();
          MODALS.activeModal = null;
        },
        setupEventListeners: () => {
          DOM.closeModalButtons.forEach(button => button.addEventListener('click', MODALS.close));
          document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && MODALS.activeModal) MODALS.close();
            if (event.key === 'Tab' && MODALS.activeModal) {
              const focusable = Array.from(MODALS.activeModal.querySelectorAll('button, [href], input:not([type="hidden"]), select, textarea, [tabindex]:not([tabindex="-1"])')).filter(el => el.offsetParent !== null && !el.disabled);
              if (focusable.length === 0) return;
              const first = focusable[0];
              const last = focusable[focusable.length - 1];
              if (event.shiftKey && document.activeElement === first) { last.focus(); event.preventDefault(); }
              else if (!event.shiftKey && document.activeElement === last) { first.focus(); event.preventDefault(); }
            }
          });
          [DOM.propertyModal, DOM.detailModal].forEach(modal => {
            if (modal) modal.addEventListener('click', (event) => { if (event.target === modal) MODALS.close(); });
          });
        }
      };

      const HANDLERS = {
        navigate: (event) => {
          let targetLink = event.target.closest('.nav-link');
          if (!targetLink && event.target.closest('.profile-link')) { // Handle profile link click
            targetLink = event.target.closest('.profile-link');
          }
          if (targetLink && targetLink.dataset.route) {
            event.preventDefault();
            window.location.hash = targetLink.dataset.route;
            if (window.innerWidth <= CONFIG.mobileBreakpoint && appState.isSidebarOpenMobile) {
              HANDLERS.toggleSidebar(); // Tutup sidebar di mobile setelah navigasi
            }
          }
        },
        handleHashChange: () => {
          const route = window.location.hash.substring(1) || CONFIG.defaultRoute;
          RENDER.page(route);
        },
        toggleTheme: () => {
          appState.isDarkMode = !appState.isDarkMode;
          DOM.body.classList.toggle('dark-mode', appState.isDarkMode);
          localStorage.setItem(CONFIG.themeStorageKey, appState.isDarkMode ? 'dark' : 'light');
          DOM.themeToggleIcon.className = appState.isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
          DOM.themeToggleText.textContent = appState.isDarkMode ? 'Mode Terang' : 'Mode Gelap';
          DOM.themeToggleButton.setAttribute('aria-label', `Ganti ke Mode ${appState.isDarkMode ? 'Terang' : 'Gelap'}`);
          UTILS.showToast(`Mode ${appState.isDarkMode ? 'Gelap' : 'Terang'} diaktifkan.`, 'info');
        },
        toggleSidebar: () => {
          if (window.innerWidth <= CONFIG.mobileBreakpoint) { // Logika untuk mobile (overlay)
            appState.isSidebarOpenMobile = !appState.isSidebarOpenMobile;
            DOM.appSidebar.classList.toggle('open', appState.isSidebarOpenMobile);
            DOM.body.style.overflow = appState.isSidebarOpenMobile ? 'hidden' : '';
          } else { // Logika untuk desktop (mini/full)
            appState.isSidebarMini = !appState.isSidebarMini;
            DOM.appSidebar.classList.toggle('mini', appState.isSidebarMini);
            DOM.mainWrapper.classList.toggle('sidebar-mini', appState.isSidebarMini);
            localStorage.setItem(CONFIG.sidebarStateKey, appState.isSidebarMini ? 'mini' : 'full');
          }
          DOM.sidebarToggleBtn.setAttribute('aria-expanded', String(window.innerWidth <= CONFIG.mobileBreakpoint ? appState.isSidebarOpenMobile : !appState.isSidebarMini));
          RENDER.updateSidebarToggleIcon();
        },
        openAddPropertyModal: () => {
          appState.editingPropertyId = null;
          DOM.propertyModalTitle.textContent = 'Tambah Properti Baru';
          DOM.propertyForm.reset();
          UTILS.clearFormErrors(DOM.propertyForm);
          DOM.savePropertyButton.innerHTML = '<i class="fas fa-plus-circle" aria-hidden="true"></i> Tambah Properti';
          MODALS.open(DOM.propertyModal);
        },
        openEditPropertyModal: (propertyId) => {
          const property = appState.properties.find(p => p.id === propertyId);
          if (!property) { UTILS.showToast('Properti tidak ditemukan.', 'error'); return; }
          appState.editingPropertyId = propertyId;
          DOM.propertyModalTitle.textContent = 'Edit Properti';
          DOM.propertyForm.reset();
          UTILS.clearFormErrors(DOM.propertyForm);
          DOM.propertyIdInput.value = property.id;
          DOM.propertyNameInput.value = property.name;
          DOM.propertyLocationInput.value = property.location;
          DOM.propertyPriceInput.value = property.price;
          DOM.propertyImageInput.value = property.imageUrl || '';
          DOM.savePropertyButton.innerHTML = '<i class="fas fa-save" aria-hidden="true"></i> Simpan Perubahan';
          MODALS.open(DOM.propertyModal);
        },
        saveProperty: (event) => {
          event.preventDefault();
          if (!VALIDATE.propertyForm()) { UTILS.showToast('Harap perbaiki kesalahan pada formulir.', 'warning'); return; }

          const propertyData = {
            id: appState.editingPropertyId || UTILS.generateId('prop'),
            name: UTILS.sanitizeHTML(DOM.propertyNameInput.value.trim()),
            location: UTILS.sanitizeHTML(DOM.propertyLocationInput.value.trim()),
            price: parseInt(DOM.propertyPriceInput.value, 10),
            imageUrl: UTILS.sanitizeHTML(DOM.propertyImageInput.value.trim()) || CONFIG.defaultImageUrl
          };
          if (!UTILS.isValidURL(propertyData.imageUrl)) propertyData.imageUrl = CONFIG.defaultImageUrl;


          if (appState.editingPropertyId) {
            appState.properties = appState.properties.map(p => p.id === appState.editingPropertyId ? propertyData : p);
            UTILS.addNotification(`Properti "${propertyData.name}" berhasil diperbarui.`, 'success');
          } else {
            appState.properties.push(propertyData);
            UTILS.addNotification(`Properti "${propertyData.name}" berhasil ditambahkan.`, 'success');
          }
          if (appState.currentRoute === 'properti') RENDER.properties();
          if (appState.currentRoute === 'laporan') RENDER.reports(); // Update jumlah di laporan
          MODALS.close();
        },
        deleteProperty: (propertyId) => {
          const property = appState.properties.find(p => p.id === propertyId);
          if (!property) { UTILS.showToast('Properti tidak ditemukan.', 'error'); return; }
          if (confirm(`Anda yakin ingin menghapus properti "${UTILS.escapeHTML(property.name)}"?`)) {
            appState.properties = appState.properties.filter(p => p.id !== propertyId);
            if (appState.currentRoute === 'properti') RENDER.properties();
            if (appState.currentRoute === 'laporan') RENDER.reports();
            UTILS.addNotification(`Properti "${property.name}" telah dihapus.`, 'info');
          }
        },
        handlePropertyCardClick: (event, propertyId) => {
          const target = event.target;
          // Cek jika klik pada tombol edit atau delete
          if (target.closest('.edit-button')) {
            HANDLERS.openEditPropertyModal(propertyId);
          } else if (target.closest('.delete-button')) {
            HANDLERS.deleteProperty(propertyId);
          } else if (target.closest('.property-card')) { // Klik pada area card lainnya
            HANDLERS.openDetailModal(propertyId);
          }
        },
        openDetailModal: (propertyId) => {
          const property = appState.properties.find(p => p.id === propertyId);
          if (!property) { UTILS.showToast('Detail properti tidak ditemukan.', 'error'); return; }

          const safeName = UTILS.escapeHTML(property.name);
          const safeLocation = UTILS.escapeHTML(property.location);
          const safeImageUrl = UTILS.escapeHTML(property.imageUrl) || CONFIG.defaultImageUrl;

          DOM.detailModalTitle.textContent = safeName;
          DOM.detailImage.src = safeImageUrl;
          DOM.detailImage.alt = `Gambar ${safeName}`;
          DOM.detailName.textContent = safeName;
          DOM.detailLocation.innerHTML = `<i class="fas fa-map-marker-alt" aria-hidden="true"></i> ${safeLocation}`;
          DOM.detailPrice.textContent = `${UTILS.formatCurrency(property.price)} / bulan`;
          DOM.bookingPropertyIdInput.value = property.id;
          DOM.detailMapPlaceholder.innerHTML = `<i class="fas fa-map-marked-alt" aria-hidden="true"></i> <p style="margin:0; font-size:var(--ukuran-teks-sm);">Lokasi: ${safeLocation} (Integrasi Peta Nyata Menyusul)</p>`;

          DOM.bookingForm.reset();
          UTILS.clearFormErrors(DOM.bookingForm);
          UTILS.toggleElementVisibility(DOM.paymentStatusDiv, false);
          DOM.paymentStatusDiv.className = 'status-message hidden';
          DOM.submitBookingButton.disabled = false;
          DOM.submitBookingButton.innerHTML = '<i class="fas fa-credit-card" aria-hidden="true"></i> Proses Booking & Pembayaran';

          // Atur layout modal detail berdasarkan lebar layar
          if (window.innerWidth > 768) { // misal tablet ke atas
            DOM.detailContentWrapper.style.display = 'grid';
            DOM.detailContentWrapper.style.gridTemplateColumns = '1fr 1fr';
          } else {
            DOM.detailContentWrapper.style.display = 'flex';
            DOM.detailContentWrapper.style.flexDirection = 'column';
          }

          MODALS.open(DOM.detailModal);
        },
        submitBooking: (event) => {
          event.preventDefault();
          if (!VALIDATE.bookingForm()) { UTILS.showToast('Harap lengkapi formulir booking dengan benar.', 'warning'); return; }

          const propertyId = DOM.bookingPropertyIdInput.value;
          const property = appState.properties.find(p => p.id === propertyId);
          if (!property) { UTILS.showToast('Properti untuk booking tidak valid.', 'error'); return; }

          const customerName = UTILS.sanitizeHTML(DOM.bookingNameInput.value.trim());
          const duration = parseInt(DOM.bookingDurationInput.value, 10);
          const totalAmount = property.price * duration;

          DOM.paymentStatusDiv.innerHTML = `<i class="fas fa-spinner fa-spin" aria-hidden="true"></i> Memproses pembayaran untuk ${UTILS.formatCurrency(totalAmount)}...`;
          DOM.paymentStatusDiv.className = 'status-message info-message'; // Ganti ke info-message
          UTILS.toggleElementVisibility(DOM.paymentStatusDiv, true);
          DOM.submitBookingButton.disabled = true;
          DOM.submitBookingButton.innerHTML = '<i class="fas fa-spinner fa-spin" aria-hidden="true"></i> Memproses...';


          setTimeout(() => {
            const isSuccess = Math.random() > 0.15; // 85% sukses
            if (isSuccess) {
              const transaction = {
                id: UTILS.generateId('trans'), propertyId: property.id, propertyName: property.name,
                customerName: customerName, amount: totalAmount, date: new Date().toISOString()
              };
              appState.transactions.push(transaction);
              if (appState.currentRoute === 'laporan') RENDER.reports();
              DOM.paymentStatusDiv.innerHTML = `<i class="fas fa-check-circle" aria-hidden="true"></i> Pembayaran berhasil! Total: ${UTILS.formatCurrency(totalAmount)}. Booking telah dicatat.`;
              DOM.paymentStatusDiv.className = 'status-message success-global-message';
              UTILS.addNotification(`Booking untuk "${property.name}" oleh ${customerName} (Rp ${totalAmount.toLocaleString('id-ID')}) berhasil.`, 'success');
              DOM.bookingForm.reset();
            } else {
              DOM.paymentStatusDiv.innerHTML = `<i class="fas fa-times-circle" aria-hidden="true"></i> Pembayaran gagal. Silakan coba lagi.`;
              DOM.paymentStatusDiv.className = 'status-message error-global-message';
              UTILS.addNotification(`Booking untuk "${property.name}" oleh ${customerName} gagal.`, 'error');
            }
            DOM.submitBookingButton.disabled = false;
            DOM.submitBookingButton.innerHTML = '<i class="fas fa-credit-card" aria-hidden="true"></i> Proses Booking & Pembayaran';
          }, 2800);
        },
        markNotificationAsRead: (event) => {
          const button = event.target.closest('.mark-read-btn');
          if (!button) return;
          const notificationId = button.dataset.id;
          const notification = appState.notifications.find(n => n.id === notificationId);
          if (notification && !notification.read) {
            notification.read = true;
            if (appState.currentRoute === 'notifikasi') RENDER.notifications();
            else RENDER.updateNotificationBadges(); // Cukup update badge jika tidak di halaman notif
            UTILS.showToast("Notifikasi ditandai sudah dibaca.", "info", false);
          }
        },
        showNotificationsFromHeader: () => {
          if (appState.currentRoute === 'notifikasi') {
            UTILS.showToast("Anda sudah di halaman Notifikasi.", "info", false);
            return;
          }
          window.location.hash = 'notifikasi';
        },
        handleResize: () => { // Menangani perubahan ukuran layar untuk state sidebar
          const isMobile = window.innerWidth <= CONFIG.mobileBreakpoint;
          if (isMobile) { // Jika masuk mode mobile
            if (!appState.isSidebarMini && !appState.isSidebarOpenMobile) { // Jika sidebar tadinya full di desktop & belum dibuka di mobile
              DOM.appSidebar.classList.remove('mini'); // Hapus mini jika ada
              DOM.appSidebar.classList.remove('open'); // Pastikan tertutup
              appState.isSidebarOpenMobile = false;
            }
          } else { // Jika masuk mode desktop
            if (appState.isSidebarOpenMobile) { // Jika sidebar tadinya terbuka di mobile
              DOM.appSidebar.classList.remove('open');
              appState.isSidebarOpenMobile = false;
            }
            // Kembalikan state mini/full dari localStorage atau default
            const storedState = localStorage.getItem(CONFIG.sidebarStateKey);
            appState.isSidebarMini = storedState === 'mini';
            DOM.appSidebar.classList.toggle('mini', appState.isSidebarMini);
            DOM.mainWrapper.classList.toggle('sidebar-mini', appState.isSidebarMini);
          }
          RENDER.updateSidebarToggleIcon();
          DOM.sidebarToggleBtn.setAttribute('aria-expanded', String(isMobile ? appState.isSidebarOpenMobile : !appState.isSidebarMini));
        }
      };

      const VALIDATE = {
        propertyForm: () => {
          let isValid = true;
          UTILS.clearFormErrors(DOM.propertyForm);
          if (DOM.propertyNameInput.value.trim() === '') { UTILS.showFieldError('property-name', 'Nama properti wajib diisi.'); isValid = false; }
          else if (DOM.propertyNameInput.value.trim().length < 5) { UTILS.showFieldError('property-name', 'Nama properti minimal 5 karakter.'); isValid = false; }
          if (DOM.propertyLocationInput.value.trim() === '') { UTILS.showFieldError('property-location', 'Lokasi properti wajib diisi.'); isValid = false; }
          const price = parseInt(DOM.propertyPriceInput.value, 10);
          if (DOM.propertyPriceInput.value === '' || isNaN(price) || price <= 0) { UTILS.showFieldError('property-price', 'Harga harus angka positif.'); isValid = false; }
          const imageUrl = DOM.propertyImageInput.value.trim();
          if (imageUrl !== '' && !UTILS.isValidURL(imageUrl)) { UTILS.showFieldError('property-image', 'URL gambar tidak valid. Contoh: https://domain.com/gambar.jpg'); isValid = false; }
          else if (imageUrl !== '' && !/\.(jpeg|jpg|gif|png|webp)(\?.*)?$/i.test(imageUrl)) {
            UTILS.showFieldError('property-image', 'URL harus menunjuk ke file gambar (jpg, png, gif, webp).'); isValid = false;
          }
          return isValid;
        },
        bookingForm: () => {
          let isValid = true;
          UTILS.clearFormErrors(DOM.bookingForm);
          if (DOM.bookingNameInput.value.trim() === '') { UTILS.showFieldError('booking-name', 'Nama penyewa wajib diisi.'); isValid = false; }
          const email = DOM.bookingEmailInput.value.trim();
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (email === '' || !emailRegex.test(email)) { UTILS.showFieldError('booking-email', 'Format email tidak valid.'); isValid = false; }
          const duration = parseInt(DOM.bookingDurationInput.value, 10);
          if (DOM.bookingDurationInput.value === '' || isNaN(duration) || duration < 1) { UTILS.showFieldError('booking-duration', 'Durasi sewa minimal 1 bulan.'); isValid = false; }
          return isValid;
        }
      };

      const INIT = {
        run: () => {
          if (DOM.currentYearSpan) DOM.currentYearSpan.textContent = new Date().getFullYear();

          const savedTheme = localStorage.getItem(CONFIG.themeStorageKey);
          if (savedTheme === 'dark') appState.isDarkMode = true;
          DOM.body.classList.toggle('dark-mode', appState.isDarkMode);
          DOM.themeToggleIcon.className = appState.isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
          DOM.themeToggleText.textContent = appState.isDarkMode ? 'Mode Terang' : 'Mode Gelap';
          DOM.themeToggleButton.setAttribute('aria-label', `Ganti ke Mode ${appState.isDarkMode ? 'Terang' : 'Gelap'}`);

          HANDLERS.handleResize(); // Atur state sidebar awal berdasarkan ukuran layar dan localStorage

          if (DOM.themeToggleButton) DOM.themeToggleButton.addEventListener('click', HANDLERS.toggleTheme);
          if (DOM.sidebarToggleBtn) DOM.sidebarToggleBtn.addEventListener('click', HANDLERS.toggleSidebar);
          if (DOM.notificationsHeaderBtn) DOM.notificationsHeaderBtn.addEventListener('click', HANDLERS.showNotificationsFromHeader);
          DOM.navLinks.forEach(link => link.addEventListener('click', HANDLERS.navigate));
          window.addEventListener('hashchange', HANDLERS.handleHashChange);
          window.addEventListener('resize', HANDLERS.handleResize);
          MODALS.setupEventListeners();

          if (DOM.propertyForm) DOM.propertyForm.addEventListener('submit', HANDLERS.saveProperty);
          if (DOM.bookingForm) DOM.bookingForm.addEventListener('submit', HANDLERS.submitBooking);

          HANDLERS.handleHashChange(); // Render halaman awal
          RENDER.updateNotificationBadges();

          if (DOM.loadingPlaceholder) {
            DOM.loadingPlaceholder.style.opacity = '0';
            DOM.loadingPlaceholder.style.visibility = 'hidden';
            DOM.loadingPlaceholder.addEventListener('transitionend', () => DOM.loadingPlaceholder.remove(), { once: true });
          }
          console.info("Aplikasi Dashboard Properti Lembah Hijau berhasil diinisialisasi. Mode: Vanilla JS SPA.");
        }
      };

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', INIT.run);
      } else {
        INIT.run();
      }
    })();
  </script>
</body>

</html>