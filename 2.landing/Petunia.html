<!DOCTYPE html>
<html lang="id" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green Valley Estetika | Apartemen Impian Anda</title>

    <!-- Favicon (Emoji sebagai contoh, ganti dengan .ico atau .png jika ada) -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèûÔ∏è</text></svg>">

    <!-- Google Fonts: Poppins untuk Judul, Inter untuk Teks Umum -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* Reset Dasar dan Variabel Global */
        :root {
            /* Palet Warna Utama (Fancy Green Theme) */
            --color-primary-light: #2ecc71;
            /* Emerald Green */
            --color-primary-dark: #27ae60;
            /* Darker Emerald */
            --color-secondary-light: #3498db;
            /* Peter River Blue */
            --color-secondary-dark: #2980b9;
            /* Belize Hole Blue */
            --color-accent-light: #f1c40f;
            /* Sun Flower Yellow */
            --color-accent-dark: #f39c12;
            /* Orange */
            --color-error-light: #e74c3c;
            /* Pomegranate Red */
            --color-error-dark: #c0392b;
            /* Darker Pomegranate Red */


            /* Warna Netral & Latar Belakang */
            --color-bg-light: #f4f7f6;
            /* Sangat terang, sedikit keabu-abuan/kehijauan */
            --color-surface-light: #ffffff;
            --color-text-light: #34495e;
            /* Wet Asphalt */
            --color-border-light: #e0e6ed;

            --color-bg-dark: #2c3e50;
            /* Midnight Blue */
            --color-surface-dark: #34495e;
            /* Wet Asphalt */
            --color-text-dark: #ecf0f1;
            /* Clouds */
            --color-border-dark: #4a627a;

            /* Tipografi */
            --font-primary: 'Poppins', sans-serif;
            --font-secondary: 'Inter', sans-serif;
            --text-base-size: 16px;

            /* Spasi & Radius */
            --spacing-unit: 8px;
            --border-radius-small: 4px;
            --border-radius-medium: 8px;
            --border-radius-large: 16px;

            /* Bayangan */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);

            /* Transisi */
            --transition-fast: all 0.2s ease-in-out;
            --transition-normal: all 0.3s ease-in-out;
        }

        /* Inisialisasi Tema Terang sebagai default */
        html[data-theme="light"] {
            --app-primary: var(--color-primary-light);
            --app-primary-hover: var(--color-primary-dark);
            --app-secondary: var(--color-secondary-light);
            --app-secondary-hover: var(--color-secondary-dark);
            --app-accent: var(--color-accent-light);
            --app-accent-hover: var(--color-accent-dark);
            --app-error: var(--color-error-light);
            --app-bg: var(--color-bg-light);
            --app-surface: var(--color-surface-light);
            --app-text: var(--color-text-light);
            --app-text-muted: #7f8c8d;
            /* Asbestos */
            --app-border: var(--color-border-light);
            --app-input-bg: var(--color-surface-light);
        }

        html[data-theme="dark"] {
            --app-primary: var(--color-primary-dark);
            /* Sedikit lebih gelap untuk kontras lebih baik di mode gelap */
            --app-primary-hover: var(--color-primary-light);
            --app-secondary: var(--color-secondary-dark);
            --app-secondary-hover: var(--color-secondary-light);
            --app-accent: var(--color-accent-dark);
            --app-accent-hover: var(--color-accent-light);
            --app-error: var(--color-error-dark);
            --app-bg: var(--color-bg-dark);
            --app-surface: var(--color-surface-dark);
            --app-text: var(--color-text-dark);
            --app-text-muted: #bdc3c7;
            /* Silver */
            --app-border: var(--color-border-dark);
            --app-input-bg: var(--color-surface-dark);
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: var(--text-base-size);
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-secondary);
            background-color: var(--app-bg);
            color: var(--app-text);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: var(--transition-normal);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        /* Struktur Utama */
        .app-container {
            width: 100%;
            max-width: 1200px;
            /* Kontainer utama agar tidak terlalu lebar di layar besar */
            margin: 0 auto;
            padding: 0 calc(var(--spacing-unit) * 2);
        }

        .app-header {
            background-color: var(--app-surface);
            border-bottom: 1px solid var(--app-border);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-sm);
            transition: var(--transition-normal);
        }

        .app-main {
            flex-grow: 1;
            padding-top: calc(var(--spacing-unit) * 4);
            padding-bottom: calc(var(--spacing-unit) * 4);
        }

        .app-footer {
            background-color: var(--app-surface);
            border-top: 1px solid var(--app-border);
            padding: calc(var(--spacing-unit) * 2) 0;
            text-align: center;
            font-size: 0.9em;
            color: var(--app-text-muted);
            transition: var(--transition-normal);
        }

        /* Navigasi */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
            /* Ketinggian Navbar yang konsisten */
        }

        .navbar-brand {
            font-family: var(--font-primary);
            font-size: 1.5em;
            font-weight: 700;
            text-decoration: none;
            color: var(--app-text);
            display: flex;
            align-items: center;
        }

        .navbar-brand .icon {
            color: var(--app-primary);
            margin-right: var(--spacing-unit);
            font-size: 1.2em;
            /* Ukuran icon di brand */
        }

        .navbar-brand span {
            color: var(--app-primary);
        }

        .nav-menu {
            list-style: none;
            display: flex;
            align-items: center;
        }

        .nav-item {
            margin-left: calc(var(--spacing-unit) * 2.5);
        }

        .nav-link {
            text-decoration: none;
            color: var(--app-text);
            font-weight: 500;
            padding: calc(var(--spacing-unit) * 1) calc(var(--spacing-unit) * 1.5);
            border-radius: var(--border-radius-small);
            transition: var(--transition-fast);
            position: relative;
            /* Untuk garis bawah */
            display: flex;
            align-items: center;
        }

        .nav-link .icon {
            margin-right: calc(var(--spacing-unit) * 0.75);
            font-size: 1.1em;
        }

        .nav-link:hover,
        .nav-link.active {
            color: var(--app-primary);
            background-color: color-mix(in srgb, var(--app-primary) 10%, transparent);
            /* Warna primer dengan opacity rendah */
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            /* Sesuaikan dengan border-bottom header */
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 3px;
            background-color: var(--app-primary);
            border-radius: 2px;
        }

        .theme-toggle-btn {
            background: none;
            border: 1px solid var(--app-border);
            color: var(--app-text);
            padding: calc(var(--spacing-unit) * 0.8) calc(var(--spacing-unit) * 1.2);
            border-radius: var(--border-radius-medium);
            cursor: pointer;
            font-size: 1.1em;
            /* Ukuran icon tombol tema */
            transition: var(--transition-fast);
            min-width: 44px;
            /* Untuk aksesibilitas */
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle-btn:hover {
            border-color: var(--app-primary);
            color: var(--app-primary);
        }

        .navbar-toggler {
            /* Untuk mobile */
            display: none;
            background: none;
            border: none;
            font-size: 1.5em;
            color: var(--app-text);
            cursor: pointer;
        }

        /* Konten Halaman SPA */
        .page {
            display: none;
            /* Sembunyikan secara default */
            animation: pageFadeIn 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .page.active {
            display: block;
        }

        @keyframes pageFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Judul Halaman & Bagian */
        .page-title,
        .section-title {
            font-family: var(--font-primary);
            color: var(--app-text);
            margin-bottom: calc(var(--spacing-unit) * 3);
            font-weight: 700;
        }

        .page-title {
            font-size: 2.2em;
            border-bottom: 3px solid var(--app-primary);
            padding-bottom: var(--spacing-unit);
            display: inline-block;
            /* Agar border bottom hanya sepanjang teks */
        }

        .section-title {
            font-size: 1.8em;
        }

        .page-title .icon,
        .section-title .icon {
            color: var(--app-primary);
            margin-right: var(--spacing-unit);
        }

        /* Kartu Properti (Fancy Card Design) */
        .property-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            /* Grid Responsif */
            gap: calc(var(--spacing-unit) * 3);
        }

        .property-card {
            background-color: var(--app-surface);
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: var(--transition-normal);
            border: 1px solid var(--app-border);
        }

        .property-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: var(--shadow-lg);
        }

        .property-card-image-wrapper {
            position: relative;
            width: 100%;
            padding-top: 60%;
            /* Aspect ratio 5:3 */
            overflow: hidden;
        }

        .property-card-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .property-card:hover .property-card-image {
            transform: scale(1.1);
        }

        .property-card-content {
            padding: calc(var(--spacing-unit) * 2);
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            /* Agar konten mengisi ruang vertikal */
        }

        .property-card-title {
            font-family: var(--font-primary);
            font-size: 1.25em;
            font-weight: 600;
            margin-bottom: calc(var(--spacing-unit) * 0.5);
            color: var(--app-text);
        }

        .property-card-location {
            font-size: 0.9em;
            color: var(--app-text-muted);
            margin-bottom: calc(var(--spacing-unit) * 1.5);
            display: flex;
            align-items: center;
        }

        .property-card-location .icon {
            margin-right: calc(var(--spacing-unit) * 0.5);
            color: var(--app-secondary);
        }

        .property-card-features {
            list-style: none;
            display: flex;
            justify-content: space-between;
            /* Atau space-around */
            margin-bottom: calc(var(--spacing-unit) * 1.5);
            padding: calc(var(--spacing-unit) * 1) 0;
            border-top: 1px dashed var(--app-border);
            border-bottom: 1px dashed var(--app-border);
            font-size: 0.85em;
        }

        .property-card-features li {
            display: flex;
            align-items: center;
            color: var(--app-text-muted);
        }

        .property-card-features .icon {
            margin-right: calc(var(--spacing-unit) * 0.5);
            color: var(--app-accent);
            font-size: 1.1em;
        }

        .property-card-description {
            font-size: 0.9em;
            line-height: 1.5;
            margin-bottom: calc(var(--spacing-unit) * 2);
            flex-grow: 1;
            /* Deskripsi mengisi ruang yang tersedia */
            color: var(--app-text);
        }

        .property-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            /* Mendorong footer ke bawah */
        }

        .property-card-price {
            font-family: var(--font-primary);
            font-size: 1.3em;
            font-weight: 700;
            color: var(--app-primary);
        }

        /* Tombol (Fancy Buttons) */
        .btn {
            display: inline-flex;
            /* Agar icon dan teks sejajar */
            align-items: center;
            justify-content: center;
            padding: calc(var(--spacing-unit) * 1.25) calc(var(--spacing-unit) * 2.5);
            font-family: var(--font-primary);
            font-weight: 600;
            font-size: 0.95em;
            text-decoration: none;
            border: none;
            border-radius: var(--border-radius-medium);
            cursor: pointer;
            transition: var(--transition-fast);
            text-align: center;
            /* Pastikan teks di tengah jika tidak ada icon */
        }

        .btn .icon {
            margin-right: var(--spacing-unit);
            font-size: 1.1em;
        }

        .btn-sm {
            padding: calc(var(--spacing-unit) * 0.75) calc(var(--spacing-unit) * 1.5);
            font-size: 0.85em;
        }

        .btn-lg {
            padding: calc(var(--spacing-unit) * 1.75) calc(var(--spacing-unit) * 3.5);
            font-size: 1.1em;
        }

        .btn-primary {
            background-color: var(--app-primary);
            color: var(--color-surface-light);
            /* Teks putih untuk kontras */
        }

        .btn-primary:hover {
            background-color: var(--app-primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px color-mix(in srgb, var(--app-primary) 30%, transparent);
        }

        html[data-theme="dark"] .btn-primary {
            color: var(--color-text-dark);
            /* Mungkin perlu disesuaikan jika primer gelap terlalu gelap */
        }


        .btn-secondary {
            background-color: var(--app-secondary);
            color: var(--color-surface-light);
        }

        .btn-secondary:hover {
            background-color: var(--app-secondary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px color-mix(in srgb, var(--app-secondary) 30%, transparent);
        }

        .btn-outline-primary {
            background-color: transparent;
            color: var(--app-primary);
            border: 2px solid var(--app-primary);
        }

        .btn-outline-primary:hover {
            background-color: var(--app-primary);
            color: var(--color-surface-light);
        }

        html[data-theme="dark"] .btn-outline-primary:hover {
            color: var(--color-text-dark);
        }

        .btn-outline-secondary {
            background-color: transparent;
            color: var(--app-secondary);
            border: 2px solid var(--app-secondary);
        }

        .btn-outline-secondary:hover {
            background-color: var(--app-secondary);
            color: var(--color-surface-light);
        }

        /* Formulir (Fancy Forms) */
        .form-group {
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: calc(var(--spacing-unit) * 0.75);
            font-size: 0.9em;
        }

        .form-control,
        .form-select {
            width: 100%;
            padding: calc(var(--spacing-unit) * 1.25);
            border: 1px solid var(--app-border);
            border-radius: var(--border-radius-medium);
            background-color: var(--app-input-bg);
            color: var(--app-text);
            font-size: 1em;
            transition: var(--transition-fast);
        }

        .form-control:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--app-primary);
            box-shadow: 0 0 0 3px color-mix(in srgb, var(--app-primary) 20%, transparent);
        }

        .filter-form-container {
            background-color: var(--app-surface);
            padding: calc(var(--spacing-unit) * 3);
            border-radius: var(--border-radius-large);
            margin-bottom: calc(var(--spacing-unit) * 4);
            box-shadow: var(--shadow-sm);
        }

        .filter-form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: calc(var(--spacing-unit) * 2);
            align-items: end;
            /* Sejajarkan item ke bawah, berguna untuk tombol */
        }

        .filter-actions {
            grid-column: 1 / -1;
            /* Tombol mengambil seluruh lebar pada baris baru jika perlu */
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-unit);
            margin-top: var(--spacing-unit);
        }

        /* Hero Section di Dashboard */
        .hero-section {
            background: linear-gradient(135deg, color-mix(in srgb, var(--app-primary) 80%, transparent), color-mix(in srgb, var(--app-secondary) 70%, transparent)),
                url('https://images.unsplash.com/photo-1580587771525-78b9dba3b914?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80') no-repeat center center/cover;
            padding: calc(var(--spacing-unit) * 8) calc(var(--spacing-unit) * 3);
            border-radius: var(--border-radius-large);
            text-align: center;
            color: var(--color-text-dark);
            /* Teks terang di atas gambar gelap */
            margin-bottom: calc(var(--spacing-unit) * 4);
        }

        .hero-title {
            font-family: var(--font-primary);
            font-size: 3em;
            font-weight: 800;
            margin-bottom: calc(var(--spacing-unit) * 2);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .hero-subtitle {
            font-size: 1.25em;
            margin-bottom: calc(var(--spacing-unit) * 3);
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Info Boxes di Dashboard */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: calc(var(--spacing-unit) * 3);
        }

        .info-box {
            background-color: var(--app-surface);
            padding: calc(var(--spacing-unit) * 3);
            border-radius: var(--border-radius-medium);
            box-shadow: var(--shadow-sm);
            border-left: 5px solid var(--app-accent);
        }

        .info-box h3 {
            font-family: var(--font-primary);
            font-size: 1.4em;
            margin-bottom: var(--spacing-unit);
            color: var(--app-accent);
        }

        /* Tabel (Untuk Halaman CRUD) */
        .table-responsive {
            overflow-x: auto;
            /* Hanya scroll horizontal jika perlu */
            background-color: var(--app-surface);
            border-radius: var(--border-radius-medium);
            box-shadow: var(--shadow-sm);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
        }

        .table th,
        .table td {
            padding: calc(var(--spacing-unit) * 1.5);
            text-align: left;
            border-bottom: 1px solid var(--app-border);
        }

        .table th {
            background-color: color-mix(in srgb, var(--app-primary) 10%, transparent);
            font-weight: 600;
            font-family: var(--font-primary);
            color: var(--app-primary);
        }

        .table tbody tr:hover {
            background-color: color-mix(in srgb, var(--app-secondary) 5%, transparent);
        }

        .table td .btn {
            margin-right: calc(var(--spacing-unit) * 0.5);
        }

        .table td .btn:last-child {
            margin-right: 0;
        }

        /* Pesan "Tidak Ada Hasil" */
        .no-results-message {
            text-align: center;
            padding: calc(var(--spacing-unit) * 5);
            background-color: var(--app-surface);
            border-radius: var(--border-radius-medium);
            color: var(--app-text-muted);
            font-size: 1.2em;
        }

        .no-results-message .icon {
            font-size: 3em;
            display: block;
            margin-bottom: var(--spacing-unit);
            color: var(--app-secondary);
        }

        /* Responsifitas */
        @media (max-width: 768px) {
            .navbar {
                height: auto;
                padding: var(--spacing-unit) 0;
            }

            .navbar-toggler {
                display: block;
            }

            .nav-menu {
                display: none;
                /* Sembunyikan default, tampilkan dengan JS */
                flex-direction: column;
                width: 100%;
                position: absolute;
                top: 69px;
                /* Tepat di bawah header */
                left: 0;
                background-color: var(--app-surface);
                box-shadow: var(--shadow-md);
                border-top: 1px solid var(--app-border);
            }

            .nav-menu.open {
                display: flex;
            }

            .nav-item {
                margin: 0;
                width: 100%;
            }

            .nav-link {
                padding: calc(var(--spacing-unit) * 1.5);
                justify-content: center;
                border-bottom: 1px solid var(--app-border);
            }

            .nav-link.active::after {
                width: 30%;
                height: 2px;
                bottom: 5px;
            }

            .nav-item:last-child .nav-link {
                border-bottom: none;
            }

            .nav-item .theme-toggle-btn {
                /* Pindahkan tombol tema ke dalam menu mobile */
                width: 100%;
                border-radius: 0;
                border-left: none;
                border-right: none;
                justify-content: center;
                /* Tengah kan icon */
            }

            .nav-menu .nav-item:has(.theme-toggle-btn) {
                /* Hapus margin kiri untuk tombol tema di mobile */
                margin-left: 0;
            }


            .hero-title {
                font-size: 2.2em;
            }

            .hero-subtitle {
                font-size: 1.1em;
            }

            .page-title {
                font-size: 1.8em;
            }

            .section-title {
                font-size: 1.5em;
            }

            .filter-form-grid {
                grid-template-columns: 1fr;
                /* Semua input jadi satu kolom */
            }

            .filter-actions {
                flex-direction: column;
                /* Tombol filter jadi vertikal */
            }

            .filter-actions .btn {
                width: 100%;
            }
        }

        /* --- BARU: UI Components Styles --- */

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: calc(var(--spacing-unit) * 2 + 70px);
            /* Bawah header */
            right: calc(var(--spacing-unit) * 2);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-unit);
            max-width: 350px;
        }

        .toast {
            background-color: var(--app-surface);
            color: var(--app-text);
            padding: calc(var(--spacing-unit) * 1.5) calc(var(--spacing-unit) * 2);
            border-radius: var(--border-radius-medium);
            box-shadow: var(--shadow-md);
            border-left: 5px solid var(--app-primary);
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            min-width: 250px;
            display: flex;
            align-items: center;
            gap: var(--spacing-unit);
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast.hide {
            /* For controlled exit animation if needed, current JS removes directly after timeout */
            opacity: 0;
            transform: translateX(100%);
        }

        .toast-icon {
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .toast-message {
            flex-grow: 1;
        }

        .toast-success {
            border-left-color: var(--app-primary);
        }

        .toast-success .toast-icon {
            color: var(--app-primary);
        }

        .toast-error {
            border-left-color: var(--app-error);
        }

        .toast-error .toast-icon {
            color: var(--app-error);
        }

        .toast-info {
            border-left-color: var(--app-secondary);
        }

        .toast-info .toast-icon {
            color: var(--app-secondary);
        }

        .toast-warning {
            border-left-color: var(--app-accent);
        }

        .toast-warning .toast-icon {
            color: var(--app-accent);
        }

        /* Alert System */
        .alert-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2500;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s 0.3s linear;
        }

        .alert-overlay.show {
            opacity: 1;
            visibility: visible;
            transition-delay: 0s;
        }

        .alert-box {
            background-color: var(--app-surface);
            color: var(--app-text);
            padding: calc(var(--spacing-unit) * 3);
            border-radius: var(--border-radius-medium);
            box-shadow: var(--shadow-lg);
            width: 90%;
            max-width: 500px;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .alert-overlay.show .alert-box {
            transform: scale(1);
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: calc(var(--spacing-unit) * 2);
            padding-bottom: var(--spacing-unit);
            border-bottom: 1px solid var(--app-border);
        }

        .alert-header h3 {
            font-family: var(--font-primary);
            font-size: 1.3em;
            margin: 0;
            color: var(--app-text);
            /* Default, can be overridden by JS for type */
        }

        .alert-close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            color: var(--app-text-muted);
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }

        .alert-close-btn:hover {
            color: var(--app-text);
        }

        .alert-body {
            margin-bottom: calc(var(--spacing-unit) * 3);
            font-size: 1em;
            line-height: 1.6;
        }

        .alert-footer {
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-unit);
        }

        /* Flash Messages */
        .flash-message-container {
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .flash-message {
            padding: calc(var(--spacing-unit) * 1.5);
            border-radius: var(--border-radius-medium);
            margin-bottom: var(--spacing-unit);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-sm);
            opacity: 0;
            transform: translateY(-20px);
            animation: flashFadeIn 0.5s ease forwards;
        }

        @keyframes flashFadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .flash-message-content {
            display: flex;
            align-items: center;
            gap: var(--spacing-unit);
        }

        .flash-message-icon {
            font-size: 1.3em;
            flex-shrink: 0;
        }

        .flash-message-text {
            flex-grow: 1;
        }

        .flash-message-close-btn {
            background: none;
            border: none;
            font-size: 1.2em;
            color: inherit;
            opacity: 0.7;
            cursor: pointer;
            padding: calc(var(--spacing-unit) * 0.5);
            margin-left: var(--spacing-unit);
            flex-shrink: 0;
        }

        .flash-message-close-btn:hover {
            opacity: 1;
        }

        .flash-message-success {
            background-color: var(--app-primary);
            color: var(--color-surface-light);
            border: 1px solid var(--app-primary-hover);
        }

        html[data-theme="dark"] .flash-message-success {
            background-color: var(--app-primary);
            color: var(--color-text-dark);
            border: 1px solid var(--app-primary-hover);
        }

        .flash-message-error {
            background-color: var(--app-error);
            color: white;
            border: 1px solid color-mix(in srgb, var(--app-error) 80%, black);
        }

        .flash-message-info {
            background-color: var(--app-secondary);
            color: var(--color-surface-light);
            border: 1px solid var(--app-secondary-hover);
        }

        html[data-theme="dark"] .flash-message-info {
            background-color: var(--app-secondary);
            color: var(--color-text-dark);
            border: 1px solid var(--app-secondary-hover);
        }

        .flash-message-warning {
            background-color: var(--app-accent);
            color: var(--app-text);
            border: 1px solid var(--app-accent-hover);
        }

        html[data-theme="dark"] .flash-message-warning {
            background-color: var(--app-accent);
            color: var(--app-text);
            border: 1px solid var(--app-accent-hover);
        }


        /* Off-Canvas Panel */
        .off-canvas-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1500;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s 0.3s linear;
        }

        .off-canvas-overlay.show {
            opacity: 1;
            visibility: visible;
            transition-delay: 0s;
        }

        .off-canvas-panel {
            position: fixed;
            top: 0;
            right: -100%;
            /* Start off-screen */
            width: 90%;
            max-width: 450px;
            height: 100%;
            background-color: var(--app-surface);
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.2);
            z-index: 1600;
            display: flex;
            flex-direction: column;
            transition: right 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .off-canvas-panel.open {
            right: 0;
        }

        .off-canvas-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: calc(var(--spacing-unit) * 2);
            border-bottom: 1px solid var(--app-border);
            background-color: var(--app-surface);
            /* Ensure it matches panel */
            flex-shrink: 0;
        }

        .off-canvas-title {
            font-family: var(--font-primary);
            font-size: 1.4em;
            margin: 0;
            color: var(--app-primary);
        }

        .off-canvas-close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            color: var(--app-text-muted);
            cursor: pointer;
            padding: calc(var(--spacing-unit) * 0.5);
            line-height: 1;
        }

        .off-canvas-close-btn:hover {
            color: var(--app-primary);
        }

        .off-canvas-content {
            padding: calc(var(--spacing-unit) * 2);
            overflow-y: auto;
            flex-grow: 1;
            color: var(--app-text);
        }

        .off-canvas-property-detail img {
            width: 100%;
            height: auto;
            border-radius: var(--border-radius-medium);
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .off-canvas-property-detail h3 {
            font-family: var(--font-primary);
            font-size: 1.5em;
            color: var(--app-primary);
            margin-bottom: var(--spacing-unit);
        }

        .off-canvas-property-detail p {
            margin-bottom: var(--spacing-unit);
            line-height: 1.6;
        }

        .off-canvas-property-detail .features {
            list-style: none;
            padding: 0;
            margin: calc(var(--spacing-unit) * 2) 0;
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-unit);
        }

        .off-canvas-property-detail .features li {
            background-color: color-mix(in srgb, var(--app-primary) 10%, transparent);
            padding: calc(var(--spacing-unit) * 0.5) var(--spacing-unit);
            border-radius: var(--border-radius-small);
            font-size: 0.9em;
        }

        .off-canvas-property-detail .price {
            font-family: var(--font-primary);
            font-size: 1.6em;
            font-weight: 700;
            color: var(--app-primary);
            margin-top: calc(var(--spacing-unit) * 2);
            text-align: right;
        }

        /* --- End of UI Components Styles --- */
    </style>
</head>

<body>
    <!-- Header Aplikasi -->
    <header class="app-header">
        <div class="app-container">
            <nav class="navbar">
                <a href="#dashboard" class="navbar-brand page-router">
                    <i class="fas fa-mountain-sun icon"></i> Green<span>Valley</span>
                </a>
                <button class="navbar-toggler" id="navbarToggler" aria-label="Toggle navigasi" aria-expanded="false">
                    <i class="fas fa-bars"></i>
                </button>
                <ul class="nav-menu" id="navMenu">
                    <li class="nav-item"><a class="nav-link page-router" href="#dashboard"><i
                                class="fas fa-tachometer-alt icon"></i> Dasbor</a></li>
                    <li class="nav-item"><a class="nav-link page-router" href="#apartments"><i
                                class="fas fa-city icon"></i> Apartemen</a></li>
                    <li class="nav-item"><a class="nav-link page-router" href="#crud"><i class="fas fa-edit icon"></i>
                            Kelola</a></li>
                    <li class="nav-item">
                        <button id="themeToggleBtn" class="theme-toggle-btn" title="Ganti Tema">
                            <i class="fas fa-sun"></i> <!-- Icon akan diubah oleh JS -->
                        </button>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Konten Utama Aplikasi -->
    <main class="app-main">
        <div class="app-container">
            <!-- BARU: Flash Message Container -->
            <div id="flashMessageContainer" class="flash-message-container"></div>

            <!-- Halaman Dasbor -->
            <section id="dashboard-page" class="page">
                <div class="hero-section">
                    <h1 class="hero-title">Temukan Surga Hunian Anda</h1>
                    <p class="hero-subtitle">Green Valley Estetika menawarkan pilihan apartemen eksklusif dengan desain
                        modern, fasilitas lengkap, dan lokasi strategis untuk gaya hidup berkualitas.</p>
                    <a href="#apartments" class="btn btn-primary btn-lg page-router">
                        <i class="fas fa-search icon"></i> Jelajahi Apartemen
                    </a>
                </div>

                <div class="info-grid">
                    <article class="info-box">
                        <h3><i class="fas fa-star icon"></i> Kualitas Terbaik</h3>
                        <p>Kami hanya menampilkan properti dengan standar kualitas dan kenyamanan tertinggi untuk Anda.
                        </p>
                    </article>
                    <article class="info-box">
                        <h3><i class="fas fa-map-marked-alt icon"></i> Lokasi Strategis</h3>
                        <p>Akses mudah ke pusat bisnis, hiburan, dan fasilitas publik penting lainnya.</p>
                    </article>
                    <article class="info-box">
                        <h3><i class="fas fa-shield-alt icon"></i> Transaksi Aman</h3>
                        <p>Platform kami dirancang untuk memastikan proses pencarian dan transaksi Anda aman dan nyaman.
                        </p>
                    </article>
                </div>
            </section>

            <!-- Halaman Apartemen -->
            <section id="apartments-page" class="page">
                <h1 class="page-title"><i class="fas fa-city icon"></i> Galeri Apartemen</h1>

                <div class="filter-form-container">
                    <form id="filterForm">
                        <div class="filter-form-grid">
                            <div class="form-group">
                                <label for="searchKeyword" class="form-label">Kata Kunci (Nama, Lokasi)</label>
                                <input type="text" id="searchKeyword" class="form-control"
                                    placeholder="Contoh: Mewah, Pusat Kota">
                            </div>
                            <div class="form-group">
                                <label for="filterBedrooms" class="form-label">Kamar Tidur</label>
                                <select id="filterBedrooms" class="form-select">
                                    <option value="">Semua</option>
                                    <option value="1">1 Kamar</option>
                                    <option value="2">2 Kamar</option>
                                    <option value="3">3+ Kamar</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="filterPrice" class="form-label">Rentang Harga</label>
                                <select id="filterPrice" class="form-select">
                                    <option value="">Semua</option>
                                    <option value="0-500000000">Hingga Rp 500 Jt</option>
                                    <option value="500000000-1000000000">Rp 500 Jt - Rp 1 M</option>
                                    <option value="1000000000-Infinity">Diatas Rp 1 M</option>
                                </select>
                            </div>
                            <div class="filter-actions">
                                <button type="submit" class="btn btn-primary"><i class="fas fa-filter icon"></i>
                                    Terapkan</button>
                                <button type="reset" class="btn btn-outline-secondary"><i class="fas fa-undo icon"></i>
                                    Reset</button>
                            </div>
                        </div>
                    </form>
                </div>

                <div id="propertyList" class="property-grid">
                    <!-- Kartu properti akan dimuat di sini oleh JavaScript -->
                </div>
                <div id="noResultsMessage" class="no-results-message" style="display: none;">
                    <i class="fas fa-search-minus icon"></i>
                    <p>Oops! Tidak ada properti yang cocok dengan kriteria Anda.</p>
                    <p>Coba ubah filter atau kata kunci pencarian.</p>
                </div>
            </section>

            <!-- Halaman Kelola Properti (CRUD Placeholder) -->
            <section id="crud-page" class="page">
                <h1 class="page-title"><i class="fas fa-edit icon"></i> Kelola Properti</h1>
                <p>Halaman ini adalah contoh untuk fitur manajemen properti (CRUD). Dalam aplikasi nyata, ini akan
                    terhubung ke sistem backend untuk mengelola data properti.</p>

                <button id="addPropertyBtn" class="btn btn-primary"
                    style="margin-bottom: calc(var(--spacing-unit) * 2);"><i class="fas fa-plus icon"></i> Tambah
                    Properti Baru</button>

                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nama Properti</th>
                                <th>Lokasi</th>
                                <th>Harga</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>GVX001</td>
                                <td>The Royal Emerald</td>
                                <td>Jakarta Selatan</td>
                                <td>Rp 2.500.000.000</td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" title="Lihat"><i
                                            class="fas fa-eye"></i></button>
                                    <button class="btn btn-sm btn-accent" title="Edit"><i
                                            class="fas fa-pencil-alt"></i></button>
                                    <button class="btn btn-sm btn-danger-custom delete-property-btn" title="Hapus"
                                        data-property-id="GVX001" data-property-name="The Royal Emerald"><i
                                            class="fas fa-trash-alt"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>GVX002</td>
                                <td>Azure Sky Suites</td>
                                <td>Surabaya Pusat</td>
                                <td>Rp 1.850.000.000</td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" title="Lihat"><i
                                            class="fas fa-eye"></i></button>
                                    <button class="btn btn-sm btn-accent" title="Edit"><i
                                            class="fas fa-pencil-alt"></i></button>
                                    <button class="btn btn-sm btn-danger-custom delete-property-btn" title="Hapus"
                                        data-property-id="GVX002" data-property-name="Azure Sky Suites"><i
                                            class="fas fa-trash-alt"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <style>
                    /* CSS tambahan untuk tombol danger custom jika tidak ada utility class-nya */
                    .btn-danger-custom {
                        background-color: var(--app-error);
                        color: white;
                    }

                    .btn-danger-custom:hover {
                        background-color: color-mix(in srgb, var(--app-error) 80%, black);
                    }

                    .btn-accent {
                        background-color: var(--app-accent);
                        color: var(--app-text);
                        /* For light theme, may need adjustment for dark */
                    }

                    html[data-theme="dark"] .btn-accent {
                        color: var(--color-bg-dark);
                        /* Better contrast for dark yellow */
                    }

                    .btn-accent:hover {
                        background-color: var(--app-accent-hover);
                    }
                </style>
            </section>

        </div>
    </main>

    <!-- Footer Aplikasi -->
    <footer class="app-footer">
        <div class="app-container">
            <p>¬© <span id="currentYear"></span> Green Valley Estetika. Dirancang dengan <i class="fas fa-heart"
                    style="color: #e74c3c;"></i> menggunakan teknologi SPA HTML5 Native.</p>
            <p>Semua hak cipta dilindungi.</p>
        </div>
    </footer>

    <!-- Template untuk Kartu Properti (Digunakan oleh JavaScript) -->
    <template id="propertyCardTemplate">
        <article class="property-card">
            <div class="property-card-image-wrapper">
                <img src="" alt="Gambar Apartemen" class="property-card-image">
            </div>
            <div class="property-card-content">
                <h3 class="property-card-title">Nama Apartemen</h3>
                <p class="property-card-location"><i class="fas fa-map-marker-alt icon"></i> <span>Lokasi</span></p>
                <ul class="property-card-features">
                    <li><i class="fas fa-bed icon"></i> <span data-feature="bedrooms">-</span> K. Tidur</li>
                    <li><i class="fas fa-bath icon"></i> <span data-feature="bathrooms">-</span> K. Mandi</li>
                    <li><i class="fas fa-ruler-combined icon"></i> <span data-feature="area">-</span> m¬≤</li>
                </ul>
                <p class="property-card-description">Deskripsi singkat properti...</p>
                <div class="property-card-footer">
                    <span class="property-card-price">Rp 0</span>
                    <a href="#" class="btn btn-sm btn-primary property-details-link">
                        <i class="fas fa-info-circle icon"></i> Detail
                    </a>
                </div>
            </div>
        </article>
    </template>

    <!-- BARU: Off-Canvas Container (Panel dan Overlay) -->
    <div id="offCanvasContainer" class="off-canvas-container">
        <div id="offCanvasOverlay" class="off-canvas-overlay" tabindex="-1"></div>
        <div id="offCanvasPanel" class="off-canvas-panel" role="dialog" aria-modal="true"
            aria-labelledby="offCanvasTitle">
            <div class="off-canvas-header">
                <h2 id="offCanvasTitle" class="off-canvas-title">Detail Properti</h2>
                <button id="offCanvasCloseBtn" class="off-canvas-close-btn" aria-label="Tutup Panel">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="offCanvasContent" class="off-canvas-content">
                <!-- Content will be loaded here by JavaScript -->
            </div>
        </div>
    </div>


    <script>
        // IIFE untuk enkapsulasi kode aplikasi
        (function GreenValleyApp() {
            "use strict";

            // STATE APLIKASI
            const appState = {
                currentTheme: localStorage.getItem('appTheme') || 'light',
                currentPageId: 'dashboard',
                propertiesData: [
                    { id: 'gv001', name: 'Emerald Heights Loft', location: 'Jakarta Pusat, DKI Jakarta', bedrooms: 1, bathrooms: 1, area: 60, price: 850000000, description: 'Apartemen studio mewah dengan pemandangan kota yang menakjubkan, fasilitas lengkap dan desain interior modern minimalis.', image: 'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8YXBhcnRtZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=600&q=80' },
                    { id: 'gv002', name: 'Azure Sky Residence', location: 'Surabaya Barat, Jawa Timur', bedrooms: 3, bathrooms: 2, area: 135, price: 2100000000, description: 'Hunian keluarga eksklusif dengan tiga kamar tidur, taman pribadi di balkon, dan akses ke kolam renang infinity pool.', image: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8YXBhcnRtZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=600&q=80' },
                    { id: 'gv003', name: 'Serene Hillside Villa', location: 'Bandung Utara, Jawa Barat', bedrooms: 2, bathrooms: 2, area: 95, price: 1250000000, description: 'Apartemen dua kamar tidur yang tenang dengan udara sejuk pegunungan, cocok untuk relaksasi dan gaya hidup sehat.', image: 'https://images.unsplash.com/photo-1493809842364-78817add7ffb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NXx8YXBhcnRtZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=600&q=80' },
                    { id: 'gv004', name: 'Urban Oasis Suite', location: 'Medan Kota, Sumatera Utara', bedrooms: 2, bathrooms: 2, area: 100, price: 1150000000, description: 'Suite modern di pusat kota, menawarkan kemewahan dan kenyamanan dengan akses mudah ke berbagai fasilitas urban.', image: 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTB8fGFwYXJ0bWVudCUyMGJ1aWxkaW5nfGVufDB8fDB8fHww&auto=format&fit=crop&w=600&q=80' },
                    { id: 'gv005', name: 'Tranquil Garden Condo', location: 'Bogor Selatan, Jawa Barat', bedrooms: 3, bathrooms: 2, area: 120, price: 1450000000, description: 'Kondominium asri dikelilingi taman hijau, ideal bagi keluarga yang mendambakan ketenangan dan udara segar.', image: 'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTR8fGFwYXJ0bWVudCUyMGJ1aWxkaW5nfGVufDB8fDB8fHww&auto=format&fit=crop&w=600&q=80' },
                    { id: 'gv006', name: 'Metropolitan Sky View', location: 'Tangerang, Banten', bedrooms: 1, bathrooms: 1, area: 45, price: 550000000, description: 'Apartemen studio kompak dan fungsional, sempurna untuk profesional muda dengan mobilitas tinggi.', image: 'https://images.unsplash.com/photo-1484154218962-a197022b5858?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTd8fGFwYXJ0bWVudHxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=600&q=80' }
                ]
            };

            // CACHE ELEMENT DOM
            const DOMElements = {
                html: document.documentElement,
                themeToggleBtn: document.getElementById('themeToggleBtn'),
                navbarToggler: document.getElementById('navbarToggler'),
                navMenu: document.getElementById('navMenu'),
                navLinks: document.querySelectorAll('.nav-link.page-router'),
                pages: document.querySelectorAll('.page'),
                propertyListContainer: document.getElementById('propertyList'),
                propertyCardTemplate: document.getElementById('propertyCardTemplate'),
                filterForm: document.getElementById('filterForm'),
                searchKeywordInput: document.getElementById('searchKeyword'),
                filterBedroomsSelect: document.getElementById('filterBedrooms'),
                filterPriceSelect: document.getElementById('filterPrice'),
                noResultsMessage: document.getElementById('noResultsMessage'),
                currentYearSpan: document.getElementById('currentYear'),
                // New UI Component Elements
                flashMessageContainerEl: document.getElementById('flashMessageContainer'),
                offCanvasPanel: document.getElementById('offCanvasPanel'),
                offCanvasOverlay: document.getElementById('offCanvasOverlay'),
                offCanvasTitleEl: document.getElementById('offCanvasTitle'),
                offCanvasContentEl: document.getElementById('offCanvasContent'),
                offCanvasCloseBtn: document.getElementById('offCanvasCloseBtn'),
                addPropertyBtn: document.getElementById('addPropertyBtn'), // Specific button for flash message demo
                crudPage: document.getElementById('crud-page') // For CRUD delete alerts
            };

            // UTILITIES
            const Utils = {
                formatPrice: (price) => {
                    return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(price);
                },
                truncateText: (text, maxLength) => {
                    if (text.length <= maxLength) return text;
                    let truncated = text.substring(0, maxLength);
                    const lastSpace = truncated.lastIndexOf(' ');
                    if (lastSpace > Math.floor(maxLength * 0.6)) { // Only cut at space if it's reasonably far
                        truncated = truncated.substring(0, lastSpace);
                    }
                    return truncated + '...';
                }
            };

            // UI MANAGER (Toast, Alert, Flash, OffCanvas)
            const UIManager = {
                toastContainer: null,
                offCanvasTabTrapListener: null, // For focus trapping

                initToastContainer: () => {
                    if (!UIManager.toastContainer) {
                        UIManager.toastContainer = document.createElement('div');
                        UIManager.toastContainer.className = 'toast-container';
                        document.body.appendChild(UIManager.toastContainer);
                    }
                },

                showToast: (message, type = 'info', duration = 3000) => {
                    UIManager.initToastContainer();

                    const toast = document.createElement('div');
                    toast.className = `toast toast-${type}`;

                    let iconClass = 'fas fa-info-circle';
                    if (type === 'success') iconClass = 'fas fa-check-circle';
                    else if (type === 'error') iconClass = 'fas fa-times-circle';
                    else if (type === 'warning') iconClass = 'fas fa-exclamation-triangle';

                    toast.innerHTML = `<i class="toast-icon ${iconClass}"></i> <span class="toast-message">${message}</span>`;

                    UIManager.toastContainer.appendChild(toast);

                    requestAnimationFrame(() => {
                        toast.classList.add('show');
                    });

                    setTimeout(() => {
                        toast.classList.remove('show');
                        toast.addEventListener('transitionend', () => {
                            if (toast.parentElement) toast.remove();
                        }, { once: true });
                    }, duration);
                },

                showAlert: (title, message, type = 'info', options = {}) => {
                    const { confirmText = 'OK', cancelText = 'Batal', onConfirm, onCancel, showCancelButton = false } = options;

                    let alertOverlay = document.querySelector('.alert-overlay');
                    if (alertOverlay) alertOverlay.remove();

                    alertOverlay = document.createElement('div');
                    alertOverlay.className = 'alert-overlay';
                    alertOverlay.setAttribute('role', 'alertdialog');
                    alertOverlay.setAttribute('aria-labelledby', 'alertTitle');
                    alertOverlay.setAttribute('aria-describedby', 'alertMessage');


                    const alertBox = document.createElement('div');
                    alertBox.className = 'alert-box';

                    let titleColor = 'var(--app-text)';
                    if (type === 'error') titleColor = 'var(--app-error)';
                    else if (type === 'warning') titleColor = 'var(--app-accent)';

                    alertBox.innerHTML = `
                        <div class="alert-header">
                            <h3 id="alertTitle" style="color: ${titleColor};">${title}</h3>
                            <button class="alert-close-btn" aria-label="Tutup Peringatan">√ó</button>
                        </div>
                        <div class="alert-body">
                            <p id="alertMessage">${message}</p>
                        </div>
                        <div class="alert-footer">
                            ${showCancelButton ? `<button class="btn btn-outline-secondary alert-cancel-btn">${cancelText}</button>` : ''}
                            <button class="btn btn-primary alert-confirm-btn">${confirmText}</button>
                        </div>
                    `;

                    alertOverlay.appendChild(alertBox);
                    document.body.appendChild(alertOverlay);
                    document.body.style.overflow = 'hidden';


                    requestAnimationFrame(() => {
                        alertOverlay.classList.add('show');
                    });

                    const focusableElements = alertBox.querySelectorAll('button');
                    const firstFocusable = focusableElements[0];
                    const lastFocusable = focusableElements[focusableElements.length - 1];
                    if (firstFocusable) firstFocusable.focus();


                    const closeAlert = (action) => {
                        document.body.style.overflow = '';
                        alertOverlay.classList.remove('show');
                        alertOverlay.addEventListener('transitionend', () => {
                            if (alertOverlay.parentElement) alertOverlay.remove();
                            if (action === 'confirm' && typeof onConfirm === 'function') onConfirm();
                            if ((action === 'cancel' || action === 'close') && typeof onCancel === 'function') onCancel();
                        }, { once: true });
                        document.removeEventListener('keydown', escapeListener);
                        alertBox.removeEventListener('keydown', tabTrapListener);
                    };

                    const escapeListener = (e) => {
                        if (e.key === 'Escape') {
                            closeAlert(showCancelButton ? 'cancel' : 'close');
                        }
                    };
                    document.addEventListener('keydown', escapeListener);

                    const tabTrapListener = (e) => {
                        if (e.key === 'Tab') {
                            if (e.shiftKey) { // Shift + Tab
                                if (document.activeElement === firstFocusable) {
                                    lastFocusable.focus();
                                    e.preventDefault();
                                }
                            } else { // Tab
                                if (document.activeElement === lastFocusable) {
                                    firstFocusable.focus();
                                    e.preventDefault();
                                }
                            }
                        }
                    };
                    alertBox.addEventListener('keydown', tabTrapListener);


                    alertBox.querySelector('.alert-confirm-btn').addEventListener('click', () => closeAlert('confirm'));
                    if (showCancelButton) {
                        alertBox.querySelector('.alert-cancel-btn').addEventListener('click', () => closeAlert('cancel'));
                    }
                    alertBox.querySelector('.alert-close-btn').addEventListener('click', () => closeAlert('close'));
                },

                showFlashMessage: (message, type = 'info', dismissible = true, duration = 0) => {
                    const container = DOMElements.flashMessageContainerEl;
                    if (!container) return;

                    const flashDiv = document.createElement('div');
                    flashDiv.className = `flash-message flash-message-${type}`;
                    flashDiv.setAttribute('role', 'status'); // or 'alert' for more urgent messages

                    let iconClass = 'fas fa-info-circle';
                    if (type === 'success') iconClass = 'fas fa-check-circle';
                    else if (type === 'error') iconClass = 'fas fa-times-circle';
                    else if (type === 'warning') iconClass = 'fas fa-exclamation-triangle';

                    let closeButtonHtml = '';
                    if (dismissible) {
                        closeButtonHtml = `<button class="flash-message-close-btn" aria-label="Tutup Pesan">√ó</button>`;
                    }

                    flashDiv.innerHTML = `
                        <div class="flash-message-content">
                            <i class="flash-message-icon ${iconClass}"></i>
                            <span class="flash-message-text">${message}</span>
                        </div>
                        ${closeButtonHtml}
                    `;

                    container.appendChild(flashDiv);

                    const removeFlash = () => {
                        flashDiv.style.transition = 'opacity 0.3s, transform 0.3s, margin-bottom 0.3s, padding 0.3s, height 0.3s';
                        flashDiv.style.opacity = '0';
                        flashDiv.style.transform = 'translateY(-100%)';
                        flashDiv.style.paddingTop = '0';
                        flashDiv.style.paddingBottom = '0';
                        flashDiv.style.marginBottom = '0';
                        flashDiv.style.height = '0';
                        setTimeout(() => {
                            if (flashDiv.parentElement) flashDiv.remove();
                        }, 300);
                    };

                    if (dismissible) {
                        const closeBtn = flashDiv.querySelector('.flash-message-close-btn');
                        if (closeBtn) closeBtn.addEventListener('click', removeFlash);
                    }

                    if (duration > 0) {
                        setTimeout(removeFlash, duration);
                    }
                    return flashDiv;
                },

                openOffCanvas: (title, contentHTML) => {
                    if (!DOMElements.offCanvasPanel) return;
                    DOMElements.offCanvasTitleEl.innerHTML = title; // Use innerHTML for potential icons in title
                    DOMElements.offCanvasContentEl.innerHTML = contentHTML;

                    DOMElements.offCanvasOverlay.classList.add('show');
                    DOMElements.offCanvasPanel.classList.add('open');
                    document.body.style.overflow = 'hidden';

                    DOMElements.offCanvasCloseBtn.focus();

                    // Focus trap for off-canvas
                    const focusableElements = Array.from(DOMElements.offCanvasPanel.querySelectorAll(
                        'a[href], button:not([disabled]), textarea, input, select'
                    ));
                    const firstFocusable = focusableElements[0];
                    const lastFocusable = focusableElements[focusableElements.length - 1];

                    if (UIManager.offCanvasTabTrapListener) {
                        DOMElements.offCanvasPanel.removeEventListener('keydown', UIManager.offCanvasTabTrapListener);
                    }
                    UIManager.offCanvasTabTrapListener = (e) => {
                        if (e.key === 'Tab') {
                            if (e.shiftKey) { // Shift + Tab
                                if (document.activeElement === firstFocusable) {
                                    lastFocusable.focus();
                                    e.preventDefault();
                                }
                            } else { // Tab
                                if (document.activeElement === lastFocusable) {
                                    firstFocusable.focus();
                                    e.preventDefault();
                                }
                            }
                        }
                    };
                    DOMElements.offCanvasPanel.addEventListener('keydown', UIManager.offCanvasTabTrapListener);
                },

                closeOffCanvas: () => {
                    if (!DOMElements.offCanvasPanel) return;
                    DOMElements.offCanvasOverlay.classList.remove('show');
                    DOMElements.offCanvasPanel.classList.remove('open');
                    document.body.style.overflow = '';
                    if (UIManager.offCanvasTabTrapListener) {
                        DOMElements.offCanvasPanel.removeEventListener('keydown', UIManager.offCanvasTabTrapListener);
                        UIManager.offCanvasTabTrapListener = null;
                    }
                },

                initOffCanvasListeners: () => {
                    if (DOMElements.offCanvasCloseBtn) {
                        DOMElements.offCanvasCloseBtn.addEventListener('click', UIManager.closeOffCanvas);
                    }
                    if (DOMElements.offCanvasOverlay) {
                        DOMElements.offCanvasOverlay.addEventListener('click', UIManager.closeOffCanvas);
                    }
                    document.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape' && DOMElements.offCanvasPanel.classList.contains('open')) {
                            UIManager.closeOffCanvas();
                        }
                    });
                },

                initCrudPageListeners: () => {
                    if (DOMElements.crudPage) {
                        DOMElements.crudPage.addEventListener('click', (e) => {
                            const deleteButton = e.target.closest('.delete-property-btn');
                            if (deleteButton) {
                                const propertyId = deleteButton.dataset.propertyId;
                                const propertyName = deleteButton.dataset.propertyName || propertyId;
                                UIManager.showAlert(
                                    'Konfirmasi Hapus',
                                    `Anda yakin ingin menghapus properti "<strong>${propertyName}</strong>"?<br>Tindakan ini tidak dapat dibatalkan.`,
                                    'warning',
                                    {
                                        showCancelButton: true,
                                        confirmText: 'Ya, Hapus',
                                        cancelText: 'Batal',
                                        onConfirm: () => {
                                            console.log(`Properti ${propertyName} (ID: ${propertyId}) dihapus (simulasi).`);
                                            UIManager.showToast(`Properti "${propertyName}" berhasil dihapus.`, 'success');
                                            deleteButton.closest('tr').remove(); // Simple removal for demo
                                        }
                                    }
                                );
                            }
                        });
                    }
                    if (DOMElements.addPropertyBtn) {
                        DOMElements.addPropertyBtn.addEventListener('click', (e) => {
                            e.preventDefault();
                            UIManager.showFlashMessage(
                                '<strong>Fitur Demo:</strong> Formulir untuk menambah properti baru akan ditampilkan di sini.',
                                'info',
                                true,
                                7000
                            );
                            // UIManager.showAlert('Info', 'Fitur tambah properti sedang dalam pengembangan.', 'info');
                        });
                    }
                }
            };


            // FUNGSI THEME
            const ThemeManager = {
                applyTheme: (theme) => {
                    DOMElements.html.setAttribute('data-theme', theme);
                    if (DOMElements.themeToggleBtn) {
                        DOMElements.themeToggleBtn.innerHTML = theme === 'dark' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
                        DOMElements.themeToggleBtn.setAttribute('aria-label', theme === 'dark' ? 'Ganti ke Tema Terang' : 'Ganti ke Tema Gelap');
                    }
                    localStorage.setItem('appTheme', theme);
                    appState.currentTheme = theme;
                },
                toggleTheme: () => {
                    const newTheme = appState.currentTheme === 'light' ? 'dark' : 'light';
                    ThemeManager.applyTheme(newTheme);
                    UIManager.showToast(`Tema diubah ke ${newTheme === 'light' ? 'Terang' : 'Gelap'}.`, 'info', 2000);
                },
                init: () => {
                    ThemeManager.applyTheme(appState.currentTheme);
                    if (DOMElements.themeToggleBtn) {
                        DOMElements.themeToggleBtn.addEventListener('click', ThemeManager.toggleTheme);
                    }
                }
            };

            // FUNGSI NAVIGASI SPA (ROUTER)
            const Router = {
                navigateTo: (pageId) => {
                    DOMElements.pages.forEach(page => page.classList.remove('active'));
                    const targetPage = document.getElementById(pageId + '-page');
                    if (targetPage) {
                        targetPage.classList.add('active');
                        appState.currentPageId = pageId;

                        DOMElements.navLinks.forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href') === '#' + pageId) {
                                link.classList.add('active');
                            }
                        });

                        if (window.location.hash !== '#' + pageId) {
                            window.location.hash = pageId;
                        }
                        if (DOMElements.navMenu.classList.contains('open')) {
                            DOMElements.navMenu.classList.remove('open');
                            DOMElements.navbarToggler.innerHTML = '<i class="fas fa-bars"></i>';
                            DOMElements.navbarToggler.setAttribute('aria-expanded', 'false');
                        }
                        window.scrollTo(0, 0);
                    } else {
                        console.warn(`Halaman dengan ID "${pageId}-page" tidak ditemukan. Mengarahkan ke dasbor.`);
                        Router.navigateTo('dashboard');
                    }
                },
                handleHashChange: () => {
                    const hash = window.location.hash.substring(1);
                    const pageId = hash.split('/')[0] || 'dashboard';
                    Router.navigateTo(pageId);
                },
                init: () => {
                    DOMElements.navLinks.forEach(link => {
                        link.addEventListener('click', (event) => {
                            event.preventDefault();
                            const targetPageId = link.getAttribute('href').substring(1);
                            Router.navigateTo(targetPageId);
                        });
                    });
                    window.addEventListener('hashchange', Router.handleHashChange);
                    Router.handleHashChange();
                }
            };

            // FUNGSI RENDER KARTU PROPERTI
            const PropertyRenderer = {
                createCardElement: (property) => {
                    if (!DOMElements.propertyCardTemplate) {
                        console.error('Template kartu properti tidak ditemukan!');
                        return null;
                    }
                    const cardClone = DOMElements.propertyCardTemplate.content.cloneNode(true);
                    const cardElement = cardClone.querySelector('.property-card');

                    const imageEl = cardElement.querySelector('.property-card-image');
                    imageEl.src = property.image || 'https://via.placeholder.com/400x240.png?text=Properti+GreenValley';
                    imageEl.alt = `Gambar ${property.name}`;

                    cardElement.querySelector('.property-card-title').textContent = property.name;
                    cardElement.querySelector('.property-card-location span').textContent = property.location;

                    cardElement.querySelector('[data-feature="bedrooms"]').textContent = property.bedrooms;
                    cardElement.querySelector('[data-feature="bathrooms"]').textContent = property.bathrooms;
                    cardElement.querySelector('[data-feature="area"]').textContent = property.area;

                    cardElement.querySelector('.property-card-description').textContent = Utils.truncateText(property.description, 100);
                    cardElement.querySelector('.property-card-price').textContent = Utils.formatPrice(property.price);

                    const detailsLink = cardElement.querySelector('.property-details-link');
                    detailsLink.href = `#apartments?property=${property.id}`;
                    detailsLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        const propertyDetailHTML = `
                            <div class="off-canvas-property-detail">
                                <img src="${property.image || 'https://via.placeholder.com/400x240.png?text=Properti'}" alt="Gambar ${property.name}">
                                <h3>${property.name}</h3>
                                <p><i class="fas fa-map-marker-alt icon"></i> ${property.location}</p>
                                <ul class="features">
                                    <li><i class="fas fa-bed icon"></i> ${property.bedrooms} K. Tidur</li>
                                    <li><i class="fas fa-bath icon"></i> ${property.bathrooms} K. Mandi</li>
                                    <li><i class="fas fa-ruler-combined icon"></i> ${property.area} m¬≤</li>
                                </ul>
                                <p>${property.description}</p>
                                <div class="price">${Utils.formatPrice(property.price)}</div>
                                <button class="btn btn-primary" style="margin-top: 1rem; width: 100%;" 
                                        onclick="GreenValleyApp.UIManager.showToast('Tombol Kontak Agen diklik (Demo)', 'info')">
                                    <i class="fas fa-phone-alt icon"></i> Kontak Agen
                                </button>
                            </div>
                        `;
                        UIManager.openOffCanvas(`Detail: ${property.name}`, propertyDetailHTML);
                    });

                    return cardElement;
                },
                displayProperties: (propertiesToDisplay) => {
                    if (!DOMElements.propertyListContainer) return;
                    DOMElements.propertyListContainer.innerHTML = '';

                    if (propertiesToDisplay.length === 0) {
                        DOMElements.noResultsMessage.style.display = 'block';
                    } else {
                        DOMElements.noResultsMessage.style.display = 'none';
                        propertiesToDisplay.forEach(property => {
                            const cardNode = PropertyRenderer.createCardElement(property);
                            if (cardNode) {
                                DOMElements.propertyListContainer.appendChild(cardNode);
                            }
                        });
                    }
                }
            };

            // FUNGSI FILTER PROPERTI
            const PropertyFilter = {
                filter: () => {
                    const keyword = DOMElements.searchKeywordInput.value.toLowerCase().trim();
                    const bedrooms = DOMElements.filterBedroomsSelect.value;
                    const priceRange = DOMElements.filterPriceSelect.value.split('-');

                    const minPrice = priceRange[0] === "" ? 0 : parseInt(priceRange[0]);
                    const maxPrice = priceRange[0] === "" ? Infinity : (priceRange[1] === "Infinity" ? Infinity : parseInt(priceRange[1]));

                    const filteredProperties = appState.propertiesData.filter(prop => {
                        const nameMatch = prop.name.toLowerCase().includes(keyword);
                        const locationMatch = prop.location.toLowerCase().includes(keyword);
                        const keywordMatch = nameMatch || locationMatch;

                        const bedroomMatch = bedrooms === "" ||
                            (bedrooms === "3" && prop.bedrooms >= 3) ||
                            prop.bedrooms == parseInt(bedrooms);

                        const priceMatch = prop.price >= minPrice && prop.price <= maxPrice;

                        return keywordMatch && bedroomMatch && priceMatch;
                    });
                    PropertyRenderer.displayProperties(filteredProperties);
                    if (document.activeElement !== DOMElements.searchKeywordInput && // only show toast if not actively typing
                        document.activeElement !== DOMElements.filterBedroomsSelect &&
                        document.activeElement !== DOMElements.filterPriceSelect) {
                        UIManager.showToast('Filter berhasil diterapkan.', 'success', 2000);
                    }
                },
                init: () => {
                    if (DOMElements.filterForm) {
                        DOMElements.filterForm.addEventListener('submit', (e) => {
                            e.preventDefault();
                            PropertyFilter.filter();
                        });
                        DOMElements.filterForm.addEventListener('reset', () => {
                            setTimeout(() => { // Allow form to reset values before filtering
                                PropertyFilter.filter();
                                UIManager.showToast('Filter direset.', 'info', 2000);
                            }, 0);
                        });
                    }
                    PropertyRenderer.displayProperties(appState.propertiesData);
                }
            };

            // FUNGSI MOBILE NAV TOGGLE
            const MobileNav = {
                toggle: () => {
                    DOMElements.navMenu.classList.toggle('open');
                    const isOpen = DOMElements.navMenu.classList.contains('open');
                    DOMElements.navbarToggler.innerHTML = isOpen ? '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
                    DOMElements.navbarToggler.setAttribute('aria-expanded', isOpen.toString());
                },
                init: () => {
                    if (DOMElements.navbarToggler) {
                        DOMElements.navbarToggler.addEventListener('click', MobileNav.toggle);
                    }
                }
            };

            // INISIALISASI APLIKASI
            const initApp = () => {
                ThemeManager.init();
                Router.init();
                PropertyFilter.init();
                MobileNav.init();
                UIManager.initOffCanvasListeners(); // Initialize listeners for off-canvas
                UIManager.initCrudPageListeners(); // Initialize listeners for CRUD page (add, delete)


                if (DOMElements.currentYearSpan) {
                    DOMElements.currentYearSpan.textContent = new Date().getFullYear();
                }
                console.log("Green Valley Estetika App Initialized with UI Components!");
                UIManager.showFlashMessage("Selamat datang di Green Valley Estetika!", "success", true, 5000);
            };

            // Jalankan aplikasi saat DOM siap
            document.addEventListener('DOMContentLoaded', initApp);

            // Expose UIManager if needed for inline JS like the "Kontak Agen" button
            // This is generally not the best practice but useful for quick demos.
            window.GreenValleyApp = {
                UIManager: UIManager
            };


        })(); // Akhir dari IIFE
    </script>

</body>

</html>