<!DOCTYPE html>
<html lang="id" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Green Valley - Platform sewa apartemen, rumah, dan kost premium dengan pengalaman digital yang mudah dan terpercaya. Temukan hunian impianmu dengan Green Valley.">
    <meta name="keywords"
        content="sewa apartemen, sewa rumah, sewa kost, properti, Green Valley, ulasan terpercaya, pembayaran aman, hunian premium, cari properti, properti online">
    <title>Green Valley - Hunian Impianmu Menanti</title>
    <!-- Favicon menggunakan emoji sebagai data URI untuk kesederhanaan dan memenuhi batasan 'tanpa SVG' secara teknis untuk file terpisah -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè°</text></svg>">

    <!-- Google Fonts: Inter (Preconnect dan Preload untuk performa) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
            rel="stylesheet">
    </noscript>

    <!-- Font Awesome Icons (CDN) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer">

    <style>
        /* === FONDASI DAN VARIABEL CSS === */
        :root {
            /* Skema Warna Terang (Default) */
            --background-hsl: 0 0% 100%;
            /* Putih bersih */
            --foreground-hsl: 222 20% 18%;
            /* Abu-abu gelap untuk teks */
            --card-hsl: 0 0% 100%;
            --card-foreground-hsl: 222 20% 18%;
            --primary-hsl: 145 63% 42%;
            /* Hijau khas Green Valley */
            --primary-foreground-hsl: 0 0% 100%;
            /* Putih untuk teks di atas primary */
            --primary-hover-hsl: 145 63% 38%;
            --secondary-hsl: 210 40% 96.1%;
            /* Abu-abu muda */
            --secondary-foreground-hsl: 222 20% 18%;
            --muted-hsl: 210 40% 96.1%;
            --muted-foreground-hsl: 215.4 16.3% 46.9%;
            /* Abu-abu untuk teks muted */
            --accent-hsl: 38 92% 50%;
            /* Kuning untuk aksen (misal: bintang rating) */
            --accent-foreground-hsl: 222 20% 18%;
            --destructive-hsl: 0 72% 51%;
            /* Merah untuk aksi destruktif */
            --destructive-foreground-hsl: 0 0% 100%;
            --border-hsl: 214.3 31.8% 91.4%;
            /* Abu-abu muda untuk border */
            --input-hsl: 214.3 31.8% 91.4%;
            --ring-hsl: 145 63% 49%;
            /* Warna ring saat fokus, turunan dari primary */

            /* Properti Desain Umum */
            --radius-sm: 0.3rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --font-main: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";

            /* Spasi (Konsisten) */
            --space-xxs: 0.25rem;
            /* 4px */
            --space-xs: 0.5rem;
            /* 8px */
            --space-sm: 0.75rem;
            /* 12px */
            --space-md: 1rem;
            /* 16px */
            --space-lg: 1.5rem;
            /* 24px */
            --space-xl: 2rem;
            /* 32px */
            --space-2xl: 3rem;
            /* 48px */
            --space-3xl: 4rem;
            /* 64px */

            /* Bayangan (Shadows) untuk Kedalaman Visual */
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.07);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.08), 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-inner: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);

            /* Transisi (Fancy & Smooth) */
            --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Skema Warna Gelap */
        .dark {
            --background-hsl: 226 32% 10%;
            /* Biru gelap pekat */
            --foreground-hsl: 210 40% 98%;
            /* Putih keabuan untuk teks */
            --card-hsl: 224 29% 14%;
            /* Biru gelap sedikit lebih terang dari background */
            --card-foreground-hsl: 210 40% 98%;
            --primary-hsl: 145 58% 52%;
            /* Hijau yang tetap vibrant di mode gelap */
            --primary-foreground-hsl: 222 20% 12%;
            /* Teks gelap di atas primary gelap */
            --primary-hover-hsl: 145 58% 48%;
            --secondary-hsl: 217 33% 17%;
            /* Abu-abu gelap untuk elemen sekunder */
            --secondary-foreground-hsl: 210 40% 98%;
            --muted-hsl: 217 33% 17%;
            --muted-foreground-hsl: 215 20.2% 65.1%;
            /* Abu-abu terang untuk teks muted */
            --accent-hsl: 38 92% 55%;
            /* Kuning yang lebih terang di mode gelap */
            --accent-foreground-hsl: 222 20% 12%;
            --destructive-hsl: 0 65% 55%;
            /* Merah yang disesuaikan untuk mode gelap */
            --destructive-foreground-hsl: 0 0% 100%;
            --border-hsl: 217 33% 20%;
            /* Border yang lebih gelap */
            --input-hsl: 217 33% 20%;
            --ring-hsl: 145 58% 58%;
        }

        /* Reset CSS Dasar & Global Styles */
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            border-color: hsl(var(--border-hsl));
            /* Border default dari variabel */
        }

        html {
            font-size: 16px;
            /* Basis font size */
            scroll-behavior: smooth;
            /* Scroll halus untuk navigasi hash */
            -webkit-tap-highlight-color: transparent;
            /* Hilangkan highlight biru saat tap di mobile */
        }

        body {
            font-family: var(--font-main);
            background-color: hsl(var(--background-hsl));
            color: hsl(var(--foreground-hsl));
            line-height: 1.65;
            overflow-x: hidden;
            /* Cegah scroll horizontal */
            transition: background-color var(--transition-normal), color var(--transition-normal);
            -webkit-font-smoothing: antialiased;
            /* Tampilan font lebih halus di Webkit */
            -moz-osx-font-smoothing: grayscale;
            /* Tampilan font lebih halus di Firefox */
        }

        body.modal-open {
            overflow-y: hidden;
            /* Cegah scroll body saat modal terbuka */
        }

        /* === LAYOUT UTILITIES (Grid & Flexbox) === */
        .container {
            width: 90%;
            max-width: 1280px;
            /* Max width untuk konten utama */
            margin-left: auto;
            margin-right: auto;
            padding: var(--space-md);
        }

        .l-flex {
            display: flex;
            gap: var(--space-md);
            /* Default gap, bisa di-override */
        }

        .l-grid {
            display: grid;
            gap: var(--space-md);
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-center {
            justify-content: center;
        }

        .align-center {
            align-items: center;
        }

        .align-start {
            align-items: flex-start;
        }

        .flex-col {
            flex-direction: column;
        }

        .flex-wrap {
            flex-wrap: wrap;
        }

        .flex-1 {
            flex: 1;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .hidden {
            display: none !important;
        }

        /* Utility untuk menyembunyikan elemen */
        .visually-hidden {
            /* Untuk aksesibilitas, sembunyikan visual tapi tetap dibaca screen reader */
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* === KOMPONEN UI === */
        /* Header & Navigasi */
        .c-header {
            background-color: hsl(var(--card-hsl));
            padding: var(--space-sm) 0;
            position: sticky;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: var(--shadow-sm);
            transition: background-color var(--transition-normal), box-shadow var(--transition-normal);
        }

        .c-header__container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .c-logo {
            font-size: 1.75rem;
            font-weight: 800;
            /* Lebih tebal untuk logo */
            color: hsl(var(--primary-hsl));
            text-decoration: none;
            transition: color var(--transition-fast);
        }

        .c-logo:hover {
            color: hsl(var(--primary-hover-hsl));
        }

        .c-logo i {
            margin-right: var(--space-xs);
        }

        .c-nav__list {
            list-style: none;
            display: flex;
            gap: var(--space-xs);
            /* Sedikit lebih rapat antar link nav */
        }

        .c-nav__link {
            color: hsl(var(--muted-foreground-hsl));
            text-decoration: none;
            font-weight: 500;
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-sm);
            transition: color var(--transition-fast), background-color var(--transition-fast);
            position: relative;
        }

        .c-nav__link::after {
            /* Efek underline fancy */
            content: '';
            position: absolute;
            bottom: 6px;
            /* Sesuaikan posisi underline */
            left: 50%;
            width: 0;
            height: 2px;
            background-color: hsl(var(--primary-hsl));
            transition: width var(--transition-normal), left var(--transition-normal);
        }

        .c-nav__link:hover,
        .c-nav__link.active {
            color: hsl(var(--primary-hsl));
            background-color: hsl(var(--primary-hsl) / 0.1);
        }

        .c-nav__link.active::after,
        .c-nav__link:hover::after {
            width: calc(100% - (2 * var(--space-md)));
            /* Lebar underline sesuai padding */
            left: var(--space-md);
        }

        .c-nav-toggle {
            /* Tombol hamburger menu */
            display: none;
            /* Muncul di mobile */
            background: none;
            border: none;
            color: hsl(var(--foreground-hsl));
            font-size: 1.5rem;
            cursor: pointer;
            padding: var(--space-xs);
            border-radius: var(--radius-sm);
            transition: color var(--transition-fast), background-color var(--transition-fast);
        }

        .c-nav-toggle:hover {
            background-color: hsl(var(--muted-hsl));
        }

        /* Tombol (Button) Fancy */
        .c-button {
            padding: var(--space-sm) var(--space-lg);
            background-color: hsl(var(--primary-hsl));
            color: hsl(var(--primary-foreground-hsl));
            border: 1px solid transparent;
            /* Border transparan untuk konsistensi ukuran */
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            /* Sedikit lebih kecil dari 1rem */
            text-decoration: none;
            transition: var(--transition-fast);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-xs);
            box-shadow: var(--shadow-xs);
            transform: translateY(0);
            /* Initial state untuk animasi */
        }

        .c-button:hover {
            background-color: hsl(var(--primary-hover-hsl));
            box-shadow: var(--shadow-sm);
            transform: translateY(-2px);
            /* Efek naik sedikit saat hover */
        }

        .c-button:active {
            transform: translateY(0px);
            /* Kembali saat ditekan */
            box-shadow: var(--shadow-xs);
        }

        .c-button:disabled {
            background-color: hsl(var(--muted-hsl));
            color: hsl(var(--muted-foreground-hsl));
            cursor: not-allowed;
            box-shadow: none;
            transform: translateY(0);
        }

        .c-button i {
            /* Styling ikon di dalam tombol */
            font-size: 0.9em;
        }

        .c-button--outline {
            background-color: transparent;
            border-color: hsl(var(--primary-hsl));
            color: hsl(var(--primary-hsl));
        }

        .c-button--outline:hover {
            background-color: hsl(var(--primary-hsl) / 0.1);
            color: hsl(var(--primary-hsl));
            /* Pastikan warna teks tetap */
        }

        .c-button--destructive {
            background-color: hsl(var(--destructive-hsl));
            color: hsl(var(--destructive-foreground-hsl));
        }

        .c-button--destructive:hover {
            background-color: hsl(var(--destructive-hsl) / 0.85);
            /* Sedikit lebih gelap saat hover */
        }

        .c-button--destructive.c-button--outline {
            border-color: hsl(var(--destructive-hsl));
            color: hsl(var(--destructive-hsl));
        }

        .c-button--destructive.c-button--outline:hover {
            background-color: hsl(var(--destructive-hsl) / 0.1);
        }

        .c-button--secondary {
            background-color: hsl(var(--secondary-hsl));
            color: hsl(var(--secondary-foreground-hsl));
        }

        .c-button--secondary:hover {
            background-color: hsl(var(--secondary-hsl) / 0.8);
        }

        /* Hero Section */
        .c-hero {
            background: linear-gradient(135deg, hsl(var(--primary-hsl) / 0.9), hsl(var(--primary-hsl) / 0.7)),
                url('https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80') no-repeat center center/cover;
            color: hsl(var(--primary-foreground-hsl));
            padding: var(--space-3xl) 0;
            position: relative;
            overflow: hidden;
            /* Untuk efek parallax jika ada */
            text-align: center;
            min-height: 70vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .c-hero__content {
            max-width: 700px;
            /* Lebar konten hero */
            margin: 0 auto;
            background-color: hsl(var(--card-hsl) / 0.1);
            /* Background transparan agar teks lebih terbaca */
            backdrop-filter: blur(5px);
            /* Efek glassmorphism ringan */
            padding: var(--space-xl);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
        }

        .c-hero__title {
            font-size: clamp(2rem, 5vw, 3.5rem);
            /* Ukuran font responsif */
            font-weight: 800;
            margin-bottom: var(--space-md);
            line-height: 1.2;
            color: hsl(var(--primary-foreground-hsl));
        }

        .c-hero__subtitle {
            font-size: clamp(1rem, 2.5vw, 1.25rem);
            margin-bottom: var(--space-lg);
            opacity: 0.95;
            color: hsl(var(--primary-foreground-hsl));
        }

        /* Struktur Section Umum */
        .c-section {
            padding: var(--space-2xl) 0;
            position: relative;
            /* Untuk elemen absolut di dalamnya */
        }

        .c-section__title {
            font-size: clamp(1.75rem, 4vw, 2.5rem);
            /* Ukuran font responsif */
            font-weight: 700;
            margin-bottom: var(--space-sm);
            text-align: center;
            color: hsl(var(--foreground-hsl));
        }

        .c-section__subtitle {
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            color: hsl(var(--muted-foreground-hsl));
            margin-bottom: var(--space-xl);
            text-align: center;
            max-width: 650px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Komponen Card (Kartu) */
        .c-card {
            background-color: hsl(var(--card-hsl));
            border-radius: var(--radius-lg);
            /* Radius lebih besar untuk tampilan modern */
            box-shadow: var(--shadow-md);
            padding: var(--space-lg);
            transition: var(--transition-normal);
            overflow: hidden;
            /* Untuk card image agar tidak keluar */
        }

        .c-card:hover {
            transform: translateY(-6px) scale(1.01);
            /* Efek hover lebih menonjol */
            box-shadow: var(--shadow-xl);
        }

        .c-card__title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: var(--space-sm);
            color: hsl(var(--card-foreground-hsl));
        }

        .c-card__description {
            font-size: 0.9rem;
            color: hsl(var(--muted-foreground-hsl));
            margin-bottom: var(--space-md);
        }

        .c-card__actions {
            margin-top: var(--space-lg);
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
            /* Agar tombol tidak tumpang tindih di layar kecil */
        }

        /* Daftar Properti (Grid System) */
        .property-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(min(100%, 320px), 1fr));
            /* Grid responsif */
            gap: var(--space-lg);
        }

        .property-card {
            position: relative;
            /* Untuk status badge */
        }

        .property-card__image {
            width: 100%;
            height: 220px;
            /* Tinggi gambar konsisten */
            object-fit: cover;
            /* Pastikan gambar mengisi area tanpa distorsi */
            border-radius: var(--radius-md);
            /* Radius pada gambar */
            margin-bottom: var(--space-md);
            transition: transform var(--transition-slow);
            /* Efek zoom pada gambar */
        }

        .property-card:hover .property-card__image {
            transform: scale(1.05);
        }

        .property-card__status {
            position: absolute;
            top: var(--space-md);
            right: var(--space-md);
            background-color: hsl(var(--accent-hsl));
            color: hsl(var(--accent-foreground-hsl));
            padding: var(--space-xxs) var(--space-sm);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            box-shadow: var(--shadow-xs);
        }

        .property-card__status--rented {
            background-color: hsl(var(--destructive-hsl));
            color: hsl(var(--destructive-foreground-hsl));
        }

        .property-card__price {
            font-size: 1.1rem;
            font-weight: 700;
            color: hsl(var(--primary-hsl));
            margin: var(--space-xs) 0;
        }

        .property-card__features {
            display: flex;
            gap: var(--space-md);
            font-size: 0.85rem;
            color: hsl(var(--muted-foreground-hsl));
            margin-bottom: var(--space-sm);
        }

        .property-card__features i {
            margin-right: var(--space-xxs);
        }

        /* Ulasan */
        .review-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(min(100%, 300px), 1fr));
            gap: var(--space-lg);
        }

        .review-card__rating {
            color: hsl(var(--accent-hsl));
            margin-bottom: var(--space-sm);
            font-size: 1.2rem;
            /* Bintang lebih besar */
        }

        .review-card__author {
            font-weight: 600;
            margin-bottom: var(--space-xs);
        }

        .review-card__date {
            font-size: 0.8rem;
            color: hsl(var(--muted-foreground-hsl));
        }

        /* Form Input Fields */
        .c-form-field {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
            margin-bottom: var(--space-md);
        }

        .c-form-field label {
            font-size: 0.9rem;
            font-weight: 500;
            color: hsl(var(--muted-foreground-hsl));
        }

        .c-form-field input,
        .c-form-field textarea,
        .c-form-field select {
            padding: var(--space-sm);
            border: 1px solid hsl(var(--input-hsl));
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-family: var(--font-main);
            color: hsl(var(--foreground-hsl));
            background-color: hsl(var(--background-hsl));
            /* Agar konsisten dengan tema */
            transition: var(--transition-fast);
            box-shadow: var(--shadow-inner);
        }

        .c-form-field textarea {
            resize: vertical;
            /* Izinkan resize vertikal saja */
            min-height: 120px;
        }

        .c-form-field input:focus,
        .c-form-field textarea:focus,
        .c-form-field select:focus {
            border-color: hsl(var(--ring-hsl));
            outline: none;
            box-shadow: 0 0 0 3px hsl(var(--ring-hsl) / 0.3), var(--shadow-inner);
            /* Efek ring saat fokus */
        }

        .c-form-field input::placeholder,
        .c-form-field textarea::placeholder {
            color: hsl(var(--muted-foreground-hsl) / 0.7);
            opacity: 1;
            /* Firefox fix */
        }

        /* Rating Bintang Interaktif */
        .rating-stars {
            display: flex;
            gap: var(--space-xs);
            margin-bottom: var(--space-md);
        }

        .rating-stars span {
            cursor: pointer;
            font-size: 1.8rem;
            /* Bintang lebih besar dan menarik */
            color: #ccc;
            /* Warna default bintang kosong */
            transition: color var(--transition-fast), transform var(--transition-fast);
        }

        .rating-stars span:hover {
            transform: scale(1.2);
            /* Efek hover pada bintang */
        }

        .rating-stars span.active,
        /* Bintang yang dipilih/hover */
        .rating-stars span.hovered {
            color: hsl(var(--accent-hsl));
        }

        /* Komponen Chat (Floating & Inline) */
        .chat-container {
            /* Untuk chat widget floating */
            position: fixed;
            bottom: calc(var(--space-lg) + 70px);
            /* Di atas tombol toggle */
            right: var(--space-lg);
            width: 380px;
            /* Lebar chat box */
            max-height: 80vh;
            background-color: hsl(var(--card-hsl));
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            display: flex;
            /* Menggunakan flex untuk layout internal */
            flex-direction: column;
            z-index: 1999;
            /* Di bawah modal, di atas chat toggle */
            transform: translateY(20px) scale(0.95);
            /* Posisi awal untuk animasi */
            opacity: 0;
            visibility: hidden;
            transition: transform var(--transition-normal), opacity var(--transition-normal), visibility var(--transition-normal);
        }

        .chat-container.open {
            transform: translateY(0) scale(1);
            opacity: 1;
            visibility: visible;
        }

        .chat-header {
            background-color: hsl(var(--primary-hsl));
            color: hsl(var(--primary-foreground-hsl));
            padding: var(--space-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top-left-radius: var(--radius-lg);
            border-top-right-radius: var(--radius-lg);
        }

        .chat-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .chat-close-btn {
            /* Tombol close di header chat */
            background: none;
            border: none;
            color: hsl(var(--primary-foreground-hsl));
            cursor: pointer;
            font-size: 1.2rem;
            padding: var(--space-xs);
            border-radius: 50%;
            transition: background-color var(--transition-fast);
        }

        .chat-close-btn:hover {
            background-color: hsl(var(--primary-foreground-hsl) / 0.2);
        }

        .chat-messages {
            /* Area pesan */
            flex-grow: 1;
            /* Mengisi ruang tersedia */
            max-height: 350px;
            /* Batasi tinggi, aktifkan scroll */
            overflow-y: auto;
            padding: var(--space-md);
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            background-color: hsl(var(--background-hsl));
            /* Background beda tipis */
        }

        .chat-msg {
            max-width: 85%;
            /* Pesan tidak terlalu lebar */
            padding: var(--space-sm);
            border-radius: var(--radius-md);
            font-size: 0.9rem;
            line-height: 1.4;
            box-shadow: var(--shadow-xs);
        }

        .chat-msg time {
            display: block;
            font-size: 0.7rem;
            color: hsl(var(--muted-foreground-hsl) / 0.8);
            margin-top: var(--space-xxs);
            text-align: right;
        }

        .chat-msg.system {
            background-color: hsl(var(--secondary-hsl));
            color: hsl(var(--secondary-foreground-hsl));
            align-self: flex-start;
            border-bottom-left-radius: 0;
            /* Efek "tail" */
        }

        .chat-msg.user {
            background-color: hsl(var(--primary-hsl));
            color: hsl(var(--primary-foreground-hsl));
            align-self: flex-end;
            border-bottom-right-radius: 0;
            /* Efek "tail" */
        }

        .chat-input-form {
            /* Form input pesan */
            display: flex;
            padding: var(--space-sm);
            border-top: 1px solid hsl(var(--border-hsl));
            background-color: hsl(var(--card-hsl));
            border-bottom-left-radius: var(--radius-lg);
            border-bottom-right-radius: var(--radius-lg);
        }

        .chat-input-form input[type="text"] {
            flex: 1;
            padding: var(--space-sm);
            border: 1px solid hsl(var(--input-hsl));
            border-radius: var(--radius-md);
            font-size: 0.9rem;
            margin-right: var(--space-xs);
            box-shadow: var(--shadow-inner);
        }

        .chat-input-form input[type="text"]:focus {
            border-color: hsl(var(--ring-hsl));
            outline: none;
            box-shadow: 0 0 0 2px hsl(var(--ring-hsl) / 0.2), var(--shadow-inner);
        }

        .chat-input-form button[type="submit"] {
            /* Tombol kirim chat */
            padding: var(--space-sm);
            background-color: hsl(var(--primary-hsl));
            color: hsl(var(--primary-foreground-hsl));
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 1rem;
            /* Ikon lebih besar */
            transition: background-color var(--transition-fast);
        }

        .chat-input-form button[type="submit"]:hover {
            background-color: hsl(var(--primary-hover-hsl));
        }

        .chat-toggle-btn {
            /* Tombol floating untuk membuka chat */
            position: fixed;
            bottom: var(--space-lg);
            right: var(--space-lg);
            width: 60px;
            /* Ukuran tombol */
            height: 60px;
            background-color: hsl(var(--primary-hsl));
            color: hsl(var(--primary-foreground-hsl));
            border: none;
            border-radius: 50%;
            /* Bulat sempurna */
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            z-index: 2000;
            /* Di atas konten lain */
            font-size: 1.5rem;
            /* Ukuran ikon */
            transition: var(--transition-normal);
        }

        .chat-toggle-btn:hover {
            background-color: hsl(var(--primary-hover-hsl));
            transform: scale(1.1) rotate(15deg);
            /* Efek hover fancy */
        }

        .chat-toggle-btn .fa-times {
            display: none;
        }

        /* Ikon close, awalnya tersembunyi */
        .chat-toggle-btn.open .fa-comment {
            display: none;
        }

        /* Sembunyikan ikon comment saat open */
        .chat-toggle-btn.open .fa-times {
            display: inline-block;
        }

        /* Tampilkan ikon close saat open */

        /* Metode Pembayaran */
        .payment-methods {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }

        .payment-card-option {
            /* Card untuk opsi pembayaran */
            padding: var(--space-md);
            border: 2px solid hsl(var(--input-hsl));
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .payment-card-option:hover {
            border-color: hsl(var(--primary-hsl) / 0.5);
            background-color: hsl(var(--primary-hsl) / 0.05);
        }

        .payment-card-option.active {
            border-color: hsl(var(--primary-hsl));
            background-color: hsl(var(--primary-hsl) / 0.1);
            box-shadow: 0 0 0 2px hsl(var(--primary-hsl) / 0.3);
        }

        .payment-card-option i {
            font-size: 1.5rem;
            color: hsl(var(--primary-hsl));
        }

        /* Tur Virtual */
        .virtual-tour-container {
            position: relative;
            border-radius: var(--radius-lg);
            overflow: hidden;
            /* Agar iframe tidak keluar */
            box-shadow: var(--shadow-md);
            aspect-ratio: 16 / 9;
            /* Menjaga rasio video */
        }

        .virtual-tour-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Tabel Properti (Dashboard) */
        .c-table-wrapper {
            overflow-x: auto;
            /* Scroll horizontal jika tabel terlalu lebar */
            border: 1px solid hsl(var(--border-hsl));
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
        }

        .c-table {
            width: 100%;
            border-collapse: collapse;
            /* Border rapi */
            margin-top: var(--space-lg);
            font-size: 0.9rem;
        }

        .c-table th,
        .c-table td {
            border-bottom: 1px solid hsl(var(--border-hsl));
            padding: var(--space-sm) var(--space-md);
            text-align: left;
            vertical-align: middle;
            /* Konten sel di tengah vertikal */
        }

        .c-table th {
            background-color: hsl(var(--secondary-hsl));
            font-weight: 600;
            color: hsl(var(--secondary-foreground-hsl));
            text-transform: capitalize;
            /* Judul kolom kapital */
        }

        .c-table tbody tr:hover {
            background-color: hsl(var(--muted-hsl) / 0.5);
        }

        .c-table .actions-cell {
            /* Sel untuk tombol aksi */
            display: flex;
            gap: var(--space-xs);
        }

        .c-table .actions-cell .c-button {
            /* Tombol aksi di tabel lebih kecil */
            padding: var(--space-xs) var(--space-sm);
            font-size: 0.8rem;
        }

        /* Modal Dialog */
        .c-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: hsl(var(--background-hsl) / 0.6);
            /* Overlay semi-transparan */
            backdrop-filter: blur(8px);
            /* Efek blur "fancy" */
            display: flex;
            /* Tengahkankan konten modal */
            align-items: center;
            justify-content: center;
            z-index: 2500;
            /* Di atas chat toggle dan chat box */
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-normal), visibility var(--transition-normal);
        }

        .c-modal.open {
            opacity: 1;
            visibility: visible;
        }

        .c-modal__content {
            background-color: hsl(var(--card-hsl));
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            max-width: 90%;
            /* Maksimal lebar modal */
            width: 550px;
            /* Default lebar modal */
            max-height: 90vh;
            /* Maksimal tinggi modal */
            overflow-y: auto;
            /* Scroll jika konten terlalu panjang */
            position: relative;
            /* Untuk tombol close */
            box-shadow: var(--shadow-xl);
            transform: scale(0.95) translateY(20px);
            /* Posisi awal untuk animasi */
            transition: transform var(--transition-normal) 0.1s, opacity var(--transition-normal) 0.1s;
            /* Delay transition agar sinkron dengan modal overlay */
        }

        .c-modal.open .c-modal__content {
            transform: scale(1) translateY(0);
        }

        .c-modal__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid hsl(var(--border-hsl));
        }

        .c-modal__title {
            font-size: 1.5rem;
            font-weight: 700;
            color: hsl(var(--card-foreground-hsl));
        }

        .c-modal__close-btn {
            /* Tombol close di dalam modal */
            background: none;
            border: none;
            color: hsl(var(--muted-foreground-hsl));
            cursor: pointer;
            font-size: 1.5rem;
            /* Ukuran ikon close */
            padding: var(--space-xs);
            border-radius: 50%;
            line-height: 1;
            /* Agar ikon pas di tengah */
            transition: color var(--transition-fast), background-color var(--transition-fast);
        }

        .c-modal__close-btn:hover {
            color: hsl(var(--foreground-hsl));
            background-color: hsl(var(--muted-hsl));
        }

        /* Notifikasi (Toast) */
        .c-notification {
            position: fixed;
            bottom: var(--space-lg);
            left: 50%;
            /* Tengah horizontal */
            transform: translateX(-50%) translateY(100%);
            /* Posisi awal di luar layar bawah */
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            z-index: 3000;
            /* Paling atas */
            opacity: 0;
            transition: transform var(--transition-slow), opacity var(--transition-slow);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .c-notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
            /* Muncul ke posisi */
        }

        .c-notification i {
            /* Ikon di notifikasi */
            font-size: 1.2rem;
        }

        .c-notification--success {
            background-color: hsl(var(--primary-hsl));
            color: hsl(var(--primary-foreground-hsl));
        }

        .c-notification--error {
            background-color: hsl(var(--destructive-hsl));
            color: hsl(var(--destructive-foreground-hsl));
        }

        .c-notification--info {
            background-color: hsl(var(--accent-hsl));
            color: hsl(var(--accent-foreground-hsl));
        }

        /* Footer */
        .c-footer {
            background-color: hsl(var(--card-hsl));
            color: hsl(var(--muted-foreground-hsl));
            padding: var(--space-xl) 0;
            text-align: center;
            font-size: 0.9rem;
            border-top: 1px solid hsl(var(--border-hsl));
            margin-top: var(--space-2xl);
            /* Jarak dari konten terakhir */
        }

        .c-footer a {
            color: hsl(var(--primary-hsl));
            text-decoration: none;
            font-weight: 500;
        }

        .c-footer a:hover {
            text-decoration: underline;
        }


        /* === ANIMASI KEYFRAMES === */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            /* Utility class untuk animasi fade-in */
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            opacity: 0;
            /* Mulai dari transparan */
        }

        /* Tambahkan delay untuk elemen berurutan jika perlu */
        .animate-fade-in-delay-1 {
            animation-delay: 0.1s;
        }

        .animate-fade-in-delay-2 {
            animation-delay: 0.2s;
        }

        .animate-fade-in-delay-3 {
            animation-delay: 0.3s;
        }


        /* === RESPONSIVITAS (Media Queries) === */
        @media (max-width: 992px) {

            /* Tablet dan di bawahnya */
            .c-nav__list {
                gap: var(--space-xxs);
            }

            .c-nav__link {
                padding: var(--space-sm) var(--space-xs);
            }
        }

        @media (max-width: 768px) {

            /* Mobile */
            html {
                font-size: 15px;
            }

            /* Sedikit perkecil base font size di mobile */

            .c-header__container {
                flex-wrap: wrap;
                /* Izinkan wrap jika terlalu sempit */
            }

            .c-nav {
                /* Navigasi mobile (menu tersembunyi) */
                position: absolute;
                top: 100%;
                /* Tepat di bawah header */
                left: 0;
                right: 0;
                background-color: hsl(var(--card-hsl));
                box-shadow: var(--shadow-md);
                max-height: 0;
                /* Awalnya tersembunyi */
                overflow: hidden;
                transition: max-height var(--transition-normal);
            }

            .c-nav.open {
                max-height: 500px;
                /* Tinggi maksimum saat terbuka */
                border-top: 1px solid hsl(var(--border-hsl));
            }

            .c-nav__list {
                flex-direction: column;
                gap: 0;
                /* Hapus gap, padding di link saja */
                padding: var(--space-sm) 0;
            }

            .c-nav__link {
                display: block;
                /* Link mengisi lebar */
                padding: var(--space-md);
                border-radius: 0;
                width: 100%;
            }

            .c-nav__link::after {
                display: none;
            }

            /* Hilangkan underline di mobile nav */
            .c-nav__link.active,
            .c-nav__link:hover {
                background-color: hsl(var(--primary-hsl) / 0.15);
            }

            .c-nav-toggle {
                display: block;
            }

            /* Tampilkan tombol hamburger */
            .c-header__actions {
                /* Grup tombol di header (mis: theme toggle) */
                margin-left: auto;
                /* Dorong ke kanan jika ada logo dan hamburger */
            }

            .c-hero {
                min-height: 60vh;
            }

            .c-hero__content {
                padding: var(--space-lg);
            }

            .property-list,
            .review-list {
                grid-template-columns: 1fr;
                /* Satu kolom di mobile */
            }

            .chat-container {
                width: calc(100% - (2 * var(--space-sm)));
                /* Lebar penuh dikurangi padding */
                bottom: calc(var(--space-sm) + 65px);
                right: var(--space-sm);
                max-height: 75vh;
            }

            .chat-toggle-btn {
                bottom: var(--space-sm);
                right: var(--space-sm);
                width: 55px;
                height: 55px;
            }

            .c-modal__content {
                width: 95%;
                /* Modal lebih lebar di mobile */
                padding: var(--space-lg);
            }

            .c-table {
                font-size: 0.85rem;
            }

            .c-table th,
            .c-table td {
                padding: var(--space-xs);
            }

            /* Untuk tabel yang sangat lebar, mungkin perlu menyembunyikan kolom tertentu di mobile atau menggunakan desain card */
            .c-table .hide-mobile {
                display: none;
            }
        }

        @media (max-width: 480px) {

            /* Layar sangat kecil */
            .c-button {
                padding: var(--space-sm) var(--space-md);
                font-size: 0.9rem;
            }

            .c-card {
                padding: var(--space-md);
            }

            .c-section__title {
                font-size: 1.5rem;
            }

            .c-section__subtitle {
                font-size: 0.9rem;
            }
        }
    </style>
</head>

<body>
    <!-- Header Aplikasi -->
    <header class="c-header">
        <div class="container c-header__container">
            <a href="#home" class="c-logo"><i class="fas fa-home"></i> GreenValley</a>

            <nav class="c-nav" id="mainNav">
                <ul class="c-nav__list">
                    <li><a href="#home" class="c-nav__link active" data-page="home">Beranda</a></li>
                    <li><a href="#properti" class="c-nav__link" data-page="properti">Properti</a></li>
                    <li><a href="#ulasan" class="c-nav__link" data-page="ulasan">Ulasan</a></li>
                    <li><a href="#pembayaran" class="c-nav__link" data-page="pembayaran">Pembayaran</a></li>
                    <li><a href="#dashboard" class="c-nav__link" data-page="dashboard">Dashboard</a></li>
                </ul>
            </nav>

            <div class="l-flex align-center c-header__actions" style="gap: var(--space-sm);">
                <button class="c-button c-button--outline c-button--secondary" id="themeToggleBtn"
                    aria-label="Ganti tema">
                    <i class="fas fa-moon"></i> <span class="hide-mobile">Tema</span>
                </button>
                <button class="c-nav-toggle" id="navToggleBtn" aria-expanded="false" aria-controls="mainNav"
                    aria-label="Buka menu navigasi">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Konten Utama Aplikasi (SPA) -->
    <main id="mainContent" aria-live="polite">
        <!-- Konten halaman akan dimuat di sini oleh JavaScript -->
    </main>

    <!-- Footer Aplikasi -->
    <footer class="c-footer">
        <div class="container">
            <p>&copy; <span id="currentYear"></span> Green Valley. Semua Hak Dilindungi.</p>
            <p>Didesain dengan <i class="fas fa-heart" style="color: hsl(var(--destructive-hsl));"></i> untuk Hunian
                Impian Anda.</p>
        </div>
    </footer>

    <!-- Komponen Chat Floating -->
    <div class="chat-container" id="chatBox">
        <div class="chat-header">
            <h3 class="chat-title"><i class="fas fa-headset"></i> Bantuan GreenValley</h3>
            <button class="chat-close-btn" id="chatCloseBtn" aria-label="Tutup chat"><i
                    class="fas fa-times"></i></button>
        </div>
        <div class="chat-messages" id="chatMessagesContainer">
            <!-- Pesan chat akan dimuat di sini -->
        </div>
        <form class="chat-input-form" id="chatForm">
            <input type="text" id="chatInput" placeholder="Ketik pesanmu..." autocomplete="off" required>
            <button type="submit" class="c-button" aria-label="Kirim pesan"><i class="fas fa-paper-plane"></i></button>
        </form>
    </div>
    <button class="chat-toggle-btn" id="chatToggleBtn" aria-label="Buka chat">
        <i class="fas fa-comment"></i>
        <i class="fas fa-times"></i> <!-- Ikon close, di-toggle oleh JS -->
    </button>

    <!-- Template Modal (Struktur Umum) -->
    <div class="c-modal" id="addPropertyModal">
        <div class="c-modal__content">
            <div class="c-modal__header">
                <h2 class="c-modal__title">Tambah Properti Baru</h2>
                <button class="c-modal__close-btn" data-modal-close aria-label="Tutup modal"><i
                        class="fas fa-times"></i></button>
            </div>
            <form id="addPropertyForm" class="l-flex flex-col">
                <div class="c-form-field">
                    <label for="propertyName">Nama Properti</label>
                    <input type="text" id="propertyName" placeholder="Contoh: Apartemen Estetik Tengah Kota" required>
                </div>
                <div class="c-form-field">
                    <label for="propertyType">Tipe Properti</label>
                    <select id="propertyType" required>
                        <option value="" disabled selected>Pilih tipe</option>
                        <option value="apartemen">Apartemen</option>
                        <option value="rumah">Rumah</option>
                        <option value="kost">Kost</option>
                    </select>
                </div>
                <div class="c-form-field">
                    <label for="propertyPrice">Harga (Rp/bulan)</label>
                    <input type="number" id="propertyPrice" placeholder="Contoh: 8500000" min="0" required>
                </div>
                <div class="c-form-field">
                    <label for="propertyImage">URL Gambar Properti</label>
                    <input type="url" id="propertyImage" placeholder="https://contoh.com/gambar.jpg (opsional)">
                </div>
                <div class="c-form-field">
                    <label for="propertyDescription">Deskripsi</label>
                    <textarea id="propertyDescription" placeholder="Ceritakan detail menarik tentang propertimu..."
                        required></textarea>
                </div>
                <button type="submit" class="c-button"><i class="fas fa-plus-circle"></i> Tambah Properti</button>
            </form>
        </div>
    </div>

    <div class="c-modal" id="editPropertyModal">
        <div class="c-modal__content">
            <div class="c-modal__header">
                <h2 class="c-modal__title">Edit Properti</h2>
                <button class="c-modal__close-btn" data-modal-close aria-label="Tutup modal"><i
                        class="fas fa-times"></i></button>
            </div>
            <form id="editPropertyForm" class="l-flex flex-col">
                <input type="hidden" id="editPropertyId">
                <div class="c-form-field">
                    <label for="editPropertyName">Nama Properti</label>
                    <input type="text" id="editPropertyName" required>
                </div>
                <div class="c-form-field">
                    <label for="editPropertyType">Tipe Properti</label>
                    <select id="editPropertyType" required>
                        <option value="apartemen">Apartemen</option>
                        <option value="rumah">Rumah</option>
                        <option value="kost">Kost</option>
                    </select>
                </div>
                <div class="c-form-field">
                    <label for="editPropertyPrice">Harga (Rp/bulan)</label>
                    <input type="number" id="editPropertyPrice" min="0" required>
                </div>
                <div class="c-form-field">
                    <label for="editPropertyImage">URL Gambar Properti</label>
                    <input type="url" id="editPropertyImage" placeholder="https://contoh.com/gambar.jpg (opsional)">
                </div>
                <div class="c-form-field">
                    <label for="editPropertyDescription">Deskripsi</label>
                    <textarea id="editPropertyDescription" required></textarea>
                </div>
                <button type="submit" class="c-button"><i class="fas fa-save"></i> Simpan Perubahan</button>
            </form>
        </div>
    </div>

    <div class="c-modal" id="paymentDetailModal"> <!-- Ubah nama dari paymentModal agar tidak konflik -->
        <div class="c-modal__content">
            <div class="c-modal__header">
                <h2 class="c-modal__title">Detail Pembayaran Sewa</h2>
                <button class="c-modal__close-btn" data-modal-close aria-label="Tutup modal"><i
                        class="fas fa-times"></i></button>
            </div>
            <div class="payment-methods" id="paymentOptionsContainer">
                <!-- Opsi pembayaran akan di-render di sini oleh JS -->
            </div>
            <form id="paymentForm" class="l-flex flex-col">
                <div id="paymentDetailsFormContainer">
                    <!-- Detail form pembayaran (kartu kredit/e-wallet) akan di-render di sini -->
                </div>
                <button type="submit" class="c-button" id="payNowButton"><i class="fas fa-shield-alt"></i> Bayar
                    Sekarang dengan Aman</button>
            </form>
        </div>
    </div>

    <div class="c-modal" id="virtualTourModal">
        <div class="c-modal__content" style="max-width: 800px;"> <!-- Modal lebih lebar untuk tur virtual -->
            <div class="c-modal__header">
                <h2 class="c-modal__title">Tur Virtual 360¬∞</h2>
                <button class="c-modal__close-btn" data-modal-close aria-label="Tutup modal"><i
                        class="fas fa-times"></i></button>
            </div>
            <div class="virtual-tour-container">
                <iframe id="virtualTourIframe" src="https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1&mute=1"
                    title="Tur Virtual Properti" allow="autoplay; fullscreen; picture-in-picture"
                    allowfullscreen></iframe>
            </div>
            <p
                style="font-size: 0.8rem; text-align: center; margin-top: var(--space-sm); color: hsl(var(--muted-foreground-hsl));">
                Tekan 'Esc' atau tombol tutup untuk keluar.
            </p>
        </div>
    </div>

    <div class="c-modal" id="authModal">
        <div class="c-modal__content" style="max-width: 400px;">
            <div class="c-modal__header">
                <h2 class="c-modal__title">Akses Dashboard Admin</h2>
                <button class="c-modal__close-btn" data-modal-close aria-label="Tutup modal"><i
                        class="fas fa-times"></i></button>
            </div>
            <form id="authForm" class="l-flex flex-col">
                <p class="c-card__description">Masukkan kata sandi untuk mengakses area manajerial.</p>
                <div class="c-form-field">
                    <label for="adminPassword">Kata Sandi Admin</label>
                    <input type="password" id="adminPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="c-button"><i class="fas fa-sign-in-alt"></i> Masuk</button>
            </form>
        </div>
    </div>

    <!-- Elemen untuk Notifikasi (Toast) -->
    <div id="notificationContainer"></div>


    <script>
        (function () {
            'use strict';

            // === KONFIGURASI DAN DATA AWAL ===
            const APP_NAME = 'Green Valley';
            const ADMIN_PASSWORD = 'admin'; // Kata sandi sederhana untuk demo
            const DEFAULT_PROPERTY_IMAGE = 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=60';

            // Data awal properti (bisa dari API di aplikasi nyata)
            const initialProperties = [
                { id: 'prop1', name: 'Apartemen Elegan Skyview', type: 'apartemen', price: 9500000, description: 'Pemandangan kota menakjubkan, fasilitas gym dan kolam renang infinity. Cocok untuk profesional muda.', status: 'available', image: 'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?auto=format&fit=crop&w=1000&q=60', bed: 2, bath: 2, area: 75 },
                { id: 'prop2', name: 'Rumah Minimalis Asri', type: 'rumah', price: 12000000, description: 'Lingkungan tenang dan hijau, taman pribadi luas. Ideal untuk keluarga.', status: 'available', image: 'https://images.unsplash.com/photo-1570129477492-45c003edd2be?auto=format&fit=crop&w=1000&q=60', bed: 3, bath: 2, area: 120 },
                { id: 'prop3', name: 'Kost Mahasiswa Ceria', type: 'kost', price: 2800000, description: 'Dekat kampus ternama, internet cepat, area komunal nyaman. Harga terjangkau.', status: 'rented', image: 'https://images.unsplash.com/photo-1580237072617-761890102395?auto=format&fit=crop&w=1000&q=60', bed: 1, bath: 1, area: 18 },
                { id: 'prop4', name: 'Villa Mewah Tepi Pantai', type: 'rumah', price: 25000000, description: 'Nikmati matahari terbenam dari balkon pribadi Anda. Akses langsung ke pantai.', status: 'available', image: 'https://images.unsplash.com/photo-1613977257363-707ba9348227?auto=format&fit=crop&w=1000&q=60', bed: 4, bath: 3, area: 250 },
            ];

            // Data awal ulasan
            const initialReviews = [
                { id: 'rev1', propertyId: 'prop1', author: 'Budi Santoso', rating: 5, text: 'Apartemennya luar biasa! Pemandangannya indah dan fasilitasnya lengkap. Sangat direkomendasikan.', date: '2024-03-10' },
                { id: 'rev2', propertyId: 'prop2', author: 'Citra Lestari', rating: 4, text: 'Rumahnya nyaman dan lingkungannya asri. Anak-anak suka taman belakangnya. Proses sewa juga mudah.', date: '2024-03-15' },
            ];

            // Definisi metode pembayaran
            const paymentMethodDetails = {
                'credit-card': {
                    name: 'Kartu Kredit/Debit',
                    icon: 'fa-credit-card',
                    fields: `
            <div class="c-form-field">
              <label for="cardNumber">Nomor Kartu</label>
              <input type="text" id="cardNumber" placeholder="xxxx xxxx xxxx xxxx" required pattern="[0-9]{13,16}">
            </div>
            <div class="l-grid" style="grid-template-columns: 1fr 1fr; gap: var(--space-sm);">
              <div class="c-form-field">
                <label for="expiryDate">Tanggal Kedaluwarsa</label>
                <input type="text" id="expiryDate" placeholder="MM/YY" required pattern="(0[1-9]|1[0-2])\/([0-9]{2})">
              </div>
              <div class="c-form-field">
                <label for="cvv">CVV</label>
                <input type="text" id="cvv" placeholder="xxx" required pattern="[0-9]{3,4}">
              </div>
            </div>
            <div class="c-form-field">
              <label for="cardHolderName">Nama Pemegang Kartu</label>
              <input type="text" id="cardHolderName" placeholder="Nama Lengkap Anda" required>
            </div>
          `
                },
                'ewallet': {
                    name: 'Dompet Digital (E-Wallet)',
                    icon: 'fa-wallet',
                    fields: `
            <div class="c-form-field">
              <label for="ewalletType">Pilih Dompet Digital</label>
              <select id="ewalletType" required>
                <option value="" disabled selected>Pilih E-Wallet</option>
                <option value="gopay">GoPay</option>
                <option value="ovo">OVO</option>
                <option value="dana">DANA</option>
                <option value="shopeepay">ShopeePay</option>
              </select>
            </div>
            <div class="c-form-field">
              <label for="ewalletPhoneNumber">Nomor HP Terdaftar</label>
              <input type="tel" id="ewalletPhoneNumber" placeholder="08xxxxxxxxxx" required pattern="08[0-9]{8,11}">
            </div>
          `
                },
                'bank-transfer': {
                    name: 'Transfer Bank Virtual Account',
                    icon: 'fa-university',
                    fields: `
            <div class="c-form-field">
              <label for="bankSelect">Pilih Bank Tujuan</label>
              <select id="bankSelect" required>
                <option value="" disabled selected>Pilih Bank</option>
                <option value="bca">BCA Virtual Account</option>
                <option value="mandiri">Mandiri Virtual Account</option>
                <option value="bni">BNI Virtual Account</option>
                <option value="bri">BRI Virtual Account</option>
              </select>
            </div>
            <p class="c-card__description">Nomor Virtual Account akan ditampilkan setelah Anda memilih bank dan melanjutkan.</p>
          `
                }
            };


            // === STATE APLIKASI (Penyimpanan Data Dinamis) ===
            let appState = {
                properties: JSON.parse(localStorage.getItem('greenvalley_properties')) || initialProperties,
                reviews: JSON.parse(localStorage.getItem('greenvalley_reviews')) || initialReviews,
                chatMessages: JSON.parse(localStorage.getItem('greenvalley_chatMessages')) || [
                    { id: 'chat0', text: `Selamat datang di ${APP_NAME}! Ada yang bisa kami bantu terkait properti?`, sender: 'system', timestamp: new Date().toISOString() },
                ],
                currentRating: 0,
                currentPage: 'home',
                isAuthenticated: JSON.parse(sessionStorage.getItem('greenvalley_isAuthenticated')) || false, // sessionStorage untuk auth
                currentTheme: localStorage.getItem('greenvalley_theme') || 'light',
                selectedPaymentMethod: 'credit-card' // Default metode pembayaran
            };

            // === ELEMEN DOM UTAMA (Caching untuk Performa) ===
            const mainContent = document.getElementById('mainContent');
            const navToggleBtn = document.getElementById('navToggleBtn');
            const mainNav = document.getElementById('mainNav');
            const themeToggleBtn = document.getElementById('themeToggleBtn');
            const currentYearEl = document.getElementById('currentYear');

            // Chat Elements
            const chatBox = document.getElementById('chatBox');
            const chatCloseBtn = document.getElementById('chatCloseBtn');
            const chatMessagesContainer = document.getElementById('chatMessagesContainer');
            const chatForm = document.getElementById('chatForm');
            const chatInput = document.getElementById('chatInput');
            const chatToggleBtn = document.getElementById('chatToggleBtn');

            // Notification Container
            const notificationContainer = document.getElementById('notificationContainer');

            // Modal Elements (akan diambil saat dibutuhkan)


            // === FUNGSI UTILITAS (Reusable Helper Functions) ===
            // Fungsi untuk menyimpan state ke localStorage
            const saveState = (key, value) => {
                try {
                    localStorage.setItem(`greenvalley_${key}`, JSON.stringify(value));
                } catch (error) {
                    console.error(`Gagal menyimpan state '${key}':`, error);
                    showNotification(`Gagal menyimpan data: ${error.message}`, 'error');
                }
            };

            // Fungsi untuk menghasilkan ID unik sederhana
            const generateId = (prefix = '') => prefix + Date.now().toString(36) + Math.random().toString(36).substring(2, 7);

            // Fungsi untuk menampilkan notifikasi (toast)
            const showNotification = (message, type = 'info', duration = 3500) => {
                const notifId = generateId('notif_');
                const notificationElement = document.createElement('div');
                notificationElement.id = notifId;
                notificationElement.className = `c-notification c-notification--${type}`;

                let iconClass = 'fas fa-info-circle';
                if (type === 'success') iconClass = 'fas fa-check-circle';
                if (type === 'error') iconClass = 'fas fa-exclamation-triangle';

                notificationElement.innerHTML = `<i class="${iconClass}"></i> <p>${message}</p>`;
                notificationContainer.appendChild(notificationElement);

                // Tampilkan notifikasi
                setTimeout(() => notificationElement.classList.add('show'), 10);

                // Sembunyikan dan hapus notifikasi setelah durasi tertentu
                setTimeout(() => {
                    notificationElement.classList.remove('show');
                    setTimeout(() => notificationElement.remove(), 500); // Tunggu transisi selesai
                }, duration);
            };

            // Fungsi untuk memformat harga ke format Rupiah
            const formatPrice = (price) => {
                if (typeof price !== 'number') return 'N/A';
                return `Rp ${price.toLocaleString('id-ID')}`;
            };

            // Fungsi untuk validasi form sederhana
            const validateForm = (formElement) => {
                let isValid = true;
                formElement.querySelectorAll('[required]').forEach(input => {
                    if (!input.value.trim()) {
                        isValid = false;
                        input.style.borderColor = 'hsl(var(--destructive-hsl))'; // Highlight field error
                        showNotification(`Kolom "${input.previousElementSibling?.textContent || input.name || input.id}" wajib diisi.`, 'error');
                    } else if (input.pattern && !new RegExp(input.pattern).test(input.value)) {
                        isValid = false;
                        input.style.borderColor = 'hsl(var(--destructive-hsl))';
                        showNotification(`Format isian untuk "${input.previousElementSibling?.textContent || input.name || input.id}" tidak sesuai.`, 'error');
                    }
                    else {
                        input.style.borderColor = ''; // Reset border
                    }
                });
                return isValid;
            };

            // Fungsi untuk mengelola modal
            const openModal = (modalId) => {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.add('open');
                    document.body.classList.add('modal-open'); // Mencegah scroll body
                    // Fokus ke elemen pertama yang bisa di-fokus dalam modal untuk aksesibilitas
                    const focusableElements = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                    if (focusableElements.length) focusableElements[0].focus();
                }
            };

            const closeModal = (modalIdOrElement) => {
                const modal = typeof modalIdOrElement === 'string' ? document.getElementById(modalIdOrElement) : modalIdOrElement.closest('.c-modal');
                if (modal) {
                    modal.classList.remove('open');
                    document.body.classList.remove('modal-open');
                }
            };

            // Fungsi escape HTML untuk keamanan dasar (mencegah XSS dari data dinamis)
            const escapeHTML = (str) => {
                if (typeof str !== 'string') return str;
                return str.replace(/[&<>'"]/g, tag => ({
                    '&': '&amp;', '<': '&lt;', '>': '&gt;', "'": '&#39;', '"': '&quot;'
                }[tag] || tag));
            };


            // === MANAJEMEN TEMA (Terang/Gelap) ===
            const applyTheme = (theme) => {
                document.documentElement.setAttribute('data-theme', theme);
                themeToggleBtn.querySelector('i').className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
                appState.currentTheme = theme;
                localStorage.setItem('greenvalley_theme', theme);
            };

            const toggleTheme = () => {
                const newTheme = appState.currentTheme === 'light' ? 'dark' : 'light';
                applyTheme(newTheme);
            };


            // === MANAJEMEN NAVIGASI SPA ===
            const renderPage = (pageId) => {
                if (!pageId) pageId = 'home'; // Default ke home
                appState.currentPage = pageId;
                mainContent.innerHTML = ''; // Kosongkan konten sebelum render baru

                // Update link navigasi aktif
                document.querySelectorAll('.c-nav__link').forEach(link => {
                    link.classList.toggle('active', link.dataset.page === pageId);
                });

                // Tutup menu mobile jika terbuka
                if (mainNav.classList.contains('open')) {
                    mainNav.classList.remove('open');
                    navToggleBtn.setAttribute('aria-expanded', 'false');
                    navToggleBtn.querySelector('i').className = 'fas fa-bars';
                }

                let pageContent = '';
                let pageTitle = `${APP_NAME} - Hunian Impianmu`; // Default title

                // Konten untuk setiap halaman
                // Semua string HTML di-escape jika mengandung data dinamis dari user, atau pastikan sumber data aman
                switch (pageId) {
                    case 'home':
                        pageTitle = `${APP_NAME} - Temukan Hunian Sempurna Anda`;
                        pageContent = `
              <section class="c-hero">
                <div class="c-hero__content animate-fade-in">
                  <h1 class="c-hero__title">Selamat Datang di Green Valley</h1>
                  <p class="c-hero__subtitle">Platform terpercaya untuk menemukan apartemen, rumah, dan kost premium. Mulai pencarian hunian ideal Anda hari ini!</p>
                  <a href="#properti" class="c-button c-button--lg animate-fade-in-delay-1" data-nav>
                    <i class="fas fa-search"></i> Jelajahi Properti Sekarang
                  </a>
                </div>
              </section>
              <section class="c-section">
                <div class="container">
                  <h2 class="c-section__title">Mengapa Memilih Green Valley?</h2>
                  <p class="c-section__subtitle">Kami menawarkan pengalaman pencarian properti yang tak tertandingi.</p>
                  <div class="l-grid" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--space-lg);">
                    <div class="c-card text-center animate-fade-in">
                      <i class="fas fa-check-circle fa-3x" style="color: hsl(var(--primary-hsl)); margin-bottom: var(--space-md);"></i>
                      <h3 class="c-card__title">Properti Terverifikasi</h3>
                      <p class="c-card__description">Semua listing properti telah melalui proses verifikasi ketat untuk kenyamanan dan keamanan Anda.</p>
                    </div>
                    <div class="c-card text-center animate-fade-in-delay-1">
                      <i class="fas fa-comments fa-3x" style="color: hsl(var(--primary-hsl)); margin-bottom: var(--space-md);"></i>
                      <h3 class="c-card__title">Ulasan Terpercaya</h3>
                      <p class="c-card__description">Baca ulasan jujur dari penyewa sebelumnya untuk membuat keputusan yang lebih baik.</p>
                    </div>
                    <div class="c-card text-center animate-fade-in-delay-2">
                      <i class="fas fa-shield-alt fa-3x" style="color: hsl(var(--primary-hsl)); margin-bottom: var(--space-md);"></i>
                      <h3 class="c-card__title">Pembayaran Aman</h3>
                      <p class="c-card__description">Sistem pembayaran kami aman dan terenkripsi, menjamin transaksi tanpa khawatir.</p>
                    </div>
                  </div>
                </div>
              </section>
            `;
                        break;

                    case 'properti':
                        pageTitle = `Daftar Properti - ${APP_NAME}`;
                        pageContent = `
              <section class="c-section">
                <div class="container">
                  <h2 class="c-section__title">Temukan Properti Impian Anda</h2>
                  <p class="c-section__subtitle">Jelajahi berbagai pilihan apartemen, rumah, dan kost berkualitas.</p>
                  <div class="l-flex justify-between align-center flex-wrap" style="margin-bottom: var(--space-lg); gap: var(--space-md);">
                    <div class="c-form-field" style="flex-grow: 1; margin-bottom: 0;">
                      <input type="search" id="propertySearchInput" placeholder="Cari berdasarkan nama, tipe, atau lokasi..." aria-label="Cari properti">
                    </div>
                    <button class="c-button" id="openAddPropertyModalBtn" ${appState.isAuthenticated ? '' : 'disabled title="Login sebagai admin untuk menambah properti"'}><i class="fas fa-plus"></i> Tambah Properti</button>
                  </div>
                  <div class="property-list" id="propertyListContainer">
                    <!-- Daftar properti akan di-render di sini -->
                  </div>
                </div>
              </section>
            `;
                        renderProperties(); // Panggil fungsi render spesifik
                        break;

                    case 'ulasan':
                        pageTitle = `Ulasan Pengguna - ${APP_NAME}`;
                        pageContent = `
              <section class="c-section">
                <div class="container">
                  <h2 class="c-section__title">Apa Kata Mereka?</h2>
                  <p class="c-section__subtitle">Lihat ulasan dan testimoni dari para pengguna Green Valley.</p>
                  <div class="c-card animate-fade-in" style="margin-bottom: var(--space-xl);">
                    <h3 class="c-card__title">Bagikan Pengalaman Anda</h3>
                    <form id="reviewForm" class="l-flex flex-col">
                       <div class="c-form-field">
                        <label for="reviewPropertyId">Pilih Properti yang Diulas</label>
                        <select id="reviewPropertyId" required>
                          <option value="" disabled selected>Pilih properti</option>
                          ${appState.properties.map(p => `<option value="${p.id}">${escapeHTML(p.name)}</option>`).join('')}
                        </select>
                      </div>
                      <div class="c-form-field">
                        <label>Rating Anda</label>
                        <div class="rating-stars" id="formRatingStars">
                          ${[1, 2, 3, 4, 5].map(i => `<span data-rating="${i}" role="button" tabindex="0" aria-label="Beri ${i} bintang">‚òÖ</span>`).join('')}
                        </div>
                        <input type="hidden" id="reviewRatingValue" required>
                      </div>
                      <div class="c-form-field">
                        <label for="reviewAuthor">Nama Anda</label>
                        <input type="text" id="reviewAuthor" placeholder="Nama Anda" required>
                      </div>
                      <div class="c-form-field">
                        <label for="reviewText">Ulasan Anda</label>
                        <textarea id="reviewText" placeholder="Ceritakan pengalaman Anda dengan properti ini..." required></textarea>
                      </div>
                      <button type="submit" class="c-button"><i class="fas fa-paper-plane"></i> Kirim Ulasan</button>
                    </form>
                  </div>
                  <div class="review-list" id="reviewsListContainer">
                    <!-- Daftar ulasan akan di-render di sini -->
                  </div>
                </div>
              </section>
            `;
                        renderReviews();
                        break;

                    case 'pembayaran':
                        pageTitle = `Pembayaran Sewa - ${APP_NAME}`;
                        pageContent = `
              <section class="c-section">
                <div class="container">
                  <h2 class="c-section__title">Proses Pembayaran Mudah & Aman</h2>
                  <p class="c-section__subtitle">Selesaikan pembayaran sewa properti Anda dengan beberapa langkah sederhana.</p>
                  <div class="c-card animate-fade-in" style="max-width: 600px; margin: 0 auto;">
                    <h3 class="c-card__title">Pilih Properti untuk Pembayaran</h3>
                     <div class="c-form-field">
                        <label for="paymentPropertySelect">Properti yang Akan Dibayar</label>
                        <select id="paymentPropertySelect" required>
                            <option value="" disabled selected>Pilih properti...</option>
                            ${appState.properties.filter(p => p.status === 'available').map(p => `<option value="${p.id}">${escapeHTML(p.name)} - ${formatPrice(p.price)}/bulan</option>`).join('')}
                        </select>
                    </div>
                    <p class="c-card__description" id="paymentPropertyInfo" style="display:none;">
                        Anda akan membayar sewa untuk: <strong id="selectedPropertyName"></strong><br>
                        Harga sewa: <strong id="selectedPropertyPrice"></strong>
                    </p>
                    <button class="c-button" id="proceedToPaymentBtn" disabled><i class="fas fa-arrow-right"></i> Lanjut ke Metode Pembayaran</button>
                  </div>
                </div>
              </section>
            `;
                        // Event listener untuk tombol lanjut akan ditambahkan di bindPageSpecificEvents
                        break;

                    case 'dashboard':
                        pageTitle = `Dashboard Admin - ${APP_NAME}`;
                        if (!appState.isAuthenticated) {
                            pageContent = `
                <section class="c-section">
                  <div class="container text-center">
                    <h2 class="c-section__title">Akses Ditolak</h2>
                    <p class="c-section__subtitle">Anda harus masuk sebagai admin untuk mengakses halaman ini.</p>
                    <button class="c-button" id="dashboardLoginBtn"><i class="fas fa-sign-in-alt"></i> Masuk Sekarang</button>
                  </div>
                </section>
              `;
                        } else {
                            pageContent = `
                <section class="c-section">
                  <div class="container">
                    <div class="l-flex justify-between align-center">
                        <h2 class="c-section__title" style="text-align:left; margin-bottom:0;">Dashboard Admin</h2>
                        <button class="c-button c-button--destructive" id="adminLogoutBtn"><i class="fas fa-sign-out-alt"></i> Keluar</button>
                    </div>
                    <p class="c-section__subtitle" style="text-align:left; max-width:none;">Kelola properti, ulasan, dan lihat statistik aplikasi.</p>
                    
                    <!-- Statistik Ringkas -->
                    <div class="l-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-lg); margin-bottom: var(--space-xl);">
                        <div class="c-card text-center animate-fade-in">
                            <i class="fas fa-building fa-2x" style="color: hsl(var(--primary-hsl)); margin-bottom: var(--space-sm);"></i>
                            <h4 class="c-card__title" style="font-size:1.5rem;">${appState.properties.length}</h4>
                            <p class="c-card__description" style="margin-bottom:0;">Total Properti</p>
                        </div>
                        <div class="c-card text-center animate-fade-in-delay-1">
                            <i class="fas fa-key fa-2x" style="color: hsl(var(--primary-hsl)); margin-bottom: var(--space-sm);"></i>
                            <h4 class="c-card__title" style="font-size:1.5rem;">${appState.properties.filter(p => p.status === 'rented').length}</h4>
                            <p class="c-card__description" style="margin-bottom:0;">Properti Disewa</p>
                        </div>
                        <div class="c-card text-center animate-fade-in-delay-2">
                            <i class="fas fa-star fa-2x" style="color: hsl(var(--accent-hsl)); margin-bottom: var(--space-sm);"></i>
                            <h4 class="c-card__title" style="font-size:1.5rem;">${appState.reviews.length}</h4>
                            <p class="c-card__description" style="margin-bottom:0;">Total Ulasan</p>
                        </div>
                        <div class="c-card text-center animate-fade-in-delay-3">
                             <i class="fas fa-comments fa-2x" style="color: hsl(var(--primary-hsl)); margin-bottom: var(--space-sm);"></i>
                            <h4 class="c-card__title" style="font-size:1.5rem;">${appState.chatMessages.filter(m => m.sender === 'user').length}</h4>
                            <p class="c-card__description" style="margin-bottom:0;">Pesan Pengguna</p>
                        </div>
                    </div>

                    <!-- Tabel Manajemen Properti -->
                    <h3 class="c-card__title" style="margin-top: var(--space-xl); margin-bottom: var(--space-md);">Manajemen Properti</h3>
                    <div class="c-table-wrapper">
                        <table class="c-table" id="dashboardPropertyTable">
                            <thead>
                                <tr><th>Nama Properti</th><th>Tipe</th><th>Harga</th><th>Status</th><th class="hide-mobile">Deskripsi Singkat</th><th>Aksi</th></tr>
                            </thead>
                            <tbody>
                                <!-- Data properti di-render oleh JS -->
                            </tbody>
                        </table>
                    </div>
                     <button class="c-button" id="dashboardAddPropertyBtn" style="margin-top:var(--space-lg);"><i class="fas fa-plus"></i> Tambah Properti Baru</button>
                  </div>
                </section>
              `;
                            renderDashboardContent();
                        }
                        break;
                    default:
                        pageTitle = `Halaman Tidak Ditemukan - ${APP_NAME}`;
                        pageContent = `
              <section class="c-section text-center">
                <div class="container">
                  <i class="fas fa-compass fa-5x" style="color: hsl(var(--muted-foreground-hsl)); margin-bottom: var(--space-lg);"></i>
                  <h2 class="c-section__title">404 - Halaman Tersesat!</h2>
                  <p class="c-section__subtitle">Maaf, halaman yang Anda cari tidak dapat ditemukan. Mungkin URL salah atau halaman telah dipindahkan.</p>
                  <a href="#home" class="c-button" data-nav><i class="fas fa-home"></i> Kembali ke Beranda</a>
                </div>
              </section>
            `;
                }
                document.title = pageTitle;
                mainContent.innerHTML = pageContent;
                // Panggil fungsi untuk bind event listener spesifik halaman
                bindPageSpecificEventListeners(pageId);
                // Scroll ke atas halaman
                window.scrollTo(0, 0);
            };

            const handleNavigation = () => {
                const hash = window.location.hash.substring(1) || 'home';
                if (hash === 'dashboard' && !appState.isAuthenticated) {
                    // Jika mencoba akses dashboard tanpa auth, tampilkan modal login
                    // Jika sudah di halaman dashboard (karena URL langsung) dan tidak auth, renderPage akan handle
                    if (appState.currentPage !== 'dashboard') { // Hindari loop jika sudah di dashboard
                        openModal('authModal');
                        // Jangan render dashboard jika auth gagal, biarkan di halaman saat ini atau redirect ke home
                        // Atau, kita bisa paksa ke home jika auth gagal dari modal
                        // window.location.hash = '#home';
                        return; // Hentikan navigasi lebih lanjut sampai auth
                    }
                }
                renderPage(hash);
            };

            // === FUNGSI RENDER KONTEN SPESIFIK HALAMAN ===
            const renderProperties = (searchTerm = '') => {
                const container = document.getElementById('propertyListContainer');
                if (!container) return;

                const filtered = appState.properties.filter(p =>
                    p.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    p.type.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    p.description.toLowerCase().includes(searchTerm.toLowerCase())
                );

                if (filtered.length === 0) {
                    container.innerHTML = `<p class="text-center c-card__description" style="grid-column: 1 / -1;">Properti tidak ditemukan untuk pencarian "${escapeHTML(searchTerm)}". Coba kata kunci lain.</p>`;
                    return;
                }

                container.innerHTML = filtered.map((p, index) => `
          <article class="c-card property-card animate-fade-in" style="animation-delay: ${index * 0.05}s">
            <div style="overflow:hidden; border-radius: var(--radius-md); margin-bottom: var(--space-md);">
                 <img src="${escapeHTML(p.image) || DEFAULT_PROPERTY_IMAGE}" alt="${escapeHTML(p.name)}" class="property-card__image" loading="lazy" onerror="this.onerror=null;this.src='${DEFAULT_PROPERTY_IMAGE}';">
            </div>
            <div class="property-card__status ${p.status === 'rented' ? 'property-card__status--rented' : ''}">
              ${p.status === 'available' ? 'Tersedia' : 'Disewa'}
            </div>
            <h3 class="c-card__title">${escapeHTML(p.name)}</h3>
            <p class="property-card__price">${formatPrice(p.price)} / bulan</p>
            <div class="property-card__features">
                <span><i class="fas fa-home"></i> ${escapeHTML(p.type.charAt(0).toUpperCase() + p.type.slice(1))}</span>
                ${p.bed ? `<span><i class="fas fa-bed"></i> ${p.bed} KT</span>` : ''}
                ${p.bath ? `<span><i class="fas fa-bath"></i> ${p.bath} KM</span>` : ''}
                ${p.area ? `<span><i class="fas fa-ruler-combined"></i> ${p.area} m¬≤</span>` : ''}
            </div>
            <p class="c-card__description">${escapeHTML(p.description.substring(0, 100))}${p.description.length > 100 ? '...' : ''}</p>
            <div class="c-card__actions">
              <button class="c-button c-button--outline" data-action="view-tour" data-property-id="${p.id}"><i class="fas fa-vr-cardboard"></i> Tur Virtual</button>
              ${appState.isAuthenticated ? `
                <button class="c-button c-button--secondary c-button--outline" data-action="edit-property" data-property-id="${p.id}"><i class="fas fa-edit"></i> Edit</button>
                <button class="c-button c-button--destructive c-button--outline" data-action="delete-property" data-property-id="${p.id}"><i class="fas fa-trash"></i> Hapus</button>
              ` : ''}
            </div>
          </article>
        `).join('');
            };

            const renderReviews = () => {
                const container = document.getElementById('reviewsListContainer');
                if (!container) return;

                if (appState.reviews.length === 0) {
                    container.innerHTML = `<p class="text-center c-card__description">Belum ada ulasan. Jadilah yang pertama memberikan ulasan!</p>`;
                    return;
                }

                // Urutkan ulasan dari yang terbaru
                const sortedReviews = [...appState.reviews].sort((a, b) => new Date(b.date) - new Date(a.date));

                container.innerHTML = sortedReviews.map((r, index) => {
                    const property = appState.properties.find(p => p.id === r.propertyId);
                    return `
              <article class="c-card review-card animate-fade-in" style="animation-delay: ${index * 0.05}s">
                  <div class="review-card__rating">
                  ${'‚òÖ'.repeat(r.rating)}${'‚òÜ'.repeat(5 - r.rating)}
                  </div>
                  <h4 class="review-card__author">${escapeHTML(r.author)}</h4>
                  ${property ? `<p class="c-card__description" style="font-size:0.8rem; margin-bottom:var(--space-xs);">Mengulas: <strong>${escapeHTML(property.name)}</strong></p>` : ''}
                  <p class="c-card__description">"${escapeHTML(r.text)}"</p>
                  <time class="review-card__date" datetime="${r.date}">${new Date(r.date).toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' })}</time>
              </article>
              `;
                }).join('');
            };

            const renderChatMessages = () => {
                if (!chatMessagesContainer) return;
                chatMessagesContainer.innerHTML = appState.chatMessages.map(m => `
          <div class="chat-msg ${m.sender === 'user' ? 'user' : 'system'}">
            <p>${escapeHTML(m.text)}</p> <!-- Pastikan pesan di-escape -->
            <time datetime="${m.timestamp}">${new Date(m.timestamp).toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })}</time>
          </div>
        `).join('');
                chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight; // Auto scroll ke pesan terbaru
            };

            const renderDashboardContent = () => {
                if (!appState.isAuthenticated) return; // Double check

                const tableBody = document.querySelector('#dashboardPropertyTable tbody');
                if (tableBody) {
                    if (appState.properties.length === 0) {
                        tableBody.innerHTML = `<tr><td colspan="6" class="text-center c-card__description">Belum ada properti yang ditambahkan.</td></tr>`;
                        return;
                    }
                    tableBody.innerHTML = appState.properties.map(p => `
                  <tr>
                      <td>${escapeHTML(p.name)}</td>
                      <td>${escapeHTML(p.type.charAt(0).toUpperCase() + p.type.slice(1))}</td>
                      <td>${formatPrice(p.price)}</td>
                      <td><span class="property-card__status ${p.status === 'rented' ? 'property-card__status--rented' : ''}" style="position:relative; top:0; right:0;">${p.status === 'available' ? 'Tersedia' : 'Disewa'}</span></td>
                      <td class="hide-mobile">${escapeHTML(p.description.substring(0, 50))}${p.description.length > 50 ? '...' : ''}</td>
                      <td class="actions-cell">
                          <button class="c-button c-button--secondary c-button--outline" data-action="edit-property" data-property-id="${p.id}" title="Edit"><i class="fas fa-edit"></i></button>
                          <button class="c-button c-button--destructive c-button--outline" data-action="delete-property" data-property-id="${p.id}" title="Hapus"><i class="fas fa-trash"></i></button>
                          <button class="c-button c-button--outline" data-action="toggle-status" data-property-id="${p.id}" title="${p.status === 'available' ? 'Tandai Disewa' : 'Tandai Tersedia'}">
                            <i class="fas fa-${p.status === 'available' ? 'lock' : 'unlock'}"></i>
                          </button>
                      </td>
                  </tr>
              `).join('');
                }
            };

            // === FUNGSI AKSI DAN EVENT HANDLER ===
            // Aksi terkait properti
            const handleAddProperty = (event) => {
                event.preventDefault();
                const form = event.target;
                if (!validateForm(form)) return;

                const newProperty = {
                    id: generateId('prop'),
                    name: form.propertyName.value,
                    type: form.propertyType.value,
                    price: parseInt(form.propertyPrice.value),
                    image: form.propertyImage.value || DEFAULT_PROPERTY_IMAGE, // Gunakan default jika kosong
                    description: form.propertyDescription.value,
                    status: 'available', // Default status
                    // Tambahkan bed, bath, area jika ada fieldnya di form
                };
                appState.properties.unshift(newProperty); // Tambah ke awal array
                saveState('properties', appState.properties);
                form.reset();
                closeModal('addPropertyModal');
                showNotification('Properti baru berhasil ditambahkan!', 'success');
                if (appState.currentPage === 'properti') renderProperties();
                if (appState.currentPage === 'dashboard') renderDashboardContent(); // Update dashboard juga
            };

            const openEditPropertyForm = (propertyId) => {
                const prop = appState.properties.find(p => p.id === propertyId);
                if (!prop) return;

                const form = document.getElementById('editPropertyForm');
                form.editPropertyId.value = prop.id;
                form.editPropertyName.value = prop.name;
                form.editPropertyType.value = prop.type;
                form.editPropertyPrice.value = prop.price;
                form.editPropertyImage.value = prop.image;
                form.editPropertyDescription.value = prop.description;
                openModal('editPropertyModal');
            };

            const handleEditProperty = (event) => {
                event.preventDefault();
                const form = event.target;
                if (!validateForm(form)) return;

                const propertyId = form.editPropertyId.value;
                const updatedProperty = {
                    name: form.editPropertyName.value,
                    type: form.editPropertyType.value,
                    price: parseInt(form.editPropertyPrice.value),
                    image: form.editPropertyImage.value || DEFAULT_PROPERTY_IMAGE,
                    description: form.editPropertyDescription.value,
                };

                appState.properties = appState.properties.map(p =>
                    p.id === propertyId ? { ...p, ...updatedProperty } : p
                );
                saveState('properties', appState.properties);
                closeModal('editPropertyModal');
                showNotification('Properti berhasil diperbarui!', 'success');
                if (appState.currentPage === 'properti') renderProperties();
                if (appState.currentPage === 'dashboard') renderDashboardContent();
            };

            const handleDeleteProperty = (propertyId) => {
                if (confirm(`Yakin ingin menghapus properti ini? Tindakan ini tidak dapat dibatalkan.`)) {
                    appState.properties = appState.properties.filter(p => p.id !== propertyId);
                    saveState('properties', appState.properties);
                    showNotification('Properti berhasil dihapus.', 'success');
                    if (appState.currentPage === 'properti') renderProperties();
                    if (appState.currentPage === 'dashboard') renderDashboardContent();
                }
            };

            const handleTogglePropertyStatus = (propertyId) => {
                appState.properties = appState.properties.map(p => {
                    if (p.id === propertyId) {
                        return { ...p, status: p.status === 'available' ? 'rented' : 'available' };
                    }
                    return p;
                });
                saveState('properties', appState.properties);
                const prop = appState.properties.find(p => p.id === propertyId);
                showNotification(`Status properti "${escapeHTML(prop.name)}" diubah menjadi ${prop.status === 'available' ? 'Tersedia' : 'Disewa'}.`, 'success');
                if (appState.currentPage === 'properti') renderProperties();
                if (appState.currentPage === 'dashboard') renderDashboardContent();
            };

            // Aksi terkait ulasan
            const handleReviewFormSubmit = (event) => {
                event.preventDefault();
                const form = event.target;
                if (!validateForm(form) || appState.currentRating === 0) {
                    if (appState.currentRating === 0) showNotification('Mohon berikan rating bintang.', 'error');
                    return;
                }

                const newReview = {
                    id: generateId('rev'),
                    propertyId: form.reviewPropertyId.value,
                    author: form.reviewAuthor.value,
                    rating: appState.currentRating,
                    text: form.reviewText.value,
                    date: new Date().toISOString().split('T')[0] // Format YYYY-MM-DD
                };
                appState.reviews.unshift(newReview);
                saveState('reviews', appState.reviews);
                form.reset();
                appState.currentRating = 0; // Reset rating
                document.querySelectorAll('#formRatingStars span').forEach(s => s.classList.remove('active')); // Reset visual rating
                showNotification('Ulasan Anda berhasil dikirim. Terima kasih!', 'success');
                renderReviews();
            };

            const handleStarRating = (event) => {
                const targetStar = event.target.closest('.rating-stars span');
                if (!targetStar) return;

                const rating = parseInt(targetStar.dataset.rating);
                const starsContainer = targetStar.parentElement;

                if (event.type === 'click') {
                    appState.currentRating = rating;
                    document.getElementById('reviewRatingValue').value = rating; // Simpan di hidden input
                    starsContainer.querySelectorAll('span').forEach((star, i) => {
                        star.classList.toggle('active', i < rating);
                    });
                } else if (event.type === 'mouseover') {
                    starsContainer.querySelectorAll('span').forEach((star, i) => {
                        star.classList.toggle('hovered', i < rating);
                        star.classList.remove('active'); // Hapus active agar tidak bentrok dengan currentRating
                        if (i < appState.currentRating) star.classList.add('active'); // Terapkan kembali active
                    });
                } else if (event.type === 'mouseout') {
                    starsContainer.querySelectorAll('span').forEach((star, i) => {
                        star.classList.remove('hovered');
                        star.classList.toggle('active', i < appState.currentRating); // Kembalikan ke state rating yg dipilih
                    });
                }
            };

            // Aksi terkait chat
            const toggleChatBox = () => {
                chatBox.classList.toggle('open');
                chatToggleBtn.classList.toggle('open');
                chatToggleBtn.setAttribute('aria-expanded', chatBox.classList.contains('open'));
                if (chatBox.classList.contains('open')) {
                    renderChatMessages();
                    chatInput.focus();
                }
            };

            const handleChatSubmit = (event) => {
                event.preventDefault();
                const messageText = chatInput.value.trim();
                if (!messageText) return;

                appState.chatMessages.push({ id: generateId('chat'), text: messageText, sender: 'user', timestamp: new Date().toISOString() });
                chatInput.value = '';
                renderChatMessages();
                saveState('chatMessages', appState.chatMessages);

                // Simulasi balasan dari sistem
                setTimeout(() => {
                    appState.chatMessages.push({ id: generateId('chat'), text: 'Terima kasih atas pesan Anda. Tim kami akan segera merespons (ini adalah balasan otomatis).', sender: 'system', timestamp: new Date().toISOString() });
                    renderChatMessages();
                    saveState('chatMessages', appState.chatMessages);
                }, 1500);
            };

            // Aksi terkait Pembayaran
            const renderPaymentOptions = () => {
                const container = document.getElementById('paymentOptionsContainer');
                if (!container) return;
                container.innerHTML = Object.keys(paymentMethodDetails).map(key => `
            <div class="payment-card-option ${key === appState.selectedPaymentMethod ? 'active' : ''}" data-method="${key}">
                <i class="fas ${paymentMethodDetails[key].icon}"></i>
                <span>${paymentMethodDetails[key].name}</span>
            </div>
          `).join('');

                // Event listener untuk opsi pembayaran
                container.querySelectorAll('.payment-card-option').forEach(card => {
                    card.addEventListener('click', () => {
                        appState.selectedPaymentMethod = card.dataset.method;
                        renderPaymentOptions(); // Re-render untuk update 'active' class
                        renderPaymentFormDetails(); // Re-render form detail
                    });
                });
            };

            const renderPaymentFormDetails = () => {
                const formContainer = document.getElementById('paymentDetailsFormContainer');
                if (!formContainer) return;
                formContainer.innerHTML = paymentMethodDetails[appState.selectedPaymentMethod].fields;
            };

            const handlePaymentFormSubmit = (event) => {
                event.preventDefault();
                const form = event.target;
                if (!validateForm(form)) return;

                const payButton = document.getElementById('payNowButton');
                payButton.disabled = true;
                payButton.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Memproses...`;

                // Simulasi proses pembayaran
                setTimeout(() => {
                    closeModal('paymentDetailModal');
                    showNotification('Pembayaran berhasil! Konfirmasi akan dikirimkan ke email Anda.', 'success');
                    // Reset state atau properti jika perlu
                    // Misal, properti yang dibayar ditandai 'rented' (jika ini alur booking)
                    // window.location.hash = '#home'; // Redirect
                    payButton.disabled = false;
                    payButton.innerHTML = `<i class="fas fa-shield-alt"></i> Bayar Sekarang dengan Aman`;
                }, 2500);
            };

            // Aksi terkait Autentikasi
            const handleAuthSubmit = (event) => {
                event.preventDefault();
                const password = document.getElementById('adminPassword').value;
                if (password === ADMIN_PASSWORD) {
                    appState.isAuthenticated = true;
                    sessionStorage.setItem('greenvalley_isAuthenticated', 'true'); // Simpan di session storage
                    closeModal('authModal');
                    showNotification('Login berhasil! Selamat datang, Admin.', 'success');
                    renderPage('dashboard'); // Langsung ke dashboard
                } else {
                    showNotification('Kata sandi salah. Coba lagi.', 'error');
                    document.getElementById('adminPassword').value = '';
                    document.getElementById('adminPassword').focus();
                }
            };

            const handleAdminLogout = () => {
                appState.isAuthenticated = false;
                sessionStorage.removeItem('greenvalley_isAuthenticated');
                showNotification('Anda telah keluar dari mode Admin.', 'info');
                renderPage('home'); // Kembali ke beranda
            };


            // === BIND EVENT LISTENERS ===
            // Event listener global (sekali saat load)
            const bindGlobalEventListeners = () => {
                window.addEventListener('hashchange', handleNavigation);
                window.addEventListener('popstate', handleNavigation); // Untuk tombol back/forward browser

                navToggleBtn.addEventListener('click', () => {
                    const isOpen = mainNav.classList.toggle('open');
                    navToggleBtn.setAttribute('aria-expanded', isOpen);
                    navToggleBtn.querySelector('i').className = isOpen ? 'fas fa-times' : 'fas fa-bars';
                });

                themeToggleBtn.addEventListener('click', toggleTheme);

                // Event listener untuk chat
                chatToggleBtn.addEventListener('click', toggleChatBox);
                chatCloseBtn.addEventListener('click', toggleChatBox);
                chatForm.addEventListener('submit', handleChatSubmit);

                // Event listener untuk menutup modal (delegasi event)
                document.addEventListener('click', (event) => {
                    if (event.target.matches('[data-modal-close]') || event.target.closest('[data-modal-close]')) {
                        closeModal(event.target);
                    }
                    // Tutup modal jika klik di luar area konten modal
                    if (event.target.classList.contains('c-modal') && event.target.classList.contains('open')) {
                        closeModal(event.target.id);
                    }
                    // Delegasi untuk navigasi link internal SPA
                    if (event.target.matches('a[data-nav]') || event.target.closest('a[data-nav]')) {
                        event.preventDefault();
                        const link = event.target.closest('a[data-nav]');
                        window.location.hash = link.getAttribute('href').substring(1);
                    }
                });
                document.addEventListener('keydown', (event) => {
                    if (event.key === 'Escape') {
                        document.querySelectorAll('.c-modal.open').forEach(modal => closeModal(modal.id));
                        if (chatBox.classList.contains('open')) toggleChatBox(); // Tutup chat box juga
                    }
                });

                // Event listener untuk form modal (karena modal ada di HTML utama)
                document.getElementById('addPropertyForm')?.addEventListener('submit', handleAddProperty);
                document.getElementById('editPropertyForm')?.addEventListener('submit', handleEditProperty);
                document.getElementById('authForm')?.addEventListener('submit', handleAuthSubmit);
                document.getElementById('paymentForm')?.addEventListener('submit', handlePaymentFormSubmit);

            };

            // Event listener spesifik per halaman (dipanggil setelah renderPage)
            const bindPageSpecificEventListeners = (pageId) => {
                if (pageId === 'properti') {
                    document.getElementById('propertySearchInput')?.addEventListener('input', (e) => renderProperties(e.target.value));
                    document.getElementById('openAddPropertyModalBtn')?.addEventListener('click', () => openModal('addPropertyModal'));

                    // Delegasi event untuk tombol aksi di kartu properti
                    document.getElementById('propertyListContainer')?.addEventListener('click', (event) => {
                        const button = event.target.closest('button[data-action]');
                        if (!button) return;

                        const action = button.dataset.action;
                        const propertyId = button.dataset.propertyId;

                        if (action === 'view-tour') {
                            // Bisa tambahkan logika untuk mengambil URL tur spesifik properti jika ada
                            // Contoh: const prop = appState.properties.find(p => p.id === propertyId);
                            // document.getElementById('virtualTourIframe').src = prop.tourUrl || defaultTourUrl;
                            openModal('virtualTourModal');
                        } else if (action === 'edit-property' && appState.isAuthenticated) {
                            openEditPropertyForm(propertyId);
                        } else if (action === 'delete-property' && appState.isAuthenticated) {
                            handleDeleteProperty(propertyId);
                        }
                    });
                }

                if (pageId === 'ulasan') {
                    document.getElementById('reviewForm')?.addEventListener('submit', handleReviewFormSubmit);
                    const starsContainer = document.getElementById('formRatingStars');
                    if (starsContainer) {
                        starsContainer.addEventListener('click', handleStarRating);
                        starsContainer.addEventListener('mouseover', handleStarRating);
                        starsContainer.addEventListener('mouseout', handleStarRating);
                        // Untuk aksesibilitas keyboard pada bintang rating
                        starsContainer.querySelectorAll('span[data-rating]').forEach(star => {
                            star.addEventListener('keydown', (e) => {
                                if (e.key === 'Enter' || e.key === ' ') {
                                    e.preventDefault();
                                    handleStarRating({ target: star, type: 'click' });
                                }
                            });
                        });
                    }
                }

                if (pageId === 'pembayaran') {
                    const propertySelect = document.getElementById('paymentPropertySelect');
                    const proceedBtn = document.getElementById('proceedToPaymentBtn');
                    const propNameEl = document.getElementById('selectedPropertyName');
                    const propPriceEl = document.getElementById('selectedPropertyPrice');
                    const propInfoEl = document.getElementById('paymentPropertyInfo');

                    if (propertySelect) {
                        propertySelect.addEventListener('change', (e) => {
                            const selectedId = e.target.value;
                            if (selectedId) {
                                const prop = appState.properties.find(p => p.id === selectedId);
                                if (prop) {
                                    propNameEl.textContent = escapeHTML(prop.name);
                                    propPriceEl.textContent = formatPrice(prop.price);
                                    propInfoEl.style.display = 'block';
                                    proceedBtn.disabled = false;
                                }
                            } else {
                                propInfoEl.style.display = 'none';
                                proceedBtn.disabled = true;
                            }
                        });
                    }
                    if (proceedBtn) {
                        proceedBtn.addEventListener('click', () => {
                            if (propertySelect.value) {
                                openModal('paymentDetailModal');
                                renderPaymentOptions();
                                renderPaymentFormDetails();
                            } else {
                                showNotification('Pilih properti terlebih dahulu.', 'error');
                            }
                        });
                    }
                }

                if (pageId === 'dashboard') {
                    if (appState.isAuthenticated) {
                        document.getElementById('adminLogoutBtn')?.addEventListener('click', handleAdminLogout);
                        document.getElementById('dashboardAddPropertyBtn')?.addEventListener('click', () => openModal('addPropertyModal'));
                        // Delegasi event untuk tombol aksi di tabel dashboard
                        document.getElementById('dashboardPropertyTable')?.addEventListener('click', (event) => {
                            const button = event.target.closest('button[data-action]');
                            if (!button) return;

                            const action = button.dataset.action;
                            const propertyId = button.dataset.propertyId;

                            if (action === 'edit-property') openEditPropertyForm(propertyId);
                            else if (action === 'delete-property') handleDeleteProperty(propertyId);
                            else if (action === 'toggle-status') handleTogglePropertyStatus(propertyId);
                        });
                    } else {
                        document.getElementById('dashboardLoginBtn')?.addEventListener('click', () => openModal('authModal'));
                    }
                }
            };

            // === INISIALISASI APLIKASI ===
            const initializeApp = () => {
                // Set tahun berjalan di footer
                if (currentYearEl) currentYearEl.textContent = new Date().getFullYear();

                // Terapkan tema yang tersimpan
                applyTheme(appState.currentTheme);

                // Render halaman awal berdasarkan hash atau default
                handleNavigation();

                // Render chat messages awal (jika chat box defaultnya terbuka, atau setelah dibuka)
                renderChatMessages();

                // Bind event listener global
                bindGlobalEventListeners();

                // Notifikasi selamat datang (opsional)
                // setTimeout(() => showNotification(`Selamat datang di ${APP_NAME}! Jelajahi hunian impianmu.`, 'info', 5000), 1000);
                console.log(`${APP_NAME} aplikasi berhasil diinisialisasi.`);
            };

            // Jalankan aplikasi setelah DOM siap
            document.addEventListener('DOMContentLoaded', initializeApp);

        })();
    </script>
</body>

</html>