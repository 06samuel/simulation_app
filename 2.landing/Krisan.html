<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Jelajahi properti terbaik di Green Valley. Temukan rumah, apartemen, dan villa impian Anda dengan pengalaman modern dan desain yang memukau.">
    <meta name="keywords"
        content="properti, real estate, rumah dijual, apartemen, villa, green valley, properti mewah, investasi properti">
    <meta name="author" content="Green Valley Premier Properties">
    <meta name="theme-color" content="#10b981">
    <title>Green Valley Properties - Properti Impian Anda Menanti</title>

    <!-- Favicon (Contoh menggunakan emoji, idealnya ganti dengan file .ico atau .png) -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üè°</text></svg>">

    <!-- Font Awesome Icons (CDN) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* --- Variabel CSS Global untuk Tema dan Desain Fancy --- */
        :root {
            --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            --font-secondary: 'Poppins', var(--font-primary);
            /* Font alternatif untuk heading jika diinginkan */

            --color-primary: #10b981;
            /* Hijau Emerald Cerah */
            --color-primary-dark: #059669;
            /* Hijau Emerald Lebih Gelap */
            --color-primary-light: #34d399;
            /* Hijau Emerald Lebih Terang */
            --color-secondary: #064e3b;
            /* Hijau Tua untuk Kontras atau Aksen */
            --color-accent: #f59e0b;
            /* Kuning Keemasan untuk Aksen CTA */
            --color-accent-dark: #d97706;

            --text-light: #f9fafb;
            /* Teks untuk background gelap */
            --text-dark: #1f2937;
            /* Teks untuk background terang */
            --text-muted-light: #6b7280;
            --text-muted-dark: #9ca3af;

            --bg-light: #f7fafc;
            /* Background utama mode terang */
            --bg-light-alt: #ffffff;
            /* Background alternatif (mis. card) mode terang */
            --bg-dark: #111827;
            /* Background utama mode gelap */
            --bg-dark-alt: #1f2937;
            /* Background alternatif (mis. card) mode gelap */

            --border-light: #e5e7eb;
            --border-dark: #374151;

            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-fancy: 0px 8px 20px rgba(16, 185, 129, 0.2), 0px 4px 8px rgba(0, 0, 0, 0.08);
            /* Bayangan khas */

            --border-radius-sm: 0.25rem;
            /* 4px */
            --border-radius-md: 0.5rem;
            /* 8px */
            --border-radius-lg: 0.75rem;
            /* 12px */
            --border-radius-xl: 1rem;
            /* 16px */
            --border-radius-full: 9999px;

            --transition-speed-fast: 0.15s;
            --transition-speed-medium: 0.3s;
            --transition-speed-slow: 0.5s;
            --transition-timing-function: ease-in-out;

            --max-width-container: 1280px;
            --spacing-unit: 1rem;
            /* 16px */
        }

        /* --- Reset CSS yang Lebih Komprehensif dan Base Styles --- */
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            /* Hilangkan highlight biru saat tap di mobile */
        }

        html {
            scroll-behavior: smooth;
            font-size: 100%;
            /* Umumnya 16px */
        }

        body {
            font-family: var(--font-primary);
            font-size: 1rem;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--bg-light);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
            transition: background-color var(--transition-speed-medium) var(--transition-timing-function),
                color var(--transition-speed-medium) var(--transition-timing-function);
            min-height: 100vh;
            display: flex;
            /* Memastikan footer menempel di bawah jika konten pendek */
            flex-direction: column;
        }

        body.dark-mode {
            color: var(--text-light);
            background-color: var(--bg-dark);
        }

        /* --- Aturan Tipografi yang Lebih Fancy --- */
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: var(--font-secondary);
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: calc(var(--spacing-unit) * 0.75);
            color: var(--color-secondary);
        }

        body.dark-mode h1,
        body.dark-mode h2,
        body.dark-mode h3,
        body.dark-mode h4,
        body.dark-mode h5,
        body.dark-mode h6 {
            color: var(--color-primary-light);
        }

        h1 {
            font-size: 2.5rem;
        }

        /* 40px */
        h2 {
            font-size: 2rem;
        }

        /* 32px */
        h3 {
            font-size: 1.5rem;
        }

        /* 24px */
        h4 {
            font-size: 1.25rem;
        }

        /* 20px */
        p {
            margin-bottom: var(--spacing-unit);
        }

        @media (min-width: 768px) {
            h1 {
                font-size: 3.25rem;
            }

            /* 52px */
            h2 {
                font-size: 2.5rem;
            }

            /* 40px */
            h3 {
                font-size: 1.75rem;
            }

            /* 28px */
        }

        a {
            text-decoration: none;
            color: var(--color-primary);
            transition: color var(--transition-speed-fast) var(--transition-timing-function);
        }

        a:hover,
        a:focus {
            color: var(--color-primary-dark);
            outline: 2px solid transparent;
            /* Untuk aksesibilitas fokus kustom */
            outline-offset: 2px;
        }

        body.dark-mode a {
            color: var(--color-primary-light);
        }

        body.dark-mode a:hover,
        body.dark-mode a:focus {
            color: var(--text-light);
        }


        button,
        input,
        select,
        textarea {
            font-family: inherit;
            font-size: 1rem;
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius-md);
            padding: calc(var(--spacing-unit) * 0.6) calc(var(--spacing-unit) * 0.8);
        }

        body.dark-mode button,
        body.dark-mode input,
        body.dark-mode select,
        body.dark-mode textarea {
            background-color: var(--bg-dark-alt);
            border-color: var(--border-dark);
            color: var(--text-light);
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.3);
        }

        img,
        video {
            max-width: 100%;
            height: auto;
            display: block;
        }

        /* --- Sistem Grid dan Flexbox Utilities yang Ditingkatkan --- */
        .container {
            width: 100%;
            max-width: var(--max-width-container);
            margin-left: auto;
            margin-right: auto;
            padding-left: var(--spacing-unit);
            padding-right: var(--spacing-unit);
        }

        .grid {
            display: grid;
            gap: calc(var(--spacing-unit) * 1.5);
        }

        /* Kolom responsif dengan auto-fit dan minmax untuk "fancy grid" */
        .grid-auto-fit {
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 280px), 1fr));
        }

        @media (min-width: 640px) {

            /* sm */
            .sm\:grid-cols-2 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 768px) {

            /* md */
            .md\:grid-cols-2 {
                grid-template-columns: repeat(2, 1fr);
            }

            .md\:grid-cols-3 {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1024px) {

            /* lg */
            .lg\:grid-cols-3 {
                grid-template-columns: repeat(3, 1fr);
            }

            .lg\:grid-cols-4 {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .flex {
            display: flex;
        }

        .flex-wrap {
            flex-wrap: wrap;
        }

        .flex-col {
            flex-direction: column;
        }

        .items-center {
            align-items: center;
        }

        .items-start {
            align-items: flex-start;
        }

        .items-end {
            align-items: flex-end;
        }

        .justify-center {
            justify-content: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-around {
            justify-content: space-around;
        }

        .justify-start {
            justify-content: flex-start;
        }

        .justify-end {
            justify-content: flex-end;
        }

        .gap-1 {
            gap: calc(var(--spacing-unit) * 0.25);
        }

        .gap-2 {
            gap: calc(var(--spacing-unit) * 0.5);
        }

        .gap-4 {
            gap: var(--spacing-unit);
        }

        .gap-6 {
            gap: calc(var(--spacing-unit) * 1.5);
        }

        .gap-8 {
            gap: calc(var(--spacing-unit) * 2);
        }

        /* --- Komponen UI yang Ditingkatkan --- */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: calc(var(--spacing-unit) * 0.75) calc(var(--spacing-unit) * 1.5);
            border-radius: var(--border-radius-md);
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            border: none;
            /* Tombol utama biasanya tidak punya border eksplisit */
            transition: background-color var(--transition-speed-fast) var(--transition-timing-function),
                transform var(--transition-speed-fast) var(--transition-timing-function),
                box-shadow var(--transition-speed-fast) var(--transition-timing-function);
            box-shadow: var(--shadow-sm);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn:active {
            transform: translateY(0px);
        }

        .btn:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.4);
        }

        .btn--primary {
            background-color: var(--color-primary);
            color: var(--text-light);
        }

        .btn--primary:hover {
            background-color: var(--color-primary-dark);
        }

        body.dark-mode .btn--primary {
            background-color: var(--color-primary-light);
            color: var(--text-dark);
        }

        body.dark-mode .btn--primary:hover {
            background-color: var(--color-primary);
        }


        .btn--secondary {
            background-color: var(--bg-light-alt);
            color: var(--text-dark);
            border: 1px solid var(--border-light);
        }

        .btn--secondary:hover {
            background-color: #e2e8f0;
        }

        /* sedikit lebih gelap dari bg-light-alt */
        body.dark-mode .btn--secondary {
            background-color: var(--bg-dark-alt);
            color: var(--text-light);
            border-color: var(--border-dark);
        }

        body.dark-mode .btn--secondary:hover {
            background-color: #374151;
        }

        /* sedikit lebih terang dari bg-dark-alt */

        .btn--accent {
            background-color: var(--color-accent);
            color: var(--text-light);
        }

        .btn--accent:hover {
            background-color: var(--color-accent-dark);
        }

        .btn--icon {
            padding: calc(var(--spacing-unit) * 0.5);
            min-width: auto;
            /* Override jika ada */
        }

        .btn--icon i {
            font-size: 1.25rem;
        }

        .card {
            background-color: var(--bg-light-alt);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            transition: transform var(--transition-speed-medium) var(--transition-timing-function),
                box-shadow var(--transition-speed-medium) var(--transition-timing-function);
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: var(--shadow-fancy);
        }

        body.dark-mode .card {
            background-color: var(--bg-dark-alt);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            /* Shadow di dark mode mungkin perlu penyesuaian */
        }

        body.dark-mode .card:hover {
            box-shadow: 0px 8px 20px rgba(16, 185, 129, 0.3), 0px 4px 8px rgba(0, 0, 0, 0.2);
        }

        .card__image-container {
            width: 100%;
            aspect-ratio: 16 / 10;
            /* Menjaga rasio aspek gambar */
            overflow: hidden;
        }

        .card__image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* Gambar akan mengisi kontainer tanpa distorsi */
            transition: transform var(--transition-speed-slow) var(--transition-timing-function);
        }

        .card:hover .card__image {
            transform: scale(1.05);
        }

        .card__content {
            padding: var(--spacing-unit);
            flex-grow: 1;
            /* Konten mengisi sisa ruang di card */
            display: flex;
            flex-direction: column;
        }

        .card__title {
            font-size: 1.25rem;
            margin-bottom: calc(var(--spacing-unit) * 0.5);
            color: var(--color-secondary);
        }

        body.dark-mode .card__title {
            color: var(--color-primary-light);
        }

        .card__price {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: calc(var(--spacing-unit) * 0.25);
        }

        body.dark-mode .card__price {
            color: var(--color-primary-light);
        }

        .card__location {
            font-size: 0.9rem;
            color: var(--text-muted-light);
            margin-bottom: var(--spacing-unit);
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-unit) * 0.25);
        }

        body.dark-mode .card__location {
            color: var(--text-muted-dark);
        }

        .card__footer {
            margin-top: auto;
            /* Mendorong footer ke bawah card */
            padding-top: var(--spacing-unit);
        }

        /* --- Navbar yang Lebih Fancy --- */
        .navbar {
            background-color: rgba(255, 255, 255, 0.85);
            /* Semi-transparan */
            backdrop-filter: blur(10px);
            /* Efek glassmorphism */
            -webkit-backdrop-filter: blur(10px);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            padding: calc(var(--spacing-unit) * 0.75) 0;
            transition: background-color var(--transition-speed-medium) var(--transition-timing-function),
                box-shadow var(--transition-speed-medium) var(--transition-timing-function);
        }

        body.dark-mode .navbar {
            background-color: rgba(31, 41, 55, 0.85);
            /* Semi-transparan dark */
        }

        .navbar__container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .navbar__brand {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--color-secondary);
            /* Lebih kuat dari teks biasa */
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-unit) * 0.5);
        }

        .navbar__brand i {
            color: var(--color-primary);
        }

        body.dark-mode .navbar__brand {
            color: var(--color-primary-light);
        }

        .nav__list {
            display: flex;
            gap: calc(var(--spacing-unit) * 0.5);
            /* Lebih rapat sedikit untuk desktop */
            list-style: none;
        }

        .nav__item a {
            padding: calc(var(--spacing-unit) * 0.5) var(--spacing-unit);
            border-radius: var(--border-radius-md);
            font-weight: 500;
            transition: background-color var(--transition-speed-fast) var(--transition-timing-function),
                color var(--transition-speed-fast) var(--transition-timing-function);
            color: var(--text-dark);
        }

        .nav__item a:hover,
        .nav__item a.active {
            background-color: var(--color-primary);
            color: var(--text-light) !important;
            /* Penting untuk override default link color */
        }

        body.dark-mode .nav__item a {
            color: var(--text-light);
        }

        body.dark-mode .nav__item a:hover,
        body.dark-mode .nav__item a.active {
            background-color: var(--color-primary-light);
            color: var(--text-dark) !important;
        }

        .mobile-menu-button {
            display: none;
        }

        /* Akan diatur oleh JS untuk muncul di mobile */
        .mobile-nav {
            display: none;
            /* Defaultnya tersembunyi */
            flex-direction: column;
            position: absolute;
            top: 100%;
            /* Tepat di bawah navbar */
            left: 0;
            right: 0;
            background-color: var(--bg-light-alt);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-unit);
            border-bottom-left-radius: var(--border-radius-lg);
            border-bottom-right-radius: var(--border-radius-lg);
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transform: translateY(-10px);
            transition: max-height var(--transition-speed-medium) ease-out,
                opacity var(--transition-speed-medium) ease-out,
                transform var(--transition-speed-medium) ease-out;
        }

        .mobile-nav.open {
            display: flex;
            max-height: 80vh;
            /* Batas tinggi menu mobile */
            opacity: 1;
            transform: translateY(0);
        }

        body.dark-mode .mobile-nav {
            background-color: var(--bg-dark-alt);
        }

        .mobile-nav .nav__item {
            width: 100%;
        }

        .mobile-nav .nav__item a {
            display: block;
            width: 100%;
            text-align: left;
            padding: var(--spacing-unit);
        }

        .mobile-nav .btn {
            width: 100%;
            margin-top: var(--spacing-unit);
        }


        /* --- Hero Section yang Lebih Dramatis --- */
        .hero {
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1580587771525-78b9dba3b914?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80&blur=5') no-repeat center center;
            background-size: cover;
            min-height: 85vh;
            /* Lebih tinggi */
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            text-align: center;
            padding: calc(var(--spacing-unit) * 2) var(--spacing-unit);
            position: relative;
            /* Untuk elemen overlay jika diperlukan */
        }

        .hero::before {
            /* Overlay gradient halus tambahan */
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0) 50%);
            z-index: 1;
        }

        .hero__content {
            position: relative;
            /* Agar di atas overlay */
            z-index: 2;
            max-width: 800px;
            /* Batasi lebar konten hero */
        }

        .hero h1 {
            font-size: 3rem;
            /* Lebih besar */
            font-weight: 800;
            color: var(--text-light);
            margin-bottom: var(--spacing-unit);
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.7);
        }

        .hero p {
            font-size: 1.25rem;
            margin-bottom: calc(var(--spacing-unit) * 2);
            max-width: 600px;
            /* Batasi lebar subjudul */
            margin-left: auto;
            margin-right: auto;
            text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.5);
        }

        @media (min-width: 768px) {
            .hero h1 {
                font-size: 4.5rem;
            }

            .hero p {
                font-size: 1.5rem;
            }
        }

        .hero__form {
            background-color: rgba(255, 255, 255, 0.15);
            /* Lebih transparan, efek kaca */
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            padding: calc(var(--spacing-unit) * 1.5);
            border-radius: var(--border-radius-lg);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
            /* Shadow untuk efek kaca */
            border: 1px solid rgba(255, 255, 255, 0.18);
            display: grid;
            gap: var(--spacing-unit);
            margin-top: calc(var(--spacing-unit) * 2);
        }

        body.dark-mode .hero__form {
            background-color: rgba(17, 24, 39, 0.25);
            /* Dark glass */
            border-color: rgba(255, 255, 255, 0.1);
        }

        @media (min-width: 768px) {
            .hero__form {
                grid-template-columns: 1fr 1fr auto;
                /* Lokasi, Tipe, Tombol Cari */
                align-items: center;
            }
        }

        .hero__form input,
        .hero__form select {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            color: var(--text-dark);
            border: 1px solid transparent;
        }

        body.dark-mode .hero__form input,
        body.dark-mode .hero__form select {
            background-color: rgba(31, 41, 55, 0.8);
            color: var(--text-light);
        }

        .hero__form input::placeholder {
            color: var(--text-muted-light);
        }

        body.dark-mode .hero__form input::placeholder {
            color: var(--text-muted-dark);
        }

        .hero__form .form-group {
            display: flex;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.8);
            /* Background untuk ikon dan input menyatu */
            border-radius: var(--border-radius-md);
            padding-left: var(--spacing-unit);
        }

        body.dark-mode .hero__form .form-group {
            background-color: rgba(31, 41, 55, 0.8);
        }

        .hero__form .form-group i {
            color: var(--text-muted-light);
            margin-right: calc(var(--spacing-unit) * 0.5);
        }

        body.dark-mode .hero__form .form-group i {
            color: var(--text-muted-dark);
        }

        .hero__form .form-group input,
        .hero__form .form-group select {
            background-color: transparent;
            /* Input/select sekarang transparan di dalam .form-group */
            border: none;
            padding-left: 0;
        }

        .hero__form .btn--primary {
            padding: calc(var(--spacing-unit) * 0.85) calc(var(--spacing-unit) * 2);
            /* Sedikit lebih besar */
            width: 100%;
        }

        @media (min-width: 768px) {
            .hero__form .btn--primary {
                width: auto;
            }
        }


        /* --- Section Styling --- */
        .section {
            padding-top: calc(var(--spacing-unit) * 3);
            padding-bottom: calc(var(--spacing-unit) * 3);
        }

        .section--highlight {
            background-color: var(--bg-light-alt);
        }

        body.dark-mode .section--highlight {
            background-color: var(--bg-dark-alt);
        }

        .section__header {
            text-align: center;
            margin-bottom: calc(var(--spacing-unit) * 2.5);
        }

        .section__title {
            font-size: 2.25rem;
            /* Lebih konsisten */
            margin-bottom: calc(var(--spacing-unit) * 0.5);
        }

        .section__subtitle {
            font-size: 1.1rem;
            color: var(--text-muted-light);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        body.dark-mode .section__subtitle {
            color: var(--text-muted-dark);
        }

        /* --- Footer yang Lebih Profesional --- */
        .footer {
            background-color: var(--color-secondary);
            /* Warna hijau tua */
            color: var(--text-light);
            padding: calc(var(--spacing-unit) * 3) 0;
            margin-top: auto;
            /* Memastikan footer menempel di bawah */
        }

        .footer a {
            color: var(--color-primary-light);
            transition: color var(--transition-speed-fast) var(--transition-timing-function);
        }

        .footer a:hover {
            color: var(--text-light);
            text-decoration: underline;
        }

        .footer__grid {
            display: grid;
            gap: calc(var(--spacing-unit) * 2);
        }

        @media (min-width: 768px) {
            .footer__grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }

        .footer__column h5 {
            font-size: 1.1rem;
            color: var(--text-light);
            margin-bottom: var(--spacing-unit);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .footer__column ul {
            list-style: none;
        }

        .footer__column ul li {
            margin-bottom: calc(var(--spacing-unit) * 0.5);
        }

        .footer__socials {
            display: flex;
            gap: var(--spacing-unit);
        }

        .footer__socials a {
            font-size: 1.5rem;
            /* Ikon lebih besar */
        }

        .footer__bottom {
            text-align: center;
            margin-top: calc(var(--spacing-unit) * 2);
            padding-top: calc(var(--spacing-unit) * 1.5);
            border-top: 1px solid var(--border-dark);
            /* Garis pemisah halus */
            font-size: 0.9rem;
            color: var(--text-muted-dark);
        }

        body.dark-mode .footer__bottom {
            color: var(--text-muted-dark);
        }

        /* Tetap, karena background footer sudah gelap */


        /* --- Animasi Halus dan Efek Visual --- */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .animate-fade-in {
            animation: fadeIn var(--transition-speed-slow) var(--transition-timing-function) both;
        }

        .animate-fade-in-up {
            animation: fadeInUp var(--transition-speed-slow) var(--transition-timing-function) both;
        }

        .animate-scale-in {
            animation: scaleIn var(--transition-speed-medium) var(--transition-timing-function) both;
        }

        /* Delay animasi untuk elemen berurutan */
        .stagger-animation>* {
            opacity: 0;
            /* Mulai tidak terlihat */
        }

        .stagger-animation.animate-children>* {
            animation: fadeInUp var(--transition-speed-slow) var(--transition-timing-function) forwards;
        }

        /* JavaScript akan menambahkan kelas .animate-children dan mengatur delay */


        /* --- Scrollbar Kustom yang Fancy --- */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-light);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--color-primary);
            border-radius: var(--border-radius-full);
            border: 2px solid var(--bg-light);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-primary-dark);
        }

        body.dark-mode ::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }

        body.dark-mode ::-webkit-scrollbar-thumb {
            background: var(--color-primary-light);
            border-color: var(--bg-dark);
        }

        body.dark-mode ::-webkit-scrollbar-thumb:hover {
            background: var(--color-primary);
        }

        /* --- Utilitas Aksesibilitas --- */
        .sr-only {
            /* Screen Reader Only */
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Focus visible untuk navigasi keyboard */
        *:focus-visible {
            outline: 3px solid var(--color-accent);
            outline-offset: 2px;
            box-shadow: 0 0 0 5px rgba(245, 158, 11, 0.3);
            /* Sesuai warna accent */
        }

        /* --- Utilitas Tambahan --- */
        .text-center {
            text-align: center;
        }

        .text-left {
            text-align: left;
        }

        .text-right {
            text-align: right;
        }

        .w-full {
            width: 100%;
        }

        .h-full {
            height: 100%;
        }

        .min-h-screen {
            min-height: 100vh;
        }

        .py-1 {
            padding-top: calc(var(--spacing-unit) * 0.25);
            padding-bottom: calc(var(--spacing-unit) * 0.25);
        }

        .py-2 {
            padding-top: calc(var(--spacing-unit) * 0.5);
            padding-bottom: calc(var(--spacing-unit) * 0.5);
        }

        .py-4 {
            padding-top: var(--spacing-unit);
            padding-bottom: var(--spacing-unit);
        }

        .py-8 {
            padding-top: calc(var(--spacing-unit) * 2);
            padding-bottom: calc(var(--spacing-unit) * 2);
        }

        .py-12 {
            padding-top: calc(var(--spacing-unit) * 3);
            padding-bottom: calc(var(--spacing-unit) * 3);
        }

        .py-16 {
            padding-top: calc(var(--spacing-unit) * 4);
            padding-bottom: calc(var(--spacing-unit) * 4);
        }

        .px-1 {
            padding-left: calc(var(--spacing-unit) * 0.25);
            padding-right: calc(var(--spacing-unit) * 0.25);
        }

        .px-2 {
            padding-left: calc(var(--spacing-unit) * 0.5);
            padding-right: calc(var(--spacing-unit) * 0.5);
        }

        .px-4 {
            padding-left: var(--spacing-unit);
            padding-right: var(--spacing-unit);
        }

        .px-8 {
            padding-left: calc(var(--spacing-unit) * 2);
            padding-right: calc(var(--spacing-unit) * 2);
        }

        .mt-1 {
            margin-top: calc(var(--spacing-unit) * 0.25);
        }

        .mt-2 {
            margin-top: calc(var(--spacing-unit) * 0.5);
        }

        .mt-4 {
            margin-top: var(--spacing-unit);
        }

        .mt-8 {
            margin-top: calc(var(--spacing-unit) * 2);
        }

        .mb-1 {
            margin-bottom: calc(var(--spacing-unit) * 0.25);
        }

        .mb-2 {
            margin-bottom: calc(var(--spacing-unit) * 0.5);
        }

        .mb-4 {
            margin-bottom: var(--spacing-unit);
        }

        .mb-8 {
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .mr-2 {
            margin-right: calc(var(--spacing-unit) * 0.5);
        }

        .ml-2 {
            margin-left: calc(var(--spacing-unit) * 0.5);
        }

        /* Responsive Utilities */
        .hidden {
            display: none !important;
        }

        /* Penting untuk override lain */
        @media (max-width: 767px) {

            /* Mobile and smaller tablets */
            .md\:hidden {
                display: none !important;
            }
        }

        @media (min-width: 768px) {

            /* Medium devices (tablets) and up */
            .md\:block {
                display: block !important;
            }

            .md\:flex {
                display: flex !important;
            }

            .md\:grid {
                display: grid !important;
            }

            .hidden-md-up {
                display: none !important;
            }
        }

        /* Loading Spinner */
        .loading-spinner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-speed-medium) ease, visibility var(--transition-speed-medium) ease;
        }

        .loading-spinner-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(255, 255, 255, 0.3);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .initial-loader {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: var(--bg-light);
            color: var(--text-dark);
        }

        body.dark-mode .initial-loader {
            background-color: var(--bg-dark);
            color: var(--text-light);
        }

        .initial-loader .spinner {
            border-color: rgba(0, 0, 0, 0.1);
            border-top-color: var(--color-primary);
        }

        body.dark-mode .initial-loader .spinner {
            border-color: rgba(255, 255, 255, 0.1);
            border-top-color: var(--color-primary-light);
        }

        .initial-loader p {
            margin-top: var(--spacing-unit);
            font-size: 1.1rem;
            font-weight: 500;
        }

        /* Specific Page Styles */
        .property-detail__image {
            width: 100%;
            max-height: 60vh;
            /* Batasi tinggi gambar utama */
            object-fit: cover;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .property-detail__features {
            list-style: none;
            padding: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-unit);
            margin: calc(var(--spacing-unit) * 1.5) 0;
        }

        .property-detail__features li {
            background-color: var(--bg-light-alt);
            padding: var(--spacing-unit);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-unit) * 0.5);
        }

        body.dark-mode .property-detail__features li {
            background-color: var(--bg-dark-alt);
        }

        .property-detail__features i {
            color: var(--color-primary);
            font-size: 1.2rem;
        }

        .property-detail__agent-card {
            background-color: var(--bg-light-alt);
            padding: calc(var(--spacing-unit) * 1.5);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            margin-top: calc(var(--spacing-unit) * 2);
        }

        body.dark-mode .property-detail__agent-card {
            background-color: var(--bg-dark-alt);
        }

        .agent-card__avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: var(--spacing-unit);
            border: 3px solid var(--color-primary);
        }
    </style>
</head>

<body>
    <!-- Root element untuk aplikasi SPA -->
    <div id="app-root">
        <!-- Loader awal saat aplikasi pertama kali dimuat -->
        <div class="initial-loader">
            <div class="spinner"></div>
            <p>Memuat Green Valley Properties...</p>
        </div>
    </div>

    <!-- Overlay untuk loading state antar halaman/aksi -->
    <div id="loading-overlay" class="loading-spinner-overlay">
        <div class="spinner"></div>
    </div>

    <script type="module">
        // --- KONFIGURASI APLIKASI ---
        const CONFIG = {
            appName: "Green Valley Properties",
            defaultPath: '/',
            apiBaseUrl: "https://mock-api.greenvalley.com", // Contoh URL API (tidak digunakan secara nyata di sini)
            geminiApiKey: "YOUR_MOCK_API_KEY_HERE", // Tetap sebagai placeholder, tidak untuk produksi
            themeKey: 'greenValleyTheme'
        };

        // --- MOCK GOOGLE GEN AI SERVICE (Seperti di kode asli, untuk simulasi) ---
        class MockGoogleGenAI {
            constructor(apiKey) {
                this.apiKey = apiKey; // Hanya untuk simulasi
                if (!this.apiKey) console.warn("Kunci API Mock Gemini tidak disetel.");
            }

            async generateContent({ prompt, propertyDetails = null }) {
                await new Promise(resolve => setTimeout(resolve, 600 + Math.random() * 400)); // Simulasi delay jaringan

                let responseText = `Konten AI hasil simulasi untuk prompt: "${String(prompt).substring(0, 50)}...".`;

                if (typeof prompt === 'string') {
                    const lowerPrompt = prompt.toLowerCase();
                    if (lowerPrompt.includes("deskripsi listing properti")) {
                        const prop = propertyDetails || {};
                        const tipe = prop.type || 'properti menawan';
                        const lokasi = prop.location || 'lokasi strategis';
                        const kamar = prop.beds || 'beberapa';
                        const mandi = prop.baths || 'beberapa';
                        const luas = prop.area || 'yang lapang';
                        const harga = prop.price ? `Rp ${prop.price.toLocaleString('id-ID')}` : 'harga menarik';
                        const fasilitas = prop.amenities?.join(', ') || 'berbagai fasilitas modern';

                        responseText = `
                            <h4>‚ú® **Rumah Impian Anda di ${lokasi}!** ‚ú®</h4>
                            <p>Selamat datang di ${tipe} ini, sebuah permata tersembunyi yang menawarkan kombinasi sempurna antara kemewahan dan kenyamanan. Terletak di ${lokasi} yang paling dicari, properti ini adalah oasis kedamaian dan gaya.</p>
                            <p>Dengan <strong>${kamar} kamar tidur</strong> yang luas dan <strong>${mandi} kamar mandi</strong> yang dirancang elegan, setiap sudut rumah ini memancarkan kualitas. Ruang tamu utama memiliki luas <strong>${luas} m¬≤</strong>, memberikan banyak ruang untuk keluarga dan hiburan.</p>
                            <p>Nikmati fasilitas eksklusif termasuk: <em>${fasilitas}</em>. Semua ini bisa menjadi milik Anda dengan harga ${harga}.</p>
                            <p>Jangan lewatkan kesempatan langka ini untuk memiliki surga pribadi Anda. Hubungi kami sekarang untuk jadwal kunjungan eksklusif dan biarkan kami membantu Anda membuka pintu ke kehidupan yang selalu Anda impikan di Green Valley!</p>
                        `;
                    } else if (lowerPrompt.includes("slogan iklan")) {
                        responseText = "Green Valley: Di Sini Impian Rumah Menjadi Kenyataan.";
                    } else if (lowerPrompt.includes("tips membeli properti")) {
                        responseText = `
                            <h5>Tips Cerdas Membeli Properti:</h5>
                            <ul>
                                <li>Tentukan anggaran Anda dengan matang.</li>
                                <li>Riset lokasi secara menyeluruh.</li>
                                <li>Gunakan jasa agen properti terpercaya.</li>
                                <li>Jangan terburu-buru mengambil keputusan.</li>
                            </ul>
                        `;
                    }
                }
                return { text: () => responseText };
            }
        }

        const geminiService = {
            ai: new MockGoogleGenAI(CONFIG.geminiApiKey),
            generateText: async (prompt, propertyDetails = null) => {
                try {
                    const result = await geminiService.ai.generateContent({ prompt, propertyDetails });
                    return result.text();
                } catch (error) {
                    console.error("Kesalahan saat menghasilkan teks dari Mock Gemini:", error);
                    return "<p class='text-red-500'>Maaf, terjadi kesalahan saat menghasilkan konten. Silakan coba lagi nanti.</p>";
                }
            }
        };


        // --- MANAJEMEN STATE APLIKASI ---
        let appState = {
            currentPath: window.location.hash.slice(1) || CONFIG.defaultPath,
            properties: [], // Akan diisi dari data mock
            searchFilters: {
                location: '',
                type: '',
                minPrice: '',
                maxPrice: '',
                beds: ''
            },
            isDarkMode: localStorage.getItem(CONFIG.themeKey) === 'dark' ||
                (!localStorage.getItem(CONFIG.themeKey) && window.matchMedia('(prefers-color-scheme: dark)').matches),
            isLoading: false, // Untuk loading state global
            mobileMenuOpen: false,
            propertyDetailCache: {}, // Cache untuk detail properti
            currentPageTitle: CONFIG.appName,
        };

        // --- DATA MOCK PROPERTI (Lebih beragam dan detail) ---
        const mockProperties = [
            { id: 1, name: 'Villa Azure Dengan Pemandangan Samudra', type: 'Villa', location: 'Bukit Jimbaran, Bali', price: 7500000000, beds: 5, baths: 6, area: 650, image: 'https://images.unsplash.com/photo-1613490493576-7fde63acd811?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8bW9kZXJuJTIwdmlsbGF8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=600&q=60', featured: true, amenities: ['Kolam Renang Pribadi Infinity', 'Bioskop Mini', 'Gym & Spa', 'Pemandangan Laut Lepas', 'Garasi 3 Mobil', 'Taman Tropis Luas'], agent: { name: 'Rizky Pratama', phone: '0812-3456-7890', avatar: 'https://randomuser.me/api/portraits/men/32.jpg' } },
            { id: 2, name: 'Apartemen Urban Chic di Jantung Metropolis', type: 'Apartemen', location: 'SCBD, Jakarta Selatan', price: 3200000000, beds: 2, baths: 2, area: 120, image: 'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8YXBhcnRtZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=600&q=60', featured: true, amenities: ['Akses Lift Pribadi', 'Smart Home System', 'Kolam Renang Rooftop', 'Fitness Center', 'Area BBQ', 'Parkir Basement'], agent: { name: 'Siti Aminah', phone: '0812-9876-5432', avatar: 'https://randomuser.me/api/portraits/women/44.jpg' } },
            { id: 3, name: 'Rumah Keluarga Klasik Elegan', type: 'Rumah', location: 'Pondok Indah, Jakarta Selatan', price: 15000000000, beds: 4, baths: 4, area: 450, image: 'https://images.unsplash.com/photo-1570129477492-45c003edd2be?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8aG91c2V8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=600&q=60', featured: false, amenities: ['Taman Belakang Luas', 'Ruang Kerja', 'Dapur Kering & Basah', 'Garasi 2 Mobil', 'Keamanan 24 Jam'], agent: { name: 'Budi Santoso', phone: '0812-1122-3344', avatar: 'https://randomuser.me/api/portraits/men/35.jpg' } },
            { id: 4, name: 'Studio Minimalis Modern untuk Profesional Muda', type: 'Apartemen', location: 'BSD City, Tangerang', price: 850000000, beds: 1, baths: 1, area: 45, image: 'https://images.unsplash.com/photo-1484154218962-a197022b5858?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTJ8fG1vZGVybiUyMGFwYXJ0bWVudHxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=600&q=60', featured: true, amenities: ['Co-working Space', 'Kolam Renang Bersama', 'Jogging Track', 'Dekat Transportasi Umum'], agent: { name: 'Lina Mariska', phone: '0812-5566-7788', avatar: 'https://randomuser.me/api/portraits/women/30.jpg' } },
            { id: 5, name: 'Townhouse Eksklusif Komunitas Hijau', type: 'Rumah', location: 'Sentul City, Bogor', price: 2100000000, beds: 3, baths: 3, area: 180, image: 'https://images.unsplash.com/photo-1582268611958-ebfd161ef9cf?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTV8fHRvd25ob3VzZXxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=600&q=60', featured: false, amenities: ['Clubhouse Komunitas', 'Taman Bermain Anak', 'Sistem Satu Gerbang', 'Udara Segar Pegunungan'], agent: { name: 'Agus Wijaya', phone: '0812-9988-7766', avatar: 'https://randomuser.me/api/portraits/men/40.jpg' } },
            { id: 6, name: 'Penthouse Mewah Dengan Pemandangan Kota 360¬∞', type: 'Apartemen', location: 'Kuningan, Jakarta Pusat', price: 25000000000, beds: 4, baths: 5, area: 500, image: 'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8N3x8bHV4dXJ5JTIwYXBhcnRtZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=600&q=60', featured: true, amenities: ['Jacuzzi Pribadi', 'Rooftop Garden', 'Layanan Concierge', 'Helipad Access (opsional)', 'Interior Desainer Ternama'], agent: { name: 'Dewi Lestari', phone: '0812-0011-2233', avatar: 'https://randomuser.me/api/portraits/women/50.jpg' } },
        ];
        appState.properties = mockProperties;


        // --- FUNGSI UTILITAS ---
        const utils = {
            // Membuat elemen DOM dengan properti dan anak-anaknya
            createElement: (tag, props = {}, ...children) => {
                const element = document.createElement(tag);
                Object.entries(props).forEach(([key, value]) => {
                    if (key.startsWith('on') && typeof value === 'function') {
                        element.addEventListener(key.substring(2).toLowerCase(), value);
                    } else if (key === 'className') {
                        element.className = value;
                    } else if (key === 'style' && typeof value === 'object') {
                        Object.assign(element.style, value);
                    } else if (key === 'dangerouslySetInnerHTML' && value && typeof value.__html === 'string') {
                        element.innerHTML = value.__html;
                    } else if (value !== null && value !== undefined && value !== false) {
                        element.setAttribute(key, value);
                    }
                });
                children.flat().forEach(child => {
                    if (child instanceof Node) {
                        element.appendChild(child);
                    } else if (child !== null && child !== undefined) {
                        element.appendChild(document.createTextNode(String(child)));
                    }
                });
                return element;
            },
            // Debounce untuk menunda eksekusi fungsi (berguna untuk input atau resize)
            debounce: (func, delay) => {
                let timeout;
                return (...args) => {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(this, args), delay);
                };
            },
            // Throttle untuk membatasi frekuensi eksekusi fungsi (berguna untuk scroll)
            throttle: (func, limit) => {
                let inThrottle;
                return (...args) => {
                    if (!inThrottle) {
                        func.apply(this, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                };
            },
            // Menampilkan atau menyembunyikan overlay loading
            setLoading: (isLoading) => {
                appState.isLoading = isLoading;
                const overlay = document.getElementById('loading-overlay');
                if (overlay) {
                    overlay.classList.toggle('visible', isLoading);
                }
            },
            // Memformat angka menjadi format mata uang Rupiah
            formatCurrency: (amount) => {
                if (typeof amount !== 'number') return 'N/A';
                return `Rp ${amount.toLocaleString('id-ID')}`;
            },
            // Menerapkan animasi stagger pada children
            applyStaggerAnimation: (parentElement, delayIncrement = 100) => {
                if (!parentElement) return;
                const children = Array.from(parentElement.children);
                parentElement.classList.add('animate-children'); // Aktifkan rule CSS
                children.forEach((child, index) => {
                    child.style.animationDelay = `${index * delayIncrement}ms`;
                });
            },
            // Scroll ke atas halaman
            scrollToTop: () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            },
            // Mengupdate judul dokumen
            updateDocumentTitle: (pageTitle) => {
                document.title = `${pageTitle} | ${CONFIG.appName}`;
                appState.currentPageTitle = pageTitle;
            }
        };

        // --- ROUTER SEDERHANA (Berbasis Hash) ---
        const router = {
            routes: {},
            addRoute: (path, component, title) => {
                router.routes[path] = { component, title };
            },
            navigateTo: async (path, params = {}) => {
                utils.setLoading(true);
                // Mengganti placeholder parameter di path
                let targetPath = path;
                for (const key in params) {
                    targetPath = targetPath.replace(`:${key}`, params[key]);
                }
                window.location.hash = targetPath;
                // Tunggu sebentar agar perubahan hash diproses dan renderApp dipanggil
                await new Promise(resolve => setTimeout(resolve, 50));
                utils.scrollToTop(); // Pindah ke atas halaman setelah navigasi
                // set loading false akan dihandle di renderApp setelah konten dimuat
            },
            resolveRoute: () => {
                const rawPath = window.location.hash.slice(1) || CONFIG.defaultPath;
                const pathParts = rawPath.split('?')[0].split('/'); // Abaikan query string untuk pencocokan rute

                for (const routePattern in router.routes) {
                    const routePatternParts = routePattern.split('/');
                    if (routePatternParts.length === pathParts.length) {
                        const params = {};
                        let match = true;
                        for (let i = 0; i < routePatternParts.length; i++) {
                            if (routePatternParts[i].startsWith(':')) {
                                params[routePatternParts[i].slice(1)] = decodeURIComponent(pathParts[i]);
                            } else if (routePatternParts[i] !== pathParts[i]) {
                                match = false;
                                break;
                            }
                        }
                        if (match) {
                            appState.currentPath = routePattern; // Simpan pattern asli, bukan path yang sudah diisi param
                            return { ...router.routes[routePattern], params };
                        }
                    }
                }
                // Jika tidak ada rute yang cocok, arahkan ke 404
                appState.currentPath = '/404';
                return { ...router.routes['/404'], params: {} };
            }
        };

        // --- KOMPONEN-KOMPONEN UI (Fungsi yang mengembalikan elemen DOM) ---

        // Komponen: Navbar
        function NavbarComponent() {
            const { createElement } = utils;
            const navItems = [
                { path: '/', label: 'Beranda', icon: 'fa-solid fa-house-chimney' },
                { path: '/search', label: 'Cari Properti', icon: 'fa-solid fa-magnifying-glass-location' },
                { path: '/about', label: 'Tentang Kami', icon: 'fa-solid fa-users' },
                { path: '/contact', label: 'Hubungi Kami', icon: 'fa-solid fa-envelope' },
            ];

            const desktopNav = createElement('ul', { className: 'nav__list hidden md:flex' },
                ...navItems.map(item =>
                    createElement('li', { className: 'nav__item' },
                        createElement('a', {
                            href: `#${item.path}`,
                            className: appState.currentPath === item.path ? 'active' : '',
                            onClick: (e) => { e.preventDefault(); router.navigateTo(item.path); }
                        }, createElement('i', { className: `${item.icon} mr-2` }), item.label)
                    )
                )
            );

            const mobileNavMenu = createElement('nav', { id: 'mobile-nav-menu', className: 'mobile-nav' });
            const updateMobileNav = () => {
                mobileNavMenu.innerHTML = ''; // Kosongkan dulu
                navItems.forEach(item => {
                    mobileNavMenu.appendChild(
                        createElement('li', { className: 'nav__item' },
                            createElement('a', {
                                href: `#${item.path}`,
                                className: `btn btn--secondary w-full text-left ${appState.currentPath === item.path ? 'active' : ''}`,
                                onClick: (e) => {
                                    e.preventDefault();
                                    router.navigateTo(item.path);
                                    toggleMobileMenu(false); // Tutup menu setelah klik
                                }
                            }, createElement('i', { className: `${item.icon} mr-2` }), item.label)
                        )
                    );
                });
                mobileNavMenu.appendChild(
                    createElement('button', {
                        className: 'btn btn--primary w-full mt-2',
                        onClick: () => {
                            alert('Fitur login/autentikasi belum diimplementasikan dalam aplikasi demo ini.');
                            toggleMobileMenu(false);
                        }
                    }, createElement('i', { className: 'fa-solid fa-right-to-bracket mr-2' }), 'Masuk / Daftar')
                );
                mobileNavMenu.classList.toggle('open', appState.mobileMenuOpen);
            };

            const toggleMobileMenu = (forceState) => {
                appState.mobileMenuOpen = typeof forceState === 'boolean' ? forceState : !appState.mobileMenuOpen;
                updateMobileNav();
            };

            const mobileMenuButton = createElement('button', {
                id: 'mobile-menu-button',
                className: 'btn btn--icon btn--secondary md:hidden',
                onClick: () => toggleMobileMenu(),
                'aria-label': 'Buka Menu Navigasi',
                'aria-expanded': appState.mobileMenuOpen.toString()
            }, createElement('i', { id: 'mobile-menu-icon', className: `fas ${appState.mobileMenuOpen ? 'fa-times' : 'fa-bars'}` }));


            // Panggil updateMobileNav saat pertama kali komponen dibuat untuk mengisi kontennya
            // dan menyesuaikan ikon tombol berdasarkan state awal (meskipun menu ditutup)
            updateMobileNav(); // Ini akan memastikan konten ada saat pertama kali dibuka
            // Set ikon tombol menu mobile dengan benar
            const menuIcon = mobileMenuButton.querySelector('#mobile-menu-icon');
            if (menuIcon) menuIcon.className = `fas ${appState.mobileMenuOpen ? 'fa-times' : 'fa-bars'}`;


            return createElement('header', { className: 'navbar', id: 'main-navbar' },
                createElement('div', { className: 'container navbar__container' },
                    createElement('a', {
                        href: '#/',
                        className: 'navbar__brand',
                        title: `Kembali ke Beranda ${CONFIG.appName}`,
                        onClick: (e) => { e.preventDefault(); router.navigateTo('/'); }
                    },
                        createElement('i', { className: 'fas fa-mountain-city' }), // Ikon yang lebih relevan
                        CONFIG.appName.split(' ')[0] // Hanya kata pertama untuk brand pendek
                    ),
                    desktopNav,
                    createElement('div', { className: 'flex items-center gap-2' },
                        createElement('button', {
                            className: 'btn btn--icon btn--secondary',
                            onClick: () => {
                                appState.isDarkMode = !appState.isDarkMode;
                                document.body.classList.toggle('dark-mode', appState.isDarkMode);
                                localStorage.setItem(CONFIG.themeKey, appState.isDarkMode ? 'dark' : 'light');
                                renderApp(); // Re-render untuk update komponen yang mungkin bergantung pada mode
                            },
                            'aria-label': appState.isDarkMode ? 'Aktifkan Mode Terang' : 'Aktifkan Mode Gelap',
                            title: appState.isDarkMode ? 'Mode Terang' : 'Mode Gelap'
                        }, createElement('i', { className: `fas ${appState.isDarkMode ? 'fa-sun' : 'fa-moon'}` })),
                        createElement('button', {
                            className: 'btn btn--primary hidden md:flex',
                            onClick: () => alert('Fitur login/autentikasi belum diimplementasikan.')
                        }, createElement('i', { className: 'fa-solid fa-right-to-bracket mr-2' }), 'Masuk'),
                        mobileMenuButton
                    )
                ),
                mobileNavMenu // Menu mobile diletakkan di sini
            );
        }

        // Komponen: Footer
        function FooterComponent() {
            const { createElement } = utils;
            const currentYear = new Date().getFullYear();
            return createElement('footer', { className: 'footer' },
                createElement('div', { className: 'container' },
                    createElement('div', { className: 'footer__grid' },
                        createElement('div', { className: 'footer__column' },
                            createElement('h5', {}, CONFIG.appName),
                            createElement('p', { style: { fontSize: '0.9rem', color: 'var(--text-muted-dark)' } }, 'Menemukan properti impian Anda adalah misi kami. Dengan layanan profesional dan daftar properti pilihan, kami siap membantu Anda mengambil langkah selanjutnya.')
                        ),
                        createElement('div', { className: 'footer__column' },
                            createElement('h5', {}, 'Navigasi Cepat'),
                            createElement('ul', {},
                                createElement('li', {}, createElement('a', { href: '#/', onClick: e => { e.preventDefault(); router.navigateTo('/'); } }, 'Beranda')),
                                createElement('li', {}, createElement('a', { href: '#/search', onClick: e => { e.preventDefault(); router.navigateTo('/search'); } }, 'Cari Properti')),
                                createElement('li', {}, createElement('a', { href: '#/about', onClick: e => { e.preventDefault(); router.navigateTo('/about'); } }, 'Tentang Kami')),
                                createElement('li', {}, createElement('a', { href: '#/contact', onClick: e => { e.preventDefault(); router.navigateTo('/contact'); } }, 'Hubungi Kami')),
                                createElement('li', {}, createElement('a', { href: '#/terms', onClick: e => { e.preventDefault(); router.navigateTo('/terms'); } }, 'Syarat & Ketentuan'))
                            )
                        ),
                        createElement('div', { className: 'footer__column' },
                            createElement('h5', {}, 'Hubungi Kami'),
                            createElement('p', { style: { fontSize: '0.9rem', color: 'var(--text-muted-dark)' } }, 'Jl. Properti Impian No. 123, Green Valley City'),
                            createElement('p', { style: { fontSize: '0.9rem', color: 'var(--text-muted-dark)' } }, 'Email: info@greenvalley.com'),
                            createElement('p', { style: { fontSize: '0.9rem', color: 'var(--text-muted-dark)' } }, 'Telepon: (021) 555-0123')
                        ),
                        createElement('div', { className: 'footer__column' },
                            createElement('h5', {}, 'Ikuti Kami'),
                            createElement('div', { className: 'footer__socials' },
                                createElement('a', { href: 'https://facebook.com', target: '_blank', rel: 'noopener noreferrer', title: 'Facebook Green Valley', 'aria-label': 'Kunjungi Facebook kami' }, createElement('i', { className: 'fab fa-facebook-f' })),
                                createElement('a', { href: 'https://twitter.com', target: '_blank', rel: 'noopener noreferrer', title: 'Twitter Green Valley', 'aria-label': 'Kunjungi Twitter kami' }, createElement('i', { className: 'fab fa-twitter' })),
                                createElement('a', { href: 'https://instagram.com', target: '_blank', rel: 'noopener noreferrer', title: 'Instagram Green Valley', 'aria-label': 'Kunjungi Instagram kami' }, createElement('i', { className: 'fab fa-instagram' })),
                                createElement('a', { href: 'https://linkedin.com', target: '_blank', rel: 'noopener noreferrer', title: 'LinkedIn Green Valley', 'aria-label': 'Kunjungi LinkedIn kami' }, createElement('i', { className: 'fab fa-linkedin-in' }))
                            )
                        )
                    ),
                    createElement('div', { className: 'footer__bottom' },
                        createElement('p', {}, `Hak Cipta ¬© ${currentYear} ${CONFIG.appName}. Semua Hak Dilindungi Undang-Undang. Dirancang dengan ‚ù§Ô∏è untuk Anda.`)
                    )
                )
            );
        }

        // Komponen: Kartu Properti
        function PropertyCardComponent({ property, index = 0, animate = false }) {
            const { createElement, formatCurrency } = utils;
            return createElement('article', {
                className: `card ${animate ? 'animate-fade-in-up' : ''}`,
                style: animate ? { animationDelay: `${index * 100}ms` } : {},
                onClick: () => router.navigateTo('/property/:id', { id: property.id }),
                'aria-labelledby': `property-title-${property.id}`
            },
                createElement('div', { className: 'card__image-container' },
                    createElement('img', {
                        src: `${property.image}&random=${property.id}`, // Tambah random query untuk variasi gambar dari Unsplash
                        alt: `Eksterior menawan dari ${property.name}`,
                        className: 'card__image',
                        loading: 'lazy' // Penting untuk performa
                    })
                ),
                createElement('div', { className: 'card__content' },
                    createElement('h3', { id: `property-title-${property.id}`, className: 'card__title truncate' }, property.name), // truncate jika judul panjang
                    createElement('p', { className: 'card__price' }, formatCurrency(property.price)),
                    createElement('p', { className: 'card__location' },
                        createElement('i', { className: 'fas fa-map-marker-alt' }),
                        property.location
                    ),
                    createElement('div', { className: 'flex flex-wrap gap-2 mt-2 text-xs' },
                        createElement('span', { className: 'px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded' }, `${property.beds} KT`),
                        createElement('span', { className: 'px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded' }, `${property.baths} KM`),
                        createElement('span', { className: 'px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded' }, `${property.area} m¬≤`)
                    ),
                    createElement('div', { className: 'card__footer' },
                        createElement('button', { className: 'btn btn--primary w-full' }, 'Lihat Detail')
                    )
                )
            );
        }

        // --- HALAMAN-HALAMAN APLIKASI ---

        // Halaman: Beranda (Home)
        async function HomePage() {
            utils.updateDocumentTitle('Beranda');
            const { createElement, formatCurrency } = utils;

            // Ambil properti unggulan
            const featuredProperties = appState.properties.filter(p => p.featured).slice(0, 3);

            // Elemen untuk menampung hasil AI
            const aiSloganElement = createElement('p', { className: 'text-lg italic text-emerald-300 animate-fade-in', style: { animationDelay: '0.5s' } });
            geminiService.generateText("slogan iklan singkat dan menarik untuk perusahaan properti Green Valley")
                .then(slogan => {
                    aiSloganElement.innerHTML = `<em>"${slogan}"</em>`;
                })
                .catch(() => {
                    aiSloganElement.textContent = "Green Valley: Wujudkan Rumah Impian Anda.";
                });


            // Form pencarian di Hero
            let searchLocation = appState.searchFilters.location || '';
            let searchType = appState.searchFilters.type || '';

            const heroForm = createElement('form', {
                className: 'hero__form animate-fade-in-up',
                style: { animationDelay: '0.7s' },
                onSubmit: (e) => {
                    e.preventDefault();
                    appState.searchFilters = { ...appState.searchFilters, location: searchLocation, type: searchType };
                    router.navigateTo('/search');
                }
            },
                createElement('div', { className: 'form-group' },
                    createElement('i', { className: 'fas fa-map-marker-alt' }),
                    createElement('input', {
                        type: 'text', id: 'hero-location',
                        value: searchLocation,
                        onInput: (e) => searchLocation = e.target.value,
                        placeholder: 'Mis: Jakarta, Bali, Bandung',
                        'aria-label': 'Lokasi Properti'
                    })
                ),
                createElement('div', { className: 'form-group' },
                    createElement('i', { className: 'fas fa-building' }),
                    createElement('select', {
                        id: 'hero-type',
                        value: searchType,
                        onChange: (e) => searchType = e.target.value,
                        'aria-label': 'Tipe Properti'
                    },
                        createElement('option', { value: '' }, 'Semua Tipe'),
                        createElement('option', { value: 'Rumah' }, 'Rumah'),
                        createElement('option', { value: 'Apartemen' }, 'Apartemen'),
                        createElement('option', { value: 'Villa' }, 'Villa'),
                        createElement('option', { value: 'Tanah' }, 'Tanah')
                    )
                ),
                createElement('button', { type: 'submit', className: 'btn btn--primary' },
                    createElement('i', { className: 'fas fa-search mr-2' }), 'Cari Properti'
                )
            );


            const pageContent = createElement('div', {},
                createElement('section', { className: 'hero' },
                    createElement('div', { className: 'hero__content' },
                        createElement('h1', { className: 'animate-fade-in-up' },
                            'Temukan Properti Impian Anda di ',
                            createElement('span', { style: { color: 'var(--color-primary-light)' } }, 'Green Valley')
                        ),
                        createElement('p', { className: 'animate-fade-in-up', style: { animationDelay: '0.3s' } },
                            'Jelajahi koleksi properti eksklusif kami dan temukan tempat yang benar-benar Anda sebut rumah. Pengalaman modern, layanan terpercaya.'
                        ),
                        aiSloganElement,
                        heroForm
                    )
                ),
                createElement('section', { className: 'section', id: 'featured-properties' },
                    createElement('div', { className: 'container' },
                        createElement('div', { className: 'section__header animate-fade-in-up' },
                            createElement('h2', { className: 'section__title' }, 'Properti Unggulan Kami'),
                            createElement('p', { className: 'section__subtitle' }, 'Pilihan terbaik yang dikurasi khusus untuk Anda. Temukan inspirasi untuk rumah idaman berikutnya.')
                        ),
                        featuredProperties.length > 0
                            ? createElement('div', { className: 'grid grid-auto-fit gap-6 lg:gap-8 stagger-animation', ref: el => el && utils.applyStaggerAnimation(el) },
                                ...featuredProperties.map((prop, idx) => PropertyCardComponent({ property: prop, index: idx, animate: false /* dikontrol stagger */ }))
                            )
                            : createElement('p', { className: 'text-center' }, 'Saat ini belum ada properti unggulan.'),
                        createElement('div', { className: 'text-center mt-8 animate-fade-in-up', style: { animationDelay: '0.5s' } },
                            createElement('button', {
                                onClick: () => router.navigateTo('/search'),
                                className: 'btn btn--accent btn--lg' // Tombol lebih besar dan beda warna
                            }, createElement('i', { className: 'fas fa-th-list mr-2' }), 'Lihat Semua Properti')
                        )
                    )
                ),
                // Bagian "Mengapa Memilih Kami"
                createElement('section', { className: 'section section--highlight', id: 'why-us' },
                    createElement('div', { className: 'container' },
                        createElement('div', { className: 'section__header animate-fade-in-up' },
                            createElement('h2', { className: 'section__title' }, 'Mengapa Memilih Green Valley?'),
                            createElement('p', { className: 'section__subtitle' }, 'Kami berkomitmen memberikan pengalaman terbaik dalam perjalanan Anda mencari properti.')
                        ),
                        createElement('div', { className: 'grid md:grid-cols-3 gap-8 stagger-animation', ref: el => el && utils.applyStaggerAnimation(el, 150) },
                            createElement('div', { className: 'text-center p-6' },
                                createElement('i', { className: 'fas fa-award fa-3x text-primary mb-4', style: { color: 'var(--color-primary)' } }),
                                createElement('h4', {}, 'Pilihan Properti Terbaik'),
                                createElement('p', { className: 'text-sm text-muted-light dark:text-muted-dark' }, 'Koleksi properti berkualitas tinggi yang telah diverifikasi dengan cermat.')
                            ),
                            createElement('div', { className: 'text-center p-6' },
                                createElement('i', { className: 'fas fa-headset fa-3x text-primary mb-4', style: { color: 'var(--color-primary)' } }),
                                createElement('h4', {}, 'Layanan Profesional'),
                                createElement('p', { className: 'text-sm text-muted-light dark:text-muted-dark' }, 'Tim agen berpengalaman kami siap membantu Anda di setiap langkah.')
                            ),
                            createElement('div', { className: 'text-center p-6' },
                                createElement('i', { className: 'fas fa-shield-alt fa-3x text-primary mb-4', style: { color: 'var(--color-primary)' } }),
                                createElement('h4', {}, 'Proses Transparan & Aman'),
                                createElement('p', { className: 'text-sm text-muted-light dark:text-muted-dark' }, 'Kami menjunjung tinggi integritas dan keamanan dalam setiap transaksi.')
                            )
                        )
                    )
                ),
                // Bagian Testimonial (Contoh statis)
                createElement('section', { className: 'section', id: 'testimonials' },
                    createElement('div', { className: 'container' },
                        createElement('div', { className: 'section__header animate-fade-in-up' },
                            createElement('h2', { className: 'section__title' }, 'Apa Kata Mereka?'),
                            createElement('p', { className: 'section__subtitle' }, 'Dengarkan pengalaman klien kami yang puas dengan layanan Green Valley Properties.')
                        ),
                        createElement('div', { className: 'grid md:grid-cols-2 gap-8 stagger-animation', ref: el => el && utils.applyStaggerAnimation(el, 150) },
                            createElement('div', { className: 'card p-6' },
                                createElement('p', { className: 'italic mb-4 text-muted-light dark:text-muted-dark' }, '"Proses pembelian rumah pertama saya berjalan sangat lancar berkat Green Valley. Agennya sangat membantu dan sabar menjawab semua pertanyaan saya. Sangat direkomendasikan!"'),
                                createElement('div', { className: 'flex items-center' },
                                    createElement('img', { src: 'https://randomuser.me/api/portraits/women/68.jpg', alt: 'Foto Klien Anisa', className: 'w-12 h-12 rounded-full mr-4' }),
                                    createElement('div', {},
                                        createElement('h5', { className: 'font-semibold' }, 'Anisa Putri'),
                                        createElement('p', { className: 'text-sm text-primary' }, 'Pembeli Rumah, Jakarta')
                                    )
                                )
                            ),
                            createElement('div', { className: 'card p-6' },
                                createElement('p', { className: 'italic mb-4 text-muted-light dark:text-muted-dark' }, '"Menjual apartemen saya melalui Green Valley adalah keputusan tepat. Mereka profesional, cepat, dan mendapatkan harga terbaik untuk saya. Terima kasih Green Valley!"'),
                                createElement('div', { className: 'flex items-center' },
                                    createElement('img', { src: 'https://randomuser.me/api/portraits/men/75.jpg', alt: 'Foto Klien David', className: 'w-12 h-12 rounded-full mr-4' }),
                                    createElement('div', {},
                                        createElement('h5', { className: 'font-semibold' }, 'David Lee'),
                                        createElement('p', { className: 'text-sm text-primary' }, 'Penjual Apartemen, Surabaya')
                                    )
                                )
                            )
                        )
                    )
                )
            );
            utils.setLoading(false);
            return pageContent;
        }

        // Halaman: Pencarian Properti
        async function SearchPage() {
            utils.updateDocumentTitle('Cari Properti');
            utils.setLoading(true); // Set loading true di awal
            const { createElement, formatCurrency } = utils;

            // Filter state local to component, synced with appState.searchFilters
            let localFilters = { ...appState.searchFilters };

            const handleFilterChange = (filterName, value) => {
                localFilters[filterName] = value;
                // Optional: debounce filter application if it's expensive
                applyFilters();
            };

            const applyFilters = utils.debounce(() => {
                appState.searchFilters = { ...localFilters };
                renderApp(); // Re-render the whole page to reflect filter changes
            }, 500);


            const filteredProperties = appState.properties.filter(property => {
                const { location, type, minPrice, maxPrice, beds } = appState.searchFilters;
                let match = true;
                if (location && !property.location.toLowerCase().includes(location.toLowerCase())) match = false;
                if (type && property.type !== type) match = false;
                if (minPrice && property.price < parseInt(minPrice)) match = false;
                if (maxPrice && property.price > parseInt(maxPrice)) match = false;
                if (beds && property.beds < parseInt(beds)) match = false; // Hanya >=
                return match;
            });

            const filterForm = createElement('form', {
                className: 'p-6 mb-8 bg-light-alt dark:bg-dark-alt rounded-lg shadow-lg grid md:grid-cols-3 lg:grid-cols-5 gap-4 items-end',
                id: 'search-filters-form',
                onSubmit: e => e.preventDefault() // Prevent default, filtering is live
            },
                createElement('div', {},
                    createElement('label', { htmlFor: 'filter-location', className: 'block text-sm font-medium mb-1' }, 'Lokasi'),
                    createElement('input', { type: 'text', id: 'filter-location', placeholder: 'cth. Jakarta', value: localFilters.location, onInput: e => handleFilterChange('location', e.target.value), className: 'w-full' })
                ),
                createElement('div', {},
                    createElement('label', { htmlFor: 'filter-type', className: 'block text-sm font-medium mb-1' }, 'Tipe Properti'),
                    createElement('select', { id: 'filter-type', value: localFilters.type, onChange: e => handleFilterChange('type', e.target.value), className: 'w-full' },
                        createElement('option', { value: '' }, 'Semua Tipe'),
                        createElement('option', { value: 'Rumah' }, 'Rumah'),
                        createElement('option', { value: 'Apartemen' }, 'Apartemen'),
                        createElement('option', { value: 'Villa' }, 'Villa'),
                        createElement('option', { value: 'Tanah' }, 'Tanah')
                    )
                ),
                createElement('div', {},
                    createElement('label', { htmlFor: 'filter-beds', className: 'block text-sm font-medium mb-1' }, 'Min. Kamar Tidur'),
                    createElement('select', { id: 'filter-beds', value: localFilters.beds, onChange: e => handleFilterChange('beds', e.target.value), className: 'w-full' },
                        createElement('option', { value: '' }, 'Semua'),
                        createElement('option', { value: '1' }, '1+ KT'),
                        createElement('option', { value: '2' }, '2+ KT'),
                        createElement('option', { value: '3' }, '3+ KT'),
                        createElement('option', { value: '4' }, '4+ KT'),
                        createElement('option', { value: '5' }, '5+ KT')
                    )
                ),
                createElement('div', {},
                    createElement('label', { htmlFor: 'filter-min-price', className: 'block text-sm font-medium mb-1' }, 'Harga Min.'),
                    createElement('input', { type: 'number', id: 'filter-min-price', placeholder: 'Rp', value: localFilters.minPrice, onInput: e => handleFilterChange('minPrice', e.target.value), className: 'w-full', step: 100000000 })
                ),
                createElement('div', {},
                    createElement('label', { htmlFor: 'filter-max-price', className: 'block text-sm font-medium mb-1' }, 'Harga Maks.'),
                    createElement('input', { type: 'number', id: 'filter-max-price', placeholder: 'Rp', value: localFilters.maxPrice, onInput: e => handleFilterChange('maxPrice', e.target.value), className: 'w-full', step: 100000000 })
                )
                // Tombol reset bisa ditambahkan di sini
            );

            const pageContent = createElement('main', { className: 'container py-8 animate-fade-in' },
                createElement('div', { className: 'section__header' },
                    createElement('h1', { className: 'section__title' }, 'Temukan Properti Ideal Anda'),
                    createElement('p', { className: 'section__subtitle' }, `Menampilkan ${filteredProperties.length} properti yang sesuai dengan kriteria Anda. Gunakan filter di bawah untuk menyaring pencarian.`)
                ),
                filterForm,
                filteredProperties.length > 0
                    ? createElement('div', { className: 'grid grid-auto-fit gap-6 lg:gap-8 stagger-animation', ref: el => el && utils.applyStaggerAnimation(el) },
                        ...filteredProperties.map((prop, idx) => PropertyCardComponent({ property: prop, index: idx, animate: false }))
                    )
                    : createElement('div', { className: 'text-center py-16' },
                        createElement('i', { className: 'fas fa-search-minus fa-4x text-gray-400 mb-4' }),
                        createElement('h3', { className: 'text-xl font-semibold mb-2' }, 'Tidak Ada Properti Ditemukan'),
                        createElement('p', { className: 'text-muted-light dark:text-muted-dark' }, 'Coba sesuaikan filter pencarian Anda atau periksa kembali nanti.')
                    )
            );
            utils.setLoading(false);
            return pageContent;
        }

        // Halaman: Detail Properti
        async function PropertyDetailPage({ id }) {
            utils.setLoading(true);
            const propertyId = parseInt(id);
            let property = appState.propertyDetailCache[propertyId];

            if (!property) {
                // Simulasi fetch data jika tidak ada di cache (atau dari appState.properties)
                property = appState.properties.find(p => p.id === propertyId);
                if (property) {
                    appState.propertyDetailCache[propertyId] = property; // Simpan ke cache
                }
            }

            const { createElement, formatCurrency } = utils;

            if (!property) {
                utils.updateDocumentTitle('Properti Tidak Ditemukan');
                utils.setLoading(false);
                return NotFoundPage(); // Atau komponen error khusus
            }

            utils.updateDocumentTitle(property.name);

            // Elemen untuk deskripsi AI
            const aiDescriptionElement = createElement('div', { className: 'prose dark:prose-invert max-w-none mt-6 animate-fade-in-up', style: { animationDelay: '0.5s' } });
            aiDescriptionElement.innerHTML = '<p class="italic text-muted-light dark:text-muted-dark">Memuat deskripsi menarik dari AI...</p>'; // Placeholder

            geminiService.generateText("Buatkan deskripsi listing properti yang menarik dan profesional", property)
                .then(desc => {
                    aiDescriptionElement.innerHTML = desc; // Hati-hati dengan XSS jika sumber tidak tepercaya
                })
                .catch(err => {
                    console.error(err);
                    aiDescriptionElement.innerHTML = `<p>Maaf, tidak dapat memuat deskripsi tambahan saat ini. Berikut detail dasar properti:</p>
                    <p>Properti ${property.type} ini berlokasi di ${property.location}, dengan ${property.beds} kamar tidur dan ${property.baths} kamar mandi. Luas total ${property.area} m¬≤.</p>`;
                });


            const agent = property.agent || { name: 'Agen Green Valley', phone: 'N/A', avatar: 'https://via.placeholder.com/80?text=Agent' };

            const pageContent = createElement('main', { className: 'container py-8 animate-fade-in' },
                createElement('div', { className: 'mb-6' },
                    createElement('button', {
                        onClick: () => window.history.back(), // Lebih baik dari router.navigateTo('/search') karena menjaga history
                        className: 'btn btn--secondary'
                    }, createElement('i', { className: 'fas fa-arrow-left mr-2' }), 'Kembali')
                ),
                createElement('article', { className: 'bg-light-alt dark:bg-dark-alt p-4 md:p-8 rounded-lg shadow-xl' },
                    createElement('div', { className: 'grid md:grid-cols-3 gap-8' },
                        // Kolom Kiri (Gambar Utama & Galeri Mini)
                        createElement('div', { className: 'md:col-span-2' },
                            createElement('img', {
                                src: `${property.image}&w=1200&h=800`, // Gambar lebih besar
                                alt: `Pemandangan utama ${property.name}`,
                                className: 'property-detail__image animate-scale-in'
                            }),
                            // Placeholder untuk galeri mini
                            createElement('div', { className: 'grid grid-cols-3 sm:grid-cols-4 gap-2 mt-4' },
                                ...[1, 2, 3, 4].map(i => createElement('img', {
                                    src: `https://picsum.photos/seed/prop${property.id}_img${i}/200/150`,
                                    alt: `Detail gambar ${i} dari ${property.name}`,
                                    className: 'rounded-md object-cover aspect-video cursor-pointer hover:opacity-80 transition-opacity',
                                    loading: 'lazy'
                                }))
                            )
                        ),
                        // Kolom Kanan (Info Properti & Agen)
                        createElement('div', { className: 'md:col-span-1' },
                            createElement('h1', { className: 'text-3xl md:text-4xl font-bold mb-2 animate-fade-in-up' }, property.name),
                            createElement('p', { className: 'text-lg text-muted-light dark:text-muted-dark mb-1 animate-fade-in-up', style: { animationDelay: '0.1s' } },
                                createElement('i', { className: 'fas fa-map-marker-alt mr-2 text-primary' }), property.location
                            ),
                            createElement('p', { className: 'text-2xl md:text-3xl font-bold text-primary mb-6 animate-fade-in-up', style: { animationDelay: '0.2s' } }, formatCurrency(property.price)),

                            createElement('h4', { className: 'text-xl font-semibold mb-2 mt-4' }, 'Detail Properti:'),
                            createElement('ul', { className: 'property-detail__features animate-fade-in-up', style: { animationDelay: '0.3s' } },
                                createElement('li', {}, createElement('i', { className: 'fas fa-bed' }), `${property.beds} Kamar Tidur`),
                                createElement('li', {}, createElement('i', { className: 'fas fa-bath' }), `${property.baths} Kamar Mandi`),
                                createElement('li', {}, createElement('i', { className: 'fas fa-ruler-combined' }), `${property.area} m¬≤ Luas Bangunan`),
                                createElement('li', {}, createElement('i', { className: 'fas fa-home' }), `Tipe: ${property.type}`)
                            ),

                            createElement('h4', { className: 'text-xl font-semibold mb-2 mt-6' }, 'Fasilitas Unggulan:'),
                            createElement('ul', { className: 'list-disc list-inside pl-1 space-y-1 text-muted-light dark:text-muted-dark animate-fade-in-up', style: { animationDelay: '0.4s' } },
                                ...(property.amenities || []).map(item => createElement('li', {}, item))
                            ),

                            aiDescriptionElement, // Deskripsi dari AI

                            createElement('div', { className: 'property-detail__agent-card mt-8 animate-fade-in-up', style: { animationDelay: '0.6s' } },
                                createElement('h4', { className: 'text-xl font-semibold mb-4 text-center' }, 'Hubungi Agen Kami'),
                                createElement('div', { className: 'flex items-center mb-4' },
                                    createElement('img', { src: agent.avatar, alt: `Foto agen ${agent.name}`, className: 'agent-card__avatar' }),
                                    createElement('div', {},
                                        createElement('h5', { className: 'text-lg font-semibold' }, agent.name),
                                        createElement('p', { className: 'text-sm text-primary' }, 'Agen Properti Profesional')
                                    )
                                ),
                                createElement('a', {
                                    href: `tel:${agent.phone.replace(/\D/g, '')}`,
                                    className: 'btn btn--primary w-full mb-2'
                                },
                                    createElement('i', { className: 'fas fa-phone-alt mr-2' }), `Telepon: ${agent.phone}`
                                ),
                                createElement('a', {
                                    href: `https://wa.me/${agent.phone.replace(/\D/g, '')}?text=${encodeURIComponent(`Halo ${agent.name}, saya tertarik dengan properti ${property.name} (ID: ${property.id}) yang ada di Green Valley.`)}`,
                                    target: '_blank',
                                    rel: 'noopener noreferrer',
                                    className: 'btn btn--secondary w-full'
                                },
                                    createElement('i', { className: 'fab fa-whatsapp mr-2' }), 'Chat via WhatsApp'
                                )
                            )
                        )
                    )
                )
            );
            utils.setLoading(false);
            return pageContent;
        }

        // Halaman: Tentang Kami
        async function AboutPage() {
            utils.updateDocumentTitle('Tentang Kami');
            utils.setLoading(true);
            const { createElement } = utils;

            // Konten dari AI (simulasi)
            const aiMissionElement = createElement('div', { className: 'prose dark:prose-invert max-w-none mt-4' });
            geminiService.generateText("visi dan misi perusahaan properti Green Valley yang inspiratif dan profesional dalam 2 paragraf")
                .then(text => aiMissionElement.innerHTML = text)
                .catch(() => aiMissionElement.innerHTML = "<p>Visi kami adalah menjadi mitra properti terdepan yang dikenal karena integritas, inovasi, dan kepuasan pelanggan. Misi kami adalah menyediakan solusi properti yang komprehensif dan personal, membantu setiap klien menemukan properti impian mereka dengan pengalaman yang tak terlupakan.</p>");


            const pageContent = createElement('main', { className: 'container py-12 animate-fade-in' },
                createElement('div', { className: 'section__header mb-12' },
                    createElement('h1', { className: 'section__title' }, 'Tentang Green Valley Properties'),
                    createElement('p', { className: 'section__subtitle' }, 'Lebih dari sekadar agen properti, kami adalah mitra Anda dalam mewujudkan impian hunian.')
                ),

                createElement('div', { className: 'grid md:grid-cols-2 gap-12 items-center mb-12' },
                    createElement('div', { className: 'animate-fade-in-up' },
                        createElement('h2', { className: 'text-2xl font-semibold mb-4' }, 'Kisah Kami'),
                        createElement('p', { className: 'mb-4 text-muted-light dark:text-muted-dark' },
                            'Didirikan dengan semangat untuk menghubungkan orang dengan tempat tinggal ideal mereka, Green Valley Properties telah tumbuh menjadi nama tepercaya di industri real estat. Kami percaya bahwa rumah adalah fondasi kebahagiaan, dan kami berdedikasi untuk membuat proses pencarian dan kepemilikan properti menjadi pengalaman yang positif dan memuaskan.'
                        ),
                        createElement('p', { className: 'text-muted-light dark:text-muted-dark' },
                            'Tim kami terdiri dari para profesional berpengalaman yang memiliki pengetahuan pasar mendalam dan komitmen tak tergoyahkan terhadap layanan pelanggan. Kami bangga dengan pendekatan personal kami, memahami kebutuhan unik setiap klien dan memberikan solusi yang disesuaikan.'
                        ),
                        aiMissionElement
                    ),
                    createElement('div', { className: 'animate-scale-in', style: { animationDelay: '0.2s' } },
                        createElement('img', {
                            src: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8OHx8cmVhbCUyMGVzdGF0ZSUyMGFnZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=70',
                            alt: 'Tim Green Valley Properties sedang berdiskusi',
                            className: 'rounded-lg shadow-xl w-full h-auto object-cover'
                        })
                    )
                ),

                createElement('div', { className: 'section--highlight py-12 rounded-lg' },
                    createElement('h2', { className: 'text-2xl font-semibold text-center mb-8' }, 'Tim Profesional Kami'),
                    createElement('div', { className: 'grid sm:grid-cols-2 lg:grid-cols-4 gap-8 stagger-animation', ref: el => el && utils.applyStaggerAnimation(el, 100) },
                        // Contoh anggota tim
                        ...[
                            { name: 'Dr. Amanda Sari', role: 'CEO & Founder', avatar: 'https://randomuser.me/api/portraits/women/1.jpg', delay: '0.1s' },
                            { name: 'Bambang Wijaya', role: 'Head of Sales', avatar: 'https://randomuser.me/api/portraits/men/2.jpg', delay: '0.2s' },
                            { name: 'Citra Kirana', role: 'Marketing Director', avatar: 'https://randomuser.me/api/portraits/women/3.jpg', delay: '0.3s' },
                            { name: 'Dharma Putra', role: 'Lead Property Analyst', avatar: 'https://randomuser.me/api/portraits/men/4.jpg', delay: '0.4s' }
                        ].map(member =>
                            createElement('div', { className: 'text-center animate-fade-in-up', style: { animationDelay: member.delay } },
                                createElement('img', { src: member.avatar, alt: `Foto ${member.name}`, className: 'w-32 h-32 rounded-full mx-auto mb-4 shadow-md border-4 border-primary-light' }),
                                createElement('h5', { className: 'text-lg font-semibold' }, member.name),
                                createElement('p', { className: 'text-sm text-primary' }, member.role)
                            )
                        )
                    )
                )
            );
            utils.setLoading(false);
            return pageContent;
        }

        // Halaman: Kontak
        async function ContactPage() {
            utils.updateDocumentTitle('Hubungi Kami');
            utils.setLoading(true);
            const { createElement } = utils;

            const handleSubmit = async (event) => {
                event.preventDefault();
                utils.setLoading(true);
                const formData = new FormData(event.target);
                const name = formData.get('name');
                const email = formData.get('email');
                const message = formData.get('message');

                // Simulasi pengiriman
                await new Promise(resolve => setTimeout(resolve, 1500));
                utils.setLoading(false);
                alert(`Terima kasih, ${name}! Pesan Anda telah diterima. Kami akan segera menghubungi Anda melalui ${email}.`);
                event.target.reset();
            };

            const pageContent = createElement('main', { className: 'container py-12 animate-fade-in' },
                createElement('div', { className: 'section__header mb-12' },
                    createElement('h1', { className: 'section__title' }, 'Hubungi Tim Green Valley'),
                    createElement('p', { className: 'section__subtitle' }, 'Kami siap mendengar dari Anda. Baik pertanyaan, saran, atau diskusi properti, jangan ragu untuk menghubungi kami.')
                ),
                createElement('div', { className: 'grid md:grid-cols-2 gap-12' },
                    // Kolom Form Kontak
                    createElement('div', { className: 'animate-fade-in-up' },
                        createElement('h2', { className: 'text-2xl font-semibold mb-6' }, 'Kirim Pesan Langsung'),
                        createElement('form', { className: 'space-y-6', onSubmit: handleSubmit },
                            createElement('div', {},
                                createElement('label', { htmlFor: 'contact-name', className: 'block text-sm font-medium mb-1' }, 'Nama Lengkap Anda'),
                                createElement('input', { type: 'text', name: 'name', id: 'contact-name', required: true, className: 'w-full', placeholder: 'cth. Budi Doremi' })
                            ),
                            createElement('div', {},
                                createElement('label', { htmlFor: 'contact-email', className: 'block text-sm font-medium mb-1' }, 'Alamat Email Anda'),
                                createElement('input', { type: 'email', name: 'email', id: 'contact-email', required: true, className: 'w-full', placeholder: 'cth. budi@example.com' })
                            ),
                            createElement('div', {},
                                createElement('label', { htmlFor: 'contact-subject', className: 'block text-sm font-medium mb-1' }, 'Subjek Pesan'),
                                createElement('input', { type: 'text', name: 'subject', id: 'contact-subject', className: 'w-full', placeholder: 'cth. Pertanyaan Properti ID #123' })
                            ),
                            createElement('div', {},
                                createElement('label', { htmlFor: 'contact-message', className: 'block text-sm font-medium mb-1' }, 'Pesan Anda'),
                                createElement('textarea', { name: 'message', id: 'contact-message', rows: '5', required: true, className: 'w-full', placeholder: 'Tuliskan pesan detail Anda di sini...' })
                            ),
                            createElement('button', { type: 'submit', className: 'btn btn--primary btn--lg' }, // Tombol lebih besar
                                createElement('i', { className: 'fas fa-paper-plane mr-2' }), 'Kirim Pesan'
                            )
                        )
                    ),
                    // Kolom Info Kontak & Peta
                    createElement('div', { className: 'animate-fade-in-up', style: { animationDelay: '0.2s' } },
                        createElement('h2', { className: 'text-2xl font-semibold mb-6' }, 'Informasi Kontak Lainnya'),
                        createElement('div', { className: 'space-y-4 text-muted-light dark:text-muted-dark' },
                            createElement('div', { className: 'flex items-start gap-3' },
                                createElement('i', { className: 'fas fa-map-marker-alt fa-fw text-xl text-primary mt-1' }),
                                createElement('div', {},
                                    createElement('h5', { className: 'font-semibold text-dark dark:text-light' }, 'Alamat Kantor Pusat:'),
                                    createElement('p', {}, 'Green Valley Tower, Lt. 25, Jl. Properti Sejahtera No. 1, Jakarta Pusat, Indonesia 10220')
                                )
                            ),
                            createElement('div', { className: 'flex items-start gap-3' },
                                createElement('i', { className: 'fas fa-phone-alt fa-fw text-xl text-primary mt-1' }),
                                createElement('div', {},
                                    createElement('h5', { className: 'font-semibold text-dark dark:text-light' }, 'Telepon:'),
                                    createElement('a', { href: 'tel:+62215550123', className: 'hover:underline' }, '(021) 555-0123')
                                )
                            ),
                            createElement('div', { className: 'flex items-start gap-3' },
                                createElement('i', { className: 'fas fa-envelope fa-fw text-xl text-primary mt-1' }),
                                createElement('div', {},
                                    createElement('h5', { className: 'font-semibold text-dark dark:text-light' }, 'Email:'),
                                    createElement('a', { href: 'mailto:info@greenvalley.com', className: 'hover:underline' }, 'info@greenvalley.com')
                                )
                            ),
                            createElement('div', { className: 'flex items-start gap-3' },
                                createElement('i', { className: 'fas fa-clock fa-fw text-xl text-primary mt-1' }),
                                createElement('div', {},
                                    createElement('h5', { className: 'font-semibold text-dark dark:text-light' }, 'Jam Operasional:'),
                                    createElement('p', {}, 'Senin - Jumat: 09:00 - 18:00 WIB'),
                                    createElement('p', {}, 'Sabtu: 10:00 - 15:00 WIB (Show unit by appointment)')
                                )
                            )
                        ),
                        // Placeholder Peta (Idealnya iframe Google Maps, tapi tanpa SVG/eksternal sulit)
                        createElement('div', { className: 'mt-8 rounded-lg overflow-hidden shadow-lg aspect-video bg-gray-200 dark:bg-gray-700 flex items-center justify-center text-gray-500 dark:text-gray-400' },
                            createElement('div', { className: 'text-center' },
                                createElement('i', { className: 'fas fa-map-marked-alt fa-3x mb-2' }),
                                createElement('p', {}, 'Lokasi Peta Kantor Kami')
                            )
                        )
                    )
                )
            );
            utils.setLoading(false);
            return pageContent;
        }


        // Halaman: Syarat & Ketentuan (Contoh halaman statis)
        async function TermsPage() {
            utils.updateDocumentTitle('Syarat & Ketentuan');
            utils.setLoading(true);
            const { createElement } = utils;

            const pageContent = createElement('main', { className: 'container py-12 animate-fade-in' },
                createElement('div', { className: 'section__header mb-8' },
                    createElement('h1', { className: 'section__title' }, 'Syarat dan Ketentuan Penggunaan'),
                    createElement('p', { className: 'section__subtitle' }, 'Harap baca dengan saksama sebelum menggunakan layanan Green Valley Properties.')
                ),
                createElement('div', { className: 'prose dark:prose-invert max-w-none' }, // Kelas 'prose' untuk styling teks panjang
                    createElement('p', {}, 'Selamat datang di situs web Green Valley Properties ("Situs"). Dengan mengakses atau menggunakan Situs ini, Anda setuju untuk terikat oleh Syarat dan Ketentuan ini ("Syarat"). Jika Anda tidak setuju dengan semua Syarat ini, jangan gunakan Situs ini.'),

                    createElement('h3', { className: 'mt-6' }, '1. Penggunaan Situs'),
                    createElement('p', {}, 'Anda setuju untuk menggunakan Situs ini hanya untuk tujuan yang sah dan sesuai dengan semua hukum dan peraturan yang berlaku. Anda tidak boleh menggunakan Situs ini dengan cara apa pun yang dapat merusak, melumpuhkan, membebani secara berlebihan, atau mengganggu Situs atau penggunaan Situs oleh pihak lain.'),

                    createElement('h3', { className: 'mt-6' }, '2. Konten Properti'),
                    createElement('p', {}, 'Informasi properti yang ditampilkan di Situs ini disediakan "sebagaimana adanya" dan "sebagaimana tersedia". Meskipun kami berusaha untuk memastikan keakuratan informasi, Green Valley Properties tidak menjamin kelengkapan, keakuratan, atau keandalan informasi tersebut. Harga dan ketersediaan properti dapat berubah tanpa pemberitahuan.'),
                    createElement('p', {}, 'Semua gambar, denah lantai, dan deskripsi properti bersifat ilustratif dan mungkin tidak sepenuhnya mewakili kondisi properti yang sebenarnya. Anda disarankan untuk melakukan inspeksi langsung dan verifikasi independen terhadap semua informasi sebelum membuat keputusan apa pun.'),

                    createElement('h3', { className: 'mt-6' }, '3. Kekayaan Intelektual'),
                    createElement('p', {}, `Seluruh konten yang terdapat dalam Situs ini, termasuk namun tidak terbatas pada teks, grafis, logo, ikon tombol, gambar, klip audio, unduhan digital, kompilasi data, dan perangkat lunak, adalah milik ${CONFIG.appName} atau pemasok kontennya dan dilindungi oleh undang-undang hak cipta Indonesia dan internasional.`),

                    createElement('h3', { className: 'mt-6' }, '4. Batasan Tanggung Jawab'),
                    createElement('p', {}, `${CONFIG.appName} tidak akan bertanggung jawab atas kerugian atau kerusakan apa pun, baik langsung, tidak langsung, insidental, khusus, konsekuensial, atau punitif, yang timbul dari atau sehubungan dengan penggunaan atau ketidakmampuan Anda untuk menggunakan Situs ini atau informasi yang terkandung di dalamnya.`),

                    createElement('h3', { className: 'mt-6' }, '5. Perubahan Syarat'),
                    createElement('p', {}, `Kami berhak untuk mengubah Syarat ini kapan saja tanpa pemberitahuan sebelumnya. Penggunaan Situs ini secara berkelanjutan setelah perubahan tersebut merupakan penerimaan Anda terhadap Syarat yang telah diubah. Dianjurkan agar Anda meninjau Syarat ini secara berkala.`),

                    createElement('p', { className: 'mt-8' }, `Syarat dan Ketentuan ini terakhir diperbarui pada: ${new Date().toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' })}.`)
                )
            );
            utils.setLoading(false);
            return pageContent;
        }


        // Halaman: 404 Tidak Ditemukan
        async function NotFoundPage() {
            utils.updateDocumentTitle('404 Halaman Tidak Ditemukan');
            utils.setLoading(true);
            const { createElement } = utils;
            const pageContent = createElement('main', { className: 'container flex flex-col items-center justify-center text-center py-16 min-h-[70vh] animate-fade-in' },
                createElement('i', { className: 'fas fa-compass-slash fa-5x text-red-500 mb-6' }),
                createElement('h1', { className: 'text-4xl md:text-6xl font-bold mb-4' }, '404 - Oops!'),
                createElement('h2', { className: 'text-2xl md:text-3xl text-muted-light dark:text-muted-dark mb-6' }, 'Halaman Tidak Ditemukan'),
                createElement('p', { className: 'text-lg mb-8 max-w-md' }, 'Maaf, halaman yang Anda cari sepertinya tersesat atau tidak pernah ada. Mungkin tautannya salah atau halaman telah dipindahkan.'),
                createElement('div', { className: 'flex gap-4' },
                    createElement('button', {
                        onClick: () => window.history.back(),
                        className: 'btn btn--secondary btn--lg'
                    }, createElement('i', { className: 'fas fa-arrow-left mr-2' }), 'Kembali'),
                    createElement('button', {
                        onClick: () => router.navigateTo('/'),
                        className: 'btn btn--primary btn--lg'
                    }, createElement('i', { className: 'fas fa-home mr-2' }), 'Ke Beranda')
                )
            );
            utils.setLoading(false);
            return pageContent;
        }

        // --- STRUKTUR APLIKASI UTAMA ---
        function AppShell() {
            const { createElement } = utils;
            const { component: CurrentPage, params, title } = router.resolveRoute();

            const pageContainer = createElement('div', { id: 'page-content', className: 'flex-grow' });

            // Panggil komponen halaman (yang mungkin async) dan render ke pageContainer
            // Ini adalah bagian penting dari arsitektur SPA untuk memuat konten halaman
            if (CurrentPage) {
                const pageElementPromise = CurrentPage(params || {}); // Halaman bisa jadi async
                if (pageElementPromise instanceof Promise) {
                    pageElementPromise.then(pageElement => {
                        pageContainer.innerHTML = ''; // Kosongkan dulu jika ada konten lama/placeholder
                        pageContainer.appendChild(pageElement);
                        utils.setLoading(false); // Matikan loading setelah konten halaman siap
                    }).catch(error => {
                        console.error("Gagal merender halaman:", error);
                        pageContainer.innerHTML = '';
                        pageContainer.appendChild(NotFoundPage()); // Tampilkan halaman error jika gagal
                        utils.setLoading(false);
                    });
                } else { // Jika komponen halaman sinkron
                    pageContainer.innerHTML = '';
                    pageContainer.appendChild(pageElementPromise);
                    utils.setLoading(false);
                }
            } else {
                // Seharusnya tidak terjadi jika routing 404 sudah benar
                console.error("Tidak ada komponen untuk rute saat ini:", appState.currentPath);
                pageContainer.appendChild(NotFoundPage());
                utils.setLoading(false);
            }


            return createElement('div', { className: 'app-wrapper min-h-screen flex flex-col' },
                NavbarComponent(),
                pageContainer, // Kontainer untuk konten halaman yang dinamis
                FooterComponent()
            );
        }

        // --- INISIALISASI DAN RENDER APLIKASI ---
        const rootElement = document.getElementById('app-root');

        const renderApp = () => {
            // Simpan posisi scroll sebelum render ulang jika perlu (untuk refresh parsial)
            // const scrollX = window.scrollX;
            // const scrollY = window.scrollY;

            // Tampilkan loading global saat render dimulai, terutama jika melibatkan data async
            // utils.setLoading(true); // Dihandle di navigateTo dan resolveRoute

            rootElement.innerHTML = ''; // Hapus konten lama
            rootElement.appendChild(AppShell()); // Render shell aplikasi

            // Apply dark mode class to body
            document.body.classList.toggle('dark-mode', appState.isDarkMode);

            // Update ikon tombol menu mobile setelah render (jika NavbarComponent dirender ulang)
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const menuIcon = document.getElementById('mobile-menu-icon');
            if (mobileMenuButton && menuIcon) {
                mobileMenuButton.setAttribute('aria-expanded', appState.mobileMenuOpen.toString());
                menuIcon.className = `fas ${appState.mobileMenuOpen ? 'fa-times' : 'fa-bars'}`;
            }
            // Update mobile nav visibility
            const mobileNavMenu = document.getElementById('mobile-nav-menu');
            if (mobileNavMenu) {
                mobileNavMenu.classList.toggle('open', appState.mobileMenuOpen);
            }


            // Kembalikan posisi scroll (jika disimpan sebelumnya)
            // window.scrollTo(scrollX, scrollY);

            // Matikan loading global setelah render selesai (jika tidak ada async di page component)
            // utils.setLoading(false); // Ini akan dihandle oleh page component jika dia async
        };


        // Daftarkan Rute-rute Aplikasi
        router.addRoute('/', HomePage, 'Beranda');
        router.addRoute('/search', SearchPage, 'Cari Properti');
        router.addRoute('/property/:id', PropertyDetailPage, 'Detail Properti'); // Title akan di-set dinamis
        router.addRoute('/about', AboutPage, 'Tentang Kami');
        router.addRoute('/contact', ContactPage, 'Hubungi Kami');
        router.addRoute('/terms', TermsPage, 'Syarat & Ketentuan');
        router.addRoute('/404', NotFoundPage, 'Halaman Tidak Ditemukan');


        // Event Listener untuk Perubahan Hash (Navigasi SPA)
        window.addEventListener('hashchange', () => {
            appState.mobileMenuOpen = false; // Selalu tutup menu mobile saat navigasi
            renderApp();
        });

        // Event listener untuk menutup menu mobile jika diklik di luar area menu
        document.addEventListener('click', (event) => {
            const mobileNav = document.getElementById('mobile-nav-menu');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            if (appState.mobileMenuOpen && mobileNav && mobileMenuButton) {
                if (!mobileNav.contains(event.target) && !mobileMenuButton.contains(event.target)) {
                    appState.mobileMenuOpen = false;
                    renderApp(); // Re-render untuk update UI menu
                }
            }
        });


        // Render Aplikasi Pertama Kali
        // Hapus loader awal setelah sedikit delay untuk memastikan CSS dasar sudah termuat
        // dan memberi kesan "smooth loading"
        setTimeout(() => {
            const initialLoader = document.querySelector('.initial-loader');
            if (initialLoader) {
                initialLoader.style.opacity = '0';
                initialLoader.style.transition = 'opacity 0.5s ease';
                setTimeout(() => {
                    initialLoader.remove();
                    renderApp(); // Render aplikasi utama setelah loader hilang
                }, 500);
            } else {
                // Jika tidak ada initial loader (misalnya saat hot reload dev)
                renderApp();
            }
        }, 500); // Sedikit delay untuk efek

    </script>
</body>

</html>