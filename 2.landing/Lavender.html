<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Manajemen Properti V2 - Edisi Fancy</title>
    <!-- Google Fonts: Poppins untuk tipografi modern -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- Font Awesome 6 CDN (Gratis, Non-SVG) untuk ikon yang kaya dan fancy -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* style.css - Versi Fancy, Teroptimasi, dan Sesuai Best Practices */

        /* --- Variabel CSS Global untuk Tema, Layout, dan Konsistensi Desain Fancy --- */
        :root {
            /* Palet Warna Dasar yang Harmonis dan Modern */
            --primary-color: #0070f3;
            /* Biru cerah sebagai warna utama */
            --primary-color-darker: #005bb5;
            /* Varian lebih gelap untuk hover/active state */
            --secondary-color: #6c757d;
            /* Abu-abu netral untuk teks sekunder atau border */
            --accent-color: #ff6b6b;
            /* Warna aksen untuk elemen penting atau call-to-action (mis. hati di footer) */
            --success-color: #28a745;
            /* Hijau untuk notifikasi sukses */
            --warning-color: #ffc107;
            /* Kuning untuk peringatan */
            --danger-color: #dc3545;
            /* Merah untuk error atau aksi destruktif */

            /* Tema Terang (Default) */
            --background-color-light: #f8f9fa;
            /* Latar belakang utama yang cerah dan bersih */
            --text-color-light: #212529;
            /* Warna teks utama dengan kontras tinggi */
            --card-background-light: #ffffff;
            /* Latar belakang kartu, menonjol dari background utama */
            --header-background-light: #ffffff;
            /* Latar belakang header, seringkali sama dengan kartu untuk kesan menyatu */
            --footer-background-light: #e9ecef;
            /* Latar belakang footer, sedikit berbeda untuk demarkasi */
            --border-color-light: #dee2e6;
            /* Warna border yang halus */
            --hover-background-light: #e9ecef;
            /* Warna latar saat hover, memberikan feedback visual */
            --modal-overlay-light: rgba(0, 0, 0, 0.6);
            /* Overlay modal, menciptakan fokus */
            --input-background-light: #ffffff;
            /* Latar belakang input form */
            --input-border-light: #ced4da;
            /* Border input form */

            /* Tema Gelap */
            --background-color-dark: #121212;
            /* Latar belakang sangat gelap, umum untuk mode gelap */
            --text-color-dark: #e0e0e0;
            /* Warna teks terang untuk kontras di mode gelap */
            --card-background-dark: #1e1e1e;
            /* Kartu sedikit lebih terang dari background utama di mode gelap */
            --header-background-dark: #1e1e1e;
            --footer-background-dark: #161616;
            --border-color-dark: #333333;
            --hover-background-dark: #2a2a2a;
            --modal-overlay-dark: rgba(255, 255, 255, 0.15);
            /* Overlay modal lebih terang di mode gelap */
            --input-background-dark: #2c2c2c;
            --input-border-dark: #444444;

            /* Variabel Aktif (Default ke Tema Terang) - Ini akan di-override oleh body.dark-mode */
            --bg-color: var(--background-color-light);
            --text-color: var(--text-color-light);
            --card-bg: var(--card-background-light);
            --header-bg: var(--header-background-light);
            --footer-bg: var(--footer-background-light);
            --border-color: var(--border-color-light);
            --hover-bg: var(--hover-background-light);
            --modal-overlay: var(--modal-overlay-light);
            --input-bg: var(--input-background-light);
            --input-border: var(--input-border-light);
            --button-primary-bg: var(--primary-color);
            --button-primary-text: #ffffff;
            --button-secondary-bg: var(--secondary-color);
            --button-secondary-text: #ffffff;

            /* Spasi & Ukuran - Untuk konsistensi layout dan komponen */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --border-radius-sm: 4px;
            /* Radius border kecil */
            --border-radius-md: 8px;
            /* Radius border medium, umum digunakan */
            --border-radius-lg: 12px;
            /* Radius border besar, untuk kartu atau elemen besar agar lebih fancy */
            --transition-fast: 0.2s ease-out;
            /* Transisi cepat untuk feedback instan */
            --transition-normal: 0.3s ease-out;
            /* Transisi standar untuk animasi halus */

            /* Bayangan (Shadows) - Memberikan kedalaman dan kesan modern */
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);

            /* Font - Menggunakan Google Font Poppins untuk tampilan yang bersih dan modern */
            --font-family-main: 'Poppins', sans-serif;
        }

        /* --- Aktivasi Tema Gelap --- */
        body.dark-mode {
            /* Mengganti nilai variabel global saat tema gelap aktif */
            --bg-color: var(--background-color-dark);
            --text-color: var(--text-color-dark);
            --card-bg: var(--card-background-dark);
            --header-bg: var(--header-background-dark);
            --footer-bg: var(--footer-background-dark);
            --border-color: var(--border-color-dark);
            --hover-bg: var(--hover-background-dark);
            --modal-overlay: var(--modal-overlay-dark);
            --input-bg: var(--input-background-dark);
            --input-border: var(--input-border-dark);
            --button-primary-bg: var(--primary-color-darker);
            /* Tombol primary sedikit lebih gelap agar kontras di mode gelap */
        }

        /* --- Reset Global & Gaya Dasar (Best Practice) --- */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            /* Model box yang lebih intuitif */
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            /* Scroll halus untuk navigasi internal halaman (anchor links) */
            font-size: 16px;
            /* Ukuran font dasar untuk unit `rem`, mendukung aksesibilitas scaling */
        }

        body {
            font-family: var(--font-family-main);
            line-height: 1.6;
            /* Keterbacaan teks yang baik */
            color: var(--text-color);
            background-color: var(--bg-color);
            transition: background-color var(--transition-normal), color var(--transition-normal);
            /* Transisi halus saat ganti tema */
            -webkit-font-smoothing: antialiased;
            /* Rendering font lebih halus di WebKit */
            -moz-osx-font-smoothing: grayscale;
            /* Rendering font lebih halus di Firefox */
            display: flex;
            /* Menggunakan flexbox untuk layout utama aplikasi */
            flex-direction: column;
            min-height: 100vh;
            /* Memastikan body mengisi seluruh tinggi viewport */
        }

        /* .app-container telah dipindahkan ke body untuk struktur yang lebih sederhana */

        .container {
            /* Kontainer utama untuk membatasi lebar konten dan memberikan padding */
            width: 90%;
            max-width: 1200px;
            /* Batas lebar maksimum untuk layar besar */
            margin: 0 auto;
            /* Konten di tengah */
            padding: 0 var(--spacing-md);
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color var(--transition-fast);
        }

        a:hover {
            color: var(--primary-color-darker);
            text-decoration: underline;
            /* Feedback visual standar untuk link */
        }

        ul {
            list-style: none;
            /* Menghilangkan bullet points default */
        }

        img {
            max-width: 100%;
            /* Gambar responsif, tidak meluber dari kontainernya */
            display: block;
            /* Menghilangkan spasi ekstra di bawah gambar inline */
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            margin-bottom: var(--spacing-md);
            font-weight: 600;
            /* Berat font standar untuk heading */
            line-height: 1.3;
        }

        /* --- Header Situs (Elemen Semantik <header>) --- */
        .site-header {
            background-color: var(--header-bg);
            padding: var(--spacing-md) 0;
            box-shadow: var(--shadow-md);
            /* Bayangan untuk memberikan kedalaman */
            position: sticky;
            /* Header tetap terlihat saat scroll */
            top: 0;
            z-index: 900;
            /* Di bawah modal (modal z-index 1000) */
            transition: background-color var(--transition-normal);
        }

        .site-header .container {
            display: flex;
            /* Menggunakan flexbox untuk alignment item header */
            justify-content: space-between;
            /* Judul di kiri, nav & tombol tema di kanan */
            align-items: center;
            flex-wrap: wrap;
            /* Memastikan responsivitas jika item terlalu banyak */
        }

        .site-title {
            font-size: 1.8rem;
            /* Ukuran judul situs yang menonjol */
            font-weight: 700;
            color: var(--primary-color);
            margin: 0;
            /* Menghilangkan margin default dari h1 */
        }

        .site-title i {
            /* Ikon di sebelah judul */
            margin-right: var(--spacing-sm);
        }

        /* Navigasi Utama (Elemen Semantik <nav>) */
        .site-nav ul {
            display: flex;
            gap: var(--spacing-lg);
            /* Jarak antar item navigasi */
        }

        .nav-link {
            font-weight: 500;
            padding: var(--spacing-sm) 0;
            position: relative;
            /* Untuk garis bawah aktif/hover */
            color: var(--text-color);
            transition: color var(--transition-fast);
        }

        .nav-link.active {
            /* Gaya untuk link navigasi yang aktif */
            color: var(--primary-color);
            font-weight: 600;
        }

        .nav-link.active::after,
        .nav-link:hover::after {
            /* Garis bawah muncul saat aktif atau hover */
            width: 100%;
        }

        .nav-link::after {
            /* Styling garis bawah */
            content: '';
            position: absolute;
            left: 0;
            bottom: -2px;
            width: 0;
            /* Awalnya tidak terlihat */
            height: 2px;
            background-color: var(--primary-color);
            transition: width var(--transition-fast) ease-in-out;
            /* Animasi garis bawah */
        }

        /* Tombol Ganti Tema */
        .theme-toggle-button {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 1rem;
            display: flex;
            /* Agar ikon dan teks sejajar */
            align-items: center;
            gap: var(--spacing-sm);
        }

        .theme-toggle-button:hover {
            background-color: var(--hover-bg);
            border-color: var(--primary-color);
            color: var(--primary-color);
            /* Warna berubah untuk feedback hover */
        }

        .theme-toggle-button .icon {
            font-size: 1.2em;
            /* Ikon sedikit lebih besar dari teks */
        }


        /* --- Konten Utama (Area SPA View, Elemen Semantik <main>) --- */
        .site-main {
            flex-grow: 1;
            /* Memastikan <main> mengisi ruang tersedia, mendorong <footer> ke bawah */
            padding: var(--spacing-xl) 0;
            /* Padding atas dan bawah untuk konten utama */
        }

        .page-section {
            /* Setiap "halaman" dalam SPA */
            padding: var(--spacing-lg) 0;
            animation: fadeIn 0.5s ease-out;
            /* Animasi halus saat halaman muncul */
        }

        @keyframes fadeIn {

            /* Definisi animasi fadeIn */
            from {
                opacity: 0;
                transform: translateY(10px);
                /* Sedikit slide dari bawah */
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-header {
            /* Header untuk setiap seksi/halaman */
            margin-bottom: var(--spacing-xl);
            text-align: center;
        }

        .section-title {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: var(--spacing-sm);
        }

        .section-description {
            font-size: 1.1rem;
            color: var(--text-color);
            opacity: 0.8;
            /* Deskripsi sedikit transparan agar tidak terlalu dominan */
            max-width: 700px;
            /* Batasi lebar untuk keterbacaan */
            margin-left: auto;
            margin-right: auto;
        }

        /* --- Tombol (Buttons) - Komponen UI Penting --- */
        .button {
            display: inline-flex;
            /* Agar ikon dan teks sejajar dengan baik */
            align-items: center;
            gap: var(--spacing-sm);
            /* Jarak antara ikon dan teks */
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            border: none;
            /* Tombol modern seringkali tidak memiliki border default */
            text-align: center;
            transition: all var(--transition-fast);
            /* Transisi untuk semua properti (background, transform, shadow) */
            text-decoration: none;
            /* Jika <a> digunakan sebagai tombol */
            line-height: 1;
            /* Mencegah tinggi tombol berbeda karena ikon */
        }

        .button i {
            /* Ikon di dalam tombol */
            font-size: 1.1em;
        }

        .primary-button {
            /* Tombol aksi utama */
            background-color: var(--button-primary-bg);
            color: var(--button-primary-text);
        }

        .primary-button:hover {
            background-color: var(--primary-color-darker);
            transform: translateY(-2px);
            /* Efek mengangkat sedikit saat hover */
            box-shadow: var(--shadow-md);
            /* Bayangan lebih jelas saat hover */
            color: var(--button-primary-text);
            /* Pastikan warna teks tetap */
            text-decoration: none;
        }

        .secondary-button {
            /* Tombol aksi sekunder */
            background-color: var(--button-secondary-bg);
            color: var(--button-secondary-text);
            border: 1px solid var(--button-secondary-bg);
            /* Kadang tombol sekunder punya border */
        }

        .secondary-button:hover {
            background-color: var(--hover-bg);
            color: var(--button-secondary-bg);
            /* Warna teks jadi warna bg awal */
            border-color: var(--button-secondary-bg);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
            text-decoration: none;
        }

        .danger-button {
            /* Tombol untuk aksi berbahaya (mis. hapus) */
            background-color: var(--danger-color);
            color: #fff;
        }

        .danger-button:hover {
            background-color: darkred;
            /* Warna lebih gelap saat hover */
            color: #fff;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }


        /* --- Grid Properti (Menggunakan CSS Grid untuk Layout) --- */
        .controls-bar {
            /* Bar untuk tombol aksi seperti "Tambah Properti" */
            display: flex;
            justify-content: space-between;
            /* Tombol di kanan, filter/search di kiri */
            align-items: center;
            margin-bottom: var(--spacing-xl);
            flex-wrap: wrap;
            /* Responsif jika elemen terlalu banyak */
            gap: var(--spacing-md);
        }

        .search-filter-area {
            /* Placeholder untuk fitur pencarian/filter masa depan */
            display: flex;
            gap: var(--spacing-md);
        }

        .grid-container {
            /* Kontainer untuk kartu-kartu properti */
            display: grid;
            /* Kolom akan menyesuaikan otomatis, minimal 300px, mengisi sisa ruang */
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            /* Jarak antar kartu */
        }

        /* Kartu Properti (Elemen Semantik <article>) */
        .property-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            /* Radius lebih besar untuk tampilan modern */
            overflow: hidden;
            /* Agar gambar tidak meluber dari radius */
            display: flex;
            flex-direction: column;
            /* Konten diatur vertikal */
            transition: transform var(--transition-fast), box-shadow var(--transition-fast), background-color var(--transition-normal);
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            /* Indikasi bahwa kartu bisa diklik untuk detail */
        }

        .property-card:hover {
            transform: translateY(-5px) scale(1.02);
            /* Efek hover yang lebih dinamis dan fancy */
            box-shadow: var(--shadow-lg);
            /* Bayangan lebih kuat saat hover */
        }

        .property-card-image-wrapper {
            /* Wrapper untuk gambar agar bisa diatur tinggi tetap */
            width: 100%;
            height: 220px;
            overflow: hidden;
        }

        .property-card-image-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* Gambar mengisi wrapper tanpa distorsi */
            transition: transform 0.4s ease-out;
            /* Efek zoom halus pada gambar saat kartu di-hover */
        }

        .property-card:hover .property-card-image-wrapper img {
            transform: scale(1.1);
            /* Zoom gambar saat hover */
        }

        .property-card-content {
            padding: var(--spacing-lg);
            flex-grow: 1;
            /* Konten mengisi sisa ruang vertikal kartu */
            display: flex;
            flex-direction: column;
            /* Konten diatur vertikal, aksi di bawah */
        }

        .property-card-content h3 {
            margin-top: 0;
            margin-bottom: var(--spacing-sm);
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-color);
            /* Judul kartu menggunakan warna primer */
        }

        .property-card-content p {
            margin-bottom: var(--spacing-sm);
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .property-card-content p i {
            /* Ikon di dalam info kartu */
            margin-right: var(--spacing-xs);
            color: var(--secondary-color);
        }

        .property-actions {
            /* Area untuk tombol aksi (Edit, Hapus) di kartu */
            display: flex;
            gap: var(--spacing-sm);
            margin-top: auto;
            /* Mendorong tombol aksi ke bagian bawah kartu */
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--border-color);
            /* Garis pemisah halus */
        }

        .property-actions .button {
            flex-grow: 1;
            /* Tombol mengisi ruang horizontal yang tersedia */
            font-size: 0.9rem;
            /* Tombol di kartu sedikit lebih kecil */
            padding: var(--spacing-sm) var(--spacing-md);
        }

        /* --- Laporan Keuangan --- */
        .report-summary {
            /* Ringkasan laporan (Total Pendapatan, dll.) */
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            /* Responsif */
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .report-card {
            /* Kartu untuk setiap item ringkasan */
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            text-align: center;
            transition: background-color var(--transition-normal), transform var(--transition-fast), box-shadow var(--transition-fast);
            box-shadow: var(--shadow-sm);
        }

        .report-card:hover {
            transform: translateY(-3px);
            /* Efek angkat halus */
            box-shadow: var(--shadow-md);
        }

        .report-card i {
            /* Ikon besar di kartu laporan */
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: var(--spacing-md);
        }

        .report-card h3 {
            /* Judul metrik laporan */
            margin-top: 0;
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-color);
            opacity: 0.8;
        }

        .report-value {
            /* Nilai metrik laporan (angka besar) */
            font-size: 2.2rem;
            font-weight: 700;
            margin-top: var(--spacing-sm);
            color: var(--primary-color);
        }

        .transaction-list-container {
            /* Kontainer untuk daftar detail transaksi */
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-sm);
        }

        .transaction-list-container h3 {
            margin-bottom: var(--spacing-lg);
            color: var(--primary-color);
            font-size: 1.5rem;
            text-align: center;
        }

        .transaction-list ul {
            /* Styling untuk daftar transaksi */
            overflow: hidden;
            transition: border-color var(--transition-normal);
        }

        .transaction-list li {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            /* Menggunakan flexbox untuk alignment item transaksi */
            justify-content: space-between;
            align-items: center;
            transition: background-color var(--transition-fast), border-color var(--transition-normal);
        }

        .transaction-list li:last-child {
            border-bottom: none;
            /* Hilangkan border untuk item terakhir */
        }

        .transaction-list li:hover {
            background-color: var(--hover-bg);
            /* Feedback hover */
        }

        .transaction-list li strong {
            color: var(--primary-color);
        }

        .transaction-amount-income {
            /* Warna khusus untuk nominal pendapatan */
            color: var(--success-color);
            font-weight: 600;
        }

        .transaction-amount-expense {
            /* Warna khusus untuk nominal pengeluaran (jika ada) */
            color: var(--danger-color);
            font-weight: 600;
        }

        /* --- Notifikasi --- */
        .notification-container {
            /* Kontainer untuk daftar notifikasi */
            max-width: 800px;
            /* Batasi lebar agar mudah dibaca */
            margin: 0 auto;
        }

        .notification-list {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: border-color var(--transition-normal), background-color var(--transition-normal);
        }

        .notification-item {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            transition: background-color var(--transition-fast);
            display: flex;
            /* Menggunakan flexbox untuk ikon dan teks notifikasi */
            align-items: center;
            gap: var(--spacing-md);
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-item:hover {
            background-color: var(--hover-bg);
        }

        .notification-icon {
            font-size: 1.5rem;
            color: var(--primary-color);
            min-width: 30px;
            /* Agar teks tidak menggeser ikon saat panjang teks berbeda */
            text-align: center;
        }

        .notification-message strong {
            color: var(--primary-color);
        }

        .notification-timestamp {
            /* Timestamp notifikasi, lebih kecil dan halus */
            font-size: 0.85rem;
            color: var(--text-color);
            opacity: 0.7;
            margin-top: var(--spacing-xs);
        }

        /* --- Modal Global (Pop-up) --- */
        .modal {
            display: none;
            /* Default tersembunyi, diubah oleh JS menjadi flex */
            position: fixed;
            /* Tetap di layar saat scroll */
            z-index: 1000;
            /* Di atas semua elemen lain */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            /* Scroll jika konten modal panjang */
            background-color: var(--modal-overlay);
            /* Overlay gelap transparan */
            backdrop-filter: blur(3px);
            /* Efek blur pada background (fancy) */
            -webkit-backdrop-filter: blur(3px);
            /* Dukungan untuk Safari */
            align-items: center;
            /* Vertikal centering untuk konten modal */
            justify-content: center;
            /* Horizontal centering */
            opacity: 0;
            /* Awalnya transparan untuk animasi */
            visibility: hidden;
            /* Awalnya tidak visible */
            transition: opacity var(--transition-normal), visibility var(--transition-normal);
        }

        .modal.active {
            /* Saat modal aktif */
            display: flex;
            /* Harus flex agar align/justify bekerja */
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            /* Konten di dalam modal */
            background-color: var(--card-bg);
            padding: var(--spacing-xl);
            /* Padding besar untuk ruang napas */
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            /* Radius besar untuk tampilan modern */
            width: 90%;
            max-width: 600px;
            /* Batas lebar modal default */
            position: relative;
            box-shadow: var(--shadow-lg);
            /* Bayangan kuat untuk menonjolkan modal */
            transform: scale(0.95);
            /* Awalnya sedikit kecil untuk animasi scale-in */
            transition: background-color var(--transition-normal), border-color var(--transition-normal), transform var(--transition-normal);
        }

        .modal.active .modal-content {
            transform: scale(1);
            /* Animasi scale-in ke ukuran normal */
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
            /* Garis pemisah header modal */
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary-color);
            margin: 0;
        }

        .close-button {
            /* Tombol tutup modal (X) */
            background: transparent;
            border: none;
            color: var(--text-color);
            font-size: 1.8rem;
            /* Ikon tutup yang besar dan mudah diklik */
            font-weight: normal;
            cursor: pointer;
            padding: var(--spacing-xs);
            line-height: 1;
            transition: color var(--transition-fast), transform var(--transition-fast);
        }

        .close-button:hover,
        .close-button:focus {
            color: var(--danger-color);
            /* Warna berubah saat hover/focus */
            transform: rotate(90deg);
            /* Efek rotasi fancy pada ikon tutup */
        }

        /* --- Gaya Formulir (Input, Label, dll.) --- */
        .form-group {
            /* Wrapper untuk setiap pasangan label dan input */
            margin-bottom: var(--spacing-lg);
        }

        .form-group label {
            display: block;
            /* Label di atas input */
            margin-bottom: var(--spacing-sm);
            font-weight: 500;
            color: var(--text-color);
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group input[type="email"],
        .form-group input[type="url"],
        .form-group textarea {
            width: 100%;
            /* Input mengisi lebar kontainer */
            padding: var(--spacing-md);
            border: 1px solid var(--input-border);
            border-radius: var(--border-radius-md);
            background-color: var(--input-bg);
            color: var(--text-color);
            font-size: 1rem;
            transition: border-color var(--transition-fast), background-color var(--transition-normal), color var(--transition-normal), box-shadow var(--transition-fast);
        }

        .form-group input:focus,
        .form-group textarea:focus {
            /* Gaya saat input mendapat fokus */
            outline: none;
            /* Hilangkan outline default browser */
            border-color: var(--primary-color);
            /* Border menjadi warna primer */
            box-shadow: 0 0 0 3px rgba(0, 112, 243, 0.2);
            /* Shadow fokus modern (ala Bootstrap) */
        }

        .form-group input.is-invalid,
        /* Untuk menandai input yang tidak valid (validasi error) */
        .form-group textarea.is-invalid {
            border-color: var(--danger-color);
            /* Border merah untuk error */
        }

        .form-group .error-message {
            /* Pesan error di bawah input */
            display: block;
            color: var(--danger-color);
            font-size: 0.875rem;
            margin-top: var(--spacing-xs);
        }

        /* --- Detail Modal Khusus (Modal untuk Detail Properti) --- */
        #detail-modal .modal-content {
            max-width: 750px;
            /* Modal detail bisa lebih lebar untuk menampilkan lebih banyak info */
        }

        .detail-content-grid {
            /* Menggunakan CSS Grid untuk layout konten detail */
            display: grid;
            grid-template-columns: 1fr;
            /* Default satu kolom untuk mobile */
            gap: var(--spacing-lg);
        }

        @media (min-width: 768px) {

            /* Untuk layar tablet dan lebih besar */
            .detail-content-grid {
                grid-template-columns: 1fr 1fr;
                /* Dua kolom: gambar/peta di kiri, info/booking di kanan */
            }
        }

        .detail-image {
            /* Gambar properti di modal detail */
            width: 100%;
            height: auto;
            max-height: 350px;
            object-fit: cover;
            border-radius: var(--border-radius-lg);
            /* Radius besar */
            margin-bottom: var(--spacing-md);
            box-shadow: var(--shadow-md);
            /* Bayangan halus */
        }

        .detail-info h3 {
            color: var(--primary-color);
            font-size: 1.5rem;
            margin-top: 0;
        }

        .detail-info p {
            margin-bottom: var(--spacing-sm);
        }

        .detail-info p strong {
            font-weight: 600;
        }

        .detail-map-placeholder {
            /* Placeholder untuk peta lokasi (karena tidak boleh SVG atau API eksternal berat) */
            width: 100%;
            height: 250px;
            background-color: var(--hover-bg);
            border: 1px dashed var(--border-color);
            /* Border putus-putus untuk placeholder */
            border-radius: var(--border-radius-lg);
            margin-bottom: var(--spacing-lg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: var(--text-color);
            opacity: 0.7;
            font-style: italic;
            transition: background-color var(--transition-normal), border-color var(--transition-normal), color var(--transition-normal);
        }

        .detail-map-placeholder i {
            /* Ikon peta besar di placeholder */
            font-size: 3rem;
            margin-bottom: var(--spacing-sm);
        }

        #booking-form h4 {
            /* Judul form booking di modal detail */
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-top: var(--spacing-xl);
            /* Jarak dari info properti */
            margin-bottom: var(--spacing-md);
            padding-top: var(--spacing-lg);
            border-top: 1px solid var(--border-color);
            /* Garis pemisah */
        }

        /* --- Pesan Info & Status Pembayaran --- */
        .info-message,
        .status-message {
            /* Styling umum untuk pesan informasi atau status */
            padding: var(--spacing-md) var(--spacing-lg);
            background-color: var(--hover-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            text-align: center;
            margin-top: var(--spacing-lg);
            transition: all var(--transition-normal);
            display: flex;
            /* Untuk ikon dan teks sejajar */
            align-items: center;
            gap: var(--spacing-md);
            justify-content: center;
            /* Teks dan ikon di tengah */
        }

        .info-message i,
        .status-message i {
            font-size: 1.3rem;
        }

        #payment-status {
            /* Div untuk menampilkan status pembayaran (sukses/gagal) */
            margin-top: var(--spacing-lg);
            padding: var(--spacing-md);
            border-radius: var(--border-radius-md);
            text-align: center;
            font-weight: 500;
        }

        /* Styling spesifik untuk status pembayaran sukses */
        .payment-success {
            background-color: #d4edda;
            /* Latar hijau muda */
            color: #155724;
            /* Teks hijau tua */
            border: 1px solid #c3e6cb;
        }

        body.dark-mode .payment-success {
            /* Versi mode gelap */
            background-color: #0f3d1a;
            color: #a3e0b4;
            border-color: #1a5a2a;
        }

        /* Styling spesifik untuk status pembayaran gagal */
        .payment-failure {
            background-color: #f8d7da;
            /* Latar merah muda */
            color: #721c24;
            /* Teks merah tua */
            border: 1px solid #f5c6cb;
        }

        body.dark-mode .payment-failure {
            /* Versi mode gelap */
            background-color: #5a1d24;
            color: #f1aeb5;
            border-color: #7a2830;
        }

        /* --- Footer Situs (Elemen Semantik <footer>) --- */
        .site-footer {
            background-color: var(--footer-bg);
            color: var(--text-color);
            text-align: center;
            padding: var(--spacing-xl) 0;
            /* Padding lebih besar untuk footer */
            margin-top: auto;
            /* Mendorong footer ke bawah jika konten pendek */
            transition: background-color var(--transition-normal), color var(--transition-normal);
            opacity: 0.8;
            /* Footer sedikit transparan untuk kesan halus */
        }

        .site-footer p {
            margin: 0;
            font-size: 0.9rem;
        }

        /* --- Utilitas Tambahan CSS --- */
        .text-center {
            text-align: center !important;
            /* !important jika perlu override */
        }

        .hidden {
            /* Kelas untuk menyembunyikan elemen dengan JavaScript */
            display: none !important;
        }

        .visually-hidden {
            /* Untuk aksesibilitas: sembunyikan visual tapi tetap dibaca screen reader */
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            padding: 0 !important;
            margin: -1px !important;
            overflow: hidden !important;
            clip: rect(0, 0, 0, 0) !important;
            white-space: nowrap !important;
            border: 0 !important;
        }

        /* --- Gaya Responsif (Media Queries) --- */
        /* Tablet (Landscape) dan Desktop Kecil */
        @media (max-width: 992px) {
            .site-title {
                font-size: 1.6rem;
                /* Ukuran judul sedikit lebih kecil */
            }

            .section-title {
                font-size: 2rem;
                /* Ukuran judul seksi sedikit lebih kecil */
            }
        }

        /* Tablet (Portrait) dan Mobile Besar */
        @media (max-width: 768px) {
            .site-header .container {
                /* Header menjadi tumpukan vertikal */
                flex-direction: column;
                gap: var(--spacing-md);
            }

            .site-nav {
                /* Navigasi mengisi lebar penuh */
                width: 100%;
            }

            .site-nav ul {
                /* Item navigasi menjadi tumpukan vertikal */
                flex-direction: column;
                gap: var(--spacing-sm);
                text-align: center;
                /* Teks navigasi di tengah */
                width: 100%;
            }

            .nav-link {
                display: block;
                /* Link navigasi menjadi blok agar bisa di-klik seluruh area */
                padding: var(--spacing-md) 0;
                /* Padding lebih besar untuk tap target */
            }

            .nav-link::after {
                /* Garis bawah di mobile */
                bottom: 0;
            }

            .theme-toggle-button {
                /* Tombol tema mengisi lebar, di tengah */
                width: 100%;
                max-width: 250px;
                margin: 0 auto;
                justify-content: center;
            }

            .grid-container {
                /* Grid properti menjadi satu kolom */
                grid-template-columns: 1fr;
            }

            .modal-content {
                /* Modal sedikit lebih kecil paddingnya di mobile */
                margin: var(--spacing-xl) auto;
                /* Margin atas bawah agar tidak menempel */
                width: 95%;
                /* Modal hampir full width */
                padding: var(--spacing-lg);
            }

            .controls-bar {
                /* Control bar (tombol tambah properti) menjadi vertikal */
                flex-direction: column;
                align-items: stretch;
                /* Tombol jadi full width */
            }

            .controls-bar .primary-button {
                width: 100%;
                justify-content: center;
            }
        }

        /* Mobile Kecil */
        @media (max-width: 480px) {
            html {
                font-size: 15px;
                /* Ukuran font dasar sedikit lebih kecil untuk layar sangat kecil */
            }

            .site-title {
                font-size: 1.4rem;
            }

            .section-title {
                font-size: 1.8rem;
            }

            .section-description {
                font-size: 1rem;
            }

            .report-value {
                /* Nilai laporan juga disesuaikan */
                font-size: 1.8rem;
            }

            .property-actions {
                /* Tombol aksi di kartu properti menjadi vertikal */
                flex-direction: column;
                gap: var(--spacing-sm);
            }

            .property-actions .button {
                width: 100%;
                /* Tombol aksi full width */
            }

            .modal-title {
                font-size: 1.5rem;
                /* Judul modal lebih kecil */
            }

            .button {
                /* Padding tombol umum disesuaikan */
                padding: var(--spacing-md) var(--spacing-lg);
                font-size: 0.95rem;
            }

            .form-group input,
            .form-group textarea {
                /* Padding input form disesuaikan */
                padding: var(--spacing-sm) var(--spacing-md);
            }
        }
    </style>
</head>

<body role="application"> <!-- `role="application"` menandakan ini adalah aplikasi web, bukan dokumen biasa -->
    <!-- Kontainer utama aplikasi, menggunakan flexbox untuk layout header-main-footer -->
    <!-- .app-container telah digabungkan ke body untuk simplifikasi struktur -->

    <header class="site-header" role="banner"> <!-- Elemen semantik untuk header situs -->
        <div class="container">
            <h1 class="site-title"><i class="fas fa-city" aria-hidden="true"></i> Dashboard Properti</h1>
            <nav class="site-nav" role="navigation" aria-label="Navigasi Utama">
                <ul>
                    <li><a href="#properti" class="nav-link active" data-route="properti"><i class="fas fa-building"
                                aria-hidden="true"></i> Properti Saya</a></li>
                    <li><a href="#laporan" class="nav-link" data-route="laporan"><i class="fas fa-chart-line"
                                aria-hidden="true"></i> Laporan Keuangan</a></li>
                    <li><a href="#notifikasi" class="nav-link" data-route="notifikasi"><i class="fas fa-bell"
                                aria-hidden="true"></i> Notifikasi</a></li>
                </ul>
            </nav>
            <button id="theme-toggle" class="theme-toggle-button" aria-label="Ganti ke Mode Gelap">
                <span class="icon"><i class="fas fa-moon" aria-hidden="true"></i></span> <span class="text">Mode
                    Gelap</span>
            </button>
        </div>
    </header>

    <main class="site-main container" role="main" id="main-content-area" aria-live="polite">
        <!-- `aria-live="polite"` memberitahu screen reader bahwa konten di sini bisa berubah -->
        <!-- Konten halaman SPA akan dirender di sini oleh JavaScript -->
        <!-- Placeholder awal, akan diganti oleh router -->
        <section id="loading-placeholder" class="page-section text-center" aria-label="Memuat Konten">
            <i class="fas fa-spinner fa-spin fa-3x" aria-hidden="true"></i>
            <p>Memuat konten, mohon tunggu...</p>
        </section>
    </main>

    <footer class="site-footer" role="contentinfo"> <!-- Elemen semantik untuk footer situs -->
        <div class="container">
            <p>© <span id="current-year"></span> Dashboard Manajemen Properti Modern. Dirancang dengan <i
                    class="fas fa-heart" style="color: var(--accent-color);" aria-label="cinta"></i>.</p>
        </div>
    </footer>

    <!-- Modal untuk Tambah/Edit Properti -->
    <div id="property-modal" class="modal" role="dialog" aria-labelledby="modal-title-property" aria-modal="true"
        tabindex="-1">
        <!-- `tabindex="-1"` agar modal itu sendiri tidak bisa di-fokus secara langsung, fokus akan diatur ke elemen di dalamnya oleh JS -->
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title-property" class="modal-title">Tambah Properti Baru</h2>
                <!-- Judul modal, akan diubah JS -->
                <button class="close-button" aria-label="Tutup Modal Tambah/Edit Properti">×</button>
                <!-- Tombol tutup, "×" adalah karakter times -->
            </div>
            <form id="property-form" novalidate>
                <!-- `novalidate` agar validasi browser default tidak mengganggu validasi JS kustom -->
                <input type="hidden" id="property-id"> <!-- Untuk menyimpan ID properti saat edit -->
                <div class="form-group">
                    <label for="property-name">Nama Properti:</label>
                    <input type="text" id="property-name" name="propertyName" required
                        placeholder="Contoh: Villa Harmoni Puncak">
                    <small class="error-message hidden" id="error-property-name" aria-live="assertive"></small>
                </div>
                <div class="form-group">
                    <label for="property-location">Lokasi:</label>
                    <input type="text" id="property-location" name="propertyLocation" required
                        placeholder="Contoh: Jl. Raya Puncak Km. 10, Bogor">
                    <small class="error-message hidden" id="error-property-location" aria-live="assertive"></small>
                </div>
                <div class="form-group">
                    <label for="property-price">Harga Sewa per Bulan (Rp):</label>
                    <input type="number" id="property-price" name="propertyPrice" required min="0"
                        placeholder="Contoh: 7500000">
                    <small class="error-message hidden" id="error-property-price" aria-live="assertive"></small>
                </div>
                <div class="form-group">
                    <label for="property-image">URL Gambar (Opsional):</label>
                    <input type="url" id="property-image" name="propertyImage"
                        placeholder="https://contoh.com/gambar-properti.jpg">
                    <small class="error-message hidden" id="error-property-image" aria-live="assertive"></small>
                </div>
                <button type="submit" class="button primary-button" id="save-property-button"><i class="fas fa-save"
                        aria-hidden="true"></i> Simpan Properti</button>
            </form>
        </div>
    </div>

    <!-- Modal untuk Detail Properti dan Booking -->
    <div id="detail-modal" class="modal" role="dialog" aria-labelledby="modal-title-detail" aria-modal="true"
        tabindex="-1">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title-detail" class="modal-title">Detail Properti</h2> <!-- Judul akan diisi JS -->
                <button class="close-button" aria-label="Tutup Modal Detail Properti">×</button>
            </div>
            <div id="detail-content-wrapper"> <!-- Wrapper untuk konten detail -->
                <div class="detail-content-grid">
                    <div> <!-- Kolom kiri untuk gambar dan peta -->
                        <img id="detail-image" src="" alt="Gambar Properti" class="detail-image">
                        <div id="detail-map" class="detail-map-placeholder" aria-roledescription="Simulasi Peta Lokasi">
                            <i class="fas fa-map-marked-alt" aria-hidden="true"></i>
                            <p>Simulasi Tampilan Peta Lokasi</p>
                        </div>
                    </div>
                    <div class="detail-info"> <!-- Kolom kanan untuk info dan form booking -->
                        <h3 id="detail-name"></h3> <!-- Nama properti, diisi JS -->
                        <p><i class="fas fa-map-marker-alt" aria-hidden="true"></i> <strong>Lokasi:</strong> <span
                                id="detail-location"></span></p>
                        <p><i class="fas fa-dollar-sign" aria-hidden="true"></i> <strong>Harga Sewa:</strong> <span
                                id="detail-price"></span> per bulan</p>
                        <p id="detail-description-placeholder"><i>Deskripsi lengkap properti akan ditampilkan di sini
                                jika tersedia. Ini adalah contoh teks untuk mengisi ruang dan menunjukkan bagaimana
                                deskripsi yang lebih panjang dapat ditata.</i></p>

                        <form id="booking-form" novalidate>
                            <h4><i class="fas fa-calendar-check" aria-hidden="true"></i> Tertarik? Ajukan Booking
                                Sekarang!</h4>
                            <input type="hidden" id="booking-property-id"> <!-- ID properti untuk booking -->
                            <div class="form-group">
                                <label for="booking-name">Nama Lengkap Anda:</label>
                                <input type="text" id="booking-name" name="bookingName" required
                                    placeholder="Masukkan nama lengkap Anda">
                                <small class="error-message hidden" id="error-booking-name"
                                    aria-live="assertive"></small>
                            </div>
                            <div class="form-group">
                                <label for="booking-email">Alamat Email Anda:</label>
                                <input type="email" id="booking-email" name="bookingEmail" required
                                    placeholder="Contoh: nama@email.com">
                                <small class="error-message hidden" id="error-booking-email"
                                    aria-live="assertive"></small>
                            </div>
                            <div class="form-group">
                                <label for="booking-duration">Durasi Sewa (Bulan):</label>
                                <input type="number" id="booking-duration" name="bookingDuration" required min="1"
                                    placeholder="Minimal 1 bulan">
                                <small class="error-message hidden" id="error-booking-duration"
                                    aria-live="assertive"></small>
                            </div>
                            <button type="submit" class="button primary-button" id="submit-booking-button"><i
                                    class="fas fa-credit-card" aria-hidden="true"></i> Ajukan & Lanjutkan
                                Pembayaran</button>
                        </form>
                    </div>
                </div>
                <!-- Tempat untuk menampilkan status pembayaran, default tersembunyi -->
                <div id="payment-status" class="status-message" style="display: none;" aria-live="assertive"></div>
            </div>
        </div>
    </div>

    <!-- Template untuk setiap halaman SPA. Konten ini akan di-clone dan dimasukkan ke #main-content-area -->
    <template id="properti-page-template">
        <section id="properti" class="page-section" aria-labelledby="properti-section-title">
            <div class="section-header">
                <h2 class="section-title" id="properti-section-title"><i class="fas fa-building-user"
                        aria-hidden="true"></i> Properti Saya</h2>
                <p class="section-description">Kelola daftar properti Anda dengan mudah. Tambahkan, edit, atau hapus
                    properti kapan saja untuk menjaga portofolio Anda tetap aktual dan menarik.</p>
            </div>
            <div class="controls-bar">
                <div class="search-filter-area" role="search" aria-label="Area Pencarian dan Filter Properti">
                    <!-- Fitur pencarian dan filter dapat ditambahkan di sini di masa mendatang -->
                    <p class="visually-hidden">Area untuk filter dan pencarian properti (fitur mendatang).</p>
                </div>
                <button id="add-property-button" class="button primary-button"><i class="fas fa-plus-circle"
                        aria-hidden="true"></i> Tambah Properti Baru</button>
            </div>
            <div class="property-list grid-container" aria-live="polite">
                <!-- Daftar properti akan dimuat di sini oleh JavaScript -->
            </div>
            <p id="no-properties-message" class="info-message hidden"><i class="fas fa-info-circle"
                    aria-hidden="true"></i> Belum ada properti yang terdaftar. Klik tombol "Tambah Properti Baru" untuk
                memulai!</p>
        </section>
    </template>

    <template id="laporan-page-template">
        <section id="laporan" class="page-section" aria-labelledby="laporan-section-title">
            <div class="section-header">
                <h2 class="section-title" id="laporan-section-title"><i class="fas fa-file-invoice-dollar"
                        aria-hidden="true"></i> Laporan Keuangan</h2>
                <p class="section-description">Pantau kinerja finansial properti Anda dengan ringkasan pendapatan dan
                    detail transaksi yang komprehensif dan mudah dipahami.</p>
            </div>
            <div class="report-summary">
                <div class="report-card" aria-label="Total Pendapatan (Simulasi)">
                    <i class="fas fa-wallet" aria-hidden="true"></i>
                    <h3>Total Pendapatan (Simulasi)</h3>
                    <p id="total-revenue" class="report-value">Rp 0</p>
                </div>
                <div class="report-card" aria-label="Transaksi Selesai (Simulasi)">
                    <i class="fas fa-check-circle" aria-hidden="true"></i>
                    <h3>Transaksi Selesai (Simulasi)</h3>
                    <p id="completed-transactions" class="report-value">0</p>
                </div>
                <div class="report-card" aria-label="Properti Aktif">
                    <i class="fas fa-building-circle-check" aria-hidden="true"></i>
                    <h3>Properti Aktif</h3>
                    <p id="active-properties-count" class="report-value">0</p>
                </div>
            </div>
            <div class="transaction-list-container">
                <h3><i class="fas fa-history" aria-hidden="true"></i> Riwayat Transaksi (Simulasi)</h3>
                <ul id="transaction-items" class="transaction-list" aria-live="polite">
                    <!-- Detail transaksi akan dimuat di sini oleh JavaScript -->
                </ul>
                <p id="no-transactions-message" class="info-message hidden"><i class="fas fa-folder-open"
                        aria-hidden="true"></i> Belum ada transaksi yang tercatat untuk ditampilkan.</p>
            </div>
        </section>
    </template>

    <template id="notifikasi-page-template">
        <section id="notifikasi" class="page-section" aria-labelledby="notifikasi-section-title">
            <div class="section-header">
                <h2 class="section-title" id="notifikasi-section-title"><i class="fas fa-bell-concierge"
                        aria-hidden="true"></i> Notifikasi Penting</h2>
                <p class="section-description">Tetap terinformasi dengan semua pesan dan pembaruan penting terkait
                    aktivitas properti, booking, dan akun Anda secara real-time.</p>
            </div>
            <div class="notification-container">
                <ul id="notification-items-list" class="notification-list" aria-live="polite">
                    <!-- Daftar notifikasi akan dimuat di sini oleh JavaScript -->
                </ul>
                <p id="no-notifications-message" class="info-message hidden"><i class="fas fa-comment-slash"
                        aria-hidden="true"></i> Tidak ada notifikasi baru untuk Anda saat ini. Semua aman terkendali!
                </p>
            </div>
        </section>
    </template>

    <script>
        // script.js - Versi Fancy, Teroptimasi, Aman, Reusable, dan Maintainable
        // Ditulis dalam Vanilla JavaScript (Native) untuk Aplikasi SPA Monolith Modern

        // Event listener utama, memastikan DOM telah sepenuhnya dimuat sebelum skrip dijalankan
        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE APLIKASI (Penyimpanan Data Terpusat) ---
            // 'appState' adalah jantung aplikasi, menyimpan semua data dinamis.
            // Perubahan pada state ini akan memicu pembaruan UI.
            let appState = {
                properties: [ // Data contoh properti awal
                    { id: 'prop1', name: 'Apartemen Mewah Elegan Pusat Kota', location: 'Jakarta Pusat, DKI Jakarta', price: 15000000, imageUrl: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8YXBhcnRtZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=60' },
                    { id: 'prop2', name: 'Rumah Minimalis Modern Strategis', location: 'Bandung Kota, Jawa Barat', price: 8000000, imageUrl: 'https://images.unsplash.com/photo-1580587771525-78b9dba3b914?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8aG91c2V8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=800&q=60' },
                    { id: 'prop3', name: 'Studio Nyaman & Stylish Dekat Kampus', location: 'Yogyakarta Kota, DIY', price: 3500000, imageUrl: 'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8c3R1ZGlvJTIwYXBhcnRtZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=60' },
                ],
                transactions: [], // Data transaksi (simulasi), akan diisi saat booking
                notifications: [ // Data notifikasi awal
                    { id: 'notif1', message: 'Selamat datang di Dashboard Manajemen Properti Anda yang baru dan canggih!', type: 'info', timestamp: new Date(Date.now() - 3600000).toISOString() }, // 1 jam lalu
                    { id: 'notif2', message: '<strong>Tips Pro:</strong> Perbarui foto properti secara berkala untuk menarik lebih banyak penyewa.', type: 'warning', timestamp: new Date().toISOString() },
                ],
                currentRoute: '', // Menyimpan rute (halaman) yang sedang aktif
                editingPropertyId: null, // Menyimpan ID properti yang sedang diedit, null jika mode tambah
            };

            // --- KONFIGURASI APLIKASI & NILAI DEFAULT ---
            // 'CONFIG' menyimpan konstanta dan pengaturan yang digunakan di seluruh aplikasi.
            const CONFIG = {
                defaultRoute: 'properti', // Halaman default saat aplikasi dimuat
                defaultImageUrl: 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTV8fHByb3BlcnR5fGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=60&text=Properti+Indah', // URL gambar default jika properti tidak memiliki gambar
                themeStorageKey: 'propertyDashboardTheme_v2_fancy', // Kunci localStorage untuk menyimpan preferensi tema
                notificationIcons: { // Pemetaan jenis notifikasi ke ikon Font Awesome
                    info: 'fas fa-info-circle',
                    success: 'fas fa-check-circle',
                    warning: 'fas fa-exclamation-triangle',
                    error: 'fas fa-times-circle',
                    payment: 'fas fa-credit-card'
                }
            };

            // --- FUNGSI UTILITAS (Pembantu Umum) ---
            // 'UTILS' berisi fungsi-fungsi pembantu yang sering digunakan dan bersifat generik.
            const UTILS = {
                // Memformat angka menjadi format mata uang Rupiah (IDR) yang rapi.
                formatCurrency: (amount) => {
                    return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(amount);
                },
                // Menghasilkan ID unik sederhana untuk elemen baru (properti, notifikasi, transaksi).
                generateId: (prefix = 'id') => {
                    // Kombinasi prefix, timestamp, dan string acak untuk keunikan.
                    return `${prefix}${Date.now()}${Math.random().toString(36).substring(2, 9)}`;
                },
                // Membersihkan string dari potensi tag HTML berbahaya (pencegahan XSS dasar).
                // Menggunakan DOMParser untuk cara yang lebih aman daripada textContent pada div sementara.
                sanitizeHTML: (str) => {
                    if (!str) return '';
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(str, 'text/html');
                    return doc.body.textContent || "";
                },
                // Mengatur visibilitas elemen (tampil/sembunyi) dan atribut ARIA terkait.
                toggleElementVisibility: (element, show) => {
                    if (element) {
                        element.classList.toggle('hidden', !show);
                        element.setAttribute('aria-hidden', String(!show)); // Penting untuk aksesibilitas
                    }
                },
                // Menampilkan pesan error spesifik untuk sebuah field dalam form.
                showFieldError: (fieldId, message) => {
                    const field = document.getElementById(fieldId);
                    const errorElement = document.getElementById(`error-${fieldId}`);
                    if (field && errorElement) {
                        field.classList.add('is-invalid'); // Menambah kelas untuk styling error
                        field.setAttribute('aria-invalid', 'true'); // Aksesibilitas
                        field.setAttribute('aria-describedby', `error-${fieldId}`);
                        errorElement.textContent = message;
                        UTILS.toggleElementVisibility(errorElement, true);
                    }
                },
                // Membersihkan pesan error dari sebuah field form.
                clearFieldError: (fieldId) => {
                    const field = document.getElementById(fieldId);
                    const errorElement = document.getElementById(`error-${fieldId}`);
                    if (field && errorElement) {
                        field.classList.remove('is-invalid');
                        field.removeAttribute('aria-invalid');
                        field.removeAttribute('aria-describedby');
                        UTILS.toggleElementVisibility(errorElement, false);
                    }
                },
                // Membersihkan semua pesan error dari sebuah form.
                clearFormErrors: (formElement) => {
                    formElement.querySelectorAll('.error-message').forEach(el => UTILS.toggleElementVisibility(el, false));
                    formElement.querySelectorAll('.is-invalid').forEach(el => {
                        el.classList.remove('is-invalid');
                        el.removeAttribute('aria-invalid');
                        el.removeAttribute('aria-describedby');
                    });
                },
                // Menambahkan notifikasi baru ke state dan (jika halaman notifikasi aktif) merender ulang.
                // Bisa dikembangkan untuk menampilkan toast/snackbar global.
                addNotification: (message, type = 'info') => {
                    const newNotification = {
                        id: UTILS.generateId('notif'),
                        message: message, // Pesan sudah boleh mengandung HTML aman (mis. <strong>) jika dari sistem, hati-hati jika dari user input
                        type: type,
                        timestamp: new Date().toISOString()
                    };
                    appState.notifications.unshift(newNotification); // Tambah di awal agar muncul paling atas
                    if (appState.currentRoute === 'notifikasi') {
                        RENDER.notifications(); // Hanya render ulang jika halaman notifikasi sedang aktif
                    }
                    // Implementasi Toast/Snackbar sederhana (opsional, untuk feedback instan)
                    // HANDLERS.showToast(message, type); // Ini memerlukan fungsi showToast tambahan
                },
                // Menghitung dan memformat waktu relatif (mis. "5 menit lalu", "kemarin").
                timeAgo: (date) => {
                    const seconds = Math.floor((new Date() - new Date(date)) / 1000);
                    let interval = seconds / 31536000; // Detik dalam setahun
                    if (interval > 1) return Math.floor(interval) + " tahun lalu";
                    interval = seconds / 2592000; // Detik dalam sebulan
                    if (interval > 1) return Math.floor(interval) + " bulan lalu";
                    interval = seconds / 86400; // Detik dalam sehari
                    if (interval > 1) {
                        const days = Math.floor(interval);
                        if (days === 1) return "kemarin";
                        return days + " hari lalu";
                    }
                    interval = seconds / 3600; // Detik dalam sejam
                    if (interval > 1) return Math.floor(interval) + " jam lalu";
                    interval = seconds / 60; // Detik dalam semenit
                    if (interval > 1) return Math.floor(interval) + " menit lalu";
                    return Math.floor(seconds) < 5 ? "baru saja" : Math.floor(seconds) + " detik lalu";
                }
            };

            // --- ELEMEN DOM UTAMA (Cache untuk Performa dan Akses Mudah) ---
            // 'DOM' menyimpan referensi ke elemen-elemen HTML yang sering diakses.
            // Ini menghindari query DOM berulang kali, yang meningkatkan performa.
            const DOM = {
                mainContentArea: document.getElementById('main-content-area'), // Area utama untuk konten SPA
                navLinks: document.querySelectorAll('.site-nav .nav-link'), // Semua link navigasi utama
                themeToggleButton: document.getElementById('theme-toggle'), // Tombol ganti tema
                themeToggleIcon: document.querySelector('#theme-toggle .icon i'), // Ikon di tombol tema
                themeToggleText: document.querySelector('#theme-toggle .text'), // Teks di tombol tema
                currentYearSpan: document.getElementById('current-year'), // Span untuk tahun di footer

                // Elemen Modal Tambah/Edit Properti
                propertyModal: document.getElementById('property-modal'),
                propertyModalTitle: document.getElementById('modal-title-property'),
                propertyForm: document.getElementById('property-form'),
                propertyIdInput: document.getElementById('property-id'),
                propertyNameInput: document.getElementById('property-name'),
                propertyLocationInput: document.getElementById('property-location'),
                propertyPriceInput: document.getElementById('property-price'),
                propertyImageInput: document.getElementById('property-image'),
                savePropertyButton: document.getElementById('save-property-button'),

                // Elemen Modal Detail Properti & Booking
                detailModal: document.getElementById('detail-modal'),
                detailModalTitle: document.getElementById('modal-title-detail'),
                detailImage: document.getElementById('detail-image'),
                detailName: document.getElementById('detail-name'),
                detailLocation: document.getElementById('detail-location'),
                detailPrice: document.getElementById('detail-price'),
                detailMapPlaceholder: document.getElementById('detail-map'), // Placeholder peta
                bookingForm: document.getElementById('booking-form'),
                bookingPropertyIdInput: document.getElementById('booking-property-id'),
                bookingNameInput: document.getElementById('booking-name'),
                bookingEmailInput: document.getElementById('booking-email'),
                bookingDurationInput: document.getElementById('booking-duration'),
                paymentStatusDiv: document.getElementById('payment-status'), // Div untuk status pembayaran
                submitBookingButton: document.getElementById('submit-booking-button'),

                // Koleksi semua tombol tutup modal (untuk event listener umum)
                closeModalButtons: document.querySelectorAll('.modal .close-button'),

                // Referensi ke template HTML untuk setiap halaman SPA
                propertiPageTemplate: document.getElementById('properti-page-template'),
                laporanPageTemplate: document.getElementById('laporan-page-template'),
                notifikasiPageTemplate: document.getElementById('notifikasi-page-template'),
            };

            // --- FUNGSI RENDER (Bertanggung Jawab Memperbarui UI Berdasarkan State) ---
            // 'RENDER' berisi fungsi-fungsi yang mengambil data dari 'appState' dan menampilkannya di DOM.
            const RENDER = {
                // Fungsi utama untuk merender halaman berdasarkan rute yang aktif.
                page: (routeName) => {
                    DOM.mainContentArea.innerHTML = ''; // Bersihkan konten lama sebelum memuat yang baru
                    let templateContent; // Variabel untuk menyimpan konten template yang di-clone

                    // Switch-case untuk memilih template dan logika render berdasarkan rute
                    switch (routeName) {
                        case 'properti':
                            templateContent = DOM.propertiPageTemplate.content.cloneNode(true); // Clone template
                            DOM.mainContentArea.appendChild(templateContent); // Tambahkan ke DOM
                            RENDER.properties(); // Panggil fungsi render spesifik untuk daftar properti
                            // Event listener untuk tombol "Tambah Properti" harus di-attach setelah template dirender
                            document.getElementById('add-property-button').addEventListener('click', HANDLERS.openAddPropertyModal);
                            // Event listener untuk list properti (menggunakan event delegation untuk efisiensi)
                            // Delegasi event untuk klik pada kartu properti (detail, edit, hapus)
                            DOM.mainContentArea.querySelector('.property-list').addEventListener('click', HANDLERS.handlePropertyCardClick);
                            break;
                        case 'laporan':
                            templateContent = DOM.laporanPageTemplate.content.cloneNode(true);
                            DOM.mainContentArea.appendChild(templateContent);
                            RENDER.reports(); // Panggil fungsi render spesifik untuk laporan
                            break;
                        case 'notifikasi':
                            templateContent = DOM.notifikasiPageTemplate.content.cloneNode(true);
                            DOM.mainContentArea.appendChild(templateContent);
                            RENDER.notifications(); // Panggil fungsi render spesifik untuk notifikasi
                            break;
                        default: // Jika rute tidak dikenal, tampilkan pesan error
                            DOM.mainContentArea.innerHTML = `<p class="info-message"><i class="fas fa-exclamation-triangle"></i> Maaf, halaman yang Anda cari tidak ditemukan.</p>`;
                            console.warn(`Rute tidak dikenal: ${routeName}`);
                    }

                    // Update style 'active' pada link navigasi sesuai halaman yang sedang ditampilkan
                    DOM.navLinks.forEach(link => {
                        link.classList.toggle('active', link.dataset.route === routeName);
                        link.setAttribute('aria-current', link.dataset.route === routeName ? 'page' : 'false');
                    });
                    appState.currentRoute = routeName; // Simpan rute saat ini di state
                    // Set fokus ke judul utama halaman untuk aksesibilitas
                    const pageTitle = DOM.mainContentArea.querySelector('.section-title');
                    if (pageTitle) pageTitle.focus({ preventScroll: true });


                },

                // Merender daftar properti di halaman "Properti Saya".
                properties: () => {
                    const propertyListContainer = DOM.mainContentArea.querySelector('.property-list');
                    const noPropertiesMsg = DOM.mainContentArea.querySelector('#no-properties-message');

                    if (!propertyListContainer || !noPropertiesMsg) {
                        console.error("Elemen untuk render properti tidak ditemukan.");
                        return;
                    }

                    propertyListContainer.innerHTML = ''; // Bersihkan daftar properti yang ada
                    UTILS.toggleElementVisibility(noPropertiesMsg, appState.properties.length === 0); // Tampilkan/sembunyikan pesan "belum ada properti"

                    if (appState.properties.length > 0) {
                        const fragment = document.createDocumentFragment(); // Gunakan DocumentFragment untuk optimasi DOM manipulation
                        appState.properties.forEach(property => {
                            const card = document.createElement('article'); // Gunakan <article> untuk semantik
                            card.className = 'property-card';
                            card.dataset.id = property.id; // Simpan ID properti di data attribute
                            card.setAttribute('tabindex', '0'); // Agar kartu bisa difokus dengan keyboard
                            card.setAttribute('role', 'group'); // Kartu sebagai grup elemen interaktif
                            card.setAttribute('aria-labelledby', `prop-name-${property.id}`);

                            // Sanitasi semua data sebelum dimasukkan ke innerHTML untuk keamanan
                            const sanitizedName = UTILS.sanitizeHTML(property.name);
                            const sanitizedLocation = UTILS.sanitizeHTML(property.location);
                            const sanitizedImageUrl = UTILS.sanitizeHTML(property.imageUrl) || CONFIG.defaultImageUrl;

                            card.innerHTML = `
                                <div class="property-card-image-wrapper">
                                    <img src="${sanitizedImageUrl}" alt="Gambar ${sanitizedName}">
                                </div>
                                <div class="property-card-content">
                                    <h3 id="prop-name-${property.id}">${sanitizedName}</h3>
                                    <p><i class="fas fa-map-marker-alt" aria-hidden="true"></i> ${sanitizedLocation}</p>
                                    <p><i class="fas fa-tags" aria-hidden="true"></i> <strong>${UTILS.formatCurrency(property.price)}</strong> / bulan</p>
                                    <div class="property-actions">
                                        <button class="button secondary-button edit-button" data-action="edit" aria-label="Edit properti ${sanitizedName}"><i class="fas fa-edit" aria-hidden="true"></i> Edit</button>
                                        <button class="button danger-button delete-button" data-action="delete" aria-label="Hapus properti ${sanitizedName}"><i class="fas fa-trash-alt" aria-hidden="true"></i> Hapus</button>
                                    </div>
                                </div>
                            `;
                            fragment.appendChild(card);
                        });
                        propertyListContainer.appendChild(fragment); // Tambahkan semua kartu sekaligus ke DOM
                    }
                },

                // Merender data di halaman "Laporan Keuangan".
                reports: () => {
                    // Dapatkan elemen-elemen UI untuk laporan
                    const totalRevenueEl = DOM.mainContentArea.querySelector('#total-revenue');
                    const completedTransactionsEl = DOM.mainContentArea.querySelector('#completed-transactions');
                    const activePropertiesCountEl = DOM.mainContentArea.querySelector('#active-properties-count');
                    const transactionItemsList = DOM.mainContentArea.querySelector('#transaction-items');
                    const noTransactionsMsg = DOM.mainContentArea.querySelector('#no-transactions-message');

                    if (!totalRevenueEl || !completedTransactionsEl || !activePropertiesCountEl || !transactionItemsList || !noTransactionsMsg) {
                        console.error("Elemen untuk render laporan tidak ditemukan.");
                        return;
                    }

                    // Hitung total pendapatan dari semua transaksi (simulasi)
                    const totalRevenue = appState.transactions.reduce((sum, t) => sum + t.amount, 0);
                    totalRevenueEl.textContent = UTILS.formatCurrency(totalRevenue);
                    completedTransactionsEl.textContent = appState.transactions.length;
                    activePropertiesCountEl.textContent = appState.properties.length;

                    UTILS.toggleElementVisibility(noTransactionsMsg, appState.transactions.length === 0);
                    transactionItemsList.innerHTML = ''; // Bersihkan daftar transaksi lama

                    if (appState.transactions.length > 0) {
                        const fragment = document.createDocumentFragment();
                        // Tampilkan transaksi terbaru di atas (slice().reverse() membuat salinan array baru)
                        appState.transactions.slice().reverse().forEach(transaction => {
                            const li = document.createElement('li');
                            const transactionDate = new Date(transaction.date).toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                            // Sanitasi data sebelum ditampilkan
                            const sanitizedPropertyName = UTILS.sanitizeHTML(transaction.propertyName);
                            const sanitizedCustomerName = UTILS.sanitizeHTML(transaction.customerName);

                            li.innerHTML = `
                                <div>
                                    <span>Transaksi booking untuk <strong>${sanitizedPropertyName}</strong> oleh ${sanitizedCustomerName}</span>
                                    <small style="display:block; opacity:0.7;">Tanggal: ${transactionDate}</small>
                                </div>
                                <span class="transaction-amount-income">${UTILS.formatCurrency(transaction.amount)}</span>
                            `;
                            fragment.appendChild(li);
                        });
                        transactionItemsList.appendChild(fragment);
                    }
                },

                // Merender daftar notifikasi di halaman "Notifikasi".
                notifications: () => {
                    const notificationListEl = DOM.mainContentArea.querySelector('#notification-items-list');
                    const noNotificationsMsg = DOM.mainContentArea.querySelector('#no-notifications-message');

                    if (!notificationListEl || !noNotificationsMsg) {
                        console.error("Elemen untuk render notifikasi tidak ditemukan.");
                        return;
                    }

                    UTILS.toggleElementVisibility(noNotificationsMsg, appState.notifications.length === 0);
                    notificationListEl.innerHTML = ''; // Bersihkan daftar notifikasi lama

                    if (appState.notifications.length > 0) {
                        const fragment = document.createDocumentFragment();
                        appState.notifications.forEach(notification => {
                            const li = document.createElement('li');
                            li.className = 'notification-item';
                            // Pilih ikon berdasarkan tipe notifikasi
                            const iconClass = CONFIG.notificationIcons[notification.type] || CONFIG.notificationIcons.info;
                            // Format waktu notifikasi menjadi "time ago"
                            const timeAgo = UTILS.timeAgo(notification.timestamp);
                            // Pesan notifikasi sudah di-handle agar aman saat penambahan (bisa mengandung HTML dari sistem)
                            const messageContent = notification.message; // Tidak perlu UTILS.sanitizeHTML() jika sudah aman dari sumbernya

                            li.innerHTML = `
                                <span class="notification-icon"><i class="${iconClass}" aria-hidden="true"></i></span>
                                <div class="notification-message">
                                    ${messageContent}
                                    <div class="notification-timestamp">${timeAgo}</div>
                                </div>
                            `;
                            fragment.appendChild(li);
                        });
                        notificationListEl.appendChild(fragment);
                    }
                }
            };

            // --- LOGIKA MODAL (Buka, Tutup, Manajemen Fokus) ---
            // 'MODALS' mengelola semua fungsionalitas terkait pop-up modal.
            const MODALS = {
                activeModal: null, // Menyimpan referensi ke modal yang sedang aktif
                lastFocusedElement: null, // Menyimpan elemen yang memiliki fokus sebelum modal dibuka (untuk dikembalikan saat modal ditutup)

                // Membuka modal yang ditentukan.
                open: (modalElement, onOpenCallback) => {
                    if (!modalElement || MODALS.activeModal) return; // Jangan buka jika modal tidak ada atau sudah ada yang aktif

                    MODALS.lastFocusedElement = document.activeElement; // Simpan elemen yang fokus saat ini
                    modalElement.classList.add('active'); // Tampilkan modal
                    document.body.style.overflow = 'hidden'; // Cegah scroll pada body saat modal terbuka
                    MODALS.activeModal = modalElement; // Set modal ini sebagai modal aktif

                    // Fokus ke elemen interaktif pertama di dalam modal (penting untuk aksesibilitas keyboard)
                    const focusableElements = modalElement.querySelectorAll('button, [href], input:not([type="hidden"]), select, textarea, [tabindex]:not([tabindex="-1"])');
                    if (focusableElements.length > 0) {
                        focusableElements[0].focus();
                    } else {
                        // Jika tidak ada elemen fokus, fokus ke modal content agar user bisa scroll (jika perlu)
                        modalElement.querySelector('.modal-content').focus();
                    }

                    // Jalankan callback jika ada (misalnya, untuk mengisi form saat modal edit dibuka)
                    if (onOpenCallback && typeof onOpenCallback === 'function') {
                        onOpenCallback();
                    }
                },
                // Menutup modal yang sedang aktif.
                close: () => {
                    if (!MODALS.activeModal) return; // Tidak ada modal aktif untuk ditutup

                    MODALS.activeModal.classList.remove('active'); // Sembunyikan modal
                    document.body.style.overflow = ''; // Kembalikan kemampuan scroll pada body

                    // Kembalikan fokus ke elemen yang terakhir fokus sebelum modal dibuka (aksesibilitas)
                    if (MODALS.lastFocusedElement) {
                        MODALS.lastFocusedElement.focus();
                    }
                    MODALS.activeModal = null; // Tidak ada modal aktif lagi
                },
                // Setup event listener global untuk semua modal (tombol close, Escape, klik di luar).
                setupEventListeners: () => {
                    // Event listener untuk semua tombol close (X) di setiap modal
                    DOM.closeModalButtons.forEach(button => {
                        button.addEventListener('click', MODALS.close);
                    });

                    // Event listener untuk tombol Escape (Esc) untuk menutup modal
                    document.addEventListener('keydown', (event) => {
                        if (event.key === 'Escape' && MODALS.activeModal) {
                            MODALS.close();
                        }
                        // Trap focus di dalam modal (navigasi Tab dan Shift+Tab)
                        if (event.key === 'Tab' && MODALS.activeModal) {
                            const focusableElements = Array.from(MODALS.activeModal.querySelectorAll('button, [href], input:not([type="hidden"]), select, textarea, [tabindex]:not([tabindex="-1"])')).filter(el => el.offsetParent !== null); // Hanya elemen yang visible
                            if (focusableElements.length === 0) return; // Tidak ada elemen yang bisa difokus

                            const firstElement = focusableElements[0];
                            const lastElement = focusableElements[focusableElements.length - 1];

                            if (event.shiftKey) { // Shift + Tab (mundur)
                                if (document.activeElement === firstElement) {
                                    lastElement.focus(); // Pindah ke elemen terakhir
                                    event.preventDefault();
                                }
                            } else { // Tab (maju)
                                if (document.activeElement === lastElement) {
                                    firstElement.focus(); // Pindah ke elemen pertama
                                    event.preventDefault();
                                }
                            }
                        }
                    });

                    // Event listener untuk klik di area overlay (luar konten modal) untuk menutup modal
                    [DOM.propertyModal, DOM.detailModal].forEach(modal => {
                        if (modal) { // Pastikan modal elemennya ada
                            modal.addEventListener('click', (event) => {
                                // Hanya tutup jika target klik adalah overlay modal itu sendiri, bukan kontennya
                                if (event.target === modal) {
                                    MODALS.close();
                                }
                            });
                        }
                    });
                }
            };

            // --- EVENT HANDLERS (Mengelola Interaksi Pengguna) ---
            // 'HANDLERS' berisi fungsi-fungsi yang merespons aksi pengguna (klik, submit, dll.).
            const HANDLERS = {
                // Menangani klik pada link navigasi untuk routing SPA.
                navigate: (event) => {
                    event.preventDefault(); // Cegah reload halaman standar oleh link
                    const navLink = event.target.closest('.nav-link'); // Dapatkan elemen .nav-link terdekat
                    if (navLink && navLink.dataset.route) {
                        const route = navLink.dataset.route;
                        window.location.hash = route; // Ubah hash URL, yang akan memicu 'handleHashChange'
                    }
                },
                // Menangani perubahan pada hash URL (untuk routing).
                handleHashChange: () => {
                    // Ambil rute dari hash URL (hilangkan '#'), atau gunakan rute default jika hash kosong
                    const route = window.location.hash.substring(1) || CONFIG.defaultRoute;
                    RENDER.page(route); // Render halaman yang sesuai dengan rute
                },

                // Mengganti tema antara terang dan gelap.
                toggleTheme: () => {
                    document.body.classList.toggle('dark-mode'); // Toggle kelas 'dark-mode' pada body
                    const isDarkMode = document.body.classList.contains('dark-mode');
                    // Simpan preferensi tema di localStorage
                    localStorage.setItem(CONFIG.themeStorageKey, isDarkMode ? 'dark' : 'light');
                    // Update ikon dan teks tombol tema
                    DOM.themeToggleIcon.className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
                    DOM.themeToggleText.textContent = isDarkMode ? 'Mode Terang' : 'Mode Gelap';
                    DOM.themeToggleButton.setAttribute('aria-label', `Ganti ke Mode ${isDarkMode ? 'Terang' : 'Gelap'}`);
                    UTILS.addNotification(`Tema diubah ke mode ${isDarkMode ? 'gelap' : 'terang'}.`, 'info');
                },

                // Membuka modal untuk menambah properti baru.
                openAddPropertyModal: () => {
                    appState.editingPropertyId = null; // Pastikan mode tambah, bukan edit
                    DOM.propertyModalTitle.textContent = 'Tambah Properti Baru';
                    DOM.propertyForm.reset(); // Bersihkan form dari data sebelumnya
                    UTILS.clearFormErrors(DOM.propertyForm); // Bersihkan pesan error
                    DOM.savePropertyButton.innerHTML = '<i class="fas fa-plus-circle" aria-hidden="true"></i> Tambah Properti';
                    MODALS.open(DOM.propertyModal); // Buka modal
                },
                // Membuka modal untuk mengedit properti yang sudah ada.
                openEditPropertyModal: (propertyId) => {
                    const property = appState.properties.find(p => p.id === propertyId);
                    if (!property) {
                        console.error(`Properti dengan ID ${propertyId} tidak ditemukan untuk diedit.`);
                        UTILS.addNotification('Gagal memuat data properti untuk diedit.', 'error');
                        return;
                    }
                    appState.editingPropertyId = propertyId; // Set ID properti yang diedit

                    DOM.propertyModalTitle.textContent = 'Edit Data Properti';
                    DOM.propertyForm.reset();
                    UTILS.clearFormErrors(DOM.propertyForm);

                    // Isi form dengan data properti yang ada
                    DOM.propertyIdInput.value = property.id; // Meskipun hidden, ini berguna
                    DOM.propertyNameInput.value = property.name;
                    DOM.propertyLocationInput.value = property.location;
                    DOM.propertyPriceInput.value = property.price;
                    DOM.propertyImageInput.value = property.imageUrl || '';
                    DOM.savePropertyButton.innerHTML = '<i class="fas fa-save" aria-hidden="true"></i> Simpan Perubahan';
                    MODALS.open(DOM.propertyModal);
                },
                // Menyimpan data properti (baik tambah baru maupun edit).
                saveProperty: (event) => {
                    event.preventDefault(); // Cegah submit form standar
                    if (!VALIDATE.propertyForm()) return; // Validasi form, jangan lanjut jika tidak valid

                    // Ambil data dari form dan sanitasi
                    const propertyData = {
                        // ID di-generate jika baru, atau gunakan ID yang ada jika edit
                        id: appState.editingPropertyId || UTILS.generateId('prop'),
                        name: DOM.propertyNameInput.value.trim(), // .trim() untuk menghapus spasi ekstra
                        location: DOM.propertyLocationInput.value.trim(),
                        price: parseInt(DOM.propertyPriceInput.value),
                        // Gunakan URL gambar default jika input kosong
                        imageUrl: DOM.propertyImageInput.value.trim() || CONFIG.defaultImageUrl
                    };
                    // Tidak perlu sanitasi di sini karena akan disanitasi saat render atau input value sudah aman.

                    if (appState.editingPropertyId) { // Jika mode edit
                        // Update properti yang ada di state
                        appState.properties = appState.properties.map(p =>
                            p.id === appState.editingPropertyId ? propertyData : p
                        );
                        UTILS.addNotification(`Properti "${UTILS.sanitizeHTML(propertyData.name)}" berhasil diperbarui.`, 'success');
                    } else { // Jika mode tambah baru
                        appState.properties.push(propertyData); // Tambah properti baru ke state
                        UTILS.addNotification(`Properti "${UTILS.sanitizeHTML(propertyData.name)}" berhasil ditambahkan.`, 'success');
                    }
                    RENDER.properties(); // Re-render daftar properti untuk menampilkan perubahan
                    MODALS.close(); // Tutup modal
                },
                // Menghapus properti dari daftar.
                deleteProperty: (propertyId) => {
                    const property = appState.properties.find(p => p.id === propertyId);
                    if (!property) {
                        console.error(`Properti dengan ID ${propertyId} tidak ditemukan untuk dihapus.`);
                        UTILS.addNotification('Gagal menghapus properti, data tidak ditemukan.', 'error');
                        return;
                    }

                    // Konfirmasi pengguna sebelum melakukan aksi hapus yang permanen
                    // Bisa diganti dengan custom confirm modal yang lebih fancy di masa depan
                    if (confirm(`Apakah Anda yakin ingin menghapus properti "${UTILS.sanitizeHTML(property.name)}"? Tindakan ini tidak dapat dibatalkan.`)) {
                        appState.properties = appState.properties.filter(p => p.id !== propertyId); // Hapus properti dari state
                        RENDER.properties(); // Re-render daftar properti
                        UTILS.addNotification(`Properti "${UTILS.sanitizeHTML(property.name)}" telah berhasil dihapus.`, 'info');
                    }
                },
                // Menggunakan event delegation untuk menangani klik pada kartu properti (detail, edit, hapus).
                handlePropertyCardClick: (event) => {
                    const targetButton = event.target.closest('button'); // Cek apakah target adalah tombol di dalam kartu
                    const card = event.target.closest('.property-card'); // Dapatkan elemen kartu terdekat

                    if (!card) return; // Jika klik di luar kartu, abaikan
                    const propertyId = card.dataset.id;

                    if (targetButton) { // Jika yang diklik adalah tombol di dalam kartu
                        if (targetButton.classList.contains('edit-button')) {
                            HANDLERS.openEditPropertyModal(propertyId);
                        } else if (targetButton.classList.contains('delete-button')) {
                            HANDLERS.deleteProperty(propertyId);
                        }
                    } else { // Jika yang diklik adalah area kartu itu sendiri (bukan tombol di dalamnya)
                        HANDLERS.openDetailModal(propertyId); // Buka modal detail
                    }
                },

                // Membuka modal detail untuk properti tertentu.
                openDetailModal: (propertyId) => {
                    const property = appState.properties.find(p => p.id === propertyId);
                    if (!property) {
                        console.error(`Properti dengan ID ${propertyId} tidak ditemukan untuk detail.`);
                        UTILS.addNotification('Gagal menampilkan detail, data properti tidak ditemukan.', 'error');
                        return;
                    }

                    // Isi konten modal detail dengan data properti (sudah disanitasi saat render kartu atau dari sumber aman)
                    DOM.detailModalTitle.textContent = property.name;
                    DOM.detailImage.src = property.imageUrl || CONFIG.defaultImageUrl;
                    DOM.detailImage.alt = `Gambar ${property.name}`;
                    DOM.detailName.textContent = property.name;
                    DOM.detailLocation.textContent = property.location;
                    DOM.detailPrice.textContent = UTILS.formatCurrency(property.price);
                    DOM.bookingPropertyIdInput.value = property.id; // Set ID properti untuk form booking

                    // Simulasi peta (bisa diintegrasikan dengan API peta jika diizinkan dan tidak melanggar batasan "no SVG/heavy API")
                    DOM.detailMapPlaceholder.innerHTML = `<i class="fas fa-map-marked-alt" aria-hidden="true"></i> <p>Peta Lokasi Properti: ${UTILS.sanitizeHTML(property.location)}</p>`;

                    // Reset form booking dan status pembayaran sebelumnya
                    DOM.bookingForm.reset();
                    UTILS.clearFormErrors(DOM.bookingForm);
                    UTILS.toggleElementVisibility(DOM.paymentStatusDiv, false);
                    DOM.paymentStatusDiv.className = 'status-message'; // Reset kelas CSS status pembayaran
                    DOM.submitBookingButton.disabled = false; // Pastikan tombol submit aktif

                    MODALS.open(DOM.detailModal); // Buka modal detail
                },
                // Menangani submit form booking (simulasi pembayaran).
                submitBooking: (event) => {
                    event.preventDefault();
                    if (!VALIDATE.bookingForm()) return; // Validasi form booking

                    const propertyId = DOM.bookingPropertyIdInput.value;
                    const property = appState.properties.find(p => p.id === propertyId);
                    if (!property) {
                        UTILS.addNotification('Properti untuk booking tidak valid.', 'error');
                        return;
                    }

                    const customerName = DOM.bookingNameInput.value.trim();
                    const duration = parseInt(DOM.bookingDurationInput.value);
                    const totalAmount = property.price * duration;

                    // Tampilkan status proses pembayaran
                    UTILS.toggleElementVisibility(DOM.paymentStatusDiv, true);
                    DOM.paymentStatusDiv.innerHTML = `<i class="fas fa-spinner fa-spin" aria-hidden="true"></i> Memproses permintaan booking dan pembayaran Anda...`;
                    DOM.paymentStatusDiv.className = 'status-message info-message';
                    DOM.submitBookingButton.disabled = true; // Nonaktifkan tombol submit selama proses

                    // Simulasi proses pembayaran dengan timeout
                    setTimeout(() => {
                        const isSuccess = Math.random() > 0.15; // 85% kemungkinan sukses (untuk simulasi)

                        if (isSuccess) {
                            // Buat data transaksi baru
                            const transaction = {
                                id: UTILS.generateId('trans'),
                                propertyId: property.id,
                                propertyName: property.name,
                                customerName: customerName, // Disanitasi saat render
                                amount: totalAmount,
                                date: new Date().toISOString()
                            };
                            appState.transactions.push(transaction); // Tambah transaksi ke state
                            if (appState.currentRoute === 'laporan') RENDER.reports(); // Update halaman laporan jika aktif

                            DOM.paymentStatusDiv.innerHTML = `<i class="fas fa-check-circle" aria-hidden="true"></i> Pembayaran berhasil! Total: ${UTILS.formatCurrency(totalAmount)}. Transaksi Anda telah dicatat.`;
                            DOM.paymentStatusDiv.className = 'status-message payment-success';
                            UTILS.addNotification(`Booking untuk "${UTILS.sanitizeHTML(property.name)}" oleh ${UTILS.sanitizeHTML(customerName)} berhasil diproses.`, 'success');
                            DOM.bookingForm.reset(); // Reset form booking setelah sukses
                        } else {
                            DOM.paymentStatusDiv.innerHTML = `<i class="fas fa-times-circle" aria-hidden="true"></i> Pembayaran gagal. Mohon coba lagi atau hubungi layanan pelanggan kami.`;
                            DOM.paymentStatusDiv.className = 'status-message payment-failure';
                            UTILS.addNotification(`Booking untuk "${UTILS.sanitizeHTML(property.name)}" oleh ${UTILS.sanitizeHTML(customerName)} gagal.`, 'error');
                        }
                        DOM.submitBookingButton.disabled = false; // Aktifkan kembali tombol submit
                    }, 2500); // Simulasi delay proses 2.5 detik
                }
            };

            // --- FUNGSI VALIDASI FORM ---
            // 'VALIDATE' berisi fungsi-fungsi untuk memvalidasi input pengguna pada form.
            const VALIDATE = {
                // Validasi form tambah/edit properti.
                propertyForm: () => {
                    let isValid = true;
                    UTILS.clearFormErrors(DOM.propertyForm); // Bersihkan error sebelumnya

                    // Validasi Nama Properti (tidak boleh kosong)
                    if (DOM.propertyNameInput.value.trim() === '') {
                        UTILS.showFieldError('property-name', 'Nama properti wajib diisi.');
                        isValid = false;
                    }
                    // Validasi Lokasi Properti (tidak boleh kosong)
                    if (DOM.propertyLocationInput.value.trim() === '') {
                        UTILS.showFieldError('property-location', 'Lokasi properti wajib diisi.');
                        isValid = false;
                    }
                    // Validasi Harga Properti (harus angka positif atau nol)
                    if (DOM.propertyPriceInput.value === '' || parseInt(DOM.propertyPriceInput.value) < 0) {
                        UTILS.showFieldError('property-price', 'Harga sewa harus berupa angka positif atau nol.');
                        isValid = false;
                    }
                    // Validasi URL Gambar (jika diisi, harus format URL yang valid)
                    const imageUrl = DOM.propertyImageInput.value.trim();
                    if (imageUrl !== '') {
                        try {
                            new URL(imageUrl); // Coba buat objek URL, error jika tidak valid
                        } catch (_) {
                            UTILS.showFieldError('property-image', 'Format URL gambar tidak valid.');
                            isValid = false;
                        }
                    }
                    if (!isValid) DOM.propertyForm.querySelector('.is-invalid, input[aria-invalid="true"]')?.focus();
                    return isValid;
                },
                // Validasi form booking.
                bookingForm: () => {
                    let isValid = true;
                    UTILS.clearFormErrors(DOM.bookingForm); // Bersihkan error sebelumnya

                    // Validasi Nama Pemesan (tidak boleh kosong)
                    if (DOM.bookingNameInput.value.trim() === '') {
                        UTILS.showFieldError('booking-name', 'Nama lengkap wajib diisi.');
                        isValid = false;
                    }
                    // Validasi Email Pemesan (format email sederhana)
                    const email = DOM.bookingEmailInput.value.trim();
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // Regex sederhana
                    if (email === '' || !emailRegex.test(email)) {
                        UTILS.showFieldError('booking-email', 'Format alamat email tidak valid.');
                        isValid = false;
                    }
                    // Validasi Durasi Sewa (minimal 1 bulan)
                    if (DOM.bookingDurationInput.value === '' || parseInt(DOM.bookingDurationInput.value) < 1) {
                        UTILS.showFieldError('booking-duration', 'Durasi sewa minimal adalah 1 bulan.');
                        isValid = false;
                    }
                    if (!isValid) DOM.bookingForm.querySelector('.is-invalid, input[aria-invalid="true"]')?.focus();
                    return isValid;
                }
            };

            // --- INISIALISASI APLIKASI ---
            // 'INIT' berisi fungsi untuk menjalankan setup awal aplikasi saat DOM siap.
            const INIT = {
                run: () => {
                    console.log("Memulai inisialisasi Dashboard Properti Modern...");

                    // Atur tahun saat ini di footer (dinamis)
                    if (DOM.currentYearSpan) DOM.currentYearSpan.textContent = new Date().getFullYear();

                    // Muat preferensi tema dari localStorage
                    const savedTheme = localStorage.getItem(CONFIG.themeStorageKey);
                    if (savedTheme === 'dark') { // Jika tema gelap tersimpan
                        document.body.classList.add('dark-mode');
                        DOM.themeToggleIcon.className = 'fas fa-sun';
                        DOM.themeToggleText.textContent = 'Mode Terang';
                        DOM.themeToggleButton.setAttribute('aria-label', 'Ganti ke Mode Terang');
                    } else { // Default atau tema terang tersimpan
                        document.body.classList.remove('dark-mode'); // Pastikan tidak ada dark-mode
                        DOM.themeToggleIcon.className = 'fas fa-moon';
                        DOM.themeToggleText.textContent = 'Mode Gelap';
                        DOM.themeToggleButton.setAttribute('aria-label', 'Ganti ke Mode Gelap');
                    }

                    // Setup semua event listener global dan spesifik
                    DOM.themeToggleButton.addEventListener('click', HANDLERS.toggleTheme);
                    DOM.navLinks.forEach(link => link.addEventListener('click', HANDLERS.navigate));
                    window.addEventListener('hashchange', HANDLERS.handleHashChange); // Listener untuk routing SPA
                    MODALS.setupEventListeners(); // Setup listener untuk semua modal

                    // Event listener untuk submit form
                    DOM.propertyForm.addEventListener('submit', HANDLERS.saveProperty);
                    DOM.bookingForm.addEventListener('submit', HANDLERS.submitBooking);

                    // Render halaman awal berdasarkan hash URL atau rute default
                    HANDLERS.handleHashChange();

                    // Hapus placeholder loading setelah konten utama dimuat
                    const loadingPlaceholder = document.getElementById('loading-placeholder');
                    if (loadingPlaceholder) loadingPlaceholder.remove();

                    UTILS.addNotification('Aplikasi Dashboard Properti berhasil dimuat. Selamat bekerja!', 'success');
                    console.log("Inisialisasi Dashboard Properti Modern selesai.");
                }
            };

            // --- Jalankan Aplikasi ---
            INIT.run(); // Mulai seluruh aplikasi
        });
    </script>
</body>

</html>