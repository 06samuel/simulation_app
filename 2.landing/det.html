<!DOCTYPE html>
<html lang="id" data-theme="light">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Rentelindo - Platform Sewa Apartemen Premium</title>
    <style>
        /* Reset dan dasar */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background: hsl(0, 0%, 100%);
            color: hsl(222, 20%, 18%);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding-bottom: 5rem;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        [data-theme="dark"] body {
            background: hsl(226, 32%, 10%);
            color: hsl(210, 40%, 98%);
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        a:hover,
        button:hover {
            opacity: 0.85;
            cursor: pointer;
        }

        /* Container responsif */
        .container {
            width: 90%;
            max-width: 1280px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Header */
        header {
            background: var(--header-bg, hsl(0, 0%, 100%));
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: background-color 0.3s ease;
        }

        [data-theme="dark"] header {
            --header-bg: hsl(226, 32%, 15%);
        }

        header .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }

        header .logo {
            font-weight: 700;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            user-select: none;
        }

        header nav {
            display: flex;
            gap: 1.5rem;
            font-weight: 600;
            font-size: 0.9rem;
        }

        header nav a {
            padding: 0.25rem 0.5rem;
            border-radius: 0.4rem;
            transition: background-color 0.3s ease;
        }

        header nav a:hover {
            background-color: hsl(214, 90%, 52%, 0.15);
            color: hsl(214, 90%, 52%);
        }

        header nav button {
            background-color: hsl(214, 90%, 52%);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }

        /* Hero Section */
        section.hero {
            padding: 4rem 0 3rem;
            text-align: center;
        }

        section.hero h1 {
            font-size: 2.5rem;
            font-weight: 700;
            max-width: 700px;
            margin: 0 auto 1.5rem;
            line-height: 1.2;
        }

        section.hero input[type="text"] {
            width: 100%;
            max-width: 480px;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            border: 2px solid hsl(214, 90%, 52%, 0.5);
            border-radius: 0.5rem;
            outline-offset: 2px;
            transition: border-color 0.3s ease;
        }

        section.hero input[type="text"]:focus {
            border-color: hsl(214, 90%, 52%);
            outline: none;
        }

        /* Virtual Tour Section */
        section#unggulan {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            max-width: 1280px;
            margin: 3rem auto;
            padding: 0 1rem;
        }

        @media(min-width: 768px) {
            section#unggulan {
                grid-template-columns: 1fr 1fr;
                align-items: center;
            }
        }

        section#unggulan h3 {
            font-size: 1.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        section#unggulan p {
            margin-bottom: 1.5rem;
            font-size: 1rem;
            color: hsl(222, 20%, 40%);
        }

        section#unggulan button {
            background-color: hsl(214, 90%, 52%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 1rem;
            transition: background-color 0.3s ease;
        }

        section#unggulan button:hover {
            background-color: hsl(214, 90%, 42%);
            cursor: pointer;
        }

        section#unggulan .tour-placeholder {
            width: 100%;
            max-width: 320px;
            aspect-ratio: 1 / 1;
            border: 3px dashed hsl(214, 90%, 52%, 0.5);
            border-radius: 1rem;
            background-color: hsl(214, 90%, 52%, 0.1);
            margin-left: auto;
            margin-right: auto;
        }

        /* Pembayaran Section */
        section#fitur {
            background-color: hsl(0, 0%, 97%);
            padding: 3rem 1rem 4rem;
            color: hsl(222, 20%, 18%);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        [data-theme="dark"] section#fitur {
            background-color: hsl(226, 32%, 15%);
            color: hsl(210, 40%, 98%);
        }

        section#fitur h3 {
            text-align: center;
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 2rem;
        }

        .payment-methods {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 480px;
            margin: 0 auto 2rem;
        }

        @media(min-width: 480px) {
            .payment-methods {
                flex-direction: row;
                justify-content: center;
            }
        }

        .payment-methods button {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 2px solid hsl(214, 90%, 52%, 0.5);
            border-radius: 0.5rem;
            background: none;
            font-weight: 600;
            font-size: 1rem;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }

        .payment-methods button.selected {
            border-color: hsl(214, 90%, 52%);
            background-color: hsl(214, 90%, 52%, 0.15);
        }

        form.payment-form {
            max-width: 480px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        form.payment-form input,
        form.payment-form select {
            padding: 0.75rem 1rem;
            font-size: 1rem;
            border: 2px solid hsl(214, 90%, 52%, 0.5);
            border-radius: 0.5rem;
            outline-offset: 2px;
            transition: border-color 0.3s ease;
        }

        form.payment-form input:focus,
        form.payment-form select:focus {
            border-color: hsl(214, 90%, 52%);
            outline: none;
        }

        form.payment-form button {
            background-color: hsl(214, 90%, 52%);
            color: white;
            border: none;
            padding: 0.75rem 1rem;
            font-weight: 600;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: background-color 0.3s ease;
        }

        form.payment-form button:hover {
            background-color: hsl(214, 90%, 42%);
            cursor: pointer;
        }

        /* Ulasan Section */
        section.reviews {
            max-width: 1280px;
            margin: 3rem auto;
            padding: 0 1rem 4rem;
        }

        section.reviews h3 {
            font-size: 1.75rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 2rem;
        }

        .review-form {
            max-width: 480px;
            margin: 0 auto 3rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .review-form textarea {
            resize: none;
            min-height: 6rem;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            border: 2px solid hsl(214, 90%, 52%, 0.5);
            border-radius: 0.5rem;
            outline-offset: 2px;
            transition: border-color 0.3s ease;
        }

        .review-form textarea:focus {
            border-color: hsl(214, 90%, 52%);
            outline: none;
        }

        .rating-stars {
            display: flex;
            gap: 0.25rem;
            font-size: 1.75rem;
            justify-content: center;
            user-select: none;
        }

        .rating-stars span {
            cursor: pointer;
            color: hsl(0, 0%, 80%);
            transition: color 0.3s ease;
        }

        .rating-stars span.selected {
            color: hsl(48, 100%, 67%);
        }

        .review-form button {
            background-color: hsl(214, 90%, 52%);
            color: white;
            border: none;
            padding: 0.75rem 1rem;
            font-weight: 600;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: background-color 0.3s ease;
            cursor: pointer;
        }

        .review-form button:hover {
            background-color: hsl(214, 90%, 42%);
        }

        .reviews-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            max-width: 1280px;
            margin: 0 auto;
        }

        @media(min-width: 768px) {
            .reviews-list {
                grid-template-columns: 1fr 1fr;
            }
        }

        .review-card {
            background-color: hsl(0, 0%, 100%);
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            color: hsl(222, 20%, 18%);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        [data-theme="dark"] .review-card {
            background-color: hsl(226, 32%, 15%);
            color: hsl(210, 40%, 98%);
            box-shadow: none;
        }

        .review-card .rating {
            color: hsl(48, 100%, 67%);
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            user-select: none;
        }

        .review-card time {
            font-size: 0.8rem;
            color: hsl(222, 20%, 50%);
            user-select: none;
        }

        /* Manajemen Properti Section */
        section.management {
            background-color: hsl(0, 0%, 97%);
            padding: 3rem 1rem 4rem;
            color: hsl(222, 20%, 18%);
            transition: background-color 0.3s ease, color 0.3s ease;
            max-width: 1280px;
            margin: 0 auto 3rem;
        }

        [data-theme="dark"] section.management {
            background-color: hsl(226, 32%, 15%);
            color: hsl(210, 40%, 98%);
        }

        section.management h3 {
            font-size: 1.75rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 2rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            background-color: hsl(0, 0%, 100%);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        [data-theme="dark"] table {
            background-color: hsl(226, 32%, 15%);
            box-shadow: none;
        }

        thead {
            background-color: hsl(214, 90%, 52%, 0.15);
            user-select: none;
        }

        thead tr th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 1rem;
            color: hsl(214, 90%, 52%);
        }

        tbody tr {
            border-top: 1px solid hsl(214, 90%, 52%, 0.15);
            transition: background-color 0.3s ease;
        }

        tbody tr:hover {
            background-color: hsl(214, 90%, 52%, 0.1);
            cursor: pointer;
        }

        tbody tr td {
            padding: 1rem;
            font-size: 1rem;
        }

        tbody tr td button {
            padding: 0.4rem 0.8rem;
            font-size: 0.9rem;
            border-radius: 0.4rem;
            border: 1.5px solid hsl(214, 90%, 52%);
            background-color: hsl(0, 0%, 100%);
            color: hsl(214, 90%, 52%);
            font-weight: 600;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        tbody tr td button:hover {
            background-color: hsl(214, 90%, 52%);
            color: white;
            cursor: pointer;
        }

        /* Chat Button & Window */
        #chat-toggle {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            background-color: hsl(214, 90%, 52%);
            color: white;
            font-size: 1.5rem;
            border: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
            z-index: 1100;
        }

        #chat-toggle:hover {
            background-color: hsl(214, 90%, 42%);
        }

        #chat-window {
            position: fixed;
            bottom: 5.5rem;
            right: 1.5rem;
            width: 320px;
            max-height: 400px;
            background-color: hsl(0, 0%, 100%);
            border-radius: 0.75rem;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            font-size: 0.9rem;
            color: hsl(222, 20%, 18%);
            transition: background-color 0.3s ease, color 0.3s ease;
            z-index: 1100;
            display: none;
        }

        [data-theme="dark"] #chat-window {
            background-color: hsl(226, 32%, 15%);
            color: hsl(210, 40%, 98%);
        }

        #chat-window header {
            background-color: hsl(214, 90%, 52%);
            color: white;
            padding: 0.75rem 1rem;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #chat-window header button {
            background: none;
            border: none;
            color: white;
            font-size: 1.25rem;
            cursor: pointer;
            font-weight: 700;
            line-height: 1;
            padding: 0;
            user-select: none;
        }

        #chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            scroll-behavior: smooth;
        }

        .chat-message {
            max-width: 70%;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            line-height: 1.3;
            user-select: text;
            word-wrap: break-word;
            font-size: 0.9rem;
            position: relative;
        }

        .chat-message.system {
            background-color: hsl(214, 90%, 52%, 0.15);
            color: hsl(214, 90%, 52%);
            align-self: flex-start;
        }

        .chat-message.user {
            background-color: hsl(214, 90%, 52%);
            color: white;
            align-self: flex-end;
        }

        .chat-message time {
            font-size: 0.7rem;
            color: hsl(222, 20%, 50%);
            position: absolute;
            bottom: -1.2rem;
            right: 0.5rem;
            user-select: none;
        }

        #chat-input-container {
            display: flex;
            border-top: 1px solid hsl(214, 90%, 52%, 0.3);
            padding: 0.5rem 0.75rem;
            gap: 0.5rem;
        }

        #chat-input {
            flex: 1;
            padding: 0.5rem 0.75rem;
            font-size: 1rem;
            border: 2px solid hsl(214, 90%, 52%, 0.5);
            border-radius: 0.5rem;
            outline-offset: 2px;
            transition: border-color 0.3s ease;
        }

        #chat-input:focus {
            border-color: hsl(214, 90%, 52%);
            outline: none;
        }

        #chat-send-btn {
            background-color: hsl(214, 90%, 52%);
            border: none;
            color: white;
            padding: 0 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #chat-send-btn:hover {
            background-color: hsl(214, 90%, 42%);
        }

        /* Utility colors */
        .text-yellow {
            color: hsl(48, 100%, 67%);
            user-select: none;
        }

        /* Rating stars */
        .rating-stars {
            display: flex;
            justify-content: center;
            gap: 0.25rem;
            font-size: 1.75rem;
            user-select: none;
        }

        .rating-stars span {
            cursor: pointer;
            color: hsl(0, 0%, 80%);
            transition: color 0.3s ease;
        }

        .rating-stars span.selected {
            color: hsl(48, 100%, 67%);
        }

        /* Responsive grid for reviews */
        .reviews-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            max-width: 1280px;
            margin: 0 auto;
        }

        @media(min-width: 768px) {
            .reviews-list {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Review card */
        .review-card {
            background-color: hsl(0, 0%, 100%);
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            color: hsl(222, 20%, 18%);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        [data-theme="dark"] .review-card {
            background-color: hsl(226, 32%, 15%);
            color: hsl(210, 40%, 98%);
            box-shadow: none;
        }

        .review-card .rating {
            color: hsl(48, 100%, 67%);
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            user-select: none;
        }

        .review-card time {
            font-size: 0.8rem;
            color: hsl(222, 20%, 50%);
            user-select: none;
        }

        /* Table manajemen properti */
        section.management {
            background-color: hsl(0, 0%, 97%);
            padding: 3rem 1rem 4rem;
            color: hsl(222, 20%, 18%);
            transition: background-color 0.3s ease, color 0.3s ease;
            max-width: 1280px;
            margin: 0 auto 3rem;
        }

        [data-theme="dark"] section.management {
            background-color: hsl(226, 32%, 15%);
            color: hsl(210, 40%, 98%);
        }

        section.management h3 {
            font-size: 1.75rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 2rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            background-color: hsl(0, 0%, 100%);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        [data-theme="dark"] table {
            background-color: hsl(226, 32%, 15%);
            box-shadow: none;
        }

        thead {
            background-color: hsl(214, 90%, 52%, 0.15);
            user-select: none;
        }

        thead tr th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 1rem;
            color: hsl(214, 90%, 52%);
        }

        tbody tr {
            border-top: 1px solid hsl(214, 90%, 52%, 0.15);
            transition: background-color 0.3s ease;
        }

        tbody tr:hover {
            background-color: hsl(214, 90%, 52%, 0.1);
            cursor: pointer;
        }

        tbody tr td {
            padding: 1rem;
            font-size: 1rem;
        }

        tbody tr td button {
            padding: 0.4rem 0.8rem;
            font-size: 0.9rem;
            border-radius: 0.4rem;
            border: 1.5px solid hsl(214, 90%, 52%);
            background-color: hsl(0, 0%, 100%);
            color: hsl(214, 90%, 52%);
            font-weight: 600;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        tbody tr td button:hover {
            background-color: hsl(214, 90%, 52%);
            color: white;
            cursor: pointer;
        }

        /* Responsive utilities */
        @media (max-width: 600px) {
            section#unggulan {
                padding: 0 0.5rem;
            }

            section#fitur {
                padding: 2rem 0.5rem 3rem;
            }

            section.management {
                padding: 2rem 0.5rem 3rem;
            }

            .reviews-list {
                padding: 0 0.5rem;
            }
        }
    </style>
</head>

<body data-theme="light">
    <header>
        <div class="container nav-container">
            <div class="logo">🏠 Rentelindo</div>
            <nav>
                <a href="#unggulan">Properti Eksklusif</a>
                <a href="#fitur">Fitur Premium</a>
                <button id="theme-toggle">Tema Gelap</button>
            </nav>
        </div>
    </header>

    <section class="hero">
        <h1>Temukan Hunian Impianmu dengan Pengalaman Digital Terbaik</h1>
        <input type="text" placeholder="🔍 Cari lokasi, harga, fasilitas..." aria-label="Pencarian properti" />
    </section>

    <section id="unggulan">
        <div>
            <h3>Virtual Tour 360°</h3>
            <p>Jelajahi apartemen secara interaktif sebelum berkunjung langsung.</p>
            <button id="virtual-tour-btn">Putar Tur Virtual</button>
        </div>
        <div class="tour-placeholder" aria-label="Placeholder virtual tour"></div>
    </section>

    <section id="fitur">
        <h3>Pembayaran Aman & Mudah</h3>
        <div class="payment-methods">
            <button type="button" data-method="kartu">💳 Kartu Kredit/ Debit</button>
            <button type="button" data-method="ewallet">📱 Dompet Digital</button>
        </div>
        <form class="payment-form" id="payment-form" novalidate>
            <!-- Form dinamis -->
            <div id="payment-details"></div>
            <button type="submit">Bayar Sekarang</button>
        </form>
    </section>

    <section class="reviews">
        <h3>Ulasan Terverifikasi</h3>
        <div class="review-form">
            <textarea id="review-text" placeholder="Bagikan pengalaman Anda..." aria-label="Tulis ulasan"></textarea>
            <div class="rating-stars" role="radiogroup" aria-label="Pilih rating">
                <span role="radio" tabindex="0" aria-checked="false" data-value="1">★</span>
                <span role="radio" tabindex="-1" aria-checked="false" data-value="2">★</span>
                <span role="radio" tabindex="-1" aria-checked="false" data-value="3">★</span>
                <span role="radio" tabindex="-1" aria-checked="false" data-value="4">★</span>
                <span role="radio" tabindex="-1" aria-checked="false" data-value="5">★</span>
            </div>
            <button id="submit-review">Kirim Ulasan</button>
        </div>
        <div class="reviews-list" id="reviews-list" aria-live="polite" aria-relevant="additions"></div>
    </section>

    <section class="management">
        <h3>Manajemen Properti</h3>
        <table aria-label="Daftar properti">
            <thead>
                <tr>
                    <th>Properti</th>
                    <th>Status</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody id="properties-tbody">
                <!-- Dinamis -->
            </tbody>
        </table>
    </section>

    <button id="chat-toggle" aria-label="Buka chat bantuan cepat">💬</button>
    <section id="chat-window" aria-live="polite" aria-label="Chat bantuan cepat">
        <header>
            <span>Bantuan Cepat</span>
            <button id="chat-close" aria-label="Tutup chat">✕</button>
        </header>
        <div id="chat-messages" tabindex="0" aria-live="polite" aria-relevant="additions" aria-atomic="false"></div>
        <div id="chat-input-container">
            <input id="chat-input" type="text" placeholder="Ketik pesan..." aria-label="Input pesan chat" />
            <button id="chat-send-btn">Kirim</button>
        </div>
    </section>

    <script>
        (function () {
            // State monolith
            const state = {
                theme: 'light',
                chatOpen: false,
                chatMessages: [],
                chatInput: '',
                paymentMethod: null,
                reviews: [],
                reviewText: '',
                reviewRating: 0,
                properties: [
                    { id: 1, name: 'Apartemen Lavender', status: 'Tersedia' },
                    { id: 2, name: 'Apartemen Mawar', status: 'Disewa' },
                    { id: 3, name: 'Apartemen Kenanga', status: 'Tersedia' },
                ],
            };

            // DOM Elements
            const body = document.body;
            const themeToggleBtn = document.getElementById('theme-toggle');
            const chatToggleBtn = document.getElementById('chat-toggle');
            const chatWindow = document.getElementById('chat-window');
            const chatCloseBtn = document.getElementById('chat-close');
            const chatMessagesContainer = document.getElementById('chat-messages');
            const chatInput = document.getElementById('chat-input');
            const chatSendBtn = document.getElementById('chat-send-btn');
            const paymentButtons = document.querySelectorAll('.payment-methods button');
            const paymentDetails = document.getElementById('payment-details');
            const paymentForm = document.getElementById('payment-form');
            const reviewTextInput = document.getElementById('review-text');
            const ratingStars = document.querySelectorAll('.rating-stars span');
            const submitReviewBtn = document.getElementById('submit-review');
            const reviewsList = document.getElementById('reviews-list');
            const propertiesTbody = document.getElementById('properties-tbody');
            const virtualTourBtn = document.getElementById('virtual-tour-btn');

            // Utilitas waktu
            function getNow() {
                return new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            }

            // Inisialisasi tema
            function initTheme() {
                const saved = localStorage.getItem('theme');
                if (saved === 'dark') {
                    state.theme = 'dark';
                    document.documentElement.setAttribute('data-theme', 'dark');
                    themeToggleBtn.textContent = 'Tema Terang';
                } else {
                    state.theme = 'light';
                    document.documentElement.setAttribute('data-theme', 'light');
                    themeToggleBtn.textContent = 'Tema Gelap';
                }
            }

            // Toggle tema
            function toggleTheme() {
                if (state.theme === 'light') {
                    state.theme = 'dark';
                    document.documentElement.setAttribute('data-theme', 'dark');
                    themeToggleBtn.textContent = 'Tema Terang';
                    localStorage.setItem('theme', 'dark');
                } else {
                    state.theme = 'light';
                    document.documentElement.setAttribute('data-theme', 'light');
                    themeToggleBtn.textContent = 'Tema Gelap';
                    localStorage.setItem('theme', 'light');
                }
            }

            // Render chat messages
            function renderChat() {
                chatMessagesContainer.innerHTML = '';
                state.chatMessages.forEach(msg => {
                    const div = document.createElement('div');
                    div.className = 'chat-message ' + (msg.sender === 'user' ? 'user' : 'system');
                    div.textContent = msg.text;
                    const time = document.createElement('time');
                    time.textContent = msg.time;
                    div.appendChild(time);
                    chatMessagesContainer.appendChild(div);
                });
                chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
            }

            // Toggle chat window
            function toggleChat() {
                state.chatOpen = !state.chatOpen;
                chatWindow.style.display = state.chatOpen ? 'flex' : 'none';
                if (state.chatOpen) chatInput.focus();
            }

            // Send chat message
            function sendChatMessage() {
                const text = chatInput.value.trim();
                if (!text) return;
                const msg = {
                    id: Date.now(),
                    sender: 'user',
                    text: text,
                    time: getNow(),
                };
                state.chatMessages.push(msg);
                renderChat();
                chatInput.value = '';
            }

            // Render payment form
            function renderPaymentForm() {
                paymentDetails.innerHTML = '';
                if (!state.paymentMethod) return;
                if (state.paymentMethod === 'kartu') {
                    paymentDetails.innerHTML = `
            <input type="text" name="cardNumber" placeholder="Nomor Kartu" required autocomplete="cc-number" pattern="[0-9 ]{13,19}" title="Masukkan nomor kartu yang valid" />
            <input type="month" name="expiry" placeholder="Berlaku sampai (MM/YY)" required />
            <input type="text" name="cvv" placeholder="CVV" required pattern="[0-9]{3,4}" title="Masukkan CVV yang valid" />
          `;
                } else if (state.paymentMethod === 'ewallet') {
                    paymentDetails.innerHTML = `
            <select name="ewallet" required>
              <option value="">Pilih Dompet Digital</option>
              <option value="gopay">Gopay</option>
              <option value="ovo">OVO</option>
              <option value="dana">Dana</option>
            </select>
            <input type="tel" name="phone" placeholder="Nomor HP" required pattern="[0-9+ ]{9,15}" title="Masukkan nomor HP yang valid" />
          `;
                }
            }

            // Handle payment method selection
            function selectPaymentMethod(e) {
                paymentButtons.forEach(btn => btn.classList.remove('selected'));
                e.target.classList.add('selected');
                state.paymentMethod = e.target.getAttribute('data-method');
                renderPaymentForm();
            }

            // Handle payment form submission
            function handlePaymentSubmit(e) {
                e.preventDefault();
                if (!state.paymentMethod) {
                    alert('Pilih metode pembayaran terlebih dahulu.');
                    return;
                }
                const form = e.target;
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                alert('Pembayaran berhasil! Terima kasih.');
                state.paymentMethod = null;
                paymentDetails.innerHTML = '';
                paymentButtons.forEach(btn => btn.classList.remove('selected'));
                form.reset();
            }

            // Render reviews
            function renderReviews() {
                reviewsList.innerHTML = '';
                state.reviews.forEach(r => {
                    const card = document.createElement('article');
                    card.className = 'review-card';
                    const ratingDiv = document.createElement('div');
                    ratingDiv.className = 'rating';
                    ratingDiv.textContent = '★'.repeat(r.rating);
                    const p = document.createElement('p');
                    p.textContent = r.text;
                    const time = document.createElement('time');
                    time.textContent = r.date;
                    card.appendChild(ratingDiv);
                    card.appendChild(p);
                    card.appendChild(time);
                    reviewsList.appendChild(card);
                });
            }

            // Handle rating star click
            function handleRatingClick(e) {
                if (!e.target.dataset.value) return;
                const val = Number(e.target.dataset.value);
                state.reviewRating = val;
                ratingStars.forEach(star => {
                    star.classList.toggle('selected', Number(star.dataset.value) <= val);
                    star.setAttribute('aria-checked', Number(star.dataset.value) === val ? 'true' : 'false');
                    star.tabIndex = Number(star.dataset.value) === val ? 0 : -1;
                });
            }

            // Handle rating star keyboard navigation
            function handleRatingKeydown(e) {
                const current = Number(document.activeElement.dataset.value);
                if (!current) return;
                if (e.key === 'ArrowRight' || e.key === 'ArrowUp') {
                    e.preventDefault();
                    const next = current < 5 ? current + 1 : 1;
                    ratingStars[next - 1].focus();
                } else if (e.key === 'ArrowLeft' || e.key === 'ArrowDown') {
                    e.preventDefault();
                    const prev = current > 1 ? current - 1 : 5;
                    ratingStars[prev - 1].focus();
                } else if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    state.reviewRating = current;
                    handleRatingClick(e);
                }
            }

            // Submit review
            function submitReview() {
                const text = reviewTextInput.value.trim();
                if (!text) {
                    alert('Tulis ulasan terlebih dahulu.');
                    reviewTextInput.focus();
                    return;
                }
                if (state.reviewRating === 0) {
                    alert('Pilih rating terlebih dahulu.');
                    return;
                }
                const newReview = {
                    id: Date.now(),
                    text: text,
                    rating: state.reviewRating,
                    date: new Date().toLocaleDateString('id-ID'),
                };
                state.reviews.push(newReview);
                localStorage.setItem('reviews', JSON.stringify(state.reviews));
                renderReviews();
                reviewTextInput.value = '';
                state.reviewRating = 0;
                ratingStars.forEach(star => star.classList.remove('selected'));
            }

            // Render properties
            function renderProperties() {
                propertiesTbody.innerHTML = '';
                state.properties.forEach(p => {
                    const tr = document.createElement('tr');
                    const tdName = document.createElement('td');
                    tdName.textContent = p.name;
                    const tdStatus = document.createElement('td');
                    tdStatus.textContent = p.status;
                    const tdAction = document.createElement('td');
                    const btn = document.createElement('button');
                    btn.textContent = p.status === 'Tersedia' ? 'Tandai Disewa' : 'Tandai Tersedia';
                    btn.addEventListener('click', () => {
                        p.status = p.status === 'Tersedia' ? 'Disewa' : 'Tersedia';
                        renderProperties();
                    });
                    tdAction.appendChild(btn);
                    tr.appendChild(tdName);
                    tr.appendChild(tdStatus);
                    tr.appendChild(tdAction);
                    propertiesTbody.appendChild(tr);
                });
            }

            // Virtual tour button (dummy)
            virtualTourBtn.addEventListener('click', () => {
                alert('Fitur Virtual Tour 360° belum tersedia.');
            });

            // Event listeners
            themeToggleBtn.addEventListener('click', toggleTheme);
            chatToggleBtn.addEventListener('click', toggleChat);
            chatCloseBtn.addEventListener('click', toggleChat);
            chatSendBtn.addEventListener('click', sendChatMessage);
            chatInput.addEventListener('keydown', e => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    sendChatMessage();
                }
            });
            paymentButtons.forEach(btn => btn.addEventListener('click', selectPaymentMethod));
            paymentForm.addEventListener('submit', handlePaymentSubmit);
            ratingStars.forEach(star => {
                star.addEventListener('click', handleRatingClick);
                star.addEventListener('keydown', handleRatingKeydown);
            });
            submitReviewBtn.addEventListener('click', e => {
                e.preventDefault();
                submitReview();
            });

            // Load reviews from localStorage
            const savedReviews = localStorage.getItem('reviews');
            if (savedReviews) {
                try {
                    state.reviews = JSON.parse(savedReviews);
                } catch {
                    state.reviews = [];
                }
            }

            // Initial render
            initTheme();
            renderChat();
            renderProperties();
            renderReviews();
        })();
    </script>
</body>

</html>