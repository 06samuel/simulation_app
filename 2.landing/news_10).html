<!DOCTYPE html>
<html lang="id" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Green Valley - Platform penyewaan apartemen premium dengan UI/UX modern dan responsif">
    <meta name="keywords" content="sewa apartemen, rental apartemen, apartemen premium">
    <meta name="author" content="Green Valley Team">
    <title>Green Valley - Premium Apartment Rentals</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè¢</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">

    <style>
        /* ========== DESIGN TOKENS ========== */
        :root {
            /* Color System */
            --color-primary-50: #E3F2FD;
            --color-primary-100: #BBDEFB;
            --color-primary-200: #90CAF9;
            --color-primary-300: #64B5F6;
            --color-primary-400: #42A5F5;
            --color-primary-500: #2196F3;
            --color-primary-600: #1E88E5;
            --color-primary-700: #1976D2;
            --color-primary-800: #1565C0;
            --color-primary-900: #0D47A1;

            --color-success-500: #388E3C;
            --color-error-500: #D32F2F;
            --color-warning-500: #FFA000;
            --color-info-500: #1976D2;

            /* Surface Colors */
            --color-surface-50: #FAFAFA;
            --color-surface-100: #F5F5F5;
            --color-surface-200: #EEEEEE;
            --color-surface-300: #E0E0E0;
            --color-surface-400: #BDBDBD;
            --color-surface-500: #9E9E9E;
            --color-surface-600: #757575;
            --color-surface-700: #616161;
            --color-surface-800: #424242;
            --color-surface-900: #212121;

            /* Text Colors */
            --color-text-primary: rgba(0, 0, 0, 0.87);
            --color-text-secondary: rgba(0, 0, 0, 0.6);
            --color-text-disabled: rgba(0, 0, 0, 0.38);

            /* Spacing System */
            --space-unit: 4px;
            --space-1: calc(1 * var(--space-unit));
            --space-2: calc(2 * var(--space-unit));
            --space-3: calc(4 * var(--space-unit));
            --space-4: calc(6 * var(--space-unit));
            --space-5: calc(8 * var(--space-unit));
            --space-6: calc(12 * var(--space-unit));

            /* Typography */
            --font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', Oxygen, Ubuntu, Cantarell, sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-size-4xl: 2.25rem;

            --font-weight-light: 300;
            --font-weight-regular: 400;
            --font-weight-medium: 500;
            --font-weight-bold: 700;

            --line-height-tight: 1.25;
            --line-height-normal: 1.5;
            --line-height-loose: 1.75;

            /* Border Radius */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-full: 9999px;

            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-normal: 250ms ease;
            --transition-slow: 350ms ease;

            /* Z-Index */
            --z-index-dropdown: 1000;
            --z-index-sticky: 1020;
            --z-index-fixed: 1030;
            --z-index-modal-backdrop: 1040;
            --z-index-modal: 1050;
            --z-index-popover: 1060;
            --z-index-tooltip: 1070;

            /* Current Theme Variables */
            --color-primary: var(--color-primary-700);
            --color-primary-hover: var(--color-primary-800);
            --color-text: var(--color-text-primary);
            --color-text-muted: var(--color-text-secondary);
            --color-background: var(--color-surface-50);
            --color-surface: var(--color-surface-100);
            --color-border: var(--color-surface-300);
        }

        /* ========== DARK THEME ========== */
        [data-theme="dark"] {
            --color-text: rgba(255, 255, 255, 0.87);
            --color-text-muted: rgba(255, 255, 255, 0.6);
            --color-background: var(--color-surface-900);
            --color-surface: var(--color-surface-800);
            --color-border: var(--color-surface-700);
        }

        /* ========== BASE STYLES ========== */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: var(--font-family);
            font-size: var(--font-size-base);
            line-height: var(--line-height-normal);
            color: var(--color-text);
            background-color: var(--color-background);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color var(--transition-normal), color var(--transition-normal);
        }

        a {
            color: var(--color-primary);
            text-decoration: none;
            transition: color var(--transition-fast);
        }

        a:hover {
            color: var(--color-primary-hover);
            text-decoration: underline;
        }

        img {
            max-width: 100%;
            height: auto;
            display: block;
            object-fit: cover;
        }

        button {
            cursor: pointer;
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
            background: none;
            border: none;
            transition: all var(--transition-fast);
        }

        input,
        select,
        textarea {
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
            transition: all var(--transition-fast);
        }

        :focus-visible {
            outline: 2px solid var(--color-primary);
            outline-offset: 2px;
        }

        /* ========== UTILITY CLASSES ========== */
        /* Layout */
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--space-3);
        }

        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .gap-1 {
            gap: var(--space-1);
        }

        .gap-2 {
            gap: var(--space-2);
        }

        .gap-3 {
            gap: var(--space-3);
        }

        .gap-4 {
            gap: var(--space-4);
        }

        .gap-5 {
            gap: var(--space-5);
        }

        .grid {
            display: grid;
        }

        .grid-cols-1 {
            grid-template-columns: repeat(1, 1fr);
        }

        .grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .grid-auto-fill {
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        }

        /* Spacing */
        .p-2 {
            padding: var(--space-2);
        }

        .p-3 {
            padding: var(--space-3);
        }

        .p-4 {
            padding: var(--space-4);
        }

        .py-2 {
            padding-top: var(--space-2);
            padding-bottom: var(--space-2);
        }

        .py-3 {
            padding-top: var(--space-3);
            padding-bottom: var(--space-3);
        }

        .py-4 {
            padding-top: var(--space-4);
            padding-bottom: var(--space-4);
        }

        .my-2 {
            margin-top: var(--space-2);
            margin-bottom: var(--space-2);
        }

        .my-3 {
            margin-top: var(--space-3);
            margin-bottom: var(--space-3);
        }

        .my-4 {
            margin-top: var(--space-4);
            margin-bottom: var(--space-4);
        }

        /* Typography */
        .text-xs {
            font-size: var(--font-size-xs);
        }

        .text-sm {
            font-size: var(--font-size-sm);
        }

        .text-lg {
            font-size: var(--font-size-lg);
        }

        .text-xl {
            font-size: var(--font-size-xl);
        }

        .text-2xl {
            font-size: var(--font-size-2xl);
        }

        .text-3xl {
            font-size: var(--font-size-3xl);
        }

        .text-4xl {
            font-size: var(--font-size-4xl);
        }

        .font-light {
            font-weight: var(--font-weight-light);
        }

        .font-regular {
            font-weight: var(--font-weight-regular);
        }

        .font-medium {
            font-weight: var(--font-weight-medium);
        }

        .font-bold {
            font-weight: var(--font-weight-bold);
        }

        .text-center {
            text-align: center;
        }

        .text-muted {
            color: var(--color-text-muted);
        }

        /* Borders */
        .rounded {
            border-radius: var(--radius-md);
        }

        .rounded-lg {
            border-radius: var(--radius-lg);
        }

        .rounded-full {
            border-radius: var(--radius-full);
        }

        .border {
            border: 1px solid var(--color-border);
        }

        /* Shadows */
        .shadow {
            box-shadow: var(--shadow-md);
        }

        .shadow-lg {
            box-shadow: var(--shadow-lg);
        }

        /* Backgrounds */
        .bg-primary {
            background-color: var(--color-primary);
        }

        .bg-surface {
            background-color: var(--color-surface);
        }

        /* Visibility */
        .hidden {
            display: none;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* ========== COMPONENTS ========== */
        /* Header */
        header {
            position: sticky;
            top: 0;
            background-color: var(--color-surface);
            box-shadow: var(--shadow-sm);
            z-index: var(--z-index-sticky);
        }

        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-3) 0;
        }

        .logo {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
        }

        .nav-links {
            display: flex;
            gap: var(--space-2);
        }

        .nav-link {
            padding: var(--space-2);
            font-weight: var(--font-weight-medium);
            border-radius: var(--radius-sm);
        }

        .nav-link.active {
            background-color: var(--color-primary-100);
            color: var(--color-primary-800);
        }

        /* Hero Section */
        .hero-section {
            background: linear-gradient(45deg, var(--color-primary-500), var(--color-primary-400));
            color: white;
            padding: var(--space-5) 0;
        }

        .hero-title {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--space-3);
        }

        .hero-description {
            font-size: var(--font-size-lg);
            margin-bottom: var(--space-4);
        }

        /* Forms */
        .search-form {
            display: flex;
            gap: var(--space-3);
            align-items: center;
            background-color: var(--color-surface);
            padding: var(--space-3);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
        }

        .form-control {
            padding: var(--space-2);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            width: 100%;
            font-size: var(--font-size-base);
        }

        .form-control:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px var(--color-primary-100);
        }

        /* Cards */
        .card {
            background-color: var(--color-surface);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            transition: transform var(--transition-fast), box-shadow var(--transition-fast);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .card-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .card-body {
            padding: var(--space-3);
        }

        .card-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--space-1);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-sm);
            font-weight: var(--font-weight-medium);
            transition: all var(--transition-fast);
            white-space: nowrap;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--color-primary-hover);
        }

        .btn-outline {
            border: 1px solid var(--color-primary);
            color: var(--color-primary);
            background-color: transparent;
        }

        .btn-outline:hover {
            background-color: var(--color-primary);
            color: white;
        }

        /* Gallery */
        .gallery {
            position: relative;
            overflow: hidden;
            border-radius: var(--radius-md);
        }

        .gallery-images {
            display: flex;
            transition: transform var(--transition-normal);
        }

        .gallery-image {
            flex: 0 0 100%;
            height: 300px;
            object-fit: cover;
        }

        .gallery-nav {
            position: absolute;
            top: 50%;
            width: 100%;
            transform: translateY(-50%);
            display: flex;
            justify-content: space-between;
            padding: 0 var(--space-2);
        }

        .gallery-nav-btn {
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            border-radius: var(--radius-full);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: var(--z-index-modal);
        }

        .modal.open {
            display: flex;
        }

        .modal-content {
            background-color: var(--color-surface);
            border-radius: var(--radius-md);
            padding: var(--space-4);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--space-3);
        }

        /* Chatbox */
        .chat-toggle {
            position: fixed;
            bottom: var(--space-4);
            right: var(--space-4);
            width: 56px;
            height: 56px;
            border-radius: var(--radius-full);
            background-color: var(--color-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            z-index: var(--z-index-fixed);
        }

        .chatbox {
            position: fixed;
            bottom: var(--space-4);
            right: var(--space-4);
            width: 350px;
            height: 450px;
            background-color: var(--color-surface);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-xl);
            display: none;
            flex-direction: column;
            z-index: var(--z-index-modal);
        }

        .chatbox.open {
            display: flex;
        }

        .chat-header {
            background-color: var(--color-primary);
            color: white;
            padding: var(--space-3);
            border-top-left-radius: var(--radius-md);
            border-top-right-radius: var(--radius-md);
            font-weight: var(--font-weight-bold);
        }

        .chat-body {
            flex: 1;
            padding: var(--space-3);
            overflow-y: auto;
        }

        .chat-message {
            margin-bottom: var(--space-2);
            padding: var(--space-2);
            border-radius: var(--radius-md);
            max-width: 80%;
        }

        .chat-message.user {
            background-color: var(--color-primary-100);
            margin-left: auto;
        }

        .chat-message.support {
            background-color: var(--color-surface-200);
            margin-right: auto;
        }

        .chat-input-container {
            display: flex;
            border-top: 1px solid var(--color-border);
        }

        .chat-input {
            flex: 1;
            padding: var(--space-3);
            border: none;
            border-bottom-left-radius: var(--radius-md);
        }

        .chat-send-btn {
            padding: var(--space-3);
            background-color: var(--color-primary);
            color: white;
            border: none;
            border-bottom-right-radius: var(--radius-md);
        }

        /* Calendar */
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: var(--space-1);
        }

        .calendar-header {
            grid-column: span 7;
            font-weight: var(--font-weight-bold);
            text-align: center;
        }

        .calendar-day {
            padding: var(--space-1);
            text-align: center;
            cursor: pointer;
            border-radius: var(--radius-sm);
        }

        .calendar-day:hover {
            background-color: var(--color-primary-100);
        }

        .calendar-day.booked {
            background-color: var(--color-error-500);
            color: white;
            cursor: not-allowed;
        }

        .calendar-day.selected {
            background-color: var(--color-primary);
            color: white;
        }

        /* Footer */
        footer {
            background-color: var(--color-surface);
            padding: var(--space-3);
            text-align: center;
            margin-top: auto;
        }

        /* ========== RESPONSIVE DESIGN ========== */
        @media (max-width: 1024px) {
            .grid-cols-3 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: var(--space-2);
            }

            .nav-links {
                flex-direction: column;
                width: 100%;
            }

            .nav-link {
                width: 100%;
                text-align: center;
            }

            .grid-cols-3 {
                grid-template-columns: 1fr;
            }

            .search-form {
                flex-direction: column;
                gap: var(--space-2);
            }

            .hero-section {
                padding: var(--space-4) 0;
            }

            .gallery-image {
                height: 250px;
            }

            .chatbox {
                width: 90%;
                height: 70vh;
                right: var(--space-2);
                bottom: var(--space-2);
            }
        }

        /* ========== ACCESSIBILITY ========== */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        [aria-hidden="true"] {
            display: none;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header role="banner">
        <div class="container navbar">
            <a href="#home" class="logo">Green Valley</a>
            <nav class="nav-links" role="navigation">
                <a href="#home" class="nav-link active" data-page="home" aria-current="page">Beranda</a>
                <a href="#listings" class="nav-link" data-page="listings">Daftar Apartemen</a>
                <a href="#profile" class="nav-link" data-page="profile">Profil</a>
                <a href="#support" class="nav-link" data-page="support">Dukungan</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main role="main" class="flex-1">
        <div class="container">
            <!-- Home Section -->
            <section id="home" aria-labelledby="home-heading">
                <div class="hero-section">
                    <h1 id="home-heading" class="hero-title">Temukan Apartemen Premium Anda</h1>
                    <p class="hero-description">Sewa apartemen mewah di lokasi strategis dengan fasilitas
                        lengkap.</p>
                    <form class="search-form" aria-label="Pencarian cepat apartemen">
                        <input type="text" class="form-control" placeholder="Lokasi (cth: Jakarta)" aria-label="Lokasi">
                        <input type="date" class="form-control" aria-label="Tanggal check-in">
                        <input type="date" class="form-control" aria-label="Tanggal check-out">
                        <button type="submit" class="btn btn-primary">Cari</button>
                    </form>
                </div>
                <h2 class="my-4 text-2xl font-bold">Properti Unggulan</h2>
                <div class="grid grid-auto-fill gap-3 my-3" id="featured-listings"
                    aria-label="Daftar properti unggulan"></div>
            </section>

            <!-- Listings Section -->
            <section id="listings" class="hidden" aria-labelledby="listings-heading">
                <h2 id="listings-heading" class="my-4 text-2xl font-bold">Daftar Apartemen</h2>
                <form class="search-form mb-4" aria-label="Filter pencarian apartemen">
                    <input type="text" class="form-control" placeholder="Lokasi" aria-label="Lokasi">
                    <input type="number" class="form-control" placeholder="Harga Maks (Rp)" aria-label="Harga maksimum">
                    <div class="flex items-center gap-2">
                        <input type="range" class="form-control" min="0" max="50" value="10" id="radius"
                            aria-label="Radius pencarian (km)">
                        <span id="radius-value" class="text-sm">10 km</span>
                    </div>
                    <select class="form-control" aria-label="Tipe apartemen">
                        <option value="">Tipe</option>
                        <option value="studio">Studio</option>
                        <option value="1br">1 Kamar</option>
                        <option value="2br">2 Kamar</option>
                    </select>
                    <div class="flex gap-2">
                        <label class="flex items-center gap-1">
                            <input type="checkbox" name="amenities" value="wifi"> WiFi
                        </label>
                        <label class="flex items-center gap-1">
                            <input type="checkbox" name="amenities" value="ac"> AC
                        </label>
                        <label class="flex items-center gap-1">
                            <input type="checkbox" name="amenities" value="pool"> Pool
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary">Filter</button>
                </form>
                <div class="grid grid-auto-fill gap-3" id="apartment-listings" aria-label="Hasil pencarian apartemen">
                </div>
            </section>

            <!-- Apartment Detail Section -->
            <section id="apartment-detail" class="hidden" aria-labelledby="apartment-detail-heading">
                <h2 id="apartment-detail-heading" class="my-4 text-2xl font-bold"></h2>
                <figure class="gallery mb-4">
                    <div class="gallery-images" id="gallery-images"></div>
                    <div class="gallery-nav">
                        <button class="gallery-nav-btn" aria-label="Gambar sebelumnya" onclick="app.prevImage()">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="gallery-nav-btn" aria-label="Gambar berikutnya" onclick="app.nextImage()">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <figcaption id="gallery-caption" class="text-center text-muted mt-2"></figcaption>
                </figure>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <div class="md:col-span-2">
                        <div class="card">
                            <div class="card-body">
                                <p><strong>Harga:</strong> <span id="detail-price" class="price-tag"></span></p>
                                <p class="my-2"><strong>Lokasi:</strong> <span id="detail-location"></span></p>
                                <p><strong>Fasilitas:</strong> <span id="detail-amenities"></span></p>
                                <div class="map-placeholder my-3 p-3 rounded bg-surface" id="map-placeholder">
                                    Peta Lokasi (Simulasi)</div>
                                <details class="my-3">
                                    <summary class="font-bold cursor-pointer">Informasi Pemilik</summary>
                                    <div class="mt-2">
                                        <p>Pemilik: <span id="owner-name"></span> <span id="owner-status"></span></p>
                                    </div>
                                </details>
                                <div id="reviews" aria-label="Ulasan apartemen"></div>
                                <button class="btn btn-outline mt-3" onclick="app.openModal('report')">Laporkan
                                    Masalah</button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="card">
                            <div class="card-body">
                                <h3 class="text-xl font-bold mb-3">Pesan Sekarang</h3>
                                <div class="calendar mb-3" id="calendar"></div>
                                <form id="booking-form" aria-label="Formulir pemesanan">
                                    <div class="my-2">
                                        <label for="checkin" class="block font-bold mb-1">Check-in</label>
                                        <input type="date" id="checkin" class="form-control w-full" required
                                            aria-label="Tanggal check-in">
                                    </div>
                                    <div class="my-2">
                                        <label for="checkout" class="block font-bold mb-1">Check-out</label>
                                        <input type="date" id="checkout" class="form-control w-full" required
                                            aria-label="Tanggal check-out">
                                    </div>
                                    <div class="my-2">
                                        <label class="flex items-center gap-2">
                                            <input type="checkbox" id="insurance" aria-label="Tambah asuransi">
                                            <span>Tambah Asuransi (+10%)</span>
                                        </label>
                                    </div>
                                    <div class="my-2">
                                        <label for="payment-method" class="block font-bold mb-1">Metode
                                            Pembayaran</label>
                                        <select id="payment-method" class="form-control w-full"
                                            aria-label="Metode pembayaran">
                                            <option value="credit">Kartu Kredit</option>
                                            <option value="bank">Transfer Bank</option>
                                            <option value="ewallet">E-Wallet</option>
                                        </select>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-full mt-2">Pesan</button>
                                    <p class="text-sm text-muted mt-2">Pembayaran dijamin dengan escrow.</p>
                                    <div id="cost-breakdown" class="text-sm mt-2"></div>
                                </form>
                                <button class="btn btn-outline w-full mt-3" onclick="app.openChat('owner')">Chat
                                    dengan Pemilik</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Profile Section -->
            <section id="profile" class="hidden" aria-labelledby="profile-heading">
                <h2 id="profile-heading" class="my-4 text-2xl font-bold">Profil Anda</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <div class="md:col-span-2">
                        <div class="card">
                            <div class="card-body">
                                <p><strong>Nama:</strong> <span id="user-name">John Doe</span></p>
                                <p class="my-2"><strong>Email:</strong> <span
                                        id="user-email">john.doe@example.com</span></p>
                                <p><strong>Poin Loyalitas:</strong> <span id="loyalty-points">150</span></p>
                                <button class="btn btn-outline mt-3" onclick="app.openModal('edit-profile')">Edit
                                    Profil</button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="card">
                            <div class="card-body">
                                <h3 class="text-xl font-bold mb-3">Riwayat Pemesanan</h3>
                                <div id="booking-history" aria-label="Riwayat pemesanan"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Support Section -->
            <section id="support" class="hidden" aria-labelledby="support-heading">
                <h2 id="support-heading" class="my-4 text-2xl font-bold">Dukungan Pelanggan 24/7</h2>
                <div class="grid grid-auto-fill gap-3">
                    <div class="card">
                        <div class="card-body">
                            <h3 class="text-lg font-bold mb-3">Live Chat</h3>
                            <button class="btn btn-primary" onclick="app.openChat('support')">Mulai
                                Chat</button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <h3 class="text-lg font-bold mb-3">Email</h3>
                            <p><a href="mailto:support@Green Valley.com">support@Green Valley.com</a></p>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <h3 class="text-lg font-bold mb-3">Telepon</h3>
                            <p><a href="tel:+628001234567">+62 800 123 4567</a></p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Modals -->
    <div class="modal" id="edit-profile" role="dialog" aria-labelledby="edit-profile-heading" aria-modal="true"
        aria-hidden="true">
        <div class="modal-content">
            <h2 id="edit-profile-heading" class="modal-title">Edit Profil</h2>
            <form id="edit-profile-form" aria-label="Formulir edit profil">
                <div class="my-3">
                    <label for="edit-name" class="block font-bold mb-1">Nama</label>
                    <input type="text" id="edit-name" class="form-control w-full" value="John Doe"
                        aria-label="Nama pengguna">
                </div>
                <div class="my-3">
                    <label for="edit-email" class="block font-bold mb-1">Email</label>
                    <input type="email" id="edit-email" class="form-control w-full" value="john.doe@example.com"
                        aria-label="Email pengguna">
                </div>
                <div class="flex gap-2 mt-4">
                    <button type="submit" class="btn btn-primary flex-1">Simpan</button>
                    <button type="button" class="btn btn-outline flex-1" onclick="app.closeModal()">Batal</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="report" role="dialog" aria-labelledby="report-heading" aria-modal="true" aria-hidden="true">
        <div class="modal-content">
            <h2 id="report-heading" class="modal-title">Laporkan Masalah</h2>
            <form id="report-form" aria-label="Formulir pelaporan masalah">
                <div class="my-3">
                    <label for="report-issue" class="block font-bold mb-1">Masalah</label>
                    <textarea id="report-issue" class="form-control w-full" rows="4"
                        placeholder="Deskripsikan masalah..." aria-label="Deskripsi masalah"></textarea>
                </div>
                <div class="flex gap-2 mt-4">
                    <button type="submit" class="btn btn-primary flex-1">Kirim</button>
                    <button type="button" class="btn btn-outline flex-1" onclick="app.closeModal()">Batal</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Chatbox -->
    <button class="chat-toggle" id="chat-toggle" aria-label="Buka chat dukungan">
        <i class="fas fa-comment"></i>
    </button>
    <div class="chatbox" id="chatbox" aria-label="Jendela chat" aria-hidden="true">
        <div class="chat-header" id="chat-header">Dukungan Pelanggan</div>
        <div class="chat-body" id="chat-body" aria-live="polite">
            <div class="chat-message support">Selamat datang! Bagaimana kami bisa membantu Anda hari ini?</div>
        </div>
        <div class="chat-input-container">
            <input type="text" id="chat-input" class="chat-input" placeholder="Ketik pesan..." aria-label="Input pesan">
            <button class="chat-send-btn" onclick="app.sendChatMessage()" aria-label="Kirim pesan">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer role="contentinfo">
        <div class="container">
            <p>¬© 2025 Green Valley. Hak cipta dilindungi.</p>
        </div>
    </footer>

    <script>
        /**
         * Green Valley Application - Premium Apartment Rental Platform
         * 
         * This application follows SOLID principles and clean architecture patterns
         * with proper separation of concerns and modular design.
         */

        // ========== DATA SERVICES ==========
        /**
         * Simulated external services with proper interfaces
         */
        const DataService = {
            // Property data service
            properties: {
                async getAll() {
                    // In a real app, this would be an API call
                    return [
                        {
                            id: 1,
                            title: "Luxury Downtown Loft",
                            price: 2500000,
                            location: "Jakarta Pusat",
                            type: "2br",
                            amenities: ["WiFi", "AC", "Pool"],
                            images: [
                                "https://images.unsplash.com/photo-1522708323590-d24dbb6b0267",
                                "https://images.unsplash.com/photo-1502672260266-1c1ef2d93688"
                            ],
                            bookedDates: ["2025-05-20", "2025-05-21"],
                            owner: { name: "Budi Santoso", verified: true },
                            reviews: [
                                {
                                    user: "Dinda",
                                    rating: 4,
                                    comment: "Sangat nyaman!",
                                    date: "2025-05-18"
                                }
                            ]
                        },
                        {
                            id: 2,
                            title: "Modern City View",
                            price: 3200000,
                            location: "Jakarta Selatan",
                            type: "3br",
                            amenities: ["Gym", "Parking", "WiFi"],
                            images: [
                                "https://images.unsplash.com/photo-1502672260266-1c1ef2d93688",
                                "https://images.unsplash.com/photo-1493809842364-78817add7ffb"
                            ],
                            bookedDates: ["2025-05-22", "2025-05-23"],
                            owner: { name: "Siti Aminah", verified: true },
                            reviews: [
                                {
                                    user: "Rudi",
                                    rating: 5,
                                    comment: "Pelayanan cepat!",
                                    date: "2025-05-17"
                                }
                            ]
                        },
                        {
                            id: 3,
                            title: "Cozy Studio Suite",
                            price: 1800000,
                            location: "Jakarta Barat",
                            type: "studio",
                            amenities: ["WiFi", "AC"],
                            images: [
                                "https://images.unsplash.com/photo-1493809842364-78817add7ffb",
                                "https://images.unsplash.com/photo-1522708323590-d24dbb6b0267"
                            ],
                            bookedDates: [],
                            owner: { name: "Ahmad Yani", verified: false },
                            reviews: []
                        }
                    ];
                },

                async filter({ location, maxPrice, type, amenities, radius }) {
                    const properties = await this.getAll();
                    return properties.filter(property => {
                        const matchesLocation = !location ||
                            property.location.toLowerCase().includes(location.toLowerCase());
                        const matchesPrice = !maxPrice || property.price <= maxPrice;
                        const matchesType = !type || property.type === type;
                        const matchesAmenities = amenities.length === 0 ||
                            amenities.every(amenity => property.amenities.includes(amenity));

                        return matchesLocation && matchesPrice && matchesType && matchesAmenities;
                    });
                },

                async getById(id) {
                    const properties = await this.getAll();
                    return properties.find(p => p.id === id);
                }
            },

            // Booking data service
            bookings: {
                async getAll() {
                    const stored = localStorage.getItem('Green Valley-bookings');
                    return stored ? JSON.parse(stored) : [];
                },

                async create(booking) {
                    const bookings = await this.getAll();
                    bookings.push(booking);
                    localStorage.setItem('Green Valley-bookings', JSON.stringify(bookings));
                    return booking;
                }
            },

            // User data service
            users: {
                async getCurrent() {
                    const stored = localStorage.getItem('Green Valley-user');
                    return stored ? JSON.parse(stored) : {
                        name: "John Doe",
                        email: "john.doe@example.com",
                        loyaltyPoints: 150
                    };
                },

                async update(userData) {
                    localStorage.setItem('Green Valley-user', JSON.stringify(userData));
                    return userData;
                }
            }
        };

        // ========== EXTERNAL SERVICES ==========
        const ExternalServices = {
            payment: {
                async process(amount, method) {
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    return {
                        success: true,
                        id: `txn_${Date.now()}`,
                        amount,
                        method
                    };
                }
            },

            map: {
                render(elementId, location, radius) {
                    // Simulate map rendering
                    document.getElementById(elementId).textContent =
                        `Peta Lokasi: ${location} (Radius ${radius} km, Simulasi)`;
                }
            },

            chat: {
                async send(message, type) {
                    // Simulate chat service
                    await new Promise(resolve => setTimeout(resolve, 500));

                    if (type === 'support') {
                        return `Dukungan: Terima kasih atas pesan Anda: "${message}". Kami akan membantu!`;
                    } else {
                        return `Pemilik: "${message}" diterima. Kami akan segera membalas!`;
                    }
                }
            }
        };

        // ========== UTILITY FUNCTIONS ==========
        const Utils = {
            formatCurrency(amount) {
                return new Intl.NumberFormat('id-ID', {
                    style: 'currency',
                    currency: 'IDR',
                    minimumFractionDigits: 0
                }).format(amount);
            },

            formatDate(dateString) {
                return new Date(dateString).toLocaleDateString('id-ID', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            },

            getDaysBetweenDates(startDate, endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                const diff = end - start;
                return Math.ceil(diff / (1000 * 60 * 60 * 24));
            },

            generateDateRange(startDate, days) {
                return Array.from({ length: days }, (_, i) => {
                    const date = new Date(startDate);
                    date.setDate(date.getDate() + i);
                    return date.toISOString().split('T')[0];
                });
            },

            debounce(fn, delay) {
                let timeoutId;
                return function (...args) {
                    clearTimeout(timeoutId);
                    timeoutId = setTimeout(() => fn.apply(this, args), delay);
                };
            }
        };

        // ========== APPLICATION CORE ==========
        class Green ValleyApp {
            constructor() {
                this.state = {
                    currentView: 'home',
                    selectedApartment: null,
                    galleryIndex: 0,
                    chatType: 'support',
                    isChatOpen: false
                };

                this.cache = {
                    properties: null,
                    bookings: null,
                    user: null
                };

                this.init();
            }

            async init() {
                // Initialize data
                await this.loadData();

                // Setup event listeners
                this.setupEventListeners();

                // Render initial view
                const view = window.location.hash.slice(1) || 'home';
                this.switchView(view);

                // Initialize map
                ExternalServices.map.render('map-placeholder', 'Jakarta', 10);
            }

            async loadData() {
                try {
                    this.cache.properties = await DataService.properties.getAll();
                    this.cache.bookings = await DataService.bookings.getAll();
                    this.cache.user = await DataService.users.getCurrent();
                } catch (error) {
                    console.error('Failed to load data:', error);
                    // In a real app, show user-friendly error message
                }
            }

            setupEventListeners() {
                // Navigation
                document.querySelectorAll('a[href^="#"]').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.switchView(link.dataset.page);
                    });
                });

                // Home search
                document.querySelector('#home .search-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.switchView('listings');
                });

                // Listings filter
                document.querySelector('#listings .search-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.renderListings();
                });

                // Radius slider
                document.getElementById('radius').addEventListener('input', (e) => {
                    document.getElementById('radius-value').textContent = `${e.target.value} km`;
                });

                // Booking form
                document.getElementById('booking-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.processBooking(e);
                });

                // Edit profile form
                document.getElementById('edit-profile-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.editProfile(e);
                });

                // Report form
                document.getElementById('report-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.reportIssue(e);
                });

                // Chat toggle
                document.getElementById('chat-toggle').addEventListener('click', () => {
                    this.toggleChat('support');
                });

                // Chat input
                document.getElementById('chat-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.sendChatMessage();
                });

                // Hash change
                window.addEventListener('hashchange', () => {
                    const view = window.location.hash.slice(1) || 'home';
                    this.switchView(view);
                });
            }

            // ========== VIEW MANAGEMENT ==========
            async switchView(view) {
                // Validate view
                if (!['home', 'listings', 'apartment-detail', 'profile', 'support'].includes(view)) {
                    view = 'home';
                }

                // Update state
                this.state.currentView = view;
                window.location.hash = view;

                // Hide all sections
                document.querySelectorAll('section').forEach(section => {
                    section.classList.add('hidden');
                });

                // Show current section
                document.getElementById(view).classList.remove('hidden');

                // Update active nav link
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.toggle('active', link.dataset.page === view);
                    link.setAttribute('aria-current', link.dataset.page === view ? 'page' : 'false');
                });

                // Load view-specific content
                await this.loadView(view);

                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            async loadView(view) {
                switch (view) {
                    case 'home':
                        await this.renderFeaturedListings();
                        break;
                    case 'listings':
                        await this.renderListings();
                        break;
                    case 'apartment-detail':
                        await this.renderApartmentDetail();
                        break;
                    case 'profile':
                        await this.renderProfile();
                        break;
                    case 'support':
                        // No special loading needed
                        break;
                }
            }

            // ========== RENDER METHODS ==========
            async renderFeaturedListings() {
                if (!this.cache.properties) await this.loadData();

                const container = document.getElementById('featured-listings');
                if (!container) return;

                container.innerHTML = this.cache.properties.map(property => `
                    <article class="card">
                        <img src="${property.images[0]}" alt="${property.title}" class="card-img" loading="lazy">
                        <div class="card-body">
                            <h3 class="card-title">${property.title}</h3>
                            <p class="text-muted">${property.location} | ${property.type}</p>
                            <div class="flex justify-between items-center mt-2">
                                <span class="price-tag">${Utils.formatCurrency(property.price)}/bln</span>
                                <button class="btn btn-outline" onclick="app.showApartmentDetail(${property.id})">
                                    Lihat Detail
                                </button>
                            </div>
                        </div>
                    </article>
                `).join('');
            }

            async renderListings() {
                if (!this.cache.properties) await this.loadData();

                const container = document.getElementById('apartment-listings');
                if (!container) return;

                const form = document.querySelector('#listings .search-form');
                const location = form.querySelector('input[type="text"]').value;
                const maxPrice = parseInt(form.querySelector('input[type="number"]').value) || Infinity;
                const radius = parseInt(document.getElementById('radius').value);
                const type = form.querySelector('select').value;
                const amenities = Array.from(form.querySelectorAll('input[name="amenities"]:checked'))
                    .map(cb => cb.value);

                const filtered = await DataService.properties.filter({
                    location,
                    maxPrice,
                    type,
                    amenities,
                    radius
                });

                container.innerHTML = filtered.length ? filtered.map(property => `
                    <article class="card">
                        <img src="${property.images[0]}" alt="${property.title}" class="card-img" loading="lazy">
                        <div class="card-body">
                            <h3 class="card-title">${property.title}</h3>
                            <p class="text-muted">${property.location} | ${property.type}</p>
                            <div class="flex justify-between items-center mt-2">
                                <span class="price-tag">${Utils.formatCurrency(property.price)}/bln</span>
                                <button class="btn btn-outline" onclick="app.showApartmentDetail(${property.id})">
                                    Lihat Detail
                                </button>
                            </div>
                        </div>
                    </article>
                `).join('') : '<p class="text-center text-muted py-4">Tidak ada apartemen yang ditemukan.</p>';

                ExternalServices.map.render('map-placeholder', location || 'Jakarta', radius);
            }

            async showApartmentDetail(id) {
                try {
                    this.state.selectedApartment = await DataService.properties.getById(id);
                    this.state.galleryIndex = 0;
                    await this.switchView('apartment-detail');
                } catch (error) {
                    console.error('Failed to load apartment details:', error);
                    alert('Gagal memuat detail apartemen. Silakan coba lagi.');
                }
            }

            async renderApartmentDetail() {
                const apt = this.state.selectedApartment;
                if (!apt) return;

                // Set basic info
                document.getElementById('apartment-detail-heading').textContent = apt.title;
                document.getElementById('detail-price').textContent = `${Utils.formatCurrency(apt.price)}/bln`;
                document.getElementById('detail-location').textContent = apt.location;
                document.getElementById('detail-amenities').textContent = apt.amenities.join(', ');
                document.getElementById('owner-name').textContent = apt.owner.name;
                document.getElementById('owner-status').innerHTML = apt.owner.verified
                    ? '<span class="text-success">‚úì Terverifikasi</span>'
                    : '';

                // Render gallery
                const gallery = document.getElementById('gallery-images');
                gallery.innerHTML = apt.images.map((img, idx) => `
                    <img src="${img}" alt="${apt.title} - Gambar ${idx + 1}" class="gallery-image">
                `).join('');
                gallery.style.transform = `translateX(0)`;
                document.getElementById('gallery-caption').textContent = 'Gambar 1 (Tur 360¬∞ Simulasi)';

                // Render calendar
                this.renderCalendar();

                // Render reviews
                this.renderReviews();

                // Update map
                ExternalServices.map.render('map-placeholder', apt.location, 10);
            }

            renderCalendar() {
                const apt = this.state.selectedApartment;
                const container = document.getElementById('calendar');
                if (!container || !apt) return;

                const today = new Date();
                const days = Array.from({ length: 30 }, (_, i) => {
                    const date = new Date(today);
                    date.setDate(today.getDate() + i);
                    return date.toISOString().split('T')[0];
                });

                container.innerHTML = `
                    <div class="calendar-header">Sen</div>
                    ${days.map(date => {
                    const isBooked = apt.bookedDates.includes(date);
                    return `
                            <div class="calendar-day ${isBooked ? 'booked' : ''}" 
                                 data-date="${date}"
                                 ${isBooked ? 'aria-disabled="true"' : ''}>
                                ${new Date(date).getDate()}
                            </div>
                        `;
                }).join('')}
                `;

                // Add event listeners
                container.querySelectorAll('.calendar-day:not(.booked)').forEach(day => {
                    day.addEventListener('click', () => this.handleCalendarDayClick(day));
                });
            }

            handleCalendarDayClick(dayElement) {
                const date = dayElement.dataset.date;
                const checkin = document.getElementById('checkin');
                const checkout = document.getElementById('checkout');
                const calendar = document.getElementById('calendar');

                if (!checkin.value) {
                    // Select check-in date
                    checkin.value = date;
                    dayElement.classList.add('selected');
                } else if (!checkout.value && date > checkin.value) {
                    // Select check-out date
                    checkout.value = date;

                    // Select all days in range
                    const startDate = checkin.value;
                    const endDate = date;
                    const days = Utils.getDaysBetweenDates(startDate, endDate);

                    calendar.querySelectorAll('.calendar-day').forEach(day => {
                        day.classList.remove('selected');
                        const dayDate = day.dataset.date;
                        if (dayDate >= startDate && dayDate <= endDate) {
                            day.classList.add('selected');
                        }
                    });
                } else {
                    // Reset and select new check-in date
                    checkin.value = date;
                    checkout.value = '';
                    calendar.querySelectorAll('.calendar-day').forEach(day => {
                        day.classList.remove('selected');
                    });
                    dayElement.classList.add('selected');
                }
            }

            renderReviews() {
                const apt = this.state.selectedApartment;
                const container = document.getElementById('reviews');
                if (!container || !apt) return;

                container.innerHTML = apt.reviews.length ? apt.reviews.map(review => `
                    <blockquote class="my-3">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="font-bold">${review.user}</span>
                            <span class="text-muted">${Utils.formatDate(review.date)}</span>
                        </div>
                        <div class="flex items-center gap-1 mb-1">
                            ${Array.from({ length: 5 }, (_, i) => `
                                <i class="fas fa-star ${i < review.rating ? 'text-yellow-500' : 'text-gray-300'}"></i>
                            `).join('')}
                        </div>
                        <p class="text-muted">${review.comment}</p>
                    </blockquote>
                `).join('') : '<p class="text-muted py-2">Belum ada ulasan.</p>';
            }

            async renderProfile() {
                if (!this.cache.user) await this.loadData();

                document.getElementById('user-name').textContent = this.cache.user.name;
                document.getElementById('user-email').textContent = this.cache.user.email;
                document.getElementById('loyalty-points').textContent = this.cache.user.loyaltyPoints;

                const history = document.getElementById('booking-history');
                if (!history) return;

                history.innerHTML = this.cache.bookings.length ? this.cache.bookings.map(booking => `
                    <div class="my-3 border-b pb-3">
                        <p class="font-bold">${booking.title}</p>
                        <p class="text-muted text-sm">${Utils.formatDate(booking.checkin)} - ${Utils.formatDate(booking.checkout)}</p>
                        <p class="text-sm">Total: ${Utils.formatCurrency(parseFloat(booking.total))}</p>
                        <p class="text-muted text-xs">ID: ${booking.id}</p>
                    </div>
                `).join('') : '<p class="text-muted py-2">Belum ada riwayat pemesanan.</p>';
            }

            // ========== BUSINESS LOGIC ==========
            async processBooking(e) {
                e.preventDefault();

                const form = e.target;
                const checkin = form.querySelector('#checkin').value;
                const checkout = form.querySelector('#checkout').value;
                const insurance = form.querySelector('#insurance').checked;
                const paymentMethod = form.querySelector('#payment-method').value;

                // Validate dates
                if (!checkin || !checkout) {
                    alert('Silakan pilih tanggal check-in dan check-out!');
                    return;
                }

                const days = Utils.getDaysBetweenDates(checkin, checkout);
                if (days <= 0) {
                    alert('Tanggal check-out harus setelah check-in!');
                    return;
                }

                const apt = this.state.selectedApartment;
                if (!apt) {
                    alert('Tidak ada apartemen yang dipilih!');
                    return;
                }

                // Calculate costs
                const baseCost = apt.price * days / 30; // Monthly price prorated
                const insuranceCost = insurance ? baseCost * 0.1 : 0;
                const total = baseCost + insuranceCost;

                try {
                    // Process payment
                    const paymentResult = await ExternalServices.payment.process(total, paymentMethod);

                    if (paymentResult.success) {
                        // Create booking
                        const booking = {
                            id: paymentResult.id,
                            apartmentId: apt.id,
                            title: apt.title,
                            checkin,
                            checkout,
                            total: total.toString(),
                            paymentMethod,
                            timestamp: new Date().toISOString()
                        };

                        // Save booking
                        await DataService.bookings.create(booking);

                        // Update apartment booked dates (in a real app, this would be server-side)
                        apt.bookedDates.push(...Utils.generateDateRange(checkin, days));

                        // Update user loyalty points
                        this.cache.user.loyaltyPoints += Math.floor(total / 100000);
                        await DataService.users.update(this.cache.user);

                        // Show cost breakdown
                        document.getElementById('cost-breakdown').innerHTML = `
                            <p>Biaya Dasar: ${Utils.formatCurrency(baseCost)}</p>
                            ${insurance ? `<p>Asuransi: ${Utils.formatCurrency(insuranceCost)}</p>` : ''}
                            <p class="font-bold">Total: ${Utils.formatCurrency(total)}</p>
                        `;

                        // Show success message
                        alert(`Pemesanan berhasil!\nID Transaksi: ${paymentResult.id}`);

                        // Refresh profile view
                        await this.switchView('profile');
                    } else {
                        throw new Error('Payment failed');
                    }
                } catch (error) {
                    console.error('Booking error:', error);
                    alert('Pemesanan gagal. Silakan coba lagi atau hubungi dukungan.');
                }
            }

            async editProfile(e) {
                e.preventDefault();

                const form = e.target;
                const name = form.querySelector('#edit-name').value.trim();
                const email = form.querySelector('#edit-email').value.trim();

                // Validate inputs
                if (!name || !email) {
                    alert('Nama dan email harus diisi!');
                    return;
                }

                if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                    alert('Format email tidak valid!');
                    return;
                }

                try {
                    // Update user
                    this.cache.user = { ...this.cache.user, name, email };
                    await DataService.users.update(this.cache.user);

                    // Close modal and refresh
                    this.closeModal();
                    await this.renderProfile();
                    alert('Profil berhasil diperbarui!');
                } catch (error) {
                    console.error('Profile update error:', error);
                    alert('Gagal memperbarui profil. Silakan coba lagi.');
                }
            }

            async reportIssue(e) {
                e.preventDefault();

                const issue = document.getElementById('report-issue').value.trim();
                if (!issue) {
                    alert('Silakan deskripsikan masalah Anda!');
                    return;
                }

                // In a real app, this would send to a backend
                console.log('Issue reported:', issue);
                alert('Laporan Anda telah dikirim. Kami akan segera menindaklanjuti.');
                this.closeModal();
            }

            // ========== UI INTERACTIONS ==========
            prevImage() {
                const apt = this.state.selectedApartment;
                if (!apt) return;

                this.state.galleryIndex = Math.max(this.state.galleryIndex - 1, 0);
                document.getElementById('gallery-images').style.transform =
                    `translateX(-${this.state.galleryIndex * 100}%)`;
                document.getElementById('gallery-caption').textContent =
                    `Gambar ${this.state.galleryIndex + 1} (Tur 360¬∞ Simulasi)`;
            }

            nextImage() {
                const apt = this.state.selectedApartment;
                if (!apt) return;

                this.state.galleryIndex = Math.min(
                    this.state.galleryIndex + 1,
                    apt.images.length - 1
                );
                document.getElementById('gallery-images').style.transform =
                    `translateX(-${this.state.galleryIndex * 100}%)`;
                document.getElementById('gallery-caption').textContent =
                    `Gambar ${this.state.galleryIndex + 1} (Tur 360¬∞ Simulasi)`;
            }

            openModal(modalId) {
                const modal = document.getElementById(modalId);
                if (!modal) return;

                modal.classList.add('open');
                modal.setAttribute('aria-hidden', 'false');
                document.querySelector(`#${modalId} input, #${modalId} textarea`).focus();
            }

            closeModal() {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('open');
                    modal.setAttribute('aria-hidden', 'true');
                });
            }

            toggleChat(type = 'support') {
                this.state.chatType = type;
                this.state.isChatOpen = !this.state.isChatOpen;

                const chatbox = document.getElementById('chatbox');
                const chatHeader = document.getElementById('chat-header');

                if (this.state.isChatOpen) {
                    chatHeader.textContent = type === 'support'
                        ? 'Dukungan Pelanggan 24/7'
                        : 'Chat dengan Pemilik';
                    chatbox.classList.add('open');
                    chatbox.setAttribute('aria-hidden', 'false');
                    document.getElementById('chat-input').focus();
                } else {
                    chatbox.classList.remove('open');
                    chatbox.setAttribute('aria-hidden', 'true');
                }
            }

            async sendChatMessage() {
                const input = document.getElementById('chat-input');
                const message = input.value.trim();
                if (!message) return;

                const body = document.getElementById('chat-body');

                // Add user message
                body.innerHTML += `
                    <div class="chat-message user">
                        ${message}
                    </div>
                `;

                // Clear input
                input.value = '';

                // Scroll to bottom
                body.scrollTop = body.scrollHeight;

                try {
                    // Get response from chat service
                    const response = await ExternalServices.chat.send(message, this.state.chatType);

                    // Add response message
                    body.innerHTML += `
                        <div class="chat-message support">
                            ${response}
                        </div>
                    `;

                    // Scroll to bottom again
                    body.scrollTop = body.scrollHeight;
                } catch (error) {
                    console.error('Chat error:', error);

                    // Show error message
                    body.innerHTML += `
                        <div class="chat-message support">
                            Maaf, terjadi kesalahan. Silakan coba lagi nanti.
                        </div>
                    `;

                    body.scrollTop = body.scrollHeight;
                }
            }

            openChat(type) {
                this.state.chatType = type;
                if (!this.state.isChatOpen) {
                    this.toggleChat(type);
                } else {
                    const chatHeader = document.getElementById('chat-header');
                    chatHeader.textContent = type === 'support'
                        ? 'Dukungan Pelanggan 24/7'
                        : 'Chat dengan Pemilik';
                }
            }
        }

        // Initialize the application
        const app = new Green ValleyApp();

        // Expose app to global scope for HTML event handlers
        window.app = app;
    </script>
</body>

</html>