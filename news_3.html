<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Green Valley Rentals - Aplikasi Monolith SPA</title>
    <style>
        /* === 0. Reset CSS Dasar & Variabel Global === */
        :root {
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            --font-display: 'Poppins', var(--font-sans);
            /* Palet Warna Terang (Light Mode) */
            --color-primary-light-val: 34, 197, 94;
            /* #22c55e */
            --color-primary-default-val: 5, 150, 105;
            /* #059669 */
            --color-primary-dark-val: 4, 120, 87;
            /* #047857 */

            --color-secondary-light-val: 251, 191, 36;
            /* #fbb_f24 */
            --color-secondary-default-val: 217, 119, 6;
            /* #d97706 */
            --color-secondary-dark-val: 180, 83, 9;
            /* #b45309 */

            --color-background-light-val: 248, 250, 252;
            /* #f8fafc (slate-50) */
            --color-surface-light-val: 255, 255, 255;
            /* #ffffff */
            --color-text-light-val: 30, 41, 59;
            /* #1e293b (slate-800) */
            --color-border-light-val: 226, 232, 240;
            /* #e2e8f0 (slate-200) */
            --color-muted-light-val: 100, 116, 139;
            /* #64748b (slate-500) */

            /* Palet Warna Gelap (Dark Mode) - akan di-override di .dark */
            --color-primary-light: rgb(var(--color-primary-light-val));
            --color-primary-default: rgb(var(--color-primary-default-val));
            --color-primary-dark: rgb(var(--color-primary-dark-val));

            --color-secondary-light: rgb(var(--color-secondary-light-val));
            --color-secondary-default: rgb(var(--color-secondary-default-val));
            --color-secondary-dark: rgb(var(--color-secondary-dark-val));

            --color-background: rgb(var(--color-background-light-val));
            --color-surface: rgb(var(--color-surface-light-val));
            --color-text-default: rgb(var(--color-text-light-val));
            --color-text-muted: rgb(var(--color-muted-light-val));
            --color-border: rgb(var(--color-border-light-val));

            /* Ukuran & Spasi */
            --spacing-1: 0.25rem;
            /* 4px */
            --spacing-2: 0.5rem;
            /* 8px */
            --spacing-3: 0.75rem;
            /* 12px */
            --spacing-4: 1rem;
            /* 16px */
            --spacing-6: 1.5rem;
            /* 24px */
            --spacing-8: 2rem;
            /* 32px */
            --spacing-12: 3rem;
            /* 48px */

            --border-radius-sm: 0.25rem;
            --border-radius-md: 0.375rem;
            --border-radius-lg: 0.5rem;
            --border-radius-xl: 0.75rem;
            --border-radius-full: 9999px;

            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --shadow-inner: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);

            --transition-duration: 0.3s;
            --transition-timing: ease-in-out;

            /* Untuk Focus Ring Sederhana */
            --ring-width: 2px;
            --ring-offset-width: 2px;
            --ring-color-default: rgba(var(--color-primary-default-val), 0.5);
        }

        .dark {
            --color-background-dark-val: 15, 23, 42;
            /* #0f172a (slate-900) */
            --color-surface-dark-val: 30, 41, 59;
            /* #1e293b (slate-800) */
            --color-text-dark-val: 226, 232, 240;
            /* #e2e8f0 (slate-200) */
            --color-border-dark-val: 51, 65, 85;
            /* #334155 (slate-700) */
            --color-muted-dark-val: 148, 163, 184;
            /* #94a3b8 (slate-400) */

            --color-background: rgb(var(--color-background-dark-val));
            --color-surface: rgb(var(--color-surface-dark-val));
            --color-text-default: rgb(var(--color-text-dark-val));
            --color-text-muted: rgb(var(--color-muted-dark-val));
            --color-border: rgb(var(--color-border-dark-val));
            --ring-color-default: rgba(var(--color-primary-light-val), 0.6);
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
            -moz-tab-size: 4;
            tab-size: 4;
            font-family: var(--font-sans);
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--color-background);
            color: var(--color-text-default);
            transition: background-color var(--transition-duration) var(--transition-timing), color var(--transition-duration) var(--transition-timing);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        #app-root {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        main {
            /* Diterapkan pada elemen <main> yang dibuat JS */
            flex-grow: 1;
        }

        /* === 1. Utilitas CSS (Pengganti kelas Tailwind) === */
        .hidden {
            display: none !important;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        .flex {
            display: flex;
        }

        .inline-flex {
            display: inline-flex;
        }

        .grid {
            display: grid;
        }

        .items-center {
            align-items: center;
        }

        .items-start {
            align-items: flex-start;
        }

        .items-end {
            align-items: flex-end;
        }

        .justify-center {
            justify-content: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-end {
            justify-content: flex-end;
        }

        .flex-col {
            flex-direction: column;
        }

        .flex-grow {
            flex-grow: 1;
        }

        .flex-shrink-0 {
            flex-shrink: 0;
        }

        .space-x-1> :not([hidden])~ :not([hidden]) {
            margin-left: var(--spacing-1);
        }

        .space-x-2> :not([hidden])~ :not([hidden]) {
            margin-left: var(--spacing-2);
        }

        .space-x-3> :not([hidden])~ :not([hidden]) {
            margin-left: var(--spacing-3);
        }

        .space-x-4> :not([hidden])~ :not([hidden]) {
            margin-left: var(--spacing-4);
        }

        .space-y-2> :not([hidden])~ :not([hidden]) {
            margin-top: var(--spacing-2);
        }

        .space-y-3> :not([hidden])~ :not([hidden]) {
            margin-top: var(--spacing-3);
        }

        .space-y-4> :not([hidden])~ :not([hidden]) {
            margin-top: var(--spacing-4);
        }

        .space-y-6> :not([hidden])~ :not([hidden]) {
            margin-top: var(--spacing-6);
        }

        .space-y-8> :not([hidden])~ :not([hidden]) {
            margin-top: var(--spacing-8);
        }

        .space-y-12> :not([hidden])~ :not([hidden]) {
            margin-top: var(--spacing-12);
        }

        .gap-4 {
            gap: var(--spacing-4);
        }

        .gap-6 {
            gap: var(--spacing-6);
        }

        .p-1 {
            padding: var(--spacing-1);
        }

        .p-2 {
            padding: var(--spacing-2);
        }

        .p-3 {
            padding: var(--spacing-3);
        }

        .p-4 {
            padding: var(--spacing-4);
        }

        .p-6 {
            padding: var(--spacing-6);
        }

        .py-1 {
            padding-top: var(--spacing-1);
            padding-bottom: var(--spacing-1);
        }

        .py-2 {
            padding-top: var(--spacing-2);
            padding-bottom: var(--spacing-2);
        }

        .py-3 {
            padding-top: var(--spacing-3);
            padding-bottom: var(--spacing-3);
        }

        .py-4 {
            padding-top: var(--spacing-4);
            padding-bottom: var(--spacing-4);
        }

        .py-8 {
            padding-top: var(--spacing-8);
            padding-bottom: var(--spacing-8);
        }

        .py-12 {
            padding-top: var(--spacing-12);
            padding-bottom: var(--spacing-12);
        }

        .px-2 {
            padding-left: var(--spacing-2);
            padding-right: var(--spacing-2);
        }

        .px-3 {
            padding-left: var(--spacing-3);
            padding-right: var(--spacing-3);
        }

        .px-4 {
            padding-left: var(--spacing-4);
            padding-right: var(--spacing-4);
        }

        .px-6 {
            padding-left: var(--spacing-6);
            padding-right: var(--spacing-6);
        }

        .pt-3 {
            padding-top: var(--spacing-3);
        }

        .pt-4 {
            padding-top: var(--spacing-4);
        }

        .mb-1 {
            margin-bottom: var(--spacing-1);
        }

        .mb-2 {
            margin-bottom: var(--spacing-2);
        }

        .mb-3 {
            margin-bottom: var(--spacing-3);
        }

        .mb-4 {
            margin-bottom: var(--spacing-4);
        }

        .mb-6 {
            margin-bottom: var(--spacing-6);
        }

        .mb-8 {
            margin-bottom: var(--spacing-8);
        }

        .mt-1 {
            margin-top: var(--spacing-1);
        }

        .mt-2 {
            margin-top: var(--spacing-2);
        }

        .mt-4 {
            margin-top: var(--spacing-4);
        }

        .mt-auto {
            margin-top: auto;
        }

        .mr-1 {
            margin-right: var(--spacing-1);
        }

        .mr-1\.5 {
            margin-right: calc(var(--spacing-1) * 1.5);
        }

        /* 6px */
        .mr-2 {
            margin-right: var(--spacing-2);
        }

        .mr-3 {
            margin-right: var(--spacing-3);
        }

        .ml-2 {
            margin-left: var(--spacing-2);
        }

        .ml-auto {
            margin-left: auto;
        }

        .mx-auto {
            margin-left: auto;
            margin-right: auto;
        }

        .text-xs {
            font-size: 0.75rem;
            line-height: 1rem;
        }

        .text-sm {
            font-size: 0.875rem;
            line-height: 1.25rem;
        }

        .text-base {
            font-size: 1rem;
            line-height: 1.5rem;
        }

        .text-lg {
            font-size: 1.125rem;
            line-height: 1.75rem;
        }

        .text-xl {
            font-size: 1.25rem;
            line-height: 1.75rem;
        }

        .text-2xl {
            font-size: 1.5rem;
            line-height: 2rem;
        }

        .text-3xl {
            font-size: 1.875rem;
            line-height: 2.25rem;
        }

        .text-4xl {
            font-size: 2.25rem;
            line-height: 2.5rem;
        }

        .text-5xl {
            font-size: 3rem;
            line-height: 1;
        }

        .font-normal {
            font-weight: 400;
        }

        .font-medium {
            font-weight: 500;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-bold {
            font-weight: 700;
        }

        .font-extrabold {
            font-weight: 800;
        }

        .uppercase {
            text-transform: uppercase;
        }

        .tracking-wider {
            letter-spacing: 0.05em;
        }

        .text-center {
            text-align: center;
        }

        .truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .line-clamp-3 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;

        }

        .text-white {
            color: #fff !important;
        }

        /* !important untuk override */
        .text-primary {
            color: var(--color-primary-default);
        }

        .dark .text-primary-light {
            color: var(--color-primary-light);
        }

        .text-secondary {
            color: var(--color-secondary-default);
        }

        .dark .text-secondary-light {
            color: var(--color-secondary-light);
        }

        .text-slate-300 {
            color: #cbd5e1;
        }

        /* Konsisten di light/dark */
        .text-slate-400 {
            color: #94a3b8;
        }

        /* Konsisten di light/dark */
        .text-slate-500 {
            color: rgb(var(--color-muted-light-val));
        }

        .dark .text-slate-500 {
            color: rgb(var(--color-muted-dark-val));
        }

        .text-slate-600 {
            color: #475569;
        }

        .dark .text-slate-600 {
            color: #64748b;
        }

        /* Disesuaikan untuk dark mode agar terbaca */
        .text-yellow-400 {
            color: #facc15;
        }

        .text-red-500 {
            color: #ef4444;
        }

        .text-text-default {
            color: var(--color-text-default);
        }

        .text-text-muted {
            color: var(--color-text-muted);
        }

        .bg-transparent {
            background-color: transparent;
        }

        .bg-primary {
            background-color: var(--color-primary-default);
        }

        .dark .bg-primary-light {
            background-color: var(--color-primary-light);
        }

        .bg-primary\/10 {
            background-color: rgba(var(--color-primary-default-val), 0.1);
        }

        .dark .bg-primary\/5 {
            background-color: rgba(var(--color-primary-default-val), 0.05);
        }

        .dark .bg-primary\/20 {
            background-color: rgba(var(--color-primary-default-val), 0.2);
        }

        .bg-secondary {
            background-color: var(--color-secondary-default);
        }

        .bg-secondary\/10 {
            background-color: rgba(var(--color-secondary-default-val), 0.1);
        }

        .dark .bg-secondary\/5 {
            background-color: rgba(var(--color-secondary-default-val), 0.05);
        }

        .dark .bg-secondary\/20 {
            background-color: rgba(var(--color-secondary-default-val), 0.2);
        }

        .bg-surface {
            background-color: var(--color-surface);
        }

        .bg-slate-50 {
            background-color: #f8fafc;
        }

        .dark .bg-slate-50 {
            background-color: var(--color-surface);
        }

        /* Menyesuaikan dark mode */
        .dark .bg-slate-700\/50 {
            background-color: rgba(51, 65, 85, 0.5);
        }

        .bg-black\/50 {
            background-color: rgba(0, 0, 0, 0.5);
        }

        .bg-green-500 {
            background-color: #22c55e;
        }

        .bg-yellow-500 {
            background-color: #eab308;
        }

        .bg-blue-500 {
            background-color: #3b82f6;
        }

        .bg-red-500 {
            background-color: #ef4444;
        }

        .hover\:bg-primary-dark:hover {
            background-color: var(--color-primary-dark);
        }

        .hover\:bg-secondary-dark:hover {
            background-color: var(--color-secondary-dark);
        }

        .hover\:bg-primary\/10:hover {
            background-color: rgba(var(--color-primary-default-val), 0.1);
        }

        .dark .hover\:bg-primary\/10:hover {
            background-color: rgba(var(--color-primary-light-val), 0.15);
        }

        .hover\:bg-slate-100:hover {
            background-color: #f1f5f9;
        }

        .dark .hover\:bg-slate-700:hover {
            background-color: #334155;
        }

        .hover\:bg-red-600:hover {
            background-color: #dc2626;
        }

        .hover\:opacity-80:hover {
            opacity: 0.8;
        }

        .border {
            border-width: 1px;
            border-style: solid;
            border-color: var(--color-border);
        }

        .border-t {
            border-top-width: 1px;
            border-style: solid;
            border-color: var(--color-border);
        }

        .border-l-4 {
            border-left-width: 4px;
            border-style: solid;
        }

        .border-blue-500 {
            border-color: #3b82f6 !important;
        }

        .border-green-500 {
            border-color: #22c55e !important;
        }

        .border-yellow-500 {
            border-color: #eab308 !important;
        }

        .border-red-500 {
            border-color: #ef4444 !important;
        }

        .rounded-sm {
            border-radius: var(--border-radius-sm);
        }

        .rounded-md {
            border-radius: var(--border-radius-md);
        }

        .rounded-lg {
            border-radius: var(--border-radius-lg);
        }

        .rounded-xl {
            border-radius: var(--border-radius-xl);
        }

        .rounded-full {
            border-radius: var(--border-radius-full);
        }

        .rounded-t-lg {
            border-top-left-radius: var(--border-radius-lg);
            border-top-right-radius: var(--border-radius-lg);
        }

        .rounded-r-md {
            border-top-right-radius: var(--border-radius-md);
            border-bottom-right-radius: var(--border-radius-md);
        }

        .rounded-t {
            border-top-left-radius: var(--border-radius-md);
            border-top-right-radius: var(--border-radius-md);
        }

        .w-full {
            width: 100%;
        }

        .w-2 {
            width: var(--spacing-2);
        }

        .h-2 {
            height: var(--spacing-2);
        }

        .w-2\.5 {
            width: 0.625rem;
        }

        .h-2\.5 {
            height: 0.625rem;
        }

        /* 10px */
        .w-4 {
            width: var(--spacing-4);
        }

        .h-4 {
            height: var(--spacing-4);
        }

        .w-5 {
            width: 1.25rem;
        }

        .h-5 {
            height: 1.25rem;
        }

        /* 20px */
        .w-6 {
            width: var(--spacing-6);
        }

        .h-6 {
            height: var(--spacing-6);
        }

        .w-8 {
            width: var(--spacing-8);
        }

        .h-8 {
            height: var(--spacing-8);
        }

        .w-10 {
            width: 2.5rem;
        }

        /* 40px */
        .w-12 {
            width: var(--spacing-12);
        }

        .h-12 {
            height: var(--spacing-12);
        }

        .h-16 {
            height: 4rem;
        }

        /* 64px */
        .h-40 {
            height: 10rem;
        }

        /* 160px */
        .h-48 {
            height: 12rem;
        }

        /* 192px */
        .h-64 {
            height: 16rem;
        }

        /* 256px */
        .min-w-max {
            min-width: max-content;
        }

        .min-w-0 {
            min-width: 0;
        }

        .shadow-sm {
            box-shadow: var(--shadow-sm);
        }

        .shadow-md {
            box-shadow: var(--shadow-md);
        }

        .shadow-lg {
            box-shadow: var(--shadow-lg);
        }

        .shadow-xl {
            box-shadow: var(--shadow-xl);
        }

        .shadow-2xl {
            box-shadow: var(--shadow-2xl);
        }

        .shadow-inner {
            box-shadow: var(--shadow-inner);
        }

        .opacity-70 {
            opacity: 0.7;
        }

        .opacity-75 {
            opacity: 0.75;
        }

        .opacity-90 {
            opacity: 0.9;
        }

        .overflow-hidden {
            overflow: hidden;
        }

        .overflow-x-auto {
            overflow-x: auto;
        }

        .object-cover {
            object-fit: cover;
        }

        .cursor-pointer {
            cursor: pointer;
        }

        .cursor-not-allowed {
            cursor: not-allowed;
        }

        .backdrop-blur-sm {
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
        }

        .backdrop-blur-md {
            -webkit-backdrop-filter: blur(12px);
            backdrop-filter: blur(12px);
        }

        .transition-all {
            transition-property: all;
            transition-duration: var(--transition-duration);
            transition-timing-function: var(--transition-timing);
        }

        .transition-colors {
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, box-shadow;
            transition-timing-function: var(--transition-timing);
            transition-duration: var(--transition-duration);
        }

        .transition-shadow {
            transition-property: box-shadow;
            transition-timing-function: var(--transition-timing);
            transition-duration: var(--transition-duration);
        }

        .transition-transform {
            transition-property: transform;
            transition-timing-function: var(--transition-timing);
            transition-duration: var(--transition-duration);
        }

        .transition-opacity {
            transition-property: opacity;
            transition-timing-function: var(--transition-timing);
            transition-duration: var(--transition-duration);
        }

        .duration-200 {
            transition-duration: 0.2s;
        }

        .duration-300 {
            transition-duration: 0.3s;
        }

        .duration-500 {
            transition-duration: 0.5s;
        }

        .ease-in-out {
            transition-timing-function: ease-in-out;
        }

        .ease-out {
            transition-timing-function: ease-out;
        }

        .transform {
            /* diperlukan untuk beberapa properti transform */
        }

        .hover\:scale-105:hover {
            transform: scale(1.05);
        }

        .hover\:scale-110:hover {
            transform: scale(1.10);
        }

        .active\:scale-95:active {
            transform: scale(0.95);
        }

        .sticky {
            position: sticky;
        }

        .fixed {
            position: fixed;
        }

        .absolute {
            position: absolute;
        }

        .relative {
            position: relative;
        }

        .top-0 {
            top: 0;
        }

        .top-2 {
            top: var(--spacing-2);
        }

        .right-2 {
            right: var(--spacing-2);
        }

        .inset-0 {
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }

        .z-40 {
            z-index: 40;
        }

        .z-50 {
            z-index: 50;
        }

        .group:hover .group-hover\:font-semibold {
            font-weight: 600;
        }

        /* Contoh group hover */

        .container {
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            padding-left: var(--spacing-4);
            padding-right: var(--spacing-4);
        }

        @media (min-width: 640px) {

            /* sm */
            .container {
                max-width: 640px;
                padding-left: var(--spacing-6);
                padding-right: var(--spacing-6);
            }

            .sm\:grid-cols-2 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .sm\:inline {
                display: inline !important;
            }

            .sm\:text-5xl {
                font-size: 3rem;
                line-height: 1;
            }

            .sm\:space-x-2> :not([hidden])~ :not([hidden]) {
                margin-left: var(--spacing-2);
            }

            .sm\:px-3 {
                padding-left: var(--spacing-3);
                padding-right: var(--spacing-3);
            }

            .sm\:mr-1\.5 {
                margin-right: calc(var(--spacing-1) * 1.5);
            }

            .sm\:flex-row {
                flex-direction: row;
            }

            .sm\:items-center {
                align-items: center;
            }

            .sm\:mb-0 {
                margin-bottom: 0;
            }

            .sm\:self-center {
                align-self: center;
            }
        }

        @media (min-width: 768px) {

            /* md */
            .container {
                max-width: 768px;
            }

            .md\:grid-cols-2 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .md\:grid-cols-3 {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
        }

        @media (min-width: 1024px) {

            /* lg */
            .container {
                max-width: 1024px;
                padding-left: var(--spacing-8);
                padding-right: var(--spacing-8);
            }

            .lg\:grid-cols-3 {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
        }

        @media (min-width: 1280px) {

            /* xl */
            .container {
                max-width: 1280px;
            }
        }

        /* Focus States Sederhana */
        *:focus-visible {
            /* Menggunakan :focus-visible untuk aksesibilitas yang lebih baik */
            outline: var(--ring-width) solid var(--ring-color-default);
            outline-offset: var(--ring-offset-width);
            box-shadow: 0 0 0 var(--ring-offset-width) var(--color-background);
            /* Meniru efek offset ring Tailwind */
        }

        /* Tombol dan input mungkin memerlukan styling focus khusus jika :focus-visible di atas terlalu generik */
        .button-base:focus-visible,
        .form-input:focus-visible,
        .form-select:focus-visible,
        .form-textarea:focus-visible {
            /* Properti focus ring akan diatur oleh kelas button dan form di bawah */
        }

        /* === 2. Animasi & Spinner === */
        @keyframes fadeIn {
            0% {
                opacity: '0'
            }

            100% {
                opacity: '1'
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes slideUp {
            0% {
                transform: 'translateY(20px)';
                opacity: '0';
            }

            100% {
                transform: 'translateY(0)';
                opacity: '1';
            }
        }

        .animate-slide-up {
            animation: slideUp 0.5s ease-out forwards;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        .spinner-ring {
            border-radius: 50%;
            border-style: solid;
            border-top-color: transparent !important;
        }

        .spinner-sm {
            width: var(--spacing-4);
            height: var(--spacing-4);
            border-width: 2px;
        }

        .spinner-md {
            width: var(--spacing-8);
            height: var(--spacing-8);
            border-width: 4px;
        }

        .spinner-lg {
            width: var(--spacing-12);
            height: var(--spacing-12);
            border-width: 6px;
        }


        /* === 3. Komponen Spesifik === */
        /* Tombol */
        .button-base {
            font-weight: 600;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            transition: all var(--transition-duration) var(--transition-timing);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            text-decoration: none;
            border: 1px solid transparent;
            /* Untuk konsistensi dan focus ring */
            outline: none;
            /* Kita gunakan box-shadow untuk focus */
        }

        .button-base:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .button-base:active:not(:disabled) {
            transform: translateY(0px);
            box-shadow: var(--shadow-sm);
        }

        .button-base:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: var(--shadow-sm);
        }

        .button-base:focus-visible {
            outline: none;
            /* Dihapus karena kita menggunakan box-shadow */
            box-shadow: 0 0 0 var(--ring-offset-width) var(--color-background), 0 0 0 calc(var(--ring-offset-width) + var(--ring-width)) var(--_focus-ring-color, var(--ring-color-default));
        }

        .button-sz-sm {
            padding: var(--spacing-1) var(--spacing-3);
            font-size: var(--text-sm);
        }

        .button-sz-md {
            padding: var(--spacing-2) var(--spacing-4);
            font-size: var(--text-base);
        }

        .button-sz-lg {
            padding: var(--spacing-3) var(--spacing-6);
            font-size: var(--text-lg);
        }

        .button-primary {
            background-color: var(--color-primary-default);
            color: white;
            border-color: var(--color-primary-dark);
            --_focus-ring-color: var(--color-primary-default);
        }

        .button-primary:hover:not(:disabled) {
            background-color: var(--color-primary-dark);
        }

        .button-secondary {
            background-color: var(--color-secondary-default);
            color: white;
            border-color: var(--color-secondary-dark);
            --_focus-ring-color: var(--color-secondary-default);
        }

        .button-secondary:hover:not(:disabled) {
            background-color: var(--color-secondary-dark);
        }

        .button-ghost {
            background-color: transparent;
            color: var(--color-primary-default);
            box-shadow: none !important;
            border-color: transparent;
            --_focus-ring-color: var(--color-primary-default);
        }

        .button-ghost:hover:not(:disabled) {
            background-color: rgba(var(--color-primary-default-val), 0.1);
            transform: none;
        }

        .dark .button-ghost {
            color: var(--color-primary-light);
        }

        .dark .button-ghost:hover:not(:disabled) {
            background-color: rgba(var(--color-primary-light-val), 0.15);
        }

        .button-danger {
            background-color: #ef4444;
            color: white;
            border-color: #dc2626;
            --_focus-ring-color: #ef4444;
        }

        .button-danger:hover:not(:disabled) {
            background-color: #dc2626;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.6);
            /* Lebih gelap sedikit */
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
            padding: var(--spacing-4);
            /* Padding untuk konten modal tidak menempel tepi layar kecil */
        }

        .modal-content {
            background-color: var(--color-surface);
            border-radius: var(--border-radius-xl);
            /* Lebih bulat */
            box-shadow: var(--shadow-2xl);
            padding: var(--spacing-6);
            width: 100%;
            max-height: calc(100vh - (2 * var(--spacing-4)));
            /* Max height dengan padding overlay */
            overflow-y: auto;
            /* Jika konten lebih panjang dari modal */
        }

        .modal-content.size-sm {
            max-width: 24rem;
        }

        .modal-content.size-md {
            max-width: 28rem;
        }

        .modal-content.size-lg {
            max-width: 36rem;
        }

        /* Disesuaikan */
        .modal-content.size-xl {
            max-width: 42rem;
        }

        /* Disesuaikan */

        /* Header & Footer */
        .app-header {
            background-color: rgba(var(--color-surface-light-val), 0.85);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 40;
            -webkit-backdrop-filter: blur(12px);
            backdrop-filter: blur(12px);
            transition: background-color var(--transition-duration) var(--transition-timing);
        }

        .dark .app-header {
            background-color: rgba(var(--color-surface-dark-val), 0.85);
        }

        .app-footer {
            background-color: var(--color-surface);
            border-top: 1px solid var(--color-border);
            padding: var(--spacing-8) var(--spacing-4);
            text-align: center;
            flex-shrink: 0;
            /* Mencegah footer menyusut */
            transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing);
        }

        /* Input Forms */
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: var(--spacing-2) var(--spacing-3);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius-md);
            background-color: var(--color-surface);
            /* Agar theme background terlihat, dan konsisten */
            color: var(--color-text-default);
            transition: border-color var(--transition-duration) var(--transition-timing), box-shadow var(--transition-duration) var(--transition-timing);
            font-size: var(--text-base);
        }

        .form-input:focus-visible,
        .form-select:focus-visible,
        .form-textarea:focus-visible {
            border-color: var(--color-primary-default);
            --_focus-ring-color: var(--color-primary-default);
            /* Untuk shadow focus global */
            box-shadow: 0 0 0 var(--ring-offset-width) var(--color-background), 0 0 0 calc(var(--ring-offset-width) + var(--ring-width)) var(--_focus-ring-color);
            outline: none;
        }

        .dark .form-input:focus-visible,
        .dark .form-select:focus-visible,
        .dark .form-textarea:focus-visible {
            border-color: var(--color-primary-light);
            --_focus-ring-color: var(--color-primary-light);
        }

        .form-label {
            display: block;
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--color-text-muted);
            margin-bottom: var(--spacing-1);
        }

        /* Kartu Properti */
        .property-card {
            display: flex;
            flex-direction: column;
            height: 100%;
            background-color: var(--color-surface);
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            transition: box-shadow var(--transition-duration) var(--transition-timing), transform var(--transition-duration) var(--transition-timing);
        }

        .property-card.clickable:hover {
            box-shadow: var(--shadow-xl);
            transform: translateY(-4px);
        }

        .property-card-image-container {
            position: relative;
            height: var(--h-48);
            /* h-48 */
            width: 100%;
            overflow: hidden;
        }

        .property-card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease-in-out;
        }

        .property-card.clickable:hover .property-card-image {
            transform: scale(1.05);
        }

        .property-card-status-badge {
            position: absolute;
            top: var(--spacing-3);
            /* Disesuaikan */
            right: var(--spacing-3);
            /* Disesuaikan */
            padding: var(--spacing-1) var(--spacing-2);
            font-size: var(--text-xs);
            font-weight: 600;
            border-radius: var(--border-radius-md);
            color: white;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
        }

        .property-card-status-badge.available {
            background-color: var(--color-primary-default);
        }

        .property-card-status-badge.rented {
            background-color: var(--color-secondary-default);
        }

        .property-card-content {
            padding: var(--spacing-4);
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .property-card-description {
            flex-grow: 1;
        }

        /* Notifikasi Item */
        .notification-item {
            display: flex;
            align-items: flex-start;
            padding: var(--spacing-4);
            border-left-width: 4px;
            border-style: solid;
            border-radius: 0 var(--border-radius-md) var(--border-radius-md) 0;
            /* rounded-r-md */
            box-shadow: var(--shadow-sm);
            transition: background-color var(--transition-duration) var(--transition-timing);
            background-color: var(--color-surface);
        }

        .notification-item:hover {
            background-color: rgba(var(--color-primary-default-val), 0.05);
        }

        .dark .notification-item:hover {
            background-color: rgba(var(--color-primary-light-val), 0.08);
        }

        .notification-item.read {
            opacity: 0.7;
        }

        .notification-icon-wrapper {
            margin-right: var(--spacing-3);
            padding: var(--spacing-2);
            border-radius: var(--border-radius-full);
            color: white;
            flex-shrink: 0;
        }

        .notification-content {
            flex: 1 1 0%;
            /* flex-1 min-w-0 */
            min-width: 0;
        }

        .notification-unread-dot {
            margin-left: auto;
            width: var(--w-2-5);
            /* 10px */
            height: var(--h-2-5);
            /* 10px */
            background-color: var(--color-primary-default);
            border-radius: var(--border-radius-full);
            align-self: center;
            flex-shrink: 0;
        }

        .dark .notification-unread-dot {
            background-color: var(--color-primary-light);
        }


        /* Chart sederhana */
        .simple-chart-bar-container {
            padding: var(--spacing-4);
            background-color: rgba(var(--color-muted-light-val), 0.05);
            /* Lebih lembut */
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-inner);
            overflow-x: auto;
        }

        .dark .simple-chart-bar-container {
            background-color: rgba(var(--color-muted-dark-val), 0.08);
        }

        .simple-chart-bars {
            display: flex;
            gap: var(--spacing-2);
            /* Menggantikan space-x */
            align-items: flex-end;
            height: var(--h-40);
            min-width: max-content;
        }

        .simple-chart-bar-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-shrink: 0;
            width: var(--w-10);
            text-align: center;
        }

        .simple-chart-bar {
            width: 100%;
            background-color: var(--color-primary-default);
            border-radius: var(--border-radius-t);
            cursor: pointer;
            transition: height 0.3s ease-in-out, opacity 0.2s ease-in-out;
        }

        .dark .simple-chart-bar {
            background-color: var(--color-primary-light);
        }

        .simple-chart-bar:hover {
            opacity: 0.8;
        }

        .simple-chart-label {
            font-size: var(--text-xs);
            margin-top: var(--spacing-1);
            color: var(--color-text-muted);
            transition: font-weight 0.2s ease-in-out;
        }

        .simple-chart-bar-wrapper:hover .simple-chart-label {
            font-weight: 600;
        }
    </style>
</head>

<body>
    <div id="app-root">
        <!-- Konten aplikasi akan dirender di sini oleh JavaScript -->
    </div>

    <script type="module">
        // === PENJELASAN ARSITEKTUR ===
        // Aplikasi "Green Valley Rentals" ini adalah sebuah Single Page Application (SPA)
        // yang dibangun secara monolith (semua kode dalam satu file HTML).
        // Arsitektur internalnya mengikuti prinsip-prinsip modern:
        // 1. HTML5 Semantik: Penggunaan tag HTML yang tepat.
        // 2. JavaScript Vanilla Native: Tanpa framework/library eksternal.
        // 3. CSS Kustom: Termasuk variabel CSS untuk tema dan kelas utilitas.
        // 4. Arsitektur Berbasis Komponen (Native SFC style): Fungsi JS membuat elemen DOM.
        // 5. State Management Sederhana: Objek global `appState` memicu `renderApp()`.
        // 6. Routing Sisi Klien: Menggunakan URL hash (`#`).
        // 7. Render Dinamis: `renderApp()` memperbarui UI berdasarkan state.
        // 8. Utilitas dan Layanan: Fungsi helper dan simulasi API.
        // 9. Prinsip Desain: Bersih, modular, responsif, interaktif, tema terang/gelap.
        // ==============================
        'use strict';

        // --- 0. Inisialisasi API Key & Polyfill ---
        if (typeof globalThis.process === 'undefined') {
            globalThis.process = { env: {} };
        }
        const GEMINI_API_KEY_PLACEHOLDER = "MASUKKAN_KUNCI_API_GEMINI_ANDA_DI_SINI";
        let geminiApiKey = globalThis.process.env.API_KEY || GEMINI_API_KEY_PLACEHOLDER;

        if (geminiApiKey === GEMINI_API_KEY_PLACEHOLDER) {
            console.warn("PERINGATAN: Kunci API Gemini tidak dikonfigurasi. Fitur AI tidak akan berfungsi. Silakan ganti placeholder di kode atau set variabel environment API_KEY.");
        }
        const GEMINI_MODEL_NAME = 'gemini-1.5-flash-latest';

        // --- 1. Konstanta & Utilitas Global ---
        const APP_NAME = "Green Valley Rentals";

        const createSVGElement = (svgString) => {
            const template = document.createElement('template');
            template.innerHTML = svgString.trim();
            const firstChild = template.content.firstChild;
            if (firstChild instanceof SVGElement) return firstChild;
            // Fallback sederhana jika SVG string salah atau ada wrapper, coba cari SVG di dalamnya
            if (firstChild instanceof HTMLElement && firstChild.querySelector('svg')) {
                return firstChild.querySelector('svg');
            }
            console.error("Gagal membuat elemen SVG dari string:", svgString);
            return null;
        };

        // Definisi Ikon SVG
        const SunIcon = (className = "w-6 h-6") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${className}"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-6.364-.386 1.591-1.591M3 12h2.25m.386-6.364 1.591 1.591" /></svg>`);
        const MoonIcon = (className = "w-6 h-6") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${className}"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" /></svg>`);
        const HomeIcon = (className = "w-5 h-5") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${className}"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h7.5" /></svg>`);
        const DashboardIcon = (className = "w-5 h-5") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${className}"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 8.25 20.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25A2.25 2.25 0 0 1 13.5 8.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25h-2.25a2.25 2.25 0 0 1-2.25-2.25v-2.25Z" /></svg>`);
        const BellIcon = (className = "w-5 h-5") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${className}"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" /></svg>`);
        const PlusIcon = (className = "w-5 h-5") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${className}"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>`);
        const SparklesIcon = (className = "w-4 h-4") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${className}"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L1.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L24 5.25l-.813 2.846a4.5 4.5 0 0 0-3.09 3.09L18.25 12ZM12 15.75l-2.846.813a4.5 4.5 0 0 0-3.09 3.09L5.25 21l.813-2.846a4.5 4.5 0 0 0 3.09-3.09L12 15.75Z" /></svg>`);
        const CloseIcon = (className = "w-6 h-6") => createSVGElement(`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${className}"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>`);

        const timeAgo = (dateString) => {
            const date = new Date(dateString);
            const now = new Date();
            const seconds = Math.round((now.getTime() - date.getTime()) / 1000);
            const minutes = Math.round(seconds / 60);
            const hours = Math.round(minutes / 60);
            const days = Math.round(hours / 24);
            const months = Math.round(days / 30.44); // Rata-rata hari dalam sebulan
            const years = Math.round(days / 365.25); // Akun untuk tahun kabisat

            if (seconds < 5) return "baru saja";
            if (seconds < 60) return `${seconds} detik lalu`;
            if (minutes < 60) return `${minutes} menit lalu`;
            if (hours < 24) return `${hours} jam lalu`;
            if (days < 30) return `${days} hari lalu`;
            if (months < 12) return `${months} bulan lalu`;
            return `${years} tahun lalu`;
        };

        // --- 2. Mock Data ---
        const mockProperties = [
            { id: 'prop_1', name: 'Apartemen Lembah Asri', address: '123 Jl. Pinus Hijau, Green Valley', type: 'Apartemen', bedrooms: 2, bathrooms: 2, rentPrice: 1500, imageUrl: 'https://picsum.photos/seed/gvh1/600/400', description: 'Apartemen modern dengan pemandangan lembah yang menakjubkan. Fasilitas lengkap dan suasana tenang, cocok untuk profesional muda atau pasangan.', status: 'Tersedia', ownerId: 'owner1' },
            { id: 'prop_2', name: 'Rumah Keluarga Harmoni', address: '456 Jl. Ek Teduh, Green Valley', type: 'Rumah', bedrooms: 3, bathrooms: 2.5, rentPrice: 2200, imageUrl: 'https://picsum.photos/seed/gvh2/600/400', description: 'Rumah keluarga ideal dengan taman luas, dekat sekolah dan taman bermain. Dapur baru direnovasi dengan peralatan modern.', status: 'Disewa', ownerId: 'owner1' },
            { id: 'prop_3', name: 'Kondominium Urban Elegan', address: '789 Jl. Pusat Kota Ramai, Green Valley', type: 'Kondominium', bedrooms: 1, bathrooms: 1, rentPrice: 1200, imageUrl: 'https://picsum.photos/seed/gvh3/600/400', description: 'Kondominium stylish di jantung kota. Akses mudah ke pertokoan, restoran, dan transportasi publik. Kehidupan urban terbaik.', status: 'Tersedia', ownerId: 'owner2' },
            { id: 'prop_4', name: 'Villa Mewah Tepi Sungai', address: '101 Jl. Pinggir Sungai Indah, Green Valley', type: 'Rumah', bedrooms: 4, bathrooms: 3, rentPrice: 3000, imageUrl: 'https://picsum.photos/seed/gvh4/600/400', description: 'Villa luas dengan arsitektur menawan, kolam renang pribadi, dan garasi tiga mobil. Privasi dan kemewahan di lokasi prima.', status: 'Tersedia', ownerId: 'owner1' },
        ];
        const mockNotifications = [
            { id: 'n1', message: 'Permintaan sewa baru untuk "Apartemen Lembah Asri".', timestamp: new Date(Date.now() - 5 * 60 * 1000).toISOString(), read: false, type: 'info' }, // 5 menit lalu
            { id: 'n2', message: 'Pembayaran sewa $2200 diterima untuk "Rumah Keluarga Harmoni".', timestamp: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(), read: true, type: 'success' }, // 1 hari lalu
            { id: 'n3', message: 'Permintaan pemeliharaan untuk "Kondominium Urban Elegan": Keran bocor di dapur.', timestamp: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(), read: false, type: 'warning' }, // 2 hari lalu
        ];
        const mockIncomeData = [
            { month: 'Jan', amount: 2200 }, { month: 'Feb', amount: 1500 }, { month: 'Mar', amount: 3000 },
            { month: 'Apr', amount: 2000 }, { month: 'Mei', amount: 2780 }, { month: 'Jun', amount: 1890 },
            { month: 'Jul', amount: 3300 },
        ];

        // --- 3. Manajemen Tema ---
        const Theme = { LIGHT: 'light', DARK: 'dark' };
        let currentTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? Theme.DARK : Theme.LIGHT);

        function applyTheme(theme) {
            document.documentElement.classList.remove(Theme.LIGHT, Theme.DARK);
            document.documentElement.classList.add(theme);
            document.body.className = ''; // Reset kelas body
            // Kelas dasar dari variabel CSS sudah menangani warna bg dan teks
            localStorage.setItem('theme', theme);
            currentTheme = theme;
        }

        function toggleThemeAndUpdateUI() {
            const newTheme = currentTheme === Theme.LIGHT ? Theme.DARK : Theme.LIGHT;
            applyTheme(newTheme);
            renderApp();
        }

        // --- 4. Layanan Gemini AI ---
        async function generatePropertyDescriptionWithGemini(propertyDetails) {
            if (geminiApiKey === GEMINI_API_KEY_PLACEHOLDER || !geminiApiKey) {
                return "Layanan AI tidak tersedia. Harap periksa konfigurasi Kunci API Anda.";
            }

            const prompt = `Buat deskripsi properti real estat yang menarik dan persuasif dalam Bahasa Indonesia untuk properti berikut. Soroti fitur utamanya dan tarik calon penyewa. Buatlah ringkas, sekitar 2-3 kalimat.
                Jenis Properti: ${propertyDetails.type || 'Tidak disebutkan'}
                Lokasi: Green Valley (area perumahan elit dan tenang)
                Kamar Tidur: ${propertyDetails.bedrooms || 'Tidak disebutkan'}
                Kamar Mandi: ${propertyDetails.bathrooms || 'Tidak disebutkan'}
                Nada yang Diinginkan: Profesional, mengundang, hangat, dan sedikit antusias.
                Contoh: "Temukan kenyamanan tinggal di Green Valley! ${propertyDetails.type || 'Properti'} menawan ini menawarkan ${propertyDetails.bedrooms || 'beberapa'} kamar tidur, ${propertyDetails.bathrooms || 'beberapa'} kamar mandi, serta desain modern yang elegan. Ideal bagi Anda yang mendambakan gaya hidup berkualitas dan ketenangan."`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL_NAME}:generateContent?key=${geminiApiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { temperature: 0.7, maxOutputTokens: 300 }
                    })
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error("Error dari Gemini API:", errorData);
                    throw new Error(`Gemini API error: ${response.status} - ${errorData.error?.message || 'Kesalahan tidak diketahui'}`);
                }
                const data = await response.json();
                return data.candidates[0]?.content.parts[0]?.text || "Tidak ada deskripsi yang dapat dihasilkan saat ini.";
            } catch (error) {
                console.error("Gagal menghasilkan deskripsi properti dengan Gemini:", error);
                return "Gagal menghubungi layanan AI untuk menghasilkan deskripsi. Silakan coba lagi nanti atau tulis secara manual.";
            }
        }

        // --- 5. State Aplikasi Global ---
        const appState = {
            currentPage: 'home',
            properties: JSON.parse(JSON.stringify(mockProperties)),
            notifications: JSON.parse(JSON.stringify(mockNotifications)),
            selectedPropertyModal: { isOpen: false, propertyId: null },
            propertyFormModal: { isOpen: false, propertyToEditId: null, isGeneratingDesc: false },
            isLoading: false,
        };

        function updateGlobalProperty(updatedProperty) {
            const index = appState.properties.findIndex(p => p.id === updatedProperty.id);
            if (index > -1) {
                appState.properties[index] = { ...appState.properties[index], ...updatedProperty };
            } else {
                appState.properties.push(updatedProperty);
            }
            // Update mockProperties juga untuk "persistensi" dalam sesi ini
            const mockIndex = mockProperties.findIndex(p => p.id === updatedProperty.id);
            if (mockIndex > -1) mockProperties[mockIndex] = { ...mockProperties[mockIndex], ...updatedProperty };
            else mockProperties.push(updatedProperty);

            renderApp();
        }

        function deleteGlobalProperty(propertyId) {
            appState.properties = appState.properties.filter(p => p.id !== propertyId);
            const mockIndex = mockProperties.findIndex(p => p.id === propertyId);
            if (mockIndex > -1) mockProperties.splice(mockIndex, 1);
            renderApp();
        }

        // --- 6. Fungsi Komponen UI ---
        function ButtonComponent({ textContent, onClick, variant = 'primary', size = 'md', leftIcon, rightIcon, className = '', type = 'button', disabled = false, ariaLabel = '' }) {
            const el = document.createElement('button');
            el.type = type;
            el.disabled = disabled;
            if (ariaLabel || (!textContent && (leftIcon || rightIcon))) {
                el.setAttribute('aria-label', ariaLabel || (textContent || 'Tombol'));
            }

            el.className = `button-base button-${variant} button-sz-${size} ${className}`;

            if (disabled) el.setAttribute('aria-disabled', 'true');

            if (leftIcon) {
                const iconSpan = document.createElement('span');
                iconSpan.className = textContent ? 'mr-2' : '';
                if (leftIcon instanceof Node) iconSpan.appendChild(leftIcon);
                el.appendChild(iconSpan);
            }
            if (textContent) {
                el.appendChild(document.createTextNode(textContent));
            }
            if (rightIcon) {
                const iconSpan = document.createElement('span');
                iconSpan.className = textContent ? 'ml-2' : '';
                if (rightIcon instanceof Node) iconSpan.appendChild(rightIcon);
                el.appendChild(iconSpan);
            }
            if (onClick) el.addEventListener('click', onClick);
            return el;
        }

        function CardComponent({ children, className = '', onClick, ariaLabelledby }) {
            const el = document.createElement('div');
            el.className = `bg-surface rounded-xl shadow-lg overflow-hidden p-6 ${className}`;
            if (onClick) {
                el.classList.add('cursor-pointer', 'hover:shadow-xl', 'transition-shadow', 'duration-300');
                el.addEventListener('click', onClick);
                el.setAttribute('role', 'button');
                el.tabIndex = 0; // Membuat div bisa di-fokus
                el.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') onClick(e); });
            }
            if (ariaLabelledby) el.setAttribute('aria-labelledby', ariaLabelledby);

            if (typeof children === 'string') el.innerHTML = children;
            else if (children instanceof Node) el.appendChild(children);
            else if (Array.isArray(children)) children.forEach(child => child instanceof Node && el.appendChild(child));
            return el;
        }

        function ModalComponent({ isOpen, onClose, title, children, size = 'md' }) {
            if (!isOpen) return null;

            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'modal-overlay animate-fade-in';
            modalOverlay.setAttribute('role', 'dialog');
            modalOverlay.setAttribute('aria-modal', 'true');
            if (title) modalOverlay.setAttribute('aria-labelledby', 'modal-title-id');

            const closeOnOverlayClick = (e) => {
                if (e.target === modalOverlay) onClose();
            };
            modalOverlay.addEventListener('click', closeOnOverlayClick);

            const modalContent = document.createElement('div');
            modalContent.className = `modal-content size-${size} animate-slide-up`;
            modalContent.addEventListener('click', (e) => e.stopPropagation());

            const headerDiv = document.createElement('div');
            headerDiv.className = 'flex justify-between items-center mb-4 pb-3 border-b border-border';
            if (title) {
                const titleEl = document.createElement('h2');
                titleEl.id = 'modal-title-id';
                titleEl.className = 'text-xl font-semibold text-text-default';
                titleEl.textContent = title;
                headerDiv.appendChild(titleEl);
            }
            const closeButton = ButtonComponent({
                variant: 'ghost',
                className: 'p-1 -mr-1 -mt-1 text-slate-400 hover:text-slate-600 dark:text-slate-300 dark:hover:text-slate-100',
                leftIcon: CloseIcon('w-5 h-5'),
                onClick: onClose,
                ariaLabel: 'Tutup modal'
            });
            headerDiv.appendChild(closeButton);
            modalContent.appendChild(headerDiv);

            const contentDiv = document.createElement('div');
            contentDiv.className = 'modal-body-content'; // Kelas untuk styling/scrolling jika perlu
            if (typeof children === 'string') contentDiv.innerHTML = children;
            else if (children instanceof Node) contentDiv.appendChild(children);
            else if (Array.isArray(children)) children.forEach(child => child instanceof Node && contentDiv.appendChild(child));
            modalContent.appendChild(contentDiv);

            modalOverlay.appendChild(modalContent);

            const handleEsc = (event) => {
                if (event.key === 'Escape') onClose();
            };
            document.addEventListener('keydown', handleEsc);
            document.body.style.overflow = 'hidden';

            let firstFocusableElement = modalContent.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
            if (firstFocusableElement) firstFocusableElement.focus();


            modalOverlay.cleanup = () => {
                document.removeEventListener('keydown', handleEsc);
                modalOverlay.removeEventListener('click', closeOnOverlayClick);
                document.body.style.overflow = 'unset';
                if (modalOverlay.parentElement) modalOverlay.parentElement.removeChild(modalOverlay);
            };

            return modalOverlay;
        }

        function SpinnerComponent({ size = 'md', colorClass = 'border-primary' } = {}) {
            const spinnerDiv = document.createElement('div');
            spinnerDiv.className = 'inline-flex justify-center items-center'; // inline-flex agar bisa sejajar teks
            spinnerDiv.setAttribute('role', 'status');
            spinnerDiv.setAttribute('aria-live', 'polite');
            const ringDiv = document.createElement('div');
            ringDiv.className = `animate-spin spinner-ring spinner-${size} ${colorClass}`;
            spinnerDiv.appendChild(ringDiv);
            const srText = document.createElement('span');
            srText.className = 'sr-only';
            srText.textContent = 'Memuat...';
            spinnerDiv.appendChild(srText);
            return spinnerDiv;
        }

        function ThemeToggleComponent() {
            const isLight = currentTheme === Theme.LIGHT;
            return ButtonComponent({
                onClick: toggleThemeAndUpdateUI,
                variant: 'ghost',
                ariaLabel: isLight ? 'Alihkan ke tema gelap' : 'Alihkan ke tema terang',
                className: 'p-2 rounded-full',
                leftIcon: isLight ? MoonIcon('w-5 h-5 text-slate-600 dark:text-slate-300') : SunIcon('w-5 h-5 text-yellow-400')
            });
        }

        // --- 7. Fungsi Komponen Layout ---
        function HeaderComponent() {
            const header = document.createElement('header');
            header.className = 'app-header';

            const container = document.createElement('div');
            container.className = 'container mx-auto';
            header.appendChild(container);

            const flexContainer = document.createElement('div');
            flexContainer.className = 'flex items-center justify-between h-16';
            container.appendChild(flexContainer);

            const logoLink = document.createElement('a');
            logoLink.href = '#home';
            logoLink.className = 'text-2xl font-bold text-primary dark:text-primary-light hover:opacity-80 transition-opacity';
            logoLink.textContent = APP_NAME;
            logoLink.onclick = (e) => { e.preventDefault(); navigateTo('home'); };
            flexContainer.appendChild(logoLink);

            const nav = document.createElement('nav');
            nav.setAttribute('aria-label', 'Navigasi utama');
            nav.className = 'flex items-center space-x-1 sm:space-x-2';

            const navLink = (path, iconElement, text) => {
                const link = document.createElement('a');
                link.href = `#${path}`;
                const isActive = appState.currentPage === path;
                const activeClasses = 'bg-primary/10 dark:bg-primary/20 text-primary dark:text-primary-light font-semibold';
                const inactiveClasses = 'text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 hover:text-primary dark:hover:text-primary-light';
                link.className = `flex items-center px-2 py-2 sm:px-3 rounded-md text-sm font-medium transition-colors duration-200 ${isActive ? activeClasses : inactiveClasses}`;
                if (isActive) link.setAttribute('aria-current', 'page');
                link.onclick = (e) => { e.preventDefault(); navigateTo(path); };

                if (iconElement) {
                    const iconSpan = document.createElement('span');
                    iconSpan.className = text ? 'mr-0 sm:mr-1.5' : '';
                    iconSpan.appendChild(iconElement);
                    link.appendChild(iconSpan);
                }

                if (text) {
                    const textSpan = document.createElement('span');
                    textSpan.className = 'hidden sm:inline';
                    textSpan.textContent = text;
                    link.appendChild(textSpan);
                }
                return link;
            };

            nav.appendChild(navLink('home', HomeIcon(), 'Beranda'));
            nav.appendChild(navLink('dashboard', DashboardIcon(), 'Dasbor'));
            nav.appendChild(navLink('notifications', BellIcon(), 'Notifikasi'));
            nav.appendChild(ThemeToggleComponent());
            flexContainer.appendChild(nav);

            return header;
        }

        function FooterComponent() {
            const footer = document.createElement('footer');
            footer.className = 'app-footer';

            const container = document.createElement('div');
            container.className = 'container mx-auto px-4';

            const p1 = document.createElement('p');
            p1.className = 'text-sm text-text-muted';
            p1.innerHTML = `&copy; ${new Date().getFullYear()} ${APP_NAME}. Hak Cipta Dilindungi Undang-Undang.`;
            container.appendChild(p1);

            const p2 = document.createElement('p');
            p2.className = 'text-xs text-text-muted opacity-75 mt-1';
            p2.textContent = 'Hunian Impian Anda, Kini Lebih Mudah Ditemukan.';
            container.appendChild(p2);

            footer.appendChild(container);
            return footer;
        }

        // --- Komponen Properti ---
        function PropertyCardComponent(property, onDetailsClick) {
            const cardEl = document.createElement('article');
            cardEl.className = `property-card group ${onDetailsClick ? 'clickable' : ''}`;
            cardEl.setAttribute('aria-labelledby', `prop-name-${property.id}`);
            if (onDetailsClick) {
                cardEl.tabIndex = 0;
                cardEl.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') onDetailsClick(property.id); });
            }

            const imgContainer = document.createElement('div');
            imgContainer.className = 'property-card-image-container';
            const img = document.createElement('img');
            img.src = property.imageUrl;
            img.alt = `Tampilan ${property.name}`; // Alt text lebih deskriptif
            img.className = 'property-card-image';
            img.loading = 'lazy'; // Lazy loading untuk gambar
            imgContainer.appendChild(img);

            const statusBadge = document.createElement('div');
            statusBadge.className = `property-card-status-badge ${property.status === 'Tersedia' ? 'available' : 'rented'}`;
            statusBadge.textContent = property.status;
            imgContainer.appendChild(statusBadge);
            cardEl.appendChild(imgContainer);

            const contentDiv = document.createElement('div');
            contentDiv.className = 'property-card-content';

            const nameH3 = document.createElement('h3');
            nameH3.id = `prop-name-${property.id}`;
            nameH3.className = 'text-xl font-semibold text-text-default mb-2 truncate';
            nameH3.title = property.name;
            nameH3.textContent = property.name;
            contentDiv.appendChild(nameH3);

            const addressP = document.createElement('p');
            addressP.className = 'text-sm text-text-muted mb-1 truncate';
            addressP.textContent = property.address;
            contentDiv.appendChild(addressP);

            const detailsP = document.createElement('p');
            detailsP.className = 'text-sm text-text-muted mb-3';
            detailsP.textContent = `${property.bedrooms} KT · ${property.bathrooms} KM · ${property.type}`;
            contentDiv.appendChild(detailsP);

            const priceP = document.createElement('p');
            priceP.className = 'text-lg font-bold text-primary dark:text-primary-light mb-4';
            priceP.textContent = `$${Number(property.rentPrice).toLocaleString('id-ID')}/bulan`; // Format Indonesia
            contentDiv.appendChild(priceP);

            const descriptionP = document.createElement('p');
            descriptionP.className = 'text-sm text-text-default opacity-90 mb-4 line-clamp-3 property-card-description';
            descriptionP.textContent = property.description;
            contentDiv.appendChild(descriptionP);

            if (onDetailsClick) {
                const button = ButtonComponent({
                    textContent: 'Lihat Detail',
                    className: 'mt-auto w-full',
                    onClick: (e) => {
                        e.stopPropagation();
                        onDetailsClick(property.id);
                    }
                });
                contentDiv.appendChild(button);
            }
            cardEl.appendChild(contentDiv);
            if (onDetailsClick) { // Klik seluruh kartu jika ada handler
                cardEl.addEventListener('click', (e) => {
                    if (e.target.tagName !== 'BUTTON') { // Jangan trigger jika tombol di dalam card diklik
                        onDetailsClick(property.id);
                    }
                });
            }
            return cardEl;
        }

        function PropertyListComponent(properties, onPropertyClick) {
            const listContainer = document.createElement('div');
            if (properties.length === 0) {
                listContainer.innerHTML = `<p class="text-center text-text-muted py-8">Tidak ada properti yang cocok dengan kriteria Anda saat ini.</p>`;
                return listContainer;
            }
            listContainer.className = 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6';
            properties.forEach(prop => {
                listContainer.appendChild(PropertyCardComponent(prop, onPropertyClick));
            });
            return listContainer;
        }

        // --- Komponen Notifikasi ---
        function NotificationItemComponent(notification) {
            const itemDiv = document.createElement('div');
            const typeClasses = {
                info: { border: 'border-blue-500', bgIcon: 'bg-blue-500' },
                success: { border: 'border-green-500', bgIcon: 'bg-green-500' },
                warning: { border: 'border-yellow-500', bgIcon: 'bg-yellow-500' },
                error: { border: 'border-red-500', bgIcon: 'bg-red-500' }
            };
            itemDiv.className = `notification-item ${notification.read ? 'read' : ''} ${typeClasses[notification.type].border}`;

            const iconWrapper = document.createElement('div');
            iconWrapper.className = `notification-icon-wrapper ${typeClasses[notification.type].bgIcon}`;
            const bell = BellIcon('w-5 h-5');
            if (bell) iconWrapper.appendChild(bell);
            itemDiv.appendChild(iconWrapper);

            const contentDiv = document.createElement('div');
            contentDiv.className = 'notification-content';
            const msgP = document.createElement('p');
            msgP.className = 'text-sm text-text-default font-medium';
            msgP.textContent = notification.message;
            contentDiv.appendChild(msgP);

            const timeP = document.createElement('p');
            timeP.className = 'text-xs text-text-muted mt-1';
            timeP.textContent = timeAgo(notification.timestamp);
            contentDiv.appendChild(timeP);
            itemDiv.appendChild(contentDiv);

            if (!notification.read) {
                const unreadDot = document.createElement('div');
                unreadDot.className = 'notification-unread-dot';
                unreadDot.title = 'Belum Dibaca';
                itemDiv.appendChild(unreadDot);
            }
            return itemDiv;
        }

        function NotificationListComponent(notifications) {
            const listContainer = document.createElement('div');
            if (notifications.length === 0) {
                listContainer.innerHTML = `<p class="text-center text-text-muted py-8">Tidak ada notifikasi baru untuk Anda.</p>`;
                return listContainer;
            }
            listContainer.className = 'space-y-3';
            const sortedNotifications = [...notifications].sort((a, b) => {
                if (a.read !== b.read) return a.read ? 1 : -1;
                return new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime();
            });
            sortedNotifications.forEach(notif => {
                listContainer.appendChild(NotificationItemComponent(notif));
            });
            return listContainer;
        }

        // --- Komponen Dasbor ---
        function DashboardSectionComponent({ title, children, actionButton, className = '' }) {
            const sectionContent = document.createElement('div');

            const headerDiv = document.createElement('div');
            headerDiv.className = 'flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6';
            const titleH2 = document.createElement('h2');
            titleH2.className = 'text-2xl font-semibold text-text-default mb-2 sm:mb-0';
            titleH2.textContent = title;
            headerDiv.appendChild(titleH2);
            if (actionButton) headerDiv.appendChild(actionButton);
            sectionContent.appendChild(headerDiv);

            const contentDiv = document.createElement('div');
            if (typeof children === 'string') contentDiv.innerHTML = children;
            else if (children instanceof Node) contentDiv.appendChild(children);
            else if (Array.isArray(children)) children.forEach(child => child instanceof Node && contentDiv.appendChild(child));
            sectionContent.appendChild(contentDiv);

            return CardComponent({ children: sectionContent, className: `animate-slide-up ${className}` });
        }

        let currentPropertyFormModal = null;

        function PropertyFormModalComponent() {
            const { isOpen, propertyToEditId, isGeneratingDesc } = appState.propertyFormModal;
            if (!isOpen) {
                // Cleanup dilakukan oleh closeModal jika ada
                return null;
            }

            const propertyToEdit = propertyToEditId ? appState.properties.find(p => p.id === propertyToEditId) : null;
            const initialFormState = { name: '', address: '', type: 'Apartemen', bedrooms: 1, bathrooms: 1, rentPrice: 1000, description: '', status: 'Tersedia', imageUrl: `https://picsum.photos/seed/${Date.now()}/600/400` };
            let formData = propertyToEdit ? { ...initialFormState, ...propertyToEdit } : { ...initialFormState };

            const form = document.createElement('form');
            form.className = 'space-y-4';
            form.setAttribute('novalidate', ''); // Kita akan handle validasi manual jika perlu lebih kompleks

            const createFormField = (label, name, type = 'text', value, options = {}) => {
                const fieldId = `form-${name}-${Date.now()}`; // ID unik
                const div = document.createElement('div');
                const labelEl = document.createElement('label');
                labelEl.htmlFor = fieldId;
                labelEl.className = 'form-label';
                labelEl.textContent = label + (options.required ? ' *' : '');
                div.appendChild(labelEl);

                let inputEl;
                if (type === 'select') {
                    inputEl = document.createElement('select');
                    options.choices?.forEach(opt => {
                        const optionEl = document.createElement('option');
                        optionEl.value = opt.value;
                        optionEl.textContent = opt.label;
                        inputEl.appendChild(optionEl);
                    });
                    inputEl.value = value; // Set value setelah options ditambahkan
                } else if (type === 'textarea') {
                    inputEl = document.createElement('textarea');
                    inputEl.rows = options.rows || 3;
                    inputEl.value = value;
                } else {
                    inputEl = document.createElement('input');
                    inputEl.type = type;
                    if (options.min !== undefined) inputEl.min = options.min;
                    if (options.step !== undefined) inputEl.step = options.step;
                    if (options.placeholder) inputEl.placeholder = options.placeholder;
                    inputEl.value = value;
                }
                inputEl.name = name;
                inputEl.id = fieldId;
                inputEl.className = type === 'select' ? 'form-select' : (type === 'textarea' ? 'form-textarea' : 'form-input');
                if (options.required) inputEl.required = true;

                inputEl.addEventListener('input', (e) => {
                    const val = e.target.value;
                    formData[name] = (type === 'number' || ['rentPrice', 'bedrooms', 'bathrooms'].includes(name)) ? parseFloat(val) || 0 : val;
                });
                div.appendChild(inputEl);
                return div;
            };

            form.appendChild(createFormField('Nama Properti', 'name', 'text', formData.name, { required: true, placeholder: 'Mis: Apartemen Modern Pusat Kota' }));
            form.appendChild(createFormField('Alamat', 'address', 'text', formData.address, { required: true, placeholder: 'Mis: Jl. Sudirman No. 123, Jakarta' }));

            const gridDiv1 = document.createElement('div');
            gridDiv1.className = 'grid grid-cols-1 md:grid-cols-2 gap-4';
            gridDiv1.appendChild(createFormField('Tipe', 'type', 'select', formData.type, { choices: [{ value: 'Apartemen', label: 'Apartemen' }, { value: 'Rumah', label: 'Rumah' }, { value: 'Kondominium', label: 'Kondominium' }] }));
            gridDiv1.appendChild(createFormField('Status', 'status', 'select', formData.status, { choices: [{ value: 'Tersedia', label: 'Tersedia' }, { value: 'Disewa', label: 'Disewa' }] }));
            form.appendChild(gridDiv1);

            const gridDiv2 = document.createElement('div');
            gridDiv2.className = 'grid grid-cols-1 md:grid-cols-3 gap-4';
            gridDiv2.appendChild(createFormField('Kamar Tidur', 'bedrooms', 'number', formData.bedrooms, { min: 0, required: true }));
            gridDiv2.appendChild(createFormField('Kamar Mandi', 'bathrooms', 'number', formData.bathrooms, { min: 0, step: 0.5, required: true }));
            gridDiv2.appendChild(createFormField('Harga Sewa ($/bulan)', 'rentPrice', 'number', formData.rentPrice, { min: 0, required: true }));
            form.appendChild(gridDiv2);

            const descDiv = createFormField('Deskripsi', 'description', 'textarea', formData.description, { rows: 4, placeholder: 'Jelaskan fitur unik properti Anda...' });
            const descTextarea = descDiv.querySelector('textarea');

            const aiButtonContainer = document.createElement('div');
            aiButtonContainer.className = 'mt-2 flex items-center gap-2';

            const aiButton = ButtonComponent({
                textContent: isGeneratingDesc ? 'Menghasilkan...' : 'Buat dengan AI',
                type: 'button', variant: 'ghost', size: 'sm', className: 'text-xs',
                leftIcon: isGeneratingDesc ? SpinnerComponent({ size: 'sm', colorClass: 'border-primary dark:border-primary-light' }) : SparklesIcon('w-4 h-4'),
                disabled: isGeneratingDesc || geminiApiKey === GEMINI_API_KEY_PLACEHOLDER,
                onClick: async () => {
                    if (appState.propertyFormModal.isGeneratingDesc) return;
                    appState.propertyFormModal.isGeneratingDesc = true;
                    renderApp(); // Re-render untuk update tombol & spinner

                    const desc = await generatePropertyDescriptionWithGemini({ type: formData.type, bedrooms: formData.bedrooms, bathrooms: formData.bathrooms });
                    formData.description = desc;

                    const currentTextareaInDOM = document.getElementById(descTextarea.id); // Cari textarea terbaru di DOM
                    if (currentTextareaInDOM) currentTextareaInDOM.value = desc;

                    appState.propertyFormModal.isGeneratingDesc = false;
                    if (appState.propertyFormModal.isOpen) { // Hanya re-render jika modal masih terbuka
                        renderApp();
                    }
                }
            });
            if (geminiApiKey === GEMINI_API_KEY_PLACEHOLDER) {
                aiButton.title = "Kunci API Gemini tidak dikonfigurasi.";
            }
            aiButtonContainer.appendChild(aiButton);
            descDiv.appendChild(aiButtonContainer);
            form.appendChild(descDiv);

            const buttonsDiv = document.createElement('div');
            buttonsDiv.className = 'flex justify-end space-x-3 pt-4 border-t border-border mt-6';
            buttonsDiv.appendChild(ButtonComponent({ textContent: 'Batal', type: 'button', variant: 'ghost', onClick: closePropertyFormModal }));
            buttonsDiv.appendChild(ButtonComponent({ textContent: propertyToEdit ? 'Simpan Perubahan' : 'Tambah Properti', type: 'submit', variant: 'primary' }));
            form.appendChild(buttonsDiv);

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                let isValid = true;
                // Simple client-side validation
                form.querySelectorAll('[required]').forEach(input => {
                    if (!input.value.trim() || (input.type === 'number' && parseFloat(input.value) < (input.min || 0))) {
                        isValid = false;
                        input.style.borderColor = 'red'; // Indikasi error sederhana
                        // TODO: Tambahkan pesan error yang lebih baik
                    } else {
                        input.style.borderColor = ''; // Reset border
                    }
                });

                if (!isValid) {
                    alert('Harap isi semua kolom yang wajib diisi dengan benar.');
                    return;
                }

                const propertyData = {
                    ...formData, // Sudah berisi data terbaru dari input events
                    id: propertyToEdit?.id || `prop_${Date.now()}`,
                    imageUrl: propertyToEdit?.imageUrl || `https://picsum.photos/seed/${Date.now()}/600/400`,
                    ownerId: propertyToEdit?.ownerId || 'owner1', // Mock user
                };
                updateGlobalProperty(propertyData);
                closePropertyFormModal();
            });

            const modalTitle = propertyToEdit ? 'Edit Properti' : 'Tambah Properti Baru';
            currentPropertyFormModal = ModalComponent({
                isOpen: true,
                onClose: closePropertyFormModal,
                title: modalTitle,
                size: 'lg',
                children: form
            });
            return currentPropertyFormModal;
        }

        function PropertyManagementWidgetComponent() {
            const ownerProperties = appState.properties.filter(p => p.ownerId === 'owner1'); // Mock current user

            const content = document.createElement('div');
            if (ownerProperties.length === 0) {
                content.innerHTML = `<p class="text-text-muted text-center py-4">Anda belum memiliki properti yang terdaftar.</p>`;
            } else {
                const listDiv = document.createElement('div');
                listDiv.className = 'space-y-4';
                ownerProperties.forEach(prop => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'p-4 bg-slate-50 dark:bg-surface rounded-lg shadow flex flex-col sm:flex-row justify-between items-start sm:items-center hover:shadow-md transition-shadow duration-200';

                    const infoDiv = document.createElement('div');
                    infoDiv.className = 'mb-3 sm:mb-0 flex-grow';
                    const nameH4 = document.createElement('h4');
                    nameH4.className = 'font-semibold text-lg text-text-default truncate';
                    nameH4.textContent = prop.name;
                    nameH4.title = prop.name;
                    infoDiv.appendChild(nameH4);
                    const detailsP = document.createElement('p');
                    detailsP.className = 'text-sm text-text-muted truncate';
                    detailsP.textContent = `${prop.address} - Status: ${prop.status}`;
                    detailsP.title = `${prop.address} - Status: ${prop.status}`;
                    infoDiv.appendChild(detailsP);
                    itemDiv.appendChild(infoDiv);

                    const actionsDiv = document.createElement('div');
                    actionsDiv.className = 'flex space-x-2 self-end sm:self-center flex-shrink-0';
                    actionsDiv.appendChild(ButtonComponent({ textContent: 'Edit', size: 'sm', variant: 'ghost', onClick: () => openPropertyFormModal(prop.id) }));
                    actionsDiv.appendChild(ButtonComponent({
                        textContent: 'Hapus', size: 'sm', variant: 'danger', onClick: () => {
                            if (confirm(`Apakah Anda yakin ingin menghapus properti "${prop.name}"? Tindakan ini tidak dapat diurungkan.`)) {
                                deleteGlobalProperty(prop.id);
                            }
                        }
                    }));
                    itemDiv.appendChild(actionsDiv);
                    listDiv.appendChild(itemDiv);
                });
                content.appendChild(listDiv);
            }

            return DashboardSectionComponent({
                title: 'Manajemen Properti Saya',
                actionButton: ButtonComponent({ textContent: 'Tambah Baru', leftIcon: PlusIcon(), onClick: () => openPropertyFormModal(null) }),
                children: content
            });
        }

        function IncomeReportWidgetComponent() {
            const totalIncome = mockIncomeData.reduce((sum, item) => sum + item.amount, 0);
            const currentMonthIncome = mockIncomeData.length > 0 ? mockIncomeData[mockIncomeData.length - 1].amount : 0;

            const container = document.createElement('div');

            const statsGrid = document.createElement('div');
            statsGrid.className = 'grid grid-cols-1 md:grid-cols-2 gap-6 mb-8';

            const createStatCard = (title, amount, variant = 'primary') => {
                const card = document.createElement('div');
                const bgColorClass = variant === 'primary' ? 'bg-primary/10 dark:bg-primary/20' : 'bg-secondary/10 dark:bg-secondary/20';
                const textColorClass = variant === 'primary' ? 'text-primary dark:text-primary-light' : 'text-secondary dark:text-secondary-light';

                card.className = `p-6 ${bgColorClass} rounded-xl shadow-lg`; // rounded-xl, shadow-lg

                const titleH4 = document.createElement('h4');
                titleH4.className = `text-sm font-medium ${textColorClass} uppercase tracking-wider`;
                titleH4.textContent = title;
                card.appendChild(titleH4);

                const amountP = document.createElement('p');
                amountP.className = `text-3xl font-bold ${textColorClass} mt-1`;
                amountP.textContent = `$${Number(amount).toLocaleString('id-ID')}`;
                card.appendChild(amountP);
                return card;
            };
            statsGrid.appendChild(createStatCard('Pendapatan Bulan Ini', currentMonthIncome, 'primary'));
            statsGrid.appendChild(createStatCard('Total Pendapatan (YTD)', totalIncome, 'secondary'));
            container.appendChild(statsGrid);

            const trendTitle = document.createElement('h3');
            trendTitle.className = 'text-xl font-semibold mb-4 text-text-default';
            trendTitle.textContent = 'Tren Pendapatan Bulanan';
            container.appendChild(trendTitle);

            const chartOuterContainer = document.createElement('div');
            chartOuterContainer.className = 'simple-chart-bar-container';

            const chartDiv = document.createElement('div');
            chartDiv.className = 'simple-chart-bars';
            const maxAmount = Math.max(...mockIncomeData.map(d => d.amount), 1);

            mockIncomeData.forEach(item => {
                const barWrapper = document.createElement('div');
                barWrapper.className = 'simple-chart-bar-wrapper group';

                const bar = document.createElement('div');
                const barHeight = maxAmount > 0 ? (item.amount / maxAmount) * 95 : 0; // 95% agar tidak full
                bar.style.height = `${barHeight}%`;
                bar.className = 'simple-chart-bar';
                bar.title = `${item.month}: $${item.amount.toLocaleString('id-ID')}`;
                barWrapper.appendChild(bar);

                const label = document.createElement('div');
                label.className = 'simple-chart-label';
                label.textContent = item.month;
                barWrapper.appendChild(label);
                chartDiv.appendChild(barWrapper);
            });
            chartOuterContainer.appendChild(chartDiv);
            container.appendChild(chartOuterContainer);

            return DashboardSectionComponent({ title: 'Laporan Pendapatan', children: container });
        }

        // --- 8. Fungsi Komponen Halaman (Views) ---
        let currentPropertyDetailModal = null;

        function HomePageComponent() {
            const pageContainer = document.createElement('div');
            pageContainer.className = 'space-y-12';

            const heroSection = document.createElement('section');
            heroSection.className = 'text-center py-12 md:py-16 lg:py-20 bg-gradient-to-br from-primary/10 to-secondary/10 dark:from-primary/5 dark:to-secondary/5 rounded-xl shadow-inner animate-fade-in';
            // Dinamis set background karena perbedaan variabel val
            if (currentTheme === Theme.LIGHT) {
                heroSection.style.background = `linear-gradient(to bottom right, rgba(var(--color-primary-default-val), 0.1), rgba(var(--color-secondary-default-val), 0.1))`;
            } else {
                heroSection.style.background = `linear-gradient(to bottom right, rgba(var(--color-primary-light-val), 0.05), rgba(var(--color-secondary-light-val), 0.05))`;
            }


            const heroTitle = document.createElement('h1');
            heroTitle.className = 'text-4xl sm:text-5xl font-extrabold text-primary dark:text-primary-light mb-4 leading-tight';
            heroTitle.innerHTML = `Temukan <span class="text-secondary dark:text-secondary-light">Hunian Impian</span> Anda`;
            heroSection.appendChild(heroTitle);

            const heroSubtitle = document.createElement('p');
            heroSubtitle.className = 'text-lg text-text-muted max-w-2xl mx-auto px-4';
            heroSubtitle.textContent = 'Jelajahi beragam pilihan properti eksklusif di Green Valley. Dari apartemen modern hingga rumah keluarga yang nyaman, semua tersedia untuk Anda.';
            heroSection.appendChild(heroSubtitle);

            const heroButton = ButtonComponent({
                textContent: 'Jelajahi Properti Sekarang',
                size: 'lg',
                variant: 'primary',
                className: 'mt-8 animate-bounce-slow', // Efek bounce halus
                onClick: () => {
                    const propertiesSectionEl = document.getElementById('available-properties-section');
                    if (propertiesSectionEl) {
                        propertiesSectionEl.scrollIntoView({ behavior: 'smooth' });
                    }
                }
            });
            // CSS untuk animasi bounce
            const style = document.createElement('style');
            style.textContent = `@keyframes bounce-slow { 0%, 100% { transform: translateY(-3%); animation-timing-function: cubic-bezier(0.8,0,1,1); } 50% { transform: none; animation-timing-function: cubic-bezier(0,0,0.2,1); }}`;
            document.head.appendChild(style);
            heroSection.appendChild(heroButton);

            pageContainer.appendChild(heroSection);

            const propertiesSection = document.createElement('section');
            propertiesSection.id = 'available-properties-section'; // ID untuk scroll
            propertiesSection.setAttribute('aria-labelledby', 'properties-title');
            const sectionTitle = document.createElement('h2');
            sectionTitle.id = 'properties-title';
            sectionTitle.className = 'text-3xl font-semibold mb-8 text-text-default text-center';
            sectionTitle.textContent = 'Properti Terbaik Untuk Anda';
            propertiesSection.appendChild(sectionTitle);
            propertiesSection.appendChild(PropertyListComponent(appState.properties.filter(p => p.status === 'Tersedia'), openPropertyDetailModal));
            pageContainer.appendChild(propertiesSection);

            return pageContainer;
        }

        function DashboardPageComponent() {
            const pageContainer = document.createElement('div');
            pageContainer.className = 'space-y-8 animate-fade-in';
            const titleH1 = document.createElement('h1');
            titleH1.className = 'text-3xl font-semibold text-text-default';
            titleH1.textContent = 'Dasbor Pengelola Properti';
            pageContainer.appendChild(titleH1);

            pageContainer.appendChild(PropertyManagementWidgetComponent());
            pageContainer.appendChild(IncomeReportWidgetComponent());

            return pageContainer;
        }

        function NotificationsPageComponent() {
            const pageContainer = document.createElement('div');
            pageContainer.className = 'animate-fade-in';
            const titleH1 = document.createElement('h1');
            titleH1.className = 'text-3xl font-semibold mb-8 text-text-default';
            titleH1.textContent = 'Notifikasi Terbaru';
            pageContainer.appendChild(titleH1);
            pageContainer.appendChild(NotificationListComponent(appState.notifications));
            return pageContainer;
        }

        // --- Helper State Modal ---
        function openPropertyDetailModal(propertyId) {
            appState.selectedPropertyModal = { isOpen: true, propertyId };
            renderApp();
        }
        function closePropertyDetailModal() {
            if (currentPropertyDetailModal && currentPropertyDetailModal.cleanup) {
                currentPropertyDetailModal.cleanup();
            }
            currentPropertyDetailModal = null;
            appState.selectedPropertyModal = { isOpen: false, propertyId: null };
            renderApp();
        }
        function openPropertyFormModal(propertyIdToEdit = null) { // Default null untuk add
            appState.propertyFormModal = { isOpen: true, propertyToEditId: propertyIdToEdit, isGeneratingDesc: false };
            renderApp();
        }
        function closePropertyFormModal() {
            if (currentPropertyFormModal && currentPropertyFormModal.cleanup) {
                currentPropertyFormModal.cleanup();
            }
            currentPropertyFormModal = null;
            appState.propertyFormModal = { isOpen: false, propertyToEditId: null, isGeneratingDesc: false };
            renderApp();
        }

        // --- 9. Logika Router SPA ---
        function navigateTo(path) {
            if (window.location.hash !== `#${path}`) {
                window.location.hash = path;
            } else {
                // Jika hash sama, paksa render ulang (berguna jika state berubah tanpa navigasi)
                renderApp();
            }
        }

        function handleHashChange() {
            const path = window.location.hash.replace(/^#\/?/, '') || 'home';
            appState.currentPage = path.split('/')[0];
            window.scrollTo(0, 0); // Scroll ke atas setiap pindah halaman
            renderApp();
        }

        // --- 10. Fungsi Render Utama Aplikasi ---
        const appRoot = document.getElementById('app-root');
        let headerElement = null;
        let mainContentContainer = null;
        let footerElement = null;

        function renderApp() {
            // Pastikan tema diterapkan sebelum rendering elemen
            applyTheme(currentTheme);

            // Header: Render atau Update
            const newHeader = HeaderComponent(); // Header selalu diregenerate karena status link aktif bisa berubah
            if (!headerElement) {
                appRoot.appendChild(newHeader);
            } else {
                headerElement.replaceWith(newHeader);
            }
            headerElement = newHeader;

            // Main Content Area: Buat jika belum ada, lalu isi
            if (!mainContentContainer) {
                mainContentContainer = document.createElement('main');
                mainContentContainer.className = 'flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12';
                appRoot.insertBefore(mainContentContainer, footerElement); // Sisipkan sebelum footer jika footer sudah ada
            }
            mainContentContainer.innerHTML = ''; // Bersihkan konten utama

            let pageComponent;
            switch (appState.currentPage) {
                case 'home': pageComponent = HomePageComponent(); break;
                case 'dashboard': pageComponent = DashboardPageComponent(); break;
                case 'notifications': pageComponent = NotificationsPageComponent(); break;
                default:
                    pageComponent = document.createElement('div');
                    pageComponent.className = 'text-center py-12 animate-fade-in';
                    pageComponent.innerHTML = `<h1 class="text-4xl font-bold text-red-500 mb-4">404</h1><p class="text-xl text-text-muted mb-6">Oops! Halaman yang Anda cari tidak ditemukan.</p><a href="#home" class="button-base button-primary button-sz-md">Kembali ke Beranda</a>`;
            }
            mainContentContainer.appendChild(pageComponent);

            // Footer: Render atau Update (biasanya statis, jadi hanya render sekali)
            if (!footerElement) {
                footerElement = FooterComponent();
                appRoot.appendChild(footerElement);
            } else {
                // Jika footer perlu update (misal tahun), bisa di-replace di sini
                // const newFooter = FooterComponent();
                // footerElement.replaceWith(newFooter);
                // footerElement = newFooter;
            }

            // Render Modals Global
            // Hapus modal lama sebelum render yang baru
            if (currentPropertyDetailModal && currentPropertyDetailModal.cleanup) {
                currentPropertyDetailModal.cleanup();
            }
            currentPropertyDetailModal = null;

            if (currentPropertyFormModal && currentPropertyFormModal.cleanup) {
                currentPropertyFormModal.cleanup();
            }
            currentPropertyFormModal = null;

            if (appState.selectedPropertyModal.isOpen && appState.selectedPropertyModal.propertyId) {
                const property = appState.properties.find(p => p.id === appState.selectedPropertyModal.propertyId);
                if (property) {
                    const modalContentEl = document.createElement('div');
                    modalContentEl.className = 'space-y-3';

                    const img = document.createElement('img');
                    img.src = property.imageUrl;
                    img.alt = `Gambar ${property.name}`;
                    img.className = 'w-full h-64 object-cover rounded-lg mb-4 shadow-md';
                    modalContentEl.appendChild(img);

                    const createDetailItem = (label, value) => {
                        const p = document.createElement('p');
                        p.className = 'text-text-default';
                        const strong = document.createElement('strong');
                        strong.className = 'text-text-muted font-medium';
                        strong.textContent = `${label}: `;
                        p.appendChild(strong);
                        p.appendChild(document.createTextNode(value));
                        return p;
                    };
                    modalContentEl.appendChild(createDetailItem('Alamat Lengkap', property.address));
                    modalContentEl.appendChild(createDetailItem('Tipe Properti', property.type));
                    modalContentEl.appendChild(createDetailItem('Jumlah Kamar Tidur', property.bedrooms));
                    modalContentEl.appendChild(createDetailItem('Jumlah Kamar Mandi', property.bathrooms));
                    modalContentEl.appendChild(createDetailItem('Harga Sewa Bulanan', `$${Number(property.rentPrice).toLocaleString('id-ID')}`));

                    const descTitle = document.createElement('h4');
                    descTitle.className = 'text-md font-semibold text-text-muted mt-4 pt-3 border-t border-border';
                    descTitle.textContent = 'Deskripsi Lengkap:';
                    modalContentEl.appendChild(descTitle);
                    const descP = document.createElement('p');
                    descP.className = 'text-text-default whitespace-pre-line'; // Agar baris baru di deskripsi tampil
                    descP.textContent = property.description;
                    modalContentEl.appendChild(descP);

                    currentPropertyDetailModal = ModalComponent({
                        isOpen: true,
                        onClose: closePropertyDetailModal,
                        title: property.name,
                        size: 'lg',
                        children: modalContentEl
                    });
                    if (currentPropertyDetailModal) document.body.appendChild(currentPropertyDetailModal);
                }
            }

            if (appState.propertyFormModal.isOpen) {
                currentPropertyFormModal = PropertyFormModalComponent();
                if (currentPropertyFormModal) document.body.appendChild(currentPropertyFormModal);
            }
        }

        // --- 11. Inisialisasi Aplikasi ---
        window.addEventListener('hashchange', handleHashChange);
        document.addEventListener('DOMContentLoaded', () => {
            // applyTheme(currentTheme); // Sudah dipanggil di awal renderApp
            handleHashChange(); // Render halaman awal
        });

    </script>
</body>

</html>