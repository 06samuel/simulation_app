<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galeri Foto Modern & Elegan</title>
    <meta name="description"
        content="Galeri foto modern, responsif, dan dinamis dengan paginasi, dibangun dengan HTML, CSS3, dan Vanilla JavaScript.">

    <style>
        /* === CSS RESET & DASAR === */
        :root {
            --primary-color: #00A9FF;
            --secondary-color: #89CFF3;
            --background-color: #1a1a1a;
            --card-background-color: #2c2c2c;
            --text-color: #e0e0e0;
            --text-muted-color: #a0a0a0;
            --border-color: #444444;
            --shadow-color: rgba(0, 0, 0, 0.2);
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --border-radius: 8px;
            --transition-speed: 0.3s;

            /* Colors for notifications */
            --success-color: #28a745;
            --error-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: var(--primary-color);
            /* Using primary for info */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
            /* Basis ukuran font untuk REM */
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }

        /* Visually hidden class */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* === STRUKTUR UTAMA & SEMANTIK === */
        .site-header {
            background-color: var(--card-background-color);
            padding: 1rem 2rem;
            /* Adjusted padding */
            text-align: center;
            box-shadow: 0 2px 10px var(--shadow-color);
            border-bottom: 1px solid var(--border-color);
        }

        .site-header h1 {
            color: var(--primary-color);
            font-size: 2.2rem;
            /* Adjusted size */
            margin-bottom: 0.3rem;
            font-weight: 700;
        }

        .site-header p {
            color: var(--text-muted-color);
            font-size: 0.9rem;
            /* Adjusted size */
            margin-bottom: 0.5rem;
        }

        .header-actions {
            margin-top: 0.5rem;
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-button {
            background-color: var(--primary-color);
            color: var(--background-color);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.85rem;
            transition: background-color var(--transition-speed);
        }

        .action-button:hover {
            background-color: var(--secondary-color);
        }


        .site-main {
            flex-grow: 1;
            padding: 2rem;
            max-width: 1200px;
            width: 90%;
            margin: 0 auto;
        }

        .site-footer {
            background-color: var(--card-background-color);
            padding: 1.5rem 2rem;
            text-align: center;
            color: var(--text-muted-color);
            font-size: 0.9rem;
            border-top: 1px solid var(--border-color);
        }

        /* === GALERI FOTO === */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .gallery-item {
            background-color: var(--card-background-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 4px 15px var(--shadow-color);
            transition: transform var(--transition-speed) ease-in-out, box-shadow var(--transition-speed) ease-in-out;
            display: flex;
            flex-direction: column;
            cursor: pointer;
        }

        .gallery-item:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 169, 255, 0.3);
        }

        .gallery-item__image-container {
            width: 100%;
            height: 220px;
            overflow: hidden;
            background-color: #333;
        }

        .gallery-item__image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform var(--transition-speed) ease;
        }

        .gallery-item:hover .gallery-item__image {
            transform: scale(1.1);
        }

        .gallery-item__caption {
            padding: 1rem;
            flex-grow: 1;
        }

        .gallery-item__title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.3rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .gallery-item__description {
            font-size: 0.85rem;
            color: var(--text-muted-color);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            min-height: 2.5em;
        }

        /* === PAGINASI === */
        .pagination-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 2rem;
            padding: 1rem 0;
        }

        .pagination-nav__ellipsis {
            padding: 0.6rem 0.5rem;
            color: var(--text-muted-color);
        }

        .pagination-nav__button {
            background-color: var(--card-background-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 0.6rem 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color var(--transition-speed), color var(--transition-speed), transform var(--transition-speed);
            font-size: 0.9rem;
            min-width: 40px;
            text-align: center;
        }

        .pagination-nav__button:hover:not(:disabled) {
            background-color: var(--primary-color);
            color: var(--background-color);
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .pagination-nav__button--active {
            background-color: var(--primary-color);
            color: var(--background-color);
            border-color: var(--primary-color);
            font-weight: bold;
        }

        .pagination-nav__button:disabled {
            background-color: #222;
            color: #555;
            cursor: not-allowed;
            border-color: #333;
        }

        /* === MODAL LIGHTBOX === */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity var(--transition-speed) ease-in-out;
            padding: 1rem;
        }

        .lightbox.active {
            display: flex;
            opacity: 1;
        }

        .lightbox__content {
            position: relative;
            background-color: var(--card-background-color);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px var(--shadow-color);
            max-width: 90vw;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            animation: lightbox-appear 0.3s ease-out;
        }

        @keyframes lightbox-appear {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .lightbox__image {
            max-width: 100%;
            max-height: 70vh;
            object-fit: contain;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }

        .lightbox__caption {
            text-align: center;
        }

        .lightbox__title {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .lightbox__description {
            font-size: 1rem;
            color: var(--text-muted-color);
        }

        .lightbox__close {
            position: absolute;
            top: -15px;
            right: -15px;
            background-color: var(--primary-color);
            color: var(--background-color);
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color var(--transition-speed), transform var(--transition-speed);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .lightbox__close:hover {
            background-color: var(--secondary-color);
            transform: rotate(90deg);
        }

        /* === TOAST NOTIFICATIONS === */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
            /* Above most elements */
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .toast {
            background-color: var(--card-background-color);
            color: var(--text-color);
            padding: 0.8rem 1.2rem;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px var(--shadow-color);
            display: flex;
            align-items: center;
            gap: 0.8rem;
            opacity: 0;
            transform: translateX(100%);
            transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease;
            min-width: 250px;
            border-left: 5px solid var(--info-color);
            /* Default border */
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast--success {
            border-left-color: var(--success-color);
        }

        .toast--error {
            border-left-color: var(--error-color);
        }

        .toast--warning {
            border-left-color: var(--warning-color);
        }

        .toast--info {
            border-left-color: var(--info-color);
        }

        .toast__message {
            flex-grow: 1;
            font-size: 0.9rem;
        }

        .toast__close-button {
            background: none;
            border: none;
            color: var(--text-muted-color);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.2rem;
            line-height: 1;
        }

        .toast__close-button:hover {
            color: var(--text-color);
        }


        /* === ALERT MODAL === */
        .alert-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            /* Slightly less dark than lightbox */
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1010;
            /* Above lightbox, below toast potentially */
            opacity: 0;
            transition: opacity var(--transition-speed) ease-in-out;
            padding: 1rem;
        }

        .alert-modal.active {
            display: flex;
            opacity: 1;
        }

        .alert-modal__content {
            background-color: var(--card-background-color);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 20px var(--shadow-color);
            max-width: 450px;
            width: 90%;
            text-align: center;
            animation: lightbox-appear 0.2s ease-out;
            /* Reuse animation */
        }

        .alert-modal__title {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 0.8rem;
        }

        .alert-modal__message {
            font-size: 1rem;
            color: var(--text-muted-color);
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .alert-modal__actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .alert-modal__button {
            padding: 0.6rem 1.2rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }

        .alert-modal__button--primary {
            background-color: var(--primary-color);
            color: var(--background-color);
            border-color: var(--primary-color);
        }

        .alert-modal__button--primary:hover {
            background-color: var(--secondary-color);
        }

        .alert-modal__button--secondary {
            background-color: transparent;
            color: var(--text-color);
        }

        .alert-modal__button--secondary:hover {
            background-color: var(--border-color);
        }

        /* === FLASH MESSAGES === */
        .flash-message-container {
            position: fixed;
            /* Or absolute if you want it within a specific parent */
            top: 0;
            /* Adjust if you have a fixed header, maybe below header */
            left: 0;
            width: 100%;
            z-index: 1005;
            /* Below modals, above main content */
            padding: 0;
            /* Container takes full width */
        }

        .flash-message {
            padding: 1rem 1.5rem;
            margin-bottom: 0;
            /* Messages stack directly if multiple */
            color: var(--background-color);
            /* Text color on colored background */
            display: flex;
            justify-content: space-between;
            align-items: center;
            opacity: 0;
            transform: translateY(-100%);
            transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease;
            font-size: 0.95rem;
        }

        .flash-message.show {
            opacity: 1;
            transform: translateY(0);
        }

        .flash-message--success {
            background-color: var(--success-color);
        }

        .flash-message--error {
            background-color: var(--error-color);
        }

        .flash-message--warning {
            background-color: var(--warning-color);
        }

        .flash-message--info {
            background-color: var(--info-color);
        }

        .flash-message__text {
            flex-grow: 1;
        }

        .flash-message__close-button {
            background: none;
            border: none;
            color: inherit;
            /* Inherits from flash message (e.g., dark text on light bg) */
            opacity: 0.7;
            font-size: 1.3rem;
            cursor: pointer;
            padding: 0 0.5rem;
            margin-left: 1rem;
            line-height: 1;
        }

        .flash-message__close-button:hover {
            opacity: 1;
        }


        /* === OFF-CANVAS PANEL === */
        .off-canvas-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1030;
            /* Below off-canvas, above other content */
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-speed) ease, visibility 0s var(--transition-speed) linear;
        }

        .off-canvas-overlay.active {
            opacity: 1;
            visibility: visible;
            transition-delay: 0s;
        }

        .off-canvas {
            position: fixed;
            top: 0;
            right: -350px;
            /* Start off-screen (width + some buffer) */
            width: 320px;
            /* Width of the panel */
            height: 100%;
            background-color: var(--card-background-color);
            box-shadow: -5px 0 15px var(--shadow-color);
            z-index: 1040;
            /* Above overlay */
            transition: right var(--transition-speed) ease-in-out;
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .off-canvas.open {
            right: 0;
        }

        .off-canvas__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .off-canvas__title {
            font-size: 1.4rem;
            color: var(--primary-color);
        }

        .off-canvas__close-button {
            background: none;
            border: none;
            color: var(--text-muted-color);
            font-size: 1.8rem;
            cursor: pointer;
            line-height: 1;
        }

        .off-canvas__close-button:hover {
            color: var(--text-color);
        }

        .off-canvas__body p {
            margin-bottom: 1rem;
            line-height: 1.7;
        }


        /* === UTILITIES & ANIMASI TAMBAHAN === */
        .loading-indicator {
            text-align: center;
            padding: 2rem;
            font-size: 1.2rem;
            color: var(--text-muted-color);
        }

        /* Media Queries */
        @media (max-width: 768px) {
            .site-header h1 {
                font-size: 1.8rem;
            }

            .gallery-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }

            .lightbox__title {
                font-size: 1.2rem;
            }

            .lightbox__description {
                font-size: 0.9rem;
            }

            .off-canvas {
                width: 280px;
                right: -300px;
            }
        }

        @media (max-width: 480px) {
            html {
                font-size: 14px;
            }

            .site-main {
                padding: 1rem;
                width: 95%;
            }

            .gallery-grid {
                gap: 1rem;
            }

            .gallery-item__image-container {
                height: 180px;
            }

            .pagination-nav__button {
                padding: 0.5rem 0.8rem;
                font-size: 0.8rem;
            }

            .toast-container {
                right: 10px;
                bottom: 10px;
                width: calc(100% - 20px);
            }

            .toast {
                min-width: unset;
                width: 100%;
            }

            .alert-modal__content {
                width: 95%;
            }

            .off-canvas {
                width: 100%;
                right: -100%;
            }

            /* Full width on small screens */

        }
    </style>
</head>

<body>

    <header class="site-header" role="banner">
        <h1>Galeri Foto Memukau</h1>
        <p>Jelajahi koleksi foto-foto pilihan dengan desain yang memanjakan mata.</p>
        <div class="header-actions">
            <button id="show-toast-btn" class="action-button">Tampilkan Toast</button>
            <button id="show-alert-btn" class="action-button">Tampilkan Alert</button>
            <button id="show-flash-btn" class="action-button">Tampilkan Flash</button>
            <button id="open-off-canvas-btn" class="action-button">Pengaturan</button>
        </div>
    </header>

    <!-- Flash Message Container -->
    <div id="flash-message-container" class="flash-message-container"></div>

    <main class="site-main" role="main">
        <section id="gallery-section" aria-labelledby="gallery-heading">
            <h2 id="gallery-heading" class="visually-hidden">Koleksi Foto</h2>
            <div id="gallery-container" class="gallery-grid" aria-live="polite">
                <p class="loading-indicator">Memuat gambar...</p>
            </div>
        </section>

        <nav id="pagination-container" class="pagination-nav" aria-label="Navigasi Halaman Galeri">
        </nav>
    </main>

    <footer class="site-footer" role="contentinfo">
        <p>© <span id="current-year"></span> Nama Proyek Anda. Hak Cipta Dilindungi.</p>
    </footer>

    <!-- Lightbox Modal -->
    <div id="lightbox-modal" class="lightbox" role="dialog" aria-modal="true" aria-labelledby="lightbox-title"
        aria-describedby="lightbox-description">
        <div class="lightbox__content">
            <button id="lightbox-close-button" class="lightbox__close" aria-label="Tutup tampilan gambar">×</button>
            <img id="lightbox-image" src="" alt="Tampilan Gambar Besar" class="lightbox__image">
            <div id="lightbox-caption" class="lightbox__caption">
                <h3 id="lightbox-title" class="lightbox__title"></h3>
                <p id="lightbox-description" class="lightbox__description"></p>
            </div>
        </div>
    </div>

    <!-- Alert Modal -->
    <div id="alert-modal" class="alert-modal" role="dialog" aria-modal="true" aria-labelledby="alert-title"
        aria-describedby="alert-message">
        <div class="alert-modal__content">
            <h3 id="alert-title" class="alert-modal__title">Judul Alert</h3>
            <p id="alert-message" class="alert-modal__message">Ini adalah pesan alert.</p>
            <div id="alert-actions" class="alert-modal__actions">
                <!-- Buttons will be added here by JS -->
            </div>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

    <!-- Off-Canvas Panel -->
    <div id="off-canvas-overlay" class="off-canvas-overlay"></div>
    <div id="settings-off-canvas" class="off-canvas" role="dialog" aria-modal="true" aria-labelledby="off-canvas-title">
        <div class="off-canvas__header">
            <h3 id="off-canvas-title" class="off-canvas__title">Pengaturan Galeri</h3>
            <button id="off-canvas-close-btn" class="off-canvas__close-button" aria-label="Tutup Pengaturan">×</button>
        </div>
        <div class="off-canvas__body">
            <p>Ini adalah panel off-canvas untuk pengaturan atau informasi tambahan.</p>
            <p>Anda bisa menambahkan berbagai kontrol atau konten di sini.</p>
            <label for="itemsPerPageSelect">Item per halaman:</label>
            <select id="itemsPerPageSelect" name="itemsPerPageSelect"
                style="padding: 5px; margin-top:5px; background-color: var(--card-background-color); color: var(--text-color); border: 1px solid var(--border-color); border-radius: var(--border-radius)">
                <option value="6">6</option>
                <option value="9" selected>9</option>
                <option value="12">12</option>
                <option value="15">15</option>
            </select>
        </div>
    </div>


    <script>
        // === STATE APLIKASI & KONFIGURASI ===
        const AppState = {
            currentPage: 1,
            itemsPerPage: 9,
            allImages: [],
            totalPages: 0,
            isLoading: true,
        };

        const imageData = [];
        for (let i = 1; i <= 50; i++) {
            imageData.push({
                id: `img${i}`,
                src: `https://picsum.photos/seed/${i + 100}/400/300`,
                alt: `Gambar Pemandangan Alam ${i}`,
                title: `Keindahan Alam #${i}`,
                description: `Deskripsi singkat untuk pemandangan alam yang menakjubkan ke-${i}. Foto ini menampilkan panorama yang indah dan menenangkan jiwa.`
            });
        }
        AppState.allImages = imageData;

        // === ELEMEN DOM ===
        const DOM = {
            galleryContainer: document.getElementById('gallery-container'),
            paginationContainer: document.getElementById('pagination-container'),
            currentYearSpan: document.getElementById('current-year'),
            lightboxModal: document.getElementById('lightbox-modal'),
            lightboxImage: document.getElementById('lightbox-image'),
            lightboxTitle: document.getElementById('lightbox-title'),
            lightboxDescription: document.getElementById('lightbox-description'),
            lightboxCloseButton: document.getElementById('lightbox-close-button'),
            // New UI elements
            toastContainer: document.getElementById('toast-container'),
            alertModal: document.getElementById('alert-modal'),
            alertTitle: document.getElementById('alert-title'),
            alertMessage: document.getElementById('alert-message'),
            alertActions: document.getElementById('alert-actions'),
            flashMessageContainer: document.getElementById('flash-message-container'),
            offCanvas: document.getElementById('settings-off-canvas'),
            offCanvasOverlay: document.getElementById('off-canvas-overlay'),
            offCanvasCloseBtn: document.getElementById('off-canvas-close-btn'),
            itemsPerPageSelect: document.getElementById('itemsPerPageSelect'),
            // Trigger buttons
            showToastBtn: document.getElementById('show-toast-btn'),
            showAlertBtn: document.getElementById('show-alert-btn'),
            showFlashBtn: document.getElementById('show-flash-btn'),
            openOffCanvasBtn: document.getElementById('open-off-canvas-btn'),
        };

        // === TOAST NOTIFICATION FUNCTIONS ===
        /**
         * Shows a toast notification.
         * @param {string} message - The message to display.
         * @param {string} type - Type of toast ('success', 'error', 'warning', 'info').
         * @param {number} duration - Duration in ms before auto-hide. 0 for no auto-hide.
         */
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `toast toast--${type}`;
            toast.setAttribute('role', type === 'error' || type === 'warning' ? 'alert' : 'status');
            // toast.setAttribute('aria-live', type === 'error' || type === 'warning' ? 'assertive' : 'polite'); // Container has aria-live

            const messageEl = document.createElement('span');
            messageEl.className = 'toast__message';
            messageEl.textContent = message;

            const closeButton = document.createElement('button');
            closeButton.className = 'toast__close-button';
            closeButton.innerHTML = '×';
            closeButton.setAttribute('aria-label', 'Tutup notifikasi');
            closeButton.onclick = () => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), parseFloat(getComputedStyle(toast).transitionDuration) * 1000 || 300);
            };

            toast.appendChild(messageEl);
            toast.appendChild(closeButton);
            DOM.toastContainer.appendChild(toast);

            // Trigger animation
            setTimeout(() => toast.classList.add('show'), 50);

            if (duration > 0) {
                setTimeout(() => {
                    toast.classList.remove('show');
                    // Wait for fade out animation to complete before removing
                    setTimeout(() => toast.remove(), parseFloat(getComputedStyle(toast).transitionDuration) * 1000 || 300);
                }, duration);
            }
        }

        // === ALERT MODAL FUNCTIONS ===
        let currentAlertResolve = null;
        /**
         * Shows a modal alert.
         * @param {string} title - The title of the alert.
         * @param {string} message - The message content of the alert.
         * @param {Array<object>} buttons - Array of button objects e.g. [{text: 'OK', type: 'primary', value: true}]
         * @returns {Promise<any>} A promise that resolves with the value of the clicked button.
         */
        function showAlert(title, message, buttons = [{ text: 'OK', type: 'primary', value: true, closesModal: true }]) {
            return new Promise((resolve) => {
                currentAlertResolve = resolve;
                DOM.alertTitle.textContent = title;
                DOM.alertMessage.textContent = message;
                DOM.alertActions.innerHTML = ''; // Clear previous buttons

                buttons.forEach(btnConfig => {
                    const button = document.createElement('button');
                    button.className = `alert-modal__button alert-modal__button--${btnConfig.type || 'secondary'}`;
                    button.textContent = btnConfig.text;
                    button.onclick = () => {
                        if (btnConfig.closesModal !== false) { // Default to true
                            closeAlert();
                        }
                        if (currentAlertResolve) {
                            currentAlertResolve(btnConfig.value);
                            currentAlertResolve = null;
                        }
                        if (btnConfig.callback) {
                            btnConfig.callback();
                        }
                    };
                    DOM.alertActions.appendChild(button);
                });

                DOM.alertModal.classList.add('active');
                document.body.style.overflow = 'hidden';
                // Focus the first button if available
                const firstButton = DOM.alertActions.querySelector('button');
                if (firstButton) firstButton.focus();
                document.addEventListener('keydown', handleAlertKeydown);
            });
        }

        function closeAlert() {
            DOM.alertModal.classList.remove('active');
            document.body.style.overflow = '';
            document.removeEventListener('keydown', handleAlertKeydown);
            if (currentAlertResolve) { // Resolve with a default if closed via Esc or overlay
                currentAlertResolve(null); // Or a specific value like 'dismissed'
                currentAlertResolve = null;
            }
        }

        function handleAlertKeydown(event) {
            if (event.key === 'Escape') {
                closeAlert();
            }
        }

        // === FLASH MESSAGE FUNCTIONS ===
        /**
         * Shows a flash message at the top of the page.
         * @param {string} message - The message to display.
         * @param {string} type - Type of message ('success', 'error', 'warning', 'info').
         * @param {number} duration - Duration in ms. 0 for sticky (manual dismiss).
         */
        function showFlashMessage(message, type = 'info', duration = 5000) {
            const flashMessage = document.createElement('div');
            flashMessage.className = `flash-message flash-message--${type}`;
            flashMessage.setAttribute('role', type === 'error' || type === 'warning' ? 'alert' : 'status');

            const textEl = document.createElement('span');
            textEl.className = 'flash-message__text';
            textEl.textContent = message;
            flashMessage.appendChild(textEl);

            const closeButton = document.createElement('button');
            closeButton.className = 'flash-message__close-button';
            closeButton.innerHTML = '×';
            closeButton.setAttribute('aria-label', 'Tutup pesan');
            closeButton.onclick = () => {
                flashMessage.classList.remove('show');
                setTimeout(() => flashMessage.remove(), parseFloat(getComputedStyle(flashMessage).transitionDuration) * 1000 || 300);
            };
            flashMessage.appendChild(closeButton);

            DOM.flashMessageContainer.appendChild(flashMessage);
            setTimeout(() => flashMessage.classList.add('show'), 50);

            if (duration > 0) {
                setTimeout(() => {
                    flashMessage.classList.remove('show');
                    setTimeout(() => flashMessage.remove(), parseFloat(getComputedStyle(flashMessage).transitionDuration) * 1000 || 300);
                }, duration);
            }
        }


        // === OFF-CANVAS PANEL FUNCTIONS ===
        let previouslyFocusedElementOffCanvas = null;
        function openOffCanvas(id = 'settings-off-canvas') {
            const offCanvasEl = document.getElementById(id);
            if (!offCanvasEl) return;

            previouslyFocusedElementOffCanvas = document.activeElement;
            offCanvasEl.classList.add('open');
            DOM.offCanvasOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            document.addEventListener('keydown', handleOffCanvasKeydown);
            offCanvasEl.querySelector('.off-canvas__close-button, button, a, input, select, textarea').focus();

            // Trap focus
            const focusableElements = offCanvasEl.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            const firstFocusableElement = focusableElements[0];
            const lastFocusableElement = focusableElements[focusableElements.length - 1];

            offCanvasEl.addEventListener('keydown', function (e) {
                if (e.key !== 'Tab') return;
                if (e.shiftKey) { // Shift + Tab
                    if (document.activeElement === firstFocusableElement) {
                        lastFocusableElement.focus();
                        e.preventDefault();
                    }
                } else { // Tab
                    if (document.activeElement === lastFocusableElement) {
                        firstFocusableElement.focus();
                        e.preventDefault();
                    }
                }
            });
        }

        function closeOffCanvas(id = 'settings-off-canvas') {
            const offCanvasEl = document.getElementById(id);
            if (!offCanvasEl) return;

            offCanvasEl.classList.remove('open');
            DOM.offCanvasOverlay.classList.remove('active');
            document.body.style.overflow = '';
            document.removeEventListener('keydown', handleOffCanvasKeydown);
            if (previouslyFocusedElementOffCanvas) {
                previouslyFocusedElementOffCanvas.focus();
                previouslyFocusedElementOffCanvas = null;
            }
        }

        function handleOffCanvasKeydown(event) {
            if (event.key === 'Escape') {
                closeOffCanvas();
            }
        }


        // === FUNGSI UTAMA GALERI (Existing functions modified or kept as is) ===
        function displayGalleryPage(page) {
            AppState.currentPage = page;
            AppState.isLoading = true;
            updateLoadingIndicator();

            setTimeout(() => {
                DOM.galleryContainer.innerHTML = '';
                const startIndex = (page - 1) * AppState.itemsPerPage;
                const endIndex = startIndex + AppState.itemsPerPage;
                const paginatedItems = AppState.allImages.slice(startIndex, endIndex);

                if (paginatedItems.length === 0 && AppState.allImages.length > 0) {
                    DOM.galleryContainer.innerHTML = '<p class="loading-indicator">Halaman tidak ditemukan.</p>';
                    AppState.isLoading = false;
                    updateLoadingIndicator();
                    return;
                }

                if (paginatedItems.length === 0 && AppState.allImages.length === 0) {
                    DOM.galleryContainer.innerHTML = '<p class="loading-indicator">Tidak ada gambar untuk ditampilkan.</p>';
                    AppState.isLoading = false;
                    updateLoadingIndicator();
                    return;
                }

                const fragment = document.createDocumentFragment();
                paginatedItems.forEach(image => {
                    const galleryItem = document.createElement('figure');
                    galleryItem.className = 'gallery-item';
                    galleryItem.setAttribute('tabindex', '0');
                    galleryItem.setAttribute('role', 'button');
                    galleryItem.setAttribute('aria-label', `Lihat ${image.title} lebih besar`);
                    galleryItem.dataset.imageId = image.id;

                    const imageContainer = document.createElement('div');
                    imageContainer.className = 'gallery-item__image-container';
                    const imgElement = document.createElement('img');
                    imgElement.className = 'gallery-item__image';
                    imgElement.src = image.src;
                    imgElement.alt = image.alt;
                    imgElement.loading = 'lazy';
                    const caption = document.createElement('figcaption');
                    caption.className = 'gallery-item__caption';
                    const title = document.createElement('h3');
                    title.className = 'gallery-item__title';
                    title.textContent = image.title;
                    const description = document.createElement('p');
                    description.className = 'gallery-item__description';
                    description.textContent = image.description;

                    imageContainer.appendChild(imgElement);
                    caption.appendChild(title);
                    caption.appendChild(description);
                    galleryItem.appendChild(imageContainer);
                    galleryItem.appendChild(caption);
                    fragment.appendChild(galleryItem);
                });

                DOM.galleryContainer.appendChild(fragment);
                AppState.isLoading = false;
                updateLoadingIndicator();
                addGalleryItemEventListeners();
                // Example: showFlashMessage(`Halaman ${page} berhasil dimuat.`, 'success', 3000);
            }, 300);
        }

        function setupPagination() {
            DOM.paginationContainer.innerHTML = '';
            AppState.totalPages = Math.ceil(AppState.allImages.length / AppState.itemsPerPage);
            if (AppState.totalPages <= 1) return;

            const fragment = document.createDocumentFragment();
            const prevButton = createPaginationButton('Sebelumnya', AppState.currentPage - 1);
            prevButton.disabled = AppState.currentPage === 1;
            prevButton.setAttribute('aria-label', 'Halaman Sebelumnya');
            fragment.appendChild(prevButton);

            const MAX_VISIBLE_PAGES = 5;
            let startPage, endPage;
            if (AppState.totalPages <= MAX_VISIBLE_PAGES) {
                startPage = 1; endPage = AppState.totalPages;
            } else {
                const maxPagesBeforeCurrent = Math.floor(MAX_VISIBLE_PAGES / 2);
                const maxPagesAfterCurrent = Math.ceil(MAX_VISIBLE_PAGES / 2) - 1;
                if (AppState.currentPage <= maxPagesBeforeCurrent) {
                    startPage = 1; endPage = MAX_VISIBLE_PAGES;
                } else if (AppState.currentPage + maxPagesAfterCurrent >= AppState.totalPages) {
                    startPage = AppState.totalPages - MAX_VISIBLE_PAGES + 1; endPage = AppState.totalPages;
                } else {
                    startPage = AppState.currentPage - maxPagesBeforeCurrent; endPage = AppState.currentPage + maxPagesAfterCurrent;
                }
            }

            if (startPage > 1) {
                fragment.appendChild(createPaginationButton('1', 1));
                if (startPage > 2) {
                    const ellipsisStart = document.createElement('span');
                    ellipsisStart.textContent = '...';
                    ellipsisStart.className = 'pagination-nav__ellipsis';
                    fragment.appendChild(ellipsisStart);
                }
            }
            for (let i = startPage; i <= endPage; i++) {
                const pageButton = createPaginationButton(i.toString(), i);
                if (i === AppState.currentPage) {
                    pageButton.classList.add('pagination-nav__button--active');
                    pageButton.setAttribute('aria-current', 'page');
                }
                fragment.appendChild(pageButton);
            }
            if (endPage < AppState.totalPages) {
                if (endPage < AppState.totalPages - 1) {
                    const ellipsisEnd = document.createElement('span');
                    ellipsisEnd.textContent = '...';
                    ellipsisEnd.className = 'pagination-nav__ellipsis';
                    fragment.appendChild(ellipsisEnd);
                }
                fragment.appendChild(createPaginationButton(AppState.totalPages.toString(), AppState.totalPages));
            }

            const nextButton = createPaginationButton('Berikutnya', AppState.currentPage + 1);
            nextButton.disabled = AppState.currentPage === AppState.totalPages;
            nextButton.setAttribute('aria-label', 'Halaman Berikutnya');
            fragment.appendChild(nextButton);
            DOM.paginationContainer.appendChild(fragment);
        }

        function createPaginationButton(text, pageNumber) {
            const button = document.createElement('button');
            button.className = 'pagination-nav__button';
            button.textContent = text;
            button.type = 'button';
            button.addEventListener('click', () => {
                if (pageNumber >= 1 && pageNumber <= AppState.totalPages) {
                    displayGalleryPage(pageNumber);
                    setupPagination();
                    document.getElementById('gallery-section').scrollIntoView({ behavior: 'smooth' });
                }
            });
            return button;
        }

        function updateLoadingIndicator() {
            const existingIndicator = DOM.galleryContainer.querySelector('.loading-indicator');
            if (AppState.isLoading) {
                if (!existingIndicator) {
                    const p = document.createElement('p');
                    p.className = 'loading-indicator';
                    p.textContent = 'Memuat gambar...';
                    DOM.galleryContainer.innerHTML = '';
                    DOM.galleryContainer.appendChild(p);
                }
            } else {
                if (existingIndicator) {
                    if (DOM.galleryContainer.querySelectorAll('.gallery-item').length === 0 && DOM.galleryContainer.textContent.includes('Memuat gambar...')) {
                        // No items and still showing loading text (e.g. page not found) - keep custom message
                    } else {
                        existingIndicator.remove();
                    }
                }
            }
        }

        function addGalleryItemEventListeners() {
            const galleryItems = DOM.galleryContainer.querySelectorAll('.gallery-item');
            galleryItems.forEach(item => {
                item.addEventListener('click', handleGalleryItemClick);
                item.addEventListener('keydown', (event) => {
                    if (event.key === 'Enter' || event.key === ' ') {
                        event.preventDefault();
                        handleGalleryItemClick.call(item, event);
                    }
                });
            });
        }

        function handleGalleryItemClick(event) {
            const imageId = this.dataset.imageId;
            const imgData = AppState.allImages.find(img => img.id === imageId);
            if (imgData) {
                openLightbox(imgData);
            }
        }

        let previouslyFocusedElementLightbox = null;
        function openLightbox(image) {
            previouslyFocusedElementLightbox = document.activeElement;
            DOM.lightboxImage.src = image.src;
            DOM.lightboxImage.alt = image.alt;
            DOM.lightboxTitle.textContent = image.title;
            DOM.lightboxDescription.textContent = image.description;
            DOM.lightboxModal.classList.add('active');
            document.body.style.overflow = 'hidden';
            DOM.lightboxCloseButton.focus();
            document.addEventListener('keydown', handleLightboxKeydown);
        }

        function closeLightbox() {
            DOM.lightboxModal.classList.remove('active');
            document.body.style.overflow = '';
            document.removeEventListener('keydown', handleLightboxKeydown);
            if (previouslyFocusedElementLightbox) {
                previouslyFocusedElementLightbox.focus();
                previouslyFocusedElementLightbox = null;
            }
        }

        function handleLightboxKeydown(event) {
            if (event.key === 'Escape') {
                closeLightbox();
            }
        }


        // === INISIALISASI APLIKASI ===
        function initializeApp() {
            DOM.currentYearSpan.textContent = new Date().getFullYear();

            if (AppState.allImages.length > 0) {
                displayGalleryPage(AppState.currentPage);
                setupPagination();
            } else {
                DOM.galleryContainer.innerHTML = '<p class="loading-indicator">Tidak ada gambar untuk ditampilkan.</p>';
                AppState.isLoading = false;
                updateLoadingIndicator();
            }

            DOM.lightboxCloseButton.addEventListener('click', closeLightbox);
            DOM.lightboxModal.addEventListener('click', (event) => {
                if (event.target === DOM.lightboxModal) closeLightbox();
            });

            // Event Listeners for new UI components
            DOM.showToastBtn.addEventListener('click', () => {
                showToast('Ini adalah notifikasi toast!', 'info', 3000);
                setTimeout(() => showToast('Toast sukses!', 'success', 3500), 500);
                setTimeout(() => showToast('Peringatan penting!', 'warning', 4000), 1000);
                setTimeout(() => showToast('Terjadi kesalahan!', 'error', 0), 1500); // 0 for sticky
            });

            DOM.showAlertBtn.addEventListener('click', async () => {
                const result = await showAlert(
                    'Konfirmasi Aksi',
                    'Apakah Anda yakin ingin melanjutkan aksi ini? Tindakan ini tidak dapat diurungkan.',
                    [
                        { text: 'Batal', type: 'secondary', value: false, closesModal: true },
                        { text: 'Ya, Lanjutkan', type: 'primary', value: true, closesModal: true, callback: () => showToast('Aksi dilanjutkan!', 'success') }
                    ]
                );
                console.log('Hasil Alert:', result);
                if (result === true) {
                    showFlashMessage('Anda memilih untuk melanjutkan.', 'info');
                } else if (result === false) {
                    showFlashMessage('Anda memilih untuk batal.', 'warning');
                } else {
                    showFlashMessage('Alert ditutup tanpa pilihan.', 'info', 2000);
                }
            });
            DOM.alertModal.addEventListener('click', (event) => { // Close on overlay click
                if (event.target === DOM.alertModal) closeAlert();
            });


            DOM.showFlashBtn.addEventListener('click', () => {
                showFlashMessage('Ini adalah pesan flash Info yang akan hilang.', 'info', 5000);
                setTimeout(() => showFlashMessage('Pesan flash Sukses!', 'success', 0), 600); // Sticky
            });

            DOM.openOffCanvasBtn.addEventListener('click', () => openOffCanvas('settings-off-canvas'));
            DOM.offCanvasCloseBtn.addEventListener('click', () => closeOffCanvas('settings-off-canvas'));
            DOM.offCanvasOverlay.addEventListener('click', () => closeOffCanvas('settings-off-canvas'));

            DOM.itemsPerPageSelect.value = AppState.itemsPerPage; // Set initial value from state
            DOM.itemsPerPageSelect.addEventListener('change', (e) => {
                const newItemsPerPage = parseInt(e.target.value, 10);
                if (newItemsPerPage !== AppState.itemsPerPage) {
                    AppState.itemsPerPage = newItemsPerPage;
                    AppState.currentPage = 1; // Reset to first page
                    displayGalleryPage(AppState.currentPage);
                    setupPagination();
                    showToast(`Menampilkan ${AppState.itemsPerPage} item per halaman.`, 'info');
                    closeOffCanvas(); // Optionally close canvas after change
                }
            });

            // Initial welcome messages
            showToast('Selamat datang di Galeri Foto!', 'info', 3000);
            if (AppState.allImages.length > 0) {
                showFlashMessage(`Galeri dimuat dengan ${AppState.allImages.length} gambar. Selamat menikmati!`, 'success', 6000);
            }
        }

        document.addEventListener('DOMContentLoaded', initializeApp);

    </script>
</body>

</html>