<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Apartemen Rental Management System</title>

  <!-- Google Fonts for modern typography -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

  <!-- CSS Dependencies -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />

  <style>
    :root {
      /* Palette: Modern, harmonious, accessible */
      --primary: #2563eb;
      --primary-light: #60a5fa;
      --primary-dark: #1e40af;
      --accent: #f59e42;
      --success: #22c55e;
      --danger: #ef4444;
      --warning: #fbbf24;
      --info: #0ea5e9;
      --neutral: #f4f6fb;
      --surface: #fff;
      --border: #e5e7eb;
      --text-main: #222;
      --text-muted: #64748b;
      --radius: 1rem;
      --radius-sm: 0.7rem;
      --radius-xs: 0.5rem;
      --shadow: 0 4px 24px rgba(0, 0, 0, 0.07);
      --shadow-hover: 0 8px 32px rgba(37, 99, 235, 0.08);
      --transition: 0.2s cubic-bezier(.4, 0, .2, 1);
      --font-main: 'Inter', Arial, sans-serif;
      --font-size-base: 16px;
      --font-size-sm: 0.95rem;
      --font-size-lg: 1.2rem;
      --gap: 1.5rem;
      --gap-sm: 1rem;
      --gap-xs: 0.5rem;
    }

    html,
    body {
      font-family: var(--font-main);
      background: var(--neutral);
      color: var(--text-main);
      font-size: var(--font-size-base);
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }

    /* Utilities */
    .flex {
      display: flex;
    }

    .flex-col {
      flex-direction: column;
    }

    .flex-row {
      flex-direction: row;
    }

    .flex-center {
      align-items: center;
      justify-content: center;
    }

    .gap {
      gap: var(--gap);
    }

    .gap-sm {
      gap: var(--gap-sm);
    }

    .gap-xs {
      gap: var(--gap-xs);
    }

    .w-100 {
      width: 100%;
    }

    .text-center {
      text-align: center;
    }

    .text-muted {
      color: var(--text-muted) !important;
    }

    .mb-0 {
      margin-bottom: 0 !important;
    }

    .mb-1 {
      margin-bottom: 0.5rem !important;
    }

    .mb-2 {
      margin-bottom: 1rem !important;
    }

    .mb-3 {
      margin-bottom: 1.5rem !important;
    }

    .mt-2 {
      margin-top: 1rem !important;
    }

    .p-0 {
      padding: 0 !important;
    }

    .p-1 {
      padding: 0.5rem !important;
    }

    .p-2 {
      padding: 1rem !important;
    }

    .rounded {
      border-radius: var(--radius) !important;
    }

    .rounded-sm {
      border-radius: var(--radius-sm) !important;
    }

    .rounded-xs {
      border-radius: var(--radius-xs) !important;
    }

    .shadow {
      box-shadow: var(--shadow) !important;
    }

    .shadow-hover:hover {
      box-shadow: var(--shadow-hover) !important;
    }

    .bg-surface {
      background: var(--surface) !important;
    }

    .bg-neutral {
      background: var(--neutral) !important;
    }

    .border {
      border: 1px solid var(--border) !important;
    }

    /* Navbar */
    .navbar {
      background: linear-gradient(90deg, var(--primary), var(--primary-light));
      box-shadow: var(--shadow);
      border-radius: 0 0 var(--radius) var(--radius);
      padding: 0.75rem 0;
    }

    .navbar-brand {
      font-weight: 700;
      font-size: 1.6rem;
      letter-spacing: 0.03em;
      color: #fff !important;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .navbar-nav .nav-link {
      font-weight: 500;
      color: #f1f5f9 !important;
      margin-left: 1rem;
      transition: color var(--transition);
      font-size: 1.05rem;
      border-radius: var(--radius-xs);
      padding: 0.4rem 0.9rem;
    }

    .navbar-nav .nav-link.active,
    .navbar-nav .nav-link:hover,
    .navbar-nav .nav-link:focus {
      color: #fff !important;
      background: rgba(255, 255, 255, 0.08);
      text-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
    }

    /* Dashboard Stats */
    .dashboard-stats {
      margin-bottom: var(--gap);
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: var(--gap-sm);
    }

    .stats-card {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 2rem 1rem;
      text-align: center;
      transition: box-shadow var(--transition), transform var(--transition);
      min-height: 140px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .stats-card:hover,
    .stats-card:focus {
      box-shadow: var(--shadow-hover);
      transform: translateY(-4px) scale(1.02);
    }

    .stats-icon {
      font-size: 2.2rem;
      margin-bottom: 0.5rem;
      opacity: 0.85;
    }

    .stats-card h3 {
      font-size: 2.1rem;
      font-weight: 700;
      margin: 0.2rem 0 0.3rem 0;
      color: var(--primary-dark);
    }

    .stats-card p {
      font-size: 1rem;
      color: var(--text-muted);
      margin-bottom: 0;
    }

    /* Card */
    .card {
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: none;
      margin-bottom: 1.5rem;
      background: var(--surface);
    }

    .card-body {
      padding: 2rem 1.5rem;
    }

    /* Form */
    .form-label {
      font-weight: 600;
      color: var(--primary-dark);
      margin-bottom: 0.3rem;
      font-size: 1rem;
    }

    .form-control,
    .form-select {
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
      transition: border-color var(--transition), box-shadow var(--transition);
      font-size: 1rem;
      padding: 0.65rem 1rem;
      background: var(--neutral);
    }

    .form-control:focus,
    .form-select:focus {
      border-color: var(--primary-light);
      box-shadow: 0 0 0 2px #93c5fd33;
      background: #fff;
    }

    /* Buttons */
    .btn {
      border-radius: var(--radius-sm);
      font-weight: 600;
      transition: background var(--transition), color var(--transition), box-shadow var(--transition), transform var(--transition);
      font-size: 1rem;
      padding: 0.5rem 1.2rem;
      outline: none;
    }

    .btn-primary {
      background: linear-gradient(90deg, var(--primary), var(--primary-light));
      border: none;
      color: #fff;
    }

    .btn-primary:hover,
    .btn-primary:focus {
      background: linear-gradient(90deg, var(--primary-light), var(--primary));
      color: #fff;
      box-shadow: 0 2px 8px #2563eb22;
      transform: translateY(-2px) scale(1.03);
    }

    .btn-success,
    .btn-danger,
    .btn-warning {
      color: #fff;
      border: none;
    }

    .btn-success {
      background: var(--success);
    }

    .btn-danger {
      background: var(--danger);
    }

    .btn-warning {
      background: var(--warning);
      color: #222;
    }

    .btn-success:hover {
      background: #16a34a;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .btn-warning:hover {
      background: #d97706;
      color: #fff;
    }

    .action-buttons .btn {
      margin: 0 0.15rem;
      padding: 0.35rem 0.7rem;
      font-size: 1rem;
      min-width: 36px;
      min-height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .action-buttons .btn:focus {
      outline: 2px solid var(--primary-light);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 2.5rem 1rem;
      color: var(--text-muted);
      background: var(--neutral);
      border-radius: var(--radius);
      font-size: 1.1rem;
      letter-spacing: 0.01em;
    }

    /* Request Details */
    .request-details {
      background: #f8fafc;
      border-radius: var(--radius);
      padding: 1.2rem 1rem;
      margin-bottom: 1.2rem;
      border: 1px solid var(--border);
    }

    /* Status Badge */
    .status-badge {
      padding: 0.45em 1.1em;
      border-radius: 1.2em;
      font-weight: 600;
      font-size: 0.98em;
      text-transform: capitalize;
      letter-spacing: 0.01em;
      color: #fff;
      background: var(--text-muted);
      box-shadow: 0 1px 4px #0001;
      display: inline-block;
      min-width: 90px;
      text-align: center;
    }

    .bg-warning {
      background: var(--warning) !important;
      color: #222 !important;
    }

    .bg-success {
      background: var(--success) !important;
    }

    .bg-danger {
      background: var(--danger) !important;
    }

    .bg-info {
      background: var(--info) !important;
    }

    .bg-secondary {
      background: var(--text-muted) !important;
    }

    /* Toast */
    .toast-container {
      position: fixed;
      top: 1.5rem;
      right: 1.5rem;
      z-index: 1060;
    }

    .toast {
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      font-weight: 500;
      font-size: 1rem;
      min-width: 220px;
    }

    /* Table */
    .table {
      margin-bottom: 0;
      border-radius: var(--radius);
      overflow: hidden;
      background: var(--surface);
    }

    .table th,
    .table td {
      vertical-align: middle;
      padding: 0.85rem 0.7rem;
      font-size: 1rem;
      border: none;
    }

    .table th {
      background: var(--neutral);
      color: var(--primary-dark);
      font-weight: 700;
      border-bottom: 2px solid var(--border);
      letter-spacing: 0.01em;
    }

    .table-hover tbody tr:hover {
      background: #e0e7ff44;
      transition: background var(--transition);
    }

    @media (max-width: 991.98px) {
      .dashboard-stats {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: var(--gap-xs);
      }

      .card-body {
        padding: 1.2rem 0.7rem;
      }
    }

    @media (max-width: 767.98px) {
      .dashboard-stats {
        grid-template-columns: 1fr 1fr;
        gap: var(--gap-xs);
      }

      .stats-card {
        min-height: 110px;
        padding: 1.2rem 0.7rem;
      }

      .navbar-brand {
        font-size: 1.2rem;
      }

      .modal-content,
      .card {
        border-radius: var(--radius-sm);
      }

      .table th,
      .table td {
        font-size: var(--font-size-sm);
        padding: 0.6rem 0.4rem;
      }
    }

    @media (max-width: 575.98px) {
      .dashboard-stats {
        grid-template-columns: 1fr;
      }

      .stats-card {
        margin-bottom: 1rem;
      }

      .modal-content,
      .card {
        border-radius: var(--radius-xs);
      }

      .table-responsive {
        overflow-x: auto;
      }

      .table th,
      .table td {
        white-space: nowrap;
      }
    }

    /* Accessibility: focus ring for all interactive elements */
    button:focus,
    .form-control:focus,
    .form-select:focus,
    .nav-link:focus {
      outline: 2px solid var(--primary-light);
      outline-offset: 2px;
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark sticky-top shadow-sm mb-4">
    <div class="container-fluid px-4">
      <a class="navbar-brand d-flex align-items-center gap-2" href="#">
        <i class="bi bi-building"></i> Apartemen Rental System
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav align-items-center">
          <li class="nav-item">
            <a class="nav-link active" href="#">Dashboard</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#addRequestModal">
              <i class="bi bi-plus-circle"></i> Permohonan Baru
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Container -->
  <div class="container-fluid px-3 px-md-4">
    <!-- Dashboard Stats -->
    <div class="dashboard-stats">
      <div class="stats-card">
        <i class="bi bi-file-text stats-icon text-primary"></i>
        <h3 id="totalRequests">0</h3>
        <p class="text-muted">Total Permohonan</p>
      </div>
      <div class="stats-card">
        <i class="bi bi-clock stats-icon text-warning"></i>
        <h3 id="pendingRequests">0</h3>
        <p class="text-muted">Menunggu</p>
      </div>
      <div class="stats-card">
        <i class="bi bi-check-circle stats-icon text-success"></i>
        <h3 id="approvedRequests">0</h3>
        <p class="text-muted">Disetujui</p>
      </div>
      <div class="stats-card">
        <i class="bi bi-x-circle stats-icon text-danger"></i>
        <h3 id="rejectedRequests">0</h3>
        <p class="text-muted">Ditolak</p>
      </div>
    </div>

    <!-- Filters -->
    <div class="card mb-4">
      <div class="card-body">
        <form class="row g-3 align-items-end">
          <div class="col-12 col-md-3">
            <label for="searchInput" class="form-label visually-hidden">Cari</label>
            <input type="text" class="form-control" id="searchInput" placeholder="Cari permohonan..." />
          </div>
          <div class="col-6 col-md-2">
            <label for="filterType" class="form-label visually-hidden">Tipe</label>
            <select class="form-select" id="filterType">
              <option value="">Semua Tipe</option>
              <option value="sewa">Sewa</option>
              <option value="perpanjangan">Perpanjangan</option>
              <option value="keluar">Keluar Unit</option>
              <option value="perbaikan">Permintaan Perbaikan</option>
            </select>
          </div>
          <div class="col-6 col-md-2">
            <label for="filterBranch" class="form-label visually-hidden">Apartemen</label>
            <select class="form-select" id="filterBranch">
              <option value="">Semua Apartemen</option>
              <option value="apt1">Apartemen Utama</option>
              <option value="apt2">Apartemen Kota</option>
              <option value="apt3">Apartemen Pinggir Kota</option>
            </select>
          </div>
          <div class="col-6 col-md-2">
            <label for="filterStatus" class="form-label visually-hidden">Status</label>
            <select class="form-select" id="filterStatus">
              <option value="">Semua Status</option>
              <option value="pending">Menunggu</option>
              <option value="approved">Disetujui</option>
              <option value="rejected">Ditolak</option>
            </select>
          </div>
          <div class="col-6 col-md-3">
            <button class="btn btn-primary w-100" id="refreshData" type="button">
              <i class="bi bi-arrow-clockwise"></i> Muat Ulang Data
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Requests Table -->
    <div class="card">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead>
              <tr>
                <th>ID</th>
                <th>Penyewa</th>
                <th>Tipe</th>
                <th>Apartemen</th>
                <th>Diajukan</th>
                <th>Status</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody id="requestsTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container"></div>

  <!-- Add Request Modal -->
  <div class="modal fade" id="addRequestModal" tabindex="-1" aria-labelledby="addRequestModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addRequestModalLabel">Permohonan Baru</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form id="requestForm" novalidate>
          <div class="modal-body">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label" for="requestType">Tipe Permohonan</label>
                <select class="form-select" id="requestType" name="type" required>
                  <option value="">Pilih Tipe</option>
                  <option value="sewa">Sewa</option>
                  <option value="perpanjangan">Perpanjangan</option>
                  <option value="keluar">Keluar Unit</option>
                  <option value="perbaikan">Permintaan Perbaikan</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="hotelBranch">Apartemen</label>
                <select class="form-select" id="hotelBranch" name="hotelBranch" required>
                  <option value="">Pilih Apartemen</option>
                  <option value="apt1">Apartemen Utama</option>
                  <option value="apt2">Apartemen Kota</option>
                  <option value="apt3">Apartemen Pinggir Kota</option>
                </select>
              </div>
              <div class="col-12">
                <label class="form-label" for="requestDetails">Detail Permohonan</label>
                <textarea class="form-control" id="requestDetails" name="details" rows="3" required></textarea>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="startDate">Tanggal Mulai</label>
                <input type="date" class="form-control" id="startDate" name="startDate" required />
              </div>
              <div class="col-md-6">
                <label class="form-label" for="endDate">Tanggal Selesai</label>
                <input type="date" class="form-control" id="endDate" name="endDate" required />
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              Batal
            </button>
            <button type="submit" class="btn btn-primary">Ajukan Permohonan</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- View/Edit Request Modal -->
  <div class="modal fade" id="viewRequestModal" tabindex="-1" aria-labelledby="viewRequestModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="viewRequestModalLabel">Detail Permohonan</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form id="editRequestForm" novalidate>
          <div class="modal-body">
            <div class="request-details">
              <div class="row">
                <div class="col-md-6">
                  <p>
                    <strong>Penyewa:</strong> <span id="viewEmployee"></span>
                  </p>
                  <p>
                    <strong>Apartemen:</strong> <span id="viewBranch"></span>
                  </p>
                </div>
                <div class="col-md-6">
                  <p>
                    <strong>Diajukan:</strong>
                    <span id="viewSubmitted"></span>
                  </p>
                  <p>
                    <strong>Status:</strong> <span id="viewStatus"></span>
                  </p>
                </div>
              </div>
            </div>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label" for="editRequestType">Tipe Permohonan</label>
                <select class="form-select" id="editRequestType" name="type" required>
                  <option value="sewa">Sewa</option>
                  <option value="perpanjangan">Perpanjangan</option>
                  <option value="keluar">Keluar Unit</option>
                  <option value="perbaikan">Permintaan Perbaikan</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="editHotelBranch">Apartemen</label>
                <select class="form-select" id="editHotelBranch" name="hotelBranch" required>
                  <option value="apt1">Apartemen Utama</option>
                  <option value="apt2">Apartemen Kota</option>
                  <option value="apt3">Apartemen Pinggir Kota</option>
                </select>
              </div>
              <div class="col-12">
                <label class="form-label" for="editRequestDetails">Detail Permohonan</label>
                <textarea class="form-control" id="editRequestDetails" name="details" rows="3" required></textarea>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="editStartDate">Tanggal Mulai</label>
                <input type="date" class="form-control" id="editStartDate" name="startDate" required />
              </div>
              <div class="col-md-6">
                <label class="form-label" for="editEndDate">Tanggal Selesai</label>
                <input type="date" class="form-control" id="editEndDate" name="endDate" required />
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              Tutup
            </button>
            <button type="button" class="btn btn-success" onclick="updateRequestStatus('approved')">
              Setujui
            </button>
            <button type="button" class="btn btn-danger" onclick="updateRequestStatus('rejected')">
              Tolak
            </button>
            <button type="submit" class="btn btn-primary">
              Simpan Perubahan
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      let state = {
        requests: JSON.parse(localStorage.getItem("requests")) || [],
        currentRequestId: null,
        filters: {
          search: "",
          type: "",
          branch: "",
          status: "",
        },
      };

      init();

      function init() {
        setupEventListeners();
        renderRequests();
      }

      function setupEventListeners() {
        document
          .getElementById("requestForm")
          .addEventListener("submit", handleNewRequest);
        document
          .getElementById("editRequestForm")
          .addEventListener("submit", handleEditRequest);

        document
          .getElementById("searchInput")
          .addEventListener("input", debounce(handleFilter, 300));
        document
          .getElementById("filterType")
          .addEventListener("change", handleFilter);
        document
          .getElementById("filterBranch")
          .addEventListener("change", handleFilter);
        document
          .getElementById("filterStatus")
          .addEventListener("change", handleFilter);

        document
          .getElementById("refreshData")
          .addEventListener("click", () => {
            state.requests =
              JSON.parse(localStorage.getItem("requests")) || [];
            renderRequests();
            showToast("Data berhasil dimuat ulang", "info");
          });
      }

      function handleNewRequest(e) {
        e.preventDefault();
        const formData = new FormData(e.target);

        if (!validateForm(formData)) return;

        const newRequest = {
          id: `REQ${Date.now().toString().slice(-4)}`,
          employee: "Penyewa Baru",
          ...Object.fromEntries(formData),
          status: "pending",
          submitted: new Date().toISOString().split("T")[0],
        };

        state.requests.unshift(newRequest);
        saveRequests();
        $("#addRequestModal").modal("hide");
        showToast("Permohonan berhasil diajukan", "success");
        e.target.reset();
      }

      function handleEditRequest(e) {
        e.preventDefault();
        const formData = new FormData(e.target);
        const updatedRequest = {
          ...state.requests.find((r) => r.id === state.currentRequestId),
          ...Object.fromEntries(formData),
        };

        state.requests = state.requests.map((r) =>
          r.id === state.currentRequestId ? updatedRequest : r
        );

        saveRequests();
        $("#viewRequestModal").modal("hide");
        showToast("Permohonan berhasil diperbarui", "success");
      }

      window.showRequestDetail = (id) => {
        state.currentRequestId = id;
        const request = state.requests.find((r) => r.id === id);

        document.getElementById("viewEmployee").textContent =
          request.employee;
        document.getElementById("viewBranch").textContent =
          request.hotelBranch;
        document.getElementById("viewSubmitted").textContent =
          request.submitted;
        document.getElementById(
          "viewStatus"
        ).innerHTML = `<span class="status-badge bg-${getStatusColor(
          request.status
        )}">${request.status}</span>`;

        document.getElementById("editRequestType").value = request.type;
        document.getElementById("editHotelBranch").value =
          request.hotelBranch;
        document.getElementById("editRequestDetails").value = request.details;
        document.getElementById("editStartDate").value = request.startDate;
        document.getElementById("editEndDate").value = request.endDate;

        $("#viewRequestModal").modal("show");
      };

      window.updateRequestStatus = (status) => {
        state.requests = state.requests.map((r) =>
          r.id === state.currentRequestId ? { ...r, status } : r
        );

        saveRequests();
        showToast(
          `Permohonan ${status === "approved" ? "disetujui" : "ditolak"}!`,
          status === "approved" ? "success" : "danger"
        );
        $("#viewRequestModal").modal("hide");
      };

      window.deleteRequest = (id) => {
        if (confirm("Yakin ingin menghapus permohonan ini?")) {
          state.requests = state.requests.filter((r) => r.id !== id);
          saveRequests();
          showToast("Permohonan berhasil dihapus", "danger");
        }
      };

      function saveRequests() {
        localStorage.setItem("requests", JSON.stringify(state.requests));
        renderRequests();
      }

      function renderRequests() {
        const filteredRequests = state.requests.filter(
          (request) =>
            (request.employee.toLowerCase().includes(state.filters.search) ||
              request.id.toLowerCase().includes(state.filters.search)) &&
            (state.filters.type
              ? request.type === state.filters.type
              : true) &&
            (state.filters.branch
              ? request.hotelBranch === state.filters.branch
              : true) &&
            (state.filters.status
              ? request.status === state.filters.status
              : true)
        );

        const tbody = document.getElementById("requestsTableBody");
        tbody.innerHTML =
          filteredRequests.length > 0
            ? filteredRequests
              .map(
                (request) => `
                      <tr class="request-card">
                        <td>${request.id}</td>
                        <td>${request.employee}</td>
                        <td>${request.type.charAt(0).toUpperCase() +
                  request.type.slice(1)
                  }</td>
                        <td>${request.hotelBranch}</td>
                        <td>${request.submitted}</td>
                        <td><span class="status-badge bg-${getStatusColor(
                    request.status
                  )}">${request.status}</span></td>
                        <td>
                          <div class="action-buttons d-flex flex-nowrap">
                            <button class="btn btn-sm btn-primary" title="Lihat" onclick="showRequestDetail('${request.id
                  }')">
                              <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" title="Edit" onclick="showRequestDetail('${request.id
                  }')">
                              <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" title="Hapus" onclick="deleteRequest('${request.id
                  }')">
                              <i class="bi bi-trash"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                    `
              )
              .join("")
            : `<tr><td colspan="7" class="empty-state">Tidak ada permohonan ditemukan</td></tr>`;
        updateDashboardStats();
      }

      function updateDashboardStats() {
        const stats = {
          total: state.requests.length,
          pending: state.requests.filter((r) => r.status === "pending")
            .length,
          approved: state.requests.filter((r) => r.status === "approved")
            .length,
          rejected: state.requests.filter((r) => r.status === "rejected")
            .length,
        };

        document.getElementById("totalRequests").textContent = stats.total;
        document.getElementById("pendingRequests").textContent =
          stats.pending;
        document.getElementById("approvedRequests").textContent =
          stats.approved;
        document.getElementById("rejectedRequests").textContent =
          stats.rejected;
      }

      function handleFilter() {
        state.filters.search = document.getElementById("searchInput").value.trim().toLowerCase();
        state.filters.type = document.getElementById("filterType").value;
        state.filters.branch = document.getElementById("filterBranch").value;
        state.filters.status = document.getElementById("filterStatus").value;
        renderRequests();
      }

      function debounce(func, timeout = 300) {
        let timer;
        return (...args) => {
          clearTimeout(timer);
          timer = setTimeout(() => func.apply(this, args), timeout);
        };
      }

      function getStatusColor(status) {
        return {
          pending: "warning",
          approved: "success",
          rejected: "danger",
        }[status] || "secondary";
      }

      function showToast(message, type = "success") {
        const toast = document.createElement("div");
        toast.className = `toast align-items-center text-white bg-${type}`;
        toast.setAttribute("role", "alert");
        toast.setAttribute("aria-live", "assertive");
        toast.setAttribute("aria-atomic", "true");
        toast.innerHTML = `
            <div class="d-flex">
              <div class="toast-body">${message}</div>
              <button type="button" class="btn-close btn-close-white me-2 m-auto"
                data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
          `;
        document.querySelector(".toast-container").appendChild(toast);
        new bootstrap.Toast(toast, { autohide: true, delay: 3000 }).show();
      }

      function validateForm(formData) {
        const startDate = new Date(formData.get("startDate"));
        const endDate = new Date(formData.get("endDate"));

        if (endDate < startDate) {
          showToast("Tanggal selesai tidak boleh sebelum tanggal mulai", "danger");
          return false;
        }

        return true;
      }
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
</body>

</html>