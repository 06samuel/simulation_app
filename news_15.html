<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green Valley - Sewa Apartemen Impian Anda</title>
    <style>
        /* Reset CSS Dasar & Utilitas Visual */
        :root {
            --primary-color: #4CAF50;
            /* Hijau yang menenangkan */
            --secondary-color: #8BC34A;
            --accent-color: #FFC107;
            /* Kuning untuk CTA */
            --text-color: #333333;
            --light-text-color: #FFFFFF;
            --background-color: #f4f7f6;
            --card-background: #FFFFFF;
            --border-color: #e0e0e0;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --font-sans: 'Arial', sans-serif;
            /* Ganti dengan font yang lebih baik jika ada */
            --font-serif: 'Georgia', serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-sans);
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        a {
            text-decoration: none;
            color: var(--primary-color);
            transition: color 0.3s ease;
        }

        a:hover {
            color: var(--secondary-color);
        }

        img {
            max-width: 100%;
            height: auto;
            display: block;
        }

        button,
        input[type="submit"],
        .button {
            background-color: var(--accent-color);
            color: var(--text-color);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.1s ease;
            text-align: center;
        }

        button:hover,
        input[type="submit"]:hover,
        .button:hover {
            background-color: #ffb300;
            transform: translateY(-1px);
        }

        button:active,
        input[type="submit"]:active,
        .button:active {
            transform: translateY(0px);
        }

        button.primary,
        .button.primary {
            background-color: var(--primary-color);
            color: var(--light-text-color);
        }

        button.primary:hover,
        .button.primary:hover {
            background-color: var(--secondary-color);
        }

        input,
        select,
        textarea {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            margin-bottom: 10px;
            width: 100%;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 0;
        }

        /* Semantic Structure Styling */
        #app-header {
            background-color: var(--light-text-color);
            padding: 15px 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        #app-header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #app-header .logo {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--primary-color);
        }

        #app-header nav ul {
            list-style: none;
            display: flex;
        }

        #app-header nav ul li {
            margin-left: 20px;
        }

        #app-header nav ul li a {
            font-weight: 500;
        }

        #app-main>section {
            /* SPA Page Sections */
            display: none;
            /* Initially hide all pages */
            padding: 20px 0;
            animation: fadeIn 0.5s ease-in-out;
        }

        #app-main>section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #app-footer {
            background-color: #333;
            color: var(--light-text-color);
            padding: 30px 0;
            text-align: center;
            margin-top: auto;
        }

        #app-footer a {
            color: var(--secondary-color);
        }

        #app-footer a:hover {
            color: var(--light-text-color);
        }

        /* Card Component Style */
        .card {
            background-color: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }

        .card figure {
            margin: 0;
        }

        .card figure img {
            width: 100%;
            height: 200px;
            /* Fixed height for consistency */
            object-fit: cover;
        }

        .card figcaption,
        .card .card-content {
            padding: 15px;
        }

        .card h3 {
            margin-top: 0;
            color: var(--primary-color);
        }

        .card blockquote {
            font-style: italic;
            color: #555;
            border-left: 3px solid var(--secondary-color);
            padding-left: 10px;
            margin: 10px 0;
        }

        .card details summary {
            cursor: pointer;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .card details p {
            padding-left: 15px;
        }

        .card .price {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--accent-color);
            margin: 10px 0;
        }

        .card .location {
            font-size: 0.9em;
            color: #777;
            margin-bottom: 10px;
        }

        /* Grid Layout for Cards */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .filter-section {
            background-color: var(--card-background);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .filter-section h3 {
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .filter-group {
            margin-bottom: 15px;
        }

        .filter-group label {
            font-weight: normal;
        }

        .checkbox-group label {
            display: block;
            margin-bottom: 5px;
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: 8px;
            width: auto;
        }

        /* Detail Page Specifics */
        #page-apartment-detail .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        #page-apartment-detail .gallery img {
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        #page-apartment-detail .gallery img:hover {
            transform: scale(1.05);
        }

        #page-apartment-detail .main-image-container {
            margin-bottom: 20px;
            text-align: center;
        }

        #page-apartment-detail .main-image-container img {
            max-height: 500px;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        #page-apartment-detail .virtual-tour-placeholder {
            background-color: #eee;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            margin: 20px 0;
            font-style: italic;
            color: #777;
        }

        #page-apartment-detail .map-placeholder {
            height: 300px;
            background-color: #e0f2f1;
            /* Light teal, map-like */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            margin-bottom: 20px;
            font-style: italic;
        }

        #page-apartment-detail .booking-widget {
            background-color: var(--card-background);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        #page-apartment-detail .owner-info {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f5e9;
            /* Light green */
            border-radius: 5px;
        }

        #page-apartment-detail .owner-info .verified-badge {
            color: var(--primary-color);
            font-weight: bold;
        }

        #page-apartment-detail .reviews-section .review-item {
            border-bottom: 1px solid var(--border-color);
            padding: 15px 0;
        }

        #page-apartment-detail .reviews-section .review-item:last-child {
            border-bottom: none;
        }

        .stars {
            color: var(--accent-color);
        }


        /* Profile Page */
        #page-profile .profile-tabs button {
            background-color: #eee;
            color: var(--text-color);
            margin-right: 5px;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }

        #page-profile .profile-tabs button.active {
            background-color: var(--primary-color);
            color: var(--light-text-color);
        }

        #page-profile .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 5px 5px;
            background-color: var(--card-background);
        }

        #page-profile .tab-content.active {
            display: block;
        }

        /* Modal (untuk Login/Register atau notifikasi) */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-background);
            margin: auto;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }

        .modal-close:hover {
            color: var(--text-color);
        }


        /* Responsiveness */
        @media (max-width: 768px) {
            #app-header .container {
                flex-direction: column;
            }

            #app-header nav ul {
                margin-top: 10px;
                flex-wrap: wrap;
                justify-content: center;
            }

            #app-header nav ul li {
                margin: 5px 10px;
            }

            .grid-container {
                grid-template-columns: 1fr;
                /* Stack cards on smaller screens */
            }

            #page-search-results .container {
                flex-direction: column;
            }

            #page-search-results aside {
                width: 100%;
                margin-bottom: 20px;
            }

            #page-apartment-detail .content-layout {
                flex-direction: column;
            }

            #page-apartment-detail .main-content,
            #page-apartment-detail .sidebar-content {
                width: 100%;
            }
        }

        /* Utility classes */
        .text-center {
            text-align: center;
        }

        .mb-1 {
            margin-bottom: 0.5rem;
        }

        .mb-2 {
            margin-bottom: 1rem;
        }

        .mb-3 {
            margin-bottom: 1.5rem;
        }

        .mt-1 {
            margin-top: 0.5rem;
        }

        .mt-2 {
            margin-top: 1rem;
        }

        .mt-3 {
            margin-top: 1.5rem;
        }

        .d-flex {
            display: flex;
        }

        .justify-between {
            justify-content: space-between;
        }

        .align-center {
            align-items: center;
        }
    </style>
</head>

<body>

    <header id="app-header">
        <div class="container">
            <a href="#home" class="logo" data-page="page-home">GreenValley</a>
            <nav>
                <ul>
                    <li><a href="#home" data-page="page-home">Beranda</a></li>
                    <li><a href="#search" data-page="page-search-results">Cari Apartemen</a></li>
                    <li><a href="#profile" data-page="page-profile" id="nav-profile-link" style="display:none;">Profil
                            Saya</a></li>
                    <li><a href="#login" id="nav-login-link" data-modal="loginModal">Login</a></li>
                    <li><a href="#" id="nav-logout-link" style="display:none;">Logout</a></li>
                    <li><a href="#help" data-page="page-help">Bantuan</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main id="app-main">
        <!-- Homepage Section -->
        <section id="page-home">
            <div class="container">
                <header class="hero-section text-center mb-3">
                    <h1>Temukan Apartemen Impian Anda di Green Valley</h1>
                    <p>Sewa apartemen mudah, aman, dan nyaman.</p>
                    <form id="home-search-form" class="filter-section" style="max-width: 800px; margin: 20px auto;">
                        <h3>Cari Cepat</h3>
                        <div class="form-group">
                            <label for="home-lokasi">Lokasi</label>
                            <input type="text" id="home-lokasi" name="lokasi"
                                placeholder="cth: Jakarta Pusat, Sudirman">
                        </div>
                        <div class="d-flex" style="gap: 10px;">
                            <div class="form-group" style="flex:1;">
                                <label for="home-checkin">Tanggal Check-in</label>
                                <input type="date" id="home-checkin" name="checkin">
                            </div>
                            <div class="form-group" style="flex:1;">
                                <label for="home-checkout">Tanggal Check-out</label>
                                <input type="date" id="home-checkout" name="checkout">
                            </div>
                        </div>
                        <button type="submit" class="primary">Cari Apartemen</button>
                    </form>
                </header>

                <section class="featured-apartments mb-3">
                    <h2>Apartemen Unggulan</h2>
                    <div class="grid-container" id="featured-apartments-grid">
                        <!-- Apartment cards will be injected here by JavaScript -->
                    </div>
                </section>

                <section class="testimonials mb-3">
                    <h2>Apa Kata Mereka?</h2>
                    <div class="grid-container">
                        <article class="card">
                            <div class="card-content">
                                <blockquote>
                                    "Pelayanannya luar biasa! Apartemennya bersih dan sesuai dengan foto. Pasti akan
                                    sewa lagi di Green Valley."
                                </blockquote>
                                <figcaption>- Budi S., Penyewa</figcaption>
                            </div>
                        </article>
                        <article class="card">
                            <div class="card-content">
                                <blockquote>
                                    "Proses booking sangat mudah dan cepat. Tim support juga responsif. Recommended!"
                                </blockquote>
                                <figcaption>- Citra L., Penyewa</figcaption>
                            </div>
                        </article>
                    </div>
                </section>

                <section class="cta-section text-center">
                    <h2>Siap Menemukan Tempat Tinggal Ideal Anda?</h2>
                    <p>Jelajahi ribuan pilihan apartemen berkualitas sekarang juga.</p>
                    <button class="primary button" data-page="page-search-results">Mulai Pencarian</button>
                </section>
            </div>
        </section>

        <!-- Search Results Page Section -->
        <section id="page-search-results">
            <div class="container" style="display: flex; gap: 20px;">
                <aside style="flex: 1; max-width: 300px;">
                    <form id="search-filter-form" class="filter-section">
                        <h3>Filter Pencarian</h3>
                        <div class="form-group">
                            <label for="search-lokasi">Lokasi</label>
                            <input type="text" id="search-lokasi" name="lokasi" placeholder="Kota, area, atau landmark">
                            <button type="button"
                                style="width:100%; margin-top:5px; background-color: var(--secondary-color); color: white;">Gunakan
                                Peta Interaktif</button>
                            <small>Pencarian radius & landmark (simulasi)</small>
                        </div>
                        <div class="form-group">
                            <label for="search-checkin">Tanggal Check-in</label>
                            <input type="date" id="search-checkin" name="checkin">
                        </div>
                        <div class="form-group">
                            <label for="search-checkout">Tanggal Check-out</label>
                            <input type="date" id="search-checkout" name="checkout">
                            <small>Ketersediaan real-time (simulasi)</small>
                        </div>
                        <div class="form-group">
                            <label for="search-harga-min">Rentang Harga (per malam)</label>
                            <div class="d-flex" style="gap:5px">
                                <input type="number" id="search-harga-min" name="harga_min" placeholder="Min"
                                    style="flex:1">
                                <input type="number" id="search-harga-max" name="harga_max" placeholder="Max"
                                    style="flex:1">
                            </div>
                        </div>
                        <details open class="filter-group">
                            <summary>Fasilitas</summary>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="fasilitas" value="kolam"> Kolam Renang</label>
                                <label><input type="checkbox" name="fasilitas" value="gym"> Gym</label>
                                <label><input type="checkbox" name="fasilitas" value="parkir"> Parkir</label>
                                <label><input type="checkbox" name="fasilitas" value="wifi"> WiFi</label>
                                <label><input type="checkbox" name="fasilitas" value="ac"> AC</label>
                                <label><input type="checkbox" name="fasilitas" value="laundry"> Laundry</label>
                            </div>
                        </details>
                        <details open class="filter-group">
                            <summary>Tipe Apartemen</summary>
                            <select id="search-tipe" name="tipe_apartemen">
                                <option value="">Semua Tipe</option>
                                <option value="studio">Studio</option>
                                <option value="1br">1 Kamar Tidur</option>
                                <option value="2br">2 Kamar Tidur</option>
                                <option value="3br">3+ Kamar Tidur</option>
                                <option value="penthouse">Penthouse</option>
                                <option value="family">Apartemen Keluarga</option>
                            </select>
                        </details>
                        <button type="submit" class="primary">Terapkan Filter</button>
                    </form>
                </aside>
                <section style="flex: 3;">
                    <div class="d-flex justify-between align-center mb-2">
                        <h2 id="search-results-heading">Hasil Pencarian (3 apartemen ditemukan)</h2>
                        <select id="sort-by">
                            <option value="relevance">Relevansi</option>
                            <option value="price_asc">Harga Terendah</option>
                            <option value="price_desc">Harga Tertinggi</option>
                            <option value="rating_desc">Rating Tertinggi</option>
                        </select>
                    </div>
                    <div class="map-placeholder mb-2">Peta Interaktif Hasil Pencarian (Placeholder)</div>
                    <div class="grid-container" id="search-results-grid">
                        <!-- Search result cards will be injected here by JavaScript -->
                    </div>
                    <nav aria-label="Page navigation" class="mt-3 text-center">
                        <ul class="pagination" style="list-style:none; display:inline-flex; gap:5px;">
                            <!-- Pagination links -->
                            <li class="page-item"><a class="page-link button" href="#">Previous</a></li>
                            <li class="page-item"><a class="page-link button" href="#">1</a></li>
                            <li class="page-item active"><a class="page-link button primary" href="#">2</a></li>
                            <li class="page-item"><a class="page-link button" href="#">3</a></li>
                            <li class="page-item"><a class="page-link button" href="#">Next</a></li>
                        </ul>
                    </nav>
                </section>
            </div>
        </section>

        <!-- Apartment Detail Page Section -->
        <section id="page-apartment-detail">
            <div class="container">
                <header class="mb-2">
                    <h1 id="detail-title">Nama Apartemen Mewah di Pusat Kota</h1>
                    <p class="location" id="detail-location"><i class="fas fa-map-marker-alt"></i> Jl. Sudirman No. 1,
                        Jakarta Pusat</p>
                </header>

                <div class="main-image-container">
                    <img id="detail-main-image"
                        src="https://source.unsplash.com/random/1000x600/?luxury,apartment,interior"
                        alt="Foto Utama Apartemen">
                </div>
                <div class="gallery" id="detail-gallery">
                    <!-- Gallery images will be injected -->
                </div>

                <div class="virtual-tour-placeholder">
                    <p>Integrasi Video Virtual Tour 360° (Placeholder)</p>
                    <button>Mulai Virtual Tour</button>
                </div>

                <div class="d-flex" style="gap: 20px; flex-wrap:wrap;" id="detail-content-layout">
                    <article class="main-content" style="flex:2;">
                        <h2 class="mb-1">Deskripsi Apartemen</h2>
                        <p id="detail-description">Apartemen studio modern dan elegan ini terletak strategis di jantung
                            kota. Menawarkan pemandangan kota yang menakjubkan dan akses mudah ke pusat perbelanjaan,
                            restoran, dan transportasi umum. Dilengkapi dengan fasilitas lengkap untuk kenyamanan Anda.
                        </p>

                        <h3 class="mt-2 mb-1">Fasilitas Unggulan</h3>
                        <ul id="detail-facilities" style="list-style: disc; padding-left: 20px; columns: 2;">
                            <li>Kolam Renang Infinity</li>
                            <li>Gym Modern</li>
                            <li>Parkir Basement Aman</li>
                            <li>WiFi Kecepatan Tinggi</li>
                            <li>AC Sentral</li>
                            <li>Mesin Cuci & Pengering</li>
                            <li>Dapur Lengkap</li>
                            <li>Smart TV</li>
                        </ul>

                        <h3 class="mt-2 mb-1">Kebijakan Sewa</h3>
                        <details class="mb-1">
                            <summary>Aturan Rumah</summary>
                            <p id="detail-rules">Dilarang merokok di dalam unit. Dilarang membawa hewan peliharaan.
                                Harap menjaga ketenangan setelah pukul 10 malam.</p>
                        </details>
                        <details class="mb-1">
                            <summary>Pembatalan</summary>
                            <p id="detail-cancellation">Pembatalan gratis hingga 7 hari sebelum check-in. Pengembalian
                                dana 50% untuk pembatalan antara 3-7 hari sebelum check-in. Tidak ada pengembalian dana
                                jika dibatalkan kurang dari 3 hari sebelum check-in.</p>
                        </details>

                        <div class="map-placeholder mt-2">
                            Peta Lokasi Interaktif (Integrasi Google Maps Placeholder)
                        </div>
                    </article>

                    <aside class="sidebar-content" style="flex:1; min-width: 280px;">
                        <div class="booking-widget">
                            <h3 id="detail-price" class="price">Rp 1.500.000 / malam</h3>
                            <form id="booking-form">
                                <div class="form-group">
                                    <label for="book-checkin">Check-in</label>
                                    <input type="date" id="book-checkin" required>
                                </div>
                                <div class="form-group">
                                    <label for="book-checkout">Check-out</label>
                                    <input type="date" id="book-checkout" required>
                                </div>
                                <div class="form-group">
                                    <label for="book-guests">Jumlah Tamu</label>
                                    <select id="book-guests" required>
                                        <option value="1">1 Tamu</option>
                                        <option value="2" selected>2 Tamu</option>
                                        <option value="3">3 Tamu</option>
                                        <option value="4">4 Tamu</option>
                                    </select>
                                </div>
                                <div class="price-breakdown mb-2" id="booking-price-details" style="display:none;">
                                    <h4>Rincian Biaya:</h4>
                                    <p>Rp 1.500.000 x <span id="booking-nights">0</span> malam: Rp <span
                                            id="booking-subtotal">0</span></p>
                                    <p>Biaya Layanan: Rp <span id="booking-service-fee">150.000</span></p>
                                    <p>Pajak: Rp <span id="booking-tax">0</span></p>
                                    <p><strong>Total: Rp <span id="booking-total">0</span></strong></p>
                                    <small>Sistem Escrow: Dana ditahan hingga Anda check-in.</small>
                                </div>
                                <div class="form-group">
                                    <label><input type="checkbox" id="book-insurance"> Tambah Asuransi Perjalanan (Rp
                                        50.000)</label>
                                </div>
                                <button type="submit" class="primary button" style="width:100%;">Pesan Sekarang</button>
                            </form>
                        </div>
                        <div class="owner-info mt-2">
                            <h4>Pemilik: <span id="detail-owner-name">Andi Wijaya</span></h4>
                            <p><span class="verified-badge">✓ Identitas Terverifikasi</span></p>
                            <button class="button"
                                style="width:100%; margin-top:10px; background-color:var(--secondary-color); color:white;">Hubungi
                                Pemilik</button>
                        </div>
                    </aside>
                </div>

                <section class="reviews-section mt-3">
                    <h2>Ulasan Pengguna (<span id="detail-review-count">25</span> Ulasan) <span class="stars"
                            id="detail-avg-rating">★★★★☆ (4.5)</span></h2>
                    <div id="detail-reviews-list">
                        <!-- Review items will be injected -->
                    </div>
                    <form id="add-review-form" style="display:none;" class="mt-2 filter-section">
                        <h4>Tulis Ulasan Anda</h4>
                        <div class="form-group">
                            <label for="review-rating">Rating Anda:</label>
                            <select id="review-rating">
                                <option value="5">★★★★★ (Sangat Baik)</option>
                                <option value="4">★★★★☆ (Baik)</option>
                                <option value="3">★★★☆☆ (Cukup)</option>
                                <option value="2">★★☆☆☆ (Kurang)</option>
                                <option value="1">★☆☆☆☆ (Buruk)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="review-text">Ulasan Anda:</label>
                            <textarea id="review-text" rows="4" placeholder="Bagikan pengalaman Anda..."></textarea>
                        </div>
                        <button type="submit" class="primary">Kirim Ulasan</button>
                    </form>
                    <button id="report-problem-btn" class="button mt-2"
                        style="background-color: #f44336; color:white;">Laporkan Masalah</button>
                </section>
            </div>
        </section>

        <!-- Booking Confirmation/Payment Page Section -->
        <section id="page-booking-confirmation">
            <div class="container">
                <h1 class="text-center">Konfirmasi & Pembayaran</h1>
                <div class="card">
                    <div class="card-content">
                        <h3>Ringkasan Pesanan Anda</h3>
                        <p><strong>Apartemen:</strong> <span id="confirm-apt-name">Nama Apartemen Mewah</span></p>
                        <p><strong>Tanggal:</strong> <span id="confirm-dates">10 Agt 2024 - 12 Agt 2024</span> (<span
                                id="confirm-nights">2</span> malam)</p>
                        <p><strong>Tamu:</strong> <span id="confirm-guests">2</span></p>
                        <hr class="my-2">
                        <h4>Rincian Biaya (Transparan):</h4>
                        <p>Harga Sewa (<span id="confirm-price-per-night">Rp 1.500.000</span> x <span
                                id="confirm-num-nights">2</span> malam): Rp <span id="confirm-subtotal">3.000.000</span>
                        </p>
                        <p>Biaya Layanan Platform: Rp <span id="confirm-service-fee">150.000</span></p>
                        <p>Asuransi (opsional): Rp <span id="confirm-insurance-fee">50.000</span></p>
                        <p>Pajak (10%): Rp <span id="confirm-tax">320.000</span></p>
                        <p><strong>Total Pembayaran: Rp <span id="confirm-total-payment"
                                    style="font-size:1.2em; color:var(--primary-color);">3.520.000</span></strong></p>
                        <p><small>Pembayaran Anda aman dengan sistem Escrow kami.</small></p>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-content">
                        <h3>Pilih Metode Pembayaran</h3>
                        <form id="payment-form">
                            <div class="form-group">
                                <label><input type="radio" name="payment_method" value="cc" checked> Kartu
                                    Kredit/Debit</label>
                                <div id="cc-details">
                                    <input type="text" placeholder="Nomor Kartu" required>
                                    <div class="d-flex" style="gap:10px;">
                                        <input type="text" placeholder="MM/YY" style="flex:1" required>
                                        <input type="text" placeholder="CVC" style="flex:1" required>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label><input type="radio" name="payment_method" value="bank_transfer"> Transfer
                                    Bank</label>
                                <p id="bank-transfer-info" style="display:none;">Silakan transfer ke: BCA 123-456-7890
                                    a.n. Green Valley Escrow. Unggah bukti transfer.</p>
                            </div>
                            <div class="form-group">
                                <label><input type="radio" name="payment_method" value="ewallet"> E-Wallet (GoPay, OVO,
                                    Dana)</label>
                                <p id="ewallet-info" style="display:none;">Anda akan diarahkan ke aplikasi E-Wallet
                                    Anda.</p>
                            </div>
                            <button type="submit" class="primary button" style="width:100%;">Bayar Sekarang</button>
                        </form>
                    </div>
                </div>
                <p class="text-center mt-2"><small>Setelah pembayaran berhasil, konfirmasi otomatis akan dikirim via
                        Email dan SMS.</small></p>
            </div>
        </section>


        <!-- User Profile Page Section -->
        <section id="page-profile">
            <div class="container">
                <h1>Profil Saya</h1>
                <div class="profile-tabs mb-2">
                    <button class="profile-tab-button active" data-tab="tab-info">Informasi Akun</button>
                    <button class="profile-tab-button" data-tab="tab-bookings">Riwayat Booking</button>
                    <button class="profile-tab-button" data-tab="tab-messages">Pesan</button>
                    <button class="profile-tab-button" data-tab="tab-settings">Pengaturan</button>
                </div>

                <div id="tab-info" class="tab-content active">
                    <h3>Informasi Pribadi</h3>
                    <form id="profile-info-form">
                        <div class="form-group">
                            <label for="profile-name">Nama Lengkap</label>
                            <input type="text" id="profile-name" value="Pengguna Terdaftar" readonly>
                        </div>
                        <div class="form-group">
                            <label for="profile-email">Email</label>
                            <input type="email" id="profile-email" value="pengguna@example.com" readonly>
                        </div>
                        <div class="form-group">
                            <label for="profile-phone">Nomor Telepon</label>
                            <input type="tel" id="profile-phone" value="081234567890">
                        </div>
                        <button type="submit">Simpan Perubahan</button>
                    </form>
                    <p class="mt-2">Poin Loyalitas Anda: <strong id="loyalty-points">1500 Poin</strong></p>
                </div>

                <div id="tab-bookings" class="tab-content">
                    <h3>Riwayat Booking Anda</h3>
                    <div id="booking-history-list">
                        <article class="card">
                            <div class="card-content">
                                <h4>Apartemen Serene Heights - #BOOK12345</h4>
                                <p>Tanggal: 1 Agt 2024 - 5 Agt 2024</p>
                                <p>Status: <span style="color:green; font-weight:bold;">Selesai</span></p>
                                <p>Total: Rp 2.500.000</p>
                                <details>
                                    <summary>Lihat Detail</summary>
                                    <p>Akses ke detail booking, ulasan, dll.</p>
                                </details>
                                <button data-booking-id="12345" class="button primary mt-1">Tulis Ulasan</button>
                            </div>
                        </article>
                        <article class="card">
                            <div class="card-content">
                                <h4>Apartemen Urban Oasis - #BOOK67890</h4>
                                <p>Tanggal: 15 Sep 2024 - 18 Sep 2024</p>
                                <p>Status: <span style="color:orange; font-weight:bold;">Akan Datang</span></p>
                                <p>Total: Rp 1.800.000</p>
                                <details>
                                    <summary>Lihat Detail</summary>
                                    <p>Akses ke detail booking, opsi kelola (hubungi host, batalkan jika memungkinkan).
                                    </p>
                                </details>
                                <button data-booking-id="67890" class="button mt-1">Kelola Booking</button>
                            </div>
                        </article>
                    </div>
                </div>

                <div id="tab-messages" class="tab-content">
                    <h3>Pesan Internal</h3>
                    <div class="message-list">
                        <p><em>Tidak ada pesan baru.</em></p>
                        <!-- Contoh pesan -->
                        <div class="message-item card mt-1">
                            <div class="card-content">
                                <strong>Dari: Andi Wijaya (Pemilik Apartemen Mewah)</strong>
                                <p>Halo, terima kasih atas booking Anda! Apakah ada yang bisa saya bantu sebelum
                                    kedatangan Anda?</p>
                                <small>10 Agustus 2024, 10:00</small>
                                <button class="button primary mt-1">Balas</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="tab-settings" class="tab-content">
                    <h3>Pengaturan Akun</h3>
                    <form id="profile-settings-form">
                        <div class="form-group">
                            <label for="profile-password">Ubah Kata Sandi</label>
                            <input type="password" id="profile-password" placeholder="Kata Sandi Baru">
                            <input type="password" id="profile-confirm-password"
                                placeholder="Konfirmasi Kata Sandi Baru" class="mt-1">
                        </div>
                        <div class="form-group">
                            <h4>Preferensi Notifikasi</h4>
                            <label><input type="checkbox" checked> Email untuk konfirmasi booking</label>
                            <label><input type="checkbox" checked> SMS untuk pengingat check-in/out</label>
                            <label><input type="checkbox"> Email untuk promo & berita</label>
                        </div>
                        <button type="submit">Simpan Pengaturan</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Help/Customer Support Page Section -->
        <section id="page-help">
            <div class="container">
                <h1>Pusat Bantuan Green Valley</h1>
                <p>Kami siap membantu Anda 24/7. Silakan pilih opsi di bawah ini:</p>

                <div class="grid-container mt-3">
                    <article class="card">
                        <div class="card-content text-center">
                            <h3>FAQ (Pertanyaan Umum)</h3>
                            <p>Temukan jawaban cepat untuk pertanyaan umum.</p>
                            <button class="button primary mt-1">Lihat FAQ</button>
                        </div>
                    </article>
                    <article class="card">
                        <div class="card-content text-center">
                            <h3>Hubungi Kami via Email</h3>
                            <p>Kirim pertanyaan Anda ke support@greenvalley.com</p>
                            <a href="mailto:support@greenvalley.com" class="button primary mt-1">Kirim Email</a>
                        </div>
                    </article>
                    <article class="card">
                        <div class="card-content text-center">
                            <h3>Telepon Kami</h3>
                            <p>Hubungi +62 21 1234 5678 untuk bantuan langsung.</p>
                            <a href="tel:+622112345678" class="button primary mt-1">Telepon Sekarang</a>
                        </div>
                    </article>
                    <article class="card">
                        <div class="card-content text-center">
                            <h3>Live Chat</h3>
                            <p>Chat langsung dengan tim support kami (simulasi).</p>
                            <button class="button primary mt-1" id="start-live-chat">Mulai Live Chat</button>
                        </div>
                    </article>
                </div>
            </div>
        </section>

    </main>

    <footer id="app-footer">
        <div class="container">
            <p>© <span id="current-year"></span> Green Valley Apartments. All rights reserved.</p>
            <nav>
                <a href="#about" data-page="page-about">Tentang Kami</a> |
                <a href="#terms" data-page="page-terms">Syarat & Ketentuan</a> |
                <a href="#privacy" data-page="page-privacy">Kebijakan Privasi</a>
            </nav>
        </div>
    </footer>

    <!-- Modals -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" data-modal="loginModal">×</span>
            <h2>Login ke Green Valley</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="primary" style="width:100%;">Login</button>
                <p class="mt-2 text-center">Belum punya akun? <a href="#register" data-modal="registerModal"
                        class="switch-modal">Daftar di sini</a></p>
            </form>
        </div>
    </div>

    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" data-modal="registerModal">×</span>
            <h2>Daftar Akun Baru</h2>
            <form id="register-form">
                <div class="form-group">
                    <label for="register-name">Nama Lengkap</label>
                    <input type="text" id="register-name" required>
                </div>
                <div class="form-group">
                    <label for="register-email">Email</label>
                    <input type="email" id="register-email" required>
                </div>
                <div class="form-group">
                    <label for="register-password">Password</label>
                    <input type="password" id="register-password" required>
                </div>
                <div class="form-group">
                    <label for="register-confirm-password">Konfirmasi Password</label>
                    <input type="password" id="register-confirm-password" required>
                </div>
                <button type="submit" class="primary" style="width:100%;">Daftar</button>
                <p class="mt-2 text-center">Sudah punya akun? <a href="#login" data-modal="loginModal"
                        class="switch-modal">Login di sini</a></p>
            </form>
        </div>
    </div>


    <script>
        // Mock Data
        const mockApartments = [
            {
                id: 1,
                name: "Apartemen Sky Garden Deluxe",
                location: "Jakarta Pusat",
                price: 1200000,
                rating: 4.8,
                type: "2br",
                facilities: ["kolam", "gym", "wifi", "ac", "parkir"],
                images: [
                    "https://source.unsplash.com/random/800x600/?apartment,interior,modern",
                    "https://source.unsplash.com/random/400x300/?apartment,bedroom",
                    "https://source.unsplash.com/random/400x300/?apartment,livingroom",
                    "https://source.unsplash.com/random/400x300/?apartment,kitchen",
                    "https://source.unsplash.com/random/400x300/?apartment,bathroom",
                    "https://source.unsplash.com/random/400x300/?apartment,pool"
                ],
                description: "Apartemen mewah dengan 2 kamar tidur di pusat kota, menawarkan pemandangan spektakuler dan fasilitas lengkap. Cocok untuk keluarga atau pebisnis.",
                owner: "Citra Dewi",
                reviews: [
                    { user: "Bambang P.", rating: 5, comment: "Sangat memuaskan, bersih dan nyaman!" },
                    { user: "Ayu Lestari", rating: 4, comment: "Lokasi strategis, fasilitas oke." }
                ]
            },
            {
                id: 2,
                name: "Studio Minimalis Urban",
                location: "Bandung Kota",
                price: 750000,
                rating: 4.5,
                type: "studio",
                facilities: ["wifi", "ac", "laundry"],
                images: [
                    "https://source.unsplash.com/random/800x600/?studio,apartment,cozy",
                    "https://source.unsplash.com/random/400x300/?studio,bed",
                    "https://source.unsplash.com/random/400x300/?studio,desk"
                ],
                description: "Studio kompak dan modern, ideal untuk solo traveler atau pasangan. Dekat dengan kafe dan area kreatif di Bandung.",
                owner: "Rizky Pratama",
                reviews: [
                    { user: "Kevin Sanjaya", rating: 4, comment: "Tempatnya cozy, internet cepat." }
                ]
            },
            {
                id: 3,
                name: "Penthouse The Peak View",
                location: "Surabaya Barat",
                price: 3500000,
                rating: 5.0,
                type: "penthouse",
                facilities: ["kolam", "gym", "wifi", "ac", "parkir", "laundry", "jacuzzi"],
                images: [
                    "https://source.unsplash.com/random/800x600/?penthouse,luxury,view",
                    "https://source.unsplash.com/random/400x300/?penthouse,masterbedroom",
                    "https://source.unsplash.com/random/400x300/?penthouse,balcony"
                ],
                description: "Penthouse eksklusif dengan pemandangan kota 360 derajat. Dilengkapi fasilitas pribadi dan layanan premium.",
                owner: " Keluarga Hartono",
                reviews: [
                    { user: "Jessica M.", rating: 5, comment: "Pengalaman menginap terbaik! Pemandangan luar biasa." }
                ]
            },
            {
                id: 4,
                name: "Apartemen Keluarga Ceria",
                location: "Jakarta Selatan",
                price: 1800000,
                rating: 4.6,
                type: "3br",
                facilities: ["kolam", "playground", "wifi", "ac", "parkir"],
                images: [
                    "https://source.unsplash.com/random/800x600/?family,apartment,spacious",
                    "https://source.unsplash.com/random/400x300/?kids,room",
                    "https://source.unsplash.com/random/400x300/?living,room,family"
                ],
                description: "Apartemen 3 kamar tidur yang luas, cocok untuk liburan keluarga. Dekat dengan taman dan pusat hiburan anak.",
                owner: "Bapak Agus & Ibu Rina",
                reviews: []
            }
        ];

        let currentUser = null; // { name: "Pengguna Terdaftar", email: "pengguna@example.com" }

        // --- SPA Navigation Logic ---
        const pages = document.querySelectorAll('#app-main > section');
        const navLinks = document.querySelectorAll('#app-header nav a[data-page], .button[data-page]');
        const modals = document.querySelectorAll('.modal');
        const modalTriggers = document.querySelectorAll('[data-modal]');
        const modalCloseButtons = document.querySelectorAll('.modal-close');
        const switchModalLinks = document.querySelectorAll('.switch-modal');

        function showPage(pageId) {
            pages.forEach(page => {
                page.classList.remove('active');
                if (page.id === pageId) {
                    page.classList.add('active');
                    window.scrollTo(0, 0); // Scroll to top on page change
                }
            });
            // Update active state for nav links (optional visual feedback)
            navLinks.forEach(link => {
                link.classList.remove('active-nav-link'); // Define .active-nav-link in CSS if needed
                if (link.dataset.page === pageId) {
                    link.classList.add('active-nav-link');
                }
            });

            // Special handling for detail page based on hash
            if (pageId === 'page-apartment-detail' && window.location.hash.includes('/apartment/')) {
                const aptId = parseInt(window.location.hash.split('/apartment/')[1]);
                if (aptId) loadApartmentDetail(aptId);
            } else if (pageId === 'page-home') {
                renderFeaturedApartments();
            } else if (pageId === 'page-search-results') {
                renderSearchResults(mockApartments); // Show all initially
            } else if (pageId === 'page-profile') {
                if (!currentUser) {
                    showPage('page-home'); // Redirect to home if not logged in
                    openModal('loginModal');
                } else {
                    loadProfileData();
                }
            } else if (pageId === 'page-booking-confirmation') {
                if (!currentUser) {
                    showPage('page-home');
                    openModal('loginModal');
                } else {
                    // Needs data from previous step
                    // For now, just shows the page. Data should be passed or stored temporarily
                    console.log("Booking confirmation page loaded. Needs data.");
                }
            }
        }

        function handleNavigation(event) {
            event.preventDefault();
            const targetPageId = this.dataset.page;
            if (targetPageId) {
                history.pushState({ page: targetPageId }, targetPageId, `#${targetPageId}`);
                showPage(targetPageId);
            }
        }

        navLinks.forEach(link => link.addEventListener('click', handleNavigation));

        // Handle browser back/forward
        window.addEventListener('popstate', (event) => {
            if (event.state && event.state.page) {
                showPage(event.state.page);
            } else {
                // If no state, or hash is for detail, try to parse from hash
                const hash = window.location.hash.substring(1);
                if (hash.startsWith('page-apartment-detail/apartment/')) {
                    showPage('page-apartment-detail');
                } else if (hash && document.getElementById(hash)) {
                    showPage(hash);
                } else {
                    showPage('page-home'); // Default to home
                }
            }
        });

        // --- Modal Logic ---
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.classList.add('active');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.classList.remove('active');
        }

        modalTriggers.forEach(trigger => {
            trigger.addEventListener('click', (e) => {
                e.preventDefault();
                const modalId = trigger.dataset.modal;
                openModal(modalId);
            });
        });

        modalCloseButtons.forEach(button => {
            button.addEventListener('click', () => {
                const modalId = button.dataset.modal;
                closeModal(modalId);
            });
        });

        switchModalLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                // Close current modal
                const currentModal = e.target.closest('.modal');
                if (currentModal) closeModal(currentModal.id);
                // Open new modal
                const newModalId = e.target.dataset.modal;
                openModal(newModalId);
            });
        });

        // Close modal if clicked outside content
        modals.forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal(modal.id);
                }
            });
        });

        // --- "Component" Rendering Functions (SFC Simulation) ---
        function createApartmentCard(apartment) {
            const card = document.createElement('article');
            card.className = 'card apartment-card';
            card.dataset.id = apartment.id;
            card.innerHTML = `
                <figure>
                    <img src="${apartment.images[0]}" alt="Foto ${apartment.name}">
                </figure>
                <div class="card-content">
                    <h3>${apartment.name}</h3>
                    <p class="location">${apartment.location}</p>
                    <p class="price">Rp ${apartment.price.toLocaleString('id-ID')} / malam</p>
                    <div class="stars" title="Rating: ${apartment.rating}/5">
                        ${'★'.repeat(Math.round(apartment.rating))}${'☆'.repeat(5 - Math.round(apartment.rating))}
                        (${apartment.rating})
                    </div>
                    <details>
                        <summary>Deskripsi Singkat</summary>
                        <p>${apartment.description.substring(0, 100)}...</p>
                    </details>
                    <button class="button primary mt-1 view-details-btn" data-id="${apartment.id}">Lihat Detail</button>
                </div>
            `;
            card.querySelector('.view-details-btn').addEventListener('click', function () {
                const aptId = this.dataset.id;
                history.pushState({ page: 'page-apartment-detail', apartmentId: aptId }, `Apartment ${aptId}`, `#page-apartment-detail/apartment/${aptId}`);
                showPage('page-apartment-detail');
                // loadApartmentDetail(aptId) will be called by showPage's logic
            });
            return card;
        }

        function renderFeaturedApartments() {
            const grid = document.getElementById('featured-apartments-grid');
            if (!grid) return;
            grid.innerHTML = ''; // Clear existing
            mockApartments.slice(0, 3).forEach(apt => { // Show top 3
                grid.appendChild(createApartmentCard(apt));
            });
        }

        function renderSearchResults(apartmentsToRender) {
            const grid = document.getElementById('search-results-grid');
            const heading = document.getElementById('search-results-heading');
            if (!grid || !heading) return;

            grid.innerHTML = '';
            if (apartmentsToRender.length === 0) {
                grid.innerHTML = '<p>Tidak ada apartemen yang sesuai dengan kriteria Anda.</p>';
                heading.textContent = 'Hasil Pencarian (0 apartemen ditemukan)';
            } else {
                apartmentsToRender.forEach(apt => {
                    grid.appendChild(createApartmentCard(apt));
                });
                heading.textContent = `Hasil Pencarian (${apartmentsToRender.length} apartemen ditemukan)`;
            }
        }

        // --- Apartment Detail Page Logic ---
        function loadApartmentDetail(apartmentId) {
            const apt = mockApartments.find(a => a.id == apartmentId);
            if (!apt) {
                showPage('page-home'); // or a 404 page
                alert('Apartemen tidak ditemukan!');
                return;
            }

            document.getElementById('detail-title').textContent = apt.name;
            document.getElementById('detail-location').textContent = apt.location;
            document.getElementById('detail-main-image').src = apt.images[0];
            document.getElementById('detail-main-image').alt = `Foto utama ${apt.name}`;

            const gallery = document.getElementById('detail-gallery');
            gallery.innerHTML = '';
            apt.images.slice(1, 5).forEach(imgUrl => { // Show up to 4 more thumbnails
                const img = document.createElement('img');
                img.src = imgUrl;
                img.alt = `Galeri foto ${apt.name}`;
                img.addEventListener('click', () => {
                    document.getElementById('detail-main-image').src = imgUrl;
                });
                gallery.appendChild(img);
            });

            document.getElementById('detail-description').textContent = apt.description;

            const facilitiesList = document.getElementById('detail-facilities');
            facilitiesList.innerHTML = '';
            apt.facilities.forEach(facility => {
                const li = document.createElement('li');
                li.textContent = facility.charAt(0).toUpperCase() + facility.slice(1).replace('_', ' '); // Capitalize and format
                facilitiesList.appendChild(li);
            });

            document.getElementById('detail-price').textContent = `Rp ${apt.price.toLocaleString('id-ID')} / malam`;
            document.getElementById('detail-owner-name').textContent = apt.owner;

            const reviewsList = document.getElementById('detail-reviews-list');
            reviewsList.innerHTML = '';
            if (apt.reviews && apt.reviews.length > 0) {
                apt.reviews.forEach(review => {
                    const reviewDiv = document.createElement('article');
                    reviewDiv.className = 'review-item';
                    reviewDiv.innerHTML = `
                        <p><strong>${review.user}</strong> <span class="stars">${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}</span></p>
                        <blockquote>${review.comment}</blockquote>
                    `;
                    reviewsList.appendChild(reviewDiv);
                });
                const avgRating = apt.reviews.reduce((sum, r) => sum + r.rating, 0) / apt.reviews.length;
                document.getElementById('detail-avg-rating').innerHTML = `${'★'.repeat(Math.round(avgRating))}${'☆'.repeat(5 - Math.round(avgRating))} (${avgRating.toFixed(1)})`;

            } else {
                reviewsList.innerHTML = '<p>Belum ada ulasan untuk apartemen ini.</p>';
                document.getElementById('detail-avg-rating').innerHTML = '';
            }
            document.getElementById('detail-review-count').textContent = apt.reviews ? apt.reviews.length : 0;

            // Show add review form if user is logged in (and hasn't reviewed yet - more complex logic needed)
            document.getElementById('add-review-form').style.display = currentUser ? 'block' : 'none';

            // Booking form logic (update price details)
            const bookingForm = document.getElementById('booking-form');
            const bookCheckin = document.getElementById('book-checkin');
            const bookCheckout = document.getElementById('book-checkout');
            const bookingPriceDetails = document.getElementById('booking-price-details');

            function updateBookingPrice() {
                const checkinDate = new Date(bookCheckin.value);
                const checkoutDate = new Date(bookCheckout.value);

                if (bookCheckin.value && bookCheckout.value && checkoutDate > checkinDate) {
                    const nights = Math.ceil((checkoutDate - checkinDate) / (1000 * 60 * 60 * 24));
                    const subtotal = nights * apt.price;
                    const serviceFee = 150000; // Example fixed service fee
                    const tax = subtotal * 0.10; // Example 10% tax
                    const total = subtotal + serviceFee + tax;

                    document.getElementById('booking-nights').textContent = nights;
                    document.getElementById('booking-subtotal').textContent = subtotal.toLocaleString('id-ID');
                    document.getElementById('booking-service-fee').textContent = serviceFee.toLocaleString('id-ID');
                    document.getElementById('booking-tax').textContent = tax.toLocaleString('id-ID');
                    document.getElementById('booking-total').textContent = total.toLocaleString('id-ID');
                    bookingPriceDetails.style.display = 'block';
                } else {
                    bookingPriceDetails.style.display = 'none';
                }
            }
            bookCheckin.addEventListener('change', updateBookingPrice);
            bookCheckout.addEventListener('change', updateBookingPrice);

            bookingForm.onsubmit = function (e) {
                e.preventDefault();
                if (!currentUser) {
                    openModal('loginModal');
                    alert('Silakan login untuk melanjutkan pemesanan.');
                    return;
                }
                // Store booking details temporarily (in real app, send to server)
                const bookingData = {
                    apartmentId: apt.id,
                    apartmentName: apt.name,
                    checkin: bookCheckin.value,
                    checkout: bookCheckout.value,
                    guests: document.getElementById('book-guests').value,
                    pricePerNight: apt.price,
                    insurance: document.getElementById('book-insurance').checked,
                    // Recalculate total for confirmation
                    nights: Math.ceil((new Date(bookCheckout.value) - new Date(bookCheckin.value)) / (1000 * 60 * 60 * 24)),
                };
                localStorage.setItem('pendingBooking', JSON.stringify(bookingData));
                history.pushState({ page: 'page-booking-confirmation' }, 'Booking Confirmation', '#page-booking-confirmation');
                loadBookingConfirmationPage(); // Load data and show page
            };
        }

        // --- Booking Confirmation Page Logic ---
        function loadBookingConfirmationPage() {
            const bookingDataString = localStorage.getItem('pendingBooking');
            if (!bookingDataString) {
                alert('Data booking tidak ditemukan. Silakan ulangi proses.');
                showPage('page-search-results'); // Redirect
                return;
            }
            const bookingData = JSON.parse(bookingDataString);
            const subtotal = bookingData.nights * bookingData.pricePerNight;
            const serviceFee = 150000; // Example
            const insuranceFee = bookingData.insurance ? 50000 : 0;
            const tax = (subtotal + serviceFee + insuranceFee) * 0.10; // Tax on subtotal + service + insurance
            const totalPayment = subtotal + serviceFee + insuranceFee + tax;

            document.getElementById('confirm-apt-name').textContent = bookingData.apartmentName;
            document.getElementById('confirm-dates').textContent = `${new Date(bookingData.checkin).toLocaleDateString('id-ID')} - ${new Date(bookingData.checkout).toLocaleDateString('id-ID')}`;
            document.getElementById('confirm-nights').textContent = bookingData.nights;
            document.getElementById('confirm-guests').textContent = bookingData.guests;
            document.getElementById('confirm-price-per-night').textContent = `Rp ${bookingData.pricePerNight.toLocaleString('id-ID')}`;
            document.getElementById('confirm-num-nights').textContent = bookingData.nights;
            document.getElementById('confirm-subtotal').textContent = subtotal.toLocaleString('id-ID');
            document.getElementById('confirm-service-fee').textContent = serviceFee.toLocaleString('id-ID');
            document.getElementById('confirm-insurance-fee').textContent = insuranceFee.toLocaleString('id-ID');
            document.getElementById('confirm-tax').textContent = tax.toLocaleString('id-ID');
            document.getElementById('confirm-total-payment').textContent = `Rp ${totalPayment.toLocaleString('id-ID')}`;

            showPage('page-booking-confirmation'); // Make sure page is visible

            // Payment form logic (radio buttons to show/hide details)
            const paymentMethodRadios = document.querySelectorAll('input[name="payment_method"]');
            const ccDetails = document.getElementById('cc-details');
            const bankTransferInfo = document.getElementById('bank-transfer-info');
            const ewalletInfo = document.getElementById('ewallet-info');

            paymentMethodRadios.forEach(radio => {
                radio.addEventListener('change', function () {
                    ccDetails.style.display = this.value === 'cc' ? 'block' : 'none';
                    bankTransferInfo.style.display = this.value === 'bank_transfer' ? 'block' : 'none';
                    ewalletInfo.style.display = this.value === 'ewallet' ? 'block' : 'none';
                });
            });
            // Trigger change for default checked
            document.querySelector('input[name="payment_method"]:checked').dispatchEvent(new Event('change'));

            document.getElementById('payment-form').onsubmit = function (e) {
                e.preventDefault();
                alert('Pembayaran Berhasil (Simulasi)! Konfirmasi akan dikirim ke email & SMS Anda. Anda akan diarahkan ke Profil Saya.');
                localStorage.removeItem('pendingBooking'); // Clear pending booking
                // Add to booking history (mock)
                if (currentUser && currentUser.bookings) {
                    currentUser.bookings.push({
                        ...bookingData,
                        status: 'Akan Datang',
                        total: totalPayment,
                        bookingId: `BOOK${Math.floor(Math.random() * 90000) + 10000}`
                    });
                }
                history.pushState({ page: 'page-profile' }, 'Profil Saya', '#page-profile');
                showPage('page-profile');
            };
        }


        // --- Search & Filter Logic ---
        document.getElementById('home-search-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const location = document.getElementById('home-lokasi').value;
            // Pass params to search page or update search page filters and navigate
            document.getElementById('search-lokasi').value = location; // Populate search page filter
            document.getElementById('search-checkin').value = document.getElementById('home-checkin').value;
            document.getElementById('search-checkout').value = document.getElementById('home-checkout').value;

            history.pushState({ page: 'page-search-results' }, 'Search Results', '#page-search-results');
            showPage('page-search-results');
            applySearchFilters(); // Apply filters on search page
        });

        document.getElementById('search-filter-form').addEventListener('submit', function (e) {
            e.preventDefault();
            applySearchFilters();
        });

        function applySearchFilters() {
            const locationQuery = document.getElementById('search-lokasi').value.toLowerCase();
            const minPrice = parseFloat(document.getElementById('search-harga-min').value) || 0;
            const maxPrice = parseFloat(document.getElementById('search-harga-max').value) || Infinity;
            const selectedFacilities = Array.from(document.querySelectorAll('#search-filter-form input[name="fasilitas"]:checked')).map(cb => cb.value);
            const apartmentType = document.getElementById('search-tipe').value;
            // Date filtering is more complex (check availability), simplified here

            const filtered = mockApartments.filter(apt => {
                const matchesLocation = apt.location.toLowerCase().includes(locationQuery) || apt.name.toLowerCase().includes(locationQuery);
                const matchesPrice = apt.price >= minPrice && apt.price <= maxPrice;
                const matchesFacilities = selectedFacilities.length === 0 || selectedFacilities.every(facility => apt.facilities.includes(facility));
                const matchesType = !apartmentType || apt.type === apartmentType;
                return matchesLocation && matchesPrice && matchesFacilities && matchesType;
            });
            renderSearchResults(filtered);
        }

        document.getElementById('sort-by').addEventListener('change', function () {
            // Re-apply filters and then sort. For now, just re-render with current filters.
            // Sorting logic would be applied to the 'filtered' array before calling renderSearchResults.
            applySearchFilters();
        });


        // --- User Authentication (Mock) ---
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const navLoginLink = document.getElementById('nav-login-link');
        const navLogoutLink = document.getElementById('nav-logout-link');
        const navProfileLink = document.getElementById('nav-profile-link');

        function updateNavForUser() {
            if (currentUser) {
                navLoginLink.style.display = 'none';
                navLogoutLink.style.display = 'inline';
                navProfileLink.style.display = 'inline';
                navProfileLink.textContent = `Halo, ${currentUser.name.split(' ')[0]}`;
            } else {
                navLoginLink.style.display = 'inline';
                navLogoutLink.style.display = 'none';
                navProfileLink.style.display = 'none';
            }
        }

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            // Simple mock login
            currentUser = { name: "Pengguna Demo", email: email, phone: "08123456789", loyaltyPoints: 1500, bookings: [] };
            alert(`Login berhasil sebagai ${currentUser.name}!`);
            closeModal('loginModal');
            updateNavForUser();
            history.pushState({ page: 'page-profile' }, 'Profil Saya', '#page-profile');
            showPage('page-profile'); // Redirect to profile after login
        });

        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            // Simple mock registration
            currentUser = { name: name, email: email, phone: "", loyaltyPoints: 0, bookings: [] };
            alert(`Registrasi berhasil! Selamat datang, ${currentUser.name}!`);
            closeModal('registerModal');
            updateNavForUser();
            history.pushState({ page: 'page-profile' }, 'Profil Saya', '#page-profile');
            showPage('page-profile'); // Redirect to profile
        });

        navLogoutLink.addEventListener('click', (e) => {
            e.preventDefault();
            currentUser = null;
            alert('Anda telah logout.');
            updateNavForUser();
            history.pushState({ page: 'page-home' }, 'Beranda', '#page-home');
            showPage('page-home'); // Redirect to home
        });

        // --- Profile Page Logic ---
        const profileTabs = document.querySelectorAll('.profile-tab-button');
        const profileTabContents = document.querySelectorAll('.tab-content');

        profileTabs.forEach(tab => {
            tab.addEventListener('click', function () {
                profileTabs.forEach(t => t.classList.remove('active'));
                profileTabContents.forEach(c => c.classList.remove('active'));

                this.classList.add('active');
                document.getElementById(this.dataset.tab).classList.add('active');
            });
        });

        function loadProfileData() {
            if (currentUser) {
                document.getElementById('profile-name').value = currentUser.name;
                document.getElementById('profile-email').value = currentUser.email;
                document.getElementById('profile-phone').value = currentUser.phone || "";
                document.getElementById('loyalty-points').textContent = `${currentUser.loyaltyPoints || 0} Poin`;

                // Render booking history
                const bookingHistoryList = document.getElementById('booking-history-list');
                bookingHistoryList.innerHTML = '';
                if (currentUser.bookings && currentUser.bookings.length > 0) {
                    currentUser.bookings.forEach(booking => {
                        const bookingCard = document.createElement('article');
                        bookingCard.className = 'card';
                        bookingCard.innerHTML = `
                            <div class="card-content">
                                <h4>${booking.apartmentName} - #${booking.bookingId}</h4>
                                <p>Tanggal: ${new Date(booking.checkin).toLocaleDateString('id-ID')} - ${new Date(booking.checkout).toLocaleDateString('id-ID')}</p>
                                <p>Status: <span style="color:${booking.status === 'Selesai' ? 'green' : 'orange'}; font-weight:bold;">${booking.status}</span></p>
                                <p>Total: Rp ${booking.total.toLocaleString('id-ID')}</p>
                                <details>
                                    <summary>Lihat Detail</summary>
                                    <p>Akses ke detail booking, ulasan, dll.</p>
                                </details>
                                ${booking.status === 'Selesai' ? `<button data-booking-id="${booking.bookingId}" class="button primary mt-1">Tulis Ulasan</button>` : `<button data-booking-id="${booking.bookingId}" class="button mt-1">Kelola Booking</button>`}
                            </div>
                        `;
                        bookingHistoryList.appendChild(bookingCard);
                    });
                } else {
                    bookingHistoryList.innerHTML = '<p>Anda belum memiliki riwayat booking.</p>';
                }
            }
        }

        document.getElementById('profile-info-form').addEventListener('submit', function (e) {
            e.preventDefault();
            if (currentUser) {
                currentUser.name = document.getElementById('profile-name').value; // Assuming name can't be changed from here, or needs verification
                currentUser.phone = document.getElementById('profile-phone').value;
                alert('Informasi profil diperbarui!');
                loadProfileData(); // Re-render data
            }
        });

        // --- Initial Setup ---
        document.getElementById('current-year').textContent = new Date().getFullYear();

        // Determine initial page from URL hash or default to home
        const initialHash = window.location.hash.substring(1);
        if (initialHash.startsWith('page-apartment-detail/apartment/')) {
            history.replaceState({ page: 'page-apartment-detail' }, 'Apartment Detail', `#${initialHash}`);
            showPage('page-apartment-detail');
        } else if (initialHash && document.getElementById(initialHash)) {
            history.replaceState({ page: initialHash }, initialHash, `#${initialHash}`); // Set initial state
            showPage(initialHash);
        } else {
            history.replaceState({ page: 'page-home' }, 'Beranda', '#page-home'); // Set initial state
            showPage('page-home');
        }
        updateNavForUser(); // Check if user was "logged in" (e.g. from previous session via localStorage - not implemented here for simplicity)

        // Placeholder for live chat
        document.getElementById('start-live-chat')?.addEventListener('click', () => {
            alert('Fitur Live Chat sedang dalam pengembangan. Silakan hubungi kami via email atau telepon untuk saat ini.');
        });

    </script>
</body>

</html>