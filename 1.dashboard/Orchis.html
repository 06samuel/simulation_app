<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rentify - Manajemen Sewa Apartemen</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* ==== RESET CSS SEDERHANA & GLOBAL STYLES ==== */
    :root {
      --primary-color: #2563eb;
      --primary-light: #3b82f6;
      --primary-dark: #1e40af;
      --primary-foreground: #ffffff;

      --secondary-color: #64748b;
      --secondary-light: #94a3b8;
      --secondary-dark: #475569;
      --secondary-foreground: #ffffff;

      --accent-color: #f59e0b;
      /* Oranye/Kuning untuk aksen */
      --accent-light: #fbbf24;
      --accent-dark: #d97706;

      --success-color: #22c55e;
      --danger-color: #ef4444;
      --warning-color: #facc15;
      --info-color: #0ea5e9;

      --background-color: #f8fafc;
      /* Abu-abu sangat muda */
      --surface-color: #ffffff;
      /* Putih untuk kartu, modal, dll. */
      --border-color: #e2e8f0;
      --text-color: #0f172a;
      /* Hitam/Abu-abu tua untuk teks utama */
      --text-light-color: #64748b;
      /* Abu-abu untuk teks sekunder */

      --font-family-sans: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";

      --border-radius-sm: 0.25rem;
      --border-radius-md: 0.5rem;
      --border-radius-lg: 1rem;

      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);

      --spacing-1: 0.25rem;
      --spacing-2: 0.5rem;
      --spacing-3: 0.75rem;
      --spacing-4: 1rem;
      --spacing-5: 1.25rem;
      --spacing-6: 1.5rem;
      --spacing-8: 2rem;
      --spacing-10: 2.5rem;
      --spacing-12: 3rem;
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      font-size: 16px;
      /* Basis untuk unit rem */
      scroll-behavior: smooth;
    }

    body {
      font-family: var(--font-family-sans);
      background-color: var(--background-color);
      color: var(--text-color);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    img,
    picture,
    video,
    canvas,
    svg {
      display: block;
      max-width: 100%;
    }

    input,
    button,
    textarea,
    select {
      font: inherit;
    }

    button {
      cursor: pointer;
      border: none;
      background-color: transparent;
    }

    a {
      color: var(--primary-color);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    ul,
    ol {
      list-style: none;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: var(--spacing-2);
    }

    h1 {
      font-size: 2rem;
    }

    h2 {
      font-size: 1.75rem;
    }

    h3 {
      font-size: 1.5rem;
    }

    h4 {
      font-size: 1.25rem;
    }

    h5 {
      font-size: 1.1rem;
    }


    /* ==== UTILITIES ==== */
    .container {
      width: 90%;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
      padding-left: var(--spacing-4);
      padding-right: var(--spacing-4);
    }

    .text-center {
      text-align: center;
    }

    .text-primary {
      color: var(--primary-color);
    }

    .text-success {
      color: var(--success-color);
    }

    .text-danger {
      color: var(--danger-color);
    }

    .text-info {
      color: var(--info-color);
    }

    .text-muted {
      color: var(--text-light-color);
    }

    .d-flex {
      display: flex;
    }

    .align-items-center {
      align-items: center;
    }

    .justify-content-between {
      justify-content: space-between;
    }

    .justify-content-center {
      justify-content: center;
    }

    .justify-content-end {
      justify-content: flex-end;
    }

    .flex-wrap {
      flex-wrap: wrap;
    }

    .gap-1 {
      gap: var(--spacing-1);
    }

    .gap-2 {
      gap: var(--spacing-2);
    }

    .gap-3 {
      gap: var(--spacing-3);
    }

    .gap-4 {
      gap: var(--spacing-4);
    }

    .mt-1 {
      margin-top: var(--spacing-1);
    }

    .mt-2 {
      margin-top: var(--spacing-2);
    }

    .mt-3 {
      margin-top: var(--spacing-3);
    }

    .mt-4 {
      margin-top: var(--spacing-4);
    }

    .mt-6 {
      margin-top: var(--spacing-6);
    }

    .mt-8 {
      margin-top: var(--spacing-8);
    }

    .mb-1 {
      margin-bottom: var(--spacing-1);
    }

    .mb-2 {
      margin-bottom: var(--spacing-2);
    }

    .mb-3 {
      margin-bottom: var(--spacing-3);
    }

    .mb-4 {
      margin-bottom: var(--spacing-4);
    }

    .ms-auto {
      margin-left: auto;
    }

    .me-1 {
      margin-right: var(--spacing-1);
    }

    .me-2 {
      margin-right: var(--spacing-2);
    }

    .p-1 {
      padding: var(--spacing-1);
    }

    .p-2 {
      padding: var(--spacing-2);
    }

    .p-3 {
      padding: var(--spacing-3);
    }

    .p-4 {
      padding: var(--spacing-4);
    }

    .w-100 {
      width: 100%;
    }

    .rounded {
      border-radius: var(--border-radius-md);
    }

    .rounded-circle {
      border-radius: 50%;
    }

    .shadow-md {
      box-shadow: var(--shadow-md);
    }

    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* ==== COMPONENTS ==== */

    /* Navbar */
    .app-navbar {
      background: linear-gradient(90deg, var(--primary-dark), var(--primary-color));
      color: var(--primary-foreground);
      padding: var(--spacing-3) 0;
      box-shadow: var(--shadow-md);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .app-navbar .container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .navbar-brand {
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
      font-size: 1.25rem;
      font-weight: 700;
      letter-spacing: 0.03em;
      color: var(--primary-foreground);
    }

    .navbar-brand img {
      width: 36px;
      height: 36px;
      border: 2px solid var(--primary-foreground);
    }

    .nav-links a {
      color: var(--primary-foreground);
      padding: var(--spacing-2) var(--spacing-3);
      border-radius: var(--border-radius-sm);
      transition: background-color 0.2s ease;
    }

    .nav-links a.active,
    .nav-links a:hover {
      background-color: var(--primary-light);
      text-decoration: none;
    }

    .nav-links a.active {
      font-weight: 600;
      color: var(--accent-light);
    }

    /* Dropdown */
    .dropdown {
      position: relative;
    }

    .dropdown-toggle {
      color: var(--primary-foreground);
      display: flex;
      align-items: center;
      gap: var(--spacing-1);
    }

    .dropdown-toggle .icon {
      transition: transform 0.2s ease-in-out;
    }

    .dropdown.open .dropdown-toggle .icon {
      transform: rotate(180deg);
    }

    .dropdown-menu {
      position: absolute;
      top: calc(100% + var(--spacing-2));
      right: 0;
      background-color: var(--surface-color);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-md);
      box-shadow: var(--shadow-lg);
      min-width: 200px;
      padding: var(--spacing-2) 0;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: opacity 0.2s ease, transform 0.2s ease, visibility 0.2s;
      z-index: 1001;
    }

    .dropdown.open .dropdown-menu {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
      padding: var(--spacing-2) var(--spacing-4);
      color: var(--text-color);
      transition: background-color 0.2s ease;
    }

    .dropdown-item:hover {
      background-color: var(--background-color);
      text-decoration: none;
    }

    .dropdown-item .icon {
      color: var(--secondary-color);
    }

    .dropdown-item.text-danger {
      color: var(--danger-color);
    }

    .dropdown-item.text-danger .icon {
      color: var(--danger-color);
    }

    .dropdown-divider {
      height: 1px;
      background-color: var(--border-color);
      margin: var(--spacing-2) 0;
    }

    /* Breadcrumb */
    .breadcrumb {
      display: flex;
      align-items: center;
      gap: var(--spacing-1);
      font-size: 0.9rem;
      color: var(--text-light-color);
      margin-bottom: var(--spacing-6);
    }

    .breadcrumb-item a {
      color: var(--primary-color);
    }

    .breadcrumb-item.active {
      color: var(--text-color);
      font-weight: 500;
    }

    .breadcrumb-item:not(:last-child)::after {
      content: '/';
      margin-left: var(--spacing-1);
      color: var(--text-light-color);
    }

    /* Card */
    .card {
      background-color: var(--surface-color);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-sm);
      overflow: hidden;
      /* Untuk card-header dan card-body */
    }

    .card-header {
      padding: var(--spacing-4);
      border-bottom: 1px solid var(--border-color);
      background-color: var(--surface-color);
      /* atau var(--accent-color) jika header berwarna */
    }

    .card-header h5 {
      margin-bottom: 0;
      font-size: 1.2rem;
    }

    .card-body {
      padding: var(--spacing-4);
    }

    .card-title {
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: var(--spacing-1);
    }

    .card-text-lg {
      /* Untuk teks besar seperti angka statistik */
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-dark);
    }

    .stats-card .icon {
      font-size: 2.5rem;
      /* Ukuran ikon besar */
      margin-bottom: var(--spacing-2);
    }

    /* Button */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-2);
      padding: var(--spacing-2) var(--spacing-4);
      border-radius: var(--border-radius-md);
      font-weight: 600;
      font-size: 0.95rem;
      text-align: center;
      transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
      line-height: 1.5;
      /* Perbaikan untuk tinggi tombol yang konsisten */
    }

    .btn:focus-visible {
      outline: 2px solid var(--primary-light);
      outline-offset: 2px;
    }

    .btn-primary {
      background-color: var(--primary-color);
      color: var(--primary-foreground);
    }

    .btn-primary:hover {
      background-color: var(--primary-light);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .btn-secondary {
      background-color: var(--secondary-color);
      color: var(--secondary-foreground);
      border: 1px solid var(--secondary-dark);
    }

    .btn-secondary:hover {
      background-color: var(--secondary-light);
      border-color: var(--secondary-color);
    }

    .btn-outline-primary {
      background-color: transparent;
      color: var(--primary-color);
      border: 1px solid var(--primary-color);
    }

    .btn-outline-primary:hover {
      background-color: var(--primary-color);
      color: var(--primary-foreground);
    }

    .btn-outline-secondary {
      background-color: transparent;
      color: var(--secondary-dark);
      border: 1px solid var(--secondary-dark);
    }

    .btn-outline-secondary:hover {
      background-color: var(--secondary-dark);
      color: var(--secondary-foreground);
    }

    .btn-outline-danger {
      background-color: transparent;
      color: var(--danger-color);
      border: 1px solid var(--danger-color);
    }

    .btn-outline-danger:hover {
      background-color: var(--danger-color);
      color: var(--primary-foreground);
    }

    .btn-danger {
      background-color: var(--danger-color);
      color: var(--primary-foreground);
    }

    .btn-danger:hover {
      background-color: #d73737;
      /* Slightly darker red */
    }

    .btn-sm {
      padding: var(--spacing-1) var(--spacing-2);
      font-size: 0.85rem;
    }

    .btn .icon {
      /* Untuk ikon di dalam tombol */
      font-size: 1.1em;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: var(--spacing-4);
    }

    .form-label {
      display: block;
      font-weight: 500;
      color: var(--secondary-dark);
      margin-bottom: var(--spacing-1);
    }

    .form-control,
    .form-select {
      width: 100%;
      padding: var(--spacing-2) var(--spacing-3);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-md);
      background-color: var(--surface-color);
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .form-control:focus,
    .form-select:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px var(--primary-light);
      outline: none;
    }

    .form-control.is-invalid,
    .form-select.is-invalid {
      border-color: var(--danger-color);
    }

    .invalid-feedback {
      display: none;
      /* Awalnya disembunyikan */
      color: var(--danger-color);
      font-size: 0.875em;
      margin-top: var(--spacing-1);
    }

    .form-control.is-invalid~.invalid-feedback,
    .form-select.is-invalid~.invalid-feedback {
      display: block;
    }

    .input-group {
      display: flex;
      align-items: stretch;
      /* Agar semua item setinggi input */
    }

    .input-group .form-control {
      flex-grow: 1;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }

    .input-group-text {
      display: flex;
      align-items: center;
      padding: var(--spacing-2) var(--spacing-3);
      background-color: var(--background-color);
      border: 1px solid var(--border-color);
      border-left: none;
      border-top-right-radius: var(--border-radius-md);
      border-bottom-right-radius: var(--border-radius-md);
      color: var(--text-light-color);
    }

    .form-check {
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
    }

    .form-check-input {
      /* Untuk checkbox/radio */
      width: 1.25em;
      height: 1.25em;
    }

    .form-switch .form-check-input {
      /* Styling khusus untuk switch jika diperlukan */
      /* Implementasi switch dengan CSS murni bisa kompleks, mungkin perlu gambar atau pseudo-elemen */
    }


    /* Table */
    .table-responsive {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      /* Momentum scrolling di iOS */
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: var(--spacing-4);
      background-color: var(--surface-color);
    }

    .table th,
    .table td {
      padding: var(--spacing-3);
      text-align: left;
      vertical-align: middle;
      border-bottom: 1px solid var(--border-color);
    }

    .table th {
      background-color: var(--background-color);
      /* Sedikit beda dari body */
      font-weight: 700;
      font-size: 0.85rem;
      letter-spacing: 0.04em;
      color: var(--primary-dark);
      border-top: 1px solid var(--border-color);
      /* Garis atas untuk header */
    }

    .table tbody tr:hover {
      background-color: var(--background-color);
      transition: background-color 0.2s ease;
    }

    .table .avatar {
      width: 30px;
      height: 30px;
      object-fit: cover;
      margin-right: var(--spacing-2);
    }

    /* Badge */
    .badge {
      display: inline-block;
      padding: 0.4em 0.9em;
      font-size: 0.85em;
      font-weight: 600;
      line-height: 1;
      text-align: center;
      white-space: nowrap;
      vertical-align: baseline;
      border-radius: 999px;
      /* Pill shape */
      color: var(--primary-foreground);
      /* Default text color */
    }

    .badge-success {
      background-color: var(--success-color);
    }

    .badge-danger {
      background-color: var(--danger-color);
    }

    .badge-primary {
      background-color: var(--primary-color);
    }

    .badge-info {
      background-color: var(--info-color);
    }

    .badge-warning {
      background-color: var(--warning-color);
      color: var(--text-color);
    }

    /* Teks gelap untuk badge kuning */
    .badge-secondary {
      background-color: var(--secondary-color);
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: none;
      /* Awalnya disembunyikan */
      align-items: center;
      justify-content: center;
      z-index: 1050;
      padding: var(--spacing-4);
      overflow-y: auto;
    }

    .modal.open {
      display: flex;
      /* Ditampilkan dengan flex untuk centering */
    }

    .modal-dialog {
      background-color: var(--surface-color);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-lg);
      width: 100%;
      max-width: 500px;
      /* Default width */
      margin: var(--spacing-4) auto;
      /* Untuk scrolling jika konten panjang */
      display: flex;
      flex-direction: column;
      max-height: calc(100vh - (var(--spacing-4) * 2));
      /* Batasi tinggi modal */
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-4);
      border-bottom: 1px solid var(--border-color);
    }

    .modal-title {
      font-weight: 700;
      font-size: 1.25rem;
      color: var(--primary-dark);
      margin-bottom: 0;
    }

    .btn-close {
      background: transparent;
      border: none;
      font-size: 1.5rem;
      line-height: 1;
      opacity: 0.7;
      padding: var(--spacing-1);
      /* Area klik lebih besar */
    }

    .btn-close:hover {
      opacity: 1;
    }

    .modal-body {
      padding: var(--spacing-4);
      overflow-y: auto;
      /* Jika konten body panjang */
      flex-grow: 1;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: var(--spacing-2);
      padding: var(--spacing-4);
      border-top: 1px solid var(--border-color);
      background-color: var(--background-color);
      /* Sedikit beda */
      border-bottom-left-radius: var(--border-radius-lg);
      border-bottom-right-radius: var(--border-radius-lg);
    }

    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: var(--spacing-1);
      margin-top: var(--spacing-6);
    }

    .page-item .page-link {
      padding: var(--spacing-2) var(--spacing-3);
      border: 1px solid var(--border-color);
      color: var(--primary-color);
      border-radius: var(--border-radius-sm);
      transition: background-color 0.2s, color 0.2s;
    }

    .page-item.active .page-link {
      background-color: var(--primary-color);
      color: var(--primary-foreground);
      border-color: var(--primary-color);
      font-weight: 600;
    }

    .page-item:not(.active) .page-link:hover {
      background-color: var(--background-color);
      text-decoration: none;
    }

    .page-item.disabled .page-link {
      color: var(--text-light-color);
      pointer-events: none;
      background-color: var(--background-color);
    }

    /* Grid untuk statistik */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-4);
    }

    /* Ikon Sederhana (SVG atau karakter) */
    .icon {
      display: inline-block;
      width: 1em;
      height: 1em;
      vertical-align: -0.125em;
      /* Penyesuaian vertikal */
      fill: currentColor;
      /* Agar bisa diwarnai dengan CSS color */
    }

    /* Contoh ikon SVG, tambahkan lebih banyak sesuai kebutuhan */
    .icon-person-circle {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-person-circle' viewBox='0 0 16 16'%3E%3Cpath d='M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z'/%3E%3Cpath fill-rule='evenodd' d='M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-size: contain;
    }

    .icon-chevron-down {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-chevron-down' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-size: contain;
    }

    .icon-building {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%232563eb' class='bi bi-building' viewBox='0 0 16 16'%3E%3Cpath d='M4 2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zM4 5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zM7.5 5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm2.5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zM4.5 8a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm2.5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5z'/%3E%3Cpath d='M2 1a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1zm11 0H3v14h3v-2.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5V15h3z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-size: contain;
    }

    .icon-plus-circle {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-plus-circle' viewBox='0 0 16 16'%3E%3Cpath d='M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16'/%3E%3Cpath d='M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-size: contain;
    }

    .icon-pencil {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-pencil' viewBox='0 0 16 16'%3E%3Cpath d='M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-size: contain;
    }

    .icon-trash {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-trash' viewBox='0 0 16 16'%3E%3Cpath d='M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z'/%3E%3Cpath d='M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-size: contain;
    }

    .icon-search {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-search' viewBox='0 0 16 16'%3E%3Cpath d='M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-size: contain;
    }

    .icon-download {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-download' viewBox='0 0 16 16'%3E%3Cpath d='M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5'%3E%3C/path%3E%3Cpath d='M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-size: contain;
    }

    .icon-person {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-person' viewBox='0 0 16 16'%3E%3Cpath d='M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-size: contain;
    }

    .icon-shield-lock {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-shield-lock' viewBox='0 0 16 16'%3E%3Cpath d='M5.338 1.59a61 61 0 0 0-2.837.856.48.48 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.7 10.7 0 0 0 2.287 2.233c.346.244.652.42.893.533q.18.085.293.118a1 1 0 0 0 .101.025 1 1 0 0 0 .1-.025q.114-.034.294-.118c.24-.113.547-.29.893-.533a10.7 10.7 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.945-.3-1.867-.595-2.837-.856C9.662 1.105 8.875 1.5 8 1.5s-.875-.4-1.662-.09zM5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.8 11.8 0 0 1-2.517 2.453 7 7 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7 7 0 0 1-1.048-.625 11.8 11.8 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 63 63 0 0 1 5.072.56'/%3E%3Cpath d='M9.5 6.5a1.5 1.5 0 0 1-1 1.415l.385 1.965a.5.5 0 0 1-.491.585h-.788a.5.5 0 0 1-.49-.585l.385-1.965A1.5 1.5 0 1 1 9.5 6.5m0 1a.5.5 0 0 0 0-1 .5.5 0 0 0 0 1'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-size: contain;
    }

    .icon-box-arrow-right {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-box-arrow-right' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z'/%3E%3Cpath fill-rule='evenodd' d='M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-size: contain;
    }

    /* Responsive Adjustments */
    @media (max-width: 992px) {

      /* Tablet */
      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      }

      .card-header .btn {
        font-size: 0.9rem;
        padding: var(--spacing-1) var(--spacing-2);
      }

      .table-controls .form-select,
      .table-controls .btn {
        font-size: 0.9rem;
      }
    }

    @media (max-width: 768px) {

      /* Mobile Large */
      html {
        font-size: 15px;
      }

      .container {
        width: 95%;
        padding-left: var(--spacing-2);
        padding-right: var(--spacing-2);
      }

      .app-navbar {
        padding: var(--spacing-2) 0;
      }

      .navbar-brand {
        font-size: 1.1rem;
      }

      .navbar-brand img {
        width: 30px;
        height: 30px;
      }

      .nav-links {
        display: none;
        /* Sembunyikan untuk mobile, bisa diganti hamburger */
      }

      .account-dropdown .dropdown-toggle span {
        display: none;
      }

      /* Sembunyikan teks "My Account" */
      .breadcrumb {
        margin-bottom: var(--spacing-4);
        font-size: 0.85rem;
      }

      .stats-grid {
        grid-template-columns: 1fr 1fr;
      }

      /* 2 kolom untuk mobile */
      .card-text-lg {
        font-size: 1.5rem;
      }

      .card-header h5 {
        font-size: 1.1rem;
      }

      .card-body,
      .card-header,
      .modal-header,
      .modal-body,
      .modal-footer {
        padding: var(--spacing-3);
      }

      .table th,
      .table td {
        padding: var(--spacing-2);
        font-size: 0.9rem;
      }

      .table-controls {
        flex-direction: column;
      }

      .table-controls>div {
        width: 100%;
        margin-bottom: var(--spacing-2);
      }

      .table-controls>div:last-child {
        margin-bottom: 0;
      }

      .pagination {
        margin-top: var(--spacing-4);
      }

      .page-item .page-link {
        padding: var(--spacing-1) var(--spacing-2);
        font-size: 0.9rem;
      }

      .modal-dialog {
        max-width: calc(100% - var(--spacing-4));
        margin: var(--spacing-2) auto;
      }
    }

    @media (max-width: 576px) {

      /* Mobile Small */
      html {
        font-size: 14px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      /* 1 kolom untuk mobile sangat kecil */
      .btn {
        font-size: 0.9rem;
      }

      .card-title,
      .modal-title {
        font-size: 1rem;
      }
    }
  </style>
</head>

<body>
  <header class="app-navbar">
    <div class="container">
      <a href="#dashboard" class="navbar-brand route-link">
        <img
          src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8YmVhdXRpZnVsJTIwbGFuZHNjYXBlfGVufDB8fDB8fHww&w=100&q=80"
          class="rounded-circle" alt="Logo Rentify" />
        <span>Rentify Apartment Rental</span>
      </a>

      <!-- Navigasi utama bisa ditambahkan di sini jika diperlukan, untuk SPA bisa jadi ada di sidebar atau diintegrasikan beda -->
      <!-- <nav class="nav-links">
        <a href="#dashboard" class="route-link active">Dashboard</a>
        <a href="#tenants" class="route-link">Penyewa</a>
      </nav> -->

      <div class="dropdown account-dropdown" id="accountDropdownContainer">
        <button class="btn dropdown-toggle" type="button" id="accountDropdownToggle" aria-expanded="false"
          aria-label="Akun Saya">
          <span class="icon icon-person-circle"></span>
          <span>Akun Saya</span>
          <span class="icon icon-chevron-down" style="font-size: 0.8em;"></span>
        </button>
        <ul class="dropdown-menu" id="accountDropdownMenu">
          <li>
            <a class="dropdown-item" href="#" data-modal-target="accountInfoModal">
              <span class="icon icon-person"></span>Info Akun
            </a>
          </li>
          <li>
            <a class="dropdown-item" href="#" data-modal-target="securityModal">
              <span class="icon icon-shield-lock"></span>Keamanan
            </a>
          </li>
          <li>
            <hr class="dropdown-divider" />
          </li>
          <li>
            <a class="dropdown-item text-danger" href="#" id="logoutButton">
              <span class="icon icon-box-arrow-right"></span>Keluar
            </a>
          </li>
        </ul>
      </div>
    </div>
  </header>

  <main class="container mt-6 mb-8" id="app-main-content">
    <!-- Konten dinamis akan dimuat di sini oleh JavaScript -->
    <div class="text-center p-8">
      <p>Memuat konten...</p>
    </div>
  </main>

  <footer class="text-center p-4 text-muted" style="background-color: var(--border-color);">
    <p>&copy; <span id="currentYear"></span> Rentify. Seluruh hak cipta dilindungi.</p>
  </footer>

  <!-- ==== TEMPLATE UNTUK MODAL (Akan di-clone dan diisi oleh JS) ==== -->
  <template id="modalTemplate">
    <div class="modal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Judul Modal</h5>
            <button type="button" class="btn-close" aria-label="Tutup">&times;</button>
          </div>
          <div class="modal-body">
            <p>Konten modal.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-action="close">Tutup</button>
            <button type="button" class="btn btn-primary" data-action="save">Simpan Perubahan</button>
          </div>
        </div>
      </div>
    </div>
  </template>

  <!-- Kontainer untuk modal yang aktif -->
  <div id="modal-container"></div>

  <script>
    // ==== APLIKASI SPA VANILLA ====

    const App = {
      // STATE APLIKASI (Lapisan Data & Status)
      state: {
        currentView: 'dashboard',
        currentUser: {
          name: 'Admin Rentify',
          email: 'admin@rentify.app',
          avatar: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8dXNlcnxlbnwwfHwwfHx8MA%3D%3D&w=40&q=80',
        },
        stats: {
          totalApartments: 0,
          occupiedUnits: 0,
          vacantUnits: 0,
          newTenants: 0,
        },
        tenants: [],
        apartments: [
          { id: 'sky', name: 'Sky Residence' },
          { id: 'green', name: 'Green Park' },
          { id: 'urban', name: 'Urban Loft' },
        ],
        editingTenantId: null,
        deletingTenantId: null,
        pagination: {
          currentPage: 1,
          itemsPerPage: 5, // Jumlah penyewa per halaman
          totalItems: 0,
        },
        searchTerm: '',
        filterApartment: '',
      },

      // UTILITIES (Lapisan Utilitas - Fungsi Pembantu)
      utils: {
        $: (selector, parent = document) => parent.querySelector(selector),
        $$: (selector, parent = document) => parent.querySelectorAll(selector),
        createElement: (tag, props = {}, children = []) => {
          const el = document.createElement(tag);
          Object.entries(props).forEach(([key, value]) => {
            if (key === 'dataset') {
              Object.entries(value).forEach(([dataKey, dataValue]) => el.dataset[dataKey] = dataValue);
            } else if (key.startsWith('on') && typeof value === 'function') {
              el.addEventListener(key.substring(2).toLowerCase(), value);
            }
            else {
              el.setAttribute(key, value);
            }
          });
          children.forEach(child => {
            if (typeof child === 'string') {
              el.appendChild(document.createTextNode(child));
            } else if (child instanceof HTMLElement) {
              el.appendChild(child);
            }
          });
          return el;
        },
        // Fungsi untuk membersihkan string dari potensi XSS sederhana (bukan pengganti library sanitasi penuh)
        sanitizeHTML: (str) => {
          const temp = document.createElement('div');
          temp.textContent = str;
          return temp.innerHTML;
        },
        // Fungsi debounce untuk menunda eksekusi fungsi (misalnya, pada input pencarian)
        debounce: (func, delay) => {
          let timeout;
          return function (...args) {
            const context = this;
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(context, args), delay);
          };
        },
        generateId: () => `T${Math.random().toString(36).substr(2, 3).toUpperCase()}${Date.now() % 1000}`
      },

      // TEMPLATES & RENDERERS (Lapisan Presentasi - Bagian dari UI Logic)
      // Ini akan membuat elemen DOM atau string HTML untuk bagian-bagian UI
      templates: {
        breadcrumb: (items) => {
          const nav = App.utils.createElement('nav', { 'aria-label': 'breadcrumb' });
          const ol = App.utils.createElement('ol', { class: 'breadcrumb' });
          items.forEach((item, index) => {
            const liClass = index === items.length - 1 ? 'breadcrumb-item active' : 'breadcrumb-item';
            const li = App.utils.createElement('li', { class: liClass });
            if (index === items.length - 1) {
              li.setAttribute('aria-current', 'page');
              li.textContent = item.text;
            } else {
              const a = App.utils.createElement('a', { href: item.href, class: 'route-link' }, [item.text]);
              li.appendChild(a);
            }
            ol.appendChild(li);
          });
          nav.appendChild(ol);
          return nav;
        },

        statCard: ({ icon, title, value, colorClass }) => `
          <div class="card shadow-md text-center stats-card">
            <div class="card-body">
              <span class="icon ${icon} ${colorClass}" style="font-size: 2.5rem; display: block; margin-bottom: var(--spacing-2);"></span>
              <h5 class="card-title mt-2">${App.utils.sanitizeHTML(title)}</h5>
              <div class="card-text-lg ${colorClass}">${App.utils.sanitizeHTML(String(value))}</div>
            </div>
          </div>
        `,

        tenantRow: (tenant) => `
          <tr data-id="${tenant.id}">
            <td>${App.utils.sanitizeHTML(tenant.id)}</td>
            <td>
              <img src="${App.utils.sanitizeHTML(tenant.avatar || 'https://via.placeholder.com/30x30.png?text=User')}" class="avatar rounded-circle" alt="Avatar ${App.utils.sanitizeHTML(tenant.name)}" />
              ${App.utils.sanitizeHTML(tenant.name)}
            </td>
            <td>${App.utils.sanitizeHTML(tenant.email)}</td>
            <td><span class="badge badge-primary">${App.utils.sanitizeHTML(tenant.apartmentName)}</span></td>
            <td><span class="badge ${tenant.status === 'active' ? 'badge-success' : 'badge-danger'}">${tenant.status === 'active' ? 'Aktif' : 'Nonaktif'}</span></td>
            <td>
              <button class="btn btn-sm btn-outline-primary me-1" data-action="edit-tenant" data-id="${tenant.id}" title="Ubah">
                <span class="icon icon-pencil"></span>
              </button>
              <button class="btn btn-sm btn-outline-danger" data-action="delete-tenant" data-id="${tenant.id}" title="Hapus">
                <span class="icon icon-trash"></span>
              </button>
            </td>
          </tr>
        `,
        pagination: (currentPage, totalPages) => {
          if (totalPages <= 1) return ''; // Jangan tampilkan paginasi jika hanya 1 halaman

          let paginationHtml = '<ul class="pagination">';
          // Tombol Previous
          paginationHtml += `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" data-page="${currentPage - 1}" aria-label="Sebelumnya">Sebelumnya</a>
                </li>`;

          // Nomor Halaman
          // Tampilkan beberapa nomor halaman di sekitar halaman saat ini
          const maxPagesToShow = 5;
          let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2));
          let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);

          if (endPage - startPage + 1 < maxPagesToShow) {
            startPage = Math.max(1, endPage - maxPagesToShow + 1);
          }

          if (startPage > 1) {
            paginationHtml += `<li class="page-item"><a class="page-link" href="#" data-page="1">1</a></li>`;
            if (startPage > 2) paginationHtml += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
          }

          for (let i = startPage; i <= endPage; i++) {
            paginationHtml += `
                    <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" data-page="${i}">${i}</a>
                    </li>`;
          }

          if (endPage < totalPages) {
            if (endPage < totalPages - 1) paginationHtml += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
            paginationHtml += `<li class="page-item"><a class="page-link" href="#" data-page="${totalPages}">${totalPages}</a></li>`;
          }

          // Tombol Next
          paginationHtml += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" data-page="${currentPage + 1}" aria-label="Berikutnya">Berikutnya</a>
                </li>`;
          paginationHtml += '</ul>';
          return paginationHtml;
        },
      },

      // COMPONENTS (Lapisan Interaksi UI - Logika untuk komponen spesifik)
      components: {
        // Manajemen Modal
        modal: {
          _activeModal: null, // Menyimpan referensi ke modal yang sedang aktif
          _setupModalEventListeners: (modalElement) => {
            // Tombol close di header modal
            const closeButton = App.utils.$('.btn-close', modalElement);
            if (closeButton) {
              closeButton.addEventListener('click', () => App.components.modal.close(modalElement));
            }

            // Tombol dengan data-action="close" di footer
            const footerCloseButtons = App.utils.$$('[data-action="close"]', modalElement);
            footerCloseButtons.forEach(btn => {
              btn.addEventListener('click', () => App.components.modal.close(modalElement));
            });

            // Menutup modal jika klik di luar area .modal-dialog
            modalElement.addEventListener('click', (event) => {
              if (event.target === modalElement) { // Hanya jika klik pada .modal (backdrop)
                App.components.modal.close(modalElement);
              }
            });
          },
          open: (id, title, bodyContent, footerButtonsConfig) => {
            App.components.modal.closeAll(); // Tutup modal lain jika ada

            const template = App.utils.$('#modalTemplate');
            const newModal = template.content.cloneNode(true).firstElementChild;
            newModal.id = id;

            App.utils.$('.modal-title', newModal).textContent = title;

            const modalBody = App.utils.$('.modal-body', newModal);
            modalBody.innerHTML = ''; // Bersihkan konten body default
            if (typeof bodyContent === 'string') {
              modalBody.innerHTML = bodyContent;
            } else if (bodyContent instanceof HTMLElement) {
              modalBody.appendChild(bodyContent);
            }

            const modalFooter = App.utils.$('.modal-footer', newModal);
            modalFooter.innerHTML = ''; // Bersihkan tombol footer default

            footerButtonsConfig.forEach(config => {
              const button = App.utils.createElement('button', {
                type: 'button',
                class: `btn ${config.class || 'btn-secondary'}`,
                ... (config.id ? { id: config.id } : {}),
              }, [config.text]);

              if (config.action === 'close') {
                button.addEventListener('click', () => App.components.modal.close(newModal));
              } else if (typeof config.onClick === 'function') {
                button.addEventListener('click', config.onClick);
              }
              modalFooter.appendChild(button);
            });

            App.utils.$('#modal-container').appendChild(newModal);
            App.components.modal._setupModalEventListeners(newModal);

            // Beri sedikit waktu untuk DOM update sebelum transisi
            setTimeout(() => {
              newModal.classList.add('open');
              document.body.style.overflow = 'hidden'; // Mencegah scroll body saat modal terbuka
            }, 10);
            App.components.modal._activeModal = newModal;

            // Fokus ke elemen pertama yang bisa di fokuskan di modal
            const firstFocusable = App.utils.$('input, select, textarea, button', newModal);
            if (firstFocusable) firstFocusable.focus();

            return newModal; // Kembalikan elemen modal untuk interaksi lebih lanjut jika perlu
          },
          close: (modalOrId) => {
            let modalElement = modalOrId;
            if (typeof modalOrId === 'string') {
              modalElement = App.utils.$(`#${modalOrId}`, App.utils.$('#modal-container'));
            }
            if (modalElement && modalElement.classList.contains('open')) {
              modalElement.classList.remove('open');
              document.body.style.overflow = '';
              // Hapus modal dari DOM setelah transisi selesai
              setTimeout(() => {
                if (modalElement.parentElement) {
                  modalElement.parentElement.removeChild(modalElement);
                }
              }, 300); // Sesuaikan dengan durasi transisi CSS
            }
            if (App.components.modal._activeModal === modalElement) {
              App.components.modal._activeModal = null;
            }
          },
          closeAll: () => {
            App.utils.$$('.modal.open', App.utils.$('#modal-container')).forEach(modal => App.components.modal.close(modal));
          }
        },
        // Dropdown
        dropdown: {
          init: () => {
            document.addEventListener('click', (event) => {
              const toggle = event.target.closest('.dropdown-toggle');
              const openDropdown = App.utils.$('.dropdown.open');

              if (toggle) {
                const dropdown = toggle.closest('.dropdown');
                if (dropdown && dropdown !== openDropdown) {
                  if (openDropdown) openDropdown.classList.remove('open'); // Tutup dropdown lain jika ada
                  dropdown.classList.add('open');
                } else if (dropdown) {
                  dropdown.classList.toggle('open');
                }
              } else if (openDropdown && !event.target.closest('.dropdown-menu')) {
                // Jika klik di luar dropdown yang terbuka, tutup dropdown itu
                openDropdown.classList.remove('open');
              }
            });
          }
        },
        // Validasi Form
        formValidator: {
          validate: (formElement) => {
            let isValid = true;
            App.utils.$$('input[required], select[required], textarea[required]', formElement).forEach(input => {
              // Hapus pesan error sebelumnya
              input.classList.remove('is-invalid');
              const feedbackElement = input.parentElement.querySelector('.invalid-feedback');
              if (feedbackElement) feedbackElement.style.display = 'none';

              if (!input.value.trim()) {
                isValid = false;
                input.classList.add('is-invalid');
                if (feedbackElement) {
                  feedbackElement.textContent = input.dataset.errorMessage || 'Kolom ini wajib diisi.';
                  feedbackElement.style.display = 'block';
                }
              } else if (input.type === 'email' && !/^\S+@\S+\.\S+$/.test(input.value)) {
                isValid = false;
                input.classList.add('is-invalid');
                if (feedbackElement) {
                  feedbackElement.textContent = 'Format email tidak valid.';
                  feedbackElement.style.display = 'block';
                }
              }
              // Tambahkan validasi lain jika perlu (misal: panjang minimal, format nomor telepon)
            });
            return isValid;
          },

          getFormData: (formElement) => {
            const formData = new FormData(formElement);
            const data = {};
            for (let [key, value] of formData.entries()) {
              data[key] = value;
            }
            return data;
          },

          resetForm: (formElement) => {
            formElement.reset();
            App.utils.$$('.is-invalid', formElement).forEach(el => el.classList.remove('is-invalid'));
            App.utils.$$('.invalid-feedback', formElement).forEach(el => el.style.display = 'none');
          }
        }
      },

      // VIEWS / PAGES (Lapisan Kontrol - Mengelola tampilan halaman)
      views: {
        _renderContent: (title, breadcrumbItems, contentGenerator) => {
          const mainContent = App.utils.$('#app-main-content');
          mainContent.innerHTML = ''; // Kosongkan konten sebelumnya

          document.title = `${title} - Rentify`;

          if (breadcrumbItems && breadcrumbItems.length > 0) {
            mainContent.appendChild(App.templates.breadcrumb(breadcrumbItems));
          }

          const contentElement = contentGenerator(); // Fungsi ini harus mengembalikan elemen DOM atau string HTML
          if (typeof contentElement === 'string') {
            mainContent.insertAdjacentHTML('beforeend', contentElement);
          } else if (contentElement instanceof HTMLElement) {
            mainContent.appendChild(contentElement);
          }
          App.router.updateNavLinks();
        },

        dashboard: () => {
          App.views._renderContent('Dashboard',
            [{ text: 'Beranda', href: '#dashboard' }],
            () => {
              const stats = App.state.stats;
              const dashboardHtml = `
                <div class="stats-grid">
                  ${App.templates.statCard({ icon: 'icon-building', title: 'Total Apartemen', value: stats.totalApartments, colorClass: 'text-primary' })}
                  ${App.templates.statCard({ icon: 'icon-person', title: 'Unit Terisi', value: stats.occupiedUnits, colorClass: 'text-success' })}
                  ${App.templates.statCard({ icon: 'icon-building', title: 'Unit Kosong', value: stats.vacantUnits, colorClass: 'text-danger' })}
                  ${App.templates.statCard({ icon: 'icon-person', title: 'Penyewa Baru (Bulan Ini)', value: stats.newTenants, colorClass: 'text-info' })}
                </div>
                <div class="card mt-6 shadow-md">
                    <div class="card-header">
                        <h5>Selamat Datang, ${App.utils.sanitizeHTML(App.state.currentUser.name)}!</h5>
                    </div>
                    <div class="card-body">
                        <p>Ini adalah halaman dashboard sistem manajemen sewa apartemen Rentify. Anda dapat mengelola penyewa, melihat statistik, dan melakukan pengaturan akun dari sini.</p>
                        <p>Gunakan navigasi di atas atau tautan di bawah untuk memulai:</p>
                        <a href="#tenants" class="btn btn-primary route-link mt-2">Kelola Penyewa</a>
                    </div>
                </div>
              `;
              return dashboardHtml;
            }
          );
        },

        tenants: () => {
          App.views._renderContent('Manajemen Penyewa',
            [
              { text: 'Beranda', href: '#dashboard' },
              { text: 'Manajemen Penyewa', href: '#tenants' }
            ],
            () => {
              const container = App.utils.createElement('div');
              const card = App.utils.createElement('div', { class: 'card shadow-md' });

              const cardHeader = App.utils.createElement('div', { class: 'card-header d-flex flex-wrap justify-content-between align-items-center gap-2' });
              cardHeader.appendChild(App.utils.createElement('h5', { class: 'mb-0' }, ['Manajemen Penyewa']));
              cardHeader.appendChild(App.utils.createElement('button', {
                class: 'btn btn-primary',
                'data-action': 'add-tenant',
                onClick: App.actions.showAddTenantModal
              }, [
                App.utils.createElement('span', { class: 'icon icon-plus-circle me-1' }),
                'Tambah Penyewa'
              ]));
              card.appendChild(cardHeader);

              const cardBody = App.utils.createElement('div', { class: 'card-body' });

              // Kontrol Tabel (Pencarian, Filter, Ekspor)
              const tableControls = App.utils.createElement('div', { class: 'row mb-4 gap-2 table-controls' }); // Menggunakan 'row' untuk konsistensi layout

              const searchGroup = App.utils.createElement('div', { class: 'col-md-5' }); // Responsive col
              const inputGroup = App.utils.createElement('div', { class: 'input-group' });
              inputGroup.appendChild(App.utils.createElement('span', { class: 'input-group-text' }, [App.utils.createElement('span', { class: 'icon icon-search' })]));
              const searchInput = App.utils.createElement('input', {
                type: 'text',
                class: 'form-control',
                id: 'tenantSearchInput',
                placeholder: 'Cari penyewa...',
                'aria-label': 'Cari penyewa',
                value: App.state.searchTerm,
                onkeyup: App.utils.debounce((e) => App.actions.filterTenants(e.target.value, App.state.filterApartment), 300)
              });
              inputGroup.appendChild(searchInput);
              searchGroup.appendChild(inputGroup);
              tableControls.appendChild(searchGroup);

              const filterGroup = App.utils.createElement('div', { class: 'col-md-3' }); // Responsive col
              const filterSelect = App.utils.createElement('select', {
                class: 'form-select',
                'aria-label': 'Filter berdasarkan Apartemen',
                onchange: (e) => App.actions.filterTenants(App.state.searchTerm, e.target.value)
              });
              filterSelect.appendChild(App.utils.createElement('option', { value: '' }, ['Filter Apartemen']));
              App.state.apartments.forEach(apt => {
                filterSelect.appendChild(App.utils.createElement('option', { value: apt.id, selected: App.state.filterApartment === apt.id }, [apt.name]));
              });
              filterGroup.appendChild(filterSelect);
              tableControls.appendChild(filterGroup);

              const exportGroup = App.utils.createElement('div', { class: 'col-md-3' }); // Responsive col
              exportGroup.appendChild(App.utils.createElement('button', {
                class: 'btn btn-outline-secondary w-100', 'aria-label': 'Ekspor Data',
                onClick: () => alert('Fitur ekspor data akan segera tersedia!')
              }, [
                App.utils.createElement('span', { class: 'icon icon-download me-1' }),
                'Ekspor Data'
              ]));
              tableControls.appendChild(exportGroup);
              cardBody.appendChild(tableControls);

              // Tabel Penyewa
              const tableResponsive = App.utils.createElement('div', { class: 'table-responsive' });
              const table = App.utils.createElement('table', { class: 'table' });
              table.innerHTML = `
                <thead>
                  <tr>
                    <th>ID Penyewa</th>
                    <th>Nama</th>
                    <th>Email</th>
                    <th>Apartemen</th>
                    <th>Status</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="tenantTableBody">
                  ${App.actions.getPaginatedTenants().map(App.templates.tenantRow).join('') || '<tr><td colspan="6" class="text-center p-4">Tidak ada data penyewa.</td></tr>'}
                </tbody>
              `;
              tableResponsive.appendChild(table);
              cardBody.appendChild(tableResponsive);

              // Paginasi
              const paginationContainer = App.utils.createElement('nav', { 'aria-label': 'Navigasi halaman penyewa', id: 'tenantPagination' });
              const totalPages = Math.ceil(App.state.pagination.totalItems / App.state.pagination.itemsPerPage);
              paginationContainer.innerHTML = App.templates.pagination(App.state.pagination.currentPage, totalPages);
              cardBody.appendChild(paginationContainer);

              card.appendChild(cardBody);
              container.appendChild(card);

              // Tambahkan event listener untuk tombol aksi di tabel dan paginasi
              container.addEventListener('click', (event) => {
                const targetButton = event.target.closest('button[data-action]');
                if (targetButton) {
                  const action = targetButton.dataset.action;
                  const tenantId = targetButton.dataset.id;
                  if (action === 'edit-tenant') App.actions.showEditTenantModal(tenantId);
                  if (action === 'delete-tenant') App.actions.showDeleteTenantModal(tenantId);
                }

                const pageLink = event.target.closest('.page-link[data-page]');
                if (pageLink && !pageLink.closest('.disabled') && !pageLink.closest('.active')) {
                  event.preventDefault();
                  const page = parseInt(pageLink.dataset.page);
                  App.actions.changeTenantPage(page);
                }
              });

              return container;
            }
          );
        },

        settings: () => { // Contoh halaman pengaturan, bisa diperluas
          App.views._renderContent('Pengaturan',
            [
              { text: 'Beranda', href: '#dashboard' },
              { text: 'Pengaturan', href: '#settings' }
            ],
            () => {
              const settingsHtml = `
                    <div class="card shadow-md">
                        <div class="card-header"><h5>Pengaturan Aplikasi</h5></div>
                        <div class="card-body">
                            <p>Halaman pengaturan akan diisi dengan berbagai konfigurasi aplikasi di sini.</p>
                            <p>Contoh: pengaturan notifikasi, preferensi tampilan, dll.</p>
                        </div>
                    </div>
                `;
              return settingsHtml;
            });
        }
        // Tambahkan view lain (misal: apartemen, pembayaran, laporan) jika diperlukan
      },

      // ROUTER (Lapisan Navigasi - Mengelola perubahan view berdasarkan URL hash)
      router: {
        routes: {}, // path: handlerFunction
        init: () => {
          // Listener untuk perubahan hash URL
          window.addEventListener('hashchange', () => App.router.navigate(window.location.hash));
          // Listener untuk klik pada link internal SPA
          document.body.addEventListener('click', (event) => {
            const link = event.target.closest('a.route-link');
            if (link) {
              event.preventDefault();
              const path = link.getAttribute('href');
              App.router.navigate(path);
            }
          });
        },
        add: (path, handler) => {
          App.router.routes[path] = handler;
        },
        navigate: (path) => {
          path = path || '#dashboard'; // Default ke dashboard jika path kosong
          if (path.startsWith('#')) {
            path = path.substring(1); // Hapus '#'
          }

          // Normalisasi path, jika path kosong atau hanya '/', arahkan ke dashboard
          if (path === '' || path === '/') {
            path = 'dashboard';
          }

          const handler = App.router.routes[`#${path}`]; // Rute disimpan dengan '#'
          if (handler) {
            App.state.currentView = path;
            handler(); // Panggil fungsi view yang sesuai
            window.location.hash = path; // Pastikan hash URL sinkron
          } else {
            console.error(`Rute tidak ditemukan: ${path}`);
            App.router.navigate('#dashboard'); // Arahkan ke dashboard jika rute tidak valid
          }
        },
        updateNavLinks: () => { // Untuk menandai link navigasi yang aktif
          App.utils.$$('.app-navbar .nav-links a, .app-navbar .navbar-brand').forEach(link => {
            if (link.getAttribute('href') === `#${App.state.currentView}`) {
              link.classList.add('active');
            } else {
              link.classList.remove('active');
            }
          });
        }
      },

      // ACTIONS / HANDLERS (Lapisan Logika Bisnis - Fungsi untuk memanipulasi state dan UI)
      actions: {
        loadInitialData: () => {
          // Simulasi pengambilan data awal
          App.state.tenants = [
            { id: 'T001', name: 'John Doe', email: 'john@example.com', apartmentId: 'sky', apartmentName: 'Sky Residence', status: 'active', avatar: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=40&q=80' },
            { id: 'T002', name: 'Jane Smith', email: 'jane@example.com', apartmentId: 'green', apartmentName: 'Green Park', status: 'active', avatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=40&q=80' },
            { id: 'T003', name: 'Bob Johnson', email: 'bob@example.com', apartmentId: 'urban', apartmentName: 'Urban Loft', status: 'inactive', avatar: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=40&q=80' },
            { id: 'T004', name: 'Alice Brown', email: 'alice@example.com', apartmentId: 'sky', apartmentName: 'Sky Residence', status: 'active' },
            { id: 'T005', name: 'Charlie Davis', email: 'charlie@example.com', apartmentId: 'green', apartmentName: 'Green Park', status: 'active' },
            { id: 'T006', name: 'Diana Evans', email: 'diana@example.com', apartmentId: 'urban', apartmentName: 'Urban Loft', status: 'inactive' },
            { id: 'T007', name: 'Edward Green', email: 'edward@example.com', apartmentId: 'sky', apartmentName: 'Sky Residence', status: 'active' },
          ];
          // Update statistik berdasarkan data penyewa
          App.actions.updateDashboardStats();
          App.state.pagination.totalItems = App.state.tenants.length;
        },

        updateDashboardStats: () => {
          App.state.stats.totalApartments = App.state.apartments.length * 10; // Asumsi setiap apartemen punya 10 unit
          App.state.stats.occupiedUnits = App.state.tenants.filter(t => t.status === 'active').length;
          App.state.stats.vacantUnits = (App.state.apartments.length * 10) - App.state.stats.occupiedUnits;
          // Asumsi penyewa baru dihitung berdasarkan tanggal masuk (tidak diimplementasikan di data mock ini)
          App.state.stats.newTenants = Math.floor(Math.random() * 5) + 1; // Angka acak untuk demo
        },

        // Logika CRUD untuk penyewa
        showAddTenantModal: () => {
          const formId = 'addTenantForm';
          const formHtml = `
                <form id="${formId}" novalidate>
                    <div class="form-group">
                        <label for="addTenantName" class="form-label">Nama Lengkap</label>
                        <input type="text" class="form-control" id="addTenantName" name="name" required data-error-message="Nama lengkap wajib diisi.">
                        <div class="invalid-feedback"></div>
                    </div>
                    <div class="form-group">
                        <label for="addTenantEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="addTenantEmail" name="email" required data-error-message="Email wajib diisi dan valid.">
                        <div class="invalid-feedback"></div>
                    </div>
                    <div class="form-group">
                        <label for="addTenantPhone" class="form-label">Telepon</label>
                        <input type="tel" class="form-control" id="addTenantPhone" name="phone">
                    </div>
                    <div class="form-group">
                        <label for="addTenantApartment" class="form-label">Apartemen</label>
                        <select class="form-select" id="addTenantApartment" name="apartmentId" required data-error-message="Pilih apartemen.">
                            <option value="">Pilih Apartemen</option>
                            ${App.state.apartments.map(apt => `<option value="${apt.id}">${App.utils.sanitizeHTML(apt.name)}</option>`).join('')}
                        </select>
                        <div class="invalid-feedback"></div>
                    </div>
                    <div class="form-group">
                        <label for="addTenantAvatar" class="form-label">Foto Profil (URL)</label>
                        <input type="url" class="form-control" id="addTenantAvatar" name="avatar" placeholder="https://example.com/image.jpg">
                    </div>
                </form>
            `;
          App.components.modal.open('addTenantModal', 'Tambah Penyewa Baru', formHtml, [
            { text: 'Batal', class: 'btn-secondary', action: 'close' },
            { text: 'Tambah Penyewa', class: 'btn-primary', onClick: () => App.actions.submitAddTenant(formId) }
          ]);
        },

        submitAddTenant: (formId) => {
          const form = App.utils.$(`#${formId}`);
          if (App.components.formValidator.validate(form)) {
            const formData = App.components.formValidator.getFormData(form);
            const apartment = App.state.apartments.find(apt => apt.id === formData.apartmentId);

            const newTenant = {
              id: App.utils.generateId(),
              name: formData.name,
              email: formData.email,
              phone: formData.phone || '',
              apartmentId: formData.apartmentId,
              apartmentName: apartment ? apartment.name : 'Tidak Diketahui',
              status: 'active', // Default status
              avatar: formData.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(formData.name)}&background=random`
            };
            App.state.tenants.unshift(newTenant); // Tambah ke awal array
            App.actions.updateDashboardStats();
            App.actions.filterTenants(App.state.searchTerm, App.state.filterApartment, 1); // Kembali ke halaman 1
            App.components.modal.close('addTenantModal');
            alert('Penyewa baru berhasil ditambahkan!');
          }
        },

        showEditTenantModal: (tenantId) => {
          App.state.editingTenantId = tenantId;
          const tenant = App.state.tenants.find(t => t.id === tenantId);
          if (!tenant) return;

          const formId = 'editTenantForm';
          const formHtml = `
                <form id="${formId}" novalidate>
                    <input type="hidden" name="id" value="${App.utils.sanitizeHTML(tenant.id)}">
                    <div class="form-group">
                        <label for="editTenantName" class="form-label">Nama Lengkap</label>
                        <input type="text" class="form-control" id="editTenantName" name="name" value="${App.utils.sanitizeHTML(tenant.name)}" required data-error-message="Nama lengkap wajib diisi.">
                        <div class="invalid-feedback"></div>
                    </div>
                    <div class="form-group">
                        <label for="editTenantEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="editTenantEmail" name="email" value="${App.utils.sanitizeHTML(tenant.email)}" required data-error-message="Email wajib diisi dan valid.">
                        <div class="invalid-feedback"></div>
                    </div>
                    <div class="form-group">
                        <label for="editTenantApartment" class="form-label">Apartemen</label>
                        <select class="form-select" id="editTenantApartment" name="apartmentId" required data-error-message="Pilih apartemen.">
                            ${App.state.apartments.map(apt => `<option value="${apt.id}" ${tenant.apartmentId === apt.id ? 'selected' : ''}>${App.utils.sanitizeHTML(apt.name)}</option>`).join('')}
                        </select>
                        <div class="invalid-feedback"></div>
                    </div>
                    <div class="form-group">
                        <label for="editTenantStatus" class="form-label">Status</label>
                        <select class="form-select" id="editTenantStatus" name="status">
                            <option value="active" ${tenant.status === 'active' ? 'selected' : ''}>Aktif</option>
                            <option value="inactive" ${tenant.status === 'inactive' ? 'selected' : ''}>Nonaktif</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editTenantAvatar" class="form-label">Foto Profil (URL)</label>
                        <input type="url" class="form-control" id="editTenantAvatar" name="avatar" value="${App.utils.sanitizeHTML(tenant.avatar || '')}" placeholder="https://example.com/image.jpg">
                    </div>
                </form>
            `;
          App.components.modal.open('editTenantModal', `Ubah Penyewa: ${App.utils.sanitizeHTML(tenant.name)}`, formHtml, [
            { text: 'Batal', class: 'btn-secondary', action: 'close' },
            { text: 'Simpan Perubahan', class: 'btn-primary', onClick: () => App.actions.submitEditTenant(formId) }
          ]);
        },

        submitEditTenant: (formId) => {
          const form = App.utils.$(`#${formId}`);
          if (App.components.formValidator.validate(form)) {
            const formData = App.components.formValidator.getFormData(form);
            const tenantIndex = App.state.tenants.findIndex(t => t.id === App.state.editingTenantId);
            if (tenantIndex > -1) {
              const apartment = App.state.apartments.find(apt => apt.id === formData.apartmentId);
              App.state.tenants[tenantIndex] = {
                ...App.state.tenants[tenantIndex],
                name: formData.name,
                email: formData.email,
                apartmentId: formData.apartmentId,
                apartmentName: apartment ? apartment.name : 'Tidak Diketahui',
                status: formData.status,
                avatar: formData.avatar || App.state.tenants[tenantIndex].avatar // Pertahankan avatar lama jika tidak diisi
              };
              App.actions.updateDashboardStats();
              App.actions.refreshTenantTable();
              App.components.modal.close('editTenantModal');
              alert('Data penyewa berhasil diperbarui!');
            }
            App.state.editingTenantId = null;
          }
        },

        showDeleteTenantModal: (tenantId) => {
          App.state.deletingTenantId = tenantId;
          const tenant = App.state.tenants.find(t => t.id === tenantId);
          if (!tenant) return;

          App.components.modal.open('deleteTenantModal', 'Konfirmasi Hapus Penyewa',
            `<p>Anda yakin ingin menghapus penyewa <strong>${App.utils.sanitizeHTML(tenant.name)}</strong>? Tindakan ini tidak dapat dibatalkan.</p>`,
            [
              { text: 'Batal', class: 'btn-secondary', action: 'close' },
              { text: 'Hapus Penyewa', class: 'btn-danger', onClick: App.actions.confirmDeleteTenant }
            ]
          );
        },

        confirmDeleteTenant: () => {
          App.state.tenants = App.state.tenants.filter(t => t.id !== App.state.deletingTenantId);
          App.actions.updateDashboardStats();
          App.actions.filterTenants(App.state.searchTerm, App.state.filterApartment); // Refresh tabel
          App.components.modal.close('deleteTenantModal');
          alert('Penyewa berhasil dihapus.');
          App.state.deletingTenantId = null;
        },

        // Penyaringan dan Paginasi Penyewa
        getFilteredTenants: () => {
          const { searchTerm, filterApartment } = App.state;
          let filtered = App.state.tenants;

          if (searchTerm) {
            const lowerSearchTerm = searchTerm.toLowerCase();
            filtered = filtered.filter(tenant =>
              tenant.name.toLowerCase().includes(lowerSearchTerm) ||
              tenant.email.toLowerCase().includes(lowerSearchTerm) ||
              tenant.id.toLowerCase().includes(lowerSearchTerm)
            );
          }
          if (filterApartment) {
            filtered = filtered.filter(tenant => tenant.apartmentId === filterApartment);
          }
          return filtered;
        },

        getPaginatedTenants: () => {
          const filteredTenants = App.actions.getFilteredTenants();
          App.state.pagination.totalItems = filteredTenants.length; // Update total item untuk paginasi

          const { currentPage, itemsPerPage } = App.state.pagination;
          const startIndex = (currentPage - 1) * itemsPerPage;
          const endIndex = startIndex + itemsPerPage;
          return filteredTenants.slice(startIndex, endIndex);
        },

        refreshTenantTable: () => {
          const tableBody = App.utils.$('#tenantTableBody');
          if (tableBody) {
            const paginatedTenants = App.actions.getPaginatedTenants();
            tableBody.innerHTML = paginatedTenants.map(App.templates.tenantRow).join('') || '<tr><td colspan="6" class="text-center p-4">Tidak ada data penyewa yang cocok.</td></tr>';
          }
          const paginationContainer = App.utils.$('#tenantPagination');
          if (paginationContainer) {
            const totalPages = Math.ceil(App.state.pagination.totalItems / App.state.pagination.itemsPerPage);
            paginationContainer.innerHTML = App.templates.pagination(App.state.pagination.currentPage, totalPages);
          }
        },

        filterTenants: (searchTerm, filterApartment, newPage = 1) => {
          App.state.searchTerm = searchTerm;
          App.state.filterApartment = filterApartment;
          App.state.pagination.currentPage = newPage; // Reset ke halaman pertama saat filter berubah
          App.actions.refreshTenantTable();
        },

        changeTenantPage: (page) => {
          const totalPages = Math.ceil(App.state.pagination.totalItems / App.state.pagination.itemsPerPage);
          if (page >= 1 && page <= totalPages) {
            App.state.pagination.currentPage = page;
            App.actions.refreshTenantTable();
          }
        },

        // Fungsi untuk Akun Pengguna
        showAccountInfoModal: () => {
          const user = App.state.currentUser;
          const formId = 'accountInfoForm';
          const content = `
                <form id="${formId}">
                    <div class="text-center mb-4">
                        <img src="${App.utils.sanitizeHTML(user.avatar)}" class="rounded-circle shadow-sm" width="100" height="100" alt="Foto Profil ${App.utils.sanitizeHTML(user.name)}" />
                        <div class="mt-2">
                            <button type="button" class="btn btn-sm btn-outline-primary" id="changePictureButton">Ganti Foto</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="accFullName">Nama Lengkap</label>
                        <input type="text" class="form-control" id="accFullName" name="fullName" value="${App.utils.sanitizeHTML(user.name)}" required>
                        <div class="invalid-feedback"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="accEmail">Email</label>
                        <input type="email" class="form-control" id="accEmail" name="email" value="${App.utils.sanitizeHTML(user.email)}" required>
                        <div class="invalid-feedback"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="accPhone">Telepon (Opsional)</label>
                        <input type="tel" class="form-control" id="accPhone" name="phone" value="${App.utils.sanitizeHTML(user.phone || '')}">
                    </div>
                </form>
            `;
          const modal = App.components.modal.open('accountInfoModal', 'Informasi Akun', content, [
            { text: 'Tutup', class: 'btn-secondary', action: 'close' },
            { text: 'Simpan Perubahan', class: 'btn-primary', onClick: () => App.actions.saveAccountInfo(formId) }
          ]);

          // Event listener untuk tombol ganti foto (dummy)
          App.utils.$('#changePictureButton', modal).addEventListener('click', () => {
            const newAvatarUrl = prompt("Masukkan URL gambar profil baru:", user.avatar);
            if (newAvatarUrl) {
              App.utils.$('img', modal).src = App.utils.sanitizeHTML(newAvatarUrl);
              // Di aplikasi nyata, ini akan mengupload file atau menyimpan URL
            }
          });
        },

        saveAccountInfo: (formId) => {
          const form = App.utils.$(`#${formId}`);
          if (App.components.formValidator.validate(form)) {
            const formData = App.components.formValidator.getFormData(form);
            App.state.currentUser.name = formData.fullName;
            App.state.currentUser.email = formData.email;
            App.state.currentUser.phone = formData.phone;
            App.state.currentUser.avatar = App.utils.$('#accountInfoModal img').src; // Ambil dari preview jika diubah

            // Update nama di navbar jika perlu (misalnya jika ditampilkan)
            App.utils.$('.navbar-brand span').textContent = `Rentify Apartment Rental`; // Bisa ditambahkan nama user jika mau

            App.components.modal.close('accountInfoModal');
            alert('Informasi akun berhasil diperbarui!');
          }
        },

        showSecurityModal: () => {
          const formId = 'securityForm';
          const content = `
                <form id="${formId}">
                    <div class="form-group">
                        <label class="form-label" for="secCurrentPassword">Kata Sandi Saat Ini</label>
                        <input type="password" class="form-control" id="secCurrentPassword" name="currentPassword" required>
                        <div class="invalid-feedback"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="secNewPassword">Kata Sandi Baru</label>
                        <input type="password" class="form-control" id="secNewPassword" name="newPassword" required>
                        <div class="invalid-feedback"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="secConfirmPassword">Konfirmasi Kata Sandi Baru</label>
                        <input type="password" class="form-control" id="secConfirmPassword" name="confirmPassword" required>
                        <div class="invalid-feedback"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Autentikasi Dua Faktor (2FA)</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="twoFactorAuth" name="twoFactorAuth" ${App.state.currentUser.twoFactorEnabled ? 'checked' : ''}>
                            <label class="form-check-label" for="twoFactorAuth">Aktifkan 2FA</label>
                        </div>
                    </div>
                </form>
            `;
          App.components.modal.open('securityModal', 'Pengaturan Keamanan', content, [
            { text: 'Tutup', class: 'btn-secondary', action: 'close' },
            { text: 'Simpan Pengaturan', class: 'btn-primary', onClick: () => App.actions.saveSecuritySettings(formId) }
          ]);
        },

        saveSecuritySettings: (formId) => {
          const form = App.utils.$(`#${formId}`);
          if (App.components.formValidator.validate(form)) {
            const formData = App.components.formValidator.getFormData(form);
            // Validasi kata sandi baru & konfirmasi
            if (formData.newPassword && formData.newPassword !== formData.confirmPassword) {
              alert('Konfirmasi kata sandi baru tidak cocok!');
              App.utils.$('#secConfirmPassword', form).classList.add('is-invalid');
              const feedback = App.utils.$('#secConfirmPassword', form).parentElement.querySelector('.invalid-feedback');
              if (feedback) {
                feedback.textContent = 'Konfirmasi kata sandi baru tidak cocok!';
                feedback.style.display = 'block';
              }
              return;
            }
            // Logika untuk mengganti kata sandi (di aplikasi nyata, ini akan memanggil API)
            console.log("Mengganti kata sandi (simulasi):", formData.currentPassword, formData.newPassword);
            App.state.currentUser.twoFactorEnabled = form.elements.twoFactorAuth.checked;
            App.components.modal.close('securityModal');
            alert('Pengaturan keamanan berhasil diperbarui!');
          }
        },

        logout: () => {
          if (confirm('Anda yakin ingin keluar dari aplikasi?')) {
            console.log('Pengguna keluar...');
            // Di aplikasi nyata, ini akan menghapus token sesi, dll.
            // Untuk SPA ini, kita bisa kembali ke halaman "login" (jika ada) atau refresh.
            // Untuk demo, kita hanya log dan mungkin reset state.
            App.state.currentUser = null; // Hapus info user
            alert('Anda telah berhasil keluar.');
            // Arahkan ke halaman login (jika ada, misal login.html, atau route #login)
            // window.location.href = "login.html"; // Jika login halaman terpisah
            App.router.navigate('#dashboard'); // Atau kembali ke dashboard (dalam konteks SPA tanpa login page)
            // Idealnya, jika ada sistem login, ini akan redirect ke halaman login.
          }
        }
      },

      // INISIALISASI APLIKASI
      init: () => {
        console.log('Rentify App Initializing...');
        // Setup tahun di footer
        App.utils.$('#currentYear').textContent = new Date().getFullYear();

        // Muat data awal
        App.actions.loadInitialData();

        // Inisialisasi komponen
        App.components.dropdown.init();

        // Inisialisasi router dan definisikan rute
        App.router.init();
        App.router.add('#dashboard', App.views.dashboard);
        App.router.add('#tenants', App.views.tenants);
        App.router.add('#settings', App.views.settings);
        // Tambahkan rute lain di sini (misal: #apartments, #payments)

        // Event listener global untuk modal triggers dari atribut data-modal-target
        document.body.addEventListener('click', (event) => {
          const modalTrigger = event.target.closest('[data-modal-target]');
          if (modalTrigger) {
            event.preventDefault();
            const targetModalId = modalTrigger.dataset.modalTarget;
            if (targetModalId === 'accountInfoModal') App.actions.showAccountInfoModal();
            else if (targetModalId === 'securityModal') App.actions.showSecurityModal();
            // Tambahkan handler untuk modal lain jika ada
          }
        });

        // Event listener untuk tombol logout
        const logoutButton = App.utils.$('#logoutButton');
        if (logoutButton) {
          logoutButton.addEventListener('click', (e) => {
            e.preventDefault();
            App.actions.logout();
          });
        }

        // Navigasi ke rute awal berdasarkan hash URL atau default ke dashboard
        const initialPath = window.location.hash || '#dashboard';
        App.router.navigate(initialPath);

        console.log('Rentify App Ready.');
      }
    };

    // Mulai aplikasi saat DOM telah sepenuhnya dimuat dan di-parse
    document.addEventListener('DOMContentLoaded', App.init);

  </script>
</body>

</html>