<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistem Manajemen Rental Apartemen</title>
  <meta name="description" content="Aplikasi web untuk manajemen permohonan rental apartemen.">

  <!-- Preload Google Fonts untuk kinerja -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preload" as="style"
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"
    media="print" onload="this.media='all'">
  <noscript>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  </noscript>

  <!-- Ikon Bootstrap (CDN) -->
  <link rel="preload" as="style"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    media="print" onload="this.media='all'">
  <noscript>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  </noscript>

  <style>
    /* ======== AWAL DARI STYLE SHEET UTAMA ======== */

    /*
     * SISTEM DESAIN DASAR
     * Variabel CSS untuk konsistensi tema, tipografi, spasi, bayangan, dll.
     * Mengikuti prinsip desain modular dan mudah dikelola.
     */
    :root {
      /* Palet Warna Semantik HSL - Lebih mudah memanipulasi lightness/saturation */
      --color-primary-h: 221;
      --color-primary-s: 83%;
      --color-primary-l: 56%;
      --color-primary: hsl(var(--color-primary-h), var(--color-primary-s), var(--color-primary-l));
      /* Biru Tua */
      --color-primary-light: hsl(var(--color-primary-h), var(--color-primary-s), 66%);
      --color-primary-dark: hsl(var(--color-primary-h), var(--color-primary-s), 46%);
      --color-primary-hover: hsl(var(--color-primary-h), var(--color-primary-s), 50%);

      --color-accent-h: 28;
      --color-accent-s: 90%;
      --color-accent-l: 62%;
      --color-accent: hsl(var(--color-accent-h), var(--color-accent-s), var(--color-accent-l));
      /* Oranye */

      --color-success-h: 145;
      --color-success-s: 63%;
      --color-success-l: 42%;
      --color-success: hsl(var(--color-success-h), var(--color-success-s), var(--color-success-l));
      /* Hijau */

      --color-danger-h: 0;
      --color-danger-s: 79%;
      --color-danger-l: 51%;
      --color-danger: hsl(var(--color-danger-h), var(--color-danger-s), var(--color-danger-l));
      /* Merah */

      --color-warning-h: 45;
      --color-warning-s: 100%;
      --color-warning-l: 51%;
      --color-warning: hsl(var(--color-warning-h), var(--color-warning-s), var(--color-warning-l));
      /* Kuning */

      --color-info-h: 198;
      --color-info-s: 93%;
      --color-info-l: 48%;
      --color-info: hsl(var(--color-info-h), var(--color-info-s), var(--color-info-l));
      /* Biru Muda */

      --color-text-main: hsl(215, 25%, 20%);
      /* Abu-abu Tua Kebiruan */
      --color-text-muted: hsl(215, 15%, 45%);
      --color-text-inverse: hsl(0, 0%, 100%);
      --color-text-disabled: hsl(215, 10%, 65%);

      --color-surface: hsl(0, 0%, 100%);
      /* Putih */
      --color-background: hsl(220, 30%, 96%);
      /* Abu-abu Sangat Muda */
      --color-border: hsl(220, 20%, 88%);
      --color-border-focus: var(--color-primary-light);
      --color-input-background: hsl(0, 0%, 100%);

      /* Tipografi - Skala Modular */
      --font-family-main: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      --font-size-base: 1rem;
      /* 16px default */
      --font-size-xs: 0.75rem;
      /* 12px */
      --font-size-sm: 0.875rem;
      /* 14px */
      --font-size-md: 1.125rem;
      /* 18px */
      --font-size-lg: 1.25rem;
      /* 20px */
      --font-size-xl: 1.5rem;
      /* 24px */
      --font-size-xxl: 2rem;
      /* 32px */
      --line-height-base: 1.6;

      /* Skala Spasi - Konsisten */
      --space-unit: 1rem;
      --space-xxs: calc(var(--space-unit) * 0.25);
      /* 4px */
      --space-xs: calc(var(--space-unit) * 0.5);
      /* 8px */
      --space-sm: calc(var(--space-unit) * 0.75);
      /* 12px */
      --space-md: var(--space-unit);
      /* 16px */
      --space-lg: calc(var(--space-unit) * 1.5);
      /* 24px */
      --space-xl: calc(var(--space-unit) * 2);
      /* 32px */
      --space-xxl: calc(var(--space-unit) * 3);
      /* 48px */

      /* Radius Sudut */
      --radius-xs: 0.25rem;
      /* 4px */
      --radius-sm: 0.375rem;
      /* 6px */
      --radius-md: 0.5rem;
      /* 8px */
      --radius-lg: 0.75rem;
      /* 12px */
      --radius-full: 9999px;

      /* Bayangan (Shadows) - Subtle dan Modern */
      --shadow-color: 220 60% 15%;
      /* HSL base for shadows */
      --shadow-xs: 0 1px 2px 0 hsl(var(--shadow-color) / 0.03);
      --shadow-sm: 0 2px 4px -1px hsl(var(--shadow-color) / 0.05), 0 1px 2px -1px hsl(var(--shadow-color) / 0.04);
      --shadow-md: 0 4px 8px -2px hsl(var(--shadow-color) / 0.08), 0 2px 4px -2px hsl(var(--shadow-color) / 0.05);
      --shadow-lg: 0 10px 20px -5px hsl(var(--shadow-color) / 0.1), 0 4px 8px -4px hsl(var(--shadow-color) / 0.06);
      --shadow-xl: 0 20px 40px -10px hsl(var(--shadow-color) / 0.15), 0 8px 16px -8px hsl(var(--shadow-color) / 0.08);

      /* Transisi */
      --transition-duration: 0.2s;
      --transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      --transition-base: all var(--transition-duration) var(--transition-timing-function);

      /* Breakpoints Responsif */
      --breakpoint-sm: 576px;
      --breakpoint-md: 768px;
      --breakpoint-lg: 992px;
      --breakpoint-xl: 1200px;
      --breakpoint-xxl: 1400px;

      /* Z-index Layering */
      --z-index-dropdown: 1000;
      --z-index-sticky: 1020;
      --z-index-modal-backdrop: 1040;
      --z-index-modal: 1050;
      --z-index-popover: 1060;
      --z-index-tooltip: 1070;
      --z-index-toast: 1090;
    }

    /* ======== AKHIR DARI SISTEM DESAIN DASAR ======== */


    /* ======== AWAL DARI RESET DAN NORMALISASI DASAR ======== */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      font-size: var(--font-size-base);
      line-height: var(--line-height-base);
      -webkit-text-size-adjust: 100%;
      scroll-behavior: smooth;
      height: 100%;
      /* Memastikan html mengisi tinggi viewport */
    }

    body {
      font-family: var(--font-family-main);
      background-color: var(--color-background);
      color: var(--color-text-main);
      min-height: 100%;
      /* Menggunakan min-height 100% */
      display: flex;
      flex-direction: column;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    img,
    picture,
    video,
    canvas {
      /* SVG dikecualikan sesuai permintaan */
      display: block;
      max-width: 100%;
    }

    button,
    input,
    select,
    textarea {
      font: inherit;
      border: none;
      outline: none;
      color: inherit;
      /* Memastikan warna teks terwarisi dengan benar */
    }

    button {
      cursor: pointer;
      background: none;
    }

    a {
      color: var(--color-primary);
      text-decoration: none;
      transition: color var(--transition-duration) ease-in-out;
    }

    a:hover {
      color: var(--color-primary-hover);
      text-decoration: underline;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-weight: 700;
      line-height: 1.2;
      color: var(--color-text-main);
      margin-top: 0;
      /* Reset margin atas heading */
    }

    h1 {
      font-size: var(--font-size-xxl);
      margin-bottom: var(--space-lg);
    }

    h2 {
      font-size: var(--font-size-xl);
      margin-bottom: var(--space-md);
    }

    h3 {
      font-size: var(--font-size-lg);
      margin-bottom: var(--space-sm);
    }

    h4 {
      font-size: var(--font-size-md);
      margin-bottom: var(--space-xs);
    }

    p {
      margin-bottom: var(--space-md);
      margin-top: 0;
    }

    ul,
    ol {
      list-style-position: inside;
      padding-left: var(--space-md);
      margin-bottom: var(--space-md);
      /* Tambahkan margin bawah untuk list */
    }

    /* Aksesibilitas: Preferensi reduce motion */
    @media (prefers-reduced-motion: reduce) {
      html {
        scroll-behavior: auto;
      }

      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }

    /* Aksesibilitas: Focus visible yang lebih jelas */
    :focus-visible {
      outline: 3px solid var(--color-primary);
      outline-offset: 2px;
      box-shadow: 0 0 0 5px hsla(var(--color-primary-h), var(--color-primary-s), var(--color-primary-l), 0.3);
      border-radius: var(--radius-xs);
    }

    /* Khusus untuk input agar focus-visible tidak terlalu tebal */
    input:focus-visible,
    select:focus-visible,
    textarea:focus-visible {
      outline-offset: 1px;
      box-shadow: 0 0 0 3px hsla(var(--color-primary-h), var(--color-primary-s), var(--color-primary-l), 0.25);
    }


    /* ======== AKHIR DARI RESET DAN NORMALISASI DASAR ======== */


    /* ======== AWAL DARI KELAS UTILITAS ======== */
    .container {
      width: 100%;
      max-width: var(--breakpoint-xl);
      margin-left: auto;
      margin-right: auto;
      padding-left: var(--space-md);
      padding-right: var(--space-md);
    }

    .visually-hidden {
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0, 0, 0, 0) !important;
      white-space: nowrap !important;
      border: 0 !important;
    }

    .d-flex {
      display: flex !important;
    }

    .flex-column {
      flex-direction: column !important;
    }

    .flex-row {
      flex-direction: row !important;
    }

    .justify-content-start {
      justify-content: flex-start !important;
    }

    .justify-content-end {
      justify-content: flex-end !important;
    }

    .justify-content-center {
      justify-content: center !important;
    }

    .justify-content-between {
      justify-content: space-between !important;
    }

    .align-items-start {
      align-items: flex-start !important;
    }

    .align-items-end {
      align-items: flex-end !important;
    }

    .align-items-center {
      align-items: center !important;
    }

    .align-items-stretch {
      align-items: stretch !important;
    }

    .gap-xxs {
      gap: var(--space-xxs) !important;
    }

    .gap-xs {
      gap: var(--space-xs) !important;
    }

    .gap-sm {
      gap: var(--space-sm) !important;
    }

    .gap-md {
      gap: var(--space-md) !important;
    }

    .gap-lg {
      gap: var(--space-lg) !important;
    }

    .gap-xl {
      gap: var(--space-xl) !important;
    }

    .w-100 {
      width: 100% !important;
    }

    .h-100 {
      height: 100% !important;
    }

    .text-center {
      text-align: center !important;
    }

    .text-left {
      text-align: left !important;
    }

    .text-right {
      text-align: right !important;
    }

    /* Margin utilities */
    .m-0 {
      margin: 0 !important;
    }

    .mt-0 {
      margin-top: 0 !important;
    }

    .mb-0 {
      margin-bottom: 0 !important;
    }

    .ms-0 {
      margin-left: 0 !important;
    }

    /* Menggunakan ms (margin-start) dan me (margin-end) untuk dukungan LTR/RTL */
    .me-0 {
      margin-right: 0 !important;
    }

    .mt-xs {
      margin-top: var(--space-xs) !important;
    }

    .mb-xs {
      margin-bottom: var(--space-xs) !important;
    }

    /* ... tambahkan variasi lain jika perlu */
    .mt-sm {
      margin-top: var(--space-sm) !important;
    }

    .mb-sm {
      margin-bottom: var(--space-sm) !important;
    }

    .mt-md {
      margin-top: var(--space-md) !important;
    }

    .mb-md {
      margin-bottom: var(--space-md) !important;
    }

    .mt-lg {
      margin-top: var(--space-lg) !important;
    }

    .mb-lg {
      margin-bottom: var(--space-lg) !important;
    }

    /* Padding utilities */
    .p-0 {
      padding: 0 !important;
    }

    .pt-0 {
      padding-top: 0 !important;
    }

    .pb-0 {
      padding-bottom: 0 !important;
    }

    /* ... tambahkan variasi lain jika perlu */
    .p-xs {
      padding: var(--space-xs) !important;
    }

    .p-sm {
      padding: var(--space-sm) !important;
    }

    .p-md {
      padding: var(--space-md) !important;
    }

    .p-lg {
      padding: var(--space-lg) !important;
    }

    .text-muted {
      color: var(--color-text-muted) !important;
    }

    .text-success {
      color: var(--color-success) !important;
    }

    .text-danger {
      color: var(--color-danger) !important;
    }

    .text-warning {
      color: var(--color-warning) !important;
    }

    .text-primary {
      color: var(--color-primary) !important;
    }

    .text-inverse {
      color: var(--color-text-inverse) !important;
    }

    /* ======== AKHIR DARI KELAS UTILITAS ======== */


    /* ======== AWAL DARI KOMPONEN SPESIFIK APLIKASI ======== */

    /* --- Header / Navbar --- */
    .app-header {
      background: linear-gradient(90deg, var(--color-primary-dark), var(--color-primary));
      color: var(--color-text-inverse);
      padding: var(--space-sm) 0;
      box-shadow: var(--shadow-md);
      position: sticky;
      top: 0;
      z-index: var(--z-index-sticky);
    }

    .app-header .container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .navbar-brand {
      font-size: var(--font-size-lg);
      font-weight: 700;
      color: var(--color-text-inverse);
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      text-decoration: none;
      /* Hapus underline default link */
    }

    .navbar-brand:hover {
      color: var(--color-text-inverse);
      /* Jaga warna saat hover */
      text-decoration: none;
    }

    .navbar-brand .bi {
      font-size: var(--font-size-xl);
      vertical-align: middle;
    }

    .navbar-nav {
      display: flex;
      gap: var(--space-xs);
      list-style: none;
      /* Hapus bullet list */
      padding-left: 0;
      /* Hapus padding kiri default ul */
      margin-bottom: 0;
      /* Hapus margin bawah default ul */
    }

    .nav-link {
      color: var(--color-text-inverse);
      opacity: 0.85;
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-sm);
      transition: var(--transition-base);
      font-weight: 500;
      text-decoration: none;
      display: inline-flex;
      /* Agar ikon dan teks sejajar */
      align-items: center;
    }

    .nav-link:hover,
    .nav-link.active {
      opacity: 1;
      background-color: hsla(0, 0%, 100%, 0.15);
      text-decoration: none;
    }

    .nav-link .bi {
      margin-right: var(--space-xs);
      vertical-align: text-bottom;
      font-size: 1.1em;
    }

    .navbar-toggler {
      display: none;
      padding: var(--space-xs);
      font-size: var(--font-size-xl);
      /* Perbesar ikon toggler */
      border-radius: var(--radius-sm);
      background: transparent;
      border: 1px solid transparent;
      /* Hilangkan border default button */
    }

    .navbar-toggler:hover {
      background-color: hsla(0, 0%, 100%, 0.1);
    }

    .navbar-toggler .bi {
      vertical-align: middle;
      /* Sejajarkan ikon di tengah */
    }

    /* --- Main Content Area --- */
    .app-main {
      flex-grow: 1;
      padding-top: var(--space-lg);
      padding-bottom: var(--space-lg);
    }

    /* --- Kartu (Card) --- */
    .card {
      background-color: var(--color-surface);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      margin-bottom: var(--space-lg);
      overflow: hidden;
      transition: box-shadow var(--transition-duration) ease-in-out;
      display: flex;
      /* Untuk flex-direction column */
      flex-direction: column;
    }

    .card:hover {
      box-shadow: var(--shadow-md);
    }

    .card-header {
      padding: var(--space-md) var(--space-lg);
      border-bottom: 1px solid var(--color-border);
      font-size: var(--font-size-md);
      font-weight: 600;
    }

    .card-header>*:last-child {
      /* Menghilangkan margin bottom pada elemen terakhir di header */
      margin-bottom: 0;
    }

    .card-body {
      padding: var(--space-lg);
      flex-grow: 1;
      /* Agar body mengisi ruang jika card punya tinggi tetap */
    }

    .card-body>*:last-child {
      margin-bottom: 0;
    }

    .card-footer {
      padding: var(--space-md) var(--space-lg);
      border-top: 1px solid var(--color-border);
      background-color: hsl(0, 0%, 98%);
    }

    .card-footer>*:last-child {
      margin-bottom: 0;
    }

    /* --- Statistik Dashboard --- */
    .dashboard-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      /* Ukuran minmax disesuaikan */
      gap: var(--space-lg);
      /* Gap lebih besar */
    }

    .stats-card {
      background-color: var(--color-surface);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      text-align: center;
      box-shadow: var(--shadow-xs);
      transition: var(--transition-base);
      cursor: default;
      border: 1px solid var(--color-border);
      /* Tambah border halus */
    }

    .stats-card:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: var(--shadow-md);
    }

    .stats-icon {
      font-size: var(--font-size-xxl);
      margin-bottom: var(--space-md);
      /* Spasi lebih besar */
      color: var(--color-primary);
    }

    .stats-card.text-warning .stats-icon {
      color: var(--color-warning);
    }

    .stats-card.text-success .stats-icon {
      color: var(--color-success);
    }

    .stats-card.text-danger .stats-icon {
      color: var(--color-danger);
    }

    .stats-card h3 {
      font-size: var(--font-size-xl);
      font-weight: 700;
      margin: 0 0 var(--space-xs) 0;
      color: var(--color-text-main);
    }

    .stats-card p {
      font-size: var(--font-size-sm);
      color: var(--color-text-muted);
      margin-bottom: 0;
    }


    /* --- Form Elemen --- */
    .form-group {
      margin-bottom: var(--space-md);
    }

    .form-label {
      display: block;
      font-weight: 600;
      color: var(--color-text-main);
      margin-bottom: var(--space-xs);
      font-size: var(--font-size-sm);
    }

    .form-control,
    .form-select {
      display: block;
      width: 100%;
      padding: var(--space-sm) var(--space-md);
      font-size: var(--font-size-base);
      line-height: var(--line-height-base);
      color: var(--color-text-main);
      background-color: var(--color-input-background);
      background-clip: padding-box;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      transition: border-color var(--transition-duration) ease-in-out, box-shadow var(--transition-duration) ease-in-out;
    }

    .form-control:disabled,
    .form-select:disabled {
      background-color: var(--color-background);
      opacity: 0.7;
      cursor: not-allowed;
    }

    .form-control:focus,
    .form-select:focus {
      border-color: var(--color-border-focus);
      outline: 0;
      box-shadow: 0 0 0 0.2rem hsla(var(--color-primary-h), var(--color-primary-s), var(--color-primary-l), 0.25);
    }

    .form-control::placeholder {
      color: var(--color-text-disabled);
      opacity: 1;
    }

    /* Styling untuk input search */
    input[type="search"] {
      appearance: none;
      /* Hapus styling default browser */
      -webkit-appearance: none;
    }

    input[type="search"]::-webkit-search-decoration,
    input[type="search"]::-webkit-search-cancel-button,
    input[type="search"]::-webkit-search-results-button,
    input[type="search"]::-webkit-search-results-decoration {
      display: none;
      /* Sembunyikan ikon X bawaan di Chrome/Safari */
    }


    textarea.form-control {
      min-height: calc(var(--line-height-base) * 3em + var(--space-sm) * 2 + 2px);
      resize: vertical;
    }

    .invalid-feedback {
      display: none;
      /* Sembunyikan default */
      width: 100%;
      margin-top: var(--space-xxs);
      font-size: var(--font-size-xs);
      color: var(--color-danger);
    }

    .form-control.is-invalid,
    .form-select.is-invalid {
      border-color: var(--color-danger);
    }

    .form-control.is-invalid:focus,
    .form-select.is-invalid:focus {
      border-color: var(--color-danger);
      box-shadow: 0 0 0 0.2rem hsla(var(--color-danger-h), var(--color-danger-s), var(--color-danger-l), 0.25);
    }

    .form-control.is-invalid~.invalid-feedback,
    .form-select.is-invalid~.invalid-feedback {
      display: block;
      /* Tampilkan jika ada kelas is-invalid */
    }

    /* --- Tombol (Button) --- */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: var(--space-sm) var(--space-lg);
      font-size: var(--font-size-base);
      font-weight: 500;
      line-height: var(--line-height-base);
      text-align: center;
      vertical-align: middle;
      cursor: pointer;
      user-select: none;
      border: 1px solid transparent;
      border-radius: var(--radius-sm);
      transition: var(--transition-base);
      box-shadow: var(--shadow-xs);
      text-decoration: none;
      /* Pastikan tidak ada underline pada button */
    }

    .btn:hover {
      text-decoration: none;
      box-shadow: var(--shadow-sm);
      transform: translateY(-1px);
    }

    .btn:active {
      transform: translateY(0px);
      box-shadow: var(--shadow-xs);
    }

    .btn:disabled,
    .btn.disabled {
      opacity: 0.65;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .btn .bi {
      margin-right: var(--space-xs);
      font-size: 1.1em;
      line-height: 1;
      /* Jaga agar ikon tidak mempengaruhi tinggi tombol */
    }

    .btn .bi:only-child {
      /* Jika hanya ada ikon, hapus margin */
      margin-right: 0;
    }

    .btn-sm {
      padding: var(--space-xs) var(--space-sm);
      font-size: var(--font-size-sm);
    }

    .btn-sm .bi {
      font-size: 1em;
    }

    .btn-lg {
      padding: var(--space-md) var(--space-xl);
      font-size: var(--font-size-lg);
    }

    .btn-lg .bi {
      font-size: 1.2em;
    }


    .btn-primary {
      color: var(--color-text-inverse);
      background-color: var(--color-primary);
      border-color: var(--color-primary);
    }

    .btn-primary:hover {
      background-color: var(--color-primary-hover);
      border-color: var(--color-primary-hover);
      color: var(--color-text-inverse);
    }

    .btn-secondary {
      color: var(--color-text-main);
      background-color: hsl(220, 15%, 90%);
      border-color: hsl(220, 15%, 85%);
    }

    .btn-secondary:hover {
      background-color: hsl(220, 15%, 85%);
      border-color: hsl(220, 15%, 80%);
      color: var(--color-text-main);
    }

    .btn-success {
      color: var(--color-text-inverse);
      background-color: var(--color-success);
      border-color: var(--color-success);
    }

    .btn-success:hover {
      background-color: hsl(var(--color-success-h), var(--color-success-s), calc(var(--color-success-l) - 5%));
      border-color: hsl(var(--color-success-h), var(--color-success-s), calc(var(--color-success-l) - 5%));
      color: var(--color-text-inverse);
    }

    .btn-danger {
      color: var(--color-text-inverse);
      background-color: var(--color-danger);
      border-color: var(--color-danger);
    }

    .btn-danger:hover {
      background-color: hsl(var(--color-danger-h), var(--color-danger-s), calc(var(--color-danger-l) - 5%));
      border-color: hsl(var(--color-danger-h), var(--color-danger-s), calc(var(--color-danger-l) - 5%));
      color: var(--color-text-inverse);
    }

    .btn-warning {
      color: var(--color-text-main);
      background-color: var(--color-warning);
      border-color: var(--color-warning);
    }

    .btn-warning:hover {
      background-color: hsl(var(--color-warning-h), var(--color-warning-s), calc(var(--color-warning-l) - 5%));
      border-color: hsl(var(--color-warning-h), var(--color-warning-s), calc(var(--color-warning-l) - 5%));
      color: var(--color-text-main);
    }

    .btn-info {
      color: var(--color-text-inverse);
      background-color: var(--color-info);
      border-color: var(--color-info);
    }

    .btn-info:hover {
      background-color: hsl(var(--color-info-h), var(--color-info-s), calc(var(--color-info-l) - 5%));
      border-color: hsl(var(--color-info-h), var(--color-info-s), calc(var(--color-info-l) - 5%));
      color: var(--color-text-inverse);
    }

    .btn-group {
      display: inline-flex;
    }

    .btn-group .btn {
      border-radius: 0;
    }

    .btn-group .btn:not(:last-child) {
      margin-right: -1px;
    }

    .btn-group .btn:first-child {
      border-top-left-radius: var(--radius-sm);
      border-bottom-left-radius: var(--radius-sm);
    }

    .btn-group .btn:last-child {
      border-top-right-radius: var(--radius-sm);
      border-bottom-right-radius: var(--radius-sm);
    }


    /* --- Tabel --- */
    .table-responsive {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-xs);
      margin-bottom: var(--space-lg);
      /* Tambahkan margin bawah */
    }

    .table {
      width: 100%;
      margin-bottom: 0;
      border-collapse: collapse;
      background-color: var(--color-surface);
    }

    .table th,
    .table td {
      padding: var(--space-sm) var(--space-md);
      vertical-align: middle;
      text-align: left;
      border-bottom: 1px solid var(--color-border);
      line-height: var(--line-height-base);
    }

    .table thead th {
      font-weight: 600;
      background-color: hsl(220, 30%, 97%);
      color: var(--color-text-main);
      border-bottom-width: 2px;
      white-space: nowrap;
      /* Agar header tidak wrap */
    }

    .table tbody tr:last-child td {
      border-bottom: none;
    }

    .table-hover tbody tr:hover {
      background-color: hsla(var(--color-primary-h), var(--color-primary-s), 95%, 0.5);
      transition: background-color 0.15s ease-in-out;
    }

    .table .action-buttons .btn {
      padding: var(--space-xs);
      font-size: var(--font-size-sm);
    }

    .table .action-buttons .btn .bi {
      margin-right: 0;
      font-size: 1.2em;
      /* Sedikit lebih besar untuk visibilitas */
    }

    .table .action-buttons {
      display: flex;
      gap: var(--space-xs);
      flex-wrap: nowrap;
      justify-content: center;
      /* Tengahlan tombol aksi */
    }

    .empty-state {
      /* Styling untuk pesan tabel kosong */
      padding: var(--space-xl);
      text-align: center;
      color: var(--color-text-muted);
    }

    .empty-state .bi {
      font-size: 3rem;
      margin-bottom: var(--space-sm);
      color: var(--color-text-disabled);
    }

    /* --- Status Badge --- */
    .status-badge {
      display: inline-block;
      padding: var(--space-xxs) var(--space-sm);
      font-size: var(--font-size-xs);
      font-weight: 600;
      line-height: 1.2;
      /* Perbaiki line-height */
      text-align: center;
      white-space: nowrap;
      vertical-align: baseline;
      border-radius: var(--radius-full);
      text-transform: capitalize;
      border: 1px solid transparent;
      /* Untuk konsistensi */
    }

    .status-badge.status-pending {
      background-color: hsl(var(--color-warning-h), var(--color-warning-s), calc(var(--color-warning-l) + 30%));
      color: hsl(var(--color-warning-h), var(--color-warning-s), calc(var(--color-warning-l) - 20%));
      border-color: hsl(var(--color-warning-h), var(--color-warning-s), calc(var(--color-warning-l) + 10%));
    }

    .status-badge.status-approved {
      background-color: hsl(var(--color-success-h), var(--color-success-s), calc(var(--color-success-l) + 35%));
      color: hsl(var(--color-success-h), var(--color-success-s), calc(var(--color-success-l) - 15%));
      border-color: hsl(var(--color-success-h), var(--color-success-s), calc(var(--color-success-l) + 15%));
    }

    .status-badge.status-rejected {
      background-color: hsl(var(--color-danger-h), var(--color-danger-s), calc(var(--color-danger-l) + 30%));
      color: hsl(var(--color-danger-h), var(--color-danger-s), calc(var(--color-danger-l) - 10%));
      border-color: hsl(var(--color-danger-h), var(--color-danger-s), calc(var(--color-danger-l) + 10%));
    }

    .status-badge.status-default {
      background-color: hsl(215, 15%, 90%);
      color: hsl(215, 15%, 40%);
      border-color: hsl(215, 15%, 80%);
    }


    /* --- Modal (Jendela Pop-up) --- */
    .modal {
      display: none;
      /* Diubah ke flex oleh JS */
      position: fixed;
      z-index: var(--z-index-modal);
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow-y: auto;
      /* Hanya scroll vertikal pada backdrop */
      background-color: hsla(0, 0%, 0%, 0.5);
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition-duration) ease-in-out, visibility 0s var(--transition-duration) linear;
      align-items: center;
      /* Vertikal centering */
      justify-content: center;
      /* Horizontal centering */
      padding: var(--space-md);
      /* Beri padding agar modal tidak menempel tepi layar kecil */
    }

    .modal.is-open {
      display: flex;
      opacity: 1;
      visibility: visible;
      transition-delay: 0s;
    }

    .modal-dialog {
      background-color: var(--color-surface);
      margin: auto;
      padding: 0;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-xl);
      width: 100%;
      /* Agar responsif di layar kecil */
      max-width: 600px;
      transform: scale(0.95) translateY(-20px);
      transition: transform var(--transition-duration) var(--transition-timing-function);
      overflow: hidden;
      /* Penting untuk border-radius anak */
      display: flex;
      /* Untuk struktur internal modal */
      flex-direction: column;
      max-height: calc(100vh - (var(--space-md) * 2));
      /* Batasi tinggi modal */
    }

    .modal.is-open .modal-dialog {
      transform: scale(1) translateY(0);
    }

    .modal-dialog-lg {
      max-width: 800px;
    }

    .modal-dialog-sm {
      max-width: 400px;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-md) var(--space-lg);
      border-bottom: 1px solid var(--color-border);
      flex-shrink: 0;
      /* Agar header tidak mengecil */
    }

    .modal-title {
      font-size: var(--font-size-md);
      font-weight: 600;
      margin-bottom: 0;
    }

    .btn-close {
      font-size: var(--font-size-md);
      /* Sesuaikan ukuran ikon close */
      padding: var(--space-xs);
      opacity: 0.7;
      border-radius: var(--radius-full);
      line-height: 1;
      /* Jaga konsistensi ukuran */
      width: calc(var(--font-size-md) + (var(--space-xs) * 2));
      /* Atur width & height agar bulat sempurna */
      height: calc(var(--font-size-md) + (var(--space-xs) * 2));
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn-close:hover {
      opacity: 1;
      background-color: hsl(0, 0%, 90%);
    }

    .btn-close .bi {
      font-size: 1em;
      /* Ikon mengikuti ukuran font tombol */
      vertical-align: middle;
    }

    .modal-body {
      padding: var(--space-lg);
      overflow-y: auto;
      flex-grow: 1;
      /* Agar body mengisi ruang */
    }

    .modal-body>*:last-child {
      margin-bottom: 0;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-md) var(--space-lg);
      border-top: 1px solid var(--color-border);
      background-color: hsl(0, 0%, 98%);
      flex-shrink: 0;
      /* Agar footer tidak mengecil */
    }

    .modal-footer>*:last-child {
      margin-bottom: 0;
    }

    .request-details-view {
      background-color: var(--color-background);
      padding: var(--space-md);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-lg);
      border: 1px solid var(--color-border);
    }

    .request-details-view p {
      margin-bottom: var(--space-xs);
      font-size: var(--font-size-sm);
    }

    .request-details-view strong {
      font-weight: 600;
      color: var(--color-text-main);
    }


    /* --- Toast Notification --- */
    .toast-container {
      position: fixed;
      top: var(--space-lg);
      right: var(--space-lg);
      z-index: var(--z-index-toast);
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
      max-width: 350px;
    }

    .toast {
      background-color: var(--color-text-main);
      color: var(--color-text-inverse);
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      justify-content: space-between;
      opacity: 0;
      transform: translateX(120%);
      /* Mulai dari luar layar */
      transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
      min-width: 280px;
      /* Lebar minimum toast */
      pointer-events: none;
      /* Non-interaktif saat tersembunyi */
    }

    .toast.show {
      opacity: 1;
      transform: translateX(0);
      pointer-events: auto;
      /* Interaktif saat tampil */
    }

    .toast-body {
      flex-grow: 1;
      font-size: var(--font-size-sm);
      padding-right: var(--space-sm);
      /* Beri jarak dari tombol close */
    }

    .toast-body .bi {
      /* Ikon di dalam toast body */
      font-size: 1.2em;
      margin-right: var(--space-xs);
      vertical-align: text-bottom;
    }

    .toast .btn-close {
      margin-left: var(--space-md);
      color: var(--color-text-inverse);
      opacity: 0.8;
      flex-shrink: 0;
      /* Agar tombol close tidak mengecil */
    }

    .toast .btn-close:hover {
      opacity: 1;
      background: none;
    }

    .toast.bg-success {
      background-color: var(--color-success);
    }

    .toast.bg-danger {
      background-color: var(--color-danger);
    }

    .toast.bg-warning {
      background-color: var(--color-warning);
      color: var(--color-text-main);
    }

    .toast.bg-warning .btn-close {
      color: var(--color-text-main);
    }

    .toast.bg-info {
      background-color: var(--color-info);
    }

    /* ======== AKHIR DARI KOMPONEN SPESIFIK APLIKASI ======== */


    /* ======== AWAL DARI GRID RESPONSIVE SEDERHANA ======== */
    .row {
      display: flex;
      flex-wrap: wrap;
      margin-left: calc(var(--space-md) / -2);
      margin-right: calc(var(--space-md) / -2);
    }

    .col,
    [class*="col-"] {
      /* Perbaiki selector agar lebih spesifik */
      position: relative;
      width: 100%;
      padding-left: calc(var(--space-md) / 2);
      padding-right: calc(var(--space-md) / 2);
      flex-basis: 0;
      /* Default untuk flex item */
      flex-grow: 1;
      /* Default untuk flex item */
      max-width: 100%;
      /* Default untuk flex item */
    }

    .col-auto {
      flex: 0 0 auto;
      width: auto;
      max-width: none;
    }

    .col-1 {
      flex: 0 0 8.333333%;
      max-width: 8.333333%;
    }

    .col-2 {
      flex: 0 0 16.666667%;
      max-width: 16.666667%;
    }

    .col-3 {
      flex: 0 0 25%;
      max-width: 25%;
    }

    .col-4 {
      flex: 0 0 33.333333%;
      max-width: 33.333333%;
    }

    .col-5 {
      flex: 0 0 41.666667%;
      max-width: 41.666667%;
    }

    .col-6 {
      flex: 0 0 50%;
      max-width: 50%;
    }

    /* ...lanjutkan untuk col-7 hingga col-12 jika perlu */

    @media (min-width: var(--breakpoint-sm)) {
      .col-sm-auto {
        flex: 0 0 auto;
        width: auto;
        max-width: none;
      }

      .col-sm-2 {
        flex: 0 0 16.666667%;
        max-width: 16.666667%;
      }

      .col-sm-3 {
        flex: 0 0 25%;
        max-width: 25%;
      }

      .col-sm-4 {
        flex: 0 0 33.333333%;
        max-width: 33.333333%;
      }

      .col-sm-6 {
        flex: 0 0 50%;
        max-width: 50%;
      }

      .col-sm-12 {
        flex: 0 0 100%;
        max-width: 100%;
      }
    }

    @media (min-width: var(--breakpoint-md)) {
      .col-md-auto {
        flex: 0 0 auto;
        width: auto;
        max-width: none;
      }

      .col-md-2 {
        flex: 0 0 16.666667%;
        max-width: 16.666667%;
      }

      .col-md-3 {
        flex: 0 0 25%;
        max-width: 25%;
      }

      .col-md-4 {
        flex: 0 0 33.333333%;
        max-width: 33.333333%;
      }

      .col-md-6 {
        flex: 0 0 50%;
        max-width: 50%;
      }

      .col-md-12 {
        flex: 0 0 100%;
        max-width: 100%;
      }
    }

    /* ======== AKHIR DARI GRID RESPONSIVE SEDERHANA ======== */


    /* --- Footer Aplikasi --- */
    .app-footer {
      background-color: var(--color-surface);
      /* Warna surface agar kontras dengan background utama */
      color: var(--color-text-muted);
      padding: var(--space-md) 0;
      border-top: 1px solid var(--color-border);
      margin-top: auto;
      /* Ini penting agar footer menempel di bawah */
      flex-shrink: 0;
      /* Agar footer tidak mengecil */
    }

    .app-footer small {
      font-size: var(--font-size-sm);
    }


    /* ======== AWAL DARI PENYESUAIAN RESPONSIVE GLOBAL ======== */
    @media (max-width: calc(var(--breakpoint-lg) - 1px)) {

      /* Penyesuaian untuk layar lebih kecil dari LG (misal, iPad portrait) */
      .dashboard-stats {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }
    }

    @media (max-width: calc(var(--breakpoint-md) - 1px)) {

      /* Tablet dan di bawahnya */
      .navbar-nav {
        display: none;
        /* Kontrol oleh JS */
        flex-direction: column;
        width: 100%;
        background-color: var(--color-primary-dark);
        /* Warna sedikit beda untuk membedakan dari header */
        position: absolute;
        top: 100%;
        left: 0;
        box-shadow: var(--shadow-md) inset;
        /* Bayangan ke dalam */
        padding: var(--space-sm) 0;
        border-top: 1px solid var(--color-primary-hover);
      }

      .navbar-nav.is-open {
        display: flex;
      }

      .navbar-nav .nav-link {
        padding: var(--space-sm) var(--space-md);
        width: 100%;
        border-radius: 0;
      }

      .navbar-nav .nav-link:hover,
      .navbar-nav .nav-link.active {
        background-color: var(--color-primary);
      }

      .navbar-toggler {
        display: inline-flex;
        /* Agar align items bekerja */
        align-items: center;
        justify-content: center;
      }

      .modal-dialog {
        width: 90%;
        margin-top: var(--space-lg);
        margin-bottom: var(--space-lg);
      }

      .modal-body {
        max-height: 65vh;
      }

      /* Filter form items jadi full width atau 2 per baris */
      #filterForm .form-group {
        flex: 0 0 100%;
        max-width: 100%;
      }

      @media (min-width: var(--breakpoint-sm)) {

        /* Mulai dari SM, filter bisa 2 kolom */
        #filterForm .form-group.col-md-2,
        #filterForm .form-group.col-md-3 {
          flex: 0 0 50%;
          max-width: 50%;
        }

        #filterForm .form-group.col-md-3.d-flex {
          /* Tombol muat ulang tetap full width */
          flex: 0 0 100%;
          max-width: 100%;
        }
      }
    }

    @media (max-width: calc(var(--breakpoint-sm) - 1px)) {

      /* Mobile */
      :root {
        --font-size-base: 0.9375rem;
        /* 15px */
      }

      .container {
        padding-left: var(--space-sm);
        padding-right: var(--space-sm);
      }

      .dashboard-stats {
        grid-template-columns: 1fr;
        gap: var(--space-md);
      }

      .stats-card {
        padding: var(--space-md);
      }

      .stats-icon {
        font-size: var(--font-size-xl);
      }

      .stats-card h3 {
        font-size: var(--font-size-lg);
      }

      .card-body,
      .card-header,
      .card-footer {
        padding: var(--space-md);
      }

      .table th,
      .table td {
        padding: var(--space-sm);
        font-size: var(--font-size-sm);
        white-space: nowrap;
        /* Biarkan scroll horizontal untuk tabel */
      }

      .table .action-buttons {
        gap: var(--space-xxs);
      }

      /* Kurangi gap tombol aksi di mobile */
      .table .action-buttons .btn {
        padding: var(--space-xxs);
        font-size: var(--font-size-xs);
      }

      .table .action-buttons .btn .bi {
        font-size: 1.1em;
      }


      .modal-dialog {
        width: 95%;
        max-height: calc(100vh - (var(--space-sm) * 2));
        padding: 0;
      }

      .modal-header,
      .modal-body,
      .modal-footer {
        padding: var(--space-md);
      }

      .modal-body {
        max-height: 70vh;
      }

      .modal-footer {
        flex-direction: column;
        align-items: stretch;
      }

      .modal-footer .btn {
        width: 100%;
      }

      .modal-footer .btn:not(:last-child) {
        margin-bottom: var(--space-xs);
      }

      .toast-container {
        top: var(--space-sm);
        right: var(--space-sm);
        left: var(--space-sm);
        max-width: none;
        width: auto;
      }

      #filterForm .form-group {
        /* Di mobile, semua filter item full width */
        flex: 0 0 100%;
        max-width: 100%;
      }
    }

    /* ======== AKHIR DARI PENYESUAIAN RESPONSIVE GLOBAL ======== */
  </style>
</head>

<body>
  <!-- Header Aplikasi -->
  <header class="app-header" role="banner">
    <div class="container">
      <a class="navbar-brand" href="#" aria-label="Beranda Green Valley">
        <i class="bi bi-buildings-fill" aria-hidden="true"></i> Green Valley
      </a>
      <button class="navbar-toggler" type="button" id="navbarToggler" aria-label="Toggle navigasi" aria-expanded="false"
        aria-controls="navbarNav">
        <i class="bi bi-list"></i>
      </button>
      <nav id="navbarNav" aria-label="Navigasi Utama">
        <ul class="navbar-nav">
          <li><a class="nav-link active" href="#" data-route="dashboard" tabindex="0"><i class="bi bi-grid-1x2-fill"
                aria-hidden="true"></i>Dashboard</a></li>
          <li><a class="nav-link" href="#" data-action="openAddRequestModal" tabindex="0"><i
                class="bi bi-plus-circle-fill" aria-hidden="true"></i>Permohonan Baru</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Konten Utama Aplikasi -->
  <main class="app-main" id="main-content" tabindex="-1" role="main">
    <div class="container">
      <!-- Statistik Dashboard -->
      <section class="dashboard-stats mb-lg" aria-labelledby="stats-heading">
        <h2 id="stats-heading" class="visually-hidden">Statistik Permohonan</h2>
        <div class="stats-card">
          <i class="bi bi-journal-text stats-icon" aria-hidden="true"></i>
          <h3 id="totalRequests">0</h3>
          <p>Total Permohonan</p>
        </div>
        <div class="stats-card text-warning">
          <i class="bi bi-hourglass-split stats-icon" aria-hidden="true"></i>
          <h3 id="pendingRequests">0</h3>
          <p>Menunggu</p>
        </div>
        <div class="stats-card text-success">
          <i class="bi bi-check-circle-fill stats-icon" aria-hidden="true"></i>
          <h3 id="approvedRequests">0</h3>
          <p>Disetujui</p>
        </div>
        <div class="stats-card text-danger">
          <i class="bi bi-x-circle-fill stats-icon" aria-hidden="true"></i>
          <h3 id="rejectedRequests">0</h3>
          <p>Ditolak</p>
        </div>
      </section>

      <!-- Filter dan Pencarian -->
      <section class="card mb-lg" aria-labelledby="filter-heading">
        <div class="card-header">
          <h2 id="filter-heading" class="h4 mb-0">Filter Permohonan</h2>
        </div>
        <div class="card-body">
          <form id="filterForm" class="row align-items-end" role="search">
            <div class="form-group col-md-3">
              <label for="searchInput" class="form-label">Cari</label>
              <input type="search" class="form-control" id="searchInput" placeholder="ID atau Nama Penyewa..." />
            </div>
            <div class="form-group col-md-2">
              <label for="filterType" class="form-label">Tipe</label>
              <select class="form-select" id="filterType">
                <option value="">Semua Tipe</option>
                <option value="sewa">Sewa</option>
                <option value="perpanjangan">Perpanjangan</option>
                <option value="keluar">Keluar Unit</option>
                <option value="perbaikan">Permintaan Perbaikan</option>
              </select>
            </div>
            <div class="form-group col-md-2">
              <label for="filterBranch" class="form-label">Apartemen</label>
              <select class="form-select" id="filterBranch">
                <option value="">Semua Apartemen</option>
                <option value="apt1">Apartemen Utama</option>
                <option value="apt2">Apartemen Kota</option>
                <option value="apt3">Apartemen Pinggir Kota</option>
              </select>
            </div>
            <div class="form-group col-md-2">
              <label for="filterStatus" class="form-label">Status</label>
              <select class="form-select" id="filterStatus">
                <option value="">Semua Status</option>
                <option value="pending">Menunggu</option>
                <option value="approved">Disetujui</option>
                <option value="rejected">Ditolak</option>
              </select>
            </div>
            <div class="form-group col-md-3 d-flex align-items-end">
              <button class="btn btn-secondary w-100" id="refreshData" type="button">
                <i class="bi bi-arrow-clockwise" aria-hidden="true"></i> Muat Ulang
              </button>
            </div>
          </form>
        </div>
      </section>

      <!-- Tabel Permohonan -->
      <section class="card" aria-labelledby="requests-table-heading">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h2 id="requests-table-heading" class="h4 mb-0">Daftar Permohonan</h2>
          <button class="btn btn-primary btn-sm" data-action="openAddRequestModal">
            <i class="bi bi-plus-lg" aria-hidden="true"></i> Tambah Baru
          </button>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover" aria-live="polite">
              <thead>
                <tr>
                  <th scope="col">ID</th>
                  <th scope="col">Penyewa</th>
                  <th scope="col">Tipe</th>
                  <th scope="col">Apartemen</th>
                  <th scope="col">Diajukan</th>
                  <th scope="col">Status</th>
                  <th scope="col" class="text-center">Aksi</th>
                </tr>
              </thead>
              <tbody id="requestsTableBody">
                <!-- Baris tabel akan diisi oleh JavaScript -->
                <!-- Contoh State Kosong (akan diganti oleh JS) -->
                <tr>
                  <td colspan="7">
                    <div class="empty-state">
                      <i class="bi bi-inbox" aria-hidden="true"></i>
                      <p class="mt-sm mb-0 text-muted">Tidak ada permohonan untuk ditampilkan.</p>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Footer Aplikasi -->
  <footer class="app-footer">
    <div class="container text-center">
      <small>© <span id="currentYear"></span> Sistem Manajemen Rental Apartemen. Hak Cipta Dilindungi.</small>
    </div>
  </footer>

  <!-- Kontainer untuk Toast Notification -->
  <div class="toast-container" aria-live="assertive" aria-atomic="true"></div>

  <!-- Modal: Tambah/Edit/Lihat Permohonan -->
  <div class="modal" id="requestModal" tabindex="-1" aria-labelledby="requestModalLabel" aria-hidden="true"
    role="dialog">
    <div class="modal-dialog modal-dialog-lg">
      <div class="modal-content">
        <form id="requestForm" novalidate>
          <input type="hidden" id="requestId" name="id">
          <div class="modal-header">
            <h3 class="modal-title" id="requestModalLabel">Formulir Permohonan</h3>
            <button type="button" class="btn-close" data-action="closeModal" aria-label="Tutup">
              <i class="bi bi-x-lg" aria-hidden="true"></i>
            </button>
          </div>
          <div class="modal-body">
            <div id="viewRequestDetailsContainer" class="request-details-view" style="display: none;">
              <h4 class="h6 mb-sm">Detail Permohonan Saat Ini:</h4>
              <div class="row">
                <div class="col-sm-6">
                  <p><strong>Penyewa:</strong> <span id="viewEmployeeName"></span></p>
                  <p><strong>Apartemen:</strong> <span id="viewApartmentName"></span></p>
                </div>
                <div class="col-sm-6">
                  <p><strong>Tgl Diajukan:</strong> <span id="viewSubmissionDate"></span></p>
                  <p><strong>Status:</strong> <span id="viewCurrentStatus"></span></p>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="form-group col-md-6" id="employeeNameGroup">
                <label class="form-label" for="employeeName">Nama Penyewa</label>
                <input type="text" class="form-control" id="employeeName" name="employeeName" required
                  placeholder="Masukkan nama lengkap penyewa">
                <div class="invalid-feedback">Nama penyewa wajib diisi.</div>
              </div>
              <div class="form-group col-md-6">
                <label class="form-label" for="requestType">Tipe Permohonan</label>
                <select class="form-select" id="requestType" name="type" required>
                  <option value="" disabled selected>Pilih Tipe...</option>
                  <option value="sewa">Sewa</option>
                  <option value="perpanjangan">Perpanjangan</option>
                  <option value="keluar">Keluar Unit</option>
                  <option value="perbaikan">Permintaan Perbaikan</option>
                </select>
                <div class="invalid-feedback">Tipe permohonan wajib diisi.</div>
              </div>
            </div>
            <div class="row">
              <div class="form-group col-md-6">
                <label class="form-label" for="apartmentBranch">Apartemen</label>
                <select class="form-select" id="apartmentBranch" name="apartmentBranch" required>
                  <option value="" disabled selected>Pilih Apartemen...</option>
                  <option value="apt1">Apartemen Utama</option>
                  <option value="apt2">Apartemen Kota</option>
                  <option value="apt3">Apartemen Pinggir Kota</option>
                </select>
                <div class="invalid-feedback">Apartemen wajib dipilih.</div>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label" for="requestDetails">Detail Permohonan</label>
              <textarea class="form-control" id="requestDetails" name="details" rows="3" required
                placeholder="Jelaskan detail permohonan Anda..."></textarea>
              <div class="invalid-feedback">Detail permohonan wajib diisi.</div>
            </div>
            <div class="row">
              <div class="form-group col-md-6">
                <label class="form-label" for="startDate">Tanggal Mulai</label>
                <input type="date" class="form-control" id="startDate" name="startDate" required />
                <div class="invalid-feedback">Tanggal mulai wajib diisi.</div>
              </div>
              <div class="form-group col-md-6">
                <label class="form-label" for="endDate">Tanggal Selesai</label>
                <input type="date" class="form-control" id="endDate" name="endDate" required />
                <div class="invalid-feedback">Tanggal selesai wajib diisi dan tidak boleh sebelum tanggal mulai.</div>
              </div>
            </div>
          </div>
          <div class="modal-footer" id="modalActions">
            <!-- Tombol akan di-render oleh JavaScript tergantung mode -->
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Template untuk baris tabel permohonan -->
  <template id="requestRowTemplate">
    <tr>
      <td data-label="ID"></td>
      <td data-label="Penyewa"></td>
      <td data-label="Tipe"></td>
      <td data-label="Apartemen"></td>
      <td data-label="Diajukan"></td>
      <td data-label="Status"><span class="status-badge"></span></td>
      <td data-label="Aksi" class="text-center">
        <div class="action-buttons btn-group" role="group" aria-label="Aksi Permohonan">
          <button type="button" class="btn btn-sm btn-info" title="Lihat Detail" data-action="view">
            <i class="bi bi-eye-fill" aria-hidden="true"></i><span class="visually-hidden">Lihat</span>
          </button>
          <button type="button" class="btn btn-sm btn-warning" title="Ubah Permohonan" data-action="edit">
            <i class="bi bi-pencil-fill" aria-hidden="true"></i><span class="visually-hidden">Ubah</span>
          </button>
          <button type="button" class="btn btn-sm btn-danger" title="Hapus Permohonan" data-action="delete">
            <i class="bi bi-trash-fill" aria-hidden="true"></i><span class="visually-hidden">Hapus</span>
          </button>
        </div>
      </td>
    </tr>
  </template>

  <script>
    // Enkapsulasi semua kode JavaScript dalam IIFE untuk menghindari polusi global scope
    (function () {
      "use strict"; // Aktifkan strict mode

      // STATE APLIKASI (Single Source of Truth)
      const appState = {
        requests: [],
        currentModalMode: null, // 'add', 'edit', 'view'
        currentEditingId: null,
        filters: { search: "", type: "", branch: "", status: "" },
        ui: { // Cache elemen UI yang sering diakses
          navbarToggler: document.getElementById('navbarToggler'),
          navbarNav: document.getElementById('navbarNav'),
          totalRequestsElem: document.getElementById('totalRequests'),
          pendingRequestsElem: document.getElementById('pendingRequests'),
          approvedRequestsElem: document.getElementById('approvedRequests'),
          rejectedRequestsElem: document.getElementById('rejectedRequests'),
          searchInputElem: document.getElementById('searchInput'),
          filterTypeElem: document.getElementById('filterType'),
          filterBranchElem: document.getElementById('filterBranch'),
          filterStatusElem: document.getElementById('filterStatus'),
          refreshDataBtn: document.getElementById('refreshData'),
          requestsTableBody: document.getElementById('requestsTableBody'),
          requestRowTemplate: document.getElementById('requestRowTemplate'),
          requestModal: document.getElementById('requestModal'),
          requestModalLabel: document.getElementById('requestModalLabel'),
          requestForm: document.getElementById('requestForm'),
          requestIdInput: document.getElementById('requestId'),
          modalActionsContainer: document.getElementById('modalActions'),
          viewRequestDetailsContainer: document.getElementById('viewRequestDetailsContainer'),
          viewEmployeeNameElem: document.getElementById('viewEmployeeName'),
          viewApartmentNameElem: document.getElementById('viewApartmentName'),
          viewSubmissionDateElem: document.getElementById('viewSubmissionDate'),
          viewCurrentStatusElem: document.getElementById('viewCurrentStatus'),
          employeeNameGroup: document.getElementById('employeeNameGroup'),
          toastContainer: document.querySelector('.toast-container'),
          currentYearElem: document.getElementById('currentYear'),
        }
      };

      // UTILITIES / HELPERS
      const utils = {
        debounce: (func, delay = 300) => {
          let timeoutId;
          return (...args) => {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(() => func.apply(this, args), delay);
          };
        },
        generateId: () => `REQ-${Date.now().toString().slice(-6)}${Math.random().toString(36).substr(2, 4).toUpperCase()}`,
        formatDateForInput: (dateString) => {
          if (!dateString) return '';
          try {
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return ''; // Invalid date
            return date.toISOString().split('T')[0];
          } catch (e) { return ''; }
        },
        formatDateForDisplay: (dateString) => {
          if (!dateString) return 'N/A';
          try {
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return 'N/A'; // Invalid date
            return date.toLocaleDateString('id-ID', { day: '2-digit', month: 'long', year: 'numeric' });
          } catch (e) { return 'N/A'; }
        },
        getApartmentLabel: (value) => {
          const option = appState.ui.filterBranchElem.querySelector(`option[value="${value}"]`);
          return option ? option.textContent : value;
        },
        getRequestTypeLabel: (value) => {
          const option = appState.ui.filterTypeElem.querySelector(`option[value="${value}"]`);
          return option ? option.textContent : value;
        },
        getStatusLabel: (value) => {
          const option = appState.ui.filterStatusElem.querySelector(`option[value="${value}"]`);
          return option ? option.textContent : value;
        },
        sanitizeHTML: (str) => {
          if (str === null || typeof str === 'undefined') return '';
          const temp = document.createElement('div');
          temp.textContent = String(str);
          return temp.innerHTML;
        }
      };

      // DATA PERSISTENCE LAYER (LocalStorage)
      const dataService = {
        loadRequests: () => {
          try {
            const storedRequests = localStorage.getItem('apartmentRequests_v2'); // v2 untuk struktur baru jika ada
            return storedRequests ? JSON.parse(storedRequests) : [];
          } catch (error) {
            console.error("Gagal memuat data dari localStorage:", error);
            uiService.showToast("Gagal memuat data. Data mungkin korup atau format tidak sesuai.", "danger", 5000);
            localStorage.removeItem('apartmentRequests_v2'); // Hapus data korup
            return [];
          }
        },
        saveRequests: () => {
          try {
            localStorage.setItem('apartmentRequests_v2', JSON.stringify(appState.requests));
          } catch (error) {
            console.error("Gagal menyimpan data ke localStorage:", error);
            uiService.showToast("Gagal menyimpan data. Penyimpanan lokal mungkin penuh atau tidak didukung.", "danger", 5000);
          }
        }
      };

      // UI SERVICE LAYER (Rendering, Modal, Toast, Validation)
      const uiService = {
        renderDashboardStats: () => {
          const stats = appState.requests.reduce((acc, req) => {
            acc.total++;
            if (req.status === 'pending') acc.pending++;
            else if (req.status === 'approved') acc.approved++;
            else if (req.status === 'rejected') acc.rejected++;
            return acc;
          }, { total: 0, pending: 0, approved: 0, rejected: 0 });

          appState.ui.totalRequestsElem.textContent = stats.total;
          appState.ui.pendingRequestsElem.textContent = stats.pending;
          appState.ui.approvedRequestsElem.textContent = stats.approved;
          appState.ui.rejectedRequestsElem.textContent = stats.rejected;
        },

        renderRequestsTable: () => {
          const { requestsTableBody, requestRowTemplate } = appState.ui;
          requestsTableBody.innerHTML = '';

          const filteredRequests = appState.requests.filter(req => {
            const searchLower = appState.filters.search.toLowerCase();
            const matchesSearch = !appState.filters.search ||
              req.id.toLowerCase().includes(searchLower) ||
              (req.employeeName && req.employeeName.toLowerCase().includes(searchLower));
            const matchesType = !appState.filters.type || req.type === appState.filters.type;
            const matchesBranch = !appState.filters.branch || req.apartmentBranch === appState.filters.branch;
            const matchesStatus = !appState.filters.status || req.status === appState.filters.status;
            return matchesSearch && matchesType && matchesBranch && matchesStatus;
          });

          if (filteredRequests.length === 0) {
            const colspan = requestsTableBody.closest('table').querySelector('thead th').parentElement.cells.length;
            requestsTableBody.innerHTML = `
              <tr>
                <td colspan="${colspan}">
                  <div class="empty-state">
                    <i class="bi bi-inbox" aria-hidden="true"></i>
                    <p class="mt-sm mb-0 text-muted">${appState.filters.search || appState.filters.type || appState.filters.branch || appState.filters.status ? 'Tidak ada permohonan yang cocok dengan filter Anda.' : 'Belum ada permohonan.'}</p>
                  </div>
                </td>
              </tr>`;
            return;
          }

          filteredRequests.forEach(request => {
            const rowClone = requestRowTemplate.content.cloneNode(true);
            const cells = rowClone.querySelectorAll('td');
            const statusBadge = rowClone.querySelector('.status-badge');
            const actionButtons = rowClone.querySelectorAll('button[data-action]');

            cells[0].textContent = request.id;
            cells[1].textContent = utils.sanitizeHTML(request.employeeName);
            cells[2].textContent = utils.getRequestTypeLabel(request.type);
            cells[3].textContent = utils.getApartmentLabel(request.apartmentBranch);
            cells[4].textContent = utils.formatDateForDisplay(request.submittedDate);

            statusBadge.textContent = utils.getStatusLabel(request.status);
            statusBadge.className = `status-badge status-${request.status}`;

            actionButtons.forEach(button => button.dataset.id = request.id);

            // Disable edit/delete jika status bukan pending (contoh aturan bisnis)
            if (request.status !== 'pending') {
              const editButton = rowClone.querySelector('button[data-action="edit"]');
              const deleteButton = rowClone.querySelector('button[data-action="delete"]');
              if (editButton) editButton.disabled = true;
              if (deleteButton) deleteButton.disabled = true;
            }

            requestsTableBody.appendChild(rowClone);
          });
        },

        renderAll: () => {
          uiService.renderDashboardStats();
          uiService.renderRequestsTable();
        },

        openModal: (mode, requestId = null) => {
          appState.currentModalMode = mode;
          appState.currentEditingId = requestId;
          const { requestModal, requestModalLabel, requestForm, modalActionsContainer,
            viewRequestDetailsContainer, requestIdInput, employeeNameGroup } = appState.ui;

          requestForm.reset();
          uiService.clearFormValidation(requestForm);
          Array.from(requestForm.elements).forEach(el => el.removeAttribute('disabled'));
          viewRequestDetailsContainer.style.display = 'none';
          employeeNameGroup.style.display = 'block'; // Default tampil

          let title = '';
          modalActionsContainer.innerHTML = '';

          if (mode === 'add') {
            title = 'Tambah Permohonan Baru';
            requestIdInput.value = '';
            modalActionsContainer.innerHTML = `
              <button type="button" class="btn btn-secondary" data-action="closeModal">Batal</button>
              <button type="submit" class="btn btn-primary"><i class="bi bi-send-fill" aria-hidden="true"></i> Ajukan Permohonan</button>
            `;
          } else {
            const request = appState.requests.find(r => r.id === requestId);
            if (!request) {
              uiService.showToast("Permohonan tidak ditemukan.", "danger");
              return;
            }

            requestIdInput.value = request.id;
            requestForm.elements.employeeName.value = request.employeeName || '';
            requestForm.elements.type.value = request.type;
            requestForm.elements.apartmentBranch.value = request.apartmentBranch;
            requestForm.elements.details.value = request.details;
            requestForm.elements.startDate.value = utils.formatDateForInput(request.startDate);
            requestForm.elements.endDate.value = utils.formatDateForInput(request.endDate);

            viewRequestDetailsContainer.style.display = 'block';
            appState.ui.viewEmployeeNameElem.textContent = utils.sanitizeHTML(request.employeeName);
            appState.ui.viewApartmentNameElem.textContent = utils.getApartmentLabel(request.apartmentBranch);
            appState.ui.viewSubmissionDateElem.textContent = utils.formatDateForDisplay(request.submittedDate);
            const statusBadgeHTML = `<span class="status-badge status-${request.status}">${utils.getStatusLabel(request.status)}</span>`;
            appState.ui.viewCurrentStatusElem.innerHTML = statusBadgeHTML;

            if (mode === 'edit') {
              title = `Ubah Permohonan #${utils.sanitizeHTML(request.id)}`;
              modalActionsContainer.innerHTML = `
                <button type="button" class="btn btn-secondary" data-action="closeModal">Batal</button>
                <button type="submit" class="btn btn-primary"><i class="bi bi-save-fill" aria-hidden="true"></i> Simpan Perubahan</button>
              `;
            } else { // mode === 'view'
              title = `Detail Permohonan #${utils.sanitizeHTML(request.id)}`;
              Array.from(requestForm.elements).forEach(el => el.setAttribute('disabled', 'true'));
              employeeNameGroup.style.display = 'none'; // Sembunyikan input nama penyewa di mode view jika sudah ada di detail

              let actionButtonsHTML = `<button type="button" class="btn btn-secondary" data-action="closeModal">Tutup</button>`;
              if (request.status === 'pending') {
                actionButtonsHTML += `
                  <button type="button" class="btn btn-success" data-action="updateStatus" data-status="approved" data-id="${request.id}"><i class="bi bi-check-circle" aria-hidden="true"></i> Setujui</button>
                  <button type="button" class="btn btn-danger" data-action="updateStatus" data-status="rejected" data-id="${request.id}"><i class="bi bi-x-circle" aria-hidden="true"></i> Tolak</button>
                `;
              }
              modalActionsContainer.innerHTML = actionButtonsHTML;
            }
          }

          requestModalLabel.textContent = title;
          requestModal.classList.add('is-open');
          requestModal.setAttribute('aria-hidden', 'false');

          const firstFocusableElement = requestForm.querySelector('input:not([type="hidden"]):not(:disabled), select:not(:disabled), textarea:not(:disabled), button:not(:disabled)');
          if (firstFocusableElement) firstFocusableElement.focus();
          else modalActionsContainer.querySelector('button').focus(); // Fokus ke tombol pertama di footer jika form disabled
        },

        closeModal: () => {
          appState.ui.requestModal.classList.remove('is-open');
          appState.ui.requestModal.setAttribute('aria-hidden', 'true');
          appState.currentModalMode = null;
          appState.currentEditingId = null;
          // Kembalikan fokus ke elemen yang membuka modal jika memungkinkan, atau ke body
          (document.activeElementPreviouslyFocused || document.body).focus();
          document.activeElementPreviouslyFocused = null; // Reset
        },

        validateForm: (form) => {
          let isValid = true;
          uiService.clearFormValidation(form); // Bersihkan validasi sebelumnya

          Array.from(form.elements).forEach(element => {
            if (element.required && element.offsetParent !== null) { // Cek visible (offsetParent)
              if (!element.value.trim()) {
                isValid = false;
                element.classList.add('is-invalid');
              } else {
                element.classList.add('is-valid'); // Opsional, bisa juga tidak ada kelas is-valid
              }
            }
          });

          const startDateElem = form.elements.startDate;
          const endDateElem = form.elements.endDate;
          if (startDateElem.value && endDateElem.value && new Date(endDateElem.value) < new Date(startDateElem.value)) {
            isValid = false;
            endDateElem.classList.add('is-invalid');
            endDateElem.classList.remove('is-valid');
            const feedback = endDateElem.closest('.form-group').querySelector('.invalid-feedback');
            if (feedback) feedback.textContent = "Tanggal selesai tidak boleh sebelum tanggal mulai.";
          }
          return isValid;
        },

        clearFormValidation: (form) => {
          Array.from(form.elements).forEach(element => {
            element.classList.remove('is-invalid', 'is-valid');
            const feedback = element.closest('.form-group')?.querySelector('.invalid-feedback');
            if (feedback && feedback.dataset.defaultMessage) { // Kembalikan pesan default jika ada
              feedback.textContent = feedback.dataset.defaultMessage;
            }
          });
        },

        showToast: (message, type = 'success', duration = 3500) => {
          const toastId = `toast-${Date.now()}`;
          const toast = document.createElement('div');
          toast.className = `toast bg-${type}`;
          toast.id = toastId;
          toast.setAttribute('role', 'alert');
          toast.setAttribute('aria-live', 'assertive');
          toast.setAttribute('aria-atomic', 'true');

          let iconClass = '';
          if (type === 'success') iconClass = 'bi-check-circle-fill';
          else if (type === 'danger') iconClass = 'bi-exclamation-triangle-fill';
          else if (type === 'warning') iconClass = 'bi-exclamation-octagon-fill';
          else if (type === 'info') iconClass = 'bi-info-circle-fill';

          toast.innerHTML = `
            <div class="toast-body">
              ${iconClass ? `<i class="bi ${iconClass}" aria-hidden="true"></i>` : ''}
              ${utils.sanitizeHTML(message)}
            </div>
            <button type="button" class="btn-close" data-action="dismissToast" aria-label="Tutup Notifikasi">
              <i class="bi bi-x" aria-hidden="true"></i>
            </button>
          `;
          appState.ui.toastContainer.appendChild(toast);

          toast.offsetHeight; // Trigger reflow

          toast.classList.add('show');

          const closeButton = toast.querySelector('[data-action="dismissToast"]');
          const dismissHandler = () => uiService.dismissToast(toastId);
          closeButton.addEventListener('click', dismissHandler);

          setTimeout(dismissHandler, duration);
        },

        dismissToast: (toastId) => {
          const toast = document.getElementById(toastId);
          if (toast) {
            toast.classList.remove('show');
            toast.addEventListener('transitionend', () => toast.remove(), { once: true });
          }
        }
      };

      // APPLICATION LOGIC / EVENT HANDLERS
      const appLogic = {
        handleFormSubmit: (event) => {
          event.preventDefault();
          const form = event.target;
          if (!uiService.validateForm(form)) {
            uiService.showToast("Harap perbaiki isian pada formulir.", "warning");
            // Fokus ke field invalid pertama
            const firstInvalid = form.querySelector('.is-invalid');
            if (firstInvalid) firstInvalid.focus();
            return;
          }

          const formData = new FormData(form);
          const requestData = Object.fromEntries(formData.entries());

          // Sanitasi tambahan jika diperlukan, meskipun utils.sanitizeHTML sudah ada
          requestData.employeeName = utils.sanitizeHTML(requestData.employeeName);
          requestData.details = utils.sanitizeHTML(requestData.details);

          if (appState.currentModalMode === 'add') {
            const newRequest = {
              ...requestData,
              id: utils.generateId(),
              status: 'pending',
              submittedDate: new Date().toISOString(),
            };
            appState.requests.unshift(newRequest);
            uiService.showToast("Permohonan berhasil diajukan.", "success");
          } else if (appState.currentModalMode === 'edit') {
            const index = appState.requests.findIndex(r => r.id === appState.currentEditingId);
            if (index !== -1) {
              appState.requests[index] = {
                ...appState.requests[index],
                ...requestData,
                id: appState.currentEditingId
              };
              uiService.showToast("Permohonan berhasil diperbarui.", "success");
            }
          }
          dataService.saveRequests();
          uiService.renderAll();
          uiService.closeModal();
        },

        handleFilterChange: () => {
          appState.filters.search = appState.ui.searchInputElem.value.trim();
          appState.filters.type = appState.ui.filterTypeElem.value;
          appState.filters.branch = appState.ui.filterBranchElem.value;
          appState.filters.status = appState.ui.filterStatusElem.value;
          uiService.renderRequestsTable();
        },

        handleTableActions: (event) => {
          const targetButton = event.target.closest('button[data-action]');
          if (!targetButton || targetButton.disabled) return;

          document.activeElementPreviouslyFocused = targetButton; // Simpan elemen yang difokuskan
          const action = targetButton.dataset.action;
          const requestId = targetButton.dataset.id;

          if (action === 'view') {
            uiService.openModal('view', requestId);
          } else if (action === 'edit') {
            uiService.openModal('edit', requestId);
          } else if (action === 'delete') {
            // Konfirmasi dengan modal custom akan lebih baik, tapi `confirm` cukup untuk vanilla
            if (confirm(`Apakah Anda yakin ingin menghapus permohonan ID: ${utils.sanitizeHTML(requestId)}? Aksi ini tidak dapat dibatalkan.`)) {
              appState.requests = appState.requests.filter(r => r.id !== requestId);
              dataService.saveRequests();
              uiService.renderAll();
              uiService.showToast(`Permohonan ${utils.sanitizeHTML(requestId)} berhasil dihapus.`, "info");
            } else {
              document.activeElementPreviouslyFocused.focus(); // Kembalikan fokus jika batal
              document.activeElementPreviouslyFocused = null;
            }
          }
        },

        handleModalActions: (event) => {
          const targetButton = event.target.closest('button[data-action]');
          if (!targetButton) return;

          document.activeElementPreviouslyFocused = targetButton;
          const action = targetButton.dataset.action;

          if (action === 'closeModal') {
            uiService.closeModal();
          } else if (action === 'updateStatus') {
            const requestId = targetButton.dataset.id;
            const status = targetButton.dataset.status;
            const index = appState.requests.findIndex(r => r.id === requestId);
            if (index !== -1) {
              appState.requests[index].status = status;
              dataService.saveRequests();
              uiService.renderAll();
              uiService.closeModal();
              const statusLabel = utils.getStatusLabel(status).toLowerCase();
              uiService.showToast(`Permohonan ${utils.sanitizeHTML(requestId)} telah ${statusLabel}.`, status === 'approved' ? 'success' : 'info');
            }
          }
        },

        handleNavbarToggle: () => {
          const isOpen = appState.ui.navbarNav.classList.toggle('is-open');
          appState.ui.navbarToggler.setAttribute('aria-expanded', isOpen.toString());
          appState.ui.navbarToggler.querySelector('i').className = isOpen ? 'bi bi-x-lg' : 'bi bi-list';
        },

        handleRefreshData: () => {
          appState.requests = dataService.loadRequests();
          // Reset filter juga bisa jadi opsi di sini, atau biarkan filter tetap
          // appLogic.handleFilterChange(); // Untuk menerapkan filter yang ada ke data baru
          uiService.renderAll();
          uiService.showToast("Data berhasil dimuat ulang.", "info");
        }
      };

      // INITIALIZATION
      function initializeApp() {
        // Muat data awal
        appState.requests = dataService.loadRequests();

        // Set default message untuk invalid-feedback
        appState.ui.requestForm.querySelectorAll('.invalid-feedback').forEach(el => {
          el.dataset.defaultMessage = el.textContent;
        });

        // Setup Event Listeners
        appState.ui.requestForm.addEventListener('submit', appLogic.handleFormSubmit);
        appState.ui.modalActionsContainer.addEventListener('click', appLogic.handleModalActions);
        appState.ui.requestsTableBody.addEventListener('click', appLogic.handleTableActions);

        document.querySelectorAll('[data-action="openAddRequestModal"]').forEach(btn => {
          btn.addEventListener('click', (e) => {
            document.activeElementPreviouslyFocused = e.currentTarget;
            uiService.openModal('add');
          });
        });

        appState.ui.requestModal.querySelector('.btn-close[data-action="closeModal"]').addEventListener('click', (e) => {
          document.activeElementPreviouslyFocused = e.currentTarget;
          uiService.closeModal();
        });

        const debouncedFilterHandler = utils.debounce(appLogic.handleFilterChange, 350);
        appState.ui.searchInputElem.addEventListener('input', debouncedFilterHandler);
        [appState.ui.filterTypeElem, appState.ui.filterBranchElem, appState.ui.filterStatusElem].forEach(el => {
          el.addEventListener('change', appLogic.handleFilterChange);
        });

        appState.ui.refreshDataBtn.addEventListener('click', appLogic.handleRefreshData);
        appState.ui.navbarToggler.addEventListener('click', appLogic.handleNavbarToggle);

        appState.ui.requestModal.addEventListener('click', (event) => {
          if (event.target === appState.ui.requestModal) { // Klik pada backdrop
            document.activeElementPreviouslyFocused = appState.ui.requestModal; // Secara teknis tidak bisa fokus
            uiService.closeModal();
          }
        });

        document.addEventListener('keydown', (event) => {
          if (event.key === 'Escape' && appState.ui.requestModal.classList.contains('is-open')) {
            document.activeElementPreviouslyFocused = document.body; // Fallback
            uiService.closeModal();
          }
        });

        if (appState.ui.currentYearElem) {
          appState.ui.currentYearElem.textContent = new Date().getFullYear();
        }

        // Initial render
        uiService.renderAll();
        uiService.showToast("Selamat datang di Sistem Rental Apartemen!", "info", 4000);
      }

      // Jalankan aplikasi setelah DOM sepenuhnya dimuat
      document.addEventListener('DOMContentLoaded', initializeApp);

    })();
  </script>
</body>

</html>