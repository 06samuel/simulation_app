<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RentalPro - Solusi Manajemen Apartemen Terintegrasi</title>

  <!-- ICON FONTS (Font Awesome CDN) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- LEAFLET CSS (Untuk Peta Interaktif) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

  <!-- GOOGLE FONTS (Open Sans) -->
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    /* === RESET & BASE STYLES === */
    :root {
      --primary-color: #4A90E2;
      /* Biru modern yang lebih soft */
      --secondary-color: #50E3C2;
      /* Hijau mint cerah */
      --accent-color: #F5A623;
      /* Oranye untuk aksen */
      --neutral-dark: #2C3E50;
      /* Abu-abu gelap kebiruan (mirip navy) */
      --neutral-medium: #7F8C8D;
      /* Abu-abu sedang netral */
      --neutral-light: #ECF0F1;
      /* Abu-abu sangat terang (hampir putih) */
      --background-color: #FDFEFE;
      /* Putih sedikit off-white, lebih lembut dari putih murni */
      --text-color: #34495E;
      /* Abu-abu tua untuk teks utama */
      --success-color: #2ECC71;
      /* Hijau untuk sukses */
      --warning-color: #F39C12;
      /* Kuning untuk peringatan */
      --danger-color: #E74C3C;
      /* Merah untuk error/bahaya */

      --font-family-base: 'Open Sans', sans-serif;
      --font-size-base: 1rem;
      /* 16px, bisa disesuaikan di media query */
      --line-height-base: 1.6;

      --border-radius-sm: 0.25rem;
      /* 4px */
      --border-radius-md: 0.5rem;
      /* 8px */
      --border-radius-lg: 0.75rem;
      /* 12px */
      --border-radius-full: 999px;
      /* Untuk elemen bulat seperti badge */

      --shadow-sm: 0 2px 4px rgba(44, 62, 80, 0.08);
      /* Shadow lebih subtle */
      --shadow-md: 0 4px 8px rgba(44, 62, 80, 0.12);
      --shadow-lg: 0 10px 20px rgba(44, 62, 80, 0.15);

      --transition-fast: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
      --transition-medium: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);

      --container-max-width: 1200px;
      --container-padding: 1.5rem;
    }

    *,
    *::before,
    *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      font-size: var(--font-size-base);
    }

    body {
      font-family: var(--font-family-base);
      background-color: var(--background-color);
      color: var(--text-color);
      line-height: var(--line-height-base);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
      overflow-x: hidden;
      /* Mencegah scroll horizontal yang tidak diinginkan */
    }

    /* === UTILITIES === */
    .container {
      width: 100%;
      max-width: var(--container-max-width);
      margin-left: auto;
      margin-right: auto;
      padding-left: var(--container-padding);
      padding-right: var(--container-padding);
    }

    .section {
      padding: 4rem 0;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease-out, transform 0.5s ease-out;
      display: none;
      /* Awalnya semua section disembunyikan */
    }

    .section.active {
      /* State untuk section yang aktif/terlihat */
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    /* Variasi background section */
    .section-bg-light {
      background-color: var(--neutral-light);
    }


    .section-title {
      text-align: center;
      margin-bottom: 3rem;
      color: var(--neutral-dark);
    }

    .section-title h2 {
      font-size: 2.25rem;
      /* Sedikit lebih kecil agar tidak terlalu mendominasi */
      margin-bottom: 0.75rem;
      /* Spasi yang cukup */
    }

    .section-title p {
      font-size: 1.1rem;
      color: var(--neutral-medium);
      max-width: 600px;
      /* Batasi lebar subjudul agar mudah dibaca */
      margin-left: auto;
      margin-right: auto;
    }

    .section-title::after {
      /* Garis bawah dekoratif */
      content: '';
      display: block;
      width: 70px;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      margin: 1rem auto 0;
      border-radius: 2px;
    }

    .text-primary {
      color: var(--primary-color) !important;
    }

    .text-secondary {
      color: var(--secondary-color) !important;
    }

    .text-accent {
      color: var(--accent-color) !important;
    }

    .text-success {
      color: var(--success-color) !important;
    }

    .text-warning {
      color: var(--warning-color) !important;
    }

    .text-danger {
      color: var(--danger-color) !important;
    }

    .text-neutral-dark {
      color: var(--neutral-dark) !important;
    }

    .text-neutral-medium {
      color: var(--neutral-medium) !important;
    }

    .d-none {
      display: none !important;
    }

    .d-block {
      display: block !important;
    }

    .d-flex {
      display: flex !important;
    }

    .flex-column {
      flex-direction: column !important;
    }

    .align-items-center {
      align-items: center !important;
    }

    .justify-content-center {
      justify-content: center !important;
    }

    .justify-content-between {
      justify-content: space-between !important;
    }

    .w-100 {
      width: 100% !important;
    }

    .mb-1 {
      margin-bottom: 0.25rem !important;
    }

    .mb-2 {
      margin-bottom: 0.5rem !important;
    }

    .mb-3 {
      margin-bottom: 1rem !important;
    }

    .mb-4 {
      margin-bottom: 1.5rem !important;
    }

    .mt-1 {
      margin-top: 0.25rem !important;
    }

    .mt-2 {
      margin-top: 0.5rem !important;
    }

    .mt-3 {
      margin-top: 1rem !important;
    }

    .mt-4 {
      margin-top: 1.5rem !important;
    }

    .mr-2 {
      margin-right: 0.5rem !important;
    }

    .my-3 {
      margin-top: 1rem !important;
      margin-bottom: 1rem !important;
    }

    .col-span-full {
      grid-column: 1 / -1;
    }

    /* Untuk item grid yang mengambil lebar penuh */
    .text-center {
      text-align: center !important;
    }

    .font-weight-bold {
      font-weight: 700 !important;
    }

    /* === TYPOGRAPHY === */
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-weight: 700;
      line-height: 1.3;
      color: var(--neutral-dark);
      margin-bottom: 1rem;
    }

    h1 {
      font-size: 2.8rem;
    }

    h2 {
      font-size: 2.25rem;
    }

    h3 {
      font-size: 1.75rem;
    }

    h4 {
      font-size: 1.4rem;
    }

    p {
      margin-bottom: 1rem;
      font-size: 1rem;
      color: var(--text-color);
    }

    a {
      color: var(--primary-color);
      text-decoration: none;
      transition: var(--transition-fast);
    }

    a:hover {
      color: var(--secondary-color);
      /* text-decoration: underline; */
    }

    small {
      font-size: 0.875rem;
    }

    hr {
      border: 0;
      border-top: 1px solid var(--neutral-light);
      margin: 1.5rem 0;
    }

    .list-unstyled {
      list-style: none;
      padding-left: 0;
    }

    /* === BUTTONS === */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      border-radius: var(--border-radius-md);
      border: 1px solid transparent;
      cursor: pointer;
      transition: var(--transition-medium);
      text-align: center;
      white-space: nowrap;
      box-shadow: var(--shadow-sm);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: var(--shadow-sm);
    }

    .btn:disabled,
    .btn.disabled {
      background-color: var(--neutral-medium);
      border-color: var(--neutral-medium);
      cursor: not-allowed;
      opacity: 0.7;
      transform: none;
      box-shadow: var(--shadow-sm);
    }

    .btn i {
      margin-right: 0.5rem;
    }

    .btn-primary {
      background-color: var(--primary-color);
      color: #fff;
      border-color: var(--primary-color);
    }

    .btn-primary:hover {
      background-color: #3A7BC8;
      border-color: #3A7BC8;
    }

    /* Warna hover sedikit lebih gelap */

    .btn-secondary {
      background-color: var(--secondary-color);
      color: var(--neutral-dark);
      border-color: var(--secondary-color);
    }

    .btn-secondary:hover {
      background-color: #3CCAAF;
      border-color: #3CCAAF;
    }

    .btn-outline-primary {
      background-color: transparent;
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
    }

    .btn-outline-primary:hover {
      background-color: var(--primary-color);
      color: #fff;
    }

    .btn-lg {
      padding: 1rem 2rem;
      font-size: 1.1rem;
    }

    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
    }

    /* === FORMS === */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--neutral-dark);
      font-size: 0.9rem;
    }

    .form-control {
      width: 100%;
      padding: 0.875rem 1rem;
      font-size: 1rem;
      border: 1px solid #CED4DA;
      border-radius: var(--border-radius-md);
      background-color: #fff;
      color: var(--text-color);
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.2rem rgba(74, 144, 226, 0.25);
      /* Shadow fokus halus */
    }

    .form-control[type="date"] {
      appearance: none;
      /* Untuk kontrol styling yang lebih baik, meskipun browser modern punya UI sendiri */
      min-height: calc(1.6em + 1.75rem + 2px);
      /* Samakan tinggi dengan input text */
    }

    .form-control::placeholder {
      color: var(--neutral-medium);
      opacity: 0.8;
    }

    textarea.form-control {
      min-height: 120px;
      resize: vertical;
    }

    .form-select {
      /* Styling untuk select agar konsisten */
      appearance: none;
      /* Menggunakan data URI untuk ikon panah agar tidak ada request eksternal dan native */
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%2334495E' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 0.75rem center;
      background-size: 16px 12px;
      padding-right: 2.5rem;
      /* Ruang untuk panah */
    }

    .form-check {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .form-check-input {
      margin-right: 0.5rem;
      width: 1.15em;
      height: 1.15em;
      margin-top: 0;
    }

    .form-check-label {
      font-weight: normal;
      font-size: 0.95rem;
      color: var(--text-color);
    }


    /* === CARDS === */
    .card {
      background-color: #fff;
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-md);
      padding: 1.5rem;
      transition: var(--transition-medium);
      border: 1px solid #EAEAEA;
      /* Border halus */
      height: 100%;
      /* Agar kartu dalam grid sama tinggi jika perlu */
      display: flex;
      flex-direction: column;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
    }

    .card-header {
      padding-bottom: 1rem;
      margin-bottom: 1rem;
      border-bottom: 1px solid var(--neutral-light);
    }

    .card-title {
      margin-bottom: 0.5rem;
    }

    .card-body {
      flex-grow: 1;
    }

    /* Agar body kartu mengisi sisa ruang */

    /* === NAVIGATION (NAVBAR) === */
    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background-color: rgba(253, 254, 254, 0.90);
      /* Semi-transparan */
      backdrop-filter: blur(10px);
      /* Efek glassmorphism */
      box-shadow: var(--shadow-sm);
      padding: 0.8rem 0;
      /* Padding lebih ramping */
      z-index: 1000;
      transition: var(--transition-medium);
    }

    .navbar.scrolled {
      /* State navbar saat di-scroll */
      box-shadow: var(--shadow-md);
      background-color: rgba(253, 254, 254, 0.98);
    }

    .navbar-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .navbar-brand {
      display: flex;
      align-items: center;
      font-size: 1.6rem;
      /* Ukuran brand sedikit lebih besar */
      font-weight: 700;
      color: var(--neutral-dark);
    }

    .navbar-brand i {
      /* Styling ikon brand */
      color: var(--primary-color);
      margin-right: 0.6rem;
      font-size: 1.9rem;
    }

    .navbar-menu-wrapper {
      /* Wrapper untuk menu dan tombol aksi di desktop */
      display: flex;
      align-items: center;
    }

    .navbar-nav {
      list-style: none;
      display: flex;
      align-items: center;
    }

    .nav-item {
      margin-left: 1.75rem;
    }

    /* Spasi antar item menu */
    .nav-link {
      color: var(--neutral-dark);
      font-weight: 600;
      padding: 0.5rem 0.25rem;
      position: relative;
      font-size: 0.95rem;
    }

    .nav-link:hover,
    .nav-link.active {
      /* State hover dan aktif untuk link navigasi */
      color: var(--primary-color);
    }

    .nav-link::after {
      /* Underline animasi untuk link aktif/hover */
      content: '';
      position: absolute;
      bottom: -2px;
      /* Posisi underline sedikit di bawah teks */
      left: 0;
      width: 0;
      height: 2px;
      background-color: var(--primary-color);
      transition: width 0.3s ease;
    }

    .nav-link:hover::after,
    .nav-link.active::after {
      width: 100%;
    }

    .navbar-actions {
      display: flex;
      align-items: center;
      margin-left: 1.5rem;
      gap: 0.75rem;
    }

    .navbar-actions .btn {
      box-shadow: none;
    }

    /* Hilangkan shadow pada tombol navbar agar lebih clean */
    .navbar-toggler {
      /* Tombol hamburger untuk mobile */
      display: none;
      font-size: 1.5rem;
      background: none;
      border: none;
      color: var(--neutral-dark);
      cursor: pointer;
      padding: 0.5rem;
    }

    /* === HERO SECTION === */
    #hero-section {
      padding-top: 9rem;
      /* Ruang untuk navbar fixed + extra */
      padding-bottom: 5rem;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: #fff;
      position: relative;
      overflow: hidden;
      /* Untuk elemen pseudo ::before */
    }

    #hero-section::before {
      /* Overlay pattern halus */
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.08) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.07) 0%, transparent 30%);
      opacity: 0.7;
      pointer-events: none;
    }

    .hero-content-wrapper {
      display: grid;
      /* Gunakan grid untuk layout hero */
      grid-template-columns: 1fr 1fr;
      /* Dua kolom sama lebar */
      align-items: center;
      gap: 3rem;
      position: relative;
      z-index: 1;
    }

    .hero-text {
      animation: fadeInLeft 0.8s ease-out;
    }

    .hero-text h1 {
      color: #fff;
      font-size: 3.2rem;
      line-height: 1.2;
      margin-bottom: 1rem;
    }

    .hero-text p {
      color: rgba(255, 255, 255, 0.9);
      font-size: 1.15rem;
      margin-bottom: 2.5rem;
    }

    .hero-image-container {
      display: flex;
      justify-content: center;
      animation: fadeInRight 0.8s ease-out 0.2s;
      /* Animasi dengan delay */
      animation-fill-mode: backwards;
      /* Agar style awal sebelum animasi adalah opacity 0 */
    }

    .hero-image {
      max-width: 520px;
      /* Ukuran gambar hero */
      width: 100%;
      height: auto;
      border-radius: var(--border-radius-lg);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25);
      /* Shadow lebih dramatis */
      transform: perspective(1200px) rotateY(-8deg) rotateX(2deg);
      /* Efek 3D halus */
      transition: var(--transition-medium);
    }

    .hero-image:hover {
      transform: perspective(1200px) rotateY(0deg) rotateX(0deg) scale(1.03);
    }

    .hero-search-form {
      /* Form pencarian di bawah teks hero */
      background-color: rgba(255, 255, 255, 0.95);
      /* Latar belakang form sedikit transparan */
      padding: 2rem;
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-lg);
      margin-top: 2.5rem;
      animation: fadeInUp 0.6s ease-out 0.4s;
      animation-fill-mode: backwards;
    }

    .hero-search-form .form-group {
      margin-bottom: 1rem;
    }

    .hero-search-form .form-label {
      color: var(--neutral-dark);
      font-weight: 600;
    }

    .hero-search-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      /* Kolom adaptif */
      gap: 1rem;
      align-items: flex-end;
      /* Agar tombol sejajar dengan input terakhir */
    }

    .hero-search-grid .btn {
      width: 100%;
      padding-top: 0.875rem;
      padding-bottom: 0.875rem;
    }


    /* === SEARCH RESULTS SECTION === */
    .search-layout {
      display: grid;
      /* Grid untuk filter dan hasil */
      grid-template-columns: 300px 1fr;
      /* Kolom filter fixed, hasil fleksibel */
      gap: 2.5rem;
    }

    .search-filters {
      /* Styling untuk area filter */
      position: sticky;
      /* Filter tetap terlihat saat scroll */
      top: calc(60px + 1.5rem);
      /* 60px navbar height + padding */
      align-self: flex-start;
      /* Agar sticky bekerja dengan baik di grid */
      max-height: calc(100vh - 60px - 3rem);
      /* Batas tinggi agar bisa discroll internal */
      overflow-y: auto;
      padding-right: 10px;
      /* Ruang untuk scrollbar jika muncul */
    }

    .search-filters h4 i {
      margin-right: 0.5rem;
    }

    .search-results-area {
      min-width: 0;
      /* Mencegah overflow di grid item */
    }

    .search-results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      /* Kartu apartemen adaptif */
      gap: 1.5rem;
    }

    .apartment-card {
      /* Styling khusus untuk kartu apartemen */
      overflow: hidden;
      /* Agar gambar tidak keluar dari border-radius */
    }

    .apartment-card-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .apartment-card:hover .apartment-card-image {
      transform: scale(1.05);
      /* Efek zoom pada gambar saat hover kartu */
    }

    .apartment-card .card-body {
      padding: 1rem;
    }

    .apartment-card-title {
      font-size: 1.2rem;
      margin-bottom: 0.3rem;
      color: var(--primary-color);
    }

    .apartment-card-location {
      color: var(--neutral-medium);
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }

    .apartment-card-price {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--accent-color);
      margin-bottom: 0.75rem;
    }

    .apartment-card-meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: var(--neutral-medium);
      margin-bottom: 1rem;
    }

    .apartment-card .btn {
      margin-top: auto;
      font-size: 0.9rem;
      padding: 0.6rem 1.2rem;
    }

    /* Tombol di bawah kartu */
    .map-container {
      height: 350px;
      /* Tinggi peta */
      border-radius: var(--border-radius-md);
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--neutral-light);
      background-color: var(--neutral-light);
      /* Placeholder background */
    }

    /* Pagination styling */
    .pagination {
      display: flex;
      padding-left: 0;
      list-style: none;
      border-radius: var(--border-radius-md);
    }

    .page-item.disabled .page-link {
      color: var(--neutral-medium);
      pointer-events: none;
      background-color: var(--background-color);
      border-color: #dee2e6;
    }

    .page-item.active .page-link {
      z-index: 3;
      color: #fff;
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }

    .page-link {
      position: relative;
      display: block;
      padding: 0.5rem 0.75rem;
      margin-left: -1px;
      line-height: 1.25;
      color: var(--primary-color);
      background-color: #fff;
      border: 1px solid #dee2e6;
      transition: var(--transition-fast);
    }

    .page-link:hover {
      z-index: 2;
      color: var(--primary-color);
      text-decoration: none;
      background-color: #e9ecef;
      border-color: #dee2e6;
    }

    .page-item:first-child .page-link {
      margin-left: 0;
      border-top-left-radius: var(--border-radius-md);
      border-bottom-left-radius: var(--border-radius-md);
    }

    .page-item:last-child .page-link {
      border-top-right-radius: var(--border-radius-md);
      border-bottom-right-radius: var(--border-radius-md);
    }


    /* === FEATURES SECTION === */
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      /* Grid adaptif untuk fitur */
      gap: 2rem;
    }

    .feature-item {
      /* Styling untuk setiap item fitur */
      text-align: center;
      padding: 2rem 1.5rem;
      /* Padding lebih besar */
    }

    .feature-icon {
      font-size: 2.8rem;
      /* Ukuran ikon */
      color: var(--primary-color);
      margin-bottom: 1.25rem;
      display: inline-flex;
      /* Agar bisa diberi padding dan border-radius */
      align-items: center;
      justify-content: center;
      width: 70px;
      /* Ukuran container ikon */
      height: 70px;
      background-color: rgba(74, 144, 226, 0.1);
      /* Background soft untuk ikon */
      border-radius: 50%;
      /* Membuatnya bulat */
      transition: transform 0.3s ease;
    }

    .feature-item:hover .feature-icon {
      transform: scale(1.1) rotate(5deg);
      /* Efek hover pada ikon */
    }

    .feature-item h3 {
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
    }

    .feature-item p {
      color: var(--neutral-medium);
      font-size: 0.95rem;
    }


    /* === CONTACT SECTION === */
    .contact-grid {
      display: grid;
      grid-template-columns: 1fr 1.2fr;
      /* Kolom info kontak dan form */
      gap: 2.5rem;
    }

    .contact-info h4,
    .contact-form-container h4 {
      margin-bottom: 0.5rem;
    }

    .contact-info .text-neutral-medium,
    .contact-form-container .text-neutral-medium {
      margin-bottom: 1.5rem;
      font-size: 0.95rem;
    }

    .contact-info-item {
      display: flex;
      align-items: flex-start;
      /* Agar ikon dan teks sejajar atas */
      margin-bottom: 1.5rem;
    }

    .contact-info-item i {
      font-size: 1.3rem;
      /* Ukuran ikon info kontak */
      color: var(--primary-color);
      margin-right: 1rem;
      margin-top: 0.15rem;
      /* Penyesuaian vertikal ikon */
      width: 25px;
      text-align: center;
    }

    .contact-info-item h5 {
      margin-bottom: 0.25rem;
      font-size: 1.05rem;
      color: var(--neutral-dark);
    }

    .contact-info-item p {
      margin-bottom: 0;
      color: var(--neutral-medium);
      font-size: 0.95rem;
    }

    /* === PROFILE SECTION === */
    .profile-grid {
      display: grid;
      grid-template-columns: 280px 1fr;
      /* Sidebar profil dan konten utama */
      gap: 2.5rem;
    }

    .profile-sidebar h4 i {
      margin-right: 0.5rem;
    }

    .profile-nav-link {
      display: block;
      padding: 0.75rem 1rem;
      border-radius: var(--border-radius-md);
      transition: var(--transition-fast);
      font-weight: 500;
      color: var(--neutral-dark);
    }

    .profile-nav-link:hover {
      background-color: var(--neutral-light);
      color: var(--primary-color);
    }

    .profile-nav-link.active {
      background-color: var(--primary-color);
      color: #fff !important;
    }

    .profile-nav-link i {
      margin-right: 0.75rem;
      width: 20px;
      text-align: center;
    }

    .profile-tab-content {
      display: none;
    }

    /* Sembunyikan tab konten by default */
    .profile-tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease-out;
    }

    /* Tampilkan tab aktif dengan animasi */
    .profile-tab-content h4 {
      border-bottom: 1px solid var(--neutral-light);
      padding-bottom: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .table-responsive {
      overflow-x: auto;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      background-color: #fff;
      box-shadow: var(--shadow-sm);
      border-radius: var(--border-radius-md);
      overflow: hidden;
    }

    .table th,
    .table td {
      padding: 1rem 1.25rem;
      /* Padding sel tabel */
      text-align: left;
      border-bottom: 1px solid var(--neutral-light);
      font-size: 0.9rem;
      vertical-align: middle;
    }

    .table th {
      background-color: #F8F9FA;
      font-weight: 600;
      color: var(--neutral-dark);
      text-transform: uppercase;
      font-size: 0.8rem;
      letter-spacing: 0.5px;
    }

    .table tbody tr:hover {
      background-color: #F1F3F5;
    }

    .badge {
      /* Styling untuk badge status */
      display: inline-block;
      padding: 0.4em 0.75em;
      font-size: 0.75em;
      font-weight: 700;
      line-height: 1;
      color: #fff;
      text-align: center;
      white-space: nowrap;
      vertical-align: baseline;
      border-radius: var(--border-radius-full, 999px);
      /* Badge bulat */
      text-transform: uppercase;
    }

    .badge-success {
      background-color: var(--success-color);
    }

    .badge-warning {
      background-color: var(--warning-color);
      color: var(--neutral-dark);
    }

    /* Warna teks kontras untuk kuning */
    .badge-danger {
      background-color: var(--danger-color);
    }

    .badge-info {
      background-color: var(--primary-color);
    }


    /* === MODAL === */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(44, 62, 80, 0.6);
      /* Overlay lebih gelap */
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition-medium), visibility 0s var(--transition-medium);
      padding: 1rem;
      /* Padding agar modal tidak mentok tepi layar kecil */
    }

    .modal.active {
      opacity: 1;
      visibility: visible;
      transition-delay: 0s;
    }

    .modal-content {
      background-color: #fff;
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-lg);
      width: 100%;
      /* Lebar modal adaptif */
      max-width: 600px;
      /* Max width default modal */
      max-height: 90vh;
      /* Max height agar bisa discroll */
      overflow-y: auto;
      transform: translateY(-20px) scale(0.95);
      transition: transform var(--transition-medium) 0.05s, opacity var(--transition-medium) 0.05s;
      /* Transisi halus saat muncul */
    }

    .modal.active .modal-content {
      transform: translateY(0) scale(1);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--neutral-light);
    }

    .modal-title {
      font-size: 1.5rem;
      margin-bottom: 0;
      color: var(--neutral-dark);
    }

    .modal-close-btn {
      font-size: 1.8rem;
      background: none;
      border: none;
      color: var(--neutral-medium);
      cursor: pointer;
      line-height: 1;
      padding: 0.25rem;
      transition: var(--transition-fast);
    }

    .modal-close-btn:hover {
      color: var(--danger-color);
      transform: rotate(90deg) scale(1.1);
    }

    .modal-body {
      padding: 1.5rem;
    }

    .modal-footer {
      padding: 1.25rem 1.5rem;
      border-top: 1px solid var(--neutral-light);
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      background-color: #F8F9FA;
      /* Footer modal dengan bg sedikit beda */
      border-bottom-left-radius: var(--border-radius-lg);
      border-bottom-right-radius: var(--border-radius-lg);
    }

    .modal-apartment-image {
      /* Gambar di modal detail */
      width: 100%;
      height: auto;
      /* Tinggi otomatis sesuai aspek rasio */
      max-height: 350px;
      /* Batas tinggi maksimum */
      object-fit: cover;
      border-radius: var(--border-radius-md);
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow-sm);
    }

    .modal-apartment-details ul {
      list-style-type: none;
      padding-left: 0;
    }

    .modal-apartment-details li {
      margin-bottom: 0.35rem;
      display: flex;
      align-items: center;
    }

    .modal-apartment-details li i {
      margin-right: 0.6rem;
      color: var(--secondary-color);
      width: 18px;
    }

    .modal-apartment-details h5 {
      margin-top: 1.25rem;
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
      color: var(--primary-color);
      border-bottom: 1px dashed var(--neutral-light);
      padding-bottom: 0.3rem;
    }

    /* Row & Col untuk layout form di modal booking */
    .row {
      display: flex;
      flex-wrap: wrap;
      margin-left: -0.75rem;
      margin-right: -0.75rem;
    }

    .col-md-6 {
      flex: 0 0 50%;
      max-width: 50%;
      padding-left: 0.75rem;
      padding-right: 0.75rem;
    }

    @media (max-width: 767px) {

      /* Kolom jadi full width di mobile */
      .col-md-6 {
        flex: 0 0 100%;
        max-width: 100%;
      }
    }

    /* Alert untuk error di modal booking */
    .alert {
      padding: 0.75rem 1.25rem;
      margin-bottom: 1rem;
      border: 1px solid transparent;
      border-radius: var(--border-radius-sm);
    }

    .alert-danger {
      color: var(--danger-color);
      background-color: rgba(231, 76, 60, 0.1);
      border-color: var(--danger-color);
    }


    /* === FOOTER === */
    .footer {
      background-color: var(--neutral-dark);
      color: var(--neutral-light);
      padding: 3.5rem 0 2rem 0;
      /* Padding footer */
    }

    .footer-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      /* Kolom footer adaptif */
      gap: 2.5rem;
      margin-bottom: 2.5rem;
      text-align: left;
      /* Teks di kolom footer rata kiri */
    }

    .footer-col h5 {
      color: #fff;
      margin-bottom: 1.25rem;
      font-size: 1.1rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .footer-col p small,
    .footer-col address small {
      color: var(--neutral-light);
      opacity: 0.8;
      font-size: 0.85rem;
    }

    .footer-col ul {
      list-style: none;
    }

    .footer-col li {
      margin-bottom: 0.6rem;
    }

    .footer-col a {
      color: var(--neutral-light);
      opacity: 0.8;
      transition: opacity var(--transition-fast);
      font-size: 0.9rem;
    }

    .footer-col a:hover {
      opacity: 1;
      color: var(--secondary-color);
    }

    .footer-social-icons a {
      font-size: 1.2rem;
      margin-right: 1rem;
    }

    .footer-social-icons a:last-child {
      margin-right: 0;
    }

    .footer-bottom {
      border-top: 1px solid rgba(236, 240, 241, 0.2);
      /* Border pemisah lebih transparan */
      padding-top: 2rem;
      text-align: center;
      font-size: 0.85rem;
      color: var(--neutral-light);
      opacity: 0.7;
    }

    /* === FLOATING ACTION BUTTON (FAB) === */
    .fab-to-top {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      box-shadow: var(--shadow-lg);
      cursor: pointer;
      transition: var(--transition-medium);
      z-index: 900;
      opacity: 0;
      visibility: hidden;
      transform: translateY(30px) scale(0.8);
      /* Animasi muncul lebih menarik */
    }

    .fab-to-top.visible {
      opacity: 1;
      visibility: visible;
      transform: translateY(0) scale(1);
    }

    .fab-to-top:hover {
      transform: scale(1.1) rotate(-5deg);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }

    /* === NOTIFICATION/TOAST === */
    .notification-toast {
      position: fixed;
      bottom: -100px;
      /* Mulai dari luar layar */
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--neutral-dark);
      color: #fff;
      padding: 1rem 1.5rem;
      border-radius: var(--border-radius-md);
      box-shadow: var(--shadow-lg);
      z-index: 3000;
      opacity: 0;
      transition: opacity 0.3s, bottom 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      /* Transisi dengan easing */
      min-width: 280px;
      text-align: center;
    }

    .notification-toast.show {
      opacity: 1;
      bottom: 2rem;
      /* Posisi akhir saat terlihat */
    }

    .notification-toast.success {
      background-color: var(--success-color);
    }

    .notification-toast.error {
      background-color: var(--danger-color);
    }

    .notification-toast.info {
      background-color: var(--primary-color);
    }

    /* === CUSTOM SCROLLBAR === */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: var(--neutral-light);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: var(--border-radius-sm);
      border: 2px solid var(--neutral-light);
    }

    /* Tambah border agar thumb terlihat 'mengambang' */
    ::-webkit-scrollbar-thumb:hover {
      background: #3A7BC8;
    }

    /* === ANIMASI SEDERHANA === */
    @keyframes fadeInLeft {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes fadeInRight {
      from {
        opacity: 0;
        transform: translateX(30px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    /* === RESPONSIVE DESIGN === */
    @media (max-width: 992px) {

      /* Tablet dan di bawahnya */
      .hero-content-wrapper {
        grid-template-columns: 1fr;
        text-align: center;
      }

      /* Hero jadi satu kolom */
      .hero-text {
        order: 2;
      }

      /* Teks di bawah gambar */
      .hero-image-container {
        order: 1;
        margin-bottom: 2.5rem;
      }

      .hero-image {
        transform: perspective(1000px) rotateY(0deg) rotateX(0deg);
        max-width: 450px;
      }

      .search-layout {
        grid-template-columns: 1fr;
      }

      /* Filter dan hasil jadi satu kolom */
      .search-filters {
        position: static;
        max-height: none;
        overflow-y: visible;
        margin-bottom: 2rem;
        padding-right: 0;
      }

      .profile-grid {
        grid-template-columns: 1fr;
      }

      .profile-sidebar {
        margin-bottom: 2rem;
      }

      .contact-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {

      /* Mobile */
      html {
        font-size: 15px;
      }

      .section {
        padding: 3rem 0;
      }

      h1 {
        font-size: 2.5rem;
      }

      .hero-text h1 {
        font-size: 2.5rem;
      }

      .navbar-menu-wrapper {
        /* Sembunyikan menu wrapper di mobile, yang diatur adalah #navbarMenuLinks */
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        background-color: #fff;
        flex-direction: column;
        align-items: stretch;
        /* Item menu full width */
        padding: 0;
        /* Awalnya padding 0, diatur saat active */
        box-shadow: var(--shadow-md);
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.35s ease-out, padding 0.35s ease-out;
      }

      .navbar-menu-wrapper.active {
        max-height: calc(100vh - 60px);
        /* Tinggi maksimal menu mobile */
        padding: 1rem;
        /* Padding saat menu aktif */
      }

      .navbar-nav {
        flex-direction: column;
        align-items: stretch;
        width: 100%;
      }

      .nav-item {
        margin-left: 0;
        width: 100%;
      }

      .nav-link {
        padding: 0.85rem 1rem;
        display: block;
        width: 100%;
        border-bottom: 1px solid var(--neutral-light);
      }

      .nav-item:last-child .nav-link {
        border-bottom: none;
      }

      .nav-link::after {
        display: none;
      }

      .navbar-actions {
        /* Tombol aksi di mobile */
        width: 100%;
        flex-direction: column;
        gap: 0.75rem;
        margin-left: 0;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid var(--neutral-light);
      }

      .navbar-actions .btn {
        width: 100%;
      }

      .navbar-toggler {
        display: block;
      }

      .hero-search-grid {
        grid-template-columns: 1fr;
      }

      .modal-content {
        width: 95%;
        max-height: 95vh;
      }

      .footer-grid {
        grid-template-columns: 1fr;
        text-align: center;
      }

      /* Footer satu kolom di mobile */
      .footer-col ul {
        padding-left: 0;
      }
    }
  </style>
</head>

<body>

  <!-- NAVIGASI UTAMA -->
  <nav class="navbar" id="mainNavbar" role="navigation" aria-label="Navigasi Utama">
    <div class="container navbar-container">
      <a href="#hero-section" class="navbar-brand nav-spa-link">
        <i class="fas fa-building-user"></i>RentalPro
      </a>
      <button class="navbar-toggler" id="navbarToggler" aria-label="Toggle navigasi" aria-expanded="false"
        aria-controls="navbarMenuWrapper">
        <i class="fas fa-bars"></i>
      </button>
      <div class="navbar-menu-wrapper" id="navbarMenuWrapper">
        <ul class="navbar-nav" id="navbarMenuLinks">
          <li class="nav-item"><a href="#hero-section" class="nav-link nav-spa-link active">Beranda</a></li>
          <li class="nav-item"><a href="#search-section" class="nav-link nav-spa-link">Cari Apartemen</a></li>
          <li class="nav-item"><a href="#features-section" class="nav-link nav-spa-link">Fitur</a></li>
          <li class="nav-item"><a href="#contact-section" class="nav-link nav-spa-link">Kontak</a></li>
          <li class="nav-item"><a href="#profile-section" class="nav-link nav-spa-link">Profil</a></li>
        </ul>
        <div class="navbar-actions" id="navbarAuthActions">
          <!-- Tombol login/logout akan di-render oleh JS -->
        </div>
      </div>
    </div>
  </nav>

  <!-- KONTEN UTAMA (Untuk SPA) -->
  <main id="appRoot">

    <!-- BAGIAN HERO (BERANDA) -->
    <section id="hero-section" class="section active" data-page="hero-section">
      <div class="container">
        <div class="hero-content-wrapper">
          <div class="hero-text">
            <h1>Temukan Apartemen Impian Anda, Lebih Mudah!</h1>
            <p>Platform terintegrasi untuk pencarian, pemesanan, dan manajemen sewa apartemen. Aman, cepat, dan
              terpercaya.</p>
            <a href="#search-section" class="btn btn-primary btn-lg nav-spa-link">
              <i class="fas fa-search"></i> Mulai Cari Sekarang
            </a>
          </div>
          <div class="hero-image-container">
            <img
              src="https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&auto=format&fit=crop&w=520&q=80"
              alt="Interior apartemen modern dan nyaman" class="hero-image" loading="lazy">
          </div>
        </div>
        <form id="heroSearchForm" class="hero-search-form card">
          <div class="hero-search-grid">
            <div class="form-group">
              <label for="heroLocation" class="form-label">Lokasi</label>
              <input type="text" id="heroLocation" class="form-control" placeholder="cth: Jakarta Pusat"
                aria-label="Lokasi apartemen">
            </div>
            <div class="form-group">
              <label for="heroCheckIn" class="form-label">Check-In</label>
              <input type="date" id="heroCheckIn" class="form-control" aria-label="Tanggal check-in">
            </div>
            <div class="form-group">
              <label for="heroCheckOut" class="form-label">Check-Out</label>
              <input type="date" id="heroCheckOut" class="form-control" aria-label="Tanggal check-out">
            </div>
            <div class="form-group">
              <button type="submit" class="btn btn-secondary w-100"><i class="fas fa-search"></i> Cari</button>
            </div>
          </div>
        </form>
      </div>
    </section>

    <!-- BAGIAN PENCARIAN APARTEMEN -->
    <section id="search-section" class="section" data-page="search-section">
      <div class="container">
        <div class="section-title">
          <h2>Pencarian Apartemen</h2>
          <p>Gunakan filter untuk menemukan apartemen yang paling sesuai dengan preferensi Anda.</p>
        </div>
        <div class="search-layout">
          <aside class="search-filters card">
            <h4><i class="fas fa-filter"></i> Filter Pencarian</h4>
            <hr class="mb-3 mt-2">
            <form id="mainSearchForm">
              <div class="form-group">
                <label for="searchLocation" class="form-label">Lokasi</label>
                <input type="text" id="searchLocation" class="form-control" placeholder="Kota atau area spesifik">
              </div>
              <div class="form-group">
                <label for="searchPriceRange" class="form-label">Rentang Harga (per bulan)</label>
                <select id="searchPriceRange" class="form-control form-select">
                  <option value="">Semua Harga</option>
                  <option value="0-5000000">Rp 0 - Rp 5.000.000</option>
                  <option value="5000000-10000000">Rp 5.000.000 - Rp 10.000.000</option>
                  <option value="10000000-15000000">Rp 10.000.000 - Rp 15.000.000</option>
                  <option value="15000000-+">Diatas Rp 15.000.000</option> <!-- Perbaikan value -->
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Fasilitas</label>
                <div id="searchAmenitiesCheckboxes"
                  style="max-height: 200px; overflow-y:auto; padding: 5px; border: 1px solid var(--neutral-light); border-radius: var(--border-radius-sm);">
                  <!-- Checkbox fasilitas akan di-generate oleh JS -->
                </div>
              </div>
              <div class="form-group">
                <label for="searchApartmentType" class="form-label">Tipe Apartemen</label>
                <select id="searchApartmentType" class="form-control form-select">
                  <option value="">Semua Tipe</option>
                  <option value="studio">Studio</option>
                  <option value="1br">1 Kamar Tidur</option>
                  <option value="2br">2 Kamar Tidur</option>
                  <option value="3br+">3+ Kamar Tidur</option>
                </select>
              </div>
              <button type="submit" class="btn btn-primary w-100"><i class="fas fa-sliders-h"></i> Terapkan
                Filter</button>
            </form>
          </aside>
          <div class="search-results-area">
            <div id="mapSearchResults" class="map-container">
              <p class="text-neutral-medium text-center mt-4">Peta akan dimuat di sini...</p>
            </div>
            <div id="searchResultsContainer" class="search-results-grid">
              <p class="text-neutral-medium col-span-full text-center">Silakan gunakan filter untuk memulai pencarian
                atau tunggu data dimuat.</p>
            </div>
            <div id="searchPagination" class="mt-4 d-flex justify-content-center">
              <!-- Tombol pagination akan dimuat di sini -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- BAGIAN FITUR -->
    <section id="features-section" class="section section-bg-light" data-page="features-section">
      <div class="container">
        <div class="section-title">
          <h2>Fitur Unggulan RentalPro</h2>
          <p>Kami menyediakan berbagai fitur untuk memudahkan pengalaman sewa apartemen Anda.</p>
        </div>
        <div class="features-grid">
          <div class="feature-item card">
            <div class="feature-icon"><i class="fas fa-search-location"></i></div>
            <h3>Pencarian Cerdas</h3>
            <p>Filter lanjutan untuk menemukan apartemen berdasarkan lokasi, harga, fasilitas, dan tipe unit secara
              presisi.</p>
          </div>
          <div class="feature-item card">
            <div class="feature-icon"><i class="fas fa-vr-cardboard"></i></div>
            <h3>Tur Virtual 360°</h3>
            <p>Lihat detail setiap sudut apartemen melalui tur virtual interaktif sebelum Anda berkunjung langsung (jika
              tersedia).</p>
          </div>
          <div class="feature-item card">
            <div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
            <h3>Transaksi Aman</h3>
            <p>Sistem pembayaran terverifikasi dan terenkripsi untuk menjamin keamanan setiap transaksi Anda (via
              Stripe).</p>
          </div>
          <div class="feature-item card">
            <div class="feature-icon"><i class="fas fa-comments"></i></div>
            <h3>Ulasan Terpercaya</h3>
            <p>Baca ulasan dari penyewa sebelumnya untuk membantu Anda membuat keputusan yang lebih baik (fitur
              mendatang).</p>
          </div>
          <div class="feature-item card">
            <div class="feature-icon"><i class="fas fa-calendar-check"></i></div>
            <h3>Manajemen Pemesanan</h3>
            <p>Kelola jadwal kunjungan, kontrak sewa, dan pembayaran Anda dengan mudah dalam satu dasbor profil.</p>
          </div>
          <div class="feature-item card">
            <div class="feature-icon"><i class="fas fa-headset"></i></div>
            <h3>Dukungan 24/7</h3>
            <p>Tim dukungan pelanggan kami siap membantu Anda kapan saja melalui berbagai saluran komunikasi.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- BAGIAN KONTAK -->
    <section id="contact-section" class="section" data-page="contact-section">
      <div class="container">
        <div class="section-title">
          <h2>Hubungi Kami</h2>
          <p>Punya pertanyaan atau butuh bantuan? Jangan ragu untuk menghubungi tim RentalPro.</p>
        </div>
        <div class="contact-grid">
          <div class="contact-info card">
            <h4>Informasi Kontak</h4>
            <p class="text-neutral-medium">Kami siap melayani Anda.</p>
            <div class="contact-info-item">
              <i class="fas fa-map-marker-alt"></i>
              <div>
                <h5>Alamat Kantor</h5>
                <p>Jl. Properti Digital No. 123, Cyberpark, Jakarta 12345, Indonesia</p>
              </div>
            </div>
            <div class="contact-info-item">
              <i class="fas fa-phone-alt"></i>
              <div>
                <h5>Telepon</h5>
                <p><a href="tel:+62215550123" class="text-primary">+62 21 555 0123</a> (Jam Kerja)</p>
              </div>
            </div>
            <div class="contact-info-item">
              <i class="fas fa-envelope"></i>
              <div>
                <h5>Email</h5>
                <p><a href="mailto:dukungan@rentalpro.id" class="text-primary">dukungan@rentalpro.id</a></p>
              </div>
            </div>
            <div class="contact-info-item">
              <i class="fas fa-clock"></i>
              <div>
                <h5>Jam Operasional</h5>
                <p>Senin - Jumat: 09:00 - 17:00 WIB</p>
              </div>
            </div>
          </div>
          <div class="contact-form-container card">
            <h4>Kirim Pesan Langsung</h4>
            <p class="text-neutral-medium">Isi formulir di bawah ini dan kami akan segera merespons.</p>
            <form id="contactForm">
              <div class="form-group">
                <label for="contactName" class="form-label">Nama Lengkap Anda</label>
                <input type="text" id="contactName" class="form-control" placeholder="Masukkan nama Anda" required>
              </div>
              <div class="form-group">
                <label for="contactEmail" class="form-label">Alamat Email</label>
                <input type="email" id="contactEmail" class="form-control" placeholder="email@anda.com" required>
              </div>
              <div class="form-group">
                <label for="contactSubject" class="form-label">Subjek Pesan</label>
                <input type="text" id="contactSubject" class="form-control" placeholder="Subjek pesan Anda" required>
              </div>
              <div class="form-group">
                <label for="contactMessage" class="form-label">Isi Pesan</label>
                <textarea id="contactMessage" class="form-control" rows="5" placeholder="Tuliskan pesan Anda di sini..."
                  required></textarea>
              </div>
              <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Kirim Pesan</button>
            </form>
          </div>
        </div>
      </div>
    </section>

    <!-- BAGIAN PROFIL PENGGUNA -->
    <section id="profile-section" class="section" data-page="profile-section">
      <div class="container">
        <div id="profileContentArea">
          <!-- Konten profil akan dirender di sini berdasarkan status login -->
        </div>
      </div>
    </section>
  </main>

  <!-- TEMPLATE UNTUK KONTEN PROFIL (JIKA USER LOGIN) -->
  <template id="loggedInProfileTemplate">
    <div class="section-title">
      <h2>Profil Pengguna</h2>
      <p>Kelola informasi akun dan riwayat pemesanan Anda di sini.</p>
    </div>
    <div class="profile-grid">
      <aside class="profile-sidebar card">
        <h4><i class="fas fa-user-circle"></i> Navigasi Profil</h4>
        <ul class="list-unstyled mt-3">
          <li class="mb-2"><a href="#" class="profile-nav-link active" data-profile-tab="info"><i
                class="fas fa-id-card"></i> Informasi Akun</a></li>
          <li class="mb-2"><a href="#" class="profile-nav-link" data-profile-tab="bookings"><i
                class="fas fa-history"></i> Riwayat Pemesanan</a></li>
          <li class="mb-2"><a href="#" class="profile-nav-link" data-profile-tab="settings"><i class="fas fa-cog"></i>
              Pengaturan Akun</a></li>
          <li>
            <hr class="my-2"><a href="#" id="logoutButton" class="profile-nav-link text-danger"><i
                class="fas fa-sign-out-alt"></i> Keluar</a>
          </li>
        </ul>
      </aside>
      <div class="profile-content"> <!-- Wrapper untuk tab konten -->
        <div id="profileInfoTab" class="profile-tab-content card active"> <!-- `active` di sini untuk tab default -->
          <h4>Informasi Akun</h4>
          <form id="profileUpdateForm">
            <div class="form-group">
              <label for="profileFullName" class="form-label">Nama Lengkap</label>
              <input type="text" id="profileFullName" class="form-control" value="Pengguna Demo" required>
            </div>
            <div class="form-group">
              <label for="profileEmail" class="form-label">Alamat Email</label>
              <input type="email" id="profileEmail" class="form-control" value="demo@rentalpro.id" required readonly>
              <small class="text-neutral-medium">Email tidak dapat diubah.</small>
            </div>
            <div class="form-group">
              <label for="profilePhone" class="form-label">Nomor Telepon</label>
              <input type="tel" id="profilePhone" class="form-control" placeholder="+62 812 xxxx xxxx">
            </div>
            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Simpan Perubahan</button>
          </form>
        </div>

        <div id="profileBookingsTab" class="profile-tab-content card">
          <h4>Riwayat Pemesanan</h4>
          <div id="bookingHistoryContainer" class="table-responsive">
            <p class="text-neutral-medium">Tidak ada riwayat pemesanan.</p>
          </div>
        </div>

        <div id="profileSettingsTab" class="profile-tab-content card">
          <h4>Pengaturan Akun</h4>
          <form id="passwordChangeForm">
            <h5>Ubah Kata Sandi</h5>
            <div class="form-group mt-2">
              <label for="currentPassword" class="form-label">Kata Sandi Saat Ini</label>
              <input type="password" id="currentPassword" class="form-control" required>
            </div>
            <div class="form-group">
              <label for="newPassword" class="form-label">Kata Sandi Baru</label>
              <input type="password" id="newPassword" class="form-control" required minlength="8">
            </div>
            <div class="form-group">
              <label for="confirmNewPassword" class="form-label">Konfirmasi Kata Sandi Baru</label>
              <input type="password" id="confirmNewPassword" class="form-control" required minlength="8">
            </div>
            <button type="submit" class="btn btn-primary"><i class="fas fa-key"></i> Ubah Kata Sandi</button>
          </form>
          <hr class="my-4">
          <h5>Preferensi Notifikasi Email</h5>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="emailPromo" checked>
            <label class="form-check-label" for="emailPromo">
              Terima email promosi dan update terbaru RentalPro.
            </label>
          </div>
          <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" value="" id="emailBooking" checked>
            <label class="form-check-label" for="emailBooking">
              Terima notifikasi email terkait status pemesanan.
            </label>
          </div>
          <button class="btn btn-secondary mt-3" id="saveNotificationPrefs"><i class="fas fa-bell"></i> Simpan
            Preferensi</button>
        </div>
      </div>
    </div>
  </template>

  <!-- TEMPLATE UNTUK KONTEN PROFIL (JIKA USER BELUM LOGIN) -->
  <template id="loggedOutProfileTemplate">
    <div class="section-title">
      <h2>Profil Pengguna</h2>
      <p>Untuk mengakses halaman profil, silakan masuk atau daftar terlebih dahulu.</p>
    </div>
    <div class="text-center">
      <button class="btn btn-primary btn-lg mr-2" data-modal-target="loginModal"><i class="fas fa-sign-in-alt"></i>
        Masuk</button>
      <button class="btn btn-secondary btn-lg" data-modal-target="registerModal"><i class="fas fa-user-plus"></i> Daftar
        Sekarang</button>
    </div>
  </template>


  <!-- MODAL: LOGIN -->
  <div class="modal" id="loginModal">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Masuk ke Akun Anda</h4>
        <button class="modal-close-btn" data-modal-dismiss="loginModal" aria-label="Tutup">&times;</button>
      </div>
      <div class="modal-body">
        <form id="loginForm">
          <div class="form-group">
            <label for="loginEmail" class="form-label">Email</label>
            <input type="email" id="loginEmail" class="form-control" placeholder="email@anda.com" required>
          </div>
          <div class="form-group">
            <label for="loginPassword" class="form-label">Kata Sandi</label>
            <input type="password" id="loginPassword" class="form-control" placeholder="Masukkan kata sandi" required>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="loginRememberMe">
              <label class="form-check-label" for="loginRememberMe">Ingat saya</label>
            </div>
            <a href="#" class="text-primary"><small>Lupa kata sandi?</small></a>
          </div>
          <button type="submit" class="btn btn-primary w-100">Masuk</button>
        </form>
        <p class="text-center mt-3 text-neutral-medium">Belum punya akun? <a href="#"
            class="text-secondary font-weight-bold" data-modal-switch="loginModal,registerModal">Daftar di sini</a></p>
      </div>
    </div>
  </div>

  <!-- MODAL: REGISTER -->
  <div class="modal" id="registerModal">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Buat Akun Baru</h4>
        <button class="modal-close-btn" data-modal-dismiss="registerModal" aria-label="Tutup">&times;</button>
      </div>
      <div class="modal-body">
        <form id="registerForm">
          <div class="form-group">
            <label for="registerFullName" class="form-label">Nama Lengkap</label>
            <input type="text" id="registerFullName" class="form-control" placeholder="Nama lengkap Anda" required>
          </div>
          <div class="form-group">
            <label for="registerEmail" class="form-label">Email</label>
            <input type="email" id="registerEmail" class="form-control" placeholder="email@anda.com" required>
          </div>
          <div class="form-group">
            <label for="registerPassword" class="form-label">Kata Sandi</label>
            <input type="password" id="registerPassword" class="form-control" placeholder="Minimal 8 karakter" required
              minlength="8">
          </div>
          <div class="form-group">
            <label for="registerConfirmPassword" class="form-label">Konfirmasi Kata Sandi</label>
            <input type="password" id="registerConfirmPassword" class="form-control" placeholder="Ulangi kata sandi"
              required minlength="8">
          </div>
          <div class="form-check mb-3">
            <input type="checkbox" class="form-check-input" id="registerTerms" required>
            <label class="form-check-label" for="registerTerms">Saya setuju dengan <a href="#"
                class="text-primary">Syarat & Ketentuan</a> RentalPro.</label>
          </div>
          <button type="submit" class="btn btn-primary w-100">Daftar</button>
        </form>
        <p class="text-center mt-3 text-neutral-medium">Sudah punya akun? <a href="#"
            class="text-secondary font-weight-bold" data-modal-switch="registerModal,loginModal">Masuk di sini</a></p>
      </div>
    </div>
  </div>

  <!-- MODAL: DETAIL APARTEMEN -->
  <div class="modal" id="apartmentDetailModal">
    <div class="modal-content" style="max-width: 800px;"> <!-- Modal detail bisa lebih lebar -->
      <div class="modal-header">
        <h4 class="modal-title" id="detailApartmentTitle">Detail Apartemen</h4>
        <button class="modal-close-btn" data-modal-dismiss="apartmentDetailModal" aria-label="Tutup">&times;</button>
      </div>
      <div class="modal-body" id="detailApartmentBody">
        <p class="text-center"><i class="fas fa-spinner fa-spin fa-2x text-primary"></i><br>Memuat detail apartemen...
        </p>
      </div>
      <div class="modal-footer" id="detailApartmentFooter" style="display:none;">
        <span id="detailApartmentPriceFooter" class="font-weight-bold h5 mb-0 mr-auto align-self-center"></span>
        <button class="btn btn-secondary" data-modal-dismiss="apartmentDetailModal">Tutup</button>
        <button class="btn btn-primary" id="bookApartmentButton"><i class="fas fa-calendar-plus"></i> Pesan
          Sekarang</button>
      </div>
    </div>
  </div>

  <!-- MODAL: BOOKING -->
  <div class="modal" id="bookingModal">
    <div class="modal-content" style="max-width: 650px;">
      <div class="modal-header">
        <h4 class="modal-title" id="bookingModalTitle">Formulir Pemesanan</h4>
        <button class="modal-close-btn" data-modal-dismiss="bookingModal" aria-label="Tutup">&times;</button>
      </div>
      <div class="modal-body">
        <form id="bookingForm">
          <input type="hidden" id="bookingApartmentId">
          <div class="card mb-3"
            style="background-color: var(--neutral-light); box-shadow:none; border: 1px solid var(--primary-color);">
            <div class="card-body p-3">
              <p id="bookingApartmentInfo" class="mb-0">Anda akan memesan: <strong>Nama Apartemen</strong></p>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="bookingFullName" class="form-label">Nama Lengkap Pemesan</label>
                <input type="text" id="bookingFullName" class="form-control" required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="bookingEmail" class="form-label">Email</label>
                <input type="email" id="bookingEmail" class="form-control" required>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="bookingCheckInDate" class="form-label">Tanggal Check-In</label>
                <input type="date" id="bookingCheckInDate" class="form-control" required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="bookingCheckOutDate" class="form-label">Tanggal Check-Out</label>
                <input type="date" id="bookingCheckOutDate" class="form-control" required>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="bookingGuests" class="form-label">Jumlah Tamu</label>
            <input type="number" id="bookingGuests" class="form-control" min="1" value="1" required>
          </div>
          <div class="form-group">
            <label class="form-label">Detail Pembayaran</label>
            <div id="stripeCardElement" class="form-control"
              style="padding: 0.875rem 1rem; min-height: 50px; display:flex; align-items:center;">
              <!-- Stripe Card Element akan dimasukkan di sini oleh JS -->
            </div>
            <small class="text-neutral-medium d-block mt-1">Pembayaran aman diproses melalui Stripe (Mode Uji
              Coba).</small>
          </div>
          <div id="bookingError" class="alert alert-danger mt-3" style="display: none;"></div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-primary" data-modal-dismiss="bookingModal">Batal</button>
        <button type="submit" form="bookingForm" class="btn btn-primary" id="confirmBookingButton">
          <i class="fas fa-check-circle"></i> Konfirmasi & Bayar
        </button>
      </div>
    </div>
  </div>


  <!-- FOOTER -->
  <footer class="footer">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-col">
          <h5><i class="fas fa-building-user"></i> RentalPro</h5>
          <p><small>Platform terpercaya untuk kebutuhan sewa apartemen Anda. Temukan kenyamanan dan kemudahan dalam
              setiap transaksi.</small></p>
          <div class="mt-3 footer-social-icons">
            <a href="#" class="text-neutral-light" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
            <a href="#" class="text-neutral-light" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
            <a href="#" class="text-neutral-light" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
            <a href="#" class="text-neutral-light" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
          </div>
        </div>
        <div class="footer-col">
          <h5>Navigasi Cepat</h5>
          <ul class="list-unstyled">
            <li><a href="#hero-section" class="nav-spa-link">Beranda</a></li>
            <li><a href="#search-section" class="nav-spa-link">Cari Apartemen</a></li>
            <li><a href="#features-section" class="nav-spa-link">Fitur Kami</a></li>
            <li><a href="#contact-section" class="nav-spa-link">Hubungi Kami</a></li>
            <li><a href="#">Blog (Segera Hadir)</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h5>Legal & Bantuan</h5>
          <ul class="list-unstyled">
            <li><a href="#">Kebijakan Privasi</a></li>
            <li><a href="#">Syarat dan Ketentuan</a></li>
            <li><a href="#">Kebijakan Cookie</a></li>
            <li><a href="#">Pusat Bantuan (FAQ)</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h5>Kontak Kami</h5>
          <address class="text-neutral-light" style="font-style: normal;">
            <small>
              Jl. Properti Digital No. 123<br>
              Cyberpark, Jakarta 12345, Indonesia<br>
              Email: <a href="mailto:info@rentalpro.id" class="text-secondary">info@rentalpro.id</a><br>
              Telepon: <a href="tel:+62215550123" class="text-secondary">+62 21 555 0123</a>
            </small>
          </address>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; <span id="currentYear"></span> RentalPro. Semua hak cipta dilindungi undang-undang. Didesain dan
          dikembangkan dengan <i class="fas fa-heart text-danger"></i> untuk kemudahan Anda.</p>
      </div>
    </div>
  </footer>

  <!-- TOMBOL SCROLL KE ATAS (FAB) -->
  <button class="fab-to-top" id="fabToTop" title="Kembali ke atas" aria-label="Kembali ke atas">
    <i class="fas fa-arrow-up"></i>
  </button>

  <!-- NOTIFIKASI TOAST -->
  <div class="notification-toast" id="notificationToast">
    <span id="notificationMessage">Pesan notifikasi.</span>
  </div>

  <!-- LEAFLET JS (Untuk Peta Interaktif) -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <!-- STRIPE JS (Untuk Pembayaran) -->
  <script src="https://js.stripe.com/v3/"></script>

  <script>
    // === KONFIGURASI DAN STATE APLIKASI ===
    const APP_CONFIG = {
      defaultPage: 'hero-section',
      // PENTING: GANTI DENGAN KUNCI PUBLIK STRIPE ANDA YANG VALID (TEST KEY)
      stripePublicKey: 'pk_test_XXXXXXXXXXXXXXXXXXXXXXXX',
      mapDefaultCoords: [-6.200000, 106.816666], // Koordinat default (Jakarta)
      mapDefaultZoom: 11,
      itemsPerPage: 6, // Jumlah item per halaman untuk paginasi hasil pencarian
    };

    // State aplikasi yang akan menyimpan data dinamis
    let appState = {
      currentPage: APP_CONFIG.defaultPage,
      apartments: [], // Akan diisi dengan data apartemen dari DUMMY_APARTMENTS
      filteredApartments: [], // Hasil filter pencarian
      activeFilters: {}, // Filter yang sedang aktif
      currentUser: null, // Menyimpan data pengguna yang login. Contoh: { id: 'user123', name: 'Pengguna Demo', email: 'demo@rentalpro.id', phone: '+6281234567890' }
      bookings: [], // Menyimpan riwayat pemesanan. Contoh: { id: 'BOOK123', apartmentId: 1, apartmentTitle: '...', checkInDate: '...', status: 'Terkonfirmasi' }
      searchMapInstance: null, // Instance peta Leaflet untuk halaman pencarian
      detailMapInstance: null, // Instance peta Leaflet untuk modal detail
      currentPageNumber: 1, // Halaman saat ini untuk paginasi hasil pencarian
      stripeInstance: null, // Instance Stripe
      stripeCardElement: null, // Elemen kartu Stripe
    };

    // === DATA DUMMY (UNTUK SIMULASI) ===
    // Data apartemen dummy
    const DUMMY_APARTMENTS = [
      { id: 1, title: 'Apartemen Sudirman Park View', location: 'Jakarta Pusat', price: 12000000, type: '2br', rating: 4.5, image: 'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80', lat: -6.2088, lng: 106.8456, amenities: ['wifi', 'pool', 'gym', 'parking', 'ac', 'kitchen'], description: 'Apartemen mewah 2 kamar tidur dengan pemandangan kota yang menakjubkan, fasilitas lengkap dan lokasi strategis di jantung kota Jakarta. Interior modern dan elegan, cocok untuk profesional maupun keluarga kecil.', policies: 'Dilarang merokok di dalam unit. Dilarang membawa hewan peliharaan. Check-in setelah jam 14:00, Check-out sebelum jam 12:00. Deposit keamanan Rp 2.000.000.', virtualTourUrl: 'https://www.example.com/virtualtour/1' },
      { id: 2, title: 'Studio Cozy Kemang Village', location: 'Jakarta Selatan', price: 7500000, type: 'studio', rating: 4.2, image: 'https://images.unsplash.com/photo-1493809842364-78817add7ffb?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80', lat: -6.2589, lng: 106.8071, amenities: ['wifi', 'ac', 'kitchen', 'security'], description: 'Studio modern dan nyaman di area Kemang yang trendi. Sempurna untuk profesional muda atau pasangan. Dilengkapi dengan perabotan berkualitas dan akses mudah ke pusat perbelanjaan serta hiburan.', policies: 'Maksimal 2 tamu. Kebijakan pembatalan fleksibel hingga 7 hari sebelum check-in. Dilarang mengadakan pesta.', virtualTourUrl: null },
      { id: 3, title: 'Apartemen Keluarga Green Bay Pluit', location: 'Jakarta Utara', price: 9000000, type: '3br+', rating: 4.0, image: 'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80', lat: -6.1150, lng: 106.7812, amenities: ['pool', 'playground', 'security', 'parking', 'ac'], description: 'Apartemen luas dengan 3 kamar tidur, cocok untuk keluarga. Akses langsung ke mall dan pemandangan laut yang indah. Fasilitas anak-anak lengkap.', policies: 'Deposit keamanan diperlukan. Minimal sewa 6 bulan. Hewan peliharaan kecil diizinkan dengan persetujuan.', virtualTourUrl: 'https://www.example.com/virtualtour/3' },
      { id: 4, title: 'Apartemen Minimalis BSD City', location: 'Tangerang Selatan', price: 6000000, type: '1br', rating: 4.3, image: 'https://images.unsplash.com/photo-1515263487990-61b07816b324?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80', lat: -6.3015, lng: 106.6528, amenities: ['wifi', 'parking', 'ac', 'gym'], description: 'Apartemen 1 kamar tidur dengan desain minimalis modern di kawasan berkembang BSD City. Dekat dengan pusat bisnis, universitas, dan hiburan. Lingkungan yang tenang dan aman.', policies: 'Cocok untuk mahasiswa atau karyawan. Tidak untuk keluarga dengan anak kecil.', virtualTourUrl: null },
      { id: 5, title: 'Penthouse Mewah Kuningan', location: 'Jakarta Selatan', price: 25000000, type: '3br+', rating: 4.9, image: 'https://images.unsplash.com/photo-1616047006789-b7af525920e8?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80', lat: -6.2268, lng: 106.8272, amenities: ['wifi', 'pool', 'gym', 'private_lift', 'jacuzzi', 'spa', 'parking', 'security'], description: 'Penthouse eksklusif dengan fasilitas premium dan pemandangan 360 derajat kota Jakarta. Layanan concierge pribadi tersedia 24 jam. Interior dirancang oleh desainer ternama.', policies: 'Hanya untuk penyewa jangka panjang (minimal 1 tahun). Verifikasi identitas dan finansial ketat.', virtualTourUrl: 'https://www.example.com/virtualtour/5' },
      { id: 6, title: 'Apartemen Modern Thamrin Residence', location: 'Jakarta Pusat', price: 10000000, type: '1br', rating: 4.1, image: 'https://images.unsplash.com/photo-1580041061241-772148589985?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80', lat: -6.1930, lng: 106.8204, amenities: ['wifi', 'pool', 'gym', 'security', 'ac', 'kitchen'], description: 'Apartemen 1 kamar tidur yang elegan di pusat kota, dekat dengan pusat perbelanjaan Grand Indonesia dan Plaza Indonesia, serta transportasi umum (MRT, TransJakarta).', policies: 'Tidak ada pesta atau acara besar. Tamu harus didaftarkan. Dilarang merokok.', virtualTourUrl: null },
      { id: 7, title: 'Apartemen Bassura City Nyaman', location: 'Jakarta Timur', price: 4500000, type: 'studio', rating: 3.9, image: 'https://images.unsplash.com/photo-1594495894542-a46159b0df08?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80', lat: -6.2283, lng: 106.8818, amenities: ['ac', 'kitchen', 'pool', 'parking'], description: 'Studio fungsional di kompleks apartemen Bassura City dengan akses mudah ke fasilitas umum, pusat perbelanjaan, dan transportasi. Pilihan ekonomis untuk tinggal di Jakarta.', policies: 'Cocok untuk budget terbatas. Pembayaran bulanan di muka. Dilarang membawa hewan.', virtualTourUrl: null },
      { id: 8, title: 'Apartemen Eksklusif Pakubuwono', location: 'Jakarta Selatan', price: 30000000, type: '3br+', rating: 4.8, image: 'https://images.unsplash.com/photo-1613553497126-4504848895fa?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80', lat: -6.2384, lng: 106.7890, amenities: ['wifi', 'pool', 'gym', 'tennis_court', 'spa', 'private_lift', 'security', 'parking'], description: 'Hunian prestisius dengan standar internasional, menawarkan privasi dan kemewahan tak tertandingi di kawasan elit Pakubuwono. Unit luas dengan material berkualitas tinggi.', policies: 'Sewa minimal 1 tahun. Referensi dan deposit besar diperlukan.', virtualTourUrl: 'https://www.example.com/virtualtour/8' },
      // Tambahkan 2 data lagi untuk paginasi
      { id: 9, title: 'Apartemen Modern CBD Kuningan', location: 'Jakarta Selatan', price: 11000000, type: '2br', rating: 4.6, image: 'https://images.unsplash.com/photo-1560185007-c5ca93ba1294?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80', lat: -6.2250, lng: 106.8290, amenities: ['wifi', 'pool', 'gym', 'ac', 'kitchen', 'security'], description: 'Apartemen 2 kamar tidur modern di jantung CBD Kuningan, cocok untuk eksekutif. Akses mudah ke perkantoran dan pusat gaya hidup.', policies: 'Deposit 1 bulan sewa. Dilarang merokok. Tidak ada hewan peliharaan.', virtualTourUrl: null },
      { id: 10, title: 'Studio Simpel Dekat Kampus Depok', location: 'Depok', price: 3500000, type: 'studio', rating: 3.8, image: 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80', lat: -6.3690, lng: 106.8238, amenities: ['wifi', 'ac', 'parking', 'security'], description: 'Studio simpel dan terjangkau, lokasi strategis dekat kampus UI Depok. Cocok untuk mahasiswa atau pekerja tunggal.', policies: 'Pembayaran per 3 bulan. Maksimal 1 penghuni. Dilarang membuat keributan.', virtualTourUrl: null }
    ];
    // Daftar semua fasilitas yang mungkin ada beserta ikonnya
    const ALL_AMENITIES = [
      { id: 'wifi', name: 'Wi-Fi', icon: 'fas fa-wifi' },
      { id: 'pool', name: 'Kolam Renang', icon: 'fas fa-person-swimming' }, // Updated icon
      { id: 'gym', name: 'Gymnasium', icon: 'fas fa-dumbbell' },
      { id: 'parking', name: 'Parkir', icon: 'fas fa-square-parking' }, // Updated icon
      { id: 'ac', name: 'AC', icon: 'fas fa-snowflake' },
      { id: 'kitchen', name: 'Dapur', icon: 'fas fa-utensils' },
      { id: 'playground', name: 'Area Bermain Anak', icon: 'fas fa-child' },
      { id: 'security', name: 'Keamanan 24 Jam', icon: 'fas fa-shield-halved' }, // Updated icon
      { id: 'private_lift', name: 'Lift Pribadi', icon: 'fas fa-elevator' },
      { id: 'jacuzzi', name: 'Jacuzzi', icon: 'fas fa-hot-tub-person' }, // Updated icon
      { id: 'tennis_court', name: 'Lapangan Tenis', icon: 'fas fa-table-tennis-paddle-ball' }, // Updated icon
      { id: 'spa', name: 'Spa', icon: 'fas fa-spa' }
    ];

    // === FUNGSI UTILITAS ===
    // Helper untuk memilih elemen DOM
    const $ = (selector, context = document) => context.querySelector(selector);
    const $$ = (selector, context = document) => Array.from(context.querySelectorAll(selector));

    /**
     * Menampilkan notifikasi toast.
     * @param {string} message Pesan yang ingin ditampilkan.
     * @param {'info'|'success'|'error'} type Jenis notifikasi.
     * @param {number} duration Durasi tampilan notifikasi dalam milidetik.
     */
    function showToast(message, type = 'info', duration = 3500) {
      const toast = $('#notificationToast');
      const messageSpan = $('#notificationMessage');
      if (!toast || !messageSpan) {
        console.warn("Elemen toast tidak ditemukan.");
        return;
      }

      messageSpan.textContent = message;
      toast.className = 'notification-toast'; // Reset classes
      if (type === 'success') toast.classList.add('success');
      else if (type === 'error') toast.classList.add('error');
      else if (type === 'info') toast.classList.add('info'); // Default

      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, duration);
    }

    // === LOGIKA SPA (SINGLE PAGE APPLICATION) ===
    /**
     * Navigasi ke halaman (section) tertentu dalam SPA.
     * @param {string} pageId ID dari section yang akan ditampilkan.
     */
    function navigateToPage(pageId) {
      $$('.section').forEach(section => section.classList.remove('active'));
      const targetPage = $(`#${pageId}`);

      if (targetPage) {
        targetPage.classList.add('active');
        appState.currentPage = pageId;
        if (pageId) window.location.hash = pageId; // Update hash URL
        updateActiveNavLink(pageId);

        // Penanganan khusus untuk halaman tertentu setelah navigasi
        if (pageId === 'profile-section') {
          renderProfilePage(); // Render konten profil sesuai status login
        }
        if (pageId === 'search-section') {
          if (!appState.searchMapInstance) { // Inisialisasi peta jika belum ada
            appState.searchMapInstance = initMap('mapSearchResults', APP_CONFIG.mapDefaultCoords, APP_CONFIG.mapDefaultZoom);
          }
          if (appState.searchMapInstance) { // Pastikan peta di-refresh ukurannya
            setTimeout(() => appState.searchMapInstance.invalidateSize(), 150);
            addMarkersToMap(appState.searchMapInstance, appState.filteredApartments.slice(0, APP_CONFIG.itemsPerPage)); // Tampilkan marker untuk halaman pertama
          }
        }
      } else {
        console.warn(`Halaman dengan ID "${pageId}" tidak ditemukan. Kembali ke halaman beranda.`);
        navigateToPage(APP_CONFIG.defaultPage); // Kembali ke default jika halaman tidak ditemukan
      }
      window.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll ke atas halaman
    }

    /**
     * Memperbarui style link navigasi yang aktif.
     * @param {string} pageId ID halaman yang sedang aktif.
     */
    function updateActiveNavLink(pageId) {
      $$('.nav-spa-link').forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === `#${pageId}`) {
          link.classList.add('active');
        }
      });
    }

    /**
     * Menangani pemuatan halaman awal, navigasi berdasarkan hash URL jika ada.
     */
    function handleInitialPageLoad() {
      const hash = window.location.hash.substring(1);
      if (hash && $(`#${hash}`)) {
        navigateToPage(hash);
      } else {
        navigateToPage(APP_CONFIG.defaultPage);
      }
    }

    // === MODAL HANDLING ===
    /**
     * Membuka modal berdasarkan ID.
     * @param {string} modalId ID modal yang akan dibuka.
     */
    function openModal(modalId) {
      const modal = $(`#${modalId}`);
      if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden'; // Mencegah scroll body saat modal terbuka
      } else {
        console.warn(`Modal dengan ID "${modalId}" tidak ditemukan.`);
      }
    }

    /**
     * Menutup modal berdasarkan ID.
     * @param {string} modalId ID modal yang akan ditutup.
     */
    function closeModal(modalId) {
      const modal = $(`#${modalId}`);
      if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = ''; // Kembalikan scroll body

        // Reset form di dalam modal jika ada
        const formInModal = $(`#${modalId} form`);
        if (formInModal) formInModal.reset();

        // Hapus pesan error di modal booking
        if (modalId === 'bookingModal') {
          const bookingErrorDiv = $('#bookingError');
          if (bookingErrorDiv) {
            bookingErrorDiv.textContent = '';
            bookingErrorDiv.style.display = 'none';
          }
        }
        // Hapus konten dinamis di modal detail apartemen saat ditutup
        if (modalId === 'apartmentDetailModal') {
          const modalBody = $('#detailApartmentBody');
          if (modalBody) modalBody.innerHTML = '<p class="text-center"><i class="fas fa-spinner fa-spin fa-2x text-primary"></i><br>Memuat detail apartemen...</p>';
          const modalFooter = $('#detailApartmentFooter');
          if (modalFooter) modalFooter.style.display = 'none';
          if (appState.detailMapInstance) { // Hapus instance peta detail
            appState.detailMapInstance.remove();
            appState.detailMapInstance = null;
          }
        }
      } else {
        console.warn(`Modal dengan ID "${modalId}" tidak ditemukan.`);
      }
    }

    /**
     * Menyiapkan event listener untuk semua interaksi modal.
     */
    function setupModalEventListeners() {
      // Event listener untuk tombol yang membuka modal
      document.body.addEventListener('click', function (event) {
        const targetButton = event.target.closest('[data-modal-target]');
        if (targetButton) {
          openModal(targetButton.dataset.modalTarget);
        }
      });

      // Event listener untuk tombol yang menutup modal (atribut data-modal-dismiss)
      document.body.addEventListener('click', function (event) {
        const dismissButton = event.target.closest('[data-modal-dismiss]');
        if (dismissButton) {
          closeModal(dismissButton.dataset.modalDismiss);
        }
      });

      // Event listener untuk tombol yang mengganti antar modal
      document.body.addEventListener('click', function (event) {
        const switchButton = event.target.closest('[data-modal-switch]');
        if (switchButton) {
          event.preventDefault();
          const [currentModalId, nextModalId] = switchButton.dataset.modalSwitch.split(',');
          closeModal(currentModalId.trim());
          openModal(nextModalId.trim());
        }
      });

      // Tutup modal jika klik di luar konten modal (area overlay)
      $$('.modal').forEach(modal => {
        modal.addEventListener('click', (event) => {
          if (event.target === modal) { // Pastikan klik tepat di overlay, bukan konten
            closeModal(modal.id);
          }
        });
      });
      // Tutup modal dengan tombol Escape
      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          const activeModal = $('.modal.active');
          if (activeModal) {
            closeModal(activeModal.id);
          }
        }
      });
    }

    // === NAVBAR ===
    /**
     * Menyiapkan fungsionalitas navbar (efek scroll, toggle mobile).
     */
    function setupNavbar() {
      const navbar = $('#mainNavbar');
      const navbarToggler = $('#navbarToggler');
      const navbarMenuWrapper = $('#navbarMenuWrapper');

      if (!navbar || !navbarToggler || !navbarMenuWrapper) {
        console.warn("Elemen navbar tidak lengkap, fungsionalitas mungkin terganggu.");
        return;
      }

      window.addEventListener('scroll', () => {
        if (window.scrollY > 50) {
          navbar.classList.add('scrolled');
        } else {
          navbar.classList.remove('scrolled');
        }
      });

      navbarToggler.addEventListener('click', () => {
        const isExpanded = navbarToggler.getAttribute('aria-expanded') === 'true' || false;
        navbarToggler.setAttribute('aria-expanded', !isExpanded);
        navbarMenuWrapper.classList.toggle('active');
      });

      // Event listener untuk link SPA di navbar
      $$('#mainNavbar .nav-spa-link').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const pageId = link.getAttribute('href').substring(1);
          navigateToPage(pageId);
          // Tutup menu mobile jika terbuka setelah klik link
          if (navbarMenuWrapper.classList.contains('active')) {
            navbarMenuWrapper.classList.remove('active');
            navbarToggler.setAttribute('aria-expanded', 'false');
          }
        });
      });
    }

    // === FAB (Floating Action Button) SCROLL TO TOP ===
    /**
     * Menyiapkan tombol "scroll to top".
     */
    function setupFabToTop() {
      const fab = $('#fabToTop');
      if (!fab) return;
      window.addEventListener('scroll', () => {
        if (window.pageYOffset > 300) { // Tampilkan setelah scroll 300px
          fab.classList.add('visible');
        } else {
          fab.classList.remove('visible');
        }
      });
      fab.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }

    // === MAP INITIALIZATION (LEAFLET) ===
    /**
     * Menginisialisasi peta Leaflet.
     * @param {string} mapId ID elemen HTML untuk container peta.
     * @param {Array<number>} coords Koordinat awal [latitude, longitude].
     * @param {number} zoom Level zoom awal.
     * @returns {L.Map|null} Instance peta Leaflet atau null jika gagal.
     */
    function initMap(mapId, coords, zoom) {
      let mapInstanceKey = mapId === 'mapSearchResults' ? 'searchMapInstance' : 'detailMapInstance';

      if (appState[mapInstanceKey]) { // Hapus instance peta lama jika ada
        appState[mapInstanceKey].remove();
        appState[mapInstanceKey] = null;
      }

      const mapContainer = $(`#${mapId}`);
      // Pastikan container peta ada dan terlihat sebelum inisialisasi
      if (!mapContainer || mapContainer.offsetParent === null) {
        // console.warn(`Container peta #${mapId} tidak ditemukan atau tidak terlihat. Peta tidak diinisialisasi.`);
        if (mapContainer) mapContainer.innerHTML = `<p class="text-neutral-medium text-center p-3">Peta akan dimuat saat area ini terlihat.</p>`;
        return null;
      }

      try {
        const map = L.map(mapId).setView(coords, zoom);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
          maxZoom: 18,
        }).addTo(map);

        appState[mapInstanceKey] = map;
        return map;
      } catch (error) {
        console.error(`Gagal menginisialisasi peta #${mapId}:`, error);
        if (mapContainer) mapContainer.innerHTML = `<p class="text-danger text-center p-3">Gagal memuat peta. Coba segarkan halaman.</p>`;
        return null;
      }
    }

    /**
     * Menambahkan marker apartemen ke peta.
     * @param {L.Map} map Instance peta Leaflet.
     * @param {Array<Object>} apartmentsData Data apartemen yang akan ditandai.
     */
    function addMarkersToMap(map, apartmentsData) {
      if (!map || !(map instanceof L.Map)) {
        // console.warn("Peta tidak valid atau belum diinisialisasi untuk menambah marker.");
        return;
      }
      // Hapus marker lama
      map.eachLayer((layer) => {
        if (layer instanceof L.Marker) {
          map.removeLayer(layer);
        }
      });

      if (!apartmentsData || apartmentsData.length === 0) return;

      const markers = [];
      apartmentsData.forEach(apt => {
        if (apt.lat != null && apt.lng != null) { // Pastikan lat/lng ada
          try {
            const marker = L.marker([apt.lat, apt.lng])
              .bindPopup(`<b>${apt.title}</b><br>${apt.location}<br><button class="btn btn-sm btn-primary mt-1 view-detail-btn-map" data-apartment-id="${apt.id}">Lihat Detail</button>`);
            markers.push(marker);
          } catch (e) {
            console.warn("Gagal membuat marker untuk:", apt.title, e);
          }
        }
      });

      if (markers.length > 0) {
        const featureGroup = L.featureGroup(markers).addTo(map);
        try {
          // map.fitBounds(featureGroup.getBounds().pad(0.15)); // pad untuk sedikit zoom out
          // Cek jika bounds valid (punya lebih dari 1 titik unik atau area tertentu)
          const bounds = featureGroup.getBounds();
          if (bounds.isValid() && !bounds.getSouthWest().equals(bounds.getNorthEast())) {
            map.fitBounds(bounds.pad(0.15));
          } else if (markers.length === 1) { // Hanya satu marker
            map.setView(markers[0].getLatLng(), 15);
          } else { // Jika bounds tidak valid (misal semua marker di titik yg sama)
            map.setView(APP_CONFIG.mapDefaultCoords, APP_CONFIG.mapDefaultZoom);
          }
        } catch (e) {
          // console.warn("Tidak bisa fitBounds, mungkin hanya satu marker atau tidak ada marker valid.", e);
          if (apartmentsData.length === 1 && apartmentsData[0].lat != null && apartmentsData[0].lng != null) {
            map.setView([apartmentsData[0].lat, apartmentsData[0].lng], 15); // Zoom ke satu marker
          } else {
            map.setView(APP_CONFIG.mapDefaultCoords, APP_CONFIG.mapDefaultZoom); // Fallback
          }
        }
      } else {
        // Jika tidak ada marker, set view ke default
        map.setView(APP_CONFIG.mapDefaultCoords, APP_CONFIG.mapDefaultZoom);
      }
    }

    // Event listener global untuk tombol "Lihat Detail" dari popup peta (menggunakan delegasi event)
    document.addEventListener('click', function (event) {
      if (event.target.classList.contains('view-detail-btn-map')) {
        const apartmentId = event.target.dataset.apartmentId;
        viewApartmentDetail(apartmentId); // Fungsi ini akan didefinisikan nanti
      }
    });


    // === LOGIKA PENCARIAN APARTEMEN ===
    /**
     * Mengisi pilihan filter fasilitas secara dinamis.
     */
    function populateAmenitiesFilter() {
      const container = $('#searchAmenitiesCheckboxes');
      if (!container) return;
      container.innerHTML = ALL_AMENITIES.map(amenity => `
            <div class="form-check">
                <input class="form-check-input filter-amenity" type="checkbox" value="${amenity.id}" id="amenity-${amenity.id}">
                <label class="form-check-label" for="amenity-${amenity.id}"><i class="${amenity.icon} mr-2 text-secondary"></i>${amenity.name}</label>
            </div>
        `).join('');
    }

    /**
     * Mendapatkan nilai filter pencarian dari form.
     * @returns {Object} Objek berisi filter yang aktif.
     */
    function getSearchFilters() {
      const filters = {};
      const searchLocationInput = $('#searchLocation');
      const searchPriceRangeSelect = $('#searchPriceRange');
      const searchApartmentTypeSelect = $('#searchApartmentType');

      if (searchLocationInput) filters.location = searchLocationInput.value.trim().toLowerCase();
      if (searchPriceRangeSelect) filters.priceRange = searchPriceRangeSelect.value;
      if (searchApartmentTypeSelect) filters.type = searchApartmentTypeSelect.value;

      filters.amenities = $$('.filter-amenity:checked').map(cb => cb.value);
      return filters;
    }

    /**
     * Memfilter daftar apartemen berdasarkan kriteria filter.
     * @param {Array<Object>} apartmentsToFilter Array apartemen yang akan difilter.
     * @param {Object} filters Objek filter yang aktif.
     * @returns {Array<Object>} Array apartemen yang sudah difilter.
     */
    function filterApartments(apartmentsToFilter, filters) {
      if (!apartmentsToFilter) return [];
      return apartmentsToFilter.filter(apt => {
        let match = true;
        // Filter lokasi (cek di judul atau lokasi)
        if (filters.location && !(apt.location.toLowerCase().includes(filters.location) || apt.title.toLowerCase().includes(filters.location))) {
          match = false;
        }
        // Filter harga
        if (filters.priceRange) {
          const [minPriceStr, maxPriceStr] = filters.priceRange.split('-');
          const minPrice = parseInt(minPriceStr);
          // Handle "15000000-+" (maxPrice menjadi Infinity)
          const maxPrice = (maxPriceStr && maxPriceStr !== '+') ? parseInt(maxPriceStr) : Infinity;

          if (apt.price < minPrice || (maxPrice !== Infinity && apt.price > maxPrice)) {
            match = false;
          }
        }
        // Filter tipe
        if (filters.type && apt.type !== filters.type) {
          match = false;
        }
        // Filter fasilitas (semua fasilitas yang dipilih harus ada di apartemen)
        if (filters.amenities && filters.amenities.length > 0) {
          if (!filters.amenities.every(am => apt.amenities.includes(am))) {
            match = false;
          }
        }
        return match;
      });
    }

    /**
     * Membuat HTML untuk satu kartu apartemen.
     * @param {Object} apt Objek data apartemen.
     * @returns {string} String HTML untuk kartu apartemen.
     */
    function renderApartmentCard(apt) {
      return `
            <div class="card apartment-card">
                <img src="${apt.image}" alt="${apt.title}" class="apartment-card-image" loading="lazy">
                <div class="card-body">
                    <h5 class="apartment-card-title">${apt.title}</h5>
                    <p class="apartment-card-location"><i class="fas fa-map-marker-alt text-secondary"></i> ${apt.location}</p>
                    <p class="apartment-card-price">Rp ${apt.price.toLocaleString('id-ID')}/bulan</p>
                    <div class="apartment-card-meta">
                        <span><i class="fas fa-star text-warning"></i> ${apt.rating || 'N/A'}</span>
                        <span><i class="fas fa-home"></i> ${apt.type.toUpperCase()}</span>
                    </div>
                    <button class="btn btn-primary btn-sm w-100 view-detail-btn" data-apartment-id="${apt.id}">
                        <i class="fas fa-eye"></i> Lihat Detail
                    </button>
                </div>
            </div>
        `;
    }

    /**
     * Menampilkan hasil pencarian apartemen yang sudah difilter dan dipaginasi.
     * @param {number} page Nomor halaman yang akan ditampilkan (default 1).
     */
    function displaySearchResults(page = 1) {
      appState.currentPageNumber = page;
      const container = $('#searchResultsContainer');
      const paginationContainer = $('#searchPagination');
      if (!container || !paginationContainer) {
        console.warn("Container hasil pencarian atau paginasi tidak ditemukan.");
        return;
      }

      const startIndex = (page - 1) * APP_CONFIG.itemsPerPage;
      const endIndex = startIndex + APP_CONFIG.itemsPerPage;
      const paginatedApartments = appState.filteredApartments.slice(startIndex, endIndex);

      if (paginatedApartments.length === 0) {
        container.innerHTML = `<p class="text-neutral-medium col-span-full text-center p-5">Tidak ada apartemen yang cocok dengan kriteria pencarian Anda. Coba ubah filter.</p>`;
      } else {
        container.innerHTML = paginatedApartments.map(renderApartmentCard).join('');
        // Event listener untuk tombol "Lihat Detail" pada kartu yang baru dirender
        $$('#searchResultsContainer .view-detail-btn').forEach(btn => {
          btn.addEventListener('click', () => viewApartmentDetail(btn.dataset.apartmentId));
        });
      }

      // Inisialisasi atau update peta hasil pencarian
      if (!appState.searchMapInstance && appState.currentPage === 'search-section') { // Hanya init jika di halaman search
        appState.searchMapInstance = initMap('mapSearchResults', APP_CONFIG.mapDefaultCoords, APP_CONFIG.mapDefaultZoom);
      }
      if (appState.searchMapInstance) { // Pastikan peta berhasil diinisialisasi
        addMarkersToMap(appState.searchMapInstance, paginatedApartments);
        setTimeout(() => appState.searchMapInstance.invalidateSize(), 100); // Pastikan ukuran peta benar
      }

      renderPagination(appState.filteredApartments.length, page, paginationContainer);
    }

    /**
     * Membuat dan menampilkan tombol paginasi.
     * @param {number} totalItems Jumlah total item hasil filter.
     * @param {number} currentPage Halaman yang sedang aktif.
     * @param {HTMLElement} container Elemen HTML untuk menampung paginasi.
     */
    function renderPagination(totalItems, currentPage, container) {
      const totalPages = Math.ceil(totalItems / APP_CONFIG.itemsPerPage);
      container.innerHTML = ''; // Kosongkan kontainer paginasi

      if (totalPages <= 1) return; // Tidak perlu paginasi jika hanya 1 halaman atau kurang

      let paginationHTML = `<nav aria-label="Navigasi Halaman Hasil Pencarian"><ul class="pagination">`;

      // Tombol "Previous"
      paginationHTML += `
            <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                <a class="page-link" href="#" data-page="${currentPage - 1}" aria-label="Sebelumnya">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>`;

      // Logika untuk menampilkan nomor halaman (dengan ellipsis jika terlalu banyak)
      const maxPagesToShow = 5; // Jumlah maksimal nomor halaman yang ditampilkan langsung
      let startPage, endPage;

      if (totalPages <= maxPagesToShow) {
        startPage = 1;
        endPage = totalPages;
      } else {
        // Jika halaman saat ini dekat awal
        if (currentPage <= Math.ceil(maxPagesToShow / 2)) {
          startPage = 1;
          endPage = maxPagesToShow;
          // Jika halaman saat ini dekat akhir
        } else if (currentPage + Math.floor(maxPagesToShow / 2) >= totalPages) {
          startPage = totalPages - maxPagesToShow + 1;
          endPage = totalPages;
          // Jika halaman saat ini di tengah
        } else {
          startPage = currentPage - Math.floor(maxPagesToShow / 2);
          endPage = currentPage + Math.floor(maxPagesToShow / 2);
        }
      }

      if (startPage > 1) {
        paginationHTML += `<li class="page-item"><a class="page-link" href="#" data-page="1">1</a></li>`;
        if (startPage > 2) { // Tampilkan ellipsis jika ada gap
          paginationHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
        }
      }

      for (let i = startPage; i <= endPage; i++) {
        paginationHTML += `
                <li class="page-item ${i === currentPage ? 'active' : ''}">
                    <a class="page-link" href="#" data-page="${i}">${i}</a>
                </li>`;
      }

      if (endPage < totalPages) {
        if (endPage < totalPages - 1) { // Tampilkan ellipsis jika ada gap
          paginationHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
        }
        paginationHTML += `<li class="page-item"><a class="page-link" href="#" data-page="${totalPages}">${totalPages}</a></li>`;
      }

      // Tombol "Next"
      paginationHTML += `
            <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                <a class="page-link" href="#" data-page="${currentPage + 1}" aria-label="Berikutnya">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>`;

      paginationHTML += `</ul></nav>`;
      container.innerHTML = paginationHTML;

      // Tambahkan event listener untuk tombol paginasi yang baru dibuat
      $$('#searchPagination .page-link').forEach(link => {
        if (!link.closest('.page-item.disabled')) { // Hanya attach listener ke link yang tidak disabled
          link.addEventListener('click', (e) => {
            e.preventDefault();
            const pageNum = parseInt(e.currentTarget.dataset.page);
            if (pageNum && pageNum > 0 && pageNum <= totalPages) { // Pastikan pageNum valid
              displaySearchResults(pageNum);
              // Scroll ke atas area hasil pencarian untuk UX yang lebih baik
              const searchResultsArea = $('.search-results-area');
              if (searchResultsArea) searchResultsArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          });
        }
      });
    }

    /**
     * Mengambil data apartemen (simulasi dari data dummy).
     * @returns {Promise<Array<Object>>} Promise yang resolve dengan array data apartemen.
     */
    async function fetchApartmentsData() {
      showToast('Memuat data apartemen...', 'info', 2000);
      return new Promise(resolve => {
        setTimeout(() => {
          // Salin array agar data asli DUMMY_APARTMENTS tidak termutasi
          appState.apartments = DUMMY_APARTMENTS.map(apt => ({ ...apt }));
          appState.filteredApartments = [...appState.apartments]; // Awalnya, semua apartemen ditampilkan
          resolve(appState.apartments);
          // showToast('Data apartemen berhasil dimuat.', 'success'); // Bisa dipindahkan setelah displaySearchResults
        }, 800); // Simulasi delay network
      });
    }

    /**
     * Menangani submit form pencarian (baik dari hero maupun dari halaman search).
     * @param {Event} event Event submit form.
     */
    function handleSearchFormSubmit(event) {
      event.preventDefault();
      appState.activeFilters = getSearchFilters(); // Dapatkan filter dari form utama

      // Jika submit dari form hero, sinkronkan nilai inputnya ke form utama
      if (event.target.id === 'heroSearchForm') {
        const heroLocation = $('#heroLocation').value;
        const heroCheckIn = $('#heroCheckIn').value; // Bisa digunakan nanti untuk ketersediaan
        const heroCheckOut = $('#heroCheckOut').value; // Bisa digunakan nanti

        $('#searchLocation').value = heroLocation; // Salin ke filter utama
        appState.activeFilters.location = heroLocation.trim().toLowerCase();
        // TODO: Tambahkan logika untuk check-in/check-out jika diperlukan
      }

      appState.filteredApartments = filterApartments(appState.apartments, appState.activeFilters);
      displaySearchResults(1); // Tampilkan halaman pertama hasil filter

      // Jika pengguna belum di halaman pencarian, navigasi ke sana
      if (appState.currentPage !== 'search-section') {
        navigateToPage('search-section');
      }
    }

    // === DETAIL APARTEMEN ===
    /**
     * Menampilkan detail apartemen di modal.
     * @param {string|number} apartmentId ID apartemen yang akan ditampilkan.
     */
    window.viewApartmentDetail = function (apartmentId) { // Dibuat global agar bisa dipanggil dari HTML onclick
      const id = parseInt(apartmentId);
      const apt = appState.apartments.find(a => a.id === id);
      if (!apt) {
        showToast('Apartemen tidak ditemukan.', 'error');
        return;
      }

      const modalBody = $('#detailApartmentBody');
      const modalTitle = $('#detailApartmentTitle');
      const priceFooter = $('#detailApartmentPriceFooter');
      const bookButton = $('#bookApartmentButton');
      const modalFooter = $('#detailApartmentFooter');

      if (!modalBody || !modalTitle || !priceFooter || !bookButton || !modalFooter) {
        console.error("Elemen modal detail apartemen tidak lengkap.");
        return;
      }

      modalTitle.textContent = apt.title;
      priceFooter.textContent = `Rp ${apt.price.toLocaleString('id-ID')}/bulan`;
      bookButton.dataset.apartmentId = apt.id; // Simpan ID untuk tombol pesan

      let amenitiesHTML = apt.amenities.map(amId => {
        const amenityDetail = ALL_AMENITIES.find(a => a.id === amId);
        return `<li><i class="${amenityDetail ? amenityDetail.icon : 'fas fa-check'}"></i> ${amenityDetail ? amenityDetail.name : amId}</li>`;
      }).join('');
      if (!amenitiesHTML) amenitiesHTML = '<li><i class="fas fa-times text-danger"></i> Tidak ada fasilitas tercantum.</li>';

      modalBody.innerHTML = `
            <img src="${apt.image}" alt="${apt.title}" class="modal-apartment-image" loading="lazy">
            <div id="detailApartmentMapInModal" class="map-container" style="height: 250px; margin-bottom: 1rem;"></div>
            <div class="modal-apartment-details">
                <h5><i class="fas fa-info-circle text-primary mr-2"></i>Deskripsi</h5>
                <p>${apt.description || 'Deskripsi tidak tersedia.'}</p>
                
                <h5><i class="fas fa-map-marked-alt text-primary mr-2"></i>Lokasi</h5>
                <p><i class="fas fa-map-marker-alt text-secondary"></i> ${apt.location}</p>
                
                <h5><i class="fas fa-concierge-bell text-primary mr-2"></i>Fasilitas</h5>
                <ul>${amenitiesHTML}</ul>
                
                <h5><i class="fas fa-file-contract text-primary mr-2"></i>Kebijakan</h5>
                <p>${apt.policies || 'Tidak ada kebijakan spesifik tercantum.'}</p>
                
                ${apt.virtualTourUrl ? `<a href="${apt.virtualTourUrl}" target="_blank" rel="noopener noreferrer" class="btn btn-secondary mt-3"><i class="fas fa-vr-cardboard"></i> Lihat Tur Virtual</a>` : ''}
            </div>
        `;
      modalFooter.style.display = 'flex'; // Tampilkan footer modal
      openModal('apartmentDetailModal');

      // Inisialisasi peta kecil di modal SETELAH modal benar-benar visible
      // Menggunakan setTimeout untuk memastikan DOM sudah dirender dan modal visible
      setTimeout(() => {
        if (apt.lat != null && apt.lng != null) {
          appState.detailMapInstance = initMap('detailApartmentMapInModal', [apt.lat, apt.lng], 16); // Zoom lebih dekat
          if (appState.detailMapInstance) {
            L.marker([apt.lat, apt.lng]).addTo(appState.detailMapInstance).bindPopup(apt.title).openPopup();
            appState.detailMapInstance.invalidateSize(); // Penting setelah modal tampil dan peta di-render
          }
        } else {
          const mapContainer = $('#detailApartmentMapInModal');
          if (mapContainer) mapContainer.innerHTML = '<p class="text-neutral-medium text-center p-3">Lokasi peta tidak tersedia.</p>';
        }
      }, 200); // Delay kecil
    }

    // === LOGIKA BOOKING & STRIPE ===
    /**
     * Menyiapkan elemen Stripe Card.
     * @returns {boolean} True jika Stripe berhasil diinisialisasi, false jika tidak.
     */
    function setupStripeElements() {
      // Cek apakah Stripe sudah dimuat dan kunci publik valid
      if (!window.Stripe || APP_CONFIG.stripePublicKey === 'pk_test_XXXXXXXXXXXXXXXXXXXXXXXX' || !APP_CONFIG.stripePublicKey) {
        console.warn("Kunci Publik Stripe belum diatur atau Stripe.js gagal dimuat. Fitur pembayaran akan disimulasikan.");
        const cardElementDiv = $('#stripeCardElement');
        if (cardElementDiv) cardElementDiv.innerHTML = '<p class="text-warning p-2" style="font-size:0.9rem;">Modul pembayaran saat ini tidak aktif (simulasi).</p>';
        return false; // Stripe tidak siap
      }
      try {
        appState.stripeInstance = Stripe(APP_CONFIG.stripePublicKey);
        const elements = appState.stripeInstance.elements({
          // Kustomisasi font agar sesuai dengan tema
          fonts: [{ cssSrc: 'https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap' }]
        });
        // Buat elemen kartu Stripe
        appState.stripeCardElement = elements.create('card', {
          style: {
            base: {
              fontFamily: '"Open Sans", sans-serif',
              fontSize: '16px',
              color: '#34495E',
              '::placeholder': { color: '#7F8C8D' },
            },
            invalid: { color: '#E74C3C', iconColor: '#E74C3C' },
          },
          hidePostalCode: true // Sembunyikan field kode pos jika tidak diperlukan
        });
        appState.stripeCardElement.mount('#stripeCardElement'); // Tampilkan elemen kartu di DOM
        return true; // Stripe siap
      } catch (error) {
        console.error("Gagal menginisialisasi Stripe Elements:", error);
        const cardElementDiv = $('#stripeCardElement');
        if (cardElementDiv) cardElementDiv.innerHTML = '<p class="text-danger p-2" style="font-size:0.9rem;">Gagal memuat modul pembayaran.</p>';
        return false; // Stripe tidak siap
      }
    }

    /**
     * Menangani klik tombol "Pesan Sekarang" dari modal detail apartemen.
     * Mempersiapkan dan membuka modal booking.
     */
    function handleBookApartmentClick() {
      // `this` di sini akan merujuk ke elemen tombol yang memicu event
      const apartmentId = parseInt(this.dataset.apartmentId);
      const apt = appState.apartments.find(a => a.id === apartmentId);
      if (!apt) {
        showToast("Apartemen tidak ditemukan untuk pemesanan.", "error");
        return;
      }

      // Cek apakah pengguna sudah login
      if (!appState.currentUser) {
        showToast("Silakan masuk atau daftar terlebih dahulu untuk memesan.", "info");
        closeModal('apartmentDetailModal'); // Tutup modal detail
        openModal('loginModal'); // Buka modal login
        return;
      }

      // Siapkan Stripe Elements jika belum ada atau elemennya kosong
      const stripeCardContainer = $('#stripeCardElement');
      if (!appState.stripeCardElement || (stripeCardContainer && !stripeCardContainer.hasChildNodes())) {
        setupStripeElements(); // Coba setup Stripe, akan ada fallback jika gagal
      }


      // Isi data ke form booking
      $('#bookingApartmentId').value = apt.id;
      $('#bookingModalTitle').textContent = `Pesan: ${apt.title}`;
      $('#bookingApartmentInfo').innerHTML = `Anda akan memesan: <strong>${apt.title}</strong> (${apt.location}) - <span class="text-accent font-weight-bold">Rp ${apt.price.toLocaleString('id-ID')}/bulan.</span>`;

      // Isi nama dan email dari pengguna yang login
      $('#bookingFullName').value = appState.currentUser.name || '';
      $('#bookingEmail').value = appState.currentUser.email || '';

      // Atur tanggal check-in dan check-out default
      const today = new Date();
      const todayISO = today.toISOString().split('T')[0];
      $('#bookingCheckInDate').value = todayISO;
      $('#bookingCheckInDate').setAttribute('min', todayISO);

      const tomorrow = new Date(today);
      tomorrow.setDate(today.getDate() + 1);
      const tomorrowISO = tomorrow.toISOString().split('T')[0];
      $('#bookingCheckOutDate').value = tomorrowISO;
      $('#bookingCheckOutDate').setAttribute('min', tomorrowISO);

      $('#bookingGuests').value = 1; // Default jumlah tamu

      // Reset pesan error dan bersihkan elemen Stripe jika ada
      const bookingErrorDiv = $('#bookingError');
      if (bookingErrorDiv) {
        bookingErrorDiv.textContent = '';
        bookingErrorDiv.style.display = 'none';
      }

      if (appState.stripeCardElement && typeof appState.stripeCardElement.clear === 'function') {
        appState.stripeCardElement.clear();
      }

      closeModal('apartmentDetailModal'); // Tutup modal detail
      openModal('bookingModal'); // Buka modal booking
    }

    // Update batas minimal tanggal check-out saat tanggal check-in berubah
    const bookingCheckInDateInput = $('#bookingCheckInDate');
    if (bookingCheckInDateInput) {
      bookingCheckInDateInput.addEventListener('change', function () {
        const checkInDate = new Date(this.value);
        if (isNaN(checkInDate)) return; // Tanggal tidak valid

        const minCheckoutDate = new Date(checkInDate);
        minCheckoutDate.setDate(checkInDate.getDate() + 1); // Minimal checkout adalah H+1 dari checkin
        const minCheckoutDateISO = minCheckoutDate.toISOString().split('T')[0];

        const checkoutInput = $('#bookingCheckOutDate');
        checkoutInput.setAttribute('min', minCheckoutDateISO);

        // Jika tanggal checkout saat ini lebih kecil dari minCheckoutDate baru, update juga tanggal checkout
        if (checkoutInput.value < minCheckoutDateISO) {
          checkoutInput.value = minCheckoutDateISO;
        }
      });
    }

    /**
     * Menangani submit form pemesanan, termasuk proses pembayaran dengan Stripe.
     * @param {Event} event Event submit form.
     */
    async function handleBookingFormSubmit(event) {
      event.preventDefault();
      const confirmButton = $('#confirmBookingButton');
      confirmButton.disabled = true;
      confirmButton.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Memproses...`;

      const bookingErrorDiv = $('#bookingError');
      bookingErrorDiv.style.display = 'none';
      bookingErrorDiv.textContent = '';

      const apartmentId = parseInt($('#bookingApartmentId').value);
      const apt = appState.apartments.find(a => a.id === apartmentId);
      if (!apt) {
        bookingErrorDiv.textContent = "Data apartemen tidak valid. Coba lagi.";
        bookingErrorDiv.style.display = 'block';
        confirmButton.disabled = false;
        confirmButton.innerHTML = `<i class="fas fa-check-circle"></i> Konfirmasi & Bayar`;
        return;
      }

      const checkInVal = $('#bookingCheckInDate').value;
      const checkOutVal = $('#bookingCheckOutDate').value;

      if (!checkInVal || !checkOutVal) {
        bookingErrorDiv.textContent = "Tanggal Check-in dan Check-out wajib diisi.";
        bookingErrorDiv.style.display = 'block';
        confirmButton.disabled = false;
        confirmButton.innerHTML = `<i class="fas fa-check-circle"></i> Konfirmasi & Bayar`;
        return;
      }

      const checkIn = new Date(checkInVal);
      const checkOut = new Date(checkOutVal);

      if (isNaN(checkIn) || isNaN(checkOut) || checkIn >= checkOut) {
        bookingErrorDiv.textContent = "Tanggal Check-out harus setelah tanggal Check-in.";
        bookingErrorDiv.style.display = 'block';
        confirmButton.disabled = false;
        confirmButton.innerHTML = `<i class="fas fa-check-circle"></i> Konfirmasi & Bayar`;
        return;
      }

      // Simulasi pembayaran jika Stripe tidak aktif/terkonfigurasi
      if (!appState.stripeInstance || !appState.stripeCardElement || APP_CONFIG.stripePublicKey === 'pk_test_XXXXXXXXXXXXXXXXXXXXXXXX' || !APP_CONFIG.stripePublicKey) {
        console.log("Mode simulasi pembayaran karena Stripe tidak aktif/terkonfigurasi.");
        showToast('Memproses pemesanan (simulasi)...', 'info', 2000);
        await new Promise(resolve => setTimeout(resolve, 1500)); // Simulasi delay

        const newBooking = {
          id: `BOOK${Date.now().toString().slice(-6)}`,
          apartmentId: apt.id,
          apartmentTitle: apt.title,
          checkInDate: checkInVal,
          checkOutDate: checkOutVal,
          guests: $('#bookingGuests').value,
          totalPrice: apt.price, // TODO: Hitung total harga berdasarkan durasi sewa
          status: 'Menunggu Konfirmasi', // Status untuk simulasi
          bookingDate: new Date().toISOString().split('T')[0]
        };
        appState.bookings.unshift(newBooking); // Tambah ke awal array riwayat
        if (appState.currentPage === 'profile-section') renderBookingHistory(); // Update riwayat jika di halaman profil
        showToast(`Pemesanan untuk ${apt.title} berhasil disimulasikan!`, 'success');
        closeModal('bookingModal');
        $('#bookingForm').reset();
        confirmButton.disabled = false;
        confirmButton.innerHTML = `<i class="fas fa-check-circle"></i> Konfirmasi & Bayar`;
        return;
      }

      // Proses pembayaran dengan Stripe jika aktif
      try {
        const { paymentMethod, error } = await appState.stripeInstance.createPaymentMethod({
          type: 'card',
          card: appState.stripeCardElement,
          billing_details: {
            name: $('#bookingFullName').value,
            email: $('#bookingEmail').value,
          },
        });

        if (error) { // Jika ada error dari Stripe (misal, kartu tidak valid)
          bookingErrorDiv.textContent = error.message;
          bookingErrorDiv.style.display = 'block';
          confirmButton.disabled = false;
          confirmButton.innerHTML = `<i class="fas fa-check-circle"></i> Konfirmasi & Bayar`;
          return;
        }

        // SIMULASI: Kirim paymentMethod.id ke backend Anda untuk proses selanjutnya.
        // Di aplikasi nyata, backend akan membuat PaymentIntent, mengkonfirmasi pembayaran, dan menyimpan data booking.
        console.log('PaymentMethod ID (untuk dikirim ke backend):', paymentMethod.id);
        showToast('Memproses pembayaran dengan Stripe...', 'info', 2500);
        await new Promise(resolve => setTimeout(resolve, 2000)); // Simulasi proses backend

        // Anggap backend berhasil memproses dan pembayaran terkonfirmasi
        const newBooking = {
          id: `BOOK${Date.now().toString().slice(-6)}`,
          apartmentId: apt.id,
          apartmentTitle: apt.title,
          checkInDate: checkInVal,
          checkOutDate: checkOutVal,
          guests: $('#bookingGuests').value,
          totalPrice: apt.price, // TODO: Hitung total harga
          status: 'Terkonfirmasi',
          bookingDate: new Date().toISOString().split('T')[0],
          paymentId: paymentMethod.id // Simpan ID PaymentMethod
        };
        appState.bookings.unshift(newBooking);
        if (appState.currentPage === 'profile-section') renderBookingHistory();
        showToast(`Pemesanan untuk ${apt.title} berhasil! Pembayaran terkonfirmasi.`, 'success');
        closeModal('bookingModal');
        $('#bookingForm').reset();

      } catch (err) {
        console.error("Error saat proses booking dengan Stripe:", err);
        bookingErrorDiv.textContent = "Terjadi kesalahan sistem saat pembayaran. Silakan coba lagi atau hubungi dukungan.";
        bookingErrorDiv.style.display = 'block';
      } finally {
        confirmButton.disabled = false;
        confirmButton.innerHTML = `<i class="fas fa-check-circle"></i> Konfirmasi & Bayar`;
      }
    }


    // === PROFIL PENGGUNA ===
    /**
     * Merender konten halaman profil berdasarkan status login pengguna.
     */
    function renderProfilePage() {
      const profileContentArea = $('#profileContentArea');
      if (!profileContentArea) {
        console.warn("Area konten profil tidak ditemukan.");
        return;
      }

      if (appState.currentUser) { // Jika pengguna sudah login
        const template = $('#loggedInProfileTemplate');
        if (template && template.content) {
          const clone = template.content.cloneNode(true);
          profileContentArea.innerHTML = ''; // Kosongkan dulu
          profileContentArea.appendChild(clone);

          // Isi data pengguna ke form
          $('#profileFullName').value = appState.currentUser.name || '';
          $('#profileEmail').value = appState.currentUser.email || '';
          if (appState.currentUser.phone) $('#profilePhone').value = appState.currentUser.phone;

          // Attach event listeners untuk elemen-elemen di dalam template profil
          setupProfileTabs();
          renderBookingHistory(); // Tampilkan riwayat pemesanan
          $('#profileUpdateForm')?.addEventListener('submit', handleProfileUpdateForm);
          $('#passwordChangeForm')?.addEventListener('submit', handlePasswordChangeForm);
          $('#logoutButton')?.addEventListener('click', (e) => { e.preventDefault(); handleLogout(); });
          $('#saveNotificationPrefs')?.addEventListener('click', () => showToast('Preferensi notifikasi disimpan (simulasi).', 'info'));
        } else {
          profileContentArea.innerHTML = '<p class="text-danger">Template profil tidak ditemukan.</p>';
        }
      } else { // Jika pengguna belum login
        const template = $('#loggedOutProfileTemplate');
        if (template && template.content) {
          const clone = template.content.cloneNode(true);
          profileContentArea.innerHTML = '';
          profileContentArea.appendChild(clone);
          // Re-attach modal triggers untuk tombol Masuk/Daftar yang baru dirender
          $$('#profileContentArea [data-modal-target]').forEach(button => {
            button.addEventListener('click', () => {
              openModal(button.dataset.modalTarget);
            });
          });
        } else {
          profileContentArea.innerHTML = '<p class="text-danger">Template tampilan logout tidak ditemukan.</p>';
        }
      }
    }

    /**
     * Menyiapkan fungsionalitas tab di halaman profil.
     */
    function setupProfileTabs() {
      const navLinks = $$('.profile-nav-link');
      const tabContents = $$('.profile-tab-content');

      navLinks.forEach(link => {
        // Hanya tambahkan event listener jika bukan link logout
        if (link.id !== 'logoutButton') {
          link.addEventListener('click', (e) => {
            e.preventDefault();
            const targetTabId = link.dataset.profileTab; // Misal "info", "bookings", "settings"

            // Nonaktifkan semua link navigasi tab dan sembunyikan semua konten tab
            navLinks.forEach(nl => {
              if (nl.id !== 'logoutButton') nl.classList.remove('active');
            });
            tabContents.forEach(tc => tc.classList.remove('active')); // Gunakan class 'active' untuk display

            // Aktifkan link yang diklik dan tampilkan konten tab yang sesuai
            link.classList.add('active');
            const targetTabContent = $(`#profile${targetTabId.charAt(0).toUpperCase() + targetTabId.slice(1)}Tab`);
            if (targetTabContent) {
              targetTabContent.classList.add('active');
            }
          });
        }
      });
    }

    /**
     * Merender tabel riwayat pemesanan pengguna.
     */
    function renderBookingHistory() {
      const container = $('#bookingHistoryContainer');
      if (!container) return;

      if (!appState.currentUser || appState.bookings.length === 0) {
        container.innerHTML = '<p class="text-neutral-medium p-3 text-center">Anda belum memiliki riwayat pemesanan.</p>';
        return;
      }

      // Urutkan booking berdasarkan tanggal terbaru dulu
      const sortedBookings = [...appState.bookings].sort((a, b) => new Date(b.bookingDate) - new Date(a.bookingDate));

      const tableHTML = `
            <table class="table">
                <thead>
                    <tr>
                        <th>ID Pesanan</th>
                        <th>Apartemen</th>
                        <th>Tgl Check-In</th>
                        <th>Status</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    ${sortedBookings.map(booking => `
                        <tr>
                            <td><small>${booking.id}</small></td>
                            <td>${booking.apartmentTitle}</td>
                            <td>${new Date(booking.checkInDate).toLocaleDateString('id-ID', { day: '2-digit', month: 'short', year: 'numeric' })}</td>
                            <td><span class="badge ${booking.status === 'Terkonfirmasi' ? 'badge-success' : (booking.status === 'Menunggu Konfirmasi' ? 'badge-warning' : (booking.status === 'Dibatalkan' ? 'badge-danger' : 'badge-info'))}">${booking.status}</span></td>
                            <td><button class="btn btn-sm btn-outline-primary view-booking-detail-btn" data-booking-id="${booking.id}" title="Lihat Detail Pemesanan"><i class="fas fa-eye"></i></button></td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
      container.innerHTML = tableHTML;

      // Tambahkan event listener ke tombol detail booking yang baru dibuat
      $$('.view-booking-detail-btn').forEach(btn => {
        btn.addEventListener('click', function () {
          viewBookingDetail(this.dataset.bookingId);
        });
      });
    }

    /**
     * Menampilkan detail pemesanan (simulasi dengan alert).
     * @param {string} bookingId ID pemesanan.
     */
    window.viewBookingDetail = function (bookingId) { // Dibuat global untuk onclick
      const booking = appState.bookings.find(b => b.id === bookingId);
      if (!booking) {
        showToast("Detail pemesanan tidak ditemukan.", "error");
        return;
      }
      const apt = appState.apartments.find(a => a.id === booking.apartmentId);

      // Format tanggal agar lebih mudah dibaca
      const formatDate = (dateString) => new Date(dateString).toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

      let detailMessage = `
            DETAIL PEMESANAN
            -----------------------------------
            ID Pesanan: ${booking.id}
            Apartemen: ${booking.apartmentTitle} ${apt ? `(${apt.location})` : ''}
            Tanggal Check-In: ${formatDate(booking.checkInDate)}
            Tanggal Check-Out: ${formatDate(booking.checkOutDate)}
            Jumlah Tamu: ${booking.guests}
            Total Harga: Rp ${booking.totalPrice.toLocaleString('id-ID')}
            Status: ${booking.status}
            Tanggal Pemesanan: ${formatDate(booking.bookingDate)}
        `;
      if (booking.paymentId) {
        detailMessage += `\nID Pembayaran (Stripe): ${booking.paymentId}`;
      }
      // Untuk aplikasi nyata, gunakan modal yang lebih baik daripada alert.
      alert(detailMessage);
    }

    /**
     * Menangani submit form update profil.
     * @param {Event} event Event submit form.
     */
    function handleProfileUpdateForm(event) {
      event.preventDefault();
      if (!appState.currentUser) return;

      const newName = $('#profileFullName').value.trim();
      const newPhone = $('#profilePhone').value.trim();

      if (newName === "") {
        showToast('Nama lengkap tidak boleh kosong.', 'error');
        return;
      }
      // Validasi nomor telepon (sederhana, bisa lebih kompleks)
      if (newPhone && !/^\+?[0-9\s-]{7,15}$/.test(newPhone)) {
        showToast('Format nomor telepon tidak valid.', 'error');
        return;
      }

      appState.currentUser.name = newName;
      appState.currentUser.phone = newPhone;

      showToast('Informasi profil berhasil diperbarui!', 'success');
      console.log("Profil diperbarui (simulasi):", appState.currentUser);
      // Update nama di navbar jika berubah
      updateNavbarAuthActions();
    }

    /**
     * Menangani submit form ubah kata sandi (simulasi).
     * @param {Event} event Event submit form.
     */
    function handlePasswordChangeForm(event) {
      event.preventDefault();
      const currentPassword = $('#currentPassword').value;
      const newPassword = $('#newPassword').value;
      const confirmNewPassword = $('#confirmNewPassword').value;

      if (!currentPassword || !newPassword || !confirmNewPassword) {
        showToast('Semua field kata sandi wajib diisi!', 'error');
        return;
      }
      if (newPassword.length < 8) {
        showToast('Kata sandi baru minimal 8 karakter!', 'error');
        return;
      }
      if (newPassword !== confirmNewPassword) {
        showToast('Konfirmasi kata sandi baru tidak cocok!', 'error');
        return;
      }

      // SIMULASI: Di aplikasi nyata, kirim ke server untuk validasi kata sandi saat ini dan proses perubahan.
      console.log("Permintaan ubah password (simulasi):", { currentPassword, newPassword });
      showToast('Permintaan ubah kata sandi terkirim (simulasi). Kata sandi Anda tidak benar-benar diubah dalam demo ini.', 'success');
      event.target.reset(); // Reset form setelah submit
    }

    // === AUTENTIKASI (Simulasi Sederhana) ===
    /**
     * Menangani submit form login (simulasi).
     * @param {Event} event Event submit form.
     */
    function handleLoginForm(event) {
      event.preventDefault();
      const email = $('#loginEmail').value.trim();
      // const password = $('#loginPassword').value; // Di dunia nyata, kirim email & password ke server untuk validasi

      if (!email) { // Validasi email sederhana
        showToast('Email tidak boleh kosong.', 'error');
        return;
      }
      // Simulasi login berhasil
      appState.currentUser = {
        id: `user-${Date.now().toString().slice(-5)}`,
        name: email.split('@')[0] || 'Pengguna Baru', // Ambil nama dari bagian email sebelum @
        email: email,
        phone: ''
      };
      showToast(`Selamat datang kembali, ${appState.currentUser.name}!`, 'success');
      closeModal('loginModal');
      $('#loginForm').reset();

      updateNavbarAuthActions(); // Update tampilan navbar
      // Jika pengguna berada di halaman profil, render ulang kontennya untuk menampilkan data pengguna
      if (appState.currentPage === 'profile-section') {
        renderProfilePage();
      }
    }

    /**
     * Menangani submit form registrasi (simulasi).
     * @param {Event} event Event submit form.
     */
    function handleRegisterForm(event) {
      event.preventDefault();
      const fullName = $('#registerFullName').value.trim();
      const email = $('#registerEmail').value.trim();
      const password = $('#registerPassword').value;
      const confirmPassword = $('#registerConfirmPassword').value;
      const termsAccepted = $('#registerTerms').checked;

      if (!fullName || !email || !password || !confirmPassword) {
        showToast('Semua field wajib diisi!', 'error');
        return;
      }
      if (password.length < 8) {
        showToast('Kata sandi minimal 8 karakter!', 'error');
        return;
      }
      if (password !== confirmPassword) {
        showToast('Konfirmasi kata sandi tidak cocok!', 'error');
        return;
      }
      if (!termsAccepted) {
        showToast('Anda harus menyetujui Syarat & Ketentuan.', 'error');
        return;
      }
      // Simulasi registrasi berhasil
      appState.currentUser = {
        id: `user-${Date.now().toString().slice(-5)}`,
        name: fullName,
        email: email,
        phone: ''
      };
      showToast('Pendaftaran berhasil! Selamat datang.', 'success');
      closeModal('registerModal');
      $('#registerForm').reset();

      updateNavbarAuthActions(); // Update tampilan navbar
      if (appState.currentPage === 'profile-section') {
        renderProfilePage();
      }
    }

    /**
     * Menangani proses logout pengguna (simulasi).
     */
    function handleLogout() {
      appState.currentUser = null;
      appState.bookings = []; // Kosongkan riwayat booking saat logout (sesuaikan jika perlu persistensi)
      showToast('Anda telah berhasil keluar.', 'info');
      updateNavbarAuthActions(); // Update tampilan navbar

      // Jika pengguna sedang di halaman profil, render ulang untuk tampilan logged-out
      // Jika tidak, arahkan ke halaman beranda
      if (appState.currentPage === 'profile-section') {
        renderProfilePage();
      } else {
        navigateToPage(APP_CONFIG.defaultPage);
      }
    }

    /**
     * Memperbarui tampilan tombol aksi (login/logout, nama pengguna) di navbar.
     */
    function updateNavbarAuthActions() {
      const navbarAuthActions = $('#navbarAuthActions');
      if (!navbarAuthActions) return;

      if (appState.currentUser) {
        // Tampilan jika pengguna login
        navbarAuthActions.innerHTML = `
                <span class="nav-link text-neutral-dark" style="padding-right: 0.5rem; font-weight:normal;">Halo, ${appState.currentUser.name.split(' ')[0]}!</span>
                <button class="btn btn-outline-primary btn-sm" id="navbarLogoutButtonGlobal"><i class="fas fa-sign-out-alt"></i> Keluar</button>
            `;
        $('#navbarLogoutButtonGlobal')?.addEventListener('click', handleLogout);
      } else {
        // Tampilan jika pengguna belum login
        navbarAuthActions.innerHTML = `
                <button class="btn btn-primary btn-sm" data-modal-target="loginModal"><i class="fas fa-sign-in-alt"></i> Masuk</button>
                <button class="btn btn-secondary btn-sm" data-modal-target="registerModal"><i class="fas fa-user-plus"></i> Daftar</button>
            `;
      }
    }

    // === INISIALISASI APLIKASI ===
    document.addEventListener('DOMContentLoaded', async () => {
      console.log("RentalPro App Initializing...");
      setupNavbar();
      setupModalEventListeners();
      setupFabToTop();
      updateNavbarAuthActions(); // Tampilkan tombol login/daftar awal
      populateAmenitiesFilter(); // Isi filter fasilitas

      // Atur tahun copyright di footer
      const currentYearSpan = $('#currentYear');
      if (currentYearSpan) currentYearSpan.textContent = new Date().getFullYear();

      // Event listener untuk form kontak (simulasi)
      const contactForm = $('#contactForm');
      if (contactForm) {
        contactForm.addEventListener('submit', (e) => {
          e.preventDefault();
          showToast('Pesan Anda telah terkirim (simulasi). Terima kasih!', 'success');
          contactForm.reset();
        });
      }

      // Event listener untuk form pencarian di hero dan halaman search
      const heroSearchForm = $('#heroSearchForm');
      if (heroSearchForm) heroSearchForm.addEventListener('submit', handleSearchFormSubmit);

      const mainSearchForm = $('#mainSearchForm');
      if (mainSearchForm) mainSearchForm.addEventListener('submit', handleSearchFormSubmit);

      // Event listener untuk tombol "Pesan Sekarang" di modal detail
      const bookAptBtn = $('#bookApartmentButton');
      if (bookAptBtn) bookAptBtn.addEventListener('click', handleBookApartmentClick);

      // Event listener untuk form booking
      const bookingForm = $('#bookingForm');
      if (bookingForm) bookingForm.addEventListener('submit', handleBookingFormSubmit);

      // Event listener untuk form login dan register
      const loginForm = $('#loginForm');
      if (loginForm) loginForm.addEventListener('submit', handleLoginForm);
      const registerForm = $('#registerForm');
      if (registerForm) registerForm.addEventListener('submit', handleRegisterForm);

      // Event listener untuk perubahan hash URL (navigasi back/forward browser)
      window.addEventListener('hashchange', handleInitialPageLoad);

      // Muat data apartemen
      await fetchApartmentsData();
      displaySearchResults(1); // Tampilkan semua apartemen di halaman 1 saat awal (jika di search page)

      handleInitialPageLoad(); // Navigasi ke halaman sesuai hash atau default

      console.log("RentalPro App Ready!");
    });

  </script>
</body>

</html>