<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Green Valley | Platform Sewa Apartemen Premium</title>
  <meta name="description"
    content="Temukan dan sewa apartemen elite dengan fasilitas premium di lokasi strategis. Proses mudah, aman, dan terpercaya bersama Green Valley.">
  <meta name="keywords"
    content="sewa apartemen, apartemen premium, rental apartemen, apartemen jakarta, apartemen bandung, elite rent">
  <meta name="author" content="Green Valley Team">

  <!-- Kebijakan Keamanan Konten (CSP) - Dasar -->
  <!-- Ini adalah contoh CSP yang ketat. Anda mungkin perlu menyesuaikannya jika menggunakan sumber eksternal lain. -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; 
                 script-src 'self' 'unsafe-inline'; 
                 style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com; 
                 font-src 'self' https://fonts.gstatic.com; 
                 img-src 'self' https://source.unsplash.com https://fonts.gstatic.com data:;
                 connect-src 'self';
                 frame-src 'none';
                 object-src 'none';">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta http-equiv="X-XSS-Protection" content="1; mode=block">
  <link rel="canonical" href="https://example.com/Green Valley/"> <!-- Ganti dengan URL produksi Anda -->

  <!-- Ikon Aplikasi -->
  <!-- Menggunakan Material Icons sebagai Favicon (Format Font, bukan SVG langsung) -->
  <link rel="icon" href="https://fonts.gstatic.com/s/i/materialiconsoutlined/holiday_village/v12/24px.svg"
    type="image/svg+xml">
  <!-- Fallback Favicon jika browser tidak mendukung SVG sebagai ikon -->
  <link rel="alternate icon" href="https://fonts.gstatic.com/s/i/materialiconsoutlined/holiday_village/v12/32px.png"
    type="image/png">


  <!-- Google Fonts: Inter (untuk teks utama) & Material Icons (untuk ikon) -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">

  <style>
    /* === SISTEM DESAIN & GAYA GLOBAL === */
    :root {
      /* Palet Warna Utama (Monokromatik Biru dengan Aksen) */
      --primary-hue: 210;
      --primary-saturation: 85%;
      --primary-lightness: 50%;
      /* Sedikit lebih gelap untuk kontras yang lebih baik */
      --primary: hsl(var(--primary-hue), var(--primary-saturation), var(--primary-lightness));
      --primary-hover: hsl(var(--primary-hue), var(--primary-saturation), calc(var(--primary-lightness) - 7%));
      --primary-focus-ring: hsla(var(--primary-hue), var(--primary-saturation), calc(var(--primary-lightness) + 10%), 0.4);
      --primary-foreground: #ffffff;
      /* Teks di atas warna primer */

      --secondary-hue: 215;
      --secondary-saturation: 20%;
      /* Saturasi lebih untuk membedakan dari abu-abu murni */
      --secondary-lightness: 95%;
      --secondary: hsl(var(--secondary-hue), var(--secondary-saturation), var(--secondary-lightness));
      --secondary-foreground: hsl(var(--secondary-hue), 12%, 25%);
      /* Teks di atas warna sekunder */

      --accent-hue: 35;
      /* Oranye/Emas untuk aksen */
      --accent-saturation: 90%;
      --accent-lightness: 55%;
      --accent: hsl(var(--accent-hue), var(--accent-saturation), var(--accent-lightness));
      --accent-foreground: hsl(var(--accent-hue), 80%, 15%);

      /* Warna Semantik (Untuk status, notifikasi) */
      --success-h: 135;
      --success-s: 60%;
      --success-l: 45%;
      --success: hsl(var(--success-h), var(--success-s), var(--success-l));
      --success-foreground: #ffffff;
      --warning-h: 45;
      --warning-s: 95%;
      --warning-l: 50%;
      --warning: hsl(var(--warning-h), var(--warning-s), var(--warning-l));
      --warning-foreground: hsl(var(--warning-h), 70%, 15%);
      --danger-h: 0;
      --danger-s: 80%;
      --danger-l: 58%;
      --danger: hsl(var(--danger-h), var(--danger-s), var(--danger-l));
      --danger-foreground: #ffffff;
      --info-h: 195;
      --info-s: 80%;
      --info-l: 50%;
      --info: hsl(var(--info-h), var(--info-s), var(--info-l));
      --info-foreground: #ffffff;

      /* Warna Latar Belakang dan Teks Dasar */
      --background: #ffffff;
      --foreground: #111827;
      /* Abu-abu sangat gelap, hampir hitam */
      --card: #ffffff;
      --card-foreground: var(--foreground);
      --muted-foreground: #6b7280;
      /* Abu-abu lebih terang untuk teks sekunder */

      /* Border dan Input */
      --border: hsl(var(--secondary-hue), 15%, 88%);
      --input-border: hsl(var(--secondary-hue), 15%, 80%);
      --input-focus-border: var(--primary);

      /* Tipografi */
      --font-family-sans: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      --font-size-xs: clamp(0.75rem, 0.5vw + 0.6rem, 0.875rem);
      /* 12px-14px */
      --font-size-sm: clamp(0.875rem, 0.5vw + 0.7rem, 1rem);
      /* 14px-16px */
      --font-size-base: clamp(1rem, 0.5vw + 0.8rem, 1.125rem);
      /* 16px-18px */
      --font-size-lg: clamp(1.125rem, 0.5vw + 0.9rem, 1.25rem);
      /* 18px-20px */
      --font-size-xl: clamp(1.25rem, 0.5vw + 1rem, 1.5rem);
      /* 20px-24px */
      --font-size-2xl: clamp(1.5rem, 1vw + 1rem, 2rem);
      /* 24px-32px */
      --font-size-3xl: clamp(1.875rem, 1.5vw + 1.2rem, 2.5rem);
      /* 30px-40px */
      --line-height-base: 1.65;
      --line-height-heading: 1.3;

      /* Spasi (berdasarkan skala 4px) */
      --spacing-unit: 0.25rem;
      /* 4px */
      --spacing-xs: calc(var(--spacing-unit) * 2);
      /* 8px */
      --spacing-sm: calc(var(--spacing-unit) * 3);
      /* 12px */
      --spacing-md: calc(var(--spacing-unit) * 4);
      /* 16px */
      --spacing-lg: calc(var(--spacing-unit) * 6);
      /* 24px */
      --spacing-xl: calc(var(--spacing-unit) * 8);
      /* 32px */
      --spacing-xxl: calc(var(--spacing-unit) * 12);
      /* 48px */

      /* Radius Sudut */
      --radius-sm: 0.25rem;
      /* 4px */
      --radius-md: 0.5rem;
      /* 8px */
      --radius-lg: 0.75rem;
      /* 12px */
      --radius-xl: 1rem;
      /* 16px */
      --radius-full: 9999px;
      --border-width: 1px;
      --border-width-lg: 2px;

      /* Bayangan (Shadows) */
      --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.03);
      --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.07), 0 1px 2px -1px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.08), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -4px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.08);

      /* Transisi */
      --transition-fast: all 150ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-base: all 250ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-slow: all 400ms cubic-bezier(0.4, 0, 0.2, 1);

      /* Z-Index Layers (Hirarki Tampilan) */
      --z-base: 0;
      --z-content: 10;
      --z-dropdown: 1000;
      --z-sticky: 1020;
      --z-modal-backdrop: 1040;
      --z-modal: 1050;
      --z-popover: 1060;
      --z-toast: 1080;
      --z-tooltip: 1090;
      --z-dev-overlay: 9999;
      /* Untuk debug jika perlu */
    }

    /* === CSS RESET & GAYA DASAR === */
    *,
    *::before,
    *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      font-size: 100%;
      scroll-behavior: smooth;
      height: 100%;
    }

    body {
      font-family: var(--font-family-sans);
      font-size: var(--font-size-base);
      line-height: var(--line-height-base);
      background-color: var(--secondary);
      /* Latar lebih lembut */
      color: var(--foreground);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow-x: hidden;
    }

    main {
      flex-grow: 1;
      width: 100%;
    }

    a {
      color: var(--primary);
      text-decoration: none;
      transition: var(--transition-fast);
    }

    a:hover,
    a:focus-visible {
      color: var(--primary-hover);
      text-decoration: underline;
      text-decoration-thickness: 1.5px;
      text-underline-offset: 3px;
      /* Jarak underline lebih baik */
    }

    img,
    picture,
    video,
    canvas {
      display: block;
      max-width: 100%;
      height: auto;
    }

    button,
    input,
    select,
    textarea {
      font-family: inherit;
      font-size: inherit;
      line-height: inherit;
      color: inherit;
      border: var(--border-width) solid var(--input-border);
    }

    button {
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
      text-align: inherit;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-weight: 700;
      line-height: var(--line-height-heading);
      margin-bottom: var(--spacing-md);
      color: var(--foreground);
      letter-spacing: -0.025em;
      /* Sedikit kerning negatif untuk judul besar */
    }

    h1 {
      font-size: var(--font-size-3xl);
    }

    h2 {
      font-size: var(--font-size-2xl);
    }

    h3 {
      font-size: var(--font-size-xl);
    }

    h4 {
      font-size: var(--font-size-lg);
    }

    p {
      margin-bottom: var(--spacing-md);
      color: var(--muted-foreground);
      /* Paragraf menggunakan warna muted */
    }

    ul,
    ol {
      list-style-position: outside;
      /* Posisi bullet/number di luar */
      margin-bottom: var(--spacing-md);
      padding-left: var(--spacing-lg);
      /* Indentasi lebih jelas */
    }

    li {
      margin-bottom: var(--spacing-xs);
    }

    /* Kustom Scrollbar (Untuk browser berbasis WebKit) */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--secondary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--muted-foreground);
      border-radius: var(--radius-full);
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary);
    }

    /* === KELAS UTILITAS (UTILITIES) === */
    .container {
      width: 100%;
      max-width: 1280px;
      margin-left: auto;
      margin-right: auto;
      padding-left: var(--spacing-lg);
      /* Padding container lebih besar */
      padding-right: var(--spacing-lg);
    }

    @media (max-width: 768px) {
      .container {
        padding-left: var(--spacing-md);
        padding-right: var(--spacing-md);
      }
    }

    .section {
      padding-top: var(--spacing-xl);
      padding-bottom: var(--spacing-xl);
    }

    @media (min-width: 768px) {
      .section {
        padding-top: var(--spacing-xxl);
        padding-bottom: var(--spacing-xxl);
      }
    }

    /* Flexbox Utilities */
    .flex {
      display: flex;
    }

    .inline-flex {
      display: inline-flex;
    }

    .flex-col {
      flex-direction: column;
    }

    .flex-wrap {
      flex-wrap: wrap;
    }

    .flex-grow {
      flex-grow: 1;
    }

    .items-center {
      align-items: center;
    }

    .items-start {
      align-items: flex-start;
    }

    .items-end {
      align-items: flex-end;
    }

    .items-stretch {
      align-items: stretch;
    }

    .justify-center {
      justify-content: center;
    }

    .justify-between {
      justify-content: space-between;
    }

    .justify-start {
      justify-content: flex-start;
    }

    .justify-end {
      justify-content: flex-end;
    }

    /* Gap Utilities */
    .gap-xs {
      gap: var(--spacing-xs);
    }

    .gap-sm {
      gap: var(--spacing-sm);
    }

    .gap-md {
      gap: var(--spacing-md);
    }

    .gap-lg {
      gap: var(--spacing-lg);
    }

    .gap-xl {
      gap: var(--spacing-xl);
    }

    .gap-xxl {
      gap: var(--spacing-xxl);
    }

    /* Text Utilities */
    .text-center {
      text-align: center;
    }

    .text-left {
      text-align: left;
    }

    .text-right {
      text-align: right;
    }

    .text-primary {
      color: var(--primary) !important;
    }

    .text-secondary-foreground {
      color: var(--secondary-foreground) !important;
    }

    .text-muted-foreground {
      color: var(--muted-foreground) !important;
    }

    .text-danger {
      color: var(--danger) !important;
    }

    .text-success {
      color: var(--success) !important;
    }

    .text-warning {
      color: var(--warning) !important;
    }

    .text-info {
      color: var(--info) !important;
    }

    .text-xs {
      font-size: var(--font-size-xs);
    }

    .text-sm {
      font-size: var(--font-size-sm);
    }

    .text-lg {
      font-size: var(--font-size-lg);
    }

    .text-xl {
      font-size: var(--font-size-xl);
    }

    .text-2xl {
      font-size: var(--font-size-2xl);
    }

    .text-3xl {
      font-size: var(--font-size-3xl);
    }

    .font-light {
      font-weight: 300;
    }

    .font-normal {
      font-weight: 400;
    }

    .font-medium {
      font-weight: 500;
    }

    .font-semibold {
      font-weight: 600;
    }

    .font-bold {
      font-weight: 700;
    }

    .font-extrabold {
      font-weight: 800;
    }

    /* Padding & Margin Utilities (Contoh, bisa diperluas) */
    .p-0 {
      padding: 0 !important;
    }

    .p-xs {
      padding: var(--spacing-xs);
    }

    .p-sm {
      padding: var(--spacing-sm);
    }

    .p-md {
      padding: var(--spacing-md);
    }

    .p-lg {
      padding: var(--spacing-lg);
    }

    .p-xl {
      padding: var(--spacing-xl);
    }

    .py-md {
      padding-top: var(--spacing-md);
      padding-bottom: var(--spacing-md);
    }

    .px-md {
      padding-left: var(--spacing-md);
      padding-right: var(--spacing-md);
    }

    .m-0 {
      margin: 0 !important;
    }

    .mt-auto {
      margin-top: auto;
    }

    .mb-auto {
      margin-bottom: auto;
    }

    .mt-xs {
      margin-top: var(--spacing-xs);
    }

    .mb-xs {
      margin-bottom: var(--spacing-xs);
    }

    .mt-sm {
      margin-top: var(--spacing-sm);
    }

    .mb-sm {
      margin-bottom: var(--spacing-sm);
    }

    .mt-md {
      margin-top: var(--spacing-md);
    }

    .mb-md {
      margin-bottom: var(--spacing-md);
    }

    .mt-lg {
      margin-top: var(--spacing-lg);
    }

    .mb-lg {
      margin-bottom: var(--spacing-lg);
    }

    .mt-xl {
      margin-top: var(--spacing-xl);
    }

    .mb-xl {
      margin-bottom: var(--spacing-xl);
    }

    /* Width & Height */
    .w-full {
      width: 100%;
    }

    .h-full {
      height: 100%;
    }

    .min-h-screen {
      min-height: 100vh;
    }

    /* Border Radius */
    .rounded-sm {
      border-radius: var(--radius-sm);
    }

    .rounded-md {
      border-radius: var(--radius-md);
    }

    .rounded-lg {
      border-radius: var(--radius-lg);
    }

    .rounded-xl {
      border-radius: var(--radius-xl);
    }

    .rounded-full {
      border-radius: var(--radius-full);
    }

    /* Shadows */
    .shadow-sm {
      box-shadow: var(--shadow-sm);
    }

    .shadow-md {
      box-shadow: var(--shadow-md);
    }

    .shadow-lg {
      box-shadow: var(--shadow-lg);
    }

    .shadow-xl {
      box-shadow: var(--shadow-xl);
    }

    /* Visibility */
    .hidden {
      display: none !important;
    }

    .visually-hidden {
      /* Untuk aksesibilitas, menyembunyikan elemen secara visual tapi tetap terbaca screen reader */
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Animasi Halaman SPA */
    .page.fade-in {
      opacity: 0;
      transform: translateY(20px);
      /* Efek geser sedikit dari bawah */
      animation: fadeInPageAnimation 0.4s forwards ease-out;
    }

    @keyframes fadeInPageAnimation {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Sistem Grid (Dasar) */
    .grid {
      display: grid;
      gap: var(--spacing-md);
    }

    .grid-cols-1 {
      grid-template-columns: repeat(1, 1fr);
    }

    .grid-cols-fill-xs {
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    }

    .grid-cols-fill-sm {
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    }

    .grid-cols-fill-md {
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
    }

    /* Sedikit lebih besar untuk kartu */

    @media (min-width: 640px) {

      /* sm */
      .sm\:grid-cols-2 {
        grid-template-columns: repeat(2, 1fr);
      }

      .sm\:grid-cols-3 {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (min-width: 768px) {

      /* md */
      .md\:grid-cols-2 {
        grid-template-columns: repeat(2, 1fr);
      }

      .md\:grid-cols-3 {
        grid-template-columns: repeat(3, 1fr);
      }

      .md\:grid-cols-4 {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    @media (min-width: 1024px) {

      /* lg */
      .lg\:grid-cols-3 {
        grid-template-columns: repeat(3, 1fr);
      }

      .lg\:grid-cols-4 {
        grid-template-columns: repeat(4, 1fr);
      }

      .lg\:grid-cols-12 {
        grid-template-columns: repeat(12, 1fr);
      }

      /* Untuk layout lebih kompleks */
      .lg\:col-span-3 {
        grid-column: span 3 / span 3;
      }

      .lg\:col-span-4 {
        grid-column: span 4 / span 4;
      }

      .lg\:col-span-8 {
        grid-column: span 8 / span 8;
      }

      .lg\:col-span-9 {
        grid-column: span 9 / span 9;
      }
    }

    @media (min-width: 1280px) {

      /* xl */
      .xl\:col-span-3 {
        grid-column: span 3 / span 3;
      }
    }


    /* === GAYA KOMPONEN (COMPONENT STYLES) === */

    /* Navigasi (Navbar) */
    .navbar {
      background: var(--card);
      /* Navbar dengan latar card untuk konsistensi tema */
      padding-top: var(--spacing-md);
      padding-bottom: var(--spacing-md);
      position: sticky;
      /* Navbar menempel di atas saat scroll */
      top: 0;
      z-index: var(--z-sticky);
      box-shadow: var(--shadow-sm);
      border-bottom: var(--border-width) solid var(--border);
    }

    .navbar .container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nav-brand {
      font-size: var(--font-size-xl);
      font-weight: 800;
      /* Brand lebih tebal */
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      text-decoration: none;
      transition: opacity var(--transition-fast);
    }

    .nav-brand:hover,
    .nav-brand:focus-visible {
      color: var(--primary-hover);
      text-decoration: none;
      opacity: 0.85;
    }

    .nav-brand .material-icons {
      font-size: 1.5em;
      /* Ukuran ikon brand relatif */
    }

    .nav-links {
      display: flex;
      gap: var(--spacing-sm);
      list-style: none;
      align-items: center;
    }

    @media (min-width: 768px) {
      .nav-links {
        gap: var(--spacing-lg);
      }
    }

    .nav-link {
      font-weight: 500;
      padding: var(--spacing-sm) var(--spacing-xs);
      position: relative;
      color: var(--muted-foreground);
      /* Warna link nav lebih lembut */
      transition: color var(--transition-fast), border-color var(--transition-fast);
      border-bottom: 3px solid transparent;
      text-decoration: none;
    }

    .nav-link:hover,
    .nav-link:focus-visible {
      color: var(--primary);
      border-bottom-color: hsl(var(--primary-hue), var(--primary-saturation), calc(var(--primary-lightness) + 30%));
      text-decoration: none;
    }

    .nav-link.is-active {
      color: var(--primary);
      font-weight: 600;
      border-bottom-color: var(--primary);
    }

    .mobile-menu-button {
      display: none;
      padding: var(--spacing-sm);
      color: var(--primary);
      background-color: transparent;
      border: none;
    }

    .mobile-menu-button .material-icons {
      font-size: 2rem;
      display: block;
    }

    /* Tombol (Buttons) */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm) var(--spacing-lg);
      border-radius: var(--radius-md);
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition-base);
      border: var(--border-width-lg) solid transparent;
      text-align: center;
      white-space: nowrap;
      line-height: 1.5;
      text-decoration: none;
      user-select: none;
      /* Mencegah seleksi teks pada tombol */
    }

    .btn:focus-visible {
      outline: var(--border-width-lg) solid var(--primary-focus-ring);
      outline-offset: 2px;
    }

    .btn:hover,
    .btn:focus-visible {
      text-decoration: none;
    }

    .btn .material-icons {
      font-size: 1.25em;
      margin-right: var(--spacing-xs);
    }

    .btn .material-icons:only-child {
      margin-right: 0;
    }

    .btn-primary {
      background-color: var(--primary);
      color: var(--primary-foreground);
      border-color: var(--primary);
    }

    .btn-primary:hover,
    .btn-primary:focus-visible {
      background-color: var(--primary-hover);
      border-color: var(--primary-hover);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
      /* Efek angkat lebih jelas */
    }

    .btn-outline {
      background-color: transparent;
      border-color: var(--primary);
      color: var(--primary);
    }

    .btn-outline:hover,
    .btn-outline:focus-visible {
      background-color: hsl(var(--primary-hue), var(--primary-saturation), 95%);
      border-color: var(--primary-hover);
      color: var(--primary-hover);
    }

    .btn-success {
      background-color: var(--success);
      color: var(--success-foreground);
      border-color: var(--success);
    }

    .btn-success:hover,
    .btn-success:focus-visible {
      background-color: hsl(var(--success-h), var(--success-s), calc(var(--success-l) - 8%));
      border-color: hsl(var(--success-h), var(--success-s), calc(var(--success-l) - 8%));
    }

    .btn-danger {
      background-color: var(--danger);
      color: var(--danger-foreground);
      border-color: var(--danger);
    }

    .btn-danger:hover,
    .btn-danger:focus-visible {
      background-color: hsl(var(--danger-h), var(--danger-s), calc(var(--danger-l) - 8%));
      border-color: hsl(var(--danger-h), var(--danger-s), calc(var(--danger-l) - 8%));
    }

    .btn-sm {
      padding: var(--spacing-xs) var(--spacing-md);
      font-size: var(--font-size-sm);
      font-weight: 500;
    }

    .btn-lg {
      padding: var(--spacing-md) var(--spacing-xl);
      font-size: var(--font-size-lg);
    }

    .btn-icon {
      padding: var(--spacing-sm);
      border-radius: var(--radius-full);
    }

    .btn-icon .material-icons {
      margin: 0;
      font-size: 1.5em;
      /* Ikon di tombol ikon lebih besar */
    }

    /* Kartu (Cards) */
    .card {
      background-color: var(--card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      transition: transform var(--transition-base), box-shadow var(--transition-base);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      border: var(--border-width) solid var(--border);
      /* Tambah border tipis */
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .card-header {
      padding: var(--spacing-md);
      border-bottom: var(--border-width) solid var(--border);
    }

    .card-body {
      padding: var(--spacing-md);
      flex-grow: 1;
    }

    .card-footer {
      padding: var(--spacing-md);
      border-top: var(--border-width) solid var(--border);
      background-color: var(--secondary);
    }

    /* Kartu Properti (Spesifik) */
    .property-card figure {
      height: 100%;
    }

    .property-card figcaption {
      padding: var(--spacing-md);
    }

    .property-card img {
      width: 100%;
      height: 220px;
      object-fit: cover;
      border-bottom: var(--border-width) solid var(--border);
      transition: transform 0.3s ease-out;
    }

    .property-card:hover img {
      transform: scale(1.05);
    }

    .property-card h3 {
      font-size: var(--font-size-lg);
      margin-bottom: var(--spacing-sm);
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      color: var(--foreground);
    }

    .property-details {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-sm);
      font-size: var(--font-size-sm);
      flex-wrap: wrap;
      gap: var(--spacing-sm);
    }

    .price {
      color: var(--primary);
      font-weight: 700;
      font-size: var(--font-size-lg);
    }

    /* Harga lebih menonjol */
    .location {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      color: var(--muted-foreground);
    }

    .property-features {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-md);
      color: var(--muted-foreground);
      font-size: var(--font-size-sm);
      margin-bottom: var(--spacing-md);
    }

    .property-features span {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .property-card details summary {
      color: var(--primary);
      font-weight: 500;
      padding: var(--spacing-sm) var(--spacing-md);
      cursor: pointer;
      list-style: none;
    }

    .property-card details summary::-webkit-details-marker {
      display: none;
    }

    .property-card details summary::after {
      content: 'keyboard_arrow_down';
      font-family: 'Material Icons';
      margin-left: auto;
      transition: transform var(--transition-fast);
    }

    .property-card details[open] summary::after {
      transform: rotate(180deg);
    }

    .property-card details>div {
      padding: 0 var(--spacing-md) var(--spacing-md);
    }

    /* Formulir (Forms) */
    .form-group {
      margin-bottom: var(--spacing-lg);
    }

    /* Jarak antar grup form lebih besar */
    .form-group label {
      display: block;
      font-weight: 500;
      margin-bottom: var(--spacing-sm);
      color: var(--secondary-foreground);
      font-size: var(--font-size-sm);
    }

    .form-control {
      width: 100%;
      padding: var(--spacing-sm) var(--spacing-md);
      border: var(--border-width) solid var(--input-border);
      border-radius: var(--radius-md);
      /* Radius input lebih besar */
      background-color: var(--background);
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
      line-height: 1.5;
    }

    .form-control:focus {
      border-color: var(--input-focus-border);
      outline: 0;
      box-shadow: 0 0 0 3px var(--primary-focus-ring);
    }

    .form-control[type="range"] {
      padding: 0;
      cursor: pointer;
    }

    .form-control::placeholder {
      color: hsl(var(--secondary-hue), 10%, 65%);
      opacity: 1;
    }

    .form-check {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .form-check-input {
      width: auto;
      accent-color: var(--primary);
      margin-top: 2px;
      /* Penyesuaian vertikal */
    }

    .form-check label {
      margin-bottom: 0;
      font-weight: 400;
    }

    /* Form Pencarian (Spesifik) */
    .search-form-container {
      background-color: var(--card);
      padding: var(--spacing-lg);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      margin-bottom: var(--spacing-xl);
    }

    .search-filters-sidebar {
      position: sticky;
      top: calc(var(--spacing-xxl) + var(--spacing-md));
      /* Sticky filter dengan offset dari navbar */
      height: fit-content;
    }

    @media (max-width: 1023px) {
      .search-filters-sidebar {
        position: static;
      }
    }

    /* Non-sticky di mobile/tablet */
    #amenitiesFilterCheckboxes {
      max-height: 200px;
      overflow-y: auto;
      padding: var(--spacing-sm);
      border: var(--border-width) solid var(--border);
      border-radius: var(--radius-md);
    }

    /* Placeholder Peta */
    .map-canvas {
      width: 100%;
      height: 300px;
      /* Peta lebih tinggi */
      background-color: var(--secondary);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--muted-foreground);
      border: var(--border-width) dashed var(--border);
      font-style: italic;
      text-align: center;
      padding: var(--spacing-md);
    }

    /* Detail/Ringkasan (Seperti Akordeon) */
    details {
      background-color: transparent;
      border-radius: var(--radius-md);
      border: var(--border-width) solid var(--border);
      margin-bottom: var(--spacing-sm);
    }

    details summary {
      padding: var(--spacing-md);
      cursor: pointer;
      color: var(--primary);
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      list-style: none;
      transition: background-color var(--transition-fast);
    }

    details summary:hover,
    details summary:focus-visible {
      background-color: hsl(var(--primary-hue), var(--primary-saturation), 95%);
    }

    details summary::-webkit-details-marker {
      display: none;
    }

    details summary::after {
      content: 'expand_more';
      font-family: 'Material Icons';
      font-weight: normal;
      font-style: normal;
      font-size: 24px;
      line-height: 1;
      transition: transform var(--transition-slow);
    }

    details[open] summary {
      border-bottom: var(--border-width) solid var(--border);
    }

    /* Garis bawah jika terbuka */
    details[open] summary::after {
      transform: rotate(180deg);
    }

    details>div {
      padding: var(--spacing-md);
    }

    /* Kutipan (Blockquote) */
    blockquote {
      border-left: 4px solid var(--primary);
      padding-left: var(--spacing-md);
      margin: var(--spacing-md) 0;
      font-style: italic;
      color: var(--muted-foreground);
    }

    blockquote footer {
      font-style: normal;
      font-size: var(--font-size-sm);
      color: var(--foreground);
      margin-top: var(--spacing-xs);
      text-align: right;
    }

    blockquote p:last-child {
      margin-bottom: 0;
    }

    /* Ikon Lapor & Terverifikasi */
    .report-icon {
      cursor: pointer;
      font-size: 1.2em;
      vertical-align: middle;
      margin-left: var(--spacing-xs);
      color: var(--muted-foreground);
      transition: color var(--transition-fast);
    }

    .report-icon:hover,
    .report-icon:focus-visible {
      color: var(--danger);
    }

    .verified-icon {
      color: var(--success);
      font-size: 1em;
      vertical-align: middle;
    }

    /* Galeri & Tur Virtual */
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-lg);
    }

    .gallery img {
      width: 100%;
      height: 100px;
      object-fit: cover;
      border-radius: var(--radius-md);
      transition: transform var(--transition-base), box-shadow var(--transition-base), border-color var(--transition-base);
      cursor: pointer;
      border: var(--border-width-lg) solid transparent;
      /* Border untuk fokus */
    }

    .gallery img:hover,
    .gallery img:focus-visible {
      transform: scale(1.08);
      box-shadow: var(--shadow-lg);
      z-index: var(--z-content);
      border-color: var(--primary);
      /* Outline fokus dengan border */
    }

    .virtual-tour-placeholder {
      /* Mengambil 2 kolom dan 2 baris jika di grid yang lebih besar */
      grid-column: span 2 / span 2;
      grid-row: span 2 / span 2;
      min-height: 350px;
      background-color: var(--foreground);
      color: var(--background);
      border-radius: var(--radius-lg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: var(--spacing-md);
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .virtual-tour-placeholder .material-icons {
      font-size: 4rem;
      margin-bottom: var(--spacing-md);
    }

    .virtual-tour-placeholder p {
      color: var(--secondary);
    }

    .virtual-tour-placeholder:hover::before {
      /* Overlay hover */
      content: "Lihat Tur Virtual";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    /* Pastikan gambar lain di gallery tidak terlalu besar saat placeholder tur virtual ada */
    .gallery .virtual-tour-placeholder+img,
    .gallery .virtual-tour-placeholder~img {
      height: calc((350px - var(--spacing-sm)) / 2);
      /* Sesuaikan tinggi thumbnail lain */
    }

    /* Style untuk foto utama galeri yang lebih besar */
    .gallery .main-photo {
      grid-column: span 2 / span 2;
      /* Lebar 2 kolom */
      grid-row: span 2 / span 2;
      /* Tinggi 2 baris */
      height: auto;
      /* Biarkan tinggi otomatis sesuai rasio */
      min-height: 350px;
      /* Tinggi minimal agar tetap besar */
    }

    .gallery .thumbnail-photo {
      height: calc((350px - var(--spacing-sm)) / 2);
      /* Sesuaikan tinggi thumbnail jika ada main photo */
    }


    /* Sistem Obrolan (Chat) */
    .chat-window {
      height: 300px;
      overflow-y: auto;
      border: var(--border-width) solid var(--border);
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      background-color: var(--secondary);
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
    }

    .chat-message {
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--radius-md);
      max-width: 80%;
      word-wrap: break-word;
      line-height: 1.4;
    }

    .chat-message.sent {
      background-color: var(--primary);
      color: var(--primary-foreground);
      align-self: flex-end;
      border-bottom-right-radius: var(--radius-sm);
    }

    .chat-message.received {
      background-color: var(--card);
      color: var(--card-foreground);
      align-self: flex-start;
      border-bottom-left-radius: var(--radius-sm);
      box-shadow: var(--shadow-sm);
    }

    .chat-message.system {
      background-color: transparent;
      color: var(--muted-foreground);
      font-style: italic;
      font-size: var(--font-size-sm);
      text-align: center;
      align-self: center;
      padding: var(--spacing-xs);
    }

    .chat-input-group {
      display: flex;
      margin-top: var(--spacing-md);
    }

    .chat-input-group input {
      flex-grow: 1;
      border-right: none;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }

    .chat-input-group button {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      padding-left: var(--spacing-md);
      padding-right: var(--spacing-md);
    }

    /* Metode Pembayaran */
    .payment-methods {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-md);
      /* Gap lebih besar */
    }

    .payment-method {
      padding: var(--spacing-md);
      border: var(--border-width-lg) solid var(--border);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: var(--transition-fast);
      text-align: center;
      flex-grow: 1;
      background-color: var(--card);
      font-weight: 500;
      /* Font lebih normal */
    }

    .payment-method:hover,
    .payment-method:focus-visible {
      border-color: var(--primary);
      background-color: hsl(var(--primary-hue), var(--primary-saturation), 97%);
    }

    .payment-method.selected {
      border-color: var(--primary);
      background-color: hsl(var(--primary-hue), var(--primary-saturation), 92%);
      font-weight: 600;
      box-shadow: 0 0 0 2px var(--primary) inset;
      /* Indikator terpilih lebih jelas */
      color: var(--primary);
    }

    /* Rincian Biaya (Cost Breakdown) */
    .cost-breakdown {
      background-color: var(--secondary);
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      margin-top: var(--spacing-md);
      border: var(--border-width) solid var(--border);
    }

    .cost-breakdown h4 {
      margin-bottom: var(--spacing-sm);
      font-size: var(--font-size-lg);
      color: var(--foreground);
    }

    .cost-line {
      display: flex;
      justify-content: space-between;
      margin-bottom: var(--spacing-xs);
      font-size: var(--font-size-sm);
      color: var(--muted-foreground);
    }

    .cost-line span:last-child {
      font-weight: 500;
      color: var(--foreground);
    }

    .cost-line.total {
      font-weight: 700;
      font-size: var(--font-size-lg);
      margin-top: var(--spacing-sm);
      padding-top: var(--spacing-sm);
      border-top: var(--border-width) dashed var(--border);
      color: var(--foreground);
    }

    /* Info Escrow */
    .escrow-info {
      background-color: hsl(var(--info-h), var(--info-s), 95%);
      padding: var(--spacing-md);
      /* Padding lebih besar */
      border-left: 4px solid var(--info);
      margin: var(--spacing-md) 0;
      font-size: var(--font-size-sm);
      border-radius: var(--radius-md);
      color: hsl(var(--info-h), var(--info-s), 30%);
    }

    .escrow-info .material-icons {
      vertical-align: bottom;
      margin-right: var(--spacing-sm);
      color: var(--info);
      font-size: 1.2em;
    }

    /* Tombol Chat Melayang & Widget Chatbox */
    .floating-chat-btn {
      position: fixed;
      bottom: var(--spacing-lg);
      right: var(--spacing-lg);
      z-index: var(--z-popover);
      box-shadow: var(--shadow-xl);
      /* Bayangan lebih kuat */
      border-radius: var(--radius-full);
      width: 60px;
      height: 60px;
      /* Tombol lebih besar */
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      /* Pusatkan ikon */
    }

    .floating-chat-btn .material-icons {
      font-size: 28px;
      margin: 0;
    }

    .floating-chat-btn:hover,
    .floating-chat-btn:focus-visible {
      transform: scale(1.1) translateY(-3px);
      box-shadow: var(--shadow-xl);
    }

    .chatbox-widget {
      position: fixed;
      bottom: calc(var(--spacing-lg) + 60px + var(--spacing-md));
      /* Di atas tombol + spasi */
      right: var(--spacing-lg);
      background-color: var(--card);
      width: 370px;
      max-width: calc(100vw - (2 * var(--spacing-md)));
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-xl);
      display: flex;
      flex-direction: column;
      height: 500px;
      max-height: 75vh;
      z-index: var(--z-popover);
      overflow: hidden;
      transform-origin: bottom right;
      transition: transform var(--transition-slow), opacity var(--transition-slow), visibility var(--transition-slow);
      border: var(--border-width) solid var(--border);
      /* Border untuk chatbox */
    }

    .chatbox-widget.hidden {
      transform: scale(0.8) translateY(20px);
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }

    .chatbox-header {
      background-color: var(--primary);
      color: var(--primary-foreground);
      padding: var(--spacing-md);
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chatbox-header .close-chat-btn {
      color: var(--primary-foreground);
      background: transparent;
      border: none;
      padding: var(--spacing-xs);
      border-radius: var(--radius-full);
    }

    .chatbox-header .close-chat-btn:hover,
    .chatbox-header .close-chat-btn:focus-visible {
      background-color: rgba(255, 255, 255, 0.2);
    }

    .chatbox-body {
      flex-grow: 1;
      overflow-y: auto;
      padding: var(--spacing-md);
      background-color: var(--secondary);
    }

    .chatbox-input-area {
      padding: var(--spacing-md);
      border-top: var(--border-width) solid var(--border);
      background-color: var(--card);
    }

    /* Lencana Loyalitas (Loyalty Badge) */
    .loyalty-badge {
      background-color: var(--accent);
      color: var(--accent-foreground);
      padding: var(--spacing-xs) var(--spacing-md);
      /* Padding lebih besar */
      border-radius: var(--radius-md);
      font-size: var(--font-size-sm);
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .loyalty-badge .material-icons {
      font-size: 1.2em;
      color: hsl(var(--accent-hue), var(--accent-saturation), calc(var(--accent-lightness) - 20%));
    }

    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      /* Lebih singkat dari top,left,width,height */
      background-color: rgba(17, 24, 39, 0.7);
      /* Warna backdrop lebih modern (abu-abu gelap) */
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: var(--z-modal);
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition-base), visibility var(--transition-base);
      padding: var(--spacing-md);
    }

    .modal.is-open {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background-color: var(--card);
      padding: var(--spacing-lg);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-xl);
      width: 100%;
      max-width: 500px;
      transform: scale(0.95) translateY(10px);
      transition: transform var(--transition-base);
      overflow-y: auto;
      max-height: 90vh;
    }

    .modal.is-open .modal-content {
      transform: scale(1) translateY(0);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-md);
      border-bottom: var(--border-width) solid var(--border);
      padding-bottom: var(--spacing-md);
    }

    .modal-header h3 {
      margin-bottom: 0;
      font-size: var(--font-size-xl);
    }

    .modal-body textarea {
      min-height: 120px;
      resize: vertical;
    }

    .modal-footer {
      margin-top: var(--spacing-lg);
      display: flex;
      justify-content: flex-end;
      gap: var(--spacing-sm);
    }

    /* Tabel Admin */
    .table-responsive {
      overflow-x: auto;
      border: var(--border-width) solid var(--border);
      border-radius: var(--radius-md);
      margin-top: var(--spacing-md);
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 0;
    }

    .table th,
    .table td {
      padding: var(--spacing-sm) var(--spacing-md);
      text-align: left;
      border-bottom: var(--border-width) solid var(--border);
      vertical-align: middle;
      font-size: var(--font-size-sm);
    }

    .table th {
      background-color: var(--secondary);
      font-weight: 600;
      color: var(--foreground);
      white-space: nowrap;
      /* Header tabel tidak wrap */
    }

    .table tbody tr:last-child td {
      border-bottom: none;
    }

    .table tbody tr:hover {
      background-color: hsl(var(--primary-hue), var(--primary-saturation), 97%);
    }

    .table td .btn {
      margin-right: var(--spacing-xs);
    }

    .table td .btn:last-child {
      margin-right: 0;
    }

    /* Lencana Status (Badges) */
    .badge {
      display: inline-block;
      padding: calc(var(--spacing-xs) / 1.5) var(--spacing-sm);
      font-size: var(--font-size-xs);
      font-weight: 600;
      line-height: 1.2;
      text-align: center;
      white-space: nowrap;
      vertical-align: baseline;
      border-radius: var(--radius-full);
      /* Badge lebih bulat */
      border: 1px solid transparent;
      /* Untuk konsistensi */
    }

    .badge-success {
      background-color: hsl(var(--success-h), var(--success-s), 90%);
      color: hsl(var(--success-h), var(--success-s), 25%);
      border-color: hsl(var(--success-h), var(--success-s), 75%);
    }

    .badge-warning {
      background-color: hsl(var(--warning-h), var(--warning-s), 90%);
      color: hsl(var(--warning-h), var(--warning-s), 30%);
      border-color: hsl(var(--warning-h), var(--warning-s), 75%);
    }

    .badge-danger {
      background-color: hsl(var(--danger-h), var(--danger-s), 92%);
      color: hsl(var(--danger-h), var(--danger-s), 35%);
      border-color: hsl(var(--danger-h), var(--danger-s), 80%);
    }

    .badge-primary {
      background-color: hsl(var(--primary-hue), var(--primary-saturation), 93%);
      color: hsl(var(--primary-hue), var(--primary-saturation), 30%);
      border-color: hsl(var(--primary-hue), var(--primary-saturation), 80%);
    }

    .badge-info {
      background-color: hsl(var(--info-h), var(--info-s), 93%);
      color: hsl(var(--info-h), var(--info-s), 30%);
      border-color: hsl(var(--info-h), var(--info-s), 80%);
    }

    /* Bagian Kaki Aplikasi (Footer) */
    .app-footer {
      background-color: var(--foreground);
      color: var(--secondary);
      padding: var(--spacing-xl) 0;
      /* Padding lebih besar */
      text-align: center;
      font-size: var(--font-size-sm);
      margin-top: auto;
    }

    .app-footer p {
      margin-bottom: var(--spacing-xs);
      color: hsl(var(--secondary-hue), 10%, 75%);
    }

    .app-footer p:last-child {
      margin-bottom: 0;
    }

    .app-footer .material-icons {
      /* Untuk ikon hati */
      font-size: 1em;
      vertical-align: -0.125em;
      color: var(--danger);
    }

    /* === DESAIN RESPONSIVE === */
    @media (max-width: 1024px) {

      /* Tablet dan di bawahnya */
      .lg\:grid-cols-3,
      .lg\:grid-cols-4,
      .lg\:grid-cols-12 {
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      }

      .search-form-container .grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }

      .apartment-detail-grid {
        grid-template-columns: 1fr !important;
      }

      .apartment-detail-grid aside {
        position: static !important;
        margin-top: var(--spacing-lg);
      }

      .gallery .virtual-tour-placeholder {
        grid-column: span 1;
        grid-row: span 1;
      }

      /* Tur virtual jadi 1x1 di tablet */
    }

    @media (max-width: 767px) {

      /* Ponsel */
      :root {
        --font-size-base: 0.9375rem;
      }

      /* 15px */
      h1 {
        font-size: var(--font-size-2xl);
      }

      h2 {
        font-size: var(--font-size-xl);
      }

      h3 {
        font-size: var(--font-size-lg);
      }

      .container {
        padding-left: var(--spacing-md);
        padding-right: var(--spacing-md);
      }

      .navbar {
        padding-left: var(--spacing-md);
        padding-right: var(--spacing-md);
      }

      .nav-brand {
        font-size: var(--font-size-lg);
      }

      .nav-links {
        display: none;
        flex-direction: column;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        width: auto;
        background: var(--card);
        box-shadow: var(--shadow-lg);
        padding: var(--spacing-md);
        border-top: var(--border-width) solid var(--border);
        z-index: calc(var(--z-sticky) - 1);
      }

      .nav-links.is-open {
        display: flex;
        animation: slideDownMenu 0.3s ease-out forwards;
      }

      @keyframes slideDownMenu {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .nav-link {
        width: 100%;
        text-align: left;
        padding: var(--spacing-md);
        border-bottom-color: transparent;
      }

      /* Padding lebih besar di mobile */
      .nav-link.is-active {
        background-color: var(--secondary);
        border-left: 3px solid var(--primary);
        padding-left: calc(var(--spacing-md) - 3px);
      }

      .mobile-menu-button {
        display: block;
      }

      .grid-cols-fill-xs,
      .grid-cols-fill-sm,
      .grid-cols-fill-md,
      .sm\:grid-cols-2,
      .sm\:grid-cols-3,
      .md\:grid-cols-2,
      .md\:grid-cols-3,
      .md\:grid-cols-4 {
        grid-template-columns: 1fr;
      }

      .search-form-container .grid {
        grid-template-columns: 1fr;
      }

      .floating-chat-btn {
        width: 50px;
        height: 50px;
        bottom: var(--spacing-md);
        right: var(--spacing-md);
      }

      .floating-chat-btn .material-icons {
        font-size: 24px;
      }

      .chatbox-widget {
        width: calc(100vw - (2 * var(--spacing-md)));
        bottom: calc(var(--spacing-md) + 50px + var(--spacing-sm));
        right: var(--spacing-md);
        height: 75vh;
        max-height: 500px;
      }

      .payment-methods {
        flex-direction: column;
      }

      .modal-content {
        max-width: calc(100% - (2 * var(--spacing-sm)));
        padding: var(--spacing-md);
      }
    }

    /* === AKSESIBILITAS (ACCESSIBILITY) === */
    @media (prefers-reduced-motion: reduce) {
      html {
        scroll-behavior: auto;
      }

      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }

    *:focus-visible {
      outline: var(--border-width-lg) solid var(--primary);
      outline-offset: 3px;
      /* Offset lebih jelas */
      box-shadow: 0 0 0 5px var(--primary-focus-ring);
    }

    .btn:focus-visible,
    .nav-link:focus-visible,
    .payment-method:focus-visible,
    .gallery img:focus-visible,
    details summary:focus-visible {
      outline: none;
      /* Gaya fokus kustom sudah ada atau ditangani box-shadow */
    }

    .form-control:focus {
      /* Biarkan default :focus untuk form agar konsisten dengan :focus-visible */
      border-color: var(--input-focus-border);
      box-shadow: 0 0 0 3px var(--primary-focus-ring);
    }

    /* Gaya untuk Print */
    @media print {
      body {
        background-color: #fff !important;
        /* Latar putih untuk print */
        color: #000 !important;
        /* Teks hitam untuk print */
        font-size: 12pt;
        /* Ukuran font standar untuk print */
        line-height: 1.4;
      }

      .navbar,
      .app-footer,
      .floating-chat-btn,
      .chatbox-widget,
      .mobile-menu-button,
      .search-filters-sidebar,
      .apartment-detail-grid aside

      /* Sembunyikan form booking saat print */
        {
        display: none !important;
      }

      main,
      .container,
      .section,
      .page {
        padding: 0 !important;
        margin: 0 !important;
        max-width: 100% !important;
        box-shadow: none !important;
        border: none !important;
      }

      .card {
        box-shadow: none !important;
        border: 1px solid #ccc !important;
        /* Border tipis untuk card saat print */
        page-break-inside: avoid;
        /* Hindari card terpotong antar halaman */
      }

      a {
        text-decoration: none;
        color: #000 !important;
      }

      a[href^="http"]::after {
        content: " (" attr(href) ")";
        font-size: 0.9em;
      }

      /* Tampilkan URL untuk link eksternal */
      .page {
        display: block !important;
        opacity: 1 !important;
        transform: none !important;
      }

      /* Tampilkan semua halaman */
      img {
        max-width: 100% !important;
        page-break-inside: avoid;
      }

      .grid {
        display: block;
      }

      /* Ubah grid jadi block agar lebih mudah di-print */
      .map-canvas,
      .virtual-tour-placeholder {
        display: none;
      }

      /* Sembunyikan elemen interaktif berat */
      .btn {
        border: 1px solid #666 !important;
        background: #eee !important;
        color: #000 !important;
        padding: 4px 8px;
      }
    }
  </style>
</head>

<body class="antialiased">
  <!-- Bilah Navigasi Utama -->
  <header class="navbar" aria-label="Navigasi Utama">
    <div class="container">
      <a href="#home" class="nav-brand" aria-label="Green Valley Beranda">
        <span class="material-icons" aria-hidden="true">holiday_village</span>Green Valley
      </a>
      <button class="mobile-menu-button" aria-label="Buka menu navigasi" aria-expanded="false" aria-controls="navLinks">
        <span class="material-icons">menu</span> <!-- Akan diubah ke 'close' oleh JS -->
      </button>
      <nav aria-label="Tautan Navigasi Situs">
        <ul class="nav-links" id="navLinks">
          <li><a href="#home" class="nav-link is-active" data-page="home">Beranda</a></li>
          <li><a href="#search" class="nav-link" data-page="search">Pencarian</a></li>
          <li><a href="#profile" class="nav-link" data-page="profile">Profil Saya</a></li>
          <li><a href="#support" class="nav-link" data-page="support">Dukungan</a></li>
          <li><a href="#admin" class="nav-link" data-page="admin">Panel Admin</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Area Konten Utama (Untuk Single Page Application) -->
  <main id="app-main">
    <!-- Halaman Beranda -->
    <section id="home" class="page section fade-in" aria-labelledby="home-page-title">
      <div class="container">
        <header class="text-center mb-xl">
          <h1 id="home-page-title" class="font-extrabold text-3xl md:text-4xl lg:text-5xl">Temukan Apartemen <span
              class="text-primary">Impian Anda</span> di Green Valley</h1>
          <p class="text-lg text-muted-foreground mt-md max-w-2xl mx-auto">Jelajahi pilihan apartemen modern dengan
            fasilitas premium di lokasi strategis. Kenyamanan dan kemewahan menanti Anda.</p>
        </header>

        <!-- Formulir Pencarian Cepat -->
        <form id="quickSearchForm" class="search-form-container mb-xl" aria-label="Formulir Pencarian Cepat Apartemen">
          <div class="grid sm:grid-cols-3 gap-md items-end">
            <div class="form-group">
              <label for="quick-location">Lokasi Pilihan Anda</label>
              <input type="text" id="quick-location" class="form-control" placeholder="Contoh: Jakarta Pusat, Seminyak"
                aria-label="Cari lokasi apartemen">
            </div>
            <div class="form-group">
              <label for="quick-checkin">Tanggal Check-in</label>
              <input type="date" id="quick-checkin" class="form-control" aria-label="Pilih tanggal check-in">
            </div>
            <div class="form-group">
              <label for="quick-checkout">Tanggal Check-out</label>
              <input type="date" id="quick-checkout" class="form-control" aria-label="Pilih tanggal check-out">
            </div>
          </div>
          <button type="submit" class="btn btn-primary btn-lg w-full mt-lg">
            <span class="material-icons" aria-hidden="true">search</span>Cari Sekarang
          </button>
        </form>

        <!-- Bagian Properti Unggulan -->
        <section aria-labelledby="featured-properties-title" class="mb-xl">
          <h2 id="featured-properties-title" class="text-2xl font-bold mb-lg text-center md:text-left">Properti Unggulan
            Kami</h2>
          <div class="grid grid-cols-fill-md gap-lg" id="featuredPropertiesGrid">
            <p class="col-span-full text-center text-muted-foreground py-lg">Memuat properti unggulan...</p>
          </div>
        </section>

        <!-- Bagian Mengapa Memilih Kami -->
        <section aria-labelledby="why-choose-us-title" class="mt-xl py-xl bg-card shadow-sm rounded-xl">
          <div class="container">
            <h2 id="why-choose-us-title" class="text-2xl font-bold text-center mb-lg">Mengapa Memilih Green Valley?</h2>
            <div class="grid md:grid-cols-3 gap-lg">
              <div
                class="card text-center shadow-none border border-transparent hover:border-primary transition-all duration-300 ease-in-out hover:shadow-md">
                <div class="card-body p-lg">
                  <span class="material-icons text-primary mb-sm" style="font-size: 48px;"
                    aria-hidden="true">verified_user</span>
                  <h3 class="mt-sm text-xl font-semibold">Pembayaran Aman & Terjamin</h3>
                  <p class="text-muted-foreground text-sm">Transaksi Anda dilindungi dengan sistem escrow terpercaya dan
                    berbagai pilihan metode pembayaran modern.</p>
                </div>
              </div>
              <div
                class="card text-center shadow-none border border-transparent hover:border-primary transition-all duration-300 ease-in-out hover:shadow-md">
                <div class="card-body p-lg">
                  <span class="material-icons text-primary mb-sm" style="font-size: 48px;"
                    aria-hidden="true">support_agent</span>
                  <h3 class="mt-sm text-xl font-semibold">Dukungan Pelanggan 24/7</h3>
                  <p class="text-muted-foreground text-sm">Tim dukungan pelanggan profesional kami siap membantu Anda
                    kapan saja melalui chat, email, atau telepon.</p>
                </div>
              </div>
              <div
                class="card text-center shadow-none border border-transparent hover:border-primary transition-all duration-300 ease-in-out hover:shadow-md">
                <div class="card-body p-lg">
                  <span class="material-icons text-primary mb-sm" style="font-size: 48px;"
                    aria-hidden="true">apartment</span>
                  <h3 class="mt-sm text-xl font-semibold">Pilihan Apartemen Terbaik</h3>
                  <p class="text-muted-foreground text-sm">Koleksi apartemen berkualitas tinggi dengan pemilik yang
                    terverifikasi untuk kenyamanan dan kepuasan Anda.</p>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Bagian Testimoni -->
        <section aria-labelledby="testimonials-title" class="mt-xl">
          <h2 id="testimonials-title" class="text-2xl font-bold text-center mb-lg">Apa Kata Pelanggan Kami?</h2>
          <div class="grid md:grid-cols-2 gap-lg" id="testimonialsGrid">
            <p class="col-span-full text-center text-muted-foreground py-lg">Memuat testimoni...</p>
          </div>
        </section>
      </div>
    </section>

    <!-- Halaman Pencarian -->
    <section id="search" class="page section hidden" aria-labelledby="search-page-title">
      <div class="container">
        <header class="mb-lg">
          <h1 id="search-page-title" class="font-extrabold">Cari Apartemen Sesuai Keinginan Anda</h1>
          <p class="text-lg text-muted-foreground mt-sm">Gunakan filter canggih untuk menemukan apartemen yang paling
            cocok dengan kebutuhan dan preferensi Anda.</p>
        </header>
        <div class="grid lg:grid-cols-12 gap-xl">
          <aside class="lg:col-span-4 xl:col-span-3 search-filters-sidebar">
            <form id="fullSearchForm" class="search-form-container p-md sticky top-[calc(var(--spacing-xl)_*_2)]"
              aria-label="Formulir Filter Pencarian Lengkap">
              <h3 class="mb-md text-xl font-semibold">Filter Pencarian</h3>
              <div class="form-group">
                <label for="search-location">Lokasi</label>
                <input type="text" id="search-location" class="form-control" placeholder="Kota, area, atau nama gedung">
              </div>
              <div class="grid grid-cols-2 gap-md">
                <div class="form-group">
                  <label for="search-checkin">Check-in</label>
                  <input type="date" id="search-checkin" class="form-control">
                </div>
                <div class="form-group">
                  <label for="search-checkout">Check-out</label>
                  <input type="date" id="search-checkout" class="form-control">
                </div>
              </div>
              <div class="form-group">
                <label for="search-guests">Jumlah Tamu</label>
                <input type="number" id="search-guests" class="form-control" min="1" value="1">
              </div>
              <div class="form-group">
                <label for="priceRange">Rentang Harga (per malam)</label>
                <input type="range" id="priceRange" class="form-control" min="50" max="5000" value="1000" step="50">
                <div class="flex justify-between text-sm mt-xs text-muted-foreground">
                  <span>Rp <span id="priceRangeMinDisplay">50</span>K</span>
                  <span>Rp <span id="priceRangeMaxDisplay">1000</span>K</span>
                </div>
              </div>
              <div class="form-group">
                <label class="mb-xs">Fasilitas Unggulan</label>
                <div id="amenitiesFilterCheckboxes"
                  class="max-h-48 overflow-y-auto p-sm border border-border rounded-md space-y-sm bg-background">
                  <!-- Checkbox fasilitas akan dimasukkan di sini oleh JavaScript -->
                  <p class="text-xs text-muted-foreground">Memuat fasilitas...</p>
                </div>
              </div>
              <div class="form-group">
                <label for="apartment-type">Tipe Apartemen</label>
                <select id="apartment-type" class="form-control">
                  <option value="">Semua Tipe</option>
                  <option value="studio">Studio</option>
                  <option value="1br">1 Kamar Tidur</option>
                  <option value="2br">2 Kamar Tidur</option>
                  <option value="3br+">3+ Kamar Tidur</option>
                  <option value="penthouse">Penthouse</option>
                  <option value="loft">Loft</option>
                  <option value="cabin">Kabin/Vila</option>
                </select>
              </div>
              <button type="submit" class="btn btn-primary w-full mt-md">
                <span class="material-icons" aria-hidden="true">filter_alt</span>Terapkan Filter
              </button>
              <button type="reset" id="resetFiltersBtn" class="btn btn-outline w-full mt-sm">
                Reset Semua Filter
              </button>
            </form>
          </aside>
          <section class="lg:col-span-8 xl:col-span-9" aria-labelledby="search-results-title">
            <div class="flex flex-col sm:flex-row justify-between items-center mb-md gap-md">
              <h2 id="search-results-title" class="text-xl font-semibold">Hasil Pencarian (<span
                  id="searchResultsCount">0</span> properti ditemukan)</h2>
              <div class="form-group mb-0 flex items-center gap-sm">
                <label for="sortBy" class="text-sm text-muted-foreground sr-only sm:not-sr-only">Urutkan:</label>
                <select id="sortBy" class="form-control" style="width: auto; display:inline-block;">
                  <option value="relevance">Relevansi Terbaik</option>
                  <option value="price_asc">Harga: Terendah ke Tertinggi</option>
                  <option value="price_desc">Harga: Tertinggi ke Terendah</option>
                  <option value="rating_desc">Rating: Tertinggi ke Terendah</option>
                </select>
              </div>
            </div>
            <div class="grid grid-cols-fill-sm gap-lg" id="searchResultsGrid">
              <p class="col-span-full text-center text-muted-foreground py-xl text-lg">Silakan gunakan filter untuk
                memulai pencarian Anda atau sesuaikan kriteria.</p>
            </div>
            <div id="paginationControls" class="mt-lg flex justify-center items-center gap-sm">
              <!-- Tombol paginasi akan dimasukkan di sini -->
            </div>
          </section>
        </div>
      </div>
    </section>

    <!-- Halaman Detail Apartemen -->
    <section id="apartment" class="page section hidden" aria-live="polite">
      <div class="container" id="apartmentDetailContent">
        <p class="text-center text-xl text-muted-foreground py-xl">Memuat detail apartemen, mohon tunggu...</p>
      </div>
    </section>

    <!-- Halaman Profil Pengguna -->
    <section id="profile" class="page section container hidden" aria-labelledby="profile-page-title">
      <header class="mb-lg">
        <h1 id="profile-page-title" class="font-extrabold">Profil Pengguna</h1>
      </header>
      <div class="grid md:grid-cols-3 gap-lg">
        <div class="md:col-span-1 card">
          <div class="card-body text-center p-lg">
            <img src="https://source.unsplash.com/random/150x150/?portrait,person" alt="Foto profil Jane Doe"
              id="profileUserImage" class="rounded-full shadow-md mb-md mx-auto"
              style="width:120px; height:120px; object-fit:cover; border: 4px solid var(--primary);">
            <h2 class="text-xl font-semibold mb-xs" id="profileUserName">Jane Doe</h2>
            <p class="text-muted-foreground mb-sm text-sm" id="profileUserEmail">jane.doe@example.com</p>
            <p class="loyalty-badge mb-md"><span class="material-icons" aria-hidden="true">star</span>Poin Loyalitas:
              <span id="profileUserLoyalty">1500</span>
            </p>
            <button class="btn btn-primary w-full mb-sm"><span class="material-icons" aria-hidden="true">edit</span>Edit
              Profil</button>
            <button class="btn btn-outline w-full"><span class="material-icons" aria-hidden="true">logout</span>Keluar
              Akun</button>
          </div>
        </div>
        <div class="md:col-span-2">
          <section aria-labelledby="booking-history-title" class="mb-xl">
            <h3 id="booking-history-title" class="text-xl font-semibold mb-md">Riwayat Pemesanan Anda</h3>
            <div id="bookingHistoryList" class="flex flex-col gap-md">
              <div class="card">
                <div class="card-body">
                  <p class="text-muted-foreground">Tidak ada riwayat pemesanan ditemukan.</p>
                </div>
              </div>
            </div>
          </section>

          <section aria-labelledby="user-messages-title">
            <h3 id="user-messages-title" class="text-xl font-semibold mb-md">Pesan dengan Pemilik/Admin</h3>
            <div class="chat-window mb-sm" id="profileChatWindow" aria-live="polite" role="log">
              <div class="chat-message system">Mulai percakapan dengan pemilik properti atau tim dukungan kami.</div>
            </div>
            <form id="profileChatForm" class="chat-input-group" aria-label="Formulir kirim pesan">
              <input type="text" id="profileChatInput" class="form-control" placeholder="Ketik pesan Anda di sini..."
                aria-label="Input pesan chat">
              <button type="submit" class="btn btn-primary"><span class="material-icons"
                  aria-hidden="true">send</span>Kirim</button>
            </form>
          </section>
        </div>
      </div>
    </section>

    <!-- Halaman Dukungan Pelanggan -->
    <section id="support" class="page section container hidden" aria-labelledby="support-page-title">
      <header class="text-center mb-xl">
        <h1 id="support-page-title" class="font-extrabold">Pusat Dukungan Pelanggan Green Valley</h1>
        <p class="text-lg text-muted-foreground mt-sm max-w-xl mx-auto">Kami di sini untuk membantu Anda dengan
          pertanyaan atau masalah apa pun yang mungkin Anda hadapi.</p>
      </header>
      <div class="grid md:grid-cols-3 gap-lg">
        <div class="card text-center hover:shadow-lg transition-shadow">
          <div class="card-body p-lg">
            <span class="material-icons text-primary mb-sm" style="font-size: 52px;"
              aria-hidden="true">chat_bubble</span>
            <h3 class="mt-sm text-xl font-semibold">Live Chat Cepat</h3>
            <p class="text-muted-foreground mb-md text-sm">Dapatkan bantuan instan dan solusi cepat dari tim dukungan
              kami.</p>
            <button class="btn btn-primary" id="startLiveChatBtn"><span class="material-icons"
                aria-hidden="true">forum</span>Mulai Obrolan</button>
          </div>
        </div>
        <div class="card text-center hover:shadow-lg transition-shadow">
          <div class="card-body p-lg">
            <span class="material-icons text-primary mb-sm" style="font-size: 52px;" aria-hidden="true">email</span>
            <h3 class="mt-sm text-xl font-semibold">Kirim Email</h3>
            <p class="text-muted-foreground mb-md text-sm">Kirimkan pertanyaan detail Anda ke alamat email resmi kami.
            </p>
            <a href="mailto:support@Green Valley.app" class="btn btn-outline"><span class="material-icons"
                aria-hidden="true">send</span>support@Green Valley.app</a>
          </div>
        </div>
        <div class="card text-center hover:shadow-lg transition-shadow">
          <div class="card-body p-lg">
            <span class="material-icons text-primary mb-sm" style="font-size: 52px;" aria-hidden="true">call</span>
            <h3 class="mt-sm text-xl font-semibold">Hubungi Langsung</h3>
            <p class="text-muted-foreground mb-md text-sm">Bicaralah langsung dengan agen dukungan pelanggan kami.</p>
            <a href="tel:+628001234567" class="btn btn-outline"><span class="material-icons"
                aria-hidden="true">phone_in_talk</span>+62-800-123-4567</a>
          </div>
        </div>
      </div>

      <section aria-labelledby="faq-title" class="mt-xl">
        <h2 id="faq-title" class="text-2xl font-bold text-center mb-lg">Pertanyaan yang Sering Diajukan (FAQ)</h2>
        <div id="faqAccordion" class="flex flex-col gap-sm max-w-3xl mx-auto">
          <p class="text-center text-muted-foreground">Memuat FAQ...</p>
        </div>
      </section>
    </section>

    <!-- Halaman Panel Admin -->
    <section id="admin" class="page section container hidden" aria-labelledby="admin-page-title">
      <header class="mb-lg">
        <h1 id="admin-page-title" class="font-extrabold">Dasbor Administrasi</h1>
      </header>
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-lg mb-lg">
        <div class="card">
          <div class="card-body text-center p-lg">
            <h4 class="text-muted-foreground font-medium mb-xs">Total Apartemen Terdaftar</h4>
            <p class="text-4xl font-bold text-primary mb-xs" id="adminTotalApartments">0</p>
            <span class="badge badge-primary" id="adminApartmentsAvailable">Memuat...</span>
          </div>
        </div>
        <div class="card">
          <div class="card-body text-center p-lg">
            <h4 class="text-muted-foreground font-medium mb-xs">Total Penyewa Aktif</h4>
            <p class="text-4xl font-bold text-success mb-xs" id="adminTotalTenants">0</p>
            <span class="badge badge-success">Data Simulasi</span>
          </div>
        </div>
        <div class="card">
          <div class="card-body text-center p-lg">
            <h4 class="text-muted-foreground font-medium mb-xs">Pesanan Bulan Ini</h4>
            <p class="text-4xl font-bold text-accent mb-xs" id="adminActiveBookings">0</p>
            <span class="badge badge-warning">Data Simulasi</span>
          </div>
        </div>
      </div>

      <div class="card mb-lg">
        <div class="card-header flex flex-col sm:flex-row justify-between items-center gap-md">
          <h3 class="mb-0 text-xl font-semibold">Manajemen Data Apartemen</h3>
          <button class="btn btn-sm btn-primary"><span class="material-icons" aria-hidden="true">add_circle</span>Tambah
            Apartemen Baru</button>
        </div>
        <div class="card-body p-0 md:p-md"> <!-- Hapus padding di mobile agar tabel responsive pas -->
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nama Apartemen</th>
                  <th>Lokasi</th>
                  <th>Status Ketersediaan</th>
                  <th>Harga/Malam</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody id="adminApartmentTableBody">
                <tr>
                  <td colspan="6" class="text-center py-lg text-muted-foreground">Memuat data apartemen...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="p-md rounded-md mb-lg text-sm" role="alert"
        style="background-color: hsl(var(--info-h), var(--info-s), 95%); border-left: 4px solid var(--info); color: hsl(var(--info-h), var(--info-s), 30%);">
        <p class="flex items-center gap-sm">
          <span class="material-icons" aria-hidden="true">info</span>
          <strong>Catatan Admin:</strong> Data pada dasbor ini adalah contoh dan disimulasikan. Pada implementasi
          backend penuh, statistik akan menampilkan data real-time mengenai apartemen, penyewa, dan transaksi pesanan.
        </p>
      </div>
    </section>
  </main>

  <!-- Tombol Chat Melayang -->
  <button id="floatingChatButton" class="btn btn-primary floating-chat-btn" aria-label="Buka chat dukungan"
    title="Chat Dukungan">
    <span class="material-icons" aria-hidden="true">chat_bubble</span>
  </button>

  <!-- Widget Kotak Obrolan (Chatbox) -->
  <aside id="chatboxWidget" class="chatbox-widget hidden" aria-labelledby="chatbox-title" role="dialog"
    aria-modal="true">
    <div class="chatbox-header">
      <h3 id="chatbox-title" class="text-lg mb-0">Dukungan Pelanggan Green Valley</h3>
      <button id="closeChatboxButton" class="btn-icon close-chat-btn" aria-label="Tutup chat">
        <span class="material-icons" aria-hidden="true">close</span>
      </button>
    </div>
    <div class="chatbox-body" id="chatboxMessages" aria-live="polite" role="log">
      <!-- Pesan awal akan dimuat oleh JavaScript -->
    </div>
    <form id="chatboxForm" class="chatbox-input-area chat-input-group" aria-label="Formulir kirim pesan dukungan">
      <input type="text" id="chatboxInput" class="form-control" placeholder="Ketik pesan Anda..."
        aria-label="Input pesan chat dukungan">
      <button type="submit" class="btn btn-primary"><span class="material-icons" aria-hidden="true">send</span></button>
    </form>
  </aside>

  <!-- Modal untuk Lapor Ulasan -->
  <div id="reportReviewModal" class="modal" aria-labelledby="reportReviewModalTitle" aria-modal="true" role="dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="reportReviewModalTitle" class="font-semibold">Laporkan Ulasan Ini</h3>
        <button id="closeReportModalBtn" class="btn-icon text-muted-foreground hover:text-danger"
          aria-label="Tutup modal pelaporan">
          <span class="material-icons">close</span>
        </button>
      </div>
      <form id="reportReviewForm" aria-label="Formulir pelaporan ulasan">
        <input type="hidden" id="reportReviewIdInput" name="reviewId">
        <div class="modal-body">
          <div class="form-group">
            <label for="report-reason">Alasan Pelaporan Anda</label>
            <textarea id="report-reason" name="reason" class="form-control" rows="4"
              placeholder="Jelaskan mengapa ulasan ini tidak pantas atau melanggar aturan komunitas kami." required
              aria-label="Alasan pelaporan ulasan"></textarea>
          </div>
          <div class="form-group">
            <label for="report-category">Kategori Pelaporan</label>
            <select id="report-category" name="category" class="form-control" required
              aria-label="Pilih kategori pelaporan">
              <option value="">Pilih kategori...</option>
              <option value="spam">Spam atau Promosi Tidak Relevan</option>
              <option value="hateful_discriminatory">Ujaran Kebencian atau Diskriminasi</option>
              <option value="irrelevant_offtopic">Tidak Relevan atau Di Luar Topik</option>
              <option value="false_information">Informasi Palsu atau Menyesatkan</option>
              <option value="privacy_violation">Pelanggaran Privasi</option>
              <option value="other">Lainnya (jelaskan di alasan)</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" id="cancelReportBtn" class="btn btn-outline">Batalkan</button>
          <button type="submit" class="btn btn-danger">Kirim Laporan</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Bagian Kaki Aplikasi (Footer) -->
  <footer class="app-footer">
    <div class="container">
      <p>&copy; <span id="currentYear">2024</span> Green Valley. Semua hak cipta dilindungi undang-undang.</p>
      <p>Dirancang dengan <span class="material-icons" aria-label="cinta">favorite</span> untuk pengalaman sewa
        apartemen terbaik Anda.</p>
    </div>
  </footer>

  <script>
    // === STATE & KONFIGURASI GLOBAL ===
    // AppState berfungsi sebagai pusat data dan status UI aplikasi.
    const AppState = {
      currentPage: 'home', // Halaman yang sedang aktif
      apartments: [],      // Menyimpan semua data apartemen (dari data tiruan)
      filteredApartments: [], // Menyimpan apartemen setelah proses filter
      selectedApartmentId: null, // ID apartemen yang detailnya sedang ditampilkan
      searchFilters: {       // Menyimpan kondisi filter pencarian saat ini
        location: '', checkin: '', checkout: '', guests: 1,
        priceMax: 5000, // Harga maksimal dalam ribuan (misal, 5000 berarti Rp 5.000.000)
        amenities: [], type: '',
      },
      bookingHistory: [],    // Menyimpan riwayat pemesanan pengguna (simulasi)
      userProfile: {         // Data profil pengguna (simulasi)
        name: 'Pengguna Green Valley', email: 'user@Green Valley.app',
        loyaltyPoints: 2850,
        profilePic: 'https://source.unsplash.com/random/150x150/?person,avatar' // Gambar acak untuk avatar
      },
      chatMessages: {        // Menyimpan pesan obrolan
        profile: [], // Obrolan di halaman profil (belum diimplementasikan penuh)
        support: [{ type: 'system', text: 'Selamat datang di Dukungan Pelanggan Green Valley! Ada yang bisa kami bantu?', timestamp: Date.now() }]
      },
      pagination: {
        itemsPerPage: 6,    // Jumlah apartemen yang ditampilkan per halaman hasil pencarian
        currentPageNumber: 1, // Halaman saat ini untuk paginasi
      },
      // Data tiruan untuk review yang dilaporkan (agar persisten antar render)
      reportedReviewIds: new Set(), // Gunakan Set untuk efisiensi dan menghindari duplikat
    };

    // === DATA TIRUAN (MOCK DATA) ===
    // Harga dalam 'K' (ribuan). Misal 750 berarti Rp 750.000.
    // Saya akan menggunakan data yang sudah ada di MOCK_APARTMENTS, MOCK_TESTIMONIALS, MOCK_FAQS, dan ALL_AMENITIES
    // dari kode asli Anda karena sudah cukup komprehensif.
    // (Data MOCK_APARTMENTS, ALL_AMENITIES, MOCK_TESTIMONIALS, MOCK_FAQS disalin dari kode asli pengguna)
    const MOCK_APARTMENTS = [ /* ... Data dari kode asli ... */
      {
        id: 1, title: 'Penthouse Mewah Pusat Kota', location: 'Jakarta Pusat, DKI Jakarta', pricePerNight: 750, type: 'penthouse', bedrooms: 3, bathrooms: 2, sqft: 200,
        amenities: ['wifi', 'private_pool', 'gym', 'parking', 'ac', 'kitchen', 'tv', 'city_skyline', 'private_rooftop', 'elevator'],
        images: ['https://source.unsplash.com/random/800x600/?luxury,apartment,interior,highrise', 'https://source.unsplash.com/random/800x600/?apartment,bedroom,modern', 'https://source.unsplash.com/random/800x600/?apartment,livingroom,elegant', 'https://source.unsplash.com/random/800x600/?apartment,kitchen,sleek', 'https://source.unsplash.com/random/800x600/?apartment,rooftop,view'],
        description: 'Nikmati kemewahan tak tertandingi di penthouse kami yang terletak strategis di jantung kota. Dengan pemandangan cakrawala yang memukau, interior yang dirancang elegan, dan fasilitas lengkap termasuk kolam renang pribadi mini dan akses gym eksklusif. Sempurna untuk keluarga atau grup yang mencari pengalaman menginap premium.',
        rating: 4.9, reviews: [{ id: 'r1a1', user: 'Budi Santoso', comment: 'Pemandangan kota yang luar biasa dan fasilitas terbaik! Sangat direkomendasikan.', rating: 5, date: '2024-05-10' }, { id: 'r2a1', user: 'Citra Lestari', comment: 'Apartemennya bersih, luas, dan sangat nyaman. Pelayanannya juga ramah.', rating: 4.8, date: '2024-05-01' }],
        host: { name: 'PT Properti Jaya', verified: true }, availability: { '2024-12-20': 'booked', '2024-12-21': 'booked' }
      },
      {
        id: 2, title: 'Studio Modern Dekat Kampus Ternama', location: 'Bandung, Jawa Barat', pricePerNight: 250, type: 'studio', bedrooms: 1, bathrooms: 1, sqft: 45,
        amenities: ['wifi', 'ac', 'kitchenette', 'laundry_shared', 'study_desk', 'transit_access'],
        images: ['https://source.unsplash.com/random/800x600/?modern,studio,apartment,compact', 'https://source.unsplash.com/random/800x600/?studio,interior,bright', 'https://source.unsplash.com/random/800x600/?compact,living,student'],
        description: 'Studio modern dan fungsional, ideal untuk mahasiswa atau profesional muda. Dilengkapi dengan kitchenette, area belajar, dan akses mudah ke transportasi umum serta fasilitas kampus. Lingkungan yang tenang dan aman.',
        rating: 4.5, reviews: [{ id: 'r1a2', user: 'Rina Amelia', comment: 'Lokasi strategis, sangat bersih, dan harganya terjangkau untuk mahasiswa.', rating: 4.5, date: '2024-04-20' }, { id: 'r2a2', user: 'Agus Setiawan', comment: 'Cocok untuk tinggal sendiri, fasilitas cukup lengkap.', rating: 4, date: '2024-04-15' }],
        host: { name: 'Ibu Wati Kosasih', verified: true }, availability: {}
      },
      {
        id: 3, title: 'Apartemen Keluarga Nyaman dan Luas', location: 'Surabaya, Jawa Timur', pricePerNight: 450, type: '2br', bedrooms: 2, bathrooms: 1, sqft: 90,
        amenities: ['wifi', 'ac', 'kitchen', 'tv', 'parking', 'playground', 'family_friendly', 'pool_shared'],
        images: ['https://source.unsplash.com/random/800x600/?family,apartment,cozy,suburban', 'https://source.unsplash.com/random/800x600/?kids,bedroom,colorful', 'https://source.unsplash.com/random/800x600/?apartment,dining,spacious'],
        description: 'Apartemen dua kamar yang luas dan nyaman, sempurna untuk liburan keluarga. Dilengkapi dapur lengkap, area bermain anak di kompleks, dan keamanan 24 jam. Dekat dengan pusat perbelanjaan dan tempat wisata.',
        rating: 4.7, reviews: [{ id: 'r1a3', user: 'Keluarga Wijaya', comment: 'Tempatnya bersih, anak-anak suka ada playground. Recommended!', rating: 5, date: '2024-03-10' }],
        host: { name: 'Manajemen Graha Indah', verified: false }, availability: {}
      },
      {
        id: 4, title: 'Apartemen Minimalis di Segitiga Emas', location: 'Jakarta Selatan, DKI Jakarta', pricePerNight: 600, type: '1br', bedrooms: 1, bathrooms: 1, sqft: 60,
        amenities: ['wifi', 'pool_shared', 'gym', 'ac', 'kitchen', 'smart_tv', 'city_view', 'elevator'],
        images: ['https://source.unsplash.com/random/800x600/?minimalist,apartment,urban', 'https://source.unsplash.com/random/800x600/?urban,living,stylish', 'https://source.unsplash.com/random/800x600/?stylish,interior,jakarta'],
        description: 'Apartemen satu kamar tidur dengan desain minimalis modern di kawasan bisnis Jakarta. Akses mudah ke perkantoran, mal, dan hiburan. Fasilitas gedung termasuk kolam renang infinity dan pusat kebugaran.',
        rating: 4.8, reviews: [{ id: 'r1a4', user: 'David Lee', comment: 'Desainnya keren, lokasi sangat strategis untuk bisnis.', rating: 5, date: '2024-06-01' }],
        host: { name: 'UrbanLiving Spaces', verified: true }, availability: { '2024-12-25': 'booked' }
      },
      {
        id: 5, title: 'Loft Artistik dengan Pemandangan Sungai', location: 'Yogyakarta, DIY', pricePerNight: 350, type: 'loft', bedrooms: 1, bathrooms: 1, sqft: 70,
        amenities: ['wifi', 'ac', 'kitchenette', 'balcony', 'art_supplies', 'river_view', 'pet_friendly'],
        images: ['https://source.unsplash.com/random/800x600/?artistic,loft,apartment,yogya', 'https://source.unsplash.com/random/800x600/?loft,interior,riverview,creative', 'https://source.unsplash.com/random/800x600/?creative,workspace,bright'],
        description: 'Sebuah loft unik dengan sentuhan artistik, menawarkan pemandangan sungai yang menenangkan. Ruang terbuka dengan langit-langit tinggi, dilengkapi perlengkapan seni dasar untuk inspirasi Anda. Balkon pribadi untuk menikmati senja.',
        rating: 4.9, reviews: [{ id: 'r1a5', user: 'Sarah Knstler', comment: 'Tempat yang sangat inspiratif! Suka sekali dengan detail seninya.', rating: 5, date: '2024-05-15' }],
        host: { name: 'Galeri Sungai Art Space', verified: true }, availability: {}
      },
      {
        id: 6, title: 'Kabin Modern Tepi Danau Toba', location: 'Danau Toba, Sumatera Utara', pricePerNight: 900, type: 'cabin', bedrooms: 2, bathrooms: 2, sqft: 120,
        amenities: ['wifi', 'fireplace', 'kitchen', 'patio', 'lake_access', 'bbq_grill', 'mountain_view', 'parking'],
        images: ['https://source.unsplash.com/random/800x600/?modern,cabin,lake,toba', 'https://source.unsplash.com/random/800x600/?cabin,interior,lakeview,cozy', 'https://source.unsplash.com/random/800x600/?cozy,fireplace,cabin,nature'],
        description: 'Melarikan diri ke kabin modern kami yang terletak di tepi Danau Toba yang indah. Menawarkan privasi total, pemandangan danau yang tak terhalang, dan akses langsung ke air. Sempurna untuk relaksasi dan petualangan alam.',
        rating: 5.0, reviews: [{ id: 'r1a6', user: 'John Adventure', comment: 'Pengalaman menginap terbaik! Pemandangannya spektakuler.', rating: 5, date: '2024-06-10' }],
        host: { name: 'Toba Lakeside Retreats', verified: true }, availability: { '2025-01-01': 'booked', '2025-01-02': 'booked', '2025-01-03': 'booked' }
      }
    ];
    const ALL_AMENITIES = {
      wifi: { icon: 'wifi', label: 'WiFi Gratis' },
      pool_shared: { icon: 'pool', label: 'Kolam Renang Umum' },
      private_pool: { icon: 'pool', label: 'Kolam Renang Pribadi' }, // Dibedakan dari pool_shared
      gym: { icon: 'fitness_center', label: 'Gym/Pusat Kebugaran' },
      parking: { icon: 'local_parking', label: 'Parkir Gratis' },
      ac: { icon: 'ac_unit', label: 'Pendingin Ruangan (AC)' },
      kitchen: { icon: 'kitchen', label: 'Dapur Lengkap' },
      kitchenette: { icon: 'countertops', label: 'Dapur Kecil (Kitchenette)' },
      tv: { icon: 'tv', label: 'Televisi Standar' },
      smart_tv: { icon: 'smart_display', label: 'Smart TV' },
      laundry_shared: { icon: 'local_laundry_service', label: 'Fasilitas Laundry Bersama' },
      laundry_in_unit: { icon: 'local_laundry_service', label: 'Mesin Cuci Pribadi' },
      study_desk: { icon: 'desk', label: 'Meja Belajar/Kerja' },
      playground: { icon: 'child_friendly', label: 'Area Bermain Anak' },
      family_friendly: { icon: 'family_restroom', label: 'Ramah Keluarga' },
      pet_friendly: { icon: 'pets', label: 'Boleh Bawa Hewan Peliharaan' },
      balcony: { icon: 'balcony', label: 'Balkon atau Teras Pribadi' },
      art_supplies: { icon: 'palette', label: 'Perlengkapan Seni Dasar' },
      fireplace: { icon: 'fireplace', label: 'Perapian Dalam Ruangan' },
      patio: { icon: 'deck', label: 'Patio atau Dek Luar Ruang' },
      lake_access: { icon: 'water', label: 'Akses Langsung ke Danau' },
      ocean_view: { icon: 'waves', label: 'Pemandangan Laut' },
      bbq_grill: { icon: 'outdoor_grill', label: 'Panggangan BBQ' },
      heritage_building: { icon: 'museum', label: 'Bangunan Bersejarah' },
      city_view: { icon: 'location_city', label: 'Pemandangan Kota' },
      city_skyline: { icon: 'nightlife', label: 'Pemandangan Skyline Kota' }, // Berbeda dari city_view biasa
      private_beach: { icon: 'beach_access', label: 'Akses Pantai Pribadi' },
      solar_panel: { icon: 'solar_power', label: 'Panel Surya (Energi Terbarukan)' },
      rainwater_harvesting: { icon: 'water_drop', label: 'Sistem Panen Air Hujan' },
      eco_friendly: { icon: 'eco', label: 'Properti Ramah Lingkungan' },
      organic_garden: { icon: 'spa', label: 'Kebun Organik/Sayur' },
      mountain_view: { icon: 'landscape', label: 'Pemandangan Gunung' },
      private_rooftop: { icon: 'rooftop_garden', label: 'Rooftop Pribadi' },
      smart_lock: { icon: 'lock_smart', label: 'Kunci Pintu Pintar (Smart Lock)' },
      elevator: { icon: 'elevator', label: 'Lift Gedung' },
      transit_access: { icon: 'train', label: 'Dekat Akses Transportasi Umum' },
      wifi_highspeed: { icon: 'network_wifi_3_bar', label: 'WiFi Kecepatan Tinggi' },
      meeting_room_access: { icon: 'meeting_room', label: 'Akses Ruang Meeting (Jika ada)' },
      airport_shuttle_service: { icon: 'airport_shuttle', label: 'Layanan Antar-Jemput Bandara (Opsional)' },
      workstation: { icon: 'workspaces', label: 'Area Kerja Khusus (Workstation)' },
      river_view: { icon: 'waterfall_chart', label: 'Pemandangan Sungai' },
    };
    const MOCK_TESTIMONIALS = [
      { user: 'Andi Pratama Wijaya', comment: "Proses booking sangat mudah dan cepat. Apartemennya persis seperti di foto, bahkan lebih baik! Staf sangat membantu. Pasti akan sewa lagi dari Green Valley untuk perjalanan bisnis berikutnya.", avatar: "https://source.unsplash.com/random/100x100/?man,smile,asian,professional" },
      { user: 'Siti Aminah Putri', comment: "Customer service Green Valley sangat responsif dan membantu menyelesaikan masalah kecil dengan cepat. Saya merasa aman bertransaksi di sini. Pengalaman menginap yang menyenangkan bersama keluarga!", avatar: "https://source.unsplash.com/random/100x100/?woman,professional,hijab,happy" }
    ];
    const MOCK_FAQS = [
      { q: "Bagaimana cara melakukan pemesanan apartemen di Green Valley?", a: "Anda dapat mencari apartemen melalui halaman 'Pencarian', gunakan filter untuk mempersempit pilihan, pilih tanggal check-in dan check-out, lalu klik 'Pesan Sekarang' pada halaman detail apartemen. Ikuti langkah-langkah selanjutnya untuk menyelesaikan pembayaran." },
      { q: "Apakah pembayaran saya di Green Valley aman?", a: "Ya, semua transaksi pembayaran di Green Valley diproses melalui sistem escrow simulasi yang aman dan terenkripsi. Dana Anda akan ditahan hingga Anda berhasil check-in. Untuk aplikasi nyata, kami akan menggunakan payment gateway terpercaya dengan standar keamanan internasional." },
      { q: "Bagaimana kebijakan pembatalan pemesanan?", a: "Kebijakan pembatalan bervariasi tergantung pada masing-masing properti dan waktu pembatalan. Informasi detail kebijakan pembatalan dapat Anda temukan pada halaman detail apartemen sebelum melakukan pemesanan. Umumnya, pembatalan dalam 24 jam setelah pemesanan tidak dikenakan biaya, namun periksa kembali syarat dan ketentuan spesifik." },
      { q: "Bagaimana saya bisa menghubungi pemilik properti atau pengelola?", a: "Setelah pemesanan Anda dikonfirmasi, Anda akan menerima informasi kontak pemilik atau pengelola properti. Selain itu, Anda juga dapat menggunakan fitur pesan di halaman profil Anda (jika fitur ini diimplementasikan dengan backend penuh) atau menghubungi tim dukungan kami untuk bantuan." },
      { q: "Metode pembayaran apa saja yang diterima oleh Green Valley?", a: "Saat ini, Green Valley menerima simulasi pembayaran melalui Kartu Kredit (Visa, MasterCard), Transfer Bank Virtual Account (BCA, Mandiri, BRI), dan beberapa E-Wallet populer (GoPay, OVO). Pilihan metode pembayaran akan terus kami kembangkan untuk kenyamanan Anda." },
      { q: "Apakah ada biaya tambahan selain harga sewa per malam?", a: "Harga yang tertera adalah harga sewa per malam. Mungkin ada biaya layanan platform sebesar 5% dan biaya asuransi perjalanan (opsional) sebesar 10% dari total harga dasar sewa. Semua rincian biaya akan ditampilkan dengan transparan sebelum Anda menyelesaikan pembayaran." }
    ];

    // === PEMILIH ELEMEN DOM (DOM Element Selectors) ===
    // Mengumpulkan semua elemen DOM yang sering diakses agar mudah dikelola dan di-debug.
    const DOMElements = {
      // Navigasi
      navLinks: document.querySelectorAll('.nav-link'),
      mobileMenuButton: document.querySelector('.mobile-menu-button'),
      navLinksContainer: document.getElementById('navLinks'),
      // Kontainer Halaman Utama
      pages: document.querySelectorAll('.page'),
      // Halaman Beranda
      featuredPropertiesGrid: document.getElementById('featuredPropertiesGrid'),
      testimonialsGrid: document.getElementById('testimonialsGrid'),
      quickSearchForm: document.getElementById('quickSearchForm'),
      // Halaman Pencarian
      fullSearchForm: document.getElementById('fullSearchForm'),
      resetFiltersBtn: document.getElementById('resetFiltersBtn'),
      searchResultsGrid: document.getElementById('searchResultsGrid'),
      searchResultsCount: document.getElementById('searchResultsCount'),
      priceRangeSlider: document.getElementById('priceRange'),
      priceRangeMinDisplay: document.getElementById('priceRangeMinDisplay'),
      priceRangeMaxDisplay: document.getElementById('priceRangeMaxDisplay'),
      amenitiesFilterCheckboxes: document.getElementById('amenitiesFilterCheckboxes'),
      sortBySelect: document.getElementById('sortBy'),
      paginationControls: document.getElementById('paginationControls'),
      // Halaman Detail Apartemen
      apartmentDetailContent: document.getElementById('apartmentDetailContent'),
      // Halaman Profil
      profileUserName: document.getElementById('profileUserName'),
      profileUserEmail: document.getElementById('profileUserEmail'),
      profileUserImage: document.getElementById('profileUserImage'),
      profileUserLoyalty: document.getElementById('profileUserLoyalty'),
      profileChatWindow: document.getElementById('profileChatWindow'),
      profileChatInput: document.getElementById('profileChatInput'),
      profileChatForm: document.getElementById('profileChatForm'),
      bookingHistoryList: document.getElementById('bookingHistoryList'),
      // Halaman Dukungan
      startLiveChatBtn: document.getElementById('startLiveChatBtn'),
      faqAccordion: document.getElementById('faqAccordion'),
      // Halaman Admin
      adminTotalApartments: document.getElementById('adminTotalApartments'),
      adminApartmentsAvailable: document.getElementById('adminApartmentsAvailable'),
      adminTotalTenants: document.getElementById('adminTotalTenants'),
      adminActiveBookings: document.getElementById('adminActiveBookings'),
      adminApartmentTableBody: document.getElementById('adminApartmentTableBody'),
      // Widget Chat
      floatingChatButton: document.getElementById('floatingChatButton'),
      chatboxWidget: document.getElementById('chatboxWidget'),
      closeChatboxButton: document.getElementById('closeChatboxButton'),
      chatboxMessages: document.getElementById('chatboxMessages'),
      chatboxInput: document.getElementById('chatboxInput'),
      chatboxForm: document.getElementById('chatboxForm'),
      // Modal Lapor Ulasan
      reportReviewModal: document.getElementById('reportReviewModal'),
      closeReportModalBtn: document.getElementById('closeReportModalBtn'),
      cancelReportBtn: document.getElementById('cancelReportBtn'),
      reportReviewForm: document.getElementById('reportReviewForm'),
      reportReviewIdInput: document.getElementById('reportReviewIdInput'),
      // Lain-lain
      currentYearSpan: document.getElementById('currentYear'),
    };

    // === FUNGSI UTILITAS (Utility Functions) ===
    // Kumpulan fungsi pembantu yang sering digunakan di berbagai bagian aplikasi.
    const Utils = {
      formatCurrency: (amountInK) => `Rp ${amountInK.toLocaleString('id-ID')}K`,
      getISODate: (date) => date.toISOString().split('T')[0],
      debounce: (func, delay) => {
        let timeout;
        return function (...args) {
          const context = this;
          clearTimeout(timeout);
          timeout = setTimeout(() => func.apply(context, args), delay);
        };
      },
      sanitizeHTML: (str) => {
        if (typeof str !== 'string') return '';
        const temp = document.createElement('div');
        temp.textContent = str; // Menggunakan textContent untuk sanitasi dasar
        return temp.innerHTML;
      },
      generateId: (prefix = 'id') => `${prefix}-${Date.now().toString(36)}-${Math.random().toString(36).substring(2, 7)}`,
      scrollToTop: () => window.scrollTo({ top: 0, behavior: 'smooth' }),
      // Fungsi untuk membuat elemen dengan atribut dan teks (opsional)
      createElement: (tag, attributes = {}, textContent = '') => {
        const element = document.createElement(tag);
        for (const key in attributes) {
          element.setAttribute(key, attributes[key]);
        }
        if (textContent) {
          element.textContent = textContent;
        }
        return element;
      },
    };

    // === NAVIGASI & ROUTING SPA (Single Page Application) ===
    /**
     * Fungsi utama untuk navigasi antar halaman dalam SPA.
     * Mengubah tampilan berdasarkan pageId dan memperbarui URL hash.
     * @param {string} pageId - ID dari elemen <section> halaman yang dituju.
     */
    function navigateToPage(pageId) {
      pageId = pageId || 'home'; // Halaman default jika pageId tidak valid

      DOMElements.pages.forEach(page => {
        page.classList.add('hidden');
        page.classList.remove('fade-in');
      });

      const targetPage = document.getElementById(pageId);
      if (targetPage) {
        targetPage.classList.remove('hidden');
        void targetPage.offsetWidth; // Memicu reflow agar animasi berjalan konsisten
        targetPage.classList.add('fade-in');
      } else { // Fallback jika halaman target tidak ditemukan
        const homePage = document.getElementById('home');
        homePage.classList.remove('hidden');
        void homePage.offsetWidth;
        homePage.classList.add('fade-in');
        pageId = 'home';
      }

      DOMElements.navLinks.forEach(link => {
        link.classList.toggle('is-active', link.dataset.page === pageId);
      });

      if (DOMElements.navLinksContainer.classList.contains('is-open')) {
        toggleMobileMenu(); // Tutup menu mobile jika terbuka
      }

      AppState.currentPage = pageId;
      window.location.hash = pageId; // Update hash URL untuk bookmark dan navigasi browser
      document.title = getPageTitle(pageId); // Update judul tab browser
      Utils.scrollToTop();
      loadPageContent(pageId); // Muat konten spesifik untuk halaman yang baru ditampilkan
    }

    /**
     * Mendapatkan judul halaman berdasarkan ID halaman untuk tag <title>.
     * @param {string} pageId - ID halaman.
     * @returns {string} Judul halaman.
     */
    function getPageTitle(pageId) {
      const titles = {
        home: "Beranda",
        search: "Pencarian Apartemen",
        apartment: "Detail Apartemen", // Akan di-override dengan nama apartemen
        profile: "Profil Saya",
        support: "Pusat Dukungan",
        admin: "Panel Admin"
      };
      return `${titles[pageId] || 'Halaman'} | Green Valley`;
    }


    /**
     * Menangani klik pada link navigasi utama.
     * @param {Event} event - Objek event klik.
     */
    function handleNavClick(event) {
      event.preventDefault();
      const targetPage = event.currentTarget.dataset.page || event.currentTarget.hash.substring(1);
      if (targetPage) navigateToPage(targetPage);
    }

    /**
     * Menangani perubahan hash pada URL (misalnya, saat pengguna menggunakan tombol back/forward browser).
     */
    function handleHashChange() {
      const pageId = window.location.hash.substring(1) || 'home';
      navigateToPage(pageId);
    }

    /**
     * Mengaktifkan atau menonaktifkan menu navigasi mobile.
     */
    function toggleMobileMenu() {
      const isOpen = DOMElements.navLinksContainer.classList.toggle('is-open');
      DOMElements.mobileMenuButton.setAttribute('aria-expanded', isOpen.toString());
      DOMElements.mobileMenuButton.innerHTML = `<span class="material-icons">${isOpen ? 'close' : 'menu'}</span>`;
      document.body.style.overflow = isOpen ? 'hidden' : ''; // Mencegah scroll body saat menu mobile terbuka
    }

    // === PEMUATAN KONTEN DINAMIS PER HALAMAN ===
    /**
     * Memuat konten spesifik atau menjalankan fungsi yang relevan berdasarkan halaman yang aktif.
     * @param {string} pageId - ID halaman yang sedang aktif.
     */
    function loadPageContent(pageId) {
      const todayISO = Utils.getISODate(new Date()); // Tanggal hari ini untuk min date input

      switch (pageId) {
        case 'home':
          renderFeaturedProperties();
          renderTestimonials();
          // Set tanggal minimum untuk form pencarian cepat di beranda
          const quickCheckin = document.getElementById('quick-checkin');
          const quickCheckout = document.getElementById('quick-checkout');
          if (quickCheckin) quickCheckin.min = todayISO;
          if (quickCheckout) quickCheckout.min = todayISO;
          break;
        case 'search':
          // Mengisi kembali form filter dari AppState jika pengguna kembali ke halaman pencarian
          document.getElementById('search-location').value = AppState.searchFilters.location;
          const searchCheckin = document.getElementById('search-checkin');
          const searchCheckout = document.getElementById('search-checkout');
          if (searchCheckin) {
            searchCheckin.value = AppState.searchFilters.checkin;
            searchCheckin.min = todayISO;
          }
          if (searchCheckout) {
            searchCheckout.value = AppState.searchFilters.checkout;
            searchCheckout.min = todayISO;
          }
          document.getElementById('search-guests').value = AppState.searchFilters.guests;
          DOMElements.priceRangeSlider.value = AppState.searchFilters.priceMax;
          updatePriceRangeDisplay();

          DOMElements.amenitiesFilterCheckboxes.querySelectorAll('input[type="checkbox"]').forEach(input => {
            input.checked = AppState.searchFilters.amenities.includes(input.value);
          });
          document.getElementById('apartment-type').value = AppState.searchFilters.type;

          applyFiltersAndRenderResults(); // Render hasil pencarian awal atau berdasarkan filter tersimpan
          break;
        case 'apartment':
          if (AppState.selectedApartmentId) {
            renderApartmentDetail(AppState.selectedApartmentId);
          } else { // Jika tidak ada apartemen yang dipilih, tampilkan pesan error
            DOMElements.apartmentDetailContent.innerHTML = `
              <div class="text-center py-xl">
                <span class="material-icons text-danger mb-md" style="font-size: 64px;">error_outline</span>
                <h2 class="text-2xl font-semibold mb-sm">Apartemen Tidak Ditemukan</h2>
                <p class="text-muted-foreground mb-lg">Maaf, kami tidak dapat menemukan detail untuk apartemen yang Anda minta atau belum ada apartemen yang dipilih.</p>
                <a href="#search" data-page="search" class="btn btn-primary nav-link-inline">
                  <span class="material-icons" aria-hidden="true">arrow_back</span> Kembali ke Pencarian
                </a>
              </div>`;
            // Event listener untuk link inline (jika ada)
            DOMElements.apartmentDetailContent.querySelector('.nav-link-inline')?.addEventListener('click', handleNavClick);
          }
          break;
        case 'profile':
          renderProfileInfo();
          renderBookingHistory();
          renderChatMessages('profile', DOMElements.profileChatWindow);
          break;
        case 'support':
          renderFaqs();
          break;
        case 'admin':
          renderAdminDashboard();
          break;
        default:
          console.warn(`Tidak ada pemuat konten spesifik untuk halaman: ${pageId}`);
      }
    }

    // === FUNGSI UNTUK MERENDER TAMPILAN (RENDERING FUNCTIONS) ===

    /**
     * Membuat elemen HTML untuk satu kartu properti.
     * @param {object} apartment - Objek data apartemen.
     * @param {boolean} isFeatured - Menandakan apakah kartu ini untuk properti unggulan (tampilan sedikit berbeda).
     * @returns {HTMLElement} Elemen <article> yang merepresentasikan kartu properti.
     */
    function createPropertyCard(apartment, isFeatured = false) {
      const card = Utils.createElement('article', { class: 'property-card card fade-in h-full shadow-lg hover:shadow-xl' });
      // Detail host, tambahkan ikon verifikasi jika ada
      const hostVerifiedIcon = apartment.host.verified ? `<span class="material-icons verified-icon text-sm" title="Pemilik Terverifikasi" aria-label="Pemilik Terverifikasi">verified</span>` : '';

      card.innerHTML = `
        <figure class="flex flex-col h-full">
          <div class="relative overflow-hidden">
            <img src="${apartment.images[0]}" alt="Tampilan depan ${Utils.sanitizeHTML(apartment.title)}" loading="lazy" class="w-full h-[220px] object-cover transition-transform duration-300 ease-out group-hover:scale-110">
            ${isFeatured && apartment.rating >= 4.8 ? `<span class="absolute top-sm right-sm bg-accent text-accent-foreground text-xs font-semibold px-sm py-xs rounded-md shadow-md">Pilihan Terbaik</span>` : ''}
          </div>
          <figcaption class="flex flex-col flex-grow p-md">
            <h3 class="font-semibold text-lg mb-xs leading-tight text-foreground">${Utils.sanitizeHTML(apartment.title)} ${hostVerifiedIcon}</h3>
            <div class="property-details text-sm mb-sm">
              <span class="location"><span class="material-icons text-xs mr-xs" aria-hidden="true">location_on</span> ${Utils.sanitizeHTML(apartment.location)}</span>
              <span class="price text-md font-bold">${Utils.formatCurrency(apartment.pricePerNight)}<span class="text-xs font-normal text-muted-foreground">/malam</span></span>
            </div>
            <div class="property-features text-xs mb-md text-muted-foreground">
              <span><span class="material-icons text-sm mr-xs" aria-hidden="true">king_bed</span> ${apartment.bedrooms} KT</span>
              <span><span class="material-icons text-sm mr-xs" aria-hidden="true">bathtub</span> ${apartment.bathrooms} KM</span>
              <span><span class="material-icons text-sm mr-xs" aria-hidden="true">square_foot</span> ${apartment.sqft} m</span>
            </div>
            ${isFeatured && apartment.reviews.length > 0 ? `
            <blockquote class="text-xs mt-auto pt-sm border-t border-border">
              <p class="mb-xs italic">"${Utils.sanitizeHTML(apartment.reviews[0].comment.substring(0, 70))}..."</p>
              <footer class="text-right font-medium">- ${Utils.sanitizeHTML(apartment.reviews[0].user)}</footer>
            </blockquote>
            ` : '<div class="mt-auto"></div>' /* Spacer jika tidak ada review featured */}
            <button class="btn btn-primary btn-sm w-full mt-md view-detail-btn" data-id="${apartment.id}">
                <span class="material-icons" aria-hidden="true">visibility</span>Lihat Detail
            </button>
          </figcaption>
        </figure>
      `;
      card.querySelector('.view-detail-btn').addEventListener('click', (e) => {
        AppState.selectedApartmentId = parseInt(e.currentTarget.dataset.id);
        navigateToPage('apartment');
      });
      return card;
    }

    /**
     * Merender properti unggulan di halaman beranda.
     * Mengambil beberapa apartemen dengan rating tertinggi.
     */
    function renderFeaturedProperties() {
      DOMElements.featuredPropertiesGrid.innerHTML = '';
      const featured = [...AppState.apartments].sort((a, b) => b.rating - a.rating).slice(0, 3); // Ambil 3 teratas
      if (featured.length > 0) {
        featured.forEach(apt => DOMElements.featuredPropertiesGrid.appendChild(createPropertyCard(apt, true)));
      } else {
        DOMElements.featuredPropertiesGrid.innerHTML = '<p class="col-span-full text-center text-muted-foreground">Saat ini tidak ada properti unggulan yang tersedia.</p>';
      }
    }

    /**
     * Merender testimoni pelanggan di halaman beranda.
     */
    function renderTestimonials() {
      DOMElements.testimonialsGrid.innerHTML = '';
      MOCK_TESTIMONIALS.forEach(testimonial => {
        const testimonialEl = Utils.createElement('div', { class: 'card shadow-lg' });
        testimonialEl.innerHTML = `
          <div class="card-body flex flex-col items-center text-center p-lg">
            <img src="${testimonial.avatar}" alt="Foto ${Utils.sanitizeHTML(testimonial.user)}" 
                 class="rounded-full shadow-md mb-md" 
                 style="width:80px; height:80px; object-fit:cover; border: 3px solid var(--accent);">
            <blockquote class="w-full">
              <p class="text-muted-foreground text-md mb-md leading-relaxed">"${Utils.sanitizeHTML(testimonial.comment)}"</p>
              <footer class="font-semibold text-primary">- ${Utils.sanitizeHTML(testimonial.user)}</footer>
            </blockquote>
          </div>
        `;
        DOMElements.testimonialsGrid.appendChild(testimonialEl);
      });
    }

    /**
     * Merender hasil pencarian apartemen, termasuk paginasi.
     * @param {Array} apartmentsToRender - Array objek apartemen yang akan dirender.
     */
    function renderSearchResults(apartmentsToRender) {
      DOMElements.searchResultsGrid.innerHTML = '';
      DOMElements.searchResultsCount.textContent = apartmentsToRender.length;

      if (apartmentsToRender.length === 0) {
        DOMElements.searchResultsGrid.innerHTML = `
          <div class="col-span-full text-center py-xl">
            <span class="material-icons text-muted-foreground mb-md" style="font-size: 64px;">search_off</span>
            <h3 class="text-xl font-semibold mb-sm">Pencarian Tidak Ditemukan</h3>
            <p class="text-muted-foreground">Tidak ada apartemen yang cocok dengan kriteria pencarian Anda. Coba ubah atau perluas filter Anda.</p>
          </div>`;
        DOMElements.paginationControls.innerHTML = '';
        return;
      }

      const paginatedResults = paginateResults(apartmentsToRender, AppState.pagination.currentPageNumber, AppState.pagination.itemsPerPage);
      paginatedResults.forEach(apt => DOMElements.searchResultsGrid.appendChild(createPropertyCard(apt)));
      renderPaginationControls(apartmentsToRender.length, AppState.pagination.itemsPerPage, AppState.pagination.currentPageNumber);
    }

    /**
     * Membagi array item menjadi halaman-halaman.
     * @param {Array} items - Array item yang akan dipaginasi.
     * @param {number} page - Nomor halaman saat ini.
     * @param {number} perPage - Jumlah item per halaman.
     * @returns {Array} Array item untuk halaman saat ini.
     */
    function paginateResults(items, page, perPage) {
      const start = (page - 1) * perPage;
      const end = start + perPage;
      return items.slice(start, end);
    }

    /**
     * Merender kontrol paginasi (tombol Sebelumnya, Berikutnya, dan info halaman).
     * @param {number} totalItems - Jumlah total item yang dipaginasi.
     * @param {number} perPage - Jumlah item per halaman.
     * @param {number} currentPage - Nomor halaman saat ini.
     */
    function renderPaginationControls(totalItems, perPage, currentPage) {
      DOMElements.paginationControls.innerHTML = '';
      const totalPages = Math.ceil(totalItems / perPage);

      if (totalPages <= 1) return; // Tidak perlu paginasi jika hanya 1 halaman

      const createPageButton = (text, pageNum, isDisabled = false, isCurrent = false) => {
        const button = Utils.createElement('button', {
          class: `btn btn-sm ${isCurrent ? 'btn-primary' : 'btn-outline'} ${isDisabled ? 'opacity-50 cursor-not-allowed' : ''}`,
          'data-page-num': pageNum,
          'aria-label': isCurrent ? `Halaman ${pageNum}, halaman saat ini` : `Ke halaman ${pageNum}`,
          ...(isDisabled && { disabled: true })
        });
        button.innerHTML = text; // Bisa berisi nomor atau ikon
        if (!isDisabled && !isCurrent) {
          button.addEventListener('click', () => {
            AppState.pagination.currentPageNumber = pageNum;
            applyFiltersAndRenderResults();
            Utils.scrollToTop();
          });
        }
        return button;
      };

      // Tombol "Sebelumnya"
      DOMElements.paginationControls.appendChild(
        createPageButton('<span class="material-icons">chevron_left</span>', currentPage - 1, currentPage === 1)
      );

      // Nomor Halaman (dengan elipsis jika banyak halaman)
      const MAX_VISIBLE_PAGES = 5; // Jumlah maksimal tombol halaman yang terlihat
      let startPage, endPage;
      if (totalPages <= MAX_VISIBLE_PAGES) {
        startPage = 1; endPage = totalPages;
      } else {
        if (currentPage <= Math.floor(MAX_VISIBLE_PAGES / 2) + 1) {
          startPage = 1; endPage = MAX_VISIBLE_PAGES;
        } else if (currentPage + Math.floor(MAX_VISIBLE_PAGES / 2) - 1 >= totalPages) {
          startPage = totalPages - MAX_VISIBLE_PAGES + 1; endPage = totalPages;
        } else {
          startPage = currentPage - Math.floor(MAX_VISIBLE_PAGES / 2);
          endPage = currentPage + Math.floor(MAX_VISIBLE_PAGES / 2);
        }
      }

      if (startPage > 1) {
        DOMElements.paginationControls.appendChild(createPageButton('1', 1));
        if (startPage > 2) {
          DOMElements.paginationControls.appendChild(Utils.createElement('span', { class: 'px-sm text-muted-foreground' }, '...'));
        }
      }

      for (let i = startPage; i <= endPage; i++) {
        DOMElements.paginationControls.appendChild(createPageButton(i.toString(), i, false, i === currentPage));
      }

      if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
          DOMElements.paginationControls.appendChild(Utils.createElement('span', { class: 'px-sm text-muted-foreground' }, '...'));
        }
        DOMElements.paginationControls.appendChild(createPageButton(totalPages.toString(), totalPages));
      }

      // Tombol "Berikutnya"
      DOMElements.paginationControls.appendChild(
        createPageButton('<span class="material-icons">chevron_right</span>', currentPage + 1, currentPage === totalPages)
      );
    }

    /**
     * Merender checkbox untuk filter fasilitas di halaman pencarian.
     */
    function renderAmenityCheckboxes() {
      DOMElements.amenitiesFilterCheckboxes.innerHTML = '';
      // Urutkan fasilitas berdasarkan label untuk tampilan yang konsisten
      Object.entries(ALL_AMENITIES).sort(([, a], [, b]) => a.label.localeCompare(b.label)).forEach(([key, { icon, label }]) => {
        const div = Utils.createElement('div', { class: 'form-check' });
        div.innerHTML = `
          <input type="checkbox" id="amenity-${key}" value="${key}" class="form-check-input">
          <label for="amenity-${key}" class="flex items-center gap-xs text-sm cursor-pointer hover:text-primary">
            <span class="material-icons text-md text-muted-foreground" aria-hidden="true">${icon}</span>
            ${Utils.sanitizeHTML(label)}
          </label>
        `;
        DOMElements.amenitiesFilterCheckboxes.appendChild(div);
      });
    }

    /**
     * Merender detail lengkap dari satu apartemen.
     * @param {number} apartmentId - ID apartemen yang akan dirender detailnya.
     */
    function renderApartmentDetail(apartmentId) {
      const apartment = AppState.apartments.find(apt => apt.id === apartmentId);
      if (!apartment) {
        DOMElements.apartmentDetailContent.innerHTML = `
            <div class="text-center py-xl">
                <span class="material-icons text-danger mb-md" style="font-size: 64px;">error_outline</span>
                <h2 class="text-2xl font-semibold mb-sm">Detail Apartemen Tidak Ditemukan</h2>
                <p class="text-muted-foreground mb-lg">Maaf, kami tidak dapat memuat detail untuk apartemen ini. Mungkin ID tidak valid atau data tidak tersedia.</p>
                <a href="#search" data-page="search" class="btn btn-primary nav-link-inline"><span class="material-icons mr-sm" aria-hidden="true">arrow_back</span>Kembali ke Pencarian</a>
            </div>`;
        DOMElements.apartmentDetailContent.querySelector('.nav-link-inline')?.addEventListener('click', handleNavClick);
        document.title = "Apartemen Tidak Ditemukan | Green Valley";
        return;
      }

      document.title = `${Utils.sanitizeHTML(apartment.title)} | Green Valley`; // Update judul tab

      // Galeri Gambar: Foto utama lebih besar, sisanya thumbnail
      const mainImage = apartment.images[0];
      const thumbnailImages = apartment.images.slice(1, 5); // Ambil 4 thumbnail

      DOMElements.apartmentDetailContent.innerHTML = `
        <header class="mb-lg">
          <h1 class="text-3xl font-extrabold mb-sm text-foreground">${Utils.sanitizeHTML(apartment.title)}</h1>
          <div class="flex flex-wrap items-center gap-x-md gap-y-xs text-muted-foreground text-sm">
            <span class="flex items-center gap-xs"><span class="material-icons text-md text-accent" style="color:hsl(var(--accent-hue),var(--accent-saturation),calc(var(--accent-lightness) - 10%))">star</span> ${apartment.rating.toFixed(1)}/5 (${apartment.reviews.length} ulasan)</span>
            <span class="flex items-center gap-xs"><span class="material-icons text-md">location_on</span> ${Utils.sanitizeHTML(apartment.location)}</span>
            ${apartment.host.verified ? `<span class="flex items-center gap-xs text-success"><span class="material-icons verified-icon text-md" title="Pemilik Terverifikasi">verified_user</span> Pemilik Terverifikasi</span>` : ''}
          </div>
        </header>

        <section class="gallery grid grid-cols-4 gap-sm mb-lg" aria-label="Galeri foto apartemen">
            <div class="virtual-tour-placeholder col-span-4 sm:col-span-2 row-span-2 main-photo" 
                 style="background-image: url('${mainImage}'); background-size: cover; background-position: center;" 
                 title="Lihat foto utama lebih besar" tabindex="0">
            </div>
            ${thumbnailImages.map(img => `
                <img src="${img}" alt="Foto interior ${Utils.sanitizeHTML(apartment.title)}" 
                     class="thumbnail-photo aspect-square object-cover rounded-md" 
                     loading="lazy" tabindex="0" title="Lihat foto">`).join('')}
        </section>
        
        <div class="grid lg:grid-cols-3 gap-xl apartment-detail-grid">
          <article class="lg:col-span-2">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-md pb-md border-b border-border">
                <h2 class="text-2xl font-semibold mb-xs sm:mb-0 text-foreground">Tentang Properti Ini</h2>
                <span class="font-medium text-muted-foreground text-sm">Host: ${Utils.sanitizeHTML(apartment.host.name)} ${apartment.host.verified ? hostVerifiedIconHTML(true) : ''}</span>
            </div>
            <p class="text-muted-foreground mb-lg leading-relaxed">${Utils.sanitizeHTML(apartment.description)}</p>
            
            <h3 class="text-xl font-semibold mb-md text-foreground">Fasilitas Unggulan</h3>
            <ul class="grid sm:grid-cols-2 gap-x-lg gap-y-md list-none mb-lg p-0">
              ${apartment.amenities.slice(0, 10).map(key => ALL_AMENITIES[key] ? `
                <li class="flex items-center gap-sm text-muted-foreground">
                  <span class="material-icons text-primary" aria-hidden="true">${ALL_AMENITIES[key].icon}</span>
                  ${Utils.sanitizeHTML(ALL_AMENITIES[key].label)}
                </li>
              ` : '').join('')}
            </ul>
            ${apartment.amenities.length > 10 ? `<button class="btn btn-outline btn-sm mb-lg" id="showAllAmenitiesBtn"><span class="material-icons mr-sm" aria-hidden="true">list_alt</span>Tampilkan Semua Fasilitas (${apartment.amenities.length})</button>` : ''}

            <h3 class="text-xl font-semibold mb-md mt-lg text-foreground">Peta Lokasi (Simulasi)</h3>
            <div class="map-canvas mb-sm" aria-label="Peta menunjukkan lokasi apartemen">
              Peta Interaktif Akan Ditampilkan Di Sini.<br>
              <span class="text-xs">(Untuk aplikasi nyata, integrasikan dengan Google Maps API atau Leaflet.js menggunakan koordinat properti)</span>
            </div>
            <a href="https://maps.google.com/?q=${encodeURIComponent(apartment.location)}" target="_blank" rel="noopener noreferrer" class="btn btn-outline btn-sm">
                <span class="material-icons mr-sm" aria-hidden="true">map</span>Lihat di Google Maps
            </a>
            
            <h2 class="text-2xl font-semibold mt-xl mb-md text-foreground">Ulasan Pelanggan (${apartment.reviews.length})</h2>
            <div id="apartmentReviewsList" class="flex flex-col gap-md">
              ${apartment.reviews.length > 0 ? apartment.reviews.map(review => `
                <div class="card shadow-sm ${AppState.reportedReviewIds.has(review.id) ? 'opacity-60 bg-secondary' : ''}">
                  <div class="card-body">
                    <div class="flex justify-between items-start mb-xs">
                        <div>
                            <p class="font-semibold text-foreground">${Utils.sanitizeHTML(review.user)}</p>
                            <p class="text-xs text-muted-foreground">${new Date(review.date).toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        </div>
                        <div class="flex items-center gap-sm">
                            <span class="text-sm text-accent font-semibold flex items-center" aria-label="Rating: ${review.rating} dari 5 bintang">
                                ${''.repeat(Math.round(review.rating))}${''.repeat(5 - Math.round(review.rating))}
                                <span class="ml-xs text-muted-foreground">(${review.rating.toFixed(1)})</span>
                            </span>
                            ${!AppState.reportedReviewIds.has(review.id) ? `
                            <button class="btn-icon report-review-btn p-xs rounded-full hover:bg-danger hover:text-danger-foreground" data-review-id="${review.id}" title="Laporkan ulasan ini" aria-label="Laporkan ulasan dari ${Utils.sanitizeHTML(review.user)}">
                                <span class="material-icons report-icon text-sm">flag</span>
                            </button>
                            ` : `<span class="text-xs text-danger italic font-medium">Telah Dilaporkan</span>`}
                        </div>
                    </div>
                    <blockquote class="text-sm text-muted-foreground leading-normal mt-sm"><p>"${Utils.sanitizeHTML(review.comment)}"</p></blockquote>
                  </div>
                </div>
              `).join('') : '<p class="text-muted-foreground p-md border border-border rounded-md bg-secondary">Belum ada ulasan untuk properti ini. Jadilah yang pertama memberi ulasan setelah menginap!</p>'}
            </div>
          </article>

          <aside class="lg:col-span-1 sticky top-[calc(var(--spacing-xl)_*_2)] h-fit">
            <form id="bookingForm" class="card shadow-lg border-primary border-t-[3px]" aria-labelledby="booking-form-title">
              <div class="card-header bg-primary-lightest"> <!-- Latar header form booking lebih lembut -->
                <h3 id="booking-form-title" class="text-xl mb-0 font-semibold text-primary">Mulai dari <span class="font-bold text-2xl">${Utils.formatCurrency(apartment.pricePerNight)}</span><span class="text-sm font-normal text-muted-foreground">/malam</span></h3>
              </div>
              <div class="card-body">
                <div class="grid grid-cols-2 gap-md">
                    <div class="form-group">
                      <label for="book-checkin">Check-in</label>
                      <input type="date" id="book-checkin" class="form-control" required aria-label="Tanggal check-in pemesanan">
                    </div>
                    <div class="form-group">
                      <label for="book-checkout">Check-out</label>
                      <input type="date" id="book-checkout" class="form-control" required aria-label="Tanggal check-out pemesanan">
                    </div>
                </div>
                <div class="form-group">
                  <label for="book-guests">Jumlah Tamu</label>
                  <input type="number" id="book-guests" class="form-control" min="1" max="${(apartment.type === 'studio' ? 2 : apartment.bedrooms * 2) || 2}" value="1" required aria-label="Jumlah tamu">
                </div>
                <div class="form-group">
                  <label>Metode Pembayaran</label>
                  <div class="payment-methods" role="radiogroup" aria-label="Pilih metode pembayaran">
                    <div class="payment-method" data-method="credit_card" tabindex="0" role="radio" aria-checked="false">Kartu Kredit</div>
                    <div class="payment-method" data-method="bank_transfer" tabindex="0" role="radio" aria-checked="false">Transfer Bank</div>
                    <div class="payment-method" data-method="e_wallet" tabindex="0" role="radio" aria-checked="false">E-Wallet</div>
                  </div>
                </div>
                <div class="form-group form-check mt-md">
                  <input type="checkbox" id="booking-insurance" class="form-check-input">
                  <label for="booking-insurance">Tambah Asuransi Perjalanan (+Rp ${Math.round(apartment.pricePerNight * 0.1)}K)</label>
                </div>
                
                <div id="bookingCostBreakdown" class="cost-breakdown hidden mt-md">
                  <h4 class="font-semibold text-md mb-sm">Rincian Biaya</h4>
                  <div class="cost-line"><span>Harga Dasar (<span id="bookingNumNights">0</span> malam)</span><span id="bookingBaseCost" class="font-medium">Rp 0K</span></div>
                  <div class="cost-line"><span>Biaya Layanan (5%)</span><span id="bookingServiceCost" class="font-medium">Rp 0K</span></div>
                  <div class="cost-line hidden" id="bookingInsuranceCostLine"><span>Asuransi Perjalanan</span><span id="bookingInsuranceCostVal" class="font-medium">Rp 0K</span></div>
                  <hr class="my-sm border-border">
                  <div class="cost-line total"><span>Total Pembayaran</span><span id="bookingTotalCost" class="text-primary">Rp 0K</span></div>
                </div>

                <p class="escrow-info text-sm mt-md"><span class="material-icons" aria-hidden="true">security</span>Pembayaran Anda dijamin aman melalui sistem escrow Green Valley hingga Anda berhasil check-in.</p>
              </div>
              <div class="card-footer">
                <button type="submit" class="btn btn-primary btn-lg w-full">
                  <span class="material-icons" aria-hidden="true">event_available</span>Pesan Sekarang
                </button>
              </div>
            </form>
          </aside>
        </div>
      `;

      // Helper untuk ikon verifikasi
      function hostVerifiedIconHTML(isVerified) {
        return isVerified ? '<span class="material-icons verified-icon text-sm ml-xs text-success" title="Terverifikasi" aria-label="Terverifikasi">verified_user</span>' : '';
      }


      // Event listener untuk tombol "Tampilkan Semua Fasilitas"
      const showAllAmenitiesBtn = document.getElementById('showAllAmenitiesBtn');
      if (showAllAmenitiesBtn) {
        showAllAmenitiesBtn.addEventListener('click', () => {
          const amenitiesList = DOMElements.apartmentDetailContent.querySelector('article ul');
          if (amenitiesList) {
            amenitiesList.innerHTML = apartment.amenities.map(key => ALL_AMENITIES[key] ? `
                <li class="flex items-center gap-sm text-muted-foreground">
                  <span class="material-icons text-primary" aria-hidden="true">${ALL_AMENITIES[key].icon}</span>
                  ${Utils.sanitizeHTML(ALL_AMENITIES[key].label)}
                </li>
              ` : '').join('');
          }
          showAllAmenitiesBtn.remove();
        });
      }

      DOMElements.apartmentDetailContent.querySelectorAll('.payment-method').forEach(method => {
        method.addEventListener('click', handlePaymentMethodSelect);
        method.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); method.click(); } });
      });

      const bookingForm = DOMElements.apartmentDetailContent.querySelector('#bookingForm');
      if (bookingForm) bookingForm.addEventListener('submit', handleBookingSubmit);

      const bookCheckin = DOMElements.apartmentDetailContent.querySelector('#book-checkin');
      const bookCheckout = DOMElements.apartmentDetailContent.querySelector('#book-checkout');
      const bookGuests = DOMElements.apartmentDetailContent.querySelector('#book-guests');
      const bookingInsurance = DOMElements.apartmentDetailContent.querySelector('#booking-insurance');
      const todayISO = Utils.getISODate(new Date());

      if (bookCheckin) { bookCheckin.min = todayISO; bookCheckin.addEventListener('change', updateBookingCost); }
      if (bookCheckout) { bookCheckout.min = todayISO; bookCheckout.addEventListener('change', updateBookingCost); }
      if (bookGuests) bookGuests.addEventListener('input', updateBookingCost); // 'input' untuk update lebih responsif
      if (bookingInsurance) bookingInsurance.addEventListener('change', updateBookingCost);

      DOMElements.apartmentDetailContent.querySelectorAll('.report-review-btn').forEach(button => {
        button.addEventListener('click', (e) => openReportModal(e.currentTarget.dataset.reviewId));
      });

      DOMElements.apartmentDetailContent.querySelectorAll('.gallery img, .virtual-tour-placeholder').forEach(el => {
        el.addEventListener('click', () => alert(`Simulasi: Gambar ${el.alt || 'utama'} diklik. Implementasikan lightbox atau slider di sini.`));
        el.addEventListener('keydown', (e) => { if (e.key === 'Enter') el.click(); });
      });

      updateBookingCost(); // Panggil sekali untuk inisialisasi biaya jika ada tanggal default
    }

    /**
     * Merender informasi profil pengguna di halaman profil.
     */
    function renderProfileInfo() {
      DOMElements.profileUserName.textContent = Utils.sanitizeHTML(AppState.userProfile.name);
      DOMElements.profileUserEmail.textContent = Utils.sanitizeHTML(AppState.userProfile.email);
      DOMElements.profileUserImage.src = AppState.userProfile.profilePic; // Asumsi URL gambar aman
      DOMElements.profileUserImage.alt = `Foto profil ${Utils.sanitizeHTML(AppState.userProfile.name)}`;
      DOMElements.profileUserLoyalty.textContent = AppState.userProfile.loyaltyPoints.toLocaleString('id-ID');
    }

    /**
     * Merender riwayat pemesanan pengguna di halaman profil.
     */
    function renderBookingHistory() {
      DOMElements.bookingHistoryList.innerHTML = '';
      if (AppState.bookingHistory.length === 0) {
        DOMElements.bookingHistoryList.innerHTML = `
          <div class="card"><div class="card-body p-lg text-center">
            <span class="material-icons text-muted-foreground mb-md" style="font-size: 48px;">history_toggle_off</span>
            <p class="text-muted-foreground">Anda belum memiliki riwayat pemesanan. <a href="#search" data-page="search" class="text-primary hover:underline nav-link-inline">Mulai cari apartemen sekarang!</a></p>
          </div></div>`;
        DOMElements.bookingHistoryList.querySelector('.nav-link-inline')?.addEventListener('click', handleNavClick);
        return;
      }
      AppState.bookingHistory.forEach(booking => {
        const apartment = AppState.apartments.find(apt => apt.id === booking.apartmentId);
        if (!apartment) return;

        const item = Utils.createElement('div', { class: 'card shadow-sm hover:shadow-md transition-shadow' });
        item.innerHTML = `
          <div class="card-body flex flex-col sm:flex-row gap-md items-center p-md">
            <img src="${apartment.images[0]}" alt="${Utils.sanitizeHTML(apartment.title)}" 
                 style="width:120px; height:90px; object-fit:cover; border-radius:var(--radius-md); flex-shrink:0;"
                 class="shadow-sm">
            <div class="flex-grow">
              <h4 class="font-semibold mb-xs text-md text-foreground">${Utils.sanitizeHTML(apartment.title)}</h4>
              <p class="text-sm text-muted-foreground mb-xs">
                Check-in: ${new Date(booking.checkin).toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}<br>
                Check-out: ${new Date(booking.checkout).toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
              </p>
              <p class="text-sm font-semibold text-primary">Total: ${Utils.formatCurrency(booking.totalCost / 1000)} (${booking.numNights} malam)</p>
            </div>
            <button class="btn btn-outline btn-sm view-booking-detail-btn mt-sm sm:mt-0 self-start sm:self-center" data-booking-id="${booking.id}" data-apartment-id="${apartment.id}">
                <span class="material-icons mr-xs text-sm" aria-hidden="true">info</span>Lihat Detail Properti
            </button>
          </div>
        `;
        item.querySelector('.view-booking-detail-btn').addEventListener('click', (e) => {
          AppState.selectedApartmentId = parseInt(e.currentTarget.dataset.apartmentId);
          navigateToPage('apartment');
        });
        DOMElements.bookingHistoryList.appendChild(item);
      });
    }

    /**
     * Merender pesan obrolan untuk tipe obrolan tertentu (profil atau dukungan).
     * @param {string} chatType - Tipe obrolan ('profile' atau 'support').
     * @param {HTMLElement} chatWindowElement - Elemen DOM tempat pesan akan dirender.
     */
    function renderChatMessages(chatType, chatWindowElement) {
      if (!chatWindowElement) return;
      chatWindowElement.innerHTML = '';
      const messages = AppState.chatMessages[chatType] || [];
      messages.forEach(msg => {
        const msgDiv = Utils.createElement('div', { class: `chat-message ${msg.type}` });
        msgDiv.textContent = Utils.sanitizeHTML(msg.text);
        chatWindowElement.appendChild(msgDiv);
      });
      chatWindowElement.scrollTop = chatWindowElement.scrollHeight; // Auto-scroll ke pesan terbaru
    }

    /**
     * Merender daftar FAQ di halaman dukungan.
     */
    function renderFaqs() {
      DOMElements.faqAccordion.innerHTML = '';
      MOCK_FAQS.forEach((faq, index) => {
        const details = Utils.createElement('details', { class: 'border border-border rounded-lg overflow-hidden' });
        // Tambahkan atribut open untuk FAQ pertama agar terbuka secara default
        if (index === 0) details.setAttribute('open', '');
        details.innerHTML = `
          <summary class="font-semibold p-md cursor-pointer hover:bg-secondary transition-colors flex justify-between items-center">
            ${Utils.sanitizeHTML(faq.q)}
            <span class="material-icons summary-icon transition-transform">expand_more</span>
          </summary>
          <div class="p-md border-t border-border bg-card">
            <p class="text-muted-foreground">${Utils.sanitizeHTML(faq.a)}</p>
          </div>
        `;
        // CSS untuk rotasi ikon expand_more/less akan ditangani oleh CSS :
        // details[open] summary .summary-icon { transform: rotate(180deg); }
        DOMElements.faqAccordion.appendChild(details);
      });
    }

    /**
     * Merender data untuk dasbor admin (simulasi).
     */
    function renderAdminDashboard() {
      DOMElements.adminTotalApartments.textContent = AppState.apartments.length.toLocaleString('id-ID');
      DOMElements.adminApartmentsAvailable.textContent = `${AppState.apartments.filter(apt => Object.keys(apt.availability || {}).length === 0).length} Tersedia`;
      DOMElements.adminTotalTenants.textContent = (Math.floor(Math.random() * 200) + 50).toLocaleString('id-ID');
      DOMElements.adminActiveBookings.textContent = (Math.floor(Math.random() * 50) + 10).toLocaleString('id-ID');

      DOMElements.adminApartmentTableBody.innerHTML = '';
      AppState.apartments.slice(0, 8).forEach(apt => { // Tampilkan hingga 8 apartemen
        const row = DOMElements.adminApartmentTableBody.insertRow();
        const isAvailable = Object.keys(apt.availability || {}).length === 0;
        row.innerHTML = `
          <td>#${apt.id}</td>
          <td class="font-medium text-foreground">${Utils.sanitizeHTML(apt.title.substring(0, 35))}${apt.title.length > 35 ? '...' : ''}</td>
          <td>${Utils.sanitizeHTML(apt.location)}</td>
          <td><span class="badge ${isAvailable ? 'badge-success' : 'badge-warning'}">${isAvailable ? 'Tersedia Penuh' : 'Terpesan Sebagian/Penuh'}</span></td>
          <td class="font-semibold">${Utils.formatCurrency(apt.pricePerNight)}</td>
          <td class="flex gap-xs">
            <button class="btn btn-sm btn-outline btn-icon" title="Edit Apartemen #${apt.id}" aria-label="Edit Apartemen ${Utils.sanitizeHTML(apt.title)}"><span class="material-icons text-sm">edit</span></button>
            <button class="btn btn-sm btn-danger btn-icon" title="Hapus Apartemen #${apt.id}" aria-label="Hapus Apartemen ${Utils.sanitizeHTML(apt.title)}"><span class="material-icons text-sm">delete_outline</span></button>
          </td>
        `;
      });
      if (AppState.apartments.length === 0) {
        DOMElements.adminApartmentTableBody.innerHTML = `<tr><td colspan="6" class="text-center py-lg text-muted-foreground">Tidak ada data apartemen yang tersedia.</td></tr>`;
      }
    }


    // === PENANGANAN EVENT & LOGIKA APLIKASI ===

    /**
     * Memperbarui tampilan rentang harga pada slider di halaman pencarian.
     */
    function updatePriceRangeDisplay() {
      const maxPrice = parseInt(DOMElements.priceRangeSlider.value);
      AppState.searchFilters.priceMax = maxPrice;
      DOMElements.priceRangeMaxDisplay.textContent = maxPrice.toLocaleString('id-ID');
      DOMElements.priceRangeMinDisplay.textContent = parseInt(DOMElements.priceRangeSlider.min).toLocaleString('id-ID');
    }

    /**
     * Menangani submit form pencarian lengkap.
     * Mengumpulkan semua filter, mereset paginasi, dan merender hasil.
     * @param {Event} event - Objek event submit.
     */
    function handleFullSearchForm(event) {
      event.preventDefault();
      AppState.searchFilters.location = document.getElementById('search-location').value.trim().toLowerCase();
      AppState.searchFilters.checkin = document.getElementById('search-checkin').value;
      AppState.searchFilters.checkout = document.getElementById('search-checkout').value;
      AppState.searchFilters.guests = parseInt(document.getElementById('search-guests').value) || 1;
      AppState.searchFilters.priceMax = parseInt(DOMElements.priceRangeSlider.value);
      AppState.searchFilters.type = document.getElementById('apartment-type').value;

      AppState.searchFilters.amenities = Array.from(DOMElements.amenitiesFilterCheckboxes.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);

      AppState.pagination.currentPageNumber = 1; // Reset ke halaman pertama setiap filter baru
      applyFiltersAndRenderResults();
    }

    /**
     * Menerapkan filter ke daftar apartemen dan merender hasilnya.
     * Termasuk logika pengurutan hasil.
     */
    function applyFiltersAndRenderResults() {
      let results = AppState.apartments.filter(apt => {
        const matchesLocation = AppState.searchFilters.location ? apt.location.toLowerCase().includes(AppState.searchFilters.location) : true;
        const matchesPrice = apt.pricePerNight <= AppState.searchFilters.priceMax;
        const matchesType = AppState.searchFilters.type ? apt.type === AppState.searchFilters.type : true;
        const matchesAmenities = AppState.searchFilters.amenities.length > 0 ? AppState.searchFilters.amenities.every(am => apt.amenities.includes(am)) : true;

        let isDateAvailable = true;
        if (AppState.searchFilters.checkin && AppState.searchFilters.checkout) {
          const checkin = new Date(AppState.searchFilters.checkin);
          const checkout = new Date(AppState.searchFilters.checkout);
          if (checkout > checkin) { // Pastikan tanggal checkout setelah checkin
            for (let d = new Date(checkin); d < checkout; d.setDate(d.getDate() + 1)) {
              if (apt.availability && apt.availability[Utils.getISODate(d)] === 'booked') {
                isDateAvailable = false; break;
              }
            }
          } else {
            // Jika tanggal tidak valid, anggap tidak tersedia atau abaikan filter tanggal ini
            // Untuk sekarang, kita anggap saja true jika tanggal tidak valid agar tidak mengosongkan semua hasil
          }
        }

        const maxGuests = (apt.type === 'studio' ? 2 : apt.bedrooms * 2) || 2;
        const matchesGuests = AppState.searchFilters.guests <= maxGuests;

        return matchesLocation && matchesPrice && matchesType && matchesAmenities && isDateAvailable && matchesGuests;
      });

      const sortBy = DOMElements.sortBySelect.value;
      if (sortBy === 'price_asc') results.sort((a, b) => a.pricePerNight - b.pricePerNight);
      else if (sortBy === 'price_desc') results.sort((a, b) => b.pricePerNight - a.pricePerNight);
      else if (sortBy === 'rating_desc') results.sort((a, b) => b.rating - a.rating);

      AppState.filteredApartments = results;
      renderSearchResults(AppState.filteredApartments);
    }

    /**
     * Mereset semua filter pencarian ke nilai default dan merender ulang hasil.
     */
    function resetFilters() {
      if (DOMElements.fullSearchForm) DOMElements.fullSearchForm.reset();
      AppState.searchFilters = {
        location: '', checkin: '', checkout: '', guests: 1,
        priceMax: parseInt(DOMElements.priceRangeSlider?.max || '5000'),
        amenities: [], type: '',
      };
      if (DOMElements.priceRangeSlider) DOMElements.priceRangeSlider.value = AppState.searchFilters.priceMax;
      updatePriceRangeDisplay();
      AppState.pagination.currentPageNumber = 1;
      applyFiltersAndRenderResults();
    }

    /**
     * Menangani submit form pencarian cepat di halaman beranda.
     * Mengisi filter utama dan menavigasi ke halaman pencarian.
     * @param {Event} event - Objek event submit.
     */
    function handleQuickSearchForm(event) {
      event.preventDefault();
      AppState.searchFilters.location = document.getElementById('quick-location').value.trim().toLowerCase();
      AppState.searchFilters.checkin = document.getElementById('quick-checkin').value;
      AppState.searchFilters.checkout = document.getElementById('quick-checkout').value;
      AppState.searchFilters.priceMax = parseInt(DOMElements.priceRangeSlider?.max || '5000'); // Reset harga
      AppState.searchFilters.amenities = []; AppState.searchFilters.type = ''; AppState.searchFilters.guests = 1; // Reset filter lain
      AppState.pagination.currentPageNumber = 1;
      navigateToPage('search'); // Ini akan memicu loadPageContent -> applyFiltersAndRenderResults
    }

    /**
     * Menangani pemilihan metode pembayaran pada form booking.
     * @param {Event} event - Objek event klik.
     */
    function handlePaymentMethodSelect(event) {
      DOMElements.apartmentDetailContent.querySelectorAll('.payment-method').forEach(m => {
        m.classList.remove('selected'); m.setAttribute('aria-checked', 'false');
      });
      event.currentTarget.classList.add('selected');
      event.currentTarget.setAttribute('aria-checked', 'true');
    }

    /**
     * Memperbarui tampilan rincian biaya pada form booking di halaman detail apartemen.
     * Dijalankan setiap kali tanggal atau opsi asuransi berubah.
     */
    function updateBookingCost() {
      const apartment = AppState.apartments.find(apt => apt.id === AppState.selectedApartmentId);
      if (!apartment || AppState.currentPage !== 'apartment') return; // Hanya update jika di halaman detail

      const checkinDateEl = DOMElements.apartmentDetailContent.querySelector('#book-checkin');
      const checkoutDateEl = DOMElements.apartmentDetailContent.querySelector('#book-checkout');
      const insuranceCheckedEl = DOMElements.apartmentDetailContent.querySelector('#booking-insurance');
      const costBreakdownEl = DOMElements.apartmentDetailContent.querySelector('#bookingCostBreakdown');
      const numNightsEl = DOMElements.apartmentDetailContent.querySelector('#bookingNumNights');
      const baseCostEl = DOMElements.apartmentDetailContent.querySelector('#bookingBaseCost');
      const serviceCostEl = DOMElements.apartmentDetailContent.querySelector('#bookingServiceCost');
      const insuranceCostLineEl = DOMElements.apartmentDetailContent.querySelector('#bookingInsuranceCostLine');
      const insuranceCostValEl = DOMElements.apartmentDetailContent.querySelector('#bookingInsuranceCostVal');
      const totalCostEl = DOMElements.apartmentDetailContent.querySelector('#bookingTotalCost');

      if (!checkinDateEl || !checkoutDateEl || !insuranceCheckedEl || !costBreakdownEl || !numNightsEl || !baseCostEl || !serviceCostEl || !insuranceCostLineEl || !insuranceCostValEl || !totalCostEl) {
        console.warn("Satu atau lebih elemen DOM untuk rincian biaya tidak ditemukan saat update.");
        return;
      }

      const checkinDate = checkinDateEl.value; const checkoutDate = checkoutDateEl.value;
      const insuranceChecked = insuranceCheckedEl.checked;

      if (checkinDate && checkoutDate) {
        const date1 = new Date(checkinDate); const date2 = new Date(checkoutDate);
        if (date2 <= date1) {
          costBreakdownEl.classList.add('hidden'); totalCostEl.textContent = 'Rp 0K';
          // Tandai input tanggal tidak valid jika perlu (misalnya, dengan border merah)
          checkinDateEl.classList.add('border-danger'); checkoutDateEl.classList.add('border-danger');
          return;
        } else {
          checkinDateEl.classList.remove('border-danger'); checkoutDateEl.classList.remove('border-danger');
        }

        const timeDiff = date2.getTime() - date1.getTime();
        const numNights = Math.ceil(timeDiff / (1000 * 3600 * 24));

        if (numNights > 0) {
          const baseCost = numNights * (apartment.pricePerNight * 1000);
          const serviceFee = baseCost * 0.05; // Biaya layanan 5%
          let insuranceCost = 0;

          numNightsEl.textContent = numNights;
          baseCostEl.textContent = `Rp ${(baseCost / 1000).toLocaleString('id-ID')}K`;
          serviceCostEl.textContent = `Rp ${(serviceFee / 1000).toLocaleString('id-ID')}K`;

          if (insuranceChecked) {
            insuranceCost = baseCost * 0.10; // Asuransi 10% dari harga dasar
            insuranceCostValEl.textContent = `Rp ${(insuranceCost / 1000).toLocaleString('id-ID')}K`;
            insuranceCostLineEl.classList.remove('hidden');
          } else {
            insuranceCostLineEl.classList.add('hidden');
          }
          const totalCost = baseCost + serviceFee + insuranceCost;
          totalCostEl.textContent = `Rp ${(totalCost / 1000).toLocaleString('id-ID')}K`;
          costBreakdownEl.classList.remove('hidden');
          return;
        }
      }
      costBreakdownEl.classList.add('hidden'); totalCostEl.textContent = 'Rp 0K';
    }

    /**
     * Menangani submit form pemesanan.
     * Melakukan validasi, simulasi pengecekan ketersediaan, dan menambahkan ke riwayat jika berhasil.
     * @param {Event} event - Objek event submit.
     */
    function handleBookingSubmit(event) {
      event.preventDefault();
      const apartment = AppState.apartments.find(apt => apt.id === AppState.selectedApartmentId);
      if (!apartment) { alert("Error: Apartemen tidak ditemukan."); return; }

      const checkin = DOMElements.apartmentDetailContent.querySelector('#book-checkin').value;
      const checkout = DOMElements.apartmentDetailContent.querySelector('#book-checkout').value;
      const guests = DOMElements.apartmentDetailContent.querySelector('#book-guests').value;
      const paymentMethodEl = DOMElements.apartmentDetailContent.querySelector('.payment-method.selected');
      const insurance = DOMElements.apartmentDetailContent.querySelector('#booking-insurance').checked;

      if (!checkin || !checkout || !guests || !paymentMethodEl) {
        alert('Peringatan: Harap lengkapi semua field yang diperlukan (tanggal, tamu, dan metode pembayaran).'); return;
      }
      if (new Date(checkout) <= new Date(checkin)) {
        alert('Error: Tanggal check-out harus setelah tanggal check-in.'); return;
      }

      let conflict = false; let currentDate = new Date(checkin); const endDateLoop = new Date(checkout);
      while (currentDate < endDateLoop) {
        if (apartment.availability && apartment.availability[Utils.getISODate(currentDate)] === 'booked') { conflict = true; break; }
        currentDate.setDate(currentDate.getDate() + 1);
      }
      if (conflict) {
        alert(`Maaf, tanggal antara ${new Date(checkin).toLocaleDateString('id-ID')} dan ${new Date(checkout).toLocaleDateString('id-ID')} tidak tersedia. Silakan pilih tanggal lain.`); return;
      }

      const timeDiff = new Date(checkout).getTime() - new Date(checkin).getTime();
      const numNights = Math.ceil(timeDiff / (1000 * 3600 * 24));
      const baseCost = numNights * (apartment.pricePerNight * 1000);
      const serviceFee = baseCost * 0.05; const insuranceCost = insurance ? baseCost * 0.10 : 0;
      const totalCost = baseCost + serviceFee + insuranceCost;

      const bookingId = Utils.generateId('bk');
      const newBooking = {
        id: bookingId, apartmentId: apartment.id, checkin, checkout, numNights,
        guests: parseInt(guests), totalCost, paymentMethod: paymentMethodEl.dataset.method, status: 'confirmed'
      };
      AppState.bookingHistory.unshift(newBooking);

      currentDate = new Date(checkin); // Reset tanggal untuk loop
      if (!apartment.availability) apartment.availability = {}; // Inisialisasi jika belum ada
      while (currentDate < endDateLoop) {
        apartment.availability[Utils.getISODate(currentDate)] = 'booked';
        currentDate.setDate(currentDate.getDate() + 1);
      }

      alert(`Pemesanan Anda untuk ${Utils.sanitizeHTML(apartment.title)} dari ${new Date(checkin).toLocaleDateString('id-ID')} hingga ${new Date(checkout).toLocaleDateString('id-ID')} telah berhasil!\nTotal Pembayaran: Rp ${(totalCost / 1000).toLocaleString('id-ID')}K.\nDetail konfirmasi akan dikirim ke email Anda (simulasi).`);

      event.target.reset();
      DOMElements.apartmentDetailContent.querySelector('#bookingCostBreakdown').classList.add('hidden');
      DOMElements.apartmentDetailContent.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
      navigateToPage('profile');
    }

    /**
     * Menangani submit pesan obrolan (untuk profil atau dukungan).
     * @param {Event} event - Objek event submit.
     * @param {string} chatType - Tipe obrolan ('profile' atau 'support').
     * @param {HTMLInputElement} inputElement - Elemen input teks pesan.
     * @param {HTMLElement} windowElement - Elemen div tempat pesan ditampilkan.
     */
    function handleChatSubmit(event, chatType, inputElement, windowElement) {
      event.preventDefault();
      const text = inputElement.value.trim();
      if (text) {
        AppState.chatMessages[chatType].push({ type: 'sent', text, timestamp: Date.now() });
        renderChatMessages(chatType, windowElement);
        inputElement.value = '';

        setTimeout(() => { // Simulasi balasan otomatis
          const replyText = chatType === 'profile' ?
            "Pesan Anda telah diterima. Pemilik atau admin akan segera merespons." :
            "Terima kasih telah menghubungi tim dukungan Green Valley. Seorang agen akan segera membantu Anda. Mohon tunggu sebentar.";
          AppState.chatMessages[chatType].push({ type: 'received', text: replyText, timestamp: Date.now() });
          renderChatMessages(chatType, windowElement);
        }, 1500);
      }
    }

    // --- Logika Modal Pelaporan Ulasan ---
    /**
     * Membuka modal untuk melaporkan ulasan.
     * @param {string} reviewId - ID ulasan yang akan dilaporkan.
     */
    function openReportModal(reviewId) {
      const apartmentContainingReview = AppState.apartments.find(apt => apt.reviews.some(r => r.id === reviewId));
      if (!apartmentContainingReview) { console.error("ID Ulasan tidak ditemukan:", reviewId); return; }

      if (AppState.reportedReviewIds.has(reviewId)) {
        alert("Ulasan ini sudah pernah Anda laporkan sebelumnya."); return;
      }

      DOMElements.reportReviewIdInput.value = reviewId;
      DOMElements.reportReviewForm.reset();
      DOMElements.reportReviewModal.classList.add('is-open');
      DOMElements.reportReviewModal.querySelector('#report-reason').focus();
    }

    /** Menutup modal pelaporan ulasan. */
    function closeReportModal() { DOMElements.reportReviewModal.classList.remove('is-open'); }

    /**
     * Menangani submit form pelaporan ulasan.
     * @param {Event} event - Objek event submit.
     */
    function handleReportReviewSubmit(event) {
      event.preventDefault();
      const reviewId = DOMElements.reportReviewIdInput.value;
      const reason = DOMElements.reportReviewModal.querySelector('#report-reason').value.trim();
      const category = DOMElements.reportReviewModal.querySelector('#report-category').value;

      if (!reason || !category) { alert("Mohon isi alasan dan pilih kategori pelaporan."); return; }

      AppState.reportedReviewIds.add(reviewId); // Tandai ulasan sebagai dilaporkan di state global

      console.log(`Laporan Ulasan Diterima (Simulasi): ID Ulasan ${reviewId}, Alasan: ${reason}, Kategori: ${category}`);
      alert("Laporan Anda telah berhasil dikirim. Terima kasih atas partisipasi Anda dalam menjaga kualitas komunitas Green Valley.");
      closeReportModal();

      // Render ulang detail apartemen jika sedang di halaman tersebut untuk update tampilan ulasan
      const apartmentWithReportedReview = AppState.apartments.find(apt => apt.reviews.some(r => r.id === reviewId));
      if (AppState.currentPage === 'apartment' && apartmentWithReportedReview && AppState.selectedApartmentId === apartmentWithReportedReview.id) {
        renderApartmentDetail(AppState.selectedApartmentId);
      }
    }

    // --- Logika Widget Chat Melayang ---
    /** Mengaktifkan atau menonaktifkan tampilan widget chatbox dukungan. */
    function toggleChatbox() {
      const isHidden = DOMElements.chatboxWidget.classList.toggle('hidden');
      DOMElements.floatingChatButton.setAttribute('aria-expanded', !isHidden);
      if (!isHidden) {
        DOMElements.chatboxInput.focus();
        renderChatMessages('support', DOMElements.chatboxMessages);
      }
    }

    // === INISIALISASI APLIKASI ===
    /** Fungsi utama untuk menginisialisasi aplikasi saat DOM siap. */
    function initializeApp() {
      if (DOMElements.currentYearSpan) DOMElements.currentYearSpan.textContent = new Date().getFullYear();
      AppState.apartments = MOCK_APARTMENTS; // Isi data apartemen dari mock
      renderAmenityCheckboxes(); // Render filter fasilitas sekali saat init

      // Pasang event listener global
      DOMElements.navLinks.forEach(link => link.addEventListener('click', handleNavClick));
      window.addEventListener('hashchange', handleHashChange);
      DOMElements.mobileMenuButton.addEventListener('click', toggleMobileMenu);

      // Event listener spesifik untuk form dan elemen interaktif
      if (DOMElements.quickSearchForm) DOMElements.quickSearchForm.addEventListener('submit', handleQuickSearchForm);
      if (DOMElements.fullSearchForm) DOMElements.fullSearchForm.addEventListener('submit', handleFullSearchForm);
      if (DOMElements.resetFiltersBtn) DOMElements.resetFiltersBtn.addEventListener('click', resetFilters);

      if (DOMElements.profileChatForm) DOMElements.profileChatForm.addEventListener('submit', (e) => handleChatSubmit(e, 'profile', DOMElements.profileChatInput, DOMElements.profileChatWindow));
      if (DOMElements.startLiveChatBtn) DOMElements.startLiveChatBtn.addEventListener('click', () => { DOMElements.chatboxWidget.classList.contains('hidden') ? toggleChatbox() : DOMElements.chatboxInput.focus(); });

      if (DOMElements.priceRangeSlider) {
        DOMElements.priceRangeSlider.addEventListener('input', Utils.debounce(updatePriceRangeDisplay, 50));
        DOMElements.priceRangeSlider.addEventListener('change', () => { updatePriceRangeDisplay(); AppState.pagination.currentPageNumber = 1; applyFiltersAndRenderResults(); });
        updatePriceRangeDisplay(); // Init display
      }
      if (DOMElements.sortBySelect) DOMElements.sortBySelect.addEventListener('change', () => { AppState.pagination.currentPageNumber = 1; applyFiltersAndRenderResults(); });

      // Widget Chat Melayang
      if (DOMElements.floatingChatButton) DOMElements.floatingChatButton.addEventListener('click', toggleChatbox);
      if (DOMElements.closeChatboxButton) DOMElements.closeChatboxButton.addEventListener('click', toggleChatbox);
      if (DOMElements.chatboxForm) DOMElements.chatboxForm.addEventListener('submit', (e) => handleChatSubmit(e, 'support', DOMElements.chatboxInput, DOMElements.chatboxMessages));

      // Modal Lapor Ulasan
      if (DOMElements.reportReviewModal) {
        DOMElements.closeReportModalBtn.addEventListener('click', closeReportModal);
        DOMElements.cancelReportBtn.addEventListener('click', closeReportModal);
        DOMElements.reportReviewForm.addEventListener('submit', handleReportReviewSubmit);
        DOMElements.reportReviewModal.addEventListener('click', (event) => { if (event.target === DOMElements.reportReviewModal) closeReportModal(); });
      }

      // Muat halaman awal berdasarkan hash atau default ke 'home'
      const initialPageId = window.location.hash.substring(1) || 'home';
      navigateToPage(initialPageId);

      if (initialPageId === 'search') applyFiltersAndRenderResults(); // Jika mulai di halaman search, terapkan filter
      renderChatMessages('support', DOMElements.chatboxMessages); // Render pesan awal di chatbox

      console.info("Aplikasi Green Valley berhasil diinisialisasi. Mode: Vanilla JS SPA.");
    }

    // Jalankan aplikasi setelah DOM sepenuhnya dimuat dan siap
    document.addEventListener('DOMContentLoaded', initializeApp);
  </script>
</body>

</html>