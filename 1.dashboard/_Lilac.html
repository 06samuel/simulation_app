<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Green Valley - Platform Sewa Apartemen Modern</title>
  <style>
    /* Reset dan Gaya Dasar Global */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --primary-color: #3B82F6;
      /* Biru yang lebih modern */
      --primary-hover-color: #2563EB;
      --primary-light-color: #DBEAFE;
      --secondary-color: #F59E0B;
      /* Kuning/Oranye sekunder */
      --text-color: #1F2937;
      /* Abu-abu gelap untuk teks */
      --text-light-color: #6B7280;
      /* Abu-abu lebih terang */
      --bg-color: #F9FAFB;
      /* Latar belakang utama yang sangat terang */
      --bg-alt-color: #FFFFFF;
      /* Latar belakang alternatif (mis. kartu) */
      --border-color: #E5E7EB;
      --success-color: #10B981;
      --warning-color: #FBBF24;
      --danger-color: #EF4444;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --radius-sm: 0.25rem;
      /* 4px */
      --radius-md: 0.375rem;
      /* 6px */
      --radius-lg: 0.5rem;
      /* 8px */
      --spacing-xs: 0.25rem;
      --spacing-sm: 0.5rem;
      --spacing-md: 1rem;
      --spacing-lg: 1.5rem;
      --spacing-xl: 2rem;
      --sidebar-width: 260px;
      --header-height: 60px;
      /* Jika ada header terpisah */
      --transition-duration: 0.2s;
      --transition-timing-function: ease-in-out;
      --font-family-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: var(--font-family-sans);
      color: var(--text-color);
      background-color: var(--bg-color);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      overflow-x: hidden;
      /* Mencegah scroll horizontal yang tidak diinginkan */
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Tipografi Hirarkis */
    h1,
    .h1 {
      font-size: 2.25rem;
      line-height: 2.5rem;
      font-weight: 700;
      margin-bottom: var(--spacing-lg);
    }

    h2,
    .h2 {
      font-size: 1.875rem;
      line-height: 2.25rem;
      font-weight: 600;
      margin-bottom: var(--spacing-md);
    }

    h3,
    .h3 {
      font-size: 1.5rem;
      line-height: 2rem;
      font-weight: 600;
      margin-bottom: var(--spacing-md);
    }

    h4,
    .h4 {
      font-size: 1.25rem;
      line-height: 1.75rem;
      font-weight: 600;
      margin-bottom: var(--spacing-sm);
    }

    p {
      margin-bottom: var(--spacing-md);
    }

    a {
      text-decoration: none;
      color: var(--primary-color);
      transition: color var(--transition-duration) var(--transition-timing-function);
    }

    a:hover {
      color: var(--primary-hover-color);
    }

    button,
    input,
    select,
    textarea {
      font-family: inherit;
      font-size: 1rem;
      outline: none;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: var(--spacing-sm) var(--spacing-md);
      transition: border-color var(--transition-duration) var(--transition-timing-function), box-shadow var(--transition-duration) var(--transition-timing-function);
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px var(--primary-light-color);
    }

    /* Utilitas Umum */
    .container {
      max-width: 1280px;
      margin-left: auto;
      margin-right: auto;
      padding-left: var(--spacing-md);
      padding-right: var(--spacing-md);
    }

    .hidden {
      display: none !important;
    }

    .text-sm {
      font-size: 0.875rem;
    }

    .text-light {
      color: var(--text-light-color);
    }

    .text-bold {
      font-weight: 600;
    }

    .text-center {
      text-align: center;
    }

    .text-primary {
      color: var(--primary-color);
    }

    .mt-sm {
      margin-top: var(--spacing-sm);
    }

    .mt-md {
      margin-top: var(--spacing-md);
    }

    .mt-lg {
      margin-top: var(--spacing-lg);
    }

    .mb-sm {
      margin-bottom: var(--spacing-sm);
    }

    .mb-md {
      margin-bottom: var(--spacing-md);
    }

    .mb-lg {
      margin-bottom: var(--spacing-lg);
    }

    .d-flex {
      display: flex;
    }

    .align-center {
      align-items: center;
    }

    .justify-between {
      justify-content: space-between;
    }

    .justify-center {
      justify-content: center;
    }

    .gap-sm {
      gap: var(--spacing-sm);
    }

    .gap-md {
      gap: var(--spacing-md);
    }

    .gap-lg {
      gap: var(--spacing-lg);
    }

    .w-full {
      width: 100%;
    }

    .cursor-pointer {
      cursor: pointer;
    }

    /* Feather Icons */
    .feather {
      width: 1.25em;
      /* Relatif terhadap font size induk */
      height: 1.25em;
      stroke: currentColor;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
      fill: none;
      vertical-align: middle;
    }

    .feather-sm {
      width: 1em;
      height: 1em;
    }

    .feather-lg {
      width: 1.5em;
      height: 1.5em;
    }

    /* Tata Letak Utama */
    .sidebar {
      width: var(--sidebar-width);
      background-color: var(--bg-alt-color);
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      box-shadow: var(--shadow-md);
      padding: var(--spacing-lg) var(--spacing-md);
      display: flex;
      flex-direction: column;
      z-index: 1000;
      transition: transform var(--transition-duration) var(--transition-timing-function);
    }

    .app-title {
      font-size: 1.75rem;
      /* Sedikit lebih kecil untuk sidebar */
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: var(--spacing-xl);
      padding-left: var(--spacing-sm);
      /* Sejajar dengan ikon nav */
    }

    .main-content-wrapper {
      flex: 1;
      margin-left: var(--sidebar-width);
      padding: var(--spacing-lg);
      transition: margin-left var(--transition-duration) var(--transition-timing-function);
      overflow-y: auto;
      /* Memastikan konten bisa di-scroll jika melebihi viewport */
      max-width: calc(100vw - var(--sidebar-width));
      /* Untuk mencegah pergeseran saat scrollbar muncul */
    }

    /* Navigasi Sidebar */
    .nav-menu {
      list-style: none;
      margin-top: var(--spacing-lg);
      flex-grow: 1;
      /* Membuat menu mengambil sisa ruang */
    }

    .nav-item {
      display: flex;
      align-items: center;
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      margin-bottom: var(--spacing-sm);
      color: var(--text-light-color);
      font-weight: 500;
      transition: background-color var(--transition-duration) var(--transition-timing-function), color var(--transition-duration) var(--transition-timing-function);
    }

    .nav-item:hover {
      background-color: var(--primary-light-color);
      color: var(--primary-color);
    }

    .nav-item.active {
      background-color: var(--primary-color);
      color: var(--bg-alt-color);
      font-weight: 600;
    }

    .nav-item .feather {
      margin-right: var(--spacing-md);
    }

    /* Profil Pengguna Sidebar */
    .user-profile {
      margin-top: auto;
      /* Mendorong ke bawah */
      display: flex;
      align-items: center;
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      background-color: var(--bg-color);
      /* Sedikit beda dari sidebar */
    }

    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--bg-alt-color);
      font-weight: 600;
      font-size: 1.125rem;
      margin-right: var(--spacing-md);
    }

    /* Tombol Hamburger (Mobile) */
    .hamburger-menu {
      display: none;
      /* Sembunyi di desktop */
      position: fixed;
      top: var(--spacing-md);
      left: var(--spacing-md);
      z-index: 1100;
      /* Di atas sidebar */
      background-color: var(--bg-alt-color);
      border: 1px solid var(--border-color);
      width: 44px;
      height: 44px;
      border-radius: 50%;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-sm);
      cursor: pointer;
    }

    /* Bagian Konten Utama */
    .page-header {
      margin-bottom: var(--spacing-lg);
      border-bottom: 1px solid var(--border-color);
      padding-bottom: var(--spacing-md);
    }

    .page-title {
      /* Untuk judul di setiap "halaman" */
      font-size: 1.875rem;
      font-weight: 700;
    }

    /* Komponen: Kartu */
    .card {
      background-color: var(--bg-alt-color);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
      transition: transform var(--transition-duration) var(--transition-timing-function), box-shadow var(--transition-duration) var(--transition-timing-function);
      display: flex;
      flex-direction: column;
      /* Agar footer tetap di bawah */
    }

    .card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-4px);
    }

    .card-img {
      height: 200px;
      width: 100%;
      object-fit: cover;
    }

    .card-content {
      padding: var(--spacing-md);
      flex-grow: 1;
      /* Konten mengisi ruang */
    }

    .card-title {
      font-size: 1.25rem;
      margin-bottom: var(--spacing-xs);
    }

    .card-info {
      display: flex;
      flex-wrap: wrap;
      /* Agar item bisa wrap di layar kecil */
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-sm);
      font-size: 0.875rem;
      color: var(--text-light-color);
    }

    .card-info-item {
      display: flex;
      align-items: center;
    }

    .card-info-item .feather {
      margin-right: var(--spacing-xs);
      width: 1em;
      height: 1em;
    }

    .card-price {
      color: var(--primary-color);
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: var(--spacing-md);
    }

    .card-actions {
      display: flex;
      justify-content: space-between;
      gap: var(--spacing-sm);
      padding: 0 var(--spacing-md) var(--spacing-md);
      /* Padding dipindah ke sini dari content */
    }

    /* Komponen: Tombol */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-md);
      padding: var(--spacing-sm) var(--spacing-lg);
      font-weight: 500;
      transition: background-color var(--transition-duration) var(--transition-timing-function), color var(--transition-duration) var(--transition-timing-function), border-color var(--transition-duration) var(--transition-timing-function);
      border: 1px solid transparent;
      cursor: pointer;
      white-space: nowrap;
      /* Mencegah teks tombol wrap */
    }

    .btn .feather {
      margin-right: var(--spacing-sm);
    }

    .btn-primary {
      background-color: var(--primary-color);
      color: var(--bg-alt-color);
    }

    .btn-primary:hover {
      background-color: var(--primary-hover-color);
    }

    .btn-outline {
      border-color: var(--primary-color);
      color: var(--primary-color);
      background-color: transparent;
    }

    .btn-outline:hover {
      background-color: var(--primary-light-color);
    }

    .btn-secondary {
      background-color: var(--secondary-color);
      color: var(--bg-alt-color);
    }

    .btn-secondary:hover {
      background-color: #D97706;
      /* Darker yellow */
    }

    .btn-sm {
      padding: var(--spacing-xs) var(--spacing-sm);
      font-size: 0.875rem;
    }

    /* Komponen: Grid Kartu */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
    }

    /* Komponen: Tabs */
    .tabs {
      display: flex;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
      border-bottom: 1px solid var(--border-color);
    }

    .tab {
      padding: var(--spacing-sm) 0 var(--spacing-md);
      /* Lebih banyak padding bawah untuk garis aktif */
      cursor: pointer;
      position: relative;
      font-weight: 500;
      color: var(--text-light-color);
      transition: color var(--transition-duration) var(--transition-timing-function);
    }

    .tab:hover {
      color: var(--primary-color);
    }

    .tab.active {
      color: var(--primary-color);
      font-weight: 600;
    }

    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      /* Agar menyatu dengan border-bottom tabs */
      left: 0;
      width: 100%;
      height: 2px;
      background-color: var(--primary-color);
    }

    /* Komponen: Kotak Pencarian & Filter */
    .search-filter-box {
      background-color: var(--bg-alt-color);
      padding: var(--spacing-lg);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      margin-bottom: var(--spacing-xl);
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      /* Responsif */
      gap: var(--spacing-md);
      align-items: flex-end;
      /* Agar tombol sejajar dengan input field terakhir */
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-label {
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: var(--spacing-xs);
      color: var(--text-light-color);
    }

    .input-group {
      display: flex;
      align-items: center;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding-left: var(--spacing-sm);
    }

    .input-group:focus-within {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px var(--primary-light-color);
    }

    .input-group .feather {
      color: var(--text-light-color);
      margin-right: var(--spacing-sm);
    }

    .input-group input,
    .input-group select {
      border: none;
      padding: var(--spacing-sm);
      /* Padding diatur di sini, bukan di input global */
      width: 100%;
      background: transparent;
    }

    .search-filter-box .btn {
      height: calc(2 * var(--spacing-sm) + 1rem + 2px);
      /* Sesuaikan tinggi tombol */
    }

    /* Komponen: Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      /* Lebih gelap sedikit */
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition-duration) var(--transition-timing-function), visibility 0s var(--transition-duration);
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
      transition-delay: 0s;
    }

    .modal-content {
      background-color: var(--bg-alt-color);
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 700px;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      box-shadow: var(--shadow-lg);
      transform: scale(0.95);
      transition: transform var(--transition-duration) var(--transition-timing-function);
    }

    .modal-overlay.active .modal-content {
      transform: scale(1);
    }

    .modal-header {
      padding: var(--spacing-md) var(--spacing-lg);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .modal-close-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--text-light-color);
      cursor: pointer;
      padding: var(--spacing-xs);
      /* Area klik lebih besar */
    }

    .modal-close-btn:hover {
      color: var(--text-color);
    }

    .modal-body {
      padding: var(--spacing-lg);
      overflow-y: auto;
      /* Konten modal bisa di-scroll */
      flex-grow: 1;
    }

    .modal-footer {
      padding: var(--spacing-md) var(--spacing-lg);
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: flex-end;
      gap: var(--spacing-md);
      background-color: var(--bg-color);
      /* Footer modal dengan bg sedikit beda */
      border-bottom-left-radius: var(--radius-lg);
      border-bottom-right-radius: var(--radius-lg);
    }

    /* Detail Properti dalam Modal */
    .property-gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-lg);
    }

    .gallery-img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: var(--radius-md);
      cursor: pointer;
      /* Indikasi bisa diklik untuk zoom (fitur masa depan) */
    }

    .property-main-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
    }

    .property-info-block {
      background-color: var(--bg-color);
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      text-align: center;
    }

    .property-info-value {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: var(--spacing-xs);
    }

    .property-info-label {
      font-size: 0.875rem;
      color: var(--text-light-color);
    }

    .property-facilities-list {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-md);
    }

    .facility-tag {
      background-color: var(--primary-light-color);
      color: var(--primary-color);
      padding: var(--spacing-xs) var(--spacing-sm);
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
    }

    /* Komponen: Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: var(--spacing-sm);
      margin-top: var(--spacing-xl);
      padding-bottom: var(--spacing-lg);
      /* Jarak ke footer */
    }

    .page-item {
      min-width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-color);
      cursor: pointer;
      transition: background-color var(--transition-duration) var(--transition-timing-function), color var(--transition-duration) var(--transition-timing-function), border-color var(--transition-duration) var(--transition-timing-function);
      padding: 0 var(--spacing-sm);
      font-size: 0.875rem;
    }

    .page-item:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    .page-item.active {
      background-color: var(--primary-color);
      color: var(--bg-alt-color);
      border-color: var(--primary-color);
      font-weight: 600;
    }

    .page-item.disabled {
      color: var(--text-light-color);
      cursor: not-allowed;
      opacity: 0.6;
    }

    .page-item.disabled:hover {
      border-color: var(--border-color);
      color: var(--text-light-color);
    }

    /* Komponen: Toast Notification */
    .toast-container {
      position: fixed;
      top: var(--spacing-lg);
      right: var(--spacing-lg);
      z-index: 3000;
      /* Di atas segalanya */
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
    }

    .toast {
      background-color: var(--bg-alt-color);
      border-radius: var(--radius-md);
      padding: var(--spacing-md);
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: flex-start;
      /* Agar ikon sejajar dengan baris pertama teks */
      min-width: 320px;
      max-width: 400px;
      opacity: 0;
      transform: translateX(100%);
      transition: opacity var(--transition-duration) var(--transition-timing-function), transform var(--transition-duration) var(--transition-timing-function);
    }

    .toast.show {
      opacity: 1;
      transform: translateX(0);
    }

    .toast.hide {
      /* Untuk animasi keluar */
      opacity: 0;
      transform: translateX(100%);
    }

    .toast-icon {
      margin-right: var(--spacing-md);
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    .toast-success .toast-icon {
      color: var(--success-color);
    }

    .toast-warning .toast-icon {
      color: var(--warning-color);
    }

    .toast-error .toast-icon {
      color: var(--danger-color);
    }

    .toast-info .toast-icon {
      color: var(--primary-color);
    }

    .toast-content {
      flex-grow: 1;
    }

    .toast-title {
      font-weight: 600;
      margin-bottom: var(--spacing-xs);
    }

    .toast-message {
      font-size: 0.875rem;
      color: var(--text-light-color);
    }

    .toast-close-btn {
      background: none;
      border: none;
      color: var(--text-light-color);
      cursor: pointer;
      margin-left: var(--spacing-md);
      padding: 0;
      /* Reset padding */
      font-size: 1.25rem;
      line-height: 1;
      /* Sejajarkan dengan teks */
    }

    .toast-close-btn:hover {
      color: var(--text-color);
    }

    /* Komponen: Placeholder Konten Kosong */
    .empty-state {
      text-align: center;
      padding: var(--spacing-xl) var(--spacing-md);
      border: 2px dashed var(--border-color);
      border-radius: var(--radius-lg);
      background-color: var(--bg-alt-color);
    }

    .empty-state-icon {
      font-size: 3rem;
      color: var(--text-light-color);
      margin-bottom: var(--spacing-md);
    }

    .empty-state-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: var(--spacing-sm);
    }

    .empty-state-message {
      color: var(--text-light-color);
    }


    /* Loading Spinner */
    .loading-spinner-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid var(--primary-light-color);
      border-top: 5px solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Responsif */
    @media (max-width: 992px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.active {
        transform: translateX(0);
        box-shadow: var(--shadow-lg);
        /* Bayangan lebih jelas saat overlay */
      }

      .main-content-wrapper {
        margin-left: 0;
        max-width: 100%;
      }

      .hamburger-menu {
        display: flex;
        /* Tampilkan di mobile */
      }

      .search-filter-box {
        grid-template-columns: 1fr;
        /* Kolom tunggal di mobile */
      }

      .search-filter-box .btn {
        width: 100%;
      }

      /* Tombol pencarian full width */
      .property-main-info {
        grid-template-columns: 1fr 1fr;
        /* 2 kolom di tablet */
      }
    }

    @media (max-width: 768px) {
      :root {
        /* Ukuran font dasar lebih kecil di mobile */
        font-size: 14px;
      }

      .cards-grid {
        grid-template-columns: 1fr;
        /* Kartu tunggal di mobile */
      }

      .property-gallery {
        grid-template-columns: 1fr 1fr;
        /* 2 gambar per baris di galeri */
      }

      .modal-content {
        max-width: 95%;
        max-height: 95vh;
      }

      .toast-container {
        right: var(--spacing-md);
        left: var(--spacing-md);
        top: var(--spacing-md);
        width: auto;
      }

      .toast {
        min-width: auto;
        width: 100%;
      }
    }

    @media (max-width: 576px) {
      .card-actions {
        flex-direction: column;
      }

      .card-actions .btn {
        width: 100%;
      }

      .property-main-info {
        grid-template-columns: 1fr;
        /* 1 kolom di mobile kecil */
      }

      .modal-footer {
        flex-direction: column-reverse;
        /* Tombol bertumpuk, primary di atas */
      }

      .modal-footer .btn {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <a href="#beranda" class="app-title-link">
      <h1 class="app-title">Green Valley</h1>
    </a>

    <nav>
      <ul class="nav-menu" id="navMenu">
        <li class="nav-item" data-route="beranda">
          <svg class="feather" viewBox="0 0 24 24">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
          <span>Beranda</span>
        </li>
        <li class="nav-item" data-route="favorit">
          <svg class="feather" viewBox="0 0 24 24">
            <path
              d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
            </path>
          </svg>
          <span>Favorit</span>
        </li>
        <li class="nav-item" data-route="pesanan">
          <svg class="feather" viewBox="0 0 24 24">
            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <path d="M16 10a4 4 0 0 1-8 0"></path>
          </svg>
          <span>Pesanan</span>
        </li>
        <li class="nav-item" data-route="akun">
          <svg class="feather" viewBox="0 0 24 24">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          <span>Akun</span>
        </li>
      </ul>
    </nav>

    <div class="user-profile">
      <div class="avatar">D</div>
      <div>
        <div class="text-bold">Halo, Dinda</div>
        <div class="text-sm text-light">Penyewa Aktif</div>
      </div>
    </div>
  </aside>

  <!-- Tombol Hamburger Mobile -->
  <button class="hamburger-menu" id="hamburgerMenu" aria-label="Buka menu navigasi" aria-expanded="false"
    aria-controls="sidebar">
    <svg class="feather" id="hamburgerIconOpen" viewBox="0 0 24 24">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
    <svg class="feather hidden" id="hamburgerIconClose" viewBox="0 0 24 24">
      <line x1="18" y1="6" x2="6" y2="18"></line>
      <line x1="6" y1="6" x2="18" y2="18"></line>
    </svg>
  </button>

  <!-- Wrapper Konten Utama (untuk SPA) -->
  <main class="main-content-wrapper">
    <div class="container" id="appRoot">
      <!-- Konten SPA akan dirender di sini -->
    </div>
  </main>

  <!-- Template untuk Modal Detail Apartemen -->
  <div class="modal-overlay" id="detailModal">
    <div class="modal-content" role="dialog" aria-labelledby="modalTitle" aria-modal="true">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">Detail Apartemen</h3>
        <button class="modal-close-btn" id="closeModalBtn" aria-label="Tutup modal">
          <svg class="feather" viewBox="0 0 24 24">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body" id="modalBody">
        <!-- Konten detail akan di-generate oleh JavaScript -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" id="modalFavoriteBtn">
          <svg class="feather feather-sm" viewBox="0 0 24 24">
            <path
              d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
            </path>
          </svg>
          <span>Favoritkan</span>
        </button>
        <button class="btn btn-primary" id="modalBookBtn">
          <svg class="feather feather-sm" viewBox="0 0 24 24">
            <polyline points="9 11 12 14 22 4"></polyline>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
          </svg>
          Pesan Sekarang
        </button>
      </div>
    </div>
  </div>

  <!-- Kontainer untuk Toast Notification -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Loading Spinner -->
  <div class="loading-spinner-overlay hidden" id="loadingOverlay">
    <div class="loading-spinner"></div>
  </div>

  <script>
    // Namespace Aplikasi untuk menghindari polusi global
    const Green ValleyApp = (() => {
      // STATE APLIKASI (Layer State)
      const state = {
        apartments: [], // Data asli dari "API"
        filteredApartments: [], // Data yang ditampilkan setelah filter/pencarian
        favorites: JSON.parse(localStorage.getItem('Green ValleyFavorites')) || [], // Favorit disimpan di localStorage
        currentPage: 1,
        itemsPerPage: 6, // Jumlah apartemen per halaman
        currentRoute: 'beranda', // Rute default
        curGreen ValleymentDetail: null, // Untuk modal
        isLoading: false,
        filters: {
          location: '',
          maxPrice: '',
          type: '',
          category: 'all' // Untuk tab kategori: all, studio, 1br, 2br
        }
      };

      // DATA CONTOH (Layer Data/Model)
      // Di aplikasi nyata, ini akan diambil dari API
      const apartmentsData = [
        { id: 1, name: "Apartemen Sudirman Park View", location: "Jakarta Pusat", type: "studio", price: 4500000, image: "https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8YXBhcnRtZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=500&q=60", description: "Studio modern di pusat kota dengan pemandangan menakjubkan. Akses mudah ke transportasi dan mall.", facilities: ["AC", "WiFi Cepat", "TV Kabel", "Dapur Lengkap", "Kamar Mandi Dalam", "Keamanan 24 Jam"], ratings: 4.8, reviews: 152, gallery: ["https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8YXBhcnRtZW50JTIwaW50ZXJpb3J8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=400&q=60", "https://images.unsplash.com/photo-1616594039964-ae9021a400a0?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NXx8YXBhcnRtZW50JTIwa2l0Y2hlbnxlbnwwfHwwfHx8MA%3D&auto=format&fit=crop&w=400&q=60", "https://images.unsplash.com/photo-1600607686527-6fb886090705?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTB8fGFwYXJ0bWVudCUyMGJhdGhyb29tfGVufDB8fDB8fHww&auto=format&fit=crop&w=400&q=60"] },
        { id: 2, name: "Green Pramuka City Residence", location: "Jakarta Timur", type: "2br", price: 6200000, image: "https://images.unsplash.com/photo-1493809842364-78817add7ffb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8YXBhcnRtZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=500&q=60", description: "Apartemen keluarga 2 kamar tidur, fasilitas lengkap termasuk kolam renang dan area bermain anak.", facilities: ["AC", "WiFi", "TV", "Dapur", "2 Kamar Mandi", "Balkon", "Kolam Renang", "Gym"], ratings: 4.5, reviews: 98, gallery: ["https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTJ8fGFwYXJ0bWVudCUyMGludGVyaW9yfGVufDB8fDB8fHww&auto=format&fit=crop&w=400&q=60", "https://images.unsplash.com/photo-1580092842648-5567595919c6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8YXBhcnRtZW50JTIwYmVkcm9vbXxlbnwwfHwwfHx8MA%3D&auto=format&fit=crop&w=400&q=60", "https://images.unsplash.com/photo-1617104665041-9f71589f4017?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTF8fGFwYXJ0bWVudCUyMGJhbGNvbnl8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=400&q=60"] },
        { id: 3, name: "Bassura City Tower Cattleya", location: "Jakarta Timur", type: "1br", price: 5000000, image: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTV8fGFwYXJ0bWVudHxlbnwwfHwwfHx8MA&auto=format&fit=crop&w=500&q=60", description: "Apartemen 1BR nyaman dengan akses langsung ke mall. Pilihan ideal untuk profesional muda.", facilities: ["AC", "WiFi", "TV", "Dapur", "Kamar Mandi", "Kolam Renang", "Parkir"], ratings: 4.2, reviews: 75, gallery: ["https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8OXx8YXBhcnRtZW50JTIwaW50ZXJpb3J8GVufDB8fDB8fHww&auto=format&fit=crop&w=400&q=60", "https://images.unsplash.com/photo-1556020685-ae41abfc9365?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTd8fGFwYXJ0bWVudCUyMGtpdGNoZW58ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=400&q=60", "https://images.unsplash.com/photo-1523755231516-e43fd2e8dca5?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8YXBhcnRtZW50JTIwbGl2aW5nJTIwcm9vbXxlbnwwfHwwfHx8MA%3D&auto=format&fit=crop&w=400&q=60"] },
        { id: 4, name: "Kalibata City Residences", location: "Jakarta Selatan", type: "studio", price: 3800000, image: "https://images.unsplash.com/photo-1628592102751-ba83b0314276?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTR8fGFwYXJ0bWVudCUyMHN0dWRpb3xlbnwwfHwwfHx8MA&auto=format&fit=crop&w=500&q=60", description: "Studio terjangkau, fully furnished, cocok untuk mahasiswa atau karyawan. Fasilitas publik lengkap.", facilities: ["AC", "WiFi", "Dapur Mini", "Kamar Mandi", "Akses Kartu"], ratings: 3.9, reviews: 210, gallery: ["https://images.unsplash.com/photo-1598928506311-c55ded91a20c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8c3R1ZGlvJTIwYXBhcnRtZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=400&q=60", "https://images.unsplash.com/photo-1604709177595-dd2db2112b4a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8N3x8c21hbGwlMjBraXRjaGVufGVufDB8fDB8fHww&auto=format&fit=crop&w=400&q=60", "https://images.unsplash.com/photo-1616046229478-9901c5536a45?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8c21hbGwlMjBiZWRyb29tfGVufDB8fDB8fHww&auto=format&fit=crop&w=400&q=60"] },
        { id: 5, name: "Taman Anggrek Residences Sky Tower", location: "Jakarta Barat", type: "2br", price: 8500000, image: "https://images.unsplash.com/photo-1505691938895-1758d7feb511?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MjB8fGx1eHVyeSUyMGFwYXJ0bWVudHxlbnwwfHwwfHx8MA&auto=format&fit=crop&w=500&q=60", description: "Apartemen mewah 2BR dengan skybridge ke Mall Taman Anggrek. Fasilitas bintang lima.", facilities: ["AC Sentral", "Smart WiFi", "TV Besar", "Dapur Modern", "2 Kamar Mandi Mewah", "Balkon Luas", "Kolam Infinity", "Sky Lounge", "Gym & Spa"], ratings: 4.9, reviews: 88, gallery: ["https://images.unsplash.com/photo-1611094362020-57747dd7418a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8bHV4dXJ5JTIwYXBhcnRtZW50JTIwaW50ZXJpb3J8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=400&q=60", "https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8OHx8bHV4dXJ5JTIwYXBhcnRtZW50JTIwa2l0Y2hlbnxlbnwwfHwwfHx8MA%3D&auto=format&fit=crop&w=400&q=60", "https://images.unsplash.com/photo-1588794279108-3489f06697f7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8bHV4dXJ5JTIwYXBhcnRtZW50JTIwcG9vbHxlbnwwfHwwfHx8MA%3D&auto=format&fit=crop&w=400&q=60"] },
        { id: 6, name: "Menteng Park Exclusive", location: "Jakarta Pusat", type: "1br", price: 6700000, image: "https://images.unsplash.com/photo-1540518614846-7eded433c457?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MjV8fGFwYXJ0bWVudHxlbnwwfHwwfHx8MA&auto=format&fit=crop&w=500&q=60", description: "Eksklusif 1BR di jantung Menteng. Desain interior elegan, pemandangan kota yang indah.", facilities: ["AC", "High-Speed WiFi", "Smart TV", "Dapur", "Kamar Mandi", "Balkon Pribadi", "Rooftop Gym"], ratings: 4.6, reviews: 65, gallery: ["https://images.unsplash.com/photo-1567767292278-a4f21aa2d36e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8YXBhcnRtZW50JTIwaW50ZXJpb3J8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=400&q=60", "https://images.unsplash.com/photo-1551215717-8bc9265a9f1b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8N3x8YXBhcnRtZW50JTIwYmVkcm9vbXxlbnwwfHwwfHx8MA%3D&auto=format&fit=crop&w=400&q=60", "https://images.unsplash.com/photo-1599696848676-6400b1080c83?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8YXBhcnRtZW50JTIwdmlld3xlbnwwfHwwfHx8MA%3D&auto=format&fit=crop&w=400&q=60"] },
        { id: 7, name: "Podomoro Golf View Cimanggis", location: "Depok", type: "studio", price: 2800000, image: "https://images.unsplash.com/photo-1594497243830-247a176229d4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8Y2hlYXAlMjBhcGFydG1lbnR8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=500&q=60", description: "Studio baru dengan pemandangan golf. Udara sejuk, dekat dengan akses tol.", facilities: ["AC", "Dapur Mini", "Kamar Mandi", "Shuttle Bus", "Area Hijau"], ratings: 4.0, reviews: 120, gallery: ["https://images.unsplash.com/photo-1579725942955-4d836c880f53?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8OXx8c2ltcGxlJTIwYXBhcnRtZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=400&q=60", "https://images.unsplash.com/photo-1501183638710-841dd1904471?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8Z29sZiUyMGNvdXJzZSUyMHZpZXd8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=400&q=60", "https://images.unsplash.com/photo-1612329984537-073541089157?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8c21hbGwlMjBhcGFydG1lbnQlMjBiYXRocm9vbXxlbnwwfHwwfHx8MA%3D&auto=format&fit=crop&w=400&q=60"] },
        { id: 8, name: "Kemang Village Cosmopolitan", location: "Jakarta Selatan", type: "3br", price: 15000000, image: "https://images.unsplash.com/photo-1555854877-bab0950495a1?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTF8fGxhcmdlJTIwYXBhcnRtZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=500&q=60", description: "Apartemen 3BR luas di area premium Kemang. Cocok untuk keluarga ekspatriat, dekat sekolah internasional.", facilities: ["AC", "WiFi", "Dapur Gourmet", "3 Kamar Mandi", "Private Lift", "Kolam Renang", "Tennis Court", "Kids Playground"], ratings: 4.7, reviews: 55, gallery: ["https://images.unsplash.com/photo-1560185893-a55180864452?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8bGFyZ2UlMjBhcGFydG1lbnQlMjBpbnRlcmlvcnxlbnwwfHwwfHx8MA%3D&auto=format&fit=crop&w=400&q=60", "https://images.unsplash.com/photo-1600585152915-d208bec867a1?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8N3x8bGFyZ2UlMjBhcGFydG1lbnQlMjBraXRjaGVufGVufDB8fDB8fHww&auto=format&fit=crop&w=400&q=60", "https://images.unsplash.com/photo-1600566753201-8512a8a454c7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8N3x8bGFyZ2UlMjBhcGFydG1lbnQlMjBiZWRyb29tfGVufDB8fDB8fHww&auto=format&fit=crop&w=400&q=60"] },
      ];

      // DOM Elements Cache (Layer View - Selektor)
      const DOMElements = {
        appRoot: document.getElementById('appRoot'),
        sidebar: document.getElementById('sidebar'),
        navMenu: document.getElementById('navMenu'),
        hamburgerMenu: document.getElementById('hamburgerMenu'),
        hamburgerIconOpen: document.getElementById('hamburgerIconOpen'),
        hamburgerIconClose: document.getElementById('hamburgerIconClose'),
        detailModal: document.getElementById('detailModal'),
        modalTitle: document.getElementById('modalTitle'),
        modalBody: document.getElementById('modalBody'),
        closeModalBtn: document.getElementById('closeModalBtn'),
        modalFavoriteBtn: document.getElementById('modalFavoriteBtn'),
        modalBookBtn: document.getElementById('modalBookBtn'),
        toastContainer: document.getElementById('toastContainer'),
        loadingOverlay: document.getElementById('loadingOverlay'),
      };

      // UTILITIES (Layer Utilitas)
      const Utils = {
        formatPrice: (price) => `Rp${price.toLocaleString('id-ID')}`,
        formatType: (type) => {
          const types = { studio: 'Studio', '1br': '1 Kamar Tidur', '2br': '2 Kamar Tidur', '3br': '3+ Kamar Tidur' };
          return types[type] || type;
        },
        showLoading: () => {
          state.isLoading = true;
          DOMElements.loadingOverlay.classList.remove('hidden');
        },
        hideLoading: () => {
          state.isLoading = false;
          DOMElements.loadingOverlay.classList.add('hidden');
        },
        createToast: (title, message, type = 'info', duration = 3000) => {
          const toastId = `toast-${Date.now()}`;
          const toast = document.createElement('div');
          toast.className = `toast toast-${type}`;
          toast.id = toastId;
          toast.setAttribute('role', 'alert');
          toast.setAttribute('aria-live', 'assertive');

          let iconSvg;
          switch (type) {
            case 'success': iconSvg = '<svg class="feather toast-icon" viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>'; break;
            case 'warning': iconSvg = '<svg class="feather toast-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>'; break;
            case 'error': iconSvg = '<svg class="feather toast-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>'; break;
            default: iconSvg = '<svg class="feather toast-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>';
          }

          toast.innerHTML = `
            ${iconSvg}
            <div class="toast-content">
              <div class="toast-title">${title}</div>
              <p class="toast-message">${message}</p>
            </div>
            <button class="toast-close-btn" aria-label="Tutup notifikasi">
              <svg class="feather feather-sm" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
          `;
          DOMElements.toastContainer.appendChild(toast);

          requestAnimationFrame(() => { // Memastikan transisi berjalan
            toast.classList.add('show');
          });

          const closeBtn = toast.querySelector('.toast-close-btn');
          const removeToast = () => {
            toast.classList.remove('show');
            toast.classList.add('hide'); // Animasi keluar
            toast.addEventListener('transitionend', () => {
              if (toast.parentElement) { // Cek jika elemen masih ada di DOM
                DOMElements.toastContainer.removeChild(toast);
              }
            }, { once: true });
          };

          closeBtn.addEventListener('click', removeToast);
          setTimeout(removeToast, duration);
        },
        debounce: (func, delay) => {
          let timeout;
          return function (...args) {
            const context = this;
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(context, args), delay);
          };
        }
      };

      // LOGIC APLIKASI (Layer Controller/Logic)
      const AppLogic = {
        fetchApartments: () => {
          // Simulasi pengambilan data dari API
          Utils.showLoading();
          return new Promise((resolve) => {
            setTimeout(() => {
              state.apartments = apartmentsData.map(apt => ({ ...apt, isFavorite: state.favorites.includes(apt.id) }));
              AppLogic.applyFiltersAndSearch(); // Langsung filter setelah fetch
              Utils.hideLoading();
              resolve(state.filteredApartments);
            }, 500); // Simulasi delay API
          });
        },
        applyFiltersAndSearch: () => {
          let results = [...state.apartments];
          const { location, maxPrice, type, category } = state.filters;

          if (category !== 'all') {
            results = results.filter(apt => apt.type.toLowerCase() === category.toLowerCase());
          }
          if (location) {
            results = results.filter(apt => apt.location.toLowerCase().includes(location.toLowerCase()));
          }
          if (maxPrice) {
            const priceNum = parseFloat(String(maxPrice).replace(/\./g, ''));
            if (!isNaN(priceNum)) {
              results = results.filter(apt => apt.price <= priceNum);
            }
          }
          if (type) { // Filter dari input Tipe
            results = results.filter(apt =>
              apt.type.toLowerCase().includes(type.toLowerCase()) ||
              Utils.formatType(apt.type).toLowerCase().includes(type.toLowerCase())
            );
          }
          state.filteredApartments = results;
          state.currentPage = 1; // Reset ke halaman pertama setiap filter berubah
          // Tidak memanggil render di sini, biarkan View yang memutuskan kapan render
        },
        toggleFavorite: (apartmentId) => {
          const aptIndexInFavorites = state.favorites.indexOf(apartmentId);
          const aptInAll = state.apartments.find(apt => apt.id === apartmentId);
          const aptInFiltered = state.filteredApartments.find(apt => apt.id === apartmentId);

          if (aptIndexInFavorites === -1) {
            state.favorites.push(apartmentId);
            if (aptInAll) aptInAll.isFavorite = true;
            if (aptInFiltered) aptInFiltered.isFavorite = true;
            Utils.createToast('Favorit', `${aptInAll ? aptInAll.name : 'Apartemen'} ditambahkan ke favorit.`, 'success');
          } else {
            state.favorites.splice(aptIndexInFavorites, 1);
            if (aptInAll) aptInAll.isFavorite = false;
            if (aptInFiltered) aptInFiltered.isFavorite = false;
            Utils.createToast('Favorit', `${aptInAll ? aptInAll.name : 'Apartemen'} dihapus dari favorit.`, 'info');
          }
          localStorage.setItem('Green ValleyFavorites', JSON.stringify(state.favorites));

          // Update UI jika modal terbuka atau halaman favorit aktif
          if (DOMElements.detailModal.classList.contains('active') && state.curGreen ValleymentDetail?.id === apartmentId) {
            View.updateModalFavoriteButton(aptInAll.isFavorite);
          }
          // Re-render halaman favorit jika sedang aktif
          if (state.currentRoute === 'favorit') {
            View.renderCurrentPage();
          }
          // Re-render kartu di halaman Beranda jika ada perubahan favorit
          if (state.currentRoute === 'beranda') {
            const cardElement = document.querySelector(`.card[data-id="${apartmentId}"] .favorite-btn-card`);
            if (cardElement) {
              View.updateCardFavoriteButton(cardElement, aptInAll.isFavorite);
            }
          }
        },
        getApartmentById: (id) => {
          return state.apartments.find(apt => apt.id === id);
        },
        bookApartment: (apartmentId) => {
          const apartment = AppLogic.getApartmentById(apartmentId);
          if (apartment) {
            Utils.createToast('Pemesanan', `Apartemen ${apartment.name} berhasil dipesan! (Simulasi)`, 'success');
            View.closeDetailModal();
          }
        },
        getPaginatedItems: (items) => {
          const startIndex = (state.currentPage - 1) * state.itemsPerPage;
          const endIndex = startIndex + state.itemsPerPage;
          return items.slice(startIndex, endIndex);
        }
      };

      // RENDER LOGIC (Layer View - Renderers)
      const View = {
        renderApartmentCard: (apartment) => {
          const card = document.createElement('article');
          card.className = 'card';
          card.dataset.id = apartment.id;
          card.setAttribute('aria-labelledby', `apt-title-${apartment.id}`);

          const isFavorite = state.favorites.includes(apartment.id);

          card.innerHTML = `
            <img src="${apartment.image}" alt="Tampilan luar ${apartment.name}" class="card-img">
            <div class="card-content">
              <h4 class="card-title" id="apt-title-${apartment.id}">${apartment.name}</h4>
              <div class="card-info">
                <span class="card-info-item">
                  <svg class="feather feather-sm" viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                  ${apartment.location}
                </span>
                <span class="card-info-item">
                  <svg class="feather feather-sm" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                  ${Utils.formatType(apartment.type)}
                </span>
              </div>
              <p class="card-price">${Utils.formatPrice(apartment.price)}<span class="text-sm text-light">/bulan</span></p>
            </div>
            <div class="card-actions">
              <button class="btn btn-outline btn-sm detail-btn" data-id="${apartment.id}" aria-label="Lihat detail ${apartment.name}">Lihat Detail</button>
              <button class="btn btn-sm favorite-btn-card ${isFavorite ? 'btn-primary' : 'btn-outline'}" data-id="${apartment.id}" aria-pressed="${isFavorite}" aria-label="${isFavorite ? 'Hapus dari favorit' : 'Tambah ke favorit'} ${apartment.name}">
                <svg class="feather feather-sm" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                <span>${isFavorite ? 'Difavorit' : 'Favorit'}</span>
              </button>
            </div>
          `;
          card.querySelector('.detail-btn').addEventListener('click', () => View.openDetailModal(apartment.id));
          card.querySelector('.favorite-btn-card').addEventListener('click', (e) => {
            e.stopPropagation();
            AppLogic.toggleFavorite(apartment.id);
            // Tombol akan diupdate oleh AppLogic.toggleFavorite jika diperlukan
          });
          return card;
        },
        updateCardFavoriteButton: (buttonElement, isFavorite) => {
          const span = buttonElement.querySelector('span');
          if (isFavorite) {
            buttonElement.classList.remove('btn-outline');
            buttonElement.classList.add('btn-primary');
            span.textContent = 'Difavorit';
            buttonElement.setAttribute('aria-pressed', 'true');
            buttonElement.setAttribute('aria-label', `Hapus dari favorit ${buttonElement.closest('.card').querySelector('.card-title').textContent}`);
          } else {
            buttonElement.classList.remove('btn-primary');
            buttonElement.classList.add('btn-outline');
            span.textContent = 'Favorit';
            buttonElement.setAttribute('aria-pressed', 'false');
            buttonElement.setAttribute('aria-label', `Tambah ke favorit ${buttonElement.closest('.card').querySelector('.card-title').textContent}`);
          }
        },
        renderApartmentList: (apartmentsToRender) => {
          const listingsContainer = DOMElements.appRoot.querySelector('#apartmentListingsGrid');
          if (!listingsContainer) return;

          listingsContainer.innerHTML = ''; // Bersihkan list lama
          if (apartmentsToRender.length === 0) {
            listingsContainer.innerHTML = `
              <div class="empty-state" style="grid-column: 1 / -1;">
                <svg class="feather empty-state-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"></path></svg>
                <h4 class="empty-state-title">Tidak Ada Apartemen</h4>
                <p class="empty-state-message">Apartemen yang Anda cari tidak ditemukan. Coba ubah filter pencarian Anda.</p>
              </div>
            `;
          } else {
            apartmentsToRender.forEach(apartment => {
              listingsContainer.appendChild(View.renderApartmentCard(apartment));
            });
          }
        },
        renderPagination: (totalItems) => {
          const paginationContainer = DOMElements.appRoot.querySelector('#paginationControls');
          if (!paginationContainer) return;

          paginationContainer.innerHTML = '';
          const totalPages = Math.ceil(totalItems / state.itemsPerPage);

          if (totalPages <= 1) return; // Tidak perlu pagination jika hanya 1 halaman

          // Tombol Sebelumnya
          const prevButton = document.createElement('button');
          prevButton.className = 'page-item';
          prevButton.innerHTML = `<svg class="feather feather-sm" viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"></polyline></svg> Prev`;
          prevButton.disabled = state.currentPage === 1;
          if (prevButton.disabled) prevButton.classList.add('disabled');
          prevButton.addEventListener('click', () => {
            if (state.currentPage > 1) {
              state.currentPage--;
              View.renderCurrentPageContent(); // Render ulang konten halaman Beranda
            }
          });
          paginationContainer.appendChild(prevButton);

          // Nomor Halaman
          // Logika untuk menampilkan nomor halaman (bisa disederhanakan atau dibuat lebih kompleks)
          // Contoh: 1 ... 5 6 7 ... 10
          let pageNumbers = [];
          if (totalPages <= 7) { // tampilkan semua jika kurang dari 7
            for (let i = 1; i <= totalPages; i++) pageNumbers.push(i);
          } else {
            pageNumbers.push(1);
            if (state.currentPage > 3) pageNumbers.push('...');

            let startPage = Math.max(2, state.currentPage - 1);
            let endPage = Math.min(totalPages - 1, state.currentPage + 1);

            if (state.currentPage <= 3) endPage = Math.min(totalPages - 1, 3);
            if (state.currentPage >= totalPages - 2) startPage = Math.max(2, totalPages - 2);


            for (let i = startPage; i <= endPage; i++) pageNumbers.push(i);

            if (state.currentPage < totalPages - 2) pageNumbers.push('...');
            pageNumbers.push(totalPages);
          }

          pageNumbers.forEach(num => {
            const pageButton = document.createElement('button');
            pageButton.className = 'page-item';
            if (num === '...') {
              pageButton.textContent = '...';
              pageButton.disabled = true;
              pageButton.classList.add('disabled');
            } else {
              pageButton.textContent = num;
              if (num === state.currentPage) {
                pageButton.classList.add('active');
              }
              pageButton.addEventListener('click', () => {
                state.currentPage = num;
                View.renderCurrentPageContent();
              });
            }
            paginationContainer.appendChild(pageButton);
          });


          // Tombol Berikutnya
          const nextButton = document.createElement('button');
          nextButton.className = 'page-item';
          nextButton.innerHTML = `Next <svg class="feather feather-sm" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"></polyline></svg>`;
          nextButton.disabled = state.currentPage === totalPages;
          if (nextButton.disabled) nextButton.classList.add('disabled');
          nextButton.addEventListener('click', () => {
            if (state.currentPage < totalPages) {
              state.currentPage++;
              View.renderCurrentPageContent();
            }
          });
          paginationContainer.appendChild(nextButton);
        },

        // PAGE RENDERERS (Dipanggil oleh Router)
        renderBerandaPage: () => {
          DOMElements.appRoot.innerHTML = `
            <header class="page-header">
              <h2 class="page-title">Temukan Apartemen Impian Anda</h2>
            </header>
            
            <section class="search-filter-box" aria-labelledby="search-filter-title">
              <h3 id="search-filter-title" class="hidden">Filter Pencarian</h3>
              <div class="form-group">
                <label for="locationInput" class="form-label">Lokasi</label>
                <div class="input-group">
                  <svg class="feather feather-sm" viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                  <input type="text" id="locationInput" placeholder="cth: Jakarta Pusat" value="${state.filters.location}">
                </div>
              </div>
              <div class="form-group">
                <label for="priceInput" class="form-label">Harga Maks/Bulan</label>
                <div class="input-group">
                  <svg class="feather feather-sm" viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                  <input type="text" id="priceInput" placeholder="cth: 5.000.000" value="${state.filters.maxPrice}">
                </div>
              </div>
              <div class="form-group">
                <label for="typeInput" class="form-label">Tipe Apartemen</label>
                <div class="input-group">
                  <svg class="feather feather-sm" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                  <input type="text" id="typeInput" placeholder="Studio, 2BR, dll" value="${state.filters.type}">
                </div>
              </div>
              <button class="btn btn-primary" id="searchBtn">
                <svg class="feather feather-sm" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                Cari Apartemen
              </button>
            </section>

            <nav class="tabs" id="filterTabs" aria-label="Filter kategori apartemen">
              <button class="tab ${state.filters.category === 'all' ? 'active' : ''}" data-filter="all" role="tab" aria-selected="${state.filters.category === 'all'}">Semua</button>
              <button class="tab ${state.filters.category === 'studio' ? 'active' : ''}" data-filter="studio" role="tab" aria-selected="${state.filters.category === 'studio'}">Studio</button>
              <button class="tab ${state.filters.category === '1br' ? 'active' : ''}" data-filter="1br" role="tab" aria-selected="${state.filters.category === '1br'}">1 Kamar Tidur</button>
              <button class="tab ${state.filters.category === '2br' ? 'active' : ''}" data-filter="2br" role="tab" aria-selected="${state.filters.category === '2br'}">2 Kamar Tidur</button>
              <button class="tab ${state.filters.category === '3br' ? 'active' : ''}" data-filter="3br" role="tab" aria-selected="${state.filters.category === '3br'}">3+ Kamar Tidur</button>
            </nav>

            <section id="apartmentListingsSection" aria-live="polite">
              <h3 class="h3 mb-md">Daftar Apartemen Terbaru</h3>
              <div class="cards-grid" id="apartmentListingsGrid">
                <!-- Kartu apartemen akan dirender di sini -->
              </div>
            </section>
            
            <nav class="pagination" id="paginationControls" aria-label="Navigasi halaman">
              <!-- Kontrol pagination akan dirender di sini -->
            </nav>
          `;
          View.renderCurrentPageContent(); // Render konten spesifik (list dan pagination)
          EventListeners.setupBerandaPageListeners(); // Pasang event listener untuk halaman ini
        },
        renderFavoritPage: () => {
          const favoriteApartments = state.apartments.filter(apt => state.favorites.includes(apt.id));
          DOMElements.appRoot.innerHTML = `
            <header class="page-header">
              <h2 class="page-title">Apartemen Favorit Anda</h2>
            </header>
            <section id="favoriteListingsSection" aria-live="polite">
              ${favoriteApartments.length === 0 ? `
                <div class="empty-state">
                  <svg class="feather empty-state-icon" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                  <h4 class="empty-state-title">Belum Ada Favorit</h4>
                  <p class="empty-state-message">Anda belum menambahkan apartemen ke favorit. Mulai jelajahi dan temukan yang Anda suka!</p>
                  <button class="btn btn-primary mt-md" id="jelajahiBtn">Jelajahi Apartemen</button>
                </div>
              ` : `
                <div class="cards-grid" id="favoriteListingsGrid">
                  <!-- Kartu favorit akan dirender di sini -->
                </div>
              `}
            </section>
          `;
          if (favoriteApartments.length > 0) {
            const grid = DOMElements.appRoot.querySelector('#favoriteListingsGrid');
            favoriteApartments.forEach(apt => grid.appendChild(View.renderApartmentCard(apt)));
          } else {
            DOMElements.appRoot.querySelector('#jelajahiBtn')?.addEventListener('click', () => Router.navigateTo('beranda'));
          }
        },
        renderPesananPage: () => {
          DOMElements.appRoot.innerHTML = `
            <header class="page-header">
              <h2 class="page-title">Riwayat Pesanan Anda</h2>
            </header>
            <div class="empty-state">
              <svg class="feather empty-state-icon" viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
              <h4 class="empty-state-title">Belum Ada Pesanan</h4>
              <p class="empty-state-message">Anda belum melakukan pemesanan apartemen. Pesan sekarang untuk pengalaman menginap yang nyaman!</p>
               <button class="btn btn-primary mt-md" id="pesanSekarangBtn">Pesan Sekarang</button>
            </div>
          `;
          DOMElements.appRoot.querySelector('#pesanSekarangBtn')?.addEventListener('click', () => Router.navigateTo('beranda'));
        },
        renderAkunPage: () => {
          DOMElements.appRoot.innerHTML = `
            <header class="page-header">
              <h2 class="page-title">Pengaturan Akun</h2>
            </header>
            <div class="empty-state">
              <svg class="feather empty-state-icon" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
              <h4 class="empty-state-title">Halaman Akun</h4>
              <p class="empty-state-message">Fitur pengaturan akun akan segera tersedia. Di sini Anda akan dapat mengelola profil, preferensi, dan keamanan akun Anda.</p>
            </div>
          `;
        },
        renderNotFoundPage: () => {
          DOMElements.appRoot.innerHTML = `
            <header class="page-header">
              <h2 class="page-title">404 - Halaman Tidak Ditemukan</h2>
            </header>
            <div class="empty-state">
              <svg class="feather empty-state-icon" viewBox="0 0 24 24"><alert-triangle stroke="var(--danger-color)" fill="var(--danger-color)" opacity="0.2"></alert-triangle><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
              <h4 class="empty-state-title">Oops! Sepertinya Anda tersesat.</h4>
              <p class="empty-state-message">Halaman yang Anda cari tidak ada atau telah dipindahkan. Silakan kembali ke beranda.</p>
              <button class="btn btn-primary mt-md" id="kembaliBerandaBtn">Kembali ke Beranda</button>
            </div>
          `;
          DOMElements.appRoot.querySelector('#kembaliBerandaBtn').addEventListener('click', () => Router.navigateTo('beranda'));
        },
        renderCurrentPageContent: () => { // Khusus untuk Beranda, render list dan pagination
          if (state.currentRoute === 'beranda') {
            const paginatedApartments = AppLogic.getPaginatedItems(state.filteredApartments);
            View.renderApartmentList(paginatedApartments);
            View.renderPagination(state.filteredApartments.length);
          }
        },
        updateActiveNav: () => {
          DOMElements.navMenu.querySelectorAll('.nav-item').forEach(item => {
            item.classList.toggle('active', item.dataset.route === state.currentRoute);
            item.setAttribute('aria-current', item.dataset.route === state.currentRoute ? 'page' : 'false');
          });
          // Update judul dokumen
          const activeNavItem = DOMElements.navMenu.querySelector(`.nav-item[data-route="${state.currentRoute}"] span`);
          const pageTitle = activeNavItem ? activeNavItem.textContent : 'Beranda';
          document.title = `${pageTitle} - Green Valley`;
        },
        openDetailModal: (apartmentId) => {
          const apartment = AppLogic.getApartmentById(apartmentId);
          if (!apartment) return;
          state.curGreen ValleymentDetail = apartment;

          DOMElements.modalTitle.textContent = apartment.name;
          DOMElements.modalBody.innerHTML = `
            <div class="property-gallery">
              ${apartment.gallery.map(imgUrl => `<img src="${imgUrl}" alt="Galeri ${apartment.name}" class="gallery-img" loading="lazy">`).join('')}
            </div>
            <p class="mb-md">${apartment.description}</p>
            <div class="property-main-info">
              <div class="property-info-block">
                <div class="property-info-value">${Utils.formatType(apartment.type)}</div>
                <div class="property-info-label">Tipe Unit</div>
              </div>
              <div class="property-info-block">
                <div class="property-info-value">${Utils.formatPrice(apartment.price)}<span class="text-sm text-light">/bln</span></div>
                <div class="property-info-label">Harga Sewa</div>
              </div>
              <div class="property-info-block">
                <div class="property-info-value">${apartment.ratings} <span class="text-sm text-light">(${apartment.reviews} ulasan)</span></div>
                <div class="property-info-label">Rating</div>
              </div>
            </div>
            <h4 class="h4 mb-sm">Fasilitas Unggulan</h4>
            <div class="property-facilities-list">
              ${apartment.facilities.map(facility => `<span class="facility-tag">${facility}</span>`).join('')}
            </div>
            <h4 class="h4 mb-sm mt-md">Lokasi Strategis</h4>
            <p>${apartment.location}</p>
          `;

          View.updateModalFavoriteButton(state.favorites.includes(apartment.id));

          DOMElements.modalFavoriteBtn.dataset.id = apartment.id;
          DOMElements.modalBookBtn.dataset.id = apartment.id;

          DOMElements.detailModal.classList.add('active');
          document.body.style.overflow = 'hidden'; // Mencegah scroll body saat modal terbuka
          DOMElements.closeModalBtn.focus(); // Fokus ke tombol close untuk aksesibilitas
        },
        closeDetailModal: () => {
          DOMElements.detailModal.classList.remove('active');
          state.curGreen ValleymentDetail = null;
          document.body.style.overflow = ''; // Kembalikan scroll body
        },
        updateModalFavoriteButton: (isFavorite) => {
          const btnText = DOMElements.modalFavoriteBtn.querySelector('span');
          if (isFavorite) {
            DOMElements.modalFavoriteBtn.classList.remove('btn-outline');
            DOMElements.modalFavoriteBtn.classList.add('btn-primary');
            btnText.textContent = 'Sudah Difavorit';
            DOMElements.modalFavoriteBtn.setAttribute('aria-pressed', 'true');
          } else {
            DOMElements.modalFavoriteBtn.classList.remove('btn-primary');
            DOMElements.modalFavoriteBtn.classList.add('btn-outline');
            btnText.textContent = 'Favoritkan';
            DOMElements.modalFavoriteBtn.setAttribute('aria-pressed', 'false');
          }
        },
        renderCurrentPage: () => { // Fungsi render utama yang dipanggil Router
          Utils.showLoading();
          // Simulasi loading data untuk halaman baru jika perlu
          // Untuk Beranda, data sudah di-load di init atau fetchApartments
          setTimeout(() => { // Beri waktu untuk spinner tampil
            switch (state.currentRoute) {
              case 'beranda': View.renderBerandaPage(); break;
              case 'favorit': View.renderFavoritPage(); break;
              case 'pesanan': View.renderPesananPage(); break;
              case 'akun': View.renderAkunPage(); break;
              default: View.renderNotFoundPage();
            }
            View.updateActiveNav();
            Utils.hideLoading();
            window.scrollTo(0, 0); // Scroll ke atas setiap ganti halaman
          }, 100); // Sedikit delay untuk UX
        }
      };

      // ROUTER (Layer Navigasi/Routing)
      const Router = {
        routes: {
          'beranda': View.renderBerandaPage,
          'favorit': View.renderFavoritPage,
          'pesanan': View.renderPesananPage,
          'akun': View.renderAkunPage
        },
        handleRouteChange: () => {
          const hash = window.location.hash.substring(1) || 'beranda'; // Hapus #, default ke beranda
          state.currentRoute = Router.routes[hash] ? hash : 'notFound'; // Jika rute tidak ada, ke notFound
          View.renderCurrentPage(); // Memanggil fungsi render utama
        },
        navigateTo: (route) => {
          if (state.currentRoute === route && window.location.hash === `#${route}`) return; // Hindari navigasi ke halaman yang sama
          window.location.hash = route;
          // handleRouteChange akan dipicu oleh event hashchange
          if (DOMElements.sidebar.classList.contains('active')) { // Tutup sidebar jika terbuka (mobile)
            EventListeners.toggleSidebar();
          }
        }
      };

      // EVENT LISTENERS (Layer Interaksi Pengguna)
      const EventListeners = {
        setupGlobalListeners: () => {
          window.addEventListener('hashchange', Router.handleRouteChange);
          window.addEventListener('popstate', Router.handleRouteChange); // Untuk tombol back/forward browser

          DOMElements.hamburgerMenu.addEventListener('click', EventListeners.toggleSidebar);

          // Event listener untuk modal
          DOMElements.closeModalBtn.addEventListener('click', View.closeDetailModal);
          DOMElements.detailModal.addEventListener('click', (e) => { // Klik di luar modal untuk menutup
            if (e.target === DOMElements.detailModal) View.closeDetailModal();
          });
          document.addEventListener('keydown', (e) => { // Tutup modal dengan tombol Escape
            if (e.key === 'Escape' && DOMElements.detailModal.classList.contains('active')) {
              View.closeDetailModal();
            }
          });

          DOMElements.modalFavoriteBtn.addEventListener('click', () => {
            if (state.curGreen ValleymentDetail) {
            AppLogic.toggleFavorite(state.curGreen ValleymentDetail.id);
          }
        });
      DOMElements.modalBookBtn.addEventListener('click', () => {
        if (state.curGreen ValleymentDetail) {
        AppLogic.bookApartment(state.curGreen ValleymentDetail.id);
      }
    });

    // Navigasi Sidebar
    DOMElements.navMenu.addEventListener('click', (e) => {
      const navItem = e.target.closest('.nav-item');
      if (navItem && navItem.dataset.route) {
        e.preventDefault(); // Mencegah perilaku default link jika ada tag <a>
        Router.navigateTo(navItem.dataset.route);
      }
    });
    // Link logo app
    document.querySelector('.app-title-link').addEventListener('click', (e) => {
      e.preventDefault();
      Router.navigateTo('beranda');
    });
        },
    setupBerandaPageListeners: () => {
      // Listener ini harus dipasang ulang setiap kali halaman Beranda dirender
      // karena elemen-elemennya dibuat ulang.
      const searchBtn = DOMElements.appRoot.querySelector('#searchBtn');
      const locationInput = DOMElements.appRoot.querySelector('#locationInput');
      const priceInput = DOMElements.appRoot.querySelector('#priceInput');
      const typeInput = DOMElements.appRoot.querySelector('#typeInput');
      const filterTabs = DOMElements.appRoot.querySelectorAll('#filterTabs .tab');

      const debouncedSearch = Utils.debounce(() => {
        state.filters.location = locationInput.value.trim();
        state.filters.maxPrice = priceInput.value.trim();
        state.filters.type = typeInput.value.trim();
        AppLogic.applyFiltersAndSearch();
        View.renderCurrentPageContent(); // Render ulang list dan pagination
        Utils.createToast('Pencarian', 'Filter diterapkan.', 'info', 1500);
      }, 500); // Debounce 500ms

      if (searchBtn) searchBtn.addEventListener('click', debouncedSearch);
      if (locationInput) locationInput.addEventListener('input', debouncedSearch);
      if (priceInput) priceInput.addEventListener('input', debouncedSearch);
      if (typeInput) typeInput.addEventListener('input', debouncedSearch);

      if (filterTabs) {
        filterTabs.forEach(tab => {
          tab.addEventListener('click', () => {
            filterTabs.forEach(t => {
              t.classList.remove('active');
              t.setAttribute('aria-selected', 'false');
            });
            tab.classList.add('active');
            tab.setAttribute('aria-selected', 'true');
            state.filters.category = tab.dataset.filter;
            AppLogic.applyFiltersAndSearch();
            View.renderCurrentPageContent();
          });
        });
      }
    },
      toggleSidebar: () => {
        const isActive = DOMElements.sidebar.classList.toggle('active');
        DOMElements.hamburgerMenu.setAttribute('aria-expanded', isActive);
        DOMElements.hamburgerIconOpen.classList.toggle('hidden', isActive);
        DOMElements.hamburgerIconClose.classList.toggle('hidden', !isActive);
        if (isActive) {
          DOMElements.sidebar.focus(); // Fokus ke sidebar untuk navigasi keyboard
        } else {
          DOMElements.hamburgerMenu.focus();
        }
      }
      };

    // INISIALISASI APLIKASI
    const init = () => {
      Utils.showLoading();
      AppLogic.fetchApartments().then(() => {
        Router.handleRouteChange(); // Tangani rute awal setelah data siap
        EventListeners.setupGlobalListeners();
        Utils.hideLoading();
        Utils.createToast('Selamat Datang!', 'Green Valley siap digunakan.', 'success');
      }).catch(error => {
        console.error("Gagal memuat data apartemen:", error);
        Utils.hideLoading();
        Utils.createToast('Kesalahan', 'Gagal memuat data. Coba lagi nanti.', 'error');
        DOMElements.appRoot.innerHTML = `<div class="empty-state"><h4 class="empty-state-title">Oops! Terjadi Kesalahan</h4><p class="empty-state-message">Tidak dapat memuat data apartemen. Silakan coba muat ulang halaman.</p></div>`;
      });
    };

    return { init }; // Expose hanya fungsi init ke global scope
    }) ();

    // Jalankan aplikasi setelah DOM sepenuhnya dimuat
    document.addEventListener('DOMContentLoaded', Green ValleyApp.init);
  </script>
</body>

</html>