<!DOCTYPE html>
<html lang="id" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SewaApt - Platform penyewaan apartemen dengan UI/UX modern dan responsif">
    <meta name="keywords" content="sewa apartemen, rental apartemen, apartemen premium">
    <meta name="author" content="SewaApt Team">
    <title>SewaApt - Cari Apartemen</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè¢</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
        as="style" onload="this.rel='stylesheet'">
    <noscript>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    </noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous">
    <style>
        /* Design Tokens */
        :root {
            --primary: #4f46e5;
            --primary-light: #818cf8;
            --primary-dark: #3730a3;
            --secondary: #f8f9fc;
            --success: #22c55e;
            --error: #ef4444;
            --surface: #ffffff;
            --surface-dark: #f1f5ff;
            --on-surface: #111827;
            --on-primary: #ffffff;
            --gray: #6b7280;
            --spacing-1: 4px;
            --spacing-2: 8px;
            --spacing-3: 16px;
            --spacing-4: 24px;
            --radius: 1rem;
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s ease;
            --font-family: 'Roboto', sans-serif;
        }

        [data-theme="dark"] {
            --surface: #1f2937;
            --surface-dark: #374151;
            --on-surface: #d1d5db;
            --secondary: #374151;
        }

        /* Base Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-family);
            line-height: 1.6;
            color: var(--on-surface);
            background: var(--surface);
            display: flex;
            min-height: 100vh;
        }

        a {
            color: var(--primary);
            text-decoration: none;
            transition: var(--transition);
        }

        a:hover {
            color: var(--primary-dark);
        }

        img {
            max-width: 100%;
            height: auto;
            display: block;
        }

        /* Utility Classes */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-2);
        }

        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .gap-1 {
            gap: var(--spacing-1);
        }

        .gap-2 {
            gap: var(--spacing-2);
        }

        .gap-3 {
            gap: var(--spacing-3);
        }

        .grid {
            display: grid;
        }

        .grid-cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .grid-auto-fill {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }

        .p-2 {
            padding: var(--spacing-2);
        }

        .p-3 {
            padding: var(--spacing-3);
        }

        .my-3 {
            margin: var(--spacing-3) 0;
        }

        .my-4 {
            margin: var(--spacing-4) 0;
        }

        .text-center {
            text-align: center;
        }

        .w-full {
            width: 100%;
        }

        .rounded {
            border-radius: var(--radius);
        }

        .shadow {
            box-shadow: var(--shadow);
        }

        .hidden {
            display: none;
        }

        .text-muted {
            color: var(--gray);
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .font-bold {
            font-weight: 700;
        }

        .bg-primary {
            background: var(--primary);
        }

        .bg-secondary {
            background: var(--secondary);
        }

        .bg-surface {
            background: var(--surface);
        }

        /* Components */
        aside {
            width: 240px;
            background: var(--secondary);
            padding: var(--spacing-3);
            position: sticky;
            top: 0;
            height: 100vh;
        }

        aside h2 {
            font-size: 1.5rem;
            margin-bottom: var(--spacing-3);
        }

        nav ul {
            list-style: none;
        }

        nav ul li {
            margin: var(--spacing-2) 0;
        }

        nav ul li a {
            color: var(--on-surface);
            padding: var(--spacing-1);
            display: block;
            border-radius: var(--radius);
        }

        nav ul li a.active {
            background: var(--primary-light);
            color: var(--primary-dark);
        }

        main {
            flex: 1;
            padding: var(--spacing-4);
            background: var(--surface);
        }

        header h1 {
            font-size: 1.75rem;
            margin-bottom: var(--spacing-3);
        }

        .search-bar {
            display: flex;
            gap: var(--spacing-2);
            margin-bottom: var(--spacing-3);
            flex-wrap: wrap;
        }

        .form-control {
            padding: var(--spacing-2);
            border: 1px solid var(--gray);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .btn {
            padding: var(--spacing-2) var(--spacing-3);
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .btn-primary {
            background: var(--primary);
            color: var(--on-primary);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-outline {
            border: 1px solid var(--primary);
            color: var(--primary);
            background: transparent;
        }

        .btn-outline:hover {
            background: var(--primary);
            color: var(--on-primary);
        }

        .card {
            background: var(--surface-dark);
            padding: var(--spacing-3);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        .card-img {
            height: 200px;
            object-fit: cover;
            border-radius: var(--radius) var(--radius) 0 0;
        }

        .price-tag {
            color: var(--primary);
            font-weight: bold;
            font-size: 1.1rem;
        }

        .gallery {
            position: relative;
            overflow: hidden;
        }

        .gallery-images {
            display: flex;
            transition: transform 0.5s ease;
        }

        .gallery-image {
            flex: 0 0 100%;
            height: 300px;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .gallery-image:hover {
            transform: scale(1.1);
            cursor: zoom-in;
        }

        .gallery-nav {
            position: absolute;
            top: 50%;
            width: 100%;
            transform: translateY(-50%);
            display: flex;
            justify-content: space-between;
        }

        .gallery-nav button {
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: var(--on-primary);
            padding: var(--spacing-2);
            cursor: pointer;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1100;
        }

        .modal.open {
            display: flex;
        }

        .modal-content {
            background: var(--surface);
            padding: var(--spacing-3);
            border-radius: var(--radius);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .chatbox {
            position: fixed;
            bottom: var(--spacing-3);
            right: var(--spacing-3);
            background: var(--surface);
            width: 300px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: none;
            flex-direction: column;
            height: 400px;
            z-index: 1200;
        }

        .chatbox.open {
            display: flex;
        }

        .chat-header {
            background: var(--primary);
            color: var(--on-primary);
            padding: var(--spacing-2);
            border-top-left-radius: var(--radius);
            border-top-right-radius: var(--radius);
        }

        .chat-body {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-2);
        }

        .chat-input {
            display: flex;
            border-top: 1px solid var(--gray);
        }

        .chat-input input {
            flex: 1;
            padding: var(--spacing-2);
            border: none;
        }

        .chat-input button {
            padding: var(--spacing-2);
            background: var(--primary);
            color: var(--on-primary);
            border: none;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: var(--spacing-1);
        }

        .calendar-day {
            padding: var(--spacing-1);
            text-align: center;
            cursor: pointer;
        }

        .calendar-day.booked {
            background: var(--error);
            color: var(--on-primary);
        }

        .calendar-day.selected {
            background: var(--primary);
            color: var(--on-primary);
        }

        .testimonial {
            background: var(--secondary);
            padding: var(--spacing-3);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        footer {
            text-align: center;
            padding: var(--spacing-3);
            background: var(--secondary);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .grid-cols-3 {
                grid-template-columns: repeat(2, 1fr);
            }

            aside {
                width: 200px;
            }
        }

        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }

            aside {
                width: 100%;
                height: auto;
                position: static;
            }

            main {
                padding: var(--spacing-3);
            }

            .search-bar {
                flex-direction: column;
            }

            .grid-cols-3 {
                grid-template-columns: 1fr;
            }

            .gallery-image {
                height: 200px;
            }

            .chatbox {
                width: 90%;
            }
        }

        /* Accessibility */
        [tabindex="0"]:focus,
        button:focus,
        input:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                transition: none !important;
            }
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <aside role="navigation">
        <h2>SewaApt</h2>
        <nav>
            <ul>
                <li><a href="#home" data-page="home" class="active" aria-current="page">Cari</a></li>
                <li><a href="#favorites" data-page="favorites">Favorit</a></li>
                <li><a href="#bookings" data-page="bookings">Pesanan</a></li>
                <li><a href="#account" data-page="account">Akun</a></li>
                <li><a href="#support" data-page="support">Dukungan</a></li>
            </ul>
        </nav>
        <div class="flex-col gap-1 mt-auto pt-4">
            <p class="font-bold">Halo, Dinda</p>
            <small class="text-muted">Penyewa</small>
        </div>
    </aside>

    <!-- Main Content -->
    <main role="main">
        <!-- Home Section -->
        <section id="home" aria-labelledby="home-heading">
            <header>
                <h1 id="home-heading">Cari Apartemen</h1>
                <form class="search-bar" aria-label="Pencarian apartemen">
                    <input type="text" class="form-control" id="lokasi" placeholder="Masukkan kota atau area"
                        aria-label="Lokasi">
                    <input type="number" class="form-control" id="harga" placeholder="Harga Maks (Rp)"
                        aria-label="Harga maksimum">
                    <input type="range" class="form-control" id="radius" min="0" max="50" value="10"
                        aria-label="Radius pencarian (km)">
                    <span id="radius-value">10 km</span>
                    <select class="form-control" id="tipe" aria-label="Tipe apartemen">
                        <option value="">Tipe</option>
                        <option value="Studio">Studio</option>
                        <option value="1BR">1 Kamar</option>
                        <option value="2BR">2 Kamar</option>
                    </select>
                    <div class="flex gap-1">
                        <label><input type="checkbox" name="amenities" value="WiFi"> WiFi</label>
                        <label><input type="checkbox" name="amenities" value="AC"> AC</label>
                        <label><input type="checkbox" name="amenities" value="Pool"> Pool</label>
                    </div>
                    <button type="submit" class="btn btn-primary">Cari</button>
                </form>
            </header>
            <div class="card-grid" id="apartemen-list" aria-label="Daftar apartemen"></div>
            <section class="my-4">
                <h2>Testimoni Pengguna</h2>
                <div class="grid grid-auto-fill gap-3 mt-3">
                    <blockquote class="testimonial">
                        <p class="font-bold">Sangat puas!</p>
                        <figcaption>Proses sewa mudah, apartemen bersih dan sesuai foto.</figcaption>
                    </blockquote>
                    <blockquote class="testimonial">
                        <p class="font-bold">Pelayanan cepat</p>
                        <figcaption>Admin responsif, banyak pilihan apartemen.</figcaption>
                    </blockquote>
                </div>
            </section>
        </section>

        <!-- Favorites Section -->
        <section id="favorites" class="hidden" aria-labelledby="favorites-heading">
            <h2 id="favorites-heading" class="my-4 text-2xl font-bold">Apartemen Favorit</h2>
            <div class="card-grid" id="favorites-list" aria-label="Daftar apartemen favorit"></div>
        </section>

        <!-- Apartment Detail Section -->
        <section id="apartment-detail" class="hidden" aria-labelledby="apartment-detail-heading">
            <h2 id="apartment-detail-heading" class="my-4 text-2xl font-bold"></h2>
            <figure class="gallery mb-4">
                <div class="gallery-images" id="gallery-images"></div>
                <div class="gallery-nav">
                    <button aria-label="Gambar sebelumnya" onclick="app.prevImage()"><i
                            class="fas fa-chevron-left"></i></button>
                    <button aria-label="Gambar berikutnya" onclick="app.nextImage()"><i
                            class="fas fa-chevron-right"></i></button>
                </div>
                <figcaption id="gallery-caption" class="text-center text-muted mt-2"></figcaption>
            </figure>
            <div class="grid grid-cols-3 gap-3">
                <div class="card col-span-2">
                    <p><strong>Harga:</strong> <span id="detail-price"></span></p>
                    <p><strong>Lokasi:</strong> <span id="detail-location"></span></p>
                    <p><strong>Fasilitas:</strong> <span id="detail-amenities"></span></p>
                    <div class="map-placeholder my-3 rounded" id="map-placeholder">Peta Lokasi (Simulasi)</div>
                    <details class="my-3">
                        <summary class="font-bold">Informasi Pemilik</summary>
                        <p class="mt-2">Pemilik: <span id="owner-name"></span> <span id="owner-status"></span></p>
                    </details>
                    <div id="reviews" aria-label="Ulasan apartemen"></div>
                    <button class="btn btn-outline mt-3" onclick="app.openModal('report')">Laporkan Masalah</button>
                </div>
                <div class="card">
                    <h3 class="mb-3">Pesan Sekarang</h3>
                    <div class="calendar" id="calendar"></div>
                    <form id="booking-form" aria-label="Formulir pemesanan">
                        <div class="my-2">
                            <label for="checkin" class="block font-bold">Check-in</label>
                            <input type="date" id="checkin" class="form-control w-full" required
                                aria-label="Tanggal check-in">
                        </div>
                        <div class="my-2">
                            <label for="checkout" class="block font-bold">Check-out</label>
                            <input type="date" id="checkout" class="form-control w-full" required
                                aria-label="Tanggal check-out">
                        </div>
                        <div class="my-2">
                            <label><input type="checkbox" id="insurance" aria-label="Tambah asuransi"> Tambah Asuransi
                                (+10%)</label>
                        </div>
                        <div class="my-2">
                            <label for="payment-method" class="block font-bold">Metode Pembayaran</label>
                            <select id="payment-method" class="form-control w-full" aria-label="Metode pembayaran">
                                <option value="credit">Kartu Kredit</option>
                                <option value="bank">Transfer Bank</option>
                                <option value="ewallet">E-Wallet</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary w-full">Pesan</button>
                        <p class="text-sm text-muted mt-2">Pembayaran dijamin dengan escrow.</p>
                        <div id="cost-breakdown" class="text-sm mt-2"></div>
                    </form>
                    <button class="btn btn-outline mt-3" onclick="app.openChat('owner')">Chat dengan Pemilik</button>
                </div>
            </div>
        </section>

        <!-- Bookings Section -->
        <section id="bookings" class="hidden" aria-labelledby="bookings-heading">
            <h2 id="bookings-heading" class="my-4 text-2xl font-bold">Pesanan Anda</h2>
            <div class="card-grid" id="booking-list" aria-label="Daftar pesanan"></div>
        </section>

        <!-- Account Section -->
        <section id="account" class="hidden" aria-labelledby="account-heading">
            <h2 id="account-heading" class="my-4 text-2xl font-bold">Akun Anda</h2>
            <div class="grid grid-cols-3 gap-3">
                <div class="card col-span-2">
                    <p><strong>Nama:</strong> <span id="user-name">Dinda</span></p>
                    <p><strong>Email:</strong> <span id="user-email">dinda@example.com</span></p>
                    <p><strong>Poin Loyalitas:</strong> <span id="loyalty-points">0</span></p>
                    <button class="btn btn-outline mt-3" onclick="app.openModal('edit-profile')">Edit Profil</button>
                </div>
                <div class="card">
                    <h3 class="mb-3">Riwayat Pemesanan</h3>
                    <div id="booking-history" aria-label="Riwayat pemesanan"></div>
                </div>
            </div>
        </section>

        <!-- Support Section -->
        <section id="support" class="hidden" aria-labelledby="support-heading">
            <h2 id="support-heading" class="my-4 text-2xl font-bold">Dukungan Pelanggan 24/7</h2>
            <div class="grid grid-auto-fill gap-3">
                <div class="card">
                    <h3 class="mb-3">Live Chat</h3>
                    <button class="btn btn-primary" onclick="app.openChat('support')">Mulai Chat</button>
                </div>
                <div class="card">
                    <h3 class="mb-3">Email</h3>
                    <p><a href="mailto:support@sewaapt.com">support@sewaapt.com</a></p>
                </div>
                <div class="card">
                    <h3 class="mb-3">Telepon</h3>
                    <p><a href="tel:+628001234567">+62 800 123 4567</a></p>
                </div>
            </div>
        </section>

        <footer>
            <p>¬© 2025 SewaApt - Platform Penyewaan Apartemen</p>
        </footer>
    </main>

    <!-- Modals -->
    <div class="modal" id="edit-profile" role="dialog" aria-labelledby="edit-profile-heading">
        <div class="modal-content">
            <h2 id="edit-profile-heading">Edit Profil</h2>
            <form id="edit-profile-form" aria-label="Formulir edit profil">
                <div class="my-3">
                    <label for="edit-name" class="block font-bold">Nama</label>
                    <input type="text" id="edit-name" class="form-control w-full" value="Dinda"
                        aria-label="Nama pengguna">
                </div>
                <div class="my-3">
                    <label for="edit-email" class="block font-bold">Email</label>
                    <input type="email" id="edit-email" class="form-control w-full" value="dinda@example.com"
                        aria-label="Email pengguna">
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary">Simpan</button>
                    <button type="button" class="btn btn-outline" onclick="app.closeModal()">Batal</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="report" role="dialog" aria-labelledby="report-heading">
        <div class="modal-content">
            <h2 id="report-heading">Laporkan Masalah</h2>
            <form id="report-form" aria-label="Formulir pelaporan masalah">
                <div class="my-3">
                    <label for="report-issue" class="block font-bold">Masalah</label>
                    <textarea id="report-issue" class="form-control w-full" rows="4"
                        placeholder="Deskripsikan masalah..." aria-label="Deskripsi masalah"></textarea>
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary">Kirim</button>
                    <button type="button" class="btn btn-outline" onclick="app.closeModal()">Batal</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Chatbox -->
    <button class="btn btn-primary fixed bottom-4 right-4" id="chat-toggle" aria-label="Buka chat dukungan">
        <i class="fas fa-comment"></i>
    </button>
    <div class="chatbox" id="chatbox" aria-label="Jendela chat">
        <div class="chat-header" id="chat-header">Chat</div>
        <div class="chat-body" id="chat-body" aria-live="polite">
            <div class="chat-message">Selamat datang! Bagaimana kami bisa membantu Anda hari ini?</div>
        </div>
        <div class="chat-input">
            <input type="text" id="chat-input" placeholder="Ketik pesan..." aria-label="Input pesan">
            <button onclick="app.sendChatMessage()" aria-label="Kirim pesan">Kirim</button>
        </div>
    </div>

    <script>
        // Simulated Data
        const properties = [
            {
                id: 1,
                nama: "Apartemen Sudirman",
                lokasi: "Jakarta Pusat",
                tipe: "Studio",
                harga: 4500000,
                amenities: ["WiFi", "AC"],
                images: [
                    "https://source.unsplash.com/random/400x300/?apartment",
                    "https://source.unsplash.com/random/400x300/?building"
                ],
                bookedDates: ["2025-05-20", "2025-05-21"],
                owner: { name: "Budi Santoso", verified: true },
                reviews: [{ user: "Dinda", rating: 4, comment: "Sangat nyaman!", date: "2025-05-18" }]
            },
            {
                id: 2,
                nama: "Green Pramuka",
                lokasi: "Jakarta Timur",
                tipe: "2BR",
                harga: 6200000,
                amenities: ["Pool", "Gym", "WiFi"],
                images: [
                    "https://source.unsplash.com/random/400x300/?apartment",
                    "https://source.unsplash.com/random/400x300/?city"
                ],
                bookedDates: ["2025-05-22", "2025-05-23"],
                owner: { name: "Siti Aminah", verified: true },
                reviews: [{ user: "Rudi", rating: 5, comment: "Pelayanan cepat!", date: "2025-05-17" }]
            },
            {
                id: 3,
                nama: "Bassura City",
                lokasi: "Jakarta Timur",
                tipe: "1BR",
                harga: 5000000,
                amenities: ["Parking", "WiFi"],
                images: [
                    "https://source.unsplash.com/random/400x300/?building",
                    "https://source.unsplash.com/random/400x300/?apartment"
                ],
                bookedDates: [],
                owner: { name: "Ahmad Yani", verified: false },
                reviews: []
            }
        ];

        // Simulated External Services
        const PaymentService = {
            process: async (amount) => {
                await new Promise(resolve => setTimeout(resolve, 1000));
                return { success: true, id: `txn_${Date.now()}` };
            }
        };
        const MapService = {
            render: (id, location, radius) => {
                document.getElementById(id).innerHTML = `Peta Lokasi: ${location} (Radius: ${radius} km, Simulasi)`;
            }
        };
        const ChatService = {
            send: async (message, type) => {
                await new Promise(resolve => setTimeout(resolve, 1000));
                return type === 'support'
                    ? `Dukungan: Terima kasih atas pesan Anda: "${message}". Kami akan membantu!`
                    : `Pemilik: "${message}" diterima. Kami akan segera membalas!`;
            }
        };

        // Application Class
        class SewaAptApp {
            constructor() {
                this.state = {
                    properties,
                    favorites: JSON.parse(localStorage.getItem('favorites')) || [],
                    bookings: JSON.parse(localStorage.getItem('bookings')) || [],
                    currentView: 'home',
                    selectedApartment: null,
                    galleryIndex: 0,
                    user: { name: "Dinda", email: "dinda@example.com", loyaltyPoints: 0 },
                    chatType: 'support'
                };
                this.init();
            }

            init() {
                this.tampilkanApartemen(this.state.properties);
                this.setupEventListeners();
                MapService.render('map-placeholder', 'Jakarta', 10);
                this.switchView(window.location.hash.slice(1) || 'home');
            }

            switchView(view) {
                this.state.currentView = view;
                document.querySelectorAll('section').forEach(section => {
                    section.classList.toggle('hidden', section.id !== view);
                });
                document.querySelectorAll('nav a').forEach(link => {
                    link.classList.toggle('active', link.dataset.page === view);
                    link.setAttribute('aria-current', link.dataset.page === view ? 'page' : 'false');
                });
                this.loadView(view);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            loadView(view) {
                switch (view) {
                    case 'home':
                        this.tampilkanApartemen(this.state.properties);
                        break;
                    case 'favorites':
                        this.renderFavorites();
                        break;
                    case 'bookings':
                        this.renderBookings();
                        break;
                    case 'account':
                        this.renderAccount();
                        break;
                    case 'support':
                        break;
                    case 'apartment-detail':
                        this.renderApartmentDetail();
                        break;
                }
            }

            tampilkanApartemen(list) {
                const container = document.getElementById("apartemen-list");
                container.innerHTML = "";
                list.forEach(item => {
                    const card = document.createElement("article");
                    card.className = "card";
                    card.innerHTML = `
                        <figure>
                            <img src="${item.images[0]}" alt="${item.nama}" class="card-img" loading="lazy">
                            <h3>${item.nama}</h3>
                            <p class="text-muted">${item.lokasi} ‚Ä¢ ${item.tipe} ‚Ä¢ Rp${item.harga.toLocaleString('id-ID')}/bln</p>
                            <button class="btn btn-outline" onclick="app.showApartmentDetail(${item.id})">Lihat Detail</button>
                            <button class="btn btn-outline" onclick="app.toggleFavorite(${item.id})">${this.state.favorites.includes(item.id) ? 'Hapus Favorit' : 'Favorit'}</button>
                        </figure>
                    `;
                    container.appendChild(card);
                });
            }

            searchApt(e) {
                e.preventDefault();
                const lokasi = document.getElementById("lokasi").value.toLowerCase();
                const harga = parseInt(document.getElementById("harga").value) || Infinity;
                const radius = parseInt(document.getElementById("radius").value);
                const tipe = document.getElementById("tipe").value;
                const amenities = Array.from(document.querySelectorAll('input[name="amenities"]:checked')).map(cb => cb.value);

                const hasil = this.state.properties.filter(apt => {
                    const cocokLokasi = !lokasi || apt.lokasi.toLowerCase().includes(lokasi);
                    const cocokHarga = apt.harga <= harga;
                    const cocokTipe = !tipe || apt.tipe === tipe;
                    const cocokAmenities = amenities.length === 0 || amenities.every(amenity => apt.amenities.includes(amenity));
                    return cocokLokasi && cocokHarga && cocokTipe && cocokAmenities;
                });

                this.tampilkanApartemen(hasil);
                MapService.render('map-placeholder', 'Jakarta', radius);
            }

            showApartmentDetail(id) {
                this.state.selectedApartment = this.state.properties.find(p => p.id === id);
                this.state.galleryIndex = 0;
                this.switchView('apartment-detail');
            }

            renderApartmentDetail() {
                const apt = this.state.selectedApartment;
                if (!apt) return;

                document.getElementById('apartment-detail-heading').textContent = apt.nama;
                document.getElementById('detail-price').textContent = `Rp ${apt.harga.toLocaleString('id-ID')}/bln`;
                document.getElementById('detail-location').textContent = apt.lokasi;
                document.getElementById('detail-amenities').textContent = apt.amenities.join(', ');
                document.getElementById('owner-name').textContent = apt.owner.name;
                document.getElementById('owner-status').innerHTML = apt.owner.verified ? '<span class="text-success">Terverifikasi</span>' : '';
                document.getElementById('gallery-images').innerHTML = apt.images.map((img, idx) => `
                    <img src="${img}" alt="${apt.nama} - Gambar ${idx + 1}" class="gallery-image" loading="lazy">
                `).join('');
                document.getElementById('gallery-images').style.transform = `translateX(0)`;
                document.getElementById('gallery-caption').textContent = 'Gambar 1 (Tur 360¬∞ Simulasi)';
                this.renderCalendar();
                this.renderReviews();
                MapService.render('map-placeholder', apt.lokasi, 10);
            }

            renderCalendar() {
                const apt = this.state.selectedApartment;
                const container = document.getElementById('calendar');
                const today = new Date();
                const days = Array.from({ length: 30 }, (_, i) => {
                    const d = new Date(today);
                    d.setDate(today.getDate() + i);
                    return d.toISOString().split('T')[0];
                });

                container.innerHTML = `
                    <div class="calendar-day font-bold" style="grid-column: span 7;">Sen</div>
                    ${days.map(d => `
                        <div class="calendar-day ${apt.bookedDates.includes(d) ? 'booked' : ''}" data-date="${d}">
                            ${new Date(d).getDate()}
                        </div>
                    `).join('')}
                `;
                container.querySelectorAll('.calendar-day').forEach(day => {
                    day.addEventListener('click', () => {
                        if (!day.classList.contains('booked')) {
                            const checkin = document.getElementById('checkin');
                            const checkout = document.getElementById('checkout');
                            if (!checkin.value) {
                                checkin.value = day.dataset.date;
                                day.classList.add('selected');
                            } else if (!checkout.value && day.dataset.date > checkin.value) {
                                checkout.value = day.dataset.date;
                                day.classList.add('selected');
                            } else {
                                checkin.value = day.dataset.date;
                                checkout.value = '';
                                container.querySelectorAll('.calendar-day').forEach(d => d.classList.remove('selected'));
                                day.classList.add('selected');
                            }
                        }
                    });
                });
            }

            renderReviews() {
                const apt = this.state.selectedApartment;
                const container = document.getElementById('reviews');
                container.innerHTML = apt.reviews.length ? apt.reviews.map(review => `
                    <blockquote class="my-2">
                        <p class="text-muted">${review.comment} (${review.rating}/5)</p>
                        <figcaption>- ${review.user}, ${new Date(review.date).toLocaleDateString('id-ID')}</figcaption>
                    </blockquote>
                `).join('') : '<p class="text-muted">Belum ada ulasan.</p>';
            }

            prevImage() {
                const images = document.querySelectorAll('.gallery-image').length;
                this.state.galleryIndex = Math.max(this.state.galleryIndex - 1, 0);
                document.getElementById('gallery-images').style.transform = `translateX(-${this.state.galleryIndex * 100}%)`;
                document.getElementById('gallery-caption').textContent = `Gambar ${this.state.galleryIndex + 1} (Tur 360¬∞ Simulasi)`;
            }

            nextImage() {
                const images = document.querySelectorAll('.gallery-image').length;
                this.state.galleryIndex = Math.min(this.state.galleryIndex + 1, images - 1);
                document.getElementById('gallery-images').style.transform = `translateX(-${this.state.galleryIndex * 100}%)`;
                document.getElementById('gallery-caption').textContent = `Gambar ${this.state.galleryIndex + 1} (Tur 360¬∞ Simulasi)`;
            }

            async processBooking(e) {
                e.preventDefault();
                const checkin = document.getElementById('checkin').value;
                const checkout = document.getElementById('checkout').value;
                const insurance = document.getElementById('insurance').checked;
                const paymentMethod = document.getElementById('payment-method').value;

                if (!checkin || !checkout) {
                    alert('Pilih tanggal check-in dan check-out!');
                    return;
                }

                const apt = this.state.selectedApartment;
                const days = Math.ceil((new Date(checkout) - new Date(checkin)) / (1000 * 60 * 60 * 24));
                if (days <= 0) {
                    alert('Tanggal check-out harus setelah check-in!');
                    return;
                }

                const baseCost = apt.harga * days / 30;
                const insuranceCost = insurance ? baseCost * 0.1 : 0;
                const total = baseCost + insuranceCost;

                try {
                    const result = await PaymentService.process(total);
                    if (result.success) {
                        this.state.bookings.push({
                            id: result.id,
                            title: apt.nama,
                            checkin,
                            checkout,
                            total: total.toLocaleString('id-ID'),
                            paymentMethod,
                            timestamp: new Date().toISOString()
                        });
                        apt.bookedDates.push(...Array.from({ length: days }, (_, i) => {
                            const d = new Date(checkin);
                            d.setDate(d.getDate() + i);
                            return d.toISOString().split('T')[0];
                        }));
                        this.state.user.loyaltyPoints += Math.floor(total / 100000);
                        localStorage.setItem('bookings', JSON.stringify(this.state.bookings));
                        document.getElementById('cost-breakdown').innerHTML = `
                            <p>Biaya Dasar: Rp ${baseCost.toLocaleString('id-ID')}</p>
                            <p>Asuransi: Rp ${insuranceCost.toLocaleString('id-ID')}</p>
                            <p>Total: Rp ${total.toLocaleString('id-ID')}</p>
                        `;
                        alert(`Pemesanan berhasil! ID Transaksi: ${result.id}`);
                        this.switchView('bookings');
                    }
                } catch (error) {
                    alert('Pemesanan gagal. Silakan coba lagi.');
                }
            }

            toggleFavorite(id) {
                const index = this.state.favorites.indexOf(id);
                if (index === -1) {
                    this.state.favorites.push(id);
                } else {
                    this.state.favorites.splice(index, 1);
                }
                localStorage.setItem('favorites', JSON.stringify(this.state.favorites));
                this.loadView(this.state.currentView);
            }

            renderFavorites() {
                const container = document.getElementById('favorites-list');
                const favorites = this.state.properties.filter(p => this.state.favorites.includes(p.id));
                container.innerHTML = favorites.length ? favorites.map(item => `
                    <article class="card">
                        <figure>
                            <img src="${item.images[0]}" alt="${item.nama}" class="card-img" loading="lazy">
                            <h3>${item.nama}</h3>
                            <p class="text-muted">${item.lokasi} ‚Ä¢ ${item.tipe} ‚Ä¢ Rp${item.harga.toLocaleString('id-ID')}/bln</p>
                            <button class="btn btn-outline" onclick="app.showApartmentDetail(${item.id})">Lihat Detail</button>
                            <button class="btn btn-outline" onclick="app.toggleFavorite(${item.id})">Hapus Favorit</button>
                        </figure>
                    </article>
                `).join('') : '<p class="text-center text-muted">Belum ada apartemen favorit.</p>';
            }

            renderBookings() {
                const container = document.getElementById('booking-list');
                container.innerHTML = this.state.bookings.length ? this.state.bookings.map(booking => `
                    <article class="card">
                        <h3>${booking.title}</h3>
                        <p class="text-muted">Check-in: ${booking.checkin} | Check-out: ${booking.checkout}</p>
                        <p>Total: Rp ${booking.total}</p>
                        <p class="text-sm text-muted">Dibuat: ${new Date(booking.timestamp).toLocaleString('id-ID')}</p>
                    </article>
                `).join('') : '<p class="text-center text-muted">Belum ada pesanan.</p>';
            }

            renderAccount() {
                document.getElementById('user-name').textContent = this.state.user.name;
                document.getElementById('user-email').textContent = this.state.user.email;
                document.getElementById('loyalty-points').textContent = this.state.user.loyaltyPoints;
                const history = document.getElementById('booking-history');
                history.innerHTML = this.state.bookings.length ? this.state.bookings.map(booking => `
                    <div class="my-2">
                        <p><strong>${booking.title}</strong></p>
                        <p class="text-muted">Check-in: ${booking.checkin} | Check-out: ${booking.checkout}</p>
                        <p>Total: Rp ${booking.total}</p>
                        <p class="text-sm text-muted">Dibuat: ${new Date(booking.timestamp).toLocaleString('id-ID')}</p>
                    </div>
                `).join('') : '<p class="text-muted">Belum ada pemesanan.</p>';
            }

            openModal(modalId) {
                document.getElementById(modalId).classList.add('open');
                document.querySelector(`#${modalId} input`).focus();
            }

            closeModal() {
                document.querySelectorAll('.modal').forEach(modal => modal.classList.remove('open'));
            }

            openChat(type) {
                this.state.chatType = type;
                const chatbox = document.getElementById('chatbox');
                document.getElementById('chat-header').textContent = type === 'support' ? 'Dukungan Pelanggan 24/7' : 'Chat dengan Pemilik';
                chatbox.classList.add('open');
                document.getElementById('chat-input').focus();
            }

            async sendChatMessage() {
                const input = document.getElementById('chat-input');
                const body = document.getElementById('chat-body');
                if (!input.value.trim()) return;

                const message = input.value;
                body.innerHTML += `<div class="chat-message user">${message}</div>`;
                input.value = '';
                body.scrollTop = body.scrollHeight;

                try {
                    const response = await ChatService.send(message, this.state.chatType);
                    body.innerHTML += `<div class="chat-message">${response}</div>`;
                    body.scrollTop = body.scrollHeight;
                } catch (error) {
                    body.innerHTML += `<div class="chat-message error">Gagal mengirim pesan.</div>`;
                    body.scrollTop = body.scrollHeight;
                }
            }

            async reportIssue(e) {
                e.preventDefault();
                const issue = document.getElementById('report-issue').value;
                if (!issue.trim()) {
                    alert('Silakan deskripsikan masalah Anda!');
                    return;
                }
                alert('Laporan Anda telah dikirim. Kami akan segera menindaklanjuti.');
                this.closeModal();
            }

            async editProfile(e) {
                e.preventDefault();
                const name = document.getElementById('edit-name').value;
                const email = document.getElementById('edit-email').value;
                if (!name || !email) {
                    alert('Semua kolom wajib diisi!');
                    return;
                }
                this.state.user.name = name;
                this.state.user.email = email;
                this.closeModal();
                this.renderAccount();
                alert('Profil berhasil diperbarui!');
            }

            setupEventListeners() {
                document.querySelectorAll('a[href^="#"]').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.switchView(link.dataset.page);
                    });
                });

                document.querySelector('.search-bar').addEventListener('submit', (e) => this.searchApt(e));

                document.getElementById('radius').addEventListener('input', (e) => {
                    document.getElementById('radius-value').textContent = `${e.target.value} km`;
                });

                document.getElementById('booking-form').addEventListener('submit', (e) => this.processBooking(e));

                document.getElementById('edit-profile-form').addEventListener('submit', (e) => this.editProfile(e));

                document.getElementById('report-form').addEventListener('submit', (e) => this.reportIssue(e));

                document.getElementById('chat-toggle').addEventListener('click', () => this.openChat('support'));

                document.getElementById('chat-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.sendChatMessage();
                });

                window.addEventListener('hashchange', () => {
                    const view = window.location.hash.slice(1) || 'home';
                    this.switchView(view);
                });
            }
        }

        // Initialize
        const app = new SewaAptApp();
    </script>
</body>

</html>