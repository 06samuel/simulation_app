<!DOCTYPE html>
<html lang="id" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Green Valley - Sistem Manajemen Properti Sewa Terintegrasi. Solusi lengkap untuk mengelola unit, penyewa, pembayaran, dan laporan keuangan properti sewa Anda di Indonesia.">
    <meta name="keywords"
        content="sewa properti, manajemen kos, aplikasi pengelola kos, laporan keuangan properti, sistem pembayaran sewa, Green Valley, properti, manajemen properti">
    <meta name="author" content="Tim Pengembang Green Valley">
    <title>Green Valley | Sistem Manajemen Properti Sewa</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè†</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preload"
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" as="style"
        onload="this.rel='stylesheet'">
    <noscript>
        <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
            rel="stylesheet">
    </noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        :root {
            /* Palet Warna Utama */
            --color-primary: hsl(215, 80%, 50%);
            --color-primary-dark: hsl(215, 80%, 40%);
            --color-primary-light: hsl(215, 80%, 90%);
            --color-primary-hover: hsl(215, 80%, 45%);
            --color-primary-focus-ring: hsla(215, 80%, 50%, 0.25);

            --color-accent: hsl(35, 90%, 55%);
            --color-accent-light: hsl(35, 90%, 95%);

            /* Warna Status */
            --color-success: hsl(145, 65%, 45%);
            --color-success-light: hsl(145, 65%, 95%);
            --color-success-dark: hsl(145, 65%, 35%);
            --color-danger: hsl(5, 80%, 55%);
            --color-danger-light: hsl(5, 80%, 95%);
            --color-danger-dark: hsl(5, 80%, 45%);
            --color-warning: hsl(35, 90%, 55%);
            /* Sama dengan accent, bisa dibedakan jika perlu */
            --color-warning-light: hsl(35, 90%, 95%);
            --color-warning-dark: hsl(35, 90%, 45%);
            --color-info: hsl(200, 90%, 55%);
            --color-info-light: hsl(200, 90%, 95%);
            --color-info-dark: hsl(200, 90%, 45%);

            /* Warna Netral & Teks */
            --color-neutral-0: hsl(0, 0%, 100%);
            --color-neutral-50: hsl(220, 20%, 98%);
            --color-neutral-100: hsl(220, 20%, 96%);
            --color-neutral-200: hsl(220, 20%, 92%);
            --color-neutral-300: hsl(220, 20%, 85%);
            --color-neutral-400: hsl(220, 20%, 70%);
            --color-neutral-500: hsl(220, 20%, 55%);
            --color-neutral-600: hsl(220, 20%, 40%);
            --color-neutral-700: hsl(220, 20%, 30%);
            --color-neutral-800: hsl(220, 20%, 20%);
            --color-neutral-900: hsl(220, 20%, 10%);

            /* Definisi Warna berdasarkan Tema (Light) */
            --color-bg: var(--color-neutral-50);
            --color-bg-alt: var(--color-neutral-0);
            --color-bg-card: var(--color-neutral-0);
            --color-bg-sidebar: hsl(218, 40%, 18%);
            /* Warna sidebar lebih gelap */
            --color-bg-sidebar-hover: hsl(218, 40%, 25%);
            --color-bg-sidebar-active: var(--color-primary);

            --color-text: var(--color-neutral-900);
            --color-text-muted: var(--color-neutral-600);
            --color-text-light: var(--color-neutral-0);
            --color-text-sidebar: hsla(0, 0%, 100%, 0.85);
            --color-text-sidebar-active: var(--color-neutral-0);

            --color-border: var(--color-neutral-200);
            --color-border-dark: var(--color-neutral-300);
            --color-focus: var(--color-primary-focus-ring);
            --color-hover: var(--color-neutral-100);
            --color-active: var(--color-neutral-200);

            /* Tipografi */
            --font-main: 'Plus Jakarta Sans', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-mono: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;

            /* Ukuran Font Responsif (Clamp) */
            --font-xxs: clamp(0.6875rem, 0.6563rem + 0.1563vw, 0.75rem);
            /* ~11px to 12px */
            --font-xs: clamp(0.75rem, 0.6875rem + 0.3125vw, 0.875rem);
            /* ~12px to 14px */
            --font-sm: clamp(0.875rem, 0.8125rem + 0.3125vw, 1rem);
            /* ~14px to 16px */
            --font-md: clamp(1rem, 0.9063rem + 0.4688vw, 1.125rem);
            /* ~16px to 18px */
            --font-lg: clamp(1.125rem, 1rem + 0.625vw, 1.375rem);
            /* ~18px to 22px */
            --font-xl: clamp(1.25rem, 1.0938rem + 0.7813vw, 1.5rem);
            /* ~20px to 24px */
            --font-2xl: clamp(1.5rem, 1.2813rem + 1.0938vw, 1.875rem);
            /* ~24px to 30px */
            --font-3xl: clamp(1.75rem, 1.4375rem + 1.5625vw, 2.25rem);
            /* ~28px to 36px */
            --font-4xl: clamp(2rem, 1.5625rem + 2.1875vw, 2.75rem);
            /* ~32px to 44px */
            --font-display: clamp(2.25rem, 1.7188rem + 2.6563vw, 3.25rem);
            /* ~36px to 52px */

            /* Spasi */
            --space-xxs: 0.25rem;
            /* 4px */
            --space-xs: 0.5rem;
            /* 8px */
            --space-sm: 0.75rem;
            /* 12px */
            --space-md: 1rem;
            /* 16px */
            --space-lg: 1.5rem;
            /* 24px */
            --space-xl: 2rem;
            /* 32px */
            --space-2xl: 3rem;
            /* 48px */
            --space-3xl: 4rem;
            /* 64px */

            /* Border Radius */
            --radius-xs: 0.25rem;
            --radius-sm: 0.375rem;
            /* Sedikit lebih kecil dari 0.5 untuk tampilan lebih tajam */
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-full: 9999px;

            /* Bayangan */
            --shadow-xs: 0 1px 2px hsla(0, 0%, 0%, 0.04);
            --shadow-sm: 0 2px 4px hsla(0, 0%, 0%, 0.08);
            --shadow-md: 0 4px 8px hsla(0, 0%, 0%, 0.12);
            --shadow-lg: 0 8px 16px hsla(0, 0%, 0%, 0.16);
            --shadow-xl: 0 12px 24px hsla(0, 0%, 0%, 0.2);
            --shadow-inner: inset 0 2px 4px hsla(0, 0%, 0%, 0.06);
            --shadow-focus: 0 0 0 3px var(--color-focus);

            /* Transisi */
            --transition-fast: all 0.15s ease-in-out;
            --transition-normal: all 0.3s ease-in-out;
            --transition-slow: all 0.5s ease-in-out;
            --transition-transform: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);

            /* Z-index Hirarki */
            --z-index-dropdown: 1000;
            --z-index-sticky: 1020;
            --z-index-fixed: 1030;
            --z-index-modal-backdrop: 1040;
            --z-index-modal: 1050;
            --z-index-popover: 1060;
            --z-index-tooltip: 1070;
            --z-index-toast: 1080;

            /* Ukuran Sidebar */
            --sidebar-width: 280px;
            --sidebar-width-collapsed: 80px;
            --header-height: 60px;
            /* Perkiraan tinggi header */
        }

        [data-theme="dark"] {
            --color-primary: hsl(215, 70%, 60%);
            --color-primary-dark: hsl(215, 70%, 50%);
            --color-primary-light: hsl(215, 70%, 25%);
            --color-primary-hover: hsl(215, 70%, 55%);
            --color-primary-focus-ring: hsla(215, 70%, 60%, 0.3);

            --color-accent: hsl(35, 80%, 60%);
            --color-accent-light: hsl(35, 80%, 20%);

            --color-bg: var(--color-neutral-900);
            --color-bg-alt: var(--color-neutral-800);
            --color-bg-card: var(--color-neutral-800);
            --color-bg-sidebar: hsl(218, 30%, 15%);
            /* Sidebar di dark mode */
            --color-bg-sidebar-hover: hsl(218, 30%, 22%);
            --color-bg-sidebar-active: var(--color-primary);


            --color-text: var(--color-neutral-50);
            --color-text-muted: var(--color-neutral-400);
            --color-text-sidebar: hsla(0, 0%, 100%, 0.8);
            --color-text-sidebar-active: var(--color-neutral-0);

            --color-border: var(--color-neutral-700);
            --color-border-dark: var(--color-neutral-600);
            --color-hover: var(--color-neutral-700);
            --color-active: var(--color-neutral-600);
        }

        /* Reset dan Base Styles */
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            /* Basis untuk rem */
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color var(--transition-normal), color var(--transition-normal);
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-weight: var(--font-weight-semibold);
            line-height: 1.3;
            color: var(--color-text);
            /* Pastikan heading juga berubah warna di dark mode */
        }

        h1 {
            font-size: var(--font-2xl);
            margin-bottom: var(--space-lg);
        }

        h2 {
            font-size: var(--font-xl);
            margin-bottom: var(--space-md);
        }

        h3 {
            font-size: var(--font-lg);
            margin-bottom: var(--space-sm);
        }

        a {
            color: var(--color-primary);
            text-decoration: none;
            transition: color var(--transition-fast);
        }

        a:hover {
            color: var(--color-primary-dark);
        }

        img,
        svg,
        video {
            max-width: 100%;
            height: auto;
            display: block;
        }

        ul,
        ol {
            list-style: none;
        }

        /* Utilitas Global */
        .container {
            width: 100%;
            max-width: 1440px;
            margin-left: auto;
            margin-right: auto;
            padding-left: var(--space-lg);
            padding-right: var(--space-lg);
        }

        .l-flex {
            display: flex;
        }

        .l-grid {
            display: grid;
        }

        .gap-xxs {
            gap: var(--space-xxs);
        }

        .gap-xs {
            gap: var(--space-xs);
        }

        .gap-sm {
            gap: var(--space-sm);
        }

        .gap-md {
            gap: var(--space-md);
        }

        .gap-lg {
            gap: var(--space-lg);
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-center {
            justify-content: center;
        }

        .justify-end {
            justify-content: flex-end;
        }

        .align-center {
            align-items: center;
        }

        .align-start {
            align-items: flex-start;
        }

        .flex-col {
            flex-direction: column;
        }

        .flex-wrap {
            flex-wrap: wrap;
        }

        .flex-grow {
            flex-grow: 1;
        }

        .w-full {
            width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .text-muted {
            color: var(--color-text-muted);
        }

        .text-bold {
            font-weight: var(--font-weight-bold);
        }

        .text-semibold {
            font-weight: var(--font-weight-semibold);
        }

        .text-primary {
            color: var(--color-primary);
        }

        .text-success {
            color: var(--color-success);
        }

        .text-danger {
            color: var(--color-danger);
        }

        .text-warning {
            color: var(--color-warning);
        }

        .text-info {
            color: var(--color-info);
        }

        .text-xs {
            font-size: var(--font-xs);
        }

        .text-sm {
            font-size: var(--font-sm);
        }

        .text-lg {
            font-size: var(--font-lg);
        }

        .text-xl {
            font-size: var(--font-xl);
        }

        .mb-0 {
            margin-bottom: 0;
        }

        .mb-xs {
            margin-bottom: var(--space-xs);
        }

        .mb-sm {
            margin-bottom: var(--space-sm);
        }

        .mb-md {
            margin-bottom: var(--space-md);
        }

        .mb-lg {
            margin-bottom: var(--space-lg);
        }

        .mt-xs {
            margin-top: var(--space-xs);
        }

        .mt-sm {
            margin-top: var(--space-sm);
        }

        .mt-md {
            margin-top: var(--space-md);
        }

        .mt-lg {
            margin-top: var(--space-lg);
        }

        .mt-auto {
            margin-top: auto;
        }

        .p-0 {
            padding: 0;
        }

        .py-sm {
            padding-top: var(--space-sm);
            padding-bottom: var(--space-sm);
        }

        .px-md {
            padding-left: var(--space-md);
            padding-right: var(--space-md);
        }

        .hidden {
            display: none !important;
        }

        .sr-only {
            /* Screen Reader Only */
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        .grid-auto-fill-240 {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: var(--space-md);
        }

        .grid-2fr-1fr {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--space-lg);
        }

        @media (max-width: 992px) {

            /* Tablet and smaller */
            .grid-2fr-1fr {
                grid-template-columns: 1fr;
            }
        }

        /* Komponen: Tombol (Button) */
        .c-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-xs);
            padding: var(--space-sm) var(--space-lg);
            font-family: var(--font-main);
            font-size: var(--font-sm);
            font-weight: var(--font-weight-medium);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition-fast);
            text-align: center;
            white-space: nowrap;
            border: 1px solid transparent;
            min-height: 40px;
            /* Ensure consistent height */
            box-shadow: var(--shadow-xs);
        }

        .c-button:focus-visible {
            outline: 2px solid var(--color-primary-focus-ring);
            outline-offset: 2px;
        }

        .c-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .c-button.btn-primary {
            background-color: var(--color-primary);
            color: var(--color-text-light);
            border-color: var(--color-primary);
        }

        .c-button.btn-primary:hover:not(:disabled) {
            background-color: var(--color-primary-hover);
            border-color: var(--color-primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .c-button.btn-outline {
            background-color: transparent;
            color: var(--color-primary);
            border-color: var(--color-primary);
            box-shadow: none;
        }

        .c-button.btn-outline:hover:not(:disabled) {
            background-color: var(--color-primary-light);
            color: var(--color-primary-dark);
            border-color: var(--color-primary-dark);
        }

        [data-theme="dark"] .c-button.btn-outline:hover:not(:disabled) {
            background-color: var(--color-primary-light);
            /* Menggunakan var light dari tema gelap */
            color: var(--color-primary);
        }


        .c-button.btn-danger {
            background-color: var(--color-danger);
            color: var(--color-text-light);
            border-color: var(--color-danger);
        }

        .c-button.btn-danger:hover:not(:disabled) {
            background-color: var(--color-danger-dark);
            border-color: var(--color-danger-dark);
        }


        .c-button.btn-sm {
            padding: var(--space-xs) var(--space-md);
            font-size: var(--font-xs);
            min-height: 32px;
        }

        .c-button.btn-icon {
            /* Tombol hanya ikon */
            padding: var(--space-xs);
            min-width: 32px;
            /* atau var(--space-lg) */
            min-height: 32px;
        }

        /* Komponen: Badge */
        .c-badge {
            display: inline-block;
            padding: var(--space-xxs) var(--space-xs);
            font-size: var(--font-xxs);
            font-weight: var(--font-weight-medium);
            border-radius: var(--radius-full);
            line-height: 1;
            text-transform: capitalize;
        }

        .badge-notification {
            /* Untuk notifikasi di atas ikon */
            position: absolute;
            top: -var(--space-xs);
            right: -var(--space-xs);
            background-color: var(--color-danger);
            color: var(--color-text-light);
            border-radius: var(--radius-full);
            font-size: var(--font-xxs);
            padding: 2px 5px;
            line-height: 1;
            min-width: 18px;
            text-align: center;
        }

        /* Warna badge sesuai status */
        .badge-aktif,
        .badge-tersedia,
        .badge-selesai,
        .badge-rendah {
            background-color: var(--color-success-light);
            color: var(--color-success-dark);
        }

        .badge-menunggu,
        .badge-perbaikan,
        .badge-akan-berakhir,
        .badge-tinggi,
        .badge-proses {
            background-color: var(--color-warning-light);
            color: var(--color-warning-dark);
        }

        .badge-nonaktif,
        .badge-darurat {
            background-color: var(--color-danger-light);
            color: var(--color-danger-dark);
        }

        .badge-ditempati,
        .badge-baru,
        .badge-sedang {
            background-color: var(--color-info-light);
            color: var(--color-info-dark);
        }

        /* Warna teks badge untuk metode pembayaran (digunakan pada tabel) */
        .text-transfer {
            color: var(--color-info-dark);
        }

        .text-qris {
            color: var(--color-accent);
        }

        .text-tunai {
            color: var(--color-success-dark);
        }

        /* Background badge untuk metode pembayaran */
        .bg-transfer {
            background-color: var(--color-info-light);
        }

        .bg-qris {
            background-color: var(--color-accent-light);
        }

        .bg-tunai {
            background-color: var(--color-success-light);
        }


        /* Komponen: Avatar */
        .c-avatar {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-full);
            background-color: var(--color-primary);
            color: var(--color-text-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: var(--font-weight-medium);
            font-size: var(--font-sm);
            overflow: hidden;
            /* Jika menggunakan gambar */
        }

        .c-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Komponen: Tooltip */
        .c-tooltip-wrapper {
            /* Wrapper untuk posisi relatif */
            position: relative;
            display: inline-block;
            /* Atau block, sesuai kebutuhan */
        }

        .c-tooltip {
            position: absolute;
            bottom: 100%;
            /* Posisi di atas elemen */
            left: 50%;
            transform: translateX(-50%) translateY(-var(--space-xs));
            /* Sedikit jarak */
            background-color: var(--color-neutral-800);
            color: var(--color-neutral-50);
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
            font-size: var(--font-xs);
            white-space: nowrap;
            z-index: var(--z-index-tooltip);
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-fast), visibility var(--transition-fast), transform var(--transition-fast);
            pointer-events: none;
            /* Agar tidak mengganggu interaksi dengan elemen di bawahnya */
        }

        .c-tooltip-wrapper:hover .c-tooltip,
        .c-tooltip-wrapper:focus-within .c-tooltip {
            /* Tampil saat hover atau focus pada wrapper */
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-var(--space-sm));
            /* Efek naik sedikit */
        }


        /* Layout Utama: Header */
        .c-header {
            background-color: var(--color-bg-sidebar);
            /* Header mengikuti warna sidebar */
            color: var(--color-text-light);
            padding: 0 var(--space-lg);
            /* Padding horizontal saja */
            height: var(--header-height);
            position: sticky;
            top: 0;
            z-index: var(--z-index-sticky);
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1440px;
            /* Samakan dengan .container jika perlu */
            margin: 0 auto;
        }

        .logo {
            font-size: var(--font-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-light);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            transition: opacity var(--transition-fast);
        }

        .logo:hover {
            opacity: 0.85;
        }

        .logo-icon {
            font-size: 1.2em;
        }

        .mobile-menu-toggle {
            display: none;
            /* Sembunyikan di desktop */
            color: var(--color-text-light);
            font-size: var(--font-lg);
        }

        /* Layout Utama: Dashboard (Struktur Halaman) */
        .app-layout {
            display: flex;
            flex-grow: 1;
            /* Mengisi sisa tinggi body */
        }

        /* Komponen: Sidebar */
        .c-sidebar {
            background-color: var(--color-bg-sidebar);
            color: var(--color-text-sidebar);
            width: var(--sidebar-width);
            min-height: calc(100vh - var(--header-height));
            /* Tinggi sisa viewport */
            position: sticky;
            top: var(--header-height);
            /* Mulai di bawah header */
            padding: var(--space-lg) var(--space-md);
            overflow-y: auto;
            transition: width var(--transition-normal), padding var(--transition-normal);
            z-index: var(--z-index-fixed);
            /* Di bawah header, di atas konten */
            display: flex;
            flex-direction: column;
        }

        .c-sidebar.collapsed {
            width: var(--sidebar-width-collapsed);
            padding-left: var(--space-sm);
            padding-right: var(--space-sm);
        }

        .c-sidebar.collapsed .sidebar-logo .logo-text,
        .c-sidebar.collapsed .nav-text {
            display: none;
        }

        .c-sidebar.collapsed .sidebar-toggle i {
            transform: rotate(180deg);
        }

        .c-sidebar.collapsed .c-sidebar-nav .nav-item {
            justify-content: center;
        }


        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-lg);
            padding: 0 var(--space-xs);
            /* Konsistensi padding */
        }

        .sidebar-logo .logo-icon {
            display: none;
        }

        /* Logo utama di header */
        .c-sidebar.collapsed .sidebar-logo .logo-icon {
            display: inline;
        }

        /* Tampil ikon saat collapsed */


        .sidebar-toggle {
            background: none;
            border: none;
            color: var(--color-text-sidebar);
            cursor: pointer;
            font-size: var(--font-md);
            padding: var(--space-xs);
            border-radius: var(--radius-sm);
            transition: background-color var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
        }

        .sidebar-toggle:hover {
            background-color: var(--color-bg-sidebar-hover);
        }

        .sidebar-toggle i {
            transition: transform var(--transition-normal);
        }

        .c-sidebar-nav ul {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }

        .c-sidebar-nav .nav-item {
            color: var(--color-text-sidebar);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-sm);
            transition: background-color var(--transition-fast), color var(--transition-fast);
            text-decoration: none;
            font-size: var(--font-sm);
            font-weight: var(--font-weight-medium);
        }

        .c-sidebar-nav .nav-item:hover {
            background-color: var(--color-bg-sidebar-hover);
            color: var(--color-text-light);
        }

        .c-sidebar-nav .nav-item.active {
            background-color: var(--color-bg-sidebar-active);
            color: var(--color-text-sidebar-active);
            font-weight: var(--font-weight-semibold);
        }

        .c-sidebar-nav .nav-item .nav-icon {
            width: 20px;
            /* Jaga konsistensi ukuran ikon */
            text-align: center;
            font-size: var(--font-md);
        }

        /* Layout Utama: Konten Utama */
        .main-content {
            flex-grow: 1;
            padding: var(--space-xl);
            background-color: var(--color-bg-alt);
            /* Sedikit beda dari body untuk kontras */
            overflow-y: auto;
            /* Konten bisa scroll jika panjang */
            min-height: calc(100vh - var(--header-height));
            /* Agar footer (jika ada) tidak naik */
        }

        .main-content section {
            /* Untuk SPA */
            animation: fadeIn 0.5s ease-out forwards;
        }

        /* Komponen: Hero Section */
        .c-hero {
            min-height: 280px;
            /* Lebih kecil dari sebelumnya */
            border-radius: var(--radius-lg);
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
            display: flex;
            align-items: center;
            box-shadow: var(--shadow-lg);
            color: var(--color-text-light);
            padding: var(--space-2xl) var(--space-xl);
            margin-bottom: var(--space-xl);
        }

        .hero-content {
            max-width: 700px;
        }

        .hero-title {
            font-size: var(--font-3xl);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--space-md);
            line-height: 1.2;
            color: var(--color-text-light);
            /* Pastikan warna teks kontras */
        }

        .hero-desc {
            font-size: var(--font-lg);
            margin-bottom: var(--space-lg);
            color: hsla(0, 0%, 100%, 0.9);
            max-width: 90%;
            /* Agar tidak terlalu lebar */
        }

        /* Komponen: Card */
        .c-card {
            background-color: var(--color-bg-card);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            box-shadow: var(--shadow-sm);
            transition: var(--transition-fast);
            border: 1px solid var(--color-border);
        }

        .c-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .c-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--color-border);
        }

        .c-card-title {
            font-size: var(--font-lg);
            font-weight: var(--font-weight-semibold);
            margin: 0;
            color: var(--color-text);
            /* Mengikuti tema */
        }

        .c-card-body {
            /* Padding tambahan jika perlu, atau biarkan konten card yang mengaturnya */
        }

        /* Komponen: Tabel */
        .c-table-wrapper {
            /* Untuk shadow dan border-radius yang benar */
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--color-border);
        }

        .c-table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--color-bg-card);
        }

        .c-table th,
        .c-table td {
            padding: var(--space-md);
            text-align: left;
            vertical-align: middle;
            border-bottom: 1px solid var(--color-border);
        }

        .c-table th {
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            /* Mengikuti tema */
            font-size: var(--font-xs);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background-color: var(--color-neutral-50);
            /* Header tabel sedikit beda */
        }

        [data-theme="dark"] .c-table th {
            background-color: var(--color-neutral-700);
        }

        .c-table td {
            font-size: var(--font-sm);
            color: var(--color-text-muted);
        }

        .c-table tr:last-child td {
            border-bottom: none;
            /* Hilangkan border untuk baris terakhir */
        }

        .c-table tbody tr:hover {
            background-color: var(--color-hover);
        }

        .table-responsive {
            /* Untuk tabel yang lebar */
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            /* Momentum scroll di iOS */
        }


        /* Komponen: Form */
        .c-form {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }

        .form-label {
            font-weight: var(--font-weight-medium);
            font-size: var(--font-sm);
            color: var(--color-text);
        }

        .form-label.form-required::after {
            content: " *";
            color: var(--color-danger);
            font-weight: var(--font-weight-normal);
        }

        .c-input,
        .c-select,
        .c-textarea {
            padding: var(--space-sm);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: var(--font-sm);
            font-family: var(--font-main);
            background-color: var(--color-bg-card);
            /* Bisa juga --color-bg-alt atau --color-bg */
            color: var(--color-text);
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
            width: 100%;
        }

        .c-input::placeholder,
        .c-textarea::placeholder {
            color: var(--color-neutral-400);
            opacity: 1;
            /* Firefox */
        }

        .c-input:focus,
        .c-select:focus,
        .c-textarea:focus {
            border-color: var(--color-primary);
            outline: none;
            box-shadow: var(--shadow-focus);
        }

        .c-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-error {
            color: var(--color-danger);
            font-size: var(--font-xs);
            margin-top: var(--space-xxs);
            min-height: 1em;
            /* Agar layout tidak bergeser saat error muncul/hilang */
        }

        .input-group {
            /* Untuk ikon di dalam input */
            position: relative;
        }

        .input-group .input-icon {
            position: absolute;
            top: 50%;
            left: var(--space-sm);
            transform: translateY(-50%);
            color: var(--color-text-muted);
            pointer-events: none;
            /* Agar ikon tidak bisa diklik */
        }

        .input-group .c-input {
            padding-left: calc(var(--space-sm) + var(--space-md) + var(--space-xs));
            /* Space ikon + padding normal */
        }

        /* Gaya untuk pilihan metode pembayaran */
        .payment-method-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: var(--space-sm);
        }

        .payment-method {
            /* Tombol-like */
            padding: var(--space-sm);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            flex-direction: column;
            /* Ikon di atas teks */
            align-items: center;
            gap: var(--space-xs);
            font-size: var(--font-xs);
            background-color: var(--color-bg-card);
            color: var(--color-text-muted);
        }

        .payment-method i {
            font-size: var(--font-lg);
        }

        .payment-method:hover {
            border-color: var(--color-primary-dark);
            color: var(--color-primary-dark);
        }

        .payment-method.active {
            border-color: var(--color-primary);
            background-color: var(--color-primary-light);
            color: var(--color-primary-dark);
            box-shadow: var(--shadow-focus);
        }

        [data-theme="dark"] .payment-method.active {
            background-color: var(--color-primary-light);
            /* Warna light dari tema dark */
            color: var(--color-primary);
        }


        /* Komponen: Modal */
        .c-modal {
            position: fixed;
            inset: 0;
            /* top, right, bottom, left = 0 */
            background-color: hsla(0, 0%, 0%, 0.6);
            display: flex;
            /* Defaultnya hidden, diubah oleh JS */
            align-items: center;
            justify-content: center;
            z-index: var(--z-index-modal);
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-normal), visibility var(--transition-normal);
            backdrop-filter: blur(3px);
        }

        .c-modal.open {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--color-bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: var(--shadow-xl);
            transform: translateY(20px) scale(0.95);
            transition: transform var(--transition-normal) ease-out;
        }

        .c-modal.open .modal-content {
            transform: translateY(0) scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--color-border);
        }

        .modal-title {
            font-size: var(--font-xl);
            margin-bottom: 0;
            /* Dihandle oleh modal-header */
        }

        .modal-close {
            background: none;
            border: none;
            font-size: var(--font-xl);
            color: var(--color-text-muted);
            cursor: pointer;
            padding: var(--space-xs);
            line-height: 1;
            border-radius: var(--radius-full);
            transition: color var(--transition-fast), background-color var(--transition-fast);
        }

        .modal-close:hover {
            color: var(--color-danger);
            background-color: var(--color-danger-light);
        }

        .modal-body {
            margin-bottom: var(--space-lg);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: var(--space-sm);
            padding-top: var(--space-md);
            border-top: 1px solid var(--color-border);
        }

        /* Komponen: Toast Notification */
        .c-toast {
            position: fixed;
            bottom: var(--space-lg);
            right: var(--space-lg);
            padding: var(--space-md);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            z-index: var(--z-index-toast);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity var(--transition-normal), transform var(--transition-normal);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            min-width: 250px;
            max-width: 400px;
            pointer-events: none;
            /* Default, diubah saat 'show' */
        }

        .c-toast.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .toast-icon {
            font-size: var(--font-lg);
        }

        .toast-message {
            flex-grow: 1;
            font-size: var(--font-sm);
        }

        .toast-close {
            background: none;
            border: none;
            color: inherit;
            /* Warna teks dari toast parent */
            opacity: 0.7;
            cursor: pointer;
            font-size: var(--font-md);
            padding: var(--space-xxs);
        }

        .toast-close:hover {
            opacity: 1;
        }

        /* Warna Toast */
        .toast-success {
            background-color: var(--color-success);
            color: var(--color-text-light);
        }

        .toast-danger {
            background-color: var(--color-danger);
            color: var(--color-text-light);
        }

        .toast-warning {
            background-color: var(--color-warning);
            color: var(--color-neutral-900);
        }

        /* Warna teks lebih gelap untuk kontras */
        .toast-info {
            background-color: var(--color-info);
            color: var(--color-text-light);
        }


        /* Komponen: Empty State (untuk tabel kosong, dll.) */
        .c-empty-state {
            text-align: center;
            padding: var(--space-2xl) var(--space-lg);
            color: var(--color-text-muted);
            border: 2px dashed var(--color-border);
            border-radius: var(--radius-md);
            background-color: var(--color-neutral-50);
        }

        [data-theme="dark"] .c-empty-state {
            background-color: var(--color-neutral-800);
            /* Slightly different from card bg */
        }

        .empty-state-icon {
            font-size: var(--font-4xl);
            margin-bottom: var(--space-md);
            color: var(--color-neutral-400);
        }

        .empty-state-title {
            font-size: var(--font-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-bottom: var(--space-xs);
        }

        .empty-state-text {
            font-size: var(--font-sm);
            margin-bottom: var(--space-lg);
        }


        /* Responsif */
        @media (max-width: 1024px) {

            /* Tablet dan di bawahnya */
            .c-sidebar {
                position: fixed;
                left: 0;
                top: var(--header-height);
                /* Di bawah header */
                transform: translateX(-100%);
                height: calc(100vh - var(--header-height));
                box-shadow: var(--shadow-lg);
                /* Tidak perlu collapsed state di mobile, selalu full atau hidden */
            }

            .c-sidebar.open {
                transform: translateX(0);
            }

            .c-sidebar.collapsed {
                /* Abaikan collapsed di mobile */
                width: var(--sidebar-width);
                padding: var(--space-lg) var(--space-md);
            }

            .c-sidebar.collapsed .sidebar-logo .logo-text,
            .c-sidebar.collapsed .nav-text {
                display: inline-block;
                /* Selalu tampilkan teks */
            }

            .c-sidebar.collapsed .sidebar-toggle i {
                transform: rotate(0deg);
                /* Tidak ada rotasi */
            }

            .c-sidebar.collapsed .c-sidebar-nav .nav-item {
                justify-content: flex-start;
            }


            .main-content {
                /* margin-left: 0; Tidak perlu jika sidebar overlay */
                width: 100%;
                /* Main content selalu full width */
            }

            .mobile-menu-toggle {
                display: inline-flex;
                /* Tampilkan tombol menu di mobile */
            }

            .sidebar-toggle {
                /* Tombol collapse di sidebar bisa disembunyikan di mobile */
                display: none;
            }

            .sidebar-header .sidebar-logo {
                display: none;
                /* Logo di sidebar header disembunyikan di mobile, karena sudah ada di header utama */
            }
        }

        @media (max-width: 768px) {

            /* Mobile */
            .container {
                padding-left: var(--space-md);
                padding-right: var(--space-md);
            }

            .main-content {
                padding: var(--space-lg);
            }

            .c-hero {
                padding: var(--space-xl) var(--space-lg);
                min-height: auto;
            }

            .hero-title {
                font-size: var(--font-2xl);
            }

            .hero-desc {
                font-size: var(--font-md);
            }

            .l-flex.gap-sm.flex-wrap {
                /* Tombol di hero */
                flex-direction: column;
                align-items: stretch;
                /* Tombol full width */
            }

            .c-button {
                width: 100%;
                /* Tombol jadi full width di mobile jika dalam container flex-col */
            }

            .l-flex>.c-button,
            .l-grid>.c-button {
                /* Kecuali jika langsung child dari flex/grid */
                width: auto;
            }


            .modal-content {
                width: 95%;
                padding: var(--space-lg);
            }

            .payment-method-group {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }

        /* Animasi */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
    </style>
</head>

<body>
    <header class="c-header" role="banner">
        <div class="header-container">
            <button class="c-button btn-icon btn-outline mobile-menu-toggle" aria-label="Buka menu navigasi"
                aria-expanded="false" aria-controls="sidebar">
                <i class="fas fa-bars" aria-hidden="true"></i>
            </button>
            <a href="#dashboard" class="logo" aria-label="Green Valley Beranda">
                <span class="logo-icon" aria-hidden="true">üè†</span>
                <span class="logo-text">Green Valley</span>
            </a>
            <div class="l-flex align-center gap-sm">
                <div class="c-tooltip-wrapper">
                    <button class="c-button btn-icon btn-outline theme-toggle" aria-label="Ganti mode tampilan">
                        <i class="fas fa-moon" aria-hidden="true"></i>
                        <span class="sr-only" id="theme-status-sr">Mode saat ini: Terang</span>
                    </button>
                    <span class="c-tooltip" role="tooltip">Ganti Tema</span>
                </div>
                <div class="c-tooltip-wrapper">
                    <button class="c-button btn-icon btn-outline" aria-label="Notifikasi">
                        <i class="fas fa-bell" aria-hidden="true"></i>
                        <span class="badge-notification" id="notification-count">3</span>
                    </button>
                    <span class="c-tooltip" role="tooltip">Notifikasi</span>
                </div>
                <div class="c-tooltip-wrapper">
                    <button class="c-button btn-icon btn-outline p-0" aria-label="Profil Pengguna">
                        <div class="c-avatar" aria-hidden="true">A</div>
                    </button>
                    <span class="c-tooltip" role="tooltip">Profil</span>
                </div>
            </div>
        </div>
    </header>

    <div class="app-layout">
        <aside class="c-sidebar" id="sidebar" aria-label="Menu Navigasi Utama">
            <div class="sidebar-header">
                <a href="#dashboard" class="logo sidebar-logo" aria-label="Green Valley Beranda (Sidebar)">
                    <span class="logo-icon" aria-hidden="true">üè†</span>
                    <span class="logo-text">Green Valley</span>
                </a>
                <button class="sidebar-toggle c-button btn-icon btn-outline" aria-label="Ciutkan/Luaskan Sidebar"
                    aria-expanded="true">
                    <i class="fas fa-chevron-left" aria-hidden="true"></i>
                </button>
            </div>
            <nav class="c-sidebar-nav flex-grow">
                <ul>
                    <li><a href="#dashboard" class="nav-item active" data-section="dashboard"><i
                                class="fas fa-home nav-icon" aria-hidden="true"></i><span
                                class="nav-text">Beranda</span></a></li>
                    <li><a href="#penyewa" class="nav-item" data-section="penyewa"><i class="fas fa-users nav-icon"
                                aria-hidden="true"></i><span class="nav-text">Penyewa</span></a></li>
                    <li><a href="#unit" class="nav-item" data-section="unit"><i class="fas fa-building nav-icon"
                                aria-hidden="true"></i><span class="nav-text">Unit Properti</span></a></li>
                    <li><a href="#pembayaran" class="nav-item" data-section="pembayaran"><i
                                class="fas fa-credit-card nav-icon" aria-hidden="true"></i><span
                                class="nav-text">Pembayaran</span></a></li>
                    <li><a href="#kontrak" class="nav-item" data-section="kontrak"><i
                                class="fas fa-file-contract nav-icon" aria-hidden="true"></i><span
                                class="nav-text">Kontrak Sewa</span></a></li>
                    <li><a href="#pemeliharaan" class="nav-item" data-section="pemeliharaan"><i
                                class="fas fa-tools nav-icon" aria-hidden="true"></i><span
                                class="nav-text">Pemeliharaan</span></a></li>
                </ul>
            </nav>
            <div class="c-sidebar-footer mt-auto">
                <a href="#" class="nav-item" id="logout-button"><i class="fas fa-sign-out-alt nav-icon"
                        aria-hidden="true"></i><span class="nav-text">Keluar</span></a>
            </div>
        </aside>

        <main class="main-content" id="main-content" tabindex="-1" role="main">
            <!-- Konten SPA akan dimuat di sini oleh JavaScript -->
            <section id="dashboard" class="app-section">
                <header class="c-hero">
                    <div class="hero-content">
                        <h1 class="hero-title">Selamat Datang di Green Valley!</h1>
                        <p class="hero-desc">Kelola properti sewa Anda dengan lebih efisien. Pantau unit, penyewa,
                            pembayaran, dan lainnya, semua dalam satu tempat.</p>
                        <div class="l-flex gap-sm flex-wrap">
                            <button class="c-button btn-primary"
                                onclick="app.navigateTo('penyewa', { openModal: 'add-tenant-modal' })"><i
                                    class="fas fa-user-plus" aria-hidden="true"></i> Tambah Penyewa Baru</button>
                            <button class="c-button btn-outline"
                                onclick="app.navigateTo('unit', { openModal: 'add-unit-modal' })"><i
                                    class="fas fa-plus-circle" aria-hidden="true"></i> Tambah Unit Baru</button>
                        </div>
                    </div>
                </header>

                <div class="container p-0">
                    <!-- Container di dalam main-content jika diperlukan, atau biarkan full width -->
                    <h2 class="text-xl text-semibold mb-lg">Ringkasan Properti Anda</h2>
                    <div class="l-grid grid-auto-fill-240 mb-lg">
                        <div class="c-card">
                            <div class="l-flex align-center justify-between">
                                <div>
                                    <h3 class="text-muted text-sm mb-xs">Total Unit</h3>
                                    <p id="db-total-units" class="text-xl text-bold">0</p>
                                </div>
                                <div class="c-badge badge-baru"><i class="fas fa-building" aria-hidden="true"></i></div>
                            </div>
                        </div>
                        <div class="c-card">
                            <div class="l-flex align-center justify-between">
                                <div>
                                    <h3 class="text-muted text-sm mb-xs">Unit Ditempati</h3>
                                    <p id="db-rented-units" class="text-xl text-bold">0</p>
                                </div>
                                <div class="c-badge badge-ditempati"><i class="fas fa-house-user"
                                        aria-hidden="true"></i></div>
                            </div>
                        </div>
                        <div class="c-card">
                            <div class="l-flex align-center justify-between">
                                <div>
                                    <h3 class="text-muted text-sm mb-xs">Unit Tersedia</h3>
                                    <p id="db-vacant-units" class="text-xl text-bold">0</p>
                                </div>
                                <div class="c-badge badge-tersedia"><i class="fas fa-key" aria-hidden="true"></i></div>
                            </div>
                        </div>
                        <div class="c-card">
                            <div class="l-flex align-center justify-between">
                                <div>
                                    <h3 class="text-muted text-sm mb-xs">Total Penyewa Aktif</h3>
                                    <p id="db-active-tenants" class="text-xl text-bold">0</p>
                                </div>
                                <div class="c-badge badge-aktif"><i class="fas fa-users" aria-hidden="true"></i></div>
                            </div>
                        </div>
                    </div>

                    <div class="c-card">
                        <div class="c-card-header">
                            <h3 class="c-card-title">Penyewa Akan Jatuh Tempo</h3>
                            <button class="c-button btn-primary btn-sm" onclick="app.navigateTo('kontrak')">Lihat Semua
                                Kontrak <i class="fas fa-arrow-right" aria-hidden="true"></i></button>
                        </div>
                        <div class="table-responsive">
                            <table class="c-table" aria-label="Penyewa dengan kontrak akan jatuh tempo">
                                <thead>
                                    <tr>
                                        <th>Nama Penyewa</th>
                                        <th>Unit</th>
                                        <th>Tanggal Selesai Kontrak</th>
                                        <th>Sisa Hari</th>
                                    </tr>
                                </thead>
                                <tbody id="db-expiring-contracts-table">
                                    <!-- Data diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <section id="penyewa" class="app-section" hidden>
                <div class="l-flex justify-between align-center mb-lg flex-wrap gap-md">
                    <div>
                        <h1 class="mb-xs">Manajemen Penyewa</h1>
                        <p class="text-muted">Kelola data penyewa, histori sewa, dan informasi kontak.</p>
                    </div>
                    <button class="c-button btn-primary" onclick="app.ui.openModal('add-tenant-modal')"><i
                            class="fas fa-user-plus" aria-hidden="true"></i> Tambah Penyewa</button>
                </div>
                <div class="c-card">
                    <div class="c-card-header">
                        <h3 class="c-card-title">Daftar Penyewa</h3>
                        <div class="l-flex align-center gap-md flex-wrap"
                            style="flex-grow: 1; justify-content: flex-end;">
                            <div class="input-group" style="max-width: 300px;">
                                <span class="input-icon"><i class="fas fa-search"></i></span>
                                <input type="text" class="c-input c-input-sm" id="tenant-filter-text"
                                    placeholder="Cari nama atau email..." aria-label="Cari penyewa">
                            </div>
                            <select class="c-select c-input-sm" id="tenant-filter-status"
                                aria-label="Filter status penyewa" style="min-width: 180px;">
                                <option value="">Semua Status</option>
                                <option value="Aktif">Aktif</option>
                                <option value="Menunggu Pembayaran">Menunggu Pembayaran</option>
                                <option value="Nonaktif">Nonaktif</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="c-table" aria-label="Daftar semua penyewa">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nama</th>
                                    <th>Email</th>
                                    <th>Telepon</th>
                                    <th>Unit Ditempati</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="tenants-table-body">
                                <!-- Data diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <div id="tenants-empty-state" class="hidden">
                        <!-- Placeholder untuk empty state, diisi oleh JS -->
                    </div>
                </div>
            </section>

            <section id="unit" class="app-section" hidden>
                <div class="l-flex justify-between align-center mb-lg flex-wrap gap-md">
                    <div>
                        <h1 class="mb-xs">Manajemen Unit Properti</h1>
                        <p class="text-muted">Kelola daftar unit, status ketersediaan, dan detail properti.</p>
                    </div>
                    <button class="c-button btn-primary" onclick="app.ui.openModal('add-unit-modal')"><i
                            class="fas fa-plus-circle" aria-hidden="true"></i> Tambah Unit</button>
                </div>
                <div class="c-card">
                    <div class="c-card-header">
                        <h3 class="c-card-title">Daftar Unit</h3>
                        <div class="l-flex align-center gap-md flex-wrap"
                            style="flex-grow: 1; justify-content: flex-end;">
                            <div class="input-group" style="max-width: 300px;">
                                <span class="input-icon"><i class="fas fa-search"></i></span>
                                <input type="text" class="c-input c-input-sm" id="unit-filter-text"
                                    placeholder="Cari kode atau nama unit..." aria-label="Cari unit">
                            </div>
                            <select class="c-select c-input-sm" id="unit-filter-status" aria-label="Filter status unit"
                                style="min-width: 180px;">
                                <option value="">Semua Status</option>
                                <option value="Tersedia">Tersedia</option>
                                <option value="Ditempati">Ditempati</option>
                                <option value="Perbaikan">Perbaikan</option>
                            </select>
                            <select class="c-select c-input-sm" id="unit-filter-type" aria-label="Filter tipe unit"
                                style="min-width: 180px;">
                                <option value="">Semua Tipe</option>
                                <option value="Kamar">Kamar</option>
                                <option value="Apartemen">Apartemen</option>
                                <option value="Rumah">Rumah</option>
                                <option value="Ruko">Ruko</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="c-table" aria-label="Daftar semua unit properti">
                            <thead>
                                <tr>
                                    <th>Kode</th>
                                    <th>Nama Unit</th>
                                    <th>Tipe</th>
                                    <th>Status</th>
                                    <th>Harga Sewa (Rp)</th>
                                    <th>Penyewa Saat Ini</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="units-table-body">
                                <!-- Data diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <div id="units-empty-state" class="hidden">
                        <!-- Placeholder untuk empty state, diisi oleh JS -->
                    </div>
                </div>
            </section>

            <section id="pembayaran" class="app-section" hidden>
                <div class="l-flex justify-between align-center mb-lg flex-wrap gap-md">
                    <div>
                        <h1 class="mb-xs">Manajemen Pembayaran</h1>
                        <p class="text-muted">Catat dan lacak semua transaksi pembayaran sewa.</p>
                    </div>
                    <button class="c-button btn-primary" onclick="app.ui.openModal('add-payment-modal')"><i
                            class="fas fa-file-invoice-dollar" aria-hidden="true"></i> Catat Pembayaran</button>
                </div>

                <div class="l-grid grid-2fr-1fr">
                    <div class="c-card">
                        <div class="c-card-header">
                            <h3 class="c-card-title">Formulir Pembayaran Baru</h3>
                        </div>
                        <div class="c-card-body">
                            <form id="payment-form" class="c-form">
                                <div class="form-group">
                                    <label for="payment-tenant-id" class="form-label form-required">Pilih
                                        Penyewa</label>
                                    <select id="payment-tenant-id" class="c-select" required>
                                        <option value="">-- Pilih Penyewa --</option>
                                        <!-- Opsi diisi oleh JavaScript -->
                                    </select>
                                    <div class="form-error" id="payment-tenant-id-error"></div>
                                </div>
                                <div class="form-group">
                                    <label for="payment-unit-id" class="form-label form-required">Unit Terkait</label>
                                    <select id="payment-unit-id" class="c-select" required disabled>
                                        <option value="">-- Pilih Unit (otomatis setelah pilih penyewa) --</option>
                                        <!-- Opsi diisi oleh JavaScript berdasarkan penyewa -->
                                    </select>
                                    <div class="form-error" id="payment-unit-id-error"></div>
                                </div>
                                <div class="form-group">
                                    <label for="payment-amount" class="form-label form-required">Jumlah Pembayaran
                                        (Rp)</label>
                                    <input type="number" id="payment-amount" class="c-input"
                                        placeholder="Contoh: 1500000" required min="1000">
                                    <div class="form-error" id="payment-amount-error"></div>
                                </div>
                                <div class="form-group">
                                    <label for="payment-date" class="form-label form-required">Tanggal
                                        Pembayaran</label>
                                    <input type="date" id="payment-date" class="c-input" required>
                                    <div class="form-error" id="payment-date-error"></div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label form-required">Metode Pembayaran</label>
                                    <div class="payment-method-group">
                                        <button type="button" class="payment-method active"
                                            data-method="Transfer Bank"><i class="fas fa-university"
                                                aria-hidden="true"></i> Transfer Bank</button>
                                        <button type="button" class="payment-method" data-method="QRIS"><i
                                                class="fas fa-qrcode" aria-hidden="true"></i> QRIS</button>
                                        <button type="button" class="payment-method" data-method="Tunai"><i
                                                class="fas fa-money-bill-wave" aria-hidden="true"></i> Tunai</button>
                                        <button type="button" class="payment-method" data-method="E-Wallet"><i
                                                class="fas fa-wallet" aria-hidden="true"></i> E-Wallet</button>
                                    </div>
                                    <input type="hidden" id="payment-method-value" value="Transfer Bank" required>
                                    <div class="form-error" id="payment-method-value-error"></div>
                                </div>
                                <div class="form-group">
                                    <label for="payment-notes" class="form-label">Catatan (Opsional)</label>
                                    <textarea id="payment-notes" class="c-textarea"
                                        placeholder="Informasi tambahan terkait pembayaran"></textarea>
                                </div>
                                <button type="submit" class="c-button btn-primary w-full"><i class="fas fa-check-circle"
                                        aria-hidden="true"></i> Simpan Pembayaran</button>
                            </form>
                        </div>
                    </div>
                    <div class="c-card">
                        <div class="c-card-header">
                            <h3 class="c-card-title">Riwayat Transaksi Terkini</h3>
                        </div>
                        <div class="c-card-body">
                            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                <table class="c-table" aria-label="Riwayat pembayaran terbaru">
                                    <thead>
                                        <tr>
                                            <th>Tanggal</th>
                                            <th>Penyewa</th>
                                            <th>Jumlah</th>
                                            <th>Metode</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recent-payments-table-body">
                                        <!-- Data diisi oleh JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            <div id="recent-payments-empty-state" class="hidden mt-md">
                                <!-- Placeholder untuk empty state, diisi oleh JS -->
                            </div>
                            <button class="c-button btn-outline w-full mt-md"
                                onclick="app.ui.openModal('all-payments-modal')"><i class="fas fa-list-ul"
                                    aria-hidden="true"></i> Lihat Semua Riwayat</button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="kontrak" class="app-section" hidden>
                <h1 class="mb-lg">Manajemen Kontrak Sewa</h1>
                <div class="c-card">
                    <div class="c-card-body">
                        <p class="text-muted">Fitur manajemen kontrak sewa akan segera hadir. Di sini Anda akan dapat
                            membuat, melacak, dan mengelola semua perjanjian sewa dengan penyewa Anda, termasuk
                            pengingat jatuh tempo dan perpanjangan kontrak.</p>
                        <div class="c-empty-state mt-lg">
                            <div class="empty-state-icon"><i class="fas fa-file-signature"></i></div>
                            <h3 class="empty-state-title">Segera Hadir</h3>
                            <p class="empty-state-text">Nantikan pembaruan fitur ini!</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="pemeliharaan" class="app-section" hidden>
                <h1 class="mb-lg">Jadwal & Laporan Pemeliharaan</h1>
                <div class="c-card">
                    <div class="c-card-body">
                        <p class="text-muted">Fitur pelacakan pemeliharaan properti sedang dalam pengembangan. Anda akan
                            dapat menjadwalkan perbaikan, mencatat biaya, dan menjaga kondisi unit tetap prima.</p>
                        <div class="c-empty-state mt-lg">
                            <div class="empty-state-icon"><i class="fas fa-tools"></i></div>
                            <h3 class="empty-state-title">Dalam Pengembangan</h3>
                            <p class="empty-state-text">Kami sedang bekerja keras untuk fitur ini!</p>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Modal Tambah/Edit Penyewa -->
    <div class="c-modal" id="add-tenant-modal" aria-labelledby="add-tenant-modal-title" aria-modal="true" role="dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="add-tenant-modal-title">Tambah Penyewa Baru</h2>
                <button class="modal-close" aria-label="Tutup modal" onclick="app.ui.closeModal('add-tenant-modal')"><i
                        class="fas fa-times" aria-hidden="true"></i></button>
            </div>
            <form id="tenant-form" class="c-form modal-body">
                <input type="hidden" id="tenant-id">
                <div class="form-group">
                    <label for="tenant-name" class="form-label form-required">Nama Lengkap</label>
                    <input type="text" id="tenant-name" class="c-input" required placeholder="Contoh: Budi Santoso">
                    <div class="form-error" id="tenant-name-error"></div>
                </div>
                <div class="form-group">
                    <label for="tenant-email" class="form-label form-required">Alamat Email</label>
                    <input type="email" id="tenant-email" class="c-input" required
                        placeholder="Contoh: budi.santoso@example.com">
                    <div class="form-error" id="tenant-email-error"></div>
                </div>
                <div class="form-group">
                    <label for="tenant-phone" class="form-label form-required">Nomor Telepon</label>
                    <input type="tel" id="tenant-phone" class="c-input" required placeholder="Contoh: 081234567890">
                    <div class="form-error" id="tenant-phone-error"></div>
                </div>
                <div class="form-group">
                    <label for="tenant-id-card" class="form-label">Nomor KTP (Opsional)</label>
                    <input type="text" id="tenant-id-card" class="c-input" placeholder="Contoh: 3201XXXXXXXXXXXX">
                </div>
                <div class="form-group">
                    <label for="tenant-address" class="form-label">Alamat Asal (Opsional)</label>
                    <textarea id="tenant-address" class="c-textarea" placeholder="Alamat lengkap penyewa"></textarea>
                </div>
                <div class="form-group">
                    <label for="tenant-status" class="form-label form-required">Status Penyewa</label>
                    <select id="tenant-status" class="c-select" required>
                        <option value="Aktif">Aktif</option>
                        <option value="Menunggu Pembayaran">Menunggu Pembayaran</option>
                        <option value="Nonaktif">Nonaktif</option>
                    </select>
                    <div class="form-error" id="tenant-status-error"></div>
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="c-button btn-outline"
                    onclick="app.ui.closeModal('add-tenant-modal')">Batal</button>
                <button type="submit" form="tenant-form" class="c-button btn-primary"><i class="fas fa-save"
                        aria-hidden="true"></i> Simpan Penyewa</button>
            </div>
        </div>
    </div>

    <!-- Modal Tambah/Edit Unit -->
    <div class="c-modal" id="add-unit-modal" aria-labelledby="add-unit-modal-title" aria-modal="true" role="dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="add-unit-modal-title">Tambah Unit Properti Baru</h2>
                <button class="modal-close" aria-label="Tutup modal" onclick="app.ui.closeModal('add-unit-modal')"><i
                        class="fas fa-times" aria-hidden="true"></i></button>
            </div>
            <form id="unit-form" class="c-form modal-body">
                <input type="hidden" id="unit-id">
                <div class="form-group">
                    <label for="unit-code" class="form-label form-required">Kode Unit</label>
                    <input type="text" id="unit-code" class="c-input" required placeholder="Contoh: KMR-A01, APT-B205">
                    <div class="form-error" id="unit-code-error"></div>
                </div>
                <div class="form-group">
                    <label for="unit-name" class="form-label form-required">Nama/Deskripsi Unit</label>
                    <input type="text" id="unit-name" class="c-input" required
                        placeholder="Contoh: Kamar Melati Lantai 2, Apartemen City View Tower B">
                    <div class="form-error" id="unit-name-error"></div>
                </div>
                <div class="form-group">
                    <label for="unit-type" class="form-label form-required">Tipe Unit</label>
                    <select id="unit-type" class="c-select" required>
                        <option value="">-- Pilih Tipe --</option>
                        <option value="Kamar">Kamar (Kos)</option>
                        <option value="Apartemen">Apartemen</option>
                        <option value="Rumah">Rumah</option>
                        <option value="Ruko">Ruko</option>
                        <option value="Lainnya">Lainnya</option>
                    </select>
                    <div class="form-error" id="unit-type-error"></div>
                </div>
                <div class="form-group">
                    <label for="unit-price" class="form-label form-required">Harga Sewa per Bulan (Rp)</label>
                    <input type="number" id="unit-price" class="c-input" required placeholder="Contoh: 2500000" min="0">
                    <div class="form-error" id="unit-price-error"></div>
                </div>
                <div class="form-group">
                    <label for="unit-status" class="form-label form-required">Status Unit</label>
                    <select id="unit-status" class="c-select" required>
                        <option value="Tersedia">Tersedia</option>
                        <option value="Ditempati">Ditempati</option>
                        <option value="Perbaikan">Dalam Perbaikan</option>
                        <option value="Tidak Tersedia">Tidak Tersedia</option>
                    </select>
                    <div class="form-error" id="unit-status-error"></div>
                </div>
                <div class="form-group">
                    <label for="unit-facilities" class="form-label">Fasilitas (pisahkan dengan koma)</label>
                    <input type="text" id="unit-facilities" class="c-input"
                        placeholder="Contoh: AC, WiFi, Kamar Mandi Dalam">
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="c-button btn-outline"
                    onclick="app.ui.closeModal('add-unit-modal')">Batal</button>
                <button type="submit" form="unit-form" class="c-button btn-primary"><i class="fas fa-save"
                        aria-hidden="true"></i> Simpan Unit</button>
            </div>
        </div>
    </div>

    <!-- Modal Catat Pembayaran (bisa jadi sama dengan form di section pembayaran, atau modal khusus) -->
    <div class="c-modal" id="add-payment-modal" aria-labelledby="add-payment-modal-title" aria-modal="true"
        role="dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="add-payment-modal-title">Catat Pembayaran Baru</h2>
                <button class="modal-close" aria-label="Tutup modal" onclick="app.ui.closeModal('add-payment-modal')"><i
                        class="fas fa-times" aria-hidden="true"></i></button>
            </div>
            <div id="modal-payment-form-container" class="modal-body">
                <!-- Form pembayaran dari section #pembayaran akan dicloning ke sini atau dibuat terpisah -->
            </div>
            <div class="modal-footer">
                <button type="button" class="c-button btn-outline"
                    onclick="app.ui.closeModal('add-payment-modal')">Batal</button>
                <button type="submit" form="payment-form-modal" class="c-button btn-primary"><i
                        class="fas fa-check-circle" aria-hidden="true"></i> Simpan Pembayaran</button>
            </div>
        </div>
    </div>

    <!-- Modal Lihat Semua Riwayat Pembayaran -->
    <div class="c-modal" id="all-payments-modal" aria-labelledby="all-payments-modal-title" aria-modal="true"
        role="dialog">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title" id="all-payments-modal-title">Semua Riwayat Pembayaran</h2>
                <button class="modal-close" aria-label="Tutup modal"
                    onclick="app.ui.closeModal('all-payments-modal')"><i class="fas fa-times"
                        aria-hidden="true"></i></button>
            </div>
            <div class="modal-body">
                <div class="l-flex justify-end mb-md">
                    <div class="input-group" style="max-width: 300px;">
                        <span class="input-icon"><i class="fas fa-search"></i></span>
                        <input type="text" class="c-input c-input-sm" id="all-payments-filter-text"
                            placeholder="Cari penyewa atau ID transaksi..." aria-label="Cari pembayaran">
                    </div>
                </div>
                <div class="table-responsive" style="max-height: 60vh;">
                    <table class="c-table" aria-label="Semua riwayat pembayaran">
                        <thead>
                            <tr>
                                <th>ID Transaksi</th>
                                <th>Tanggal</th>
                                <th>Penyewa</th>
                                <th>Unit</th>
                                <th>Jumlah (Rp)</th>
                                <th>Metode</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="all-payments-table-body">
                            <!-- Data diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div id="all-payments-empty-state" class="hidden"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="c-button btn-outline"
                    onclick="app.ui.closeModal('all-payments-modal')">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div class="c-toast" id="app-toast" role="alert" aria-live="assertive" aria-atomic="true">
        <span id="toast-icon" class="toast-icon" aria-hidden="true"></span>
        <span id="toast-message" class="toast-message"></span>
        <button class="toast-close" aria-label="Tutup notifikasi"><i class="fas fa-times"
                aria-hidden="true"></i></button>
    </div>

    <script>
        // Namespace utama aplikasi
        const app = {};

        // Konfigurasi Aplikasi
        app.config = {
            defaultSection: 'dashboard',
            dateFormat: { year: 'numeric', month: 'short', day: 'numeric' },
            currencyFormat: { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 },
            apiDelay: 300, // Simulasi delay API
        };

        // State Management
        app.state = {
            currentSection: app.config.defaultSection,
            isSidebarCollapsed: false,
            isMobileMenuOpen: false,
            theme: localStorage.getItem('theme') || 'light',
            tenants: [],
            units: [],
            payments: [],
            contracts: [], // Untuk masa depan
            maintenance: [], // Untuk masa depan
            nextTenantId: 1,
            nextUnitId: 1,
            nextPaymentId: 1,
        };

        // Utilitas
        app.utils = {
            $: (selector, context = document) => context.querySelector(selector),
            $$: (selector, context = document) => Array.from(context.querySelectorAll(selector)),
            debounce: (func, delay) => {
                let timeout;
                return (...args) => {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(this, args), delay);
                };
            },
            generateId: (prefix) => `${prefix}-${Date.now()}-${Math.random().toString(36).substr(2, 5)}`,
            formatDate: (dateString) => {
                if (!dateString) return '-';
                return new Date(dateString).toLocaleDateString('id-ID', app.config.dateFormat);
            },
            formatCurrency: (amount) => {
                if (typeof amount !== 'number') return '-';
                return amount.toLocaleString('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 });
            },
            getDaysDifference: (date1, date2) => {
                const d1 = new Date(date1);
                const d2 = new Date(date2);
                const diffTime = Math.abs(d2 - d1);
                return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            },
            getFormData: (formElement) => {
                const formData = new FormData(formElement);
                const data = {};
                for (const [key, value] of formData.entries()) {
                    data[key] = value.trim();
                }
                return data;
            },
            validateForm: (formElement, rules) => {
                let isValid = true;
                app.utils.$$('.form-error', formElement).forEach(el => el.textContent = ''); // Clear previous errors

                for (const fieldName in rules) {
                    const inputElement = app.utils.$(`[name="${fieldName}"], #${fieldName}`, formElement);
                    if (!inputElement) continue;

                    const value = inputElement.value.trim();
                    const ruleSet = rules[fieldName];
                    const errorElement = app.utils.$(`#${fieldName}-error`, formElement);

                    if (ruleSet.required && !value) {
                        isValid = false;
                        if (errorElement) errorElement.textContent = ruleSet.message || `${inputElement.previousElementSibling?.textContent || 'Kolom ini'} wajib diisi.`;
                        inputElement.focus(); // Fokus ke input pertama yang error
                        if (isValid) isValid = false; // set to false only once if it's the first error
                    } else if (ruleSet.minLength && value.length < ruleSet.minLength) {
                        isValid = false;
                        if (errorElement) errorElement.textContent = `Minimal ${ruleSet.minLength} karakter.`;
                        if (isValid) inputElement.focus();
                        if (isValid) isValid = false;
                    } else if (ruleSet.isEmail && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
                        isValid = false;
                        if (errorElement) errorElement.textContent = 'Format email tidak valid.';
                        if (isValid) inputElement.focus();
                        if (isValid) isValid = false;
                    } else if (ruleSet.isNumber && isNaN(parseFloat(value))) {
                        isValid = false;
                        if (errorElement) errorElement.textContent = 'Hanya angka yang diperbolehkan.';
                        if (isValid) inputElement.focus();
                        if (isValid) isValid = false;
                    } else if (ruleSet.min && parseFloat(value) < ruleSet.min) {
                        isValid = false;
                        if (errorElement) errorElement.textContent = `Nilai minimal adalah ${ruleSet.min}.`;
                        if (isValid) inputElement.focus();
                        if (isValid) isValid = false;
                    }
                }
                return isValid;
            },
            // Utility untuk membuat elemen HTML dengan atribut dan children
            createElement: (tag, attributes = {}, children = []) => {
                const element = document.createElement(tag);
                for (const key in attributes) {
                    if (key === 'textContent') {
                        element.textContent = attributes[key];
                    } else if (key === 'innerHTML') {
                        element.innerHTML = attributes[key];
                    } else if (key.startsWith('data-')) {
                        element.dataset[key.substring(5)] = attributes[key];
                    } else {
                        element.setAttribute(key, attributes[key]);
                    }
                }
                children.forEach(child => {
                    if (typeof child === 'string') {
                        element.appendChild(document.createTextNode(child));
                    } else {
                        element.appendChild(child);
                    }
                });
                return element;
            },
        };

        // API Simulation
        app.api = {
            _call: async (action, data) => {
                return new Promise(resolve => {
                    setTimeout(() => {
                        console.log(`API Call: ${action}`, data);
                        resolve({ success: true, data });
                    }, app.config.apiDelay);
                });
            },
            fetchTenants: async () => {
                const response = await app.api._call('fetchTenants');
                // Inisialisasi data dummy jika kosong
                if (!localStorage.getItem('Green Valley_tenants')) {
                    const dummyTenants = [
                        { id: 'T001', name: 'Ahmad Subarjo', email: 'ahmad@example.com', phone: '08123456001', idCard: '3201011001800001', address: 'Jl. Merdeka No. 1, Jakarta', status: 'Aktif', unitIds: ['U001'] },
                        { id: 'T002', name: 'Siti Aminah', email: 'siti@example.com', phone: '08123456002', idCard: '3201022002900002', address: 'Jl. Sudirman No. 2, Bandung', status: 'Menunggu Pembayaran', unitIds: ['U002'] },
                        { id: 'T003', name: 'Budi Doremi', email: 'budi.do@example.com', phone: '08123456003', idCard: '', address: '', status: 'Nonaktif', unitIds: [] },
                    ];
                    localStorage.setItem('Green Valley_tenants', JSON.stringify(dummyTenants));
                    app.state.nextTenantId = 4;
                }
                app.state.tenants = JSON.parse(localStorage.getItem('Green Valley_tenants')) || [];
                app.state.nextTenantId = app.state.tenants.length > 0 ? Math.max(...app.state.tenants.map(t => parseInt(t.id.substring(1)))) + 1 : 1;
                return response; // response.success dan response.data (data tidak dipakai dari sini)
            },
            saveTenant: async (tenantData) => {
                const isNew = !tenantData.id;
                if (isNew) {
                    tenantData.id = `T${String(app.state.nextTenantId++).padStart(3, '0')}`;
                    tenantData.unitIds = tenantData.unitIds || []; // Pastikan ada array unitIds
                    app.state.tenants.push(tenantData);
                } else {
                    const index = app.state.tenants.findIndex(t => t.id === tenantData.id);
                    if (index > -1) {
                        app.state.tenants[index] = { ...app.state.tenants[index], ...tenantData };
                    }
                }
                localStorage.setItem('Green Valley_tenants', JSON.stringify(app.state.tenants));
                return app.api._call('saveTenant', tenantData);
            },
            deleteTenant: async (tenantId) => {
                app.state.tenants = app.state.tenants.filter(t => t.id !== tenantId);
                // Hapus penyewa dari unit yang ditempati
                app.state.units.forEach(unit => {
                    if (unit.tenantId === tenantId) {
                        unit.tenantId = null;
                        unit.status = 'Tersedia';
                    }
                });
                localStorage.setItem('Green Valley_tenants', JSON.stringify(app.state.tenants));
                localStorage.setItem('Green Valley_units', JSON.stringify(app.state.units)); // Simpan perubahan unit
                return app.api._call('deleteTenant', { id: tenantId });
            },
            fetchUnits: async () => {
                const response = await app.api._call('fetchUnits');
                if (!localStorage.getItem('Green Valley_units')) {
                    const dummyUnits = [
                        { id: 'U001', code: 'KMR-A01', name: 'Kamar Melati Lantai 1', type: 'Kamar', price: 1500000, status: 'Ditempati', tenantId: 'T001', facilities: 'AC, WiFi, KM Dalam' },
                        { id: 'U002', code: 'APT-B205', name: 'Apartemen City View Tower B', type: 'Apartemen', price: 3500000, status: 'Tersedia', tenantId: null, facilities: '2 Kamar Tidur, AC, Dapur, Balkon' },
                        { id: 'U003', code: 'RMH-C07', name: 'Rumah Cluster Anggrek', type: 'Rumah', price: 5000000, status: 'Perbaikan', tenantId: null, facilities: '3 Kamar Tidur, Garasi, Taman' },
                    ];
                    localStorage.setItem('Green Valley_units', JSON.stringify(dummyUnits));
                    app.state.nextUnitId = 4;
                }
                app.state.units = JSON.parse(localStorage.getItem('Green Valley_units')) || [];
                app.state.nextUnitId = app.state.units.length > 0 ? Math.max(...app.state.units.map(u => parseInt(u.id.substring(1)))) + 1 : 1;
                return response;
            },
            saveUnit: async (unitData) => {
                const isNew = !unitData.id;
                if (isNew) {
                    unitData.id = `U${String(app.state.nextUnitId++).padStart(3, '0')}`;
                    app.state.units.push(unitData);
                } else {
                    const index = app.state.units.findIndex(u => u.id === unitData.id);
                    if (index > -1) {
                        app.state.units[index] = { ...app.state.units[index], ...unitData };
                    }
                }
                localStorage.setItem('Green Valley_units', JSON.stringify(app.state.units));
                return app.api._call('saveUnit', unitData);
            },
            deleteUnit: async (unitId) => {
                const unitToDelete = app.state.units.find(u => u.id === unitId);
                if (unitToDelete && unitToDelete.status === 'Ditempati') {
                    return { success: false, message: 'Unit tidak bisa dihapus karena sedang ditempati.' };
                }
                app.state.units = app.state.units.filter(u => u.id !== unitId);
                localStorage.setItem('Green Valley_units', JSON.stringify(app.state.units));
                return app.api._call('deleteUnit', { id: unitId });
            },
            fetchPayments: async () => {
                const response = await app.api._call('fetchPayments');
                if (!localStorage.getItem('Green Valley_payments')) {
                    const dummyPayments = [
                        { id: 'P001', tenantId: 'T001', unitId: 'U001', amount: 1500000, date: '2024-05-01', method: 'Transfer Bank', notes: 'Pembayaran bulan Mei', status: 'Lunas' },
                        { id: 'P002', tenantId: 'T002', unitId: 'U002', amount: 3500000, date: '2024-05-05', method: 'QRIS', notes: 'DP Sewa', status: 'Menunggu Konfirmasi' },
                    ];
                    localStorage.setItem('Green Valley_payments', JSON.stringify(dummyPayments));
                    app.state.nextPaymentId = 3;
                }
                app.state.payments = JSON.parse(localStorage.getItem('Green Valley_payments')) || [];
                app.state.nextPaymentId = app.state.payments.length > 0 ? Math.max(...app.state.payments.map(p => parseInt(p.id.substring(1)))) + 1 : 1;
                return response;
            },
            savePayment: async (paymentData) => {
                const isNew = !paymentData.id;
                if (isNew) {
                    paymentData.id = `P${String(app.state.nextPaymentId++).padStart(3, '0')}`;
                    paymentData.status = paymentData.status || 'Lunas'; // Default status
                    app.state.payments.push(paymentData);
                } else {
                    const index = app.state.payments.findIndex(p => p.id === paymentData.id);
                    if (index > -1) {
                        app.state.payments[index] = { ...app.state.payments[index], ...paymentData };
                    }
                }
                localStorage.setItem('Green Valley_payments', JSON.stringify(app.state.payments));

                // Update status penyewa jika pembayaran membuat statusnya jadi aktif dari menunggu
                const tenant = app.state.tenants.find(t => t.id === paymentData.tenantId);
                if (tenant && tenant.status === 'Menunggu Pembayaran') {
                    tenant.status = 'Aktif';
                    await app.api.saveTenant(tenant); // Simpan perubahan status penyewa
                    app.render.tenantsTable(); // Re-render tabel penyewa jika perlu
                }

                return app.api._call('savePayment', paymentData);
            },
            deletePayment: async (paymentId) => {
                app.state.payments = app.state.payments.filter(p => p.id !== paymentId);
                localStorage.setItem('Green Valley_payments', JSON.stringify(app.state.payments));
                return app.api._call('deletePayment', { id: paymentId });
            }
        };

        // UI Manipulations & Event Handlers
        app.ui = {
            init: () => {
                app.ui.initTheme();
                app.ui.initSidebar();
                app.ui.initNavigation();
                app.ui.initModals();
                app.ui.initForms();
                app.ui.initFilters();
                app.ui.initToast();
                app.utils.$('#logout-button').addEventListener('click', app.ui.logout);
            },
            initTheme: () => {
                const themeToggle = app.utils.$('.theme-toggle');
                const themeIcon = app.utils.$('i', themeToggle);
                const srStatus = app.utils.$('#theme-status-sr');

                const setTheme = (theme) => {
                    document.documentElement.dataset.theme = theme;
                    app.state.theme = theme;
                    localStorage.setItem('theme', theme);
                    if (theme === 'dark') {
                        themeIcon.classList.remove('fa-moon');
                        themeIcon.classList.add('fa-sun');
                        if (srStatus) srStatus.textContent = 'Mode saat ini: Gelap';
                    } else {
                        themeIcon.classList.remove('fa-sun');
                        themeIcon.classList.add('fa-moon');
                        if (srStatus) srStatus.textContent = 'Mode saat ini: Terang';
                    }
                };
                setTheme(app.state.theme); // Set initial theme
                themeToggle.addEventListener('click', () => {
                    setTheme(app.state.theme === 'light' ? 'dark' : 'light');
                });
            },
            initSidebar: () => {
                const sidebar = app.utils.$('#sidebar');
                const sidebarToggle = app.utils.$('.sidebar-toggle');
                const mobileMenuToggle = app.utils.$('.mobile-menu-toggle');

                sidebarToggle.addEventListener('click', () => {
                    app.state.isSidebarCollapsed = !app.state.isSidebarCollapsed;
                    sidebar.classList.toggle('collapsed', app.state.isSidebarCollapsed);
                    sidebarToggle.setAttribute('aria-expanded', !app.state.isSidebarCollapsed);
                });

                mobileMenuToggle.addEventListener('click', () => {
                    app.state.isMobileMenuOpen = !app.state.isMobileMenuOpen;
                    sidebar.classList.toggle('open', app.state.isMobileMenuOpen);
                    mobileMenuToggle.setAttribute('aria-expanded', app.state.isMobileMenuOpen);
                });
            },
            initNavigation: () => {
                window.addEventListener('hashchange', app.handleRouteChange);
                app.utils.$$('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        // Untuk link non-logout, biarkan hashchange yang handle
                        if (item.getAttribute('href') === '#') { // Hanya untuk link seperti Logout
                            e.preventDefault();
                            if (item.id === 'logout-button') app.ui.logout();
                        } else if (app.state.isMobileMenuOpen) { // Tutup sidebar mobile setelah klik nav
                            app.state.isMobileMenuOpen = false;
                            app.utils.$('#sidebar').classList.remove('open');
                            app.utils.$('.mobile-menu-toggle').setAttribute('aria-expanded', 'false');
                        }
                    });
                });
            },
            initModals: () => {
                // Tutup modal dengan tombol Escape
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        app.utils.$$('.c-modal.open').forEach(modal => app.ui.closeModal(modal.id));
                    }
                });
                // Tutup modal dengan klik di luar konten modal
                app.utils.$$('.c-modal').forEach(modalElement => {
                    modalElement.addEventListener('click', (e) => {
                        if (e.target === modalElement) { // Hanya jika klik pada backdrop modal
                            app.ui.closeModal(modalElement.id);
                        }
                    });
                });

                // Kloning form pembayaran ke modal pembayaran
                const paymentFormSection = app.utils.$('#payment-form');
                const modalPaymentFormContainer = app.utils.$('#modal-payment-form-container');
                if (paymentFormSection && modalPaymentFormContainer) {
                    const clonedPaymentForm = paymentFormSection.cloneNode(true);
                    clonedPaymentForm.id = 'payment-form-modal'; // ID unik untuk form di modal
                    modalPaymentFormContainer.appendChild(clonedPaymentForm);
                    app.ui.initPaymentMethodButtons(clonedPaymentForm); // Inisialisasi ulang listener untuk tombol metode pembayaran
                    app.ui.initPaymentTenantSelect(clonedPaymentForm); // Inisialisasi select penyewa di modal
                }
            },
            openModal: (modalId, data = null) => {
                const modal = app.utils.$(`#${modalId}`);
                if (!modal) return;

                modal.classList.add('open');
                modal.setAttribute('aria-hidden', 'false');
                const firstFocusable = app.utils.$('input, select, textarea, button', modal);
                if (firstFocusable) firstFocusable.focus();

                // Reset form & isi data jika ada (untuk edit)
                const form = app.utils.$('form', modal);
                if (form) form.reset();
                app.utils.$$('.form-error', modal).forEach(el => el.textContent = '');

                if (data) { // Pre-fill form for editing
                    const modalTitle = app.utils.$('.modal-title', modal);
                    if (modalTitle) modalTitle.textContent = modalTitle.textContent.replace('Tambah', 'Edit');

                    for (const key in data) {
                        const inputElement = app.utils.$(`#${key}`, form) || app.utils.$(`[name="${key}"]`, form);
                        if (inputElement) {
                            if (inputElement.type === 'checkbox') {
                                inputElement.checked = data[key];
                            } else {
                                inputElement.value = data[key];
                            }
                            // Trigger change event for selects if needed for dependent fields
                            if (inputElement.tagName === 'SELECT') {
                                inputElement.dispatchEvent(new Event('change'));
                            }
                        }
                    }
                } else { // Reset title for adding
                    const modalTitle = app.utils.$('.modal-title', modal);
                    if (modalTitle) modalTitle.textContent = modalTitle.textContent.replace('Edit', 'Tambah');
                }
            },
            closeModal: (modalId) => {
                const modal = app.utils.$(`#${modalId}`);
                if (modal) {
                    modal.classList.remove('open');
                    modal.setAttribute('aria-hidden', 'true');
                    const form = app.utils.$('form', modal);
                    if (form) form.reset(); // Reset form ketika ditutup
                }
            },
            showToast: (message, type = 'success', duration = 3000) => {
                const toast = app.utils.$('#app-toast');
                const toastMessage = app.utils.$('#toast-message');
                const toastIconEl = app.utils.$('#toast-icon');

                toastMessage.textContent = message;
                toast.className = 'c-toast'; // Reset classes
                toast.classList.add(`toast-${type}`);

                let iconClass = 'fa-check-circle'; // Success
                if (type === 'danger') iconClass = 'fa-times-circle';
                else if (type === 'warning') iconClass = 'fa-exclamation-triangle';
                else if (type === 'info') iconClass = 'fa-info-circle';
                toastIconEl.className = `toast-icon fas ${iconClass}`;

                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), duration);
            },
            initToast: () => {
                const toastCloseButton = app.utils.$('.toast-close');
                if (toastCloseButton) {
                    toastCloseButton.addEventListener('click', () => {
                        app.utils.$('#app-toast').classList.remove('show');
                    });
                }
            },
            initForms: () => {
                // Form Penyewa
                const tenantForm = app.utils.$('#tenant-form');
                if (tenantForm) {
                    tenantForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const isValid = app.utils.validateForm(tenantForm, {
                            'tenant-name': { required: true, message: 'Nama penyewa wajib diisi.' },
                            'tenant-email': { required: true, isEmail: true, message: 'Email tidak valid.' },
                            'tenant-phone': { required: true, minLength: 9, message: 'Nomor telepon minimal 9 digit.' },
                            'tenant-status': { required: true }
                        });
                        if (!isValid) return;

                        const data = {
                            id: app.utils.$('#tenant-id', tenantForm).value,
                            name: app.utils.$('#tenant-name', tenantForm).value,
                            email: app.utils.$('#tenant-email', tenantForm).value,
                            phone: app.utils.$('#tenant-phone', tenantForm).value,
                            idCard: app.utils.$('#tenant-id-card', tenantForm).value,
                            address: app.utils.$('#tenant-address', tenantForm).value,
                            status: app.utils.$('#tenant-status', tenantForm).value,
                        };
                        const result = await app.api.saveTenant(data);
                        if (result.success) {
                            app.ui.showToast(`Penyewa "${result.data.name}" berhasil ${data.id ? 'diperbarui' : 'ditambahkan'}.`);
                            app.ui.closeModal('add-tenant-modal');
                            app.render.tenantsTable();
                            app.render.dashboard(); // Update dashboard stats
                        } else {
                            app.ui.showToast('Gagal menyimpan data penyewa.', 'danger');
                        }
                    });
                }

                // Form Unit
                const unitForm = app.utils.$('#unit-form');
                if (unitForm) {
                    unitForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const isValid = app.utils.validateForm(unitForm, {
                            'unit-code': { required: true },
                            'unit-name': { required: true },
                            'unit-type': { required: true },
                            'unit-price': { required: true, isNumber: true, min: 0 },
                            'unit-status': { required: true }
                        });
                        if (!isValid) return;

                        const data = {
                            id: app.utils.$('#unit-id', unitForm).value,
                            code: app.utils.$('#unit-code', unitForm).value,
                            name: app.utils.$('#unit-name', unitForm).value,
                            type: app.utils.$('#unit-type', unitForm).value,
                            price: parseFloat(app.utils.$('#unit-price', unitForm).value),
                            status: app.utils.$('#unit-status', unitForm).value,
                            facilities: app.utils.$('#unit-facilities', unitForm).value,
                            tenantId: app.state.units.find(u => u.id === app.utils.$('#unit-id', unitForm).value)?.tenantId || null // Pertahankan tenantId jika edit
                        };
                        const result = await app.api.saveUnit(data);
                        if (result.success) {
                            app.ui.showToast(`Unit "${result.data.name}" berhasil ${data.id ? 'diperbarui' : 'ditambahkan'}.`);
                            app.ui.closeModal('add-unit-modal');
                            app.render.unitsTable();
                            app.render.dashboard();
                        } else {
                            app.ui.showToast('Gagal menyimpan data unit.', 'danger');
                        }
                    });
                }

                // Form Pembayaran (yang di section dan yang di modal)
                const paymentForms = [app.utils.$('#payment-form'), app.utils.$('#payment-form-modal')].filter(f => f);
                paymentForms.forEach(form => {
                    app.ui.initPaymentMethodButtons(form); // Inisialisasi tombol metode pembayaran
                    app.ui.initPaymentTenantSelect(form);   // Inisialisasi select penyewa

                    form.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const isValid = app.utils.validateForm(form, {
                            'payment-tenant-id': { required: true },
                            'payment-unit-id': { required: true },
                            'payment-amount': { required: true, isNumber: true, min: 1000 },
                            'payment-date': { required: true },
                            'payment-method-value': { required: true }
                        });
                        if (!isValid) return;

                        const data = {
                            // id: (diurus API jika baru)
                            tenantId: app.utils.$('#payment-tenant-id', form).value,
                            unitId: app.utils.$('#payment-unit-id', form).value,
                            amount: parseFloat(app.utils.$('#payment-amount', form).value),
                            date: app.utils.$('#payment-date', form).value,
                            method: app.utils.$('#payment-method-value', form).value,
                            notes: app.utils.$('#payment-notes', form).value,
                        };
                        const result = await app.api.savePayment(data);
                        if (result.success) {
                            app.ui.showToast('Pembayaran berhasil dicatat.');
                            form.reset(); // Reset form spesifik
                            app.utils.$('#payment-method-value', form).value = 'Transfer Bank'; // Reset hidden input
                            app.utils.$$('.payment-method', form).forEach(btn => btn.classList.remove('active'));
                            app.utils.$('.payment-method[data-method="Transfer Bank"]', form)?.classList.add('active');
                            app.utils.$('#payment-unit-id', form).innerHTML = '<option value="">-- Pilih Unit (otomatis setelah pilih penyewa) --</option>';
                            app.utils.$('#payment-unit-id', form).disabled = true;

                            app.render.paymentsRelated(); // Render ulang semua yang terkait pembayaran
                            if (form.id === 'payment-form-modal') {
                                app.ui.closeModal('add-payment-modal');
                            }
                        } else {
                            app.ui.showToast('Gagal mencatat pembayaran.', 'danger');
                        }
                    });
                });
            },
            initPaymentTenantSelect: (formContext) => {
                const tenantSelect = app.utils.$('#payment-tenant-id', formContext);
                const unitSelect = app.utils.$('#payment-unit-id', formContext);

                if (!tenantSelect || !unitSelect) return;

                // Isi select penyewa
                tenantSelect.innerHTML = '<option value="">-- Pilih Penyewa --</option>';
                app.state.tenants
                    .filter(t => t.status === 'Aktif' || t.status === 'Menunggu Pembayaran') // Hanya penyewa aktif/menunggu
                    .forEach(tenant => {
                        const option = app.utils.createElement('option', { value: tenant.id, textContent: `${tenant.name} (${tenant.id})` });
                        tenantSelect.appendChild(option);
                    });

                // Event listener untuk select penyewa
                tenantSelect.addEventListener('change', () => {
                    const selectedTenantId = tenantSelect.value;
                    unitSelect.innerHTML = '<option value="">-- Pilih Unit --</option>';
                    unitSelect.disabled = true;

                    if (selectedTenantId) {
                        const tenant = app.state.tenants.find(t => t.id === selectedTenantId);
                        if (tenant && tenant.unitIds && tenant.unitIds.length > 0) {
                            tenant.unitIds.forEach(unitId => {
                                const unit = app.state.units.find(u => u.id === unitId);
                                if (unit) {
                                    const option = app.utils.createElement('option', { value: unit.id, textContent: `${unit.name} (${unit.code})` });
                                    unitSelect.appendChild(option);
                                }
                            });
                            unitSelect.disabled = false;
                            if (unitSelect.options.length > 1) unitSelect.selectedIndex = 1; // Pilih unit pertama jika ada
                        } else {
                            // Jika penyewa tidak punya unit terkait (seharusnya tidak terjadi jika data konsisten)
                            unitSelect.innerHTML = '<option value="">-- Penyewa ini tidak memiliki unit terkait --</option>';
                        }
                    }
                });
            },
            initPaymentMethodButtons: (formContext) => {
                const paymentMethodButtons = app.utils.$$('.payment-method', formContext);
                const paymentMethodValueInput = app.utils.$('#payment-method-value', formContext);

                if (paymentMethodButtons.length === 0 || !paymentMethodValueInput) return;

                paymentMethodButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        paymentMethodButtons.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        paymentMethodValueInput.value = btn.dataset.method;
                    });
                });
            },
            initFilters: () => {
                // Filter Penyewa
                const tenantSearch = app.utils.$('#tenant-filter-text');
                const tenantStatusFilter = app.utils.$('#tenant-filter-status');
                if (tenantSearch) tenantSearch.addEventListener('input', app.utils.debounce(() => app.render.tenantsTable(), 300));
                if (tenantStatusFilter) tenantStatusFilter.addEventListener('change', () => app.render.tenantsTable());

                // Filter Unit
                const unitSearch = app.utils.$('#unit-filter-text');
                const unitStatusFilter = app.utils.$('#unit-filter-status');
                const unitTypeFilter = app.utils.$('#unit-filter-type');
                if (unitSearch) unitSearch.addEventListener('input', app.utils.debounce(() => app.render.unitsTable(), 300));
                if (unitStatusFilter) unitStatusFilter.addEventListener('change', () => app.render.unitsTable());
                if (unitTypeFilter) unitTypeFilter.addEventListener('change', () => app.render.unitsTable());

                // Filter Semua Pembayaran (di modal)
                const allPaymentsSearch = app.utils.$('#all-payments-filter-text');
                if (allPaymentsSearch) allPaymentsSearch.addEventListener('input', app.utils.debounce(() => app.render.allPaymentsModalTable(), 300));
            },
            logout: () => {
                app.ui.showToast('Anda telah berhasil keluar. Mengarahkan kembali...');
                // Simulasi logout, bisa clear state, localStorage, lalu reload atau redirect
                // localStorage.removeItem('Green Valley_session'); // Jika ada token sesi
                setTimeout(() => {
                    window.location.hash = app.config.defaultSection; // Kembali ke dashboard
                    window.location.reload(); // Untuk demo, reload agar state kembali ke awal
                }, 1500);
            },
            createEmptyState: (iconClass, title, text, buttonConfig = null) => {
                const container = app.utils.createElement('div', { class: 'c-empty-state' });
                container.appendChild(app.utils.createElement('div', { class: 'empty-state-icon' }, [
                    app.utils.createElement('i', { class: `fas ${iconClass}`, 'aria-hidden': 'true' })
                ]));
                container.appendChild(app.utils.createElement('h3', { class: 'empty-state-title', textContent: title }));
                container.appendChild(app.utils.createElement('p', { class: 'empty-state-text', textContent: text }));

                if (buttonConfig) {
                    const button = app.utils.createElement('button', {
                        class: `c-button ${buttonConfig.class || 'btn-primary'}`,
                        innerHTML: `<i class="fas ${buttonConfig.icon}" aria-hidden="true"></i> ${buttonConfig.text}`
                    });
                    button.addEventListener('click', buttonConfig.onClick);
                    container.appendChild(button);
                }
                return container;
            },
        };

        // Rendering Logic
        app.render = {
            dashboard: () => {
                const totalUnits = app.state.units.length;
                const rentedUnits = app.state.units.filter(u => u.status === 'Ditempati').length;
                const vacantUnits = app.state.units.filter(u => u.status === 'Tersedia').length;
                const activeTenants = app.state.tenants.filter(t => t.status === 'Aktif').length;

                app.utils.$('#db-total-units').textContent = totalUnits;
                app.utils.$('#db-rented-units').textContent = rentedUnits;
                app.utils.$('#db-vacant-units').textContent = vacantUnits;
                app.utils.$('#db-active-tenants').textContent = activeTenants;

                // Tabel penyewa jatuh tempo (dummy, perlu data kontrak)
                const expiringTableBody = app.utils.$('#db-expiring-contracts-table');
                expiringTableBody.innerHTML = ''; // Clear
                // Simulasi, karena belum ada data kontrak
                const dummyExpiring = [
                    { tenantName: 'Ahmad Subarjo', unitName: 'Kamar Melati (KMR-A01)', endDate: '2024-12-31', daysLeft: app.utils.getDaysDifference(new Date(), '2024-12-31') },
                    { tenantName: 'Siti Aminah', unitName: 'Apartemen City (APT-B205)', endDate: '2025-01-15', daysLeft: app.utils.getDaysDifference(new Date(), '2025-01-15') }
                ];
                if (dummyExpiring.length === 0) {
                    expiringTableBody.innerHTML = `<tr><td colspan="4" class="text-center text-muted py-lg">Tidak ada kontrak yang akan jatuh tempo dalam waktu dekat.</td></tr>`;
                } else {
                    dummyExpiring.slice(0, 5).forEach(item => { // Tampilkan maks 5
                        const row = app.utils.createElement('tr');
                        row.innerHTML = `
                        <td>${item.tenantName}</td>
                        <td>${item.unitName}</td>
                        <td>${app.utils.formatDate(item.endDate)}</td>
                        <td><span class="c-badge badge-akan-berakhir">${item.daysLeft} hari</span></td>
                    `;
                        expiringTableBody.appendChild(row);
                    });
                }
            },
            tenantsTable: () => {
                const tbody = app.utils.$('#tenants-table-body');
                const emptyStateContainer = app.utils.$('#tenants-empty-state');
                if (!tbody || !emptyStateContainer) return;

                tbody.innerHTML = '';
                emptyStateContainer.innerHTML = '';
                emptyStateContainer.classList.add('hidden');

                const searchTerm = app.utils.$('#tenant-filter-text').value.toLowerCase();
                const statusFilter = app.utils.$('#tenant-filter-status').value;

                const filteredTenants = app.state.tenants.filter(tenant => {
                    const nameMatch = tenant.name.toLowerCase().includes(searchTerm);
                    const emailMatch = tenant.email.toLowerCase().includes(searchTerm);
                    const statusMatch = !statusFilter || tenant.status === statusFilter;
                    return (nameMatch || emailMatch) && statusMatch;
                });

                if (filteredTenants.length === 0) {
                    const emptyState = app.ui.createEmptyState(
                        'fa-users-slash',
                        'Tidak Ada Penyewa',
                        searchTerm || statusFilter ? 'Tidak ada penyewa yang cocok dengan kriteria filter Anda.' : 'Belum ada data penyewa. Silakan tambahkan penyewa baru.',
                        !(searchTerm || statusFilter) ? { text: 'Tambah Penyewa', icon: 'fa-user-plus', onClick: () => app.ui.openModal('add-tenant-modal') } : null
                    );
                    emptyStateContainer.appendChild(emptyState);
                    emptyStateContainer.classList.remove('hidden');
                    return;
                }

                filteredTenants.forEach(tenant => {
                    const unitsOccupied = tenant.unitIds && tenant.unitIds.length > 0
                        ? tenant.unitIds.map(uid => app.state.units.find(u => u.id === uid)?.code || 'N/A').join(', ')
                        : '-';

                    const row = app.utils.createElement('tr', { 'data-id': tenant.id });
                    row.innerHTML = `
                    <td>${tenant.id}</td>
                    <td>${tenant.name}</td>
                    <td><a href="mailto:${tenant.email}">${tenant.email}</a></td>
                    <td><a href="tel:${tenant.phone}">${tenant.phone}</a></td>
                    <td>${unitsOccupied}</td>
                    <td><span class="c-badge badge-${tenant.status.toLowerCase().replace(/\s+/g, '-')}">${tenant.status}</span></td>
                    <td>
                        <button class="c-button btn-outline btn-sm btn-icon edit-tenant" aria-label="Edit ${tenant.name}"><i class="fas fa-edit"></i></button>
                        <button class="c-button btn-danger btn-sm btn-icon delete-tenant" aria-label="Hapus ${tenant.name}"><i class="fas fa-trash-alt"></i></button>
                    </td>
                `;
                    tbody.appendChild(row);
                });
            },
            unitsTable: () => {
                const tbody = app.utils.$('#units-table-body');
                const emptyStateContainer = app.utils.$('#units-empty-state');
                if (!tbody || !emptyStateContainer) return;

                tbody.innerHTML = '';
                emptyStateContainer.innerHTML = '';
                emptyStateContainer.classList.add('hidden');

                const searchTerm = app.utils.$('#unit-filter-text').value.toLowerCase();
                const statusFilter = app.utils.$('#unit-filter-status').value;
                const typeFilter = app.utils.$('#unit-filter-type').value;

                const filteredUnits = app.state.units.filter(unit => {
                    const nameMatch = unit.name.toLowerCase().includes(searchTerm);
                    const codeMatch = unit.code.toLowerCase().includes(searchTerm);
                    const statusMatch = !statusFilter || unit.status === statusFilter;
                    const typeMatch = !typeFilter || unit.type === typeFilter;
                    return (nameMatch || codeMatch) && statusMatch && typeMatch;
                });

                if (filteredUnits.length === 0) {
                    const emptyState = app.ui.createEmptyState(
                        'fa-building-circle-xmark',
                        'Tidak Ada Unit',
                        searchTerm || statusFilter || typeFilter ? 'Tidak ada unit yang cocok dengan kriteria filter Anda.' : 'Belum ada data unit. Silakan tambahkan unit baru.',
                        !(searchTerm || statusFilter || typeFilter) ? { text: 'Tambah Unit', icon: 'fa-plus-circle', onClick: () => app.ui.openModal('add-unit-modal') } : null
                    );
                    emptyStateContainer.appendChild(emptyState);
                    emptyStateContainer.classList.remove('hidden');
                    return;
                }

                filteredUnits.forEach(unit => {
                    const tenantName = unit.tenantId ? app.state.tenants.find(t => t.id === unit.tenantId)?.name || 'Tidak Diketahui' : '-';
                    const row = app.utils.createElement('tr', { 'data-id': unit.id });
                    row.innerHTML = `
                    <td>${unit.code}</td>
                    <td>${unit.name}</td>
                    <td>${unit.type}</td>
                    <td><span class="c-badge badge-${unit.status.toLowerCase().replace(/\s+/g, '-')}">${unit.status}</span></td>
                    <td>${app.utils.formatCurrency(unit.price)}</td>
                    <td>${tenantName}</td>
                    <td>
                        <button class="c-button btn-outline btn-sm btn-icon edit-unit" aria-label="Edit ${unit.name}"><i class="fas fa-edit"></i></button>
                        <button class="c-button btn-danger btn-sm btn-icon delete-unit" aria-label="Hapus ${unit.name}"><i class="fas fa-trash-alt"></i></button>
                    </td>
                `;
                    tbody.appendChild(row);
                });
            },
            recentPaymentsTable: () => {
                const tbody = app.utils.$('#recent-payments-table-body');
                const emptyStateContainer = app.utils.$('#recent-payments-empty-state');
                if (!tbody || !emptyStateContainer) return;

                tbody.innerHTML = '';
                emptyStateContainer.innerHTML = '';
                emptyStateContainer.classList.add('hidden');

                const recentPayments = [...app.state.payments].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5); // 5 terbaru

                if (recentPayments.length === 0) {
                    const emptyState = app.ui.createEmptyState(
                        'fa-file-invoice-dollar',
                        'Belum Ada Pembayaran',
                        'Tidak ada riwayat pembayaran yang tercatat.',
                        null // Tidak ada tombol tambah di sini, karena ada form di sampingnya
                    );
                    emptyStateContainer.appendChild(emptyState);
                    emptyStateContainer.classList.remove('hidden');
                    return;
                }

                recentPayments.forEach(payment => {
                    const tenant = app.state.tenants.find(t => t.id === payment.tenantId);
                    const row = app.utils.createElement('tr', { 'data-id': payment.id });
                    row.innerHTML = `
                    <td>${app.utils.formatDate(payment.date)}</td>
                    <td>${tenant ? tenant.name : 'N/A'}</td>
                    <td>${app.utils.formatCurrency(payment.amount)}</td>
                    <td><span class="c-badge bg-${payment.method.toLowerCase().replace(/\s+/g, '-')} text-${payment.method.toLowerCase().replace(/\s+/g, '-')}">${payment.method}</span></td>
                `;
                    tbody.appendChild(row);
                });
            },
            allPaymentsModalTable: () => {
                const tbody = app.utils.$('#all-payments-table-body');
                const emptyStateContainer = app.utils.$('#all-payments-empty-state');
                if (!tbody || !emptyStateContainer) return;

                tbody.innerHTML = '';
                emptyStateContainer.innerHTML = '';
                emptyStateContainer.classList.add('hidden');

                const searchTerm = app.utils.$('#all-payments-filter-text').value.toLowerCase();

                const filteredPayments = app.state.payments.filter(payment => {
                    const tenant = app.state.tenants.find(t => t.id === payment.tenantId);
                    const tenantNameMatch = tenant ? tenant.name.toLowerCase().includes(searchTerm) : false;
                    const transactionIdMatch = payment.id.toLowerCase().includes(searchTerm);
                    return tenantNameMatch || transactionIdMatch;
                }).sort((a, b) => new Date(b.date) - new Date(a.date));


                if (filteredPayments.length === 0) {
                    const emptyState = app.ui.createEmptyState(
                        'fa-search-dollar',
                        'Tidak Ada Transaksi',
                        searchTerm ? 'Tidak ada transaksi yang cocok dengan pencarian Anda.' : 'Belum ada riwayat transaksi pembayaran.',
                        null
                    );
                    emptyStateContainer.appendChild(emptyState);
                    emptyStateContainer.classList.remove('hidden');
                    return;
                }

                filteredPayments.forEach(payment => {
                    const tenant = app.state.tenants.find(t => t.id === payment.tenantId);
                    const unit = app.state.units.find(u => u.id === payment.unitId);
                    const row = app.utils.createElement('tr', { 'data-id': payment.id });
                    // Status pembayaran bisa 'Lunas', 'Menunggu Konfirmasi', 'Dibatalkan'
                    let statusBadgeClass = 'baru'; // default
                    if (payment.status === 'Lunas') statusBadgeClass = 'selesai';
                    else if (payment.status === 'Menunggu Konfirmasi') statusBadgeClass = 'menunggu';
                    else if (payment.status === 'Dibatalkan') statusBadgeClass = 'nonaktif';

                    row.innerHTML = `
                    <td>${payment.id}</td>
                    <td>${app.utils.formatDate(payment.date)}</td>
                    <td>${tenant ? tenant.name : 'N/A'}</td>
                    <td>${unit ? unit.code : 'N/A'}</td>
                    <td>${app.utils.formatCurrency(payment.amount)}</td>
                    <td><span class="c-badge bg-${payment.method.toLowerCase().replace(/\s+/g, '-')} text-${payment.method.toLowerCase().replace(/\s+/g, '-')}">${payment.method}</span></td>
                    <td><span class="c-badge badge-${statusBadgeClass}">${payment.status}</span></td>
                    <td>
                        <button class="c-button btn-outline btn-sm btn-icon edit-payment" aria-label="Edit pembayaran ${payment.id}"><i class="fas fa-edit"></i></button>
                        <button class="c-button btn-danger btn-sm btn-icon delete-payment" aria-label="Hapus pembayaran ${payment.id}"><i class="fas fa-trash-alt"></i></button>
                    </td>
                `;
                    tbody.appendChild(row);
                });
            },
            updatePaymentFormTenantOptions: () => { // Untuk mengisi select penyewa di form pembayaran
                const forms = [app.utils.$('#payment-form'), app.utils.$('#payment-form-modal')].filter(f => f);
                forms.forEach(form => {
                    app.ui.initPaymentTenantSelect(form); // Panggil ulang fungsi inisialisasi
                });
            },
            paymentsRelated: () => { // Panggil ini setelah ada perubahan data pembayaran
                app.render.recentPaymentsTable();
                app.render.allPaymentsModalTable(); // Jika modal sedang terbuka atau untuk update data di background
                // Potensi update dashboard jika ada statistik terkait pembayaran
            },
            all: () => { // Render semua komponen utama
                app.render.dashboard();
                app.render.tenantsTable();
                app.render.unitsTable();
                app.render.paymentsRelated();
                app.render.updatePaymentFormTenantOptions();
            }
        };

        // Router & Main Application Logic
        app.navigateTo = (sectionId, params = {}) => {
            window.location.hash = sectionId;
            if (params.openModal) {
                // Beri sedikit waktu agar section dirender sebelum modal dibuka
                setTimeout(() => app.ui.openModal(params.openModal), 50);
            }
        };

        app.handleRouteChange = () => {
            const newSectionId = window.location.hash.substring(1) || app.config.defaultSection;
            if (newSectionId === app.state.currentSection && app.utils.$(`#${newSectionId}`) && !app.utils.$(`#${newSectionId}`).hidden) {
                // Jika section sama dan sudah visible (misal hanya klik ulang nav item), tidak perlu render ulang
                return;
            }
            app.state.currentSection = newSectionId;

            app.utils.$$('.app-section').forEach(sec => sec.hidden = true);
            const targetSection = app.utils.$(`#${app.state.currentSection}`);
            if (targetSection) {
                targetSection.hidden = false;
                targetSection.classList.add('fade-in'); // Re-apply animasi
                // Hapus class setelah animasi selesai agar bisa di-apply lagi
                setTimeout(() => targetSection.classList.remove('fade-in'), 500);

                app.utils.$('#main-content').focus(); // Fokus ke konten utama
            } else {
                // Fallback ke dashboard jika section tidak ditemukan
                app.utils.$(`#${app.config.defaultSection}`).hidden = false;
                app.state.currentSection = app.config.defaultSection;
                window.location.hash = app.config.defaultSection;
            }

            // Update active nav item
            app.utils.$$('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.section === app.state.currentSection);
            });
        };

        app.initDynamicEventListeners = () => {
            // Event delegation untuk tombol edit/delete di tabel
            const mainContent = app.utils.$('#main-content');
            const allPaymentsModal = app.utils.$('#all-payments-modal'); // Untuk tabel di modal

            const handleTableActions = async (e, entityType) => {
                const target = e.target.closest('button');
                if (!target) return;

                const row = target.closest('tr');
                if (!row) return;
                const entityId = row.dataset.id;

                if (target.classList.contains(`edit-${entityType}`)) {
                    let entityData;
                    let modalId;
                    if (entityType === 'tenant') {
                        entityData = app.state.tenants.find(t => t.id === entityId);
                        modalId = 'add-tenant-modal';
                    } else if (entityType === 'unit') {
                        entityData = app.state.units.find(u => u.id === entityId);
                        modalId = 'add-unit-modal';
                    } else if (entityType === 'payment') {
                        entityData = app.state.payments.find(p => p.id === entityId);
                        // Pembayaran diedit di form utama/modal yang sama dengan add, jadi perlu sedikit trik
                        // Jika ini modal 'all-payments-modal', maka buka 'add-payment-modal' dengan data
                        app.ui.openModal('add-payment-modal', entityData);
                        // Isi form di add-payment-modal secara manual karena struktur datanya beda
                        const paymentForm = app.utils.$('#payment-form-modal'); // Asumsi form di modal
                        if (paymentForm && entityData) {
                            app.utils.$('#payment-tenant-id', paymentForm).value = entityData.tenantId;
                            // Trigger change untuk populate unit
                            app.utils.$('#payment-tenant-id', paymentForm).dispatchEvent(new Event('change'));
                            // Tunggu unit select terisi
                            setTimeout(() => {
                                app.utils.$('#payment-unit-id', paymentForm).value = entityData.unitId;
                            }, 100);
                            app.utils.$('#payment-amount', paymentForm).value = entityData.amount;
                            app.utils.$('#payment-date', paymentForm).value = entityData.date;
                            app.utils.$('#payment-method-value', paymentForm).value = entityData.method;
                            app.utils.$('#payment-notes', paymentForm).value = entityData.notes || '';
                            // Update tombol metode pembayaran
                            app.utils.$$('.payment-method', paymentForm).forEach(btn => {
                                btn.classList.toggle('active', btn.dataset.method === entityData.method);
                            });
                            app.utils.$('.modal-title', app.utils.$('#add-payment-modal')).textContent = 'Edit Pembayaran';
                        }
                        return; // Early return karena modalnya beda
                    }

                    if (entityData && modalId) {
                        app.ui.openModal(modalId, entityData);
                    }

                } else if (target.classList.contains(`delete-${entityType}`)) {
                    if (confirm(`Apakah Anda yakin ingin menghapus ${entityType === 'tenant' ? 'penyewa' : (entityType === 'unit' ? 'unit' : 'pembayaran')} ini? Aksi ini tidak dapat diurungkan.`)) {
                        let result;
                        if (entityType === 'tenant') {
                            result = await app.api.deleteTenant(entityId);
                            if (result.success) app.render.tenantsTable();
                        } else if (entityType === 'unit') {
                            result = await app.api.deleteUnit(entityId);
                            if (result.success) app.render.unitsTable();
                        } else if (entityType === 'payment') {
                            result = await app.api.deletePayment(entityId);
                            if (result.success) app.render.paymentsRelated(); // Update tabel pembayaran
                        }

                        if (result && result.success) {
                            app.ui.showToast(`${entityType.charAt(0).toUpperCase() + entityType.slice(1)} berhasil dihapus.`);
                            app.render.dashboard(); // Update statistik dashboard
                        } else {
                            app.ui.showToast(result.message || `Gagal menghapus ${entityType}.`, 'danger');
                        }
                    }
                }
            };

            if (mainContent) {
                mainContent.addEventListener('click', (e) => {
                    if (e.target.closest('#tenants-table-body')) handleTableActions(e, 'tenant');
                    else if (e.target.closest('#units-table-body')) handleTableActions(e, 'unit');
                    // Aksi untuk tabel pembayaran di section #pembayaran bisa ditambahkan di sini jika ada
                });
            }

            if (allPaymentsModal) {
                allPaymentsModal.addEventListener('click', (e) => {
                    if (e.target.closest('#all-payments-table-body')) handleTableActions(e, 'payment');
                });
            }
        };

        app.loadInitialData = async () => {
            try {
                app.ui.showToast('Memuat data awal...', 'info', 1500);
                await Promise.all([
                    app.api.fetchTenants(),
                    app.api.fetchUnits(),
                    app.api.fetchPayments(),
                ]);
                app.render.all();
                app.handleRouteChange(); // Handle initial route
                app.initDynamicEventListeners(); // Listener untuk tombol edit/delete
                app.ui.showToast('Data berhasil dimuat.', 'success');
            } catch (error) {
                console.error('Gagal memuat data awal:', error);
                app.ui.showToast('Gagal memuat data. Coba muat ulang halaman.', 'danger', 5000);
            }
        };

        // Inisialisasi Aplikasi
        document.addEventListener('DOMContentLoaded', () => {
            app.ui.init();
            app.loadInitialData();
        });

    </script>
</body>

</html>