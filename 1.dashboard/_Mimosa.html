<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rental Apartemen Elite - EliteRent</title>
  <meta name="description"
    content="Temukan dan sewa apartemen elite dengan fasilitas premium. Proses mudah, aman, dan terpercaya.">
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üè†</text></svg>">

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* === Design System & Global Styles === */
    :root {
      /* Colors */
      --primary-hue: 210;
      --primary-saturation: 100%;
      --primary-lightness: 48%;
      /* Adjusted for better contrast */
      --primary: hsl(var(--primary-hue), var(--primary-saturation), var(--primary-lightness));
      --primary-hover: hsl(var(--primary-hue), var(--primary-saturation), calc(var(--primary-lightness) - 10%));
      --primary-focus: hsl(var(--primary-hue), var(--primary-saturation), calc(var(--primary-lightness) + 10%));
      --primary-foreground: #ffffff;

      --secondary: #f3f4f6;
      /* Light Gray */
      --secondary-foreground: #374151;
      /* Dark Gray */

      --accent: #ec4899;
      /* Pink for accents */
      --accent-foreground: #ffffff;

      --success: #10b981;
      /* Green */
      --success-foreground: #ffffff;
      --warning: #f59e0b;
      /* Amber */
      --warning-foreground: #1f2937;
      --danger: #ef4444;
      /* Red */
      --danger-foreground: #ffffff;

      --background: #ffffff;
      --foreground: #111827;
      /* Near Black */

      --card: #ffffff;
      --card-foreground: #111827;

      --border: #e5e7eb;
      /* Lighter Gray */
      --input-border: #d1d5db;

      /* Typography */
      --font-family-sans: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      --font-size-base: 1rem;
      /* 16px */
      --line-height-base: 1.6;

      /* Spacing */
      --spacing-unit: 0.25rem;
      /* 4px */
      --spacing-xs: calc(var(--spacing-unit) * 2);
      /* 8px */
      --spacing-sm: calc(var(--spacing-unit) * 3);
      /* 12px */
      --spacing-md: calc(var(--spacing-unit) * 4);
      /* 16px */
      --spacing-lg: calc(var(--spacing-unit) * 6);
      /* 24px */
      --spacing-xl: calc(var(--spacing-unit) * 8);
      /* 32px */

      /* Borders & Radius */
      --radius-sm: 0.25rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --border-width: 1px;

      /* Shadows */
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);

      /* Transitions */
      --transition-fast: all 0.2s ease-in-out;
      --transition-base: all 0.3s ease-in-out;

      /* Z-Index */
      --z-dropdown: 1000;
      --z-sticky: 1020;
      --z-modal-backdrop: 1040;
      --z-modal: 1050;
      --z-popover: 1060;
      --z-tooltip: 1070;
      --z-toast: 1080;
    }

    /* === CSS Reset & Base Styles === */
    *,
    *::before,
    *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      font-size: 100%;
      /* For rem unit consistency */
      scroll-behavior: smooth;
    }

    body {
      font-family: var(--font-family-sans);
      font-size: var(--font-size-base);
      line-height: var(--line-height-base);
      background-color: var(--secondary);
      color: var(--foreground);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    main {
      flex-grow: 1;
    }

    a {
      text-decoration: none;
      color: var(--primary);
      transition: var(--transition-fast);
    }

    a:hover {
      color: var(--primary-hover);
      text-decoration: underline;
    }

    img,
    picture,
    video,
    canvas,
    svg {
      display: block;
      max-width: 100%;
    }

    button,
    input,
    select,
    textarea {
      font-family: inherit;
      font-size: inherit;
      line-height: inherit;
      color: inherit;
    }

    button {
      cursor: pointer;
      background: none;
      border: none;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-weight: 600;
      line-height: 1.3;
      margin-bottom: var(--spacing-md);
    }

    h1 {
      font-size: 2.25rem;
    }

    /* 36px */
    h2 {
      font-size: 1.875rem;
    }

    /* 30px */
    h3 {
      font-size: 1.5rem;
    }

    /* 24px */
    h4 {
      font-size: 1.25rem;
    }

    /* 20px */

    p {
      margin-bottom: var(--spacing-md);
    }

    ul,
    ol {
      list-style-position: inside;
      margin-bottom: var(--spacing-md);
    }

    /* === Utility Classes === */
    .container {
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
      padding-left: var(--spacing-lg);
      padding-right: var(--spacing-lg);
    }

    .section {
      padding-top: var(--spacing-xl);
      padding-bottom: var(--spacing-xl);
    }

    .flex {
      display: flex;
    }

    .flex-col {
      flex-direction: column;
    }

    .flex-wrap {
      flex-wrap: wrap;
    }

    .items-center {
      align-items: center;
    }

    .justify-center {
      justify-content: center;
    }

    .justify-between {
      justify-content: space-between;
    }

    .gap-xs {
      gap: var(--spacing-xs);
    }

    .gap-sm {
      gap: var(--spacing-sm);
    }

    .gap-md {
      gap: var(--spacing-md);
    }

    .gap-lg {
      gap: var(--spacing-lg);
    }

    .text-center {
      text-align: center;
    }

    .text-primary {
      color: var(--primary);
    }

    .text-secondary-foreground {
      color: var(--secondary-foreground);
    }

    .text-sm {
      font-size: 0.875rem;
    }

    .text-lg {
      font-size: 1.125rem;
    }

    .font-bold {
      font-weight: 700;
    }

    .font-medium {
      font-weight: 500;
    }

    .p-sm {
      padding: var(--spacing-sm);
    }

    .p-md {
      padding: var(--spacing-md);
    }

    .p-lg {
      padding: var(--spacing-lg);
    }

    .py-sm {
      padding-top: var(--spacing-sm);
      padding-bottom: var(--spacing-sm);
    }

    .px-md {
      padding-left: var(--spacing-md);
      padding-right: var(--spacing-md);
    }

    .mt-auto {
      margin-top: auto;
    }

    .mt-xs {
      margin-top: var(--spacing-xs);
    }

    .mt-sm {
      margin-top: var(--spacing-sm);
    }

    .mt-md {
      margin-top: var(--spacing-md);
    }

    .mt-lg {
      margin-top: var(--spacing-lg);
    }

    .mb-xs {
      margin-bottom: var(--spacing-xs);
    }

    .mb-sm {
      margin-bottom: var(--spacing-sm);
    }

    .mb-md {
      margin-bottom: var(--spacing-md);
    }

    .mb-lg {
      margin-bottom: var(--spacing-lg);
    }

    .w-full {
      width: 100%;
    }

    .rounded {
      border-radius: var(--radius-md);
    }

    .rounded-lg {
      border-radius: var(--radius-lg);
    }

    .shadow {
      box-shadow: var(--shadow-md);
    }

    .shadow-lg {
      box-shadow: var(--shadow-lg);
    }

    .hidden {
      display: none !important;
    }

    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .page.fade-in {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeIn 0.5s forwards ease-out;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Grid System */
    .grid {
      display: grid;
      gap: var(--spacing-lg);
    }

    .grid-cols-1 {
      grid-template-columns: repeat(1, 1fr);
    }

    .grid-cols-2 {
      grid-template-columns: repeat(2, 1fr);
    }

    .grid-cols-3 {
      grid-template-columns: repeat(3, 1fr);
    }

    .grid-cols-auto-fit {
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }

    /* === Component Styles === */

    /* Navigation */
    .navbar {
      background: var(--background);
      padding-top: var(--spacing-md);
      padding-bottom: var(--spacing-md);
      position: sticky;
      top: 0;
      z-index: var(--z-sticky);
      box-shadow: var(--shadow-sm);
      border-bottom: var(--border-width) solid var(--border);
    }

    .nav-brand {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .nav-brand .material-icons {
      font-size: 2rem;
    }

    .nav-links {
      display: flex;
      gap: var(--spacing-lg);
      list-style: none;
    }

    .nav-link {
      font-weight: 500;
      padding: var(--spacing-sm) 0;
      cursor: pointer;
      position: relative;
      color: var(--secondary-foreground);
      transition: var(--transition-fast);
    }

    .nav-link:hover,
    .nav-link:focus {
      color: var(--primary);
    }

    .nav-link::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 3px;
      background: var(--primary);
      transform: scaleX(0);
      transition: transform 0.3s ease;
      transform-origin: left;
    }

    .nav-link.is-active::after,
    .nav-link:hover::after,
    .nav-link:focus::after {
      transform: scaleX(1);
    }

    .nav-link.is-active {
      color: var(--primary);
      font-weight: 600;
    }

    .mobile-menu-button {
      display: none;
    }

    /* For potential future mobile menu */

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm) var(--spacing-lg);
      border-radius: var(--radius-md);
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition-fast);
      border: var(--border-width) solid transparent;
      text-align: center;
      white-space: nowrap;
    }

    .btn .material-icons {
      font-size: 1.25em;
    }

    .btn-primary {
      background-color: var(--primary);
      color: var(--primary-foreground);
    }

    .btn-primary:hover,
    .btn-primary:focus {
      background-color: var(--primary-hover);
      transform: translateY(-2px);
      box-shadow: var(--shadow-sm);
    }

    .btn-outline {
      background-color: transparent;
      border-color: var(--border);
      color: var(--primary);
    }

    .btn-outline:hover,
    .btn-outline:focus {
      border-color: var(--primary);
      background-color: hsl(var(--primary-hue), var(--primary-saturation), 95%);
    }

    .btn-success {
      background-color: var(--success);
      color: var(--success-foreground);
    }

    .btn-success:hover,
    .btn-success:focus {
      background-color: hsl(var(--success-h), var(--success-s), calc(var(--success-l) - 10%));
    }

    .btn-danger {
      background-color: var(--danger);
      color: var(--danger-foreground);
    }

    .btn-danger:hover,
    .btn-danger:focus {
      background-color: hsl(var(--danger-h), var(--danger-s), calc(var(--danger-l) - 10%));
    }

    .btn-sm {
      padding: var(--spacing-xs) var(--spacing-md);
      font-size: var(--text-sm);
    }

    /* Cards */
    .card {
      background-color: var(--card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      transition: var(--transition-base);
      overflow: hidden;
      /* Ensures child elements conform to border radius */
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
    }

    .card-header {
      padding: var(--spacing-md);
      border-bottom: var(--border-width) solid var(--border);
    }

    .card-body {
      padding: var(--spacing-md);
    }

    .card-footer {
      padding: var(--spacing-md);
      border-top: var(--border-width) solid var(--border);
      background-color: var(--secondary);
    }

    .property-card figcaption {
      padding: var(--spacing-md);
    }

    .property-card img {
      width: 100%;
      height: 220px;
      object-fit: cover;
      border-bottom: var(--border-width) solid var(--border);
    }

    .property-card h3 {
      font-size: 1.3rem;
      margin-bottom: var(--spacing-sm);
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .property-details {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-md);
      font-size: var(--text-sm);
    }

    .price {
      color: var(--primary);
      font-weight: 700;
      font-size: 1.1rem;
    }

    .location {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      color: var(--secondary-foreground);
    }

    .property-features {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-md);
      color: var(--secondary-foreground);
      font-size: var(--text-sm);
      margin-bottom: var(--spacing-md);
    }

    .property-features span {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    /* Forms */
    .form-group {
      margin-bottom: var(--spacing-md);
    }

    .form-group label {
      display: block;
      font-weight: 500;
      margin-bottom: var(--spacing-xs);
      color: var(--secondary-foreground);
    }

    .form-control {
      width: 100%;
      padding: var(--spacing-sm) var(--spacing-md);
      border: var(--border-width) solid var(--input-border);
      border-radius: var(--radius-sm);
      background-color: var(--background);
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
    }

    .form-control:focus {
      border-color: var(--primary);
      outline: 0;
      box-shadow: 0 0 0 0.2rem hsla(var(--primary-hue), var(--primary-saturation), var(--primary-lightness), 0.25);
    }

    .form-control[type="range"] {
      padding: 0;
    }

    .form-check {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .form-check-input {
      width: auto;
    }

    /* Search Form (specific) */
    .search-form-container {
      background-color: var(--card);
      padding: var(--spacing-lg);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      margin-bottom: var(--spacing-xl);
    }

    /* Map Placeholder */
    .map-canvas {
      width: 100%;
      height: 250px;
      /* Adjusted height */
      background-color: var(--secondary);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--secondary-foreground);
      border: 1px dashed var(--border);
      font-style: italic;
    }

    /* Calendar Placeholder */
    .calendar-container {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: var(--spacing-xs);
      padding: var(--spacing-sm);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
    }

    .calendar-day {
      padding: var(--spacing-sm);
      text-align: center;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: var(--transition-fast);
      border: 1px solid transparent;
    }

    .calendar-day.header {
      font-weight: bold;
      cursor: default;
      background: var(--secondary);
    }

    .calendar-day.available:hover {
      background-color: hsl(var(--success-h), var(--success-s), 90%);
    }

    .calendar-day.booked {
      background-color: hsl(var(--warning-h), var(--warning-s), 80%);
      color: var(--warning-foreground);
      cursor: not-allowed;
      text-decoration: line-through;
    }

    .calendar-day.selected {
      background-color: var(--primary);
      color: var(--primary-foreground);
      font-weight: bold;
      border-color: var(--primary-hover);
    }

    .calendar-day:not(.header):not(.empty):focus {
      outline: 2px solid var(--primary);
      outline-offset: 1px;
    }

    /* Details/Summary (Accordion-like) */
    details {
      background-color: var(--card);
      border-top: var(--border-width) solid var(--border);
      border-bottom-left-radius: var(--radius-lg);
      /* Match card */
      border-bottom-right-radius: var(--radius-lg);
      /* Match card */
    }

    details summary {
      padding: var(--spacing-md);
      cursor: pointer;
      color: var(--primary);
      font-weight: 500;
      display: flex;
      justify-content: space-between;
      align-items: center;
      list-style: none;
      /* Remove default marker */
    }

    details summary::-webkit-details-marker {
      display: none;
    }

    /* Hide marker in WebKit */
    details summary::after {
      content: 'expand_more';
      /* Material Icon */
      font-family: 'Material Icons';
      font-weight: normal;
      font-style: normal;
      font-size: 24px;
      line-height: 1;
      letter-spacing: normal;
      text-transform: none;
      display: inline-block;
      white-space: nowrap;
      word-wrap: normal;
      direction: ltr;
      -webkit-font-feature-settings: 'liga';
      -webkit-font-smoothing: antialiased;
      transition: transform 0.2s ease-in-out;
    }

    details[open] summary::after {
      transform: rotate(180deg);
    }

    details>div {
      padding: 0 var(--spacing-md) var(--spacing-md) var(--spacing-md);
    }

    /* Content padding */

    /* Blockquote */
    blockquote {
      border-left: 4px solid var(--primary);
      padding-left: var(--spacing-md);
      margin: var(--spacing-md) 0;
      font-style: italic;
      color: var(--secondary-foreground);
    }

    blockquote footer {
      font-style: normal;
      font-size: var(--text-sm);
      color: var(--foreground);
      margin-top: var(--spacing-xs);
    }

    .report-icon {
      cursor: pointer;
      font-size: 1em;
      vertical-align: middle;
      margin-left: var(--spacing-xs);
    }

    .report-icon:hover {
      color: var(--danger);
    }

    .verified-icon {
      color: var(--success);
      font-size: 1em;
      vertical-align: middle;
    }

    /* Gallery & Virtual Tour */
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
    }

    .gallery img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: var(--radius-md);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
    }

    .gallery img:hover {
      transform: scale(1.05);
      box-shadow: var(--shadow-lg);
    }

    .virtual-tour-placeholder {
      grid-column: 1 / -1;
      /* Span full width */
      height: 300px;
      background-color: var(--secondary);
      border-radius: var(--radius-md);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: var(--secondary-foreground);
      border: 1px dashed var(--border);
      text-align: center;
    }

    .virtual-tour-placeholder .material-icons {
      font-size: 3rem;
      margin-bottom: var(--spacing-sm);
    }

    /* Chat System (Profile Page & Support Chatbox) */
    .chat-window {
      height: 300px;
      overflow-y: auto;
      border: var(--border-width) solid var(--border);
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      background-color: var(--secondary);
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
    }

    .chat-message {
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--radius-md);
      max-width: 75%;
      word-wrap: break-word;
    }

    .chat-message.sent {
      background-color: var(--primary);
      color: var(--primary-foreground);
      align-self: flex-end;
      border-bottom-right-radius: var(--spacing-xs);
    }

    .chat-message.received {
      background-color: var(--card);
      color: var(--card-foreground);
      align-self: flex-start;
      border-bottom-left-radius: var(--spacing-xs);
      box-shadow: var(--shadow-sm);
    }

    .chat-message.system {
      background-color: transparent;
      color: var(--secondary-foreground);
      font-style: italic;
      font-size: var(--text-sm);
      text-align: center;
      align-self: center;
      padding: var(--spacing-xs);
    }

    .chat-input-group {
      display: flex;
      margin-top: var(--spacing-sm);
    }

    .chat-input-group input {
      flex-grow: 1;
      border-right: none;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }

    .chat-input-group button {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }

    /* Payment Methods */
    .payment-methods {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-md);
    }

    .payment-method {
      padding: var(--spacing-md);
      border: 2px solid var(--border);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: var(--transition-fast);
      text-align: center;
      flex-grow: 1;
    }

    .payment-method:hover {
      border-color: var(--primary-focus);
    }

    .payment-method.selected {
      border-color: var(--primary);
      background-color: hsl(var(--primary-hue), var(--primary-saturation), 95%);
      font-weight: 500;
      box-shadow: var(--shadow-sm);
    }

    /* Cost Breakdown */
    .cost-breakdown {
      background-color: var(--secondary);
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      margin-top: var(--spacing-md);
      border: 1px solid var(--border);
    }

    .cost-breakdown h4 {
      margin-bottom: var(--spacing-sm);
      font-size: 1.1rem;
    }

    .cost-line {
      display: flex;
      justify-content: space-between;
      margin-bottom: var(--spacing-xs);
      font-size: var(--text-sm);
    }

    .cost-line.total {
      font-weight: bold;
      font-size: 1.1rem;
      margin-top: var(--spacing-sm);
      padding-top: var(--spacing-sm);
      border-top: 1px dashed var(--border);
    }

    /* Escrow Info */
    .escrow-info {
      background-color: hsl(var(--warning-h), var(--warning-s), 95%);
      padding: var(--spacing-sm) var(--spacing-md);
      border-left: 4px solid var(--warning);
      margin: var(--spacing-md) 0;
      font-size: var(--text-sm);
      border-radius: var(--radius-sm);
    }

    .escrow-info .material-icons {
      vertical-align: bottom;
      margin-right: var(--spacing-xs);
    }

    /* Floating Chat Button & Chatbox */
    .floating-chat-btn {
      position: fixed;
      bottom: var(--spacing-lg);
      right: var(--spacing-lg);
      z-index: var(--z-popover);
      box-shadow: var(--shadow-lg);
      border-radius: 50%;
      width: 60px;
      height: 60px;
    }

    .floating-chat-btn .material-icons {
      font-size: 28px;
    }

    .chatbox-widget {
      position: fixed;
      bottom: calc(var(--spacing-lg) + 70px);
      /* Above button */
      right: var(--spacing-lg);
      background-color: var(--card);
      width: 350px;
      max-width: 90vw;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      display: flex;
      /* Initially shown, JS will hide */
      flex-direction: column;
      height: 450px;
      z-index: var(--z-popover);
      overflow: hidden;
      /* For border radius on children */
      transform-origin: bottom right;
      transition: transform 0.3s ease-out, opacity 0.3s ease-out;
    }

    .chatbox-widget.hidden {
      transform: scale(0.5);
      opacity: 0;
      pointer-events: none;
    }

    .chatbox-header {
      background-color: var(--primary);
      color: var(--primary-foreground);
      padding: var(--spacing-md);
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chatbox-header .close-chat-btn {
      color: var(--primary-foreground);
    }

    .chatbox-body {
      flex-grow: 1;
      overflow-y: auto;
      padding: var(--spacing-md);
      background-color: var(--secondary);
    }

    .chatbox-input-area {
      padding: var(--spacing-md);
      border-top: 1px solid var(--border);
      background-color: var(--card);
    }

    /* Loyalty Badge */
    .loyalty-badge {
      background-color: var(--accent);
      color: var(--accent-foreground);
      padding: var(--spacing-xs) var(--spacing-sm);
      border-radius: var(--radius-sm);
      font-size: 0.8rem;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .loyalty-badge .material-icons {
      font-size: 1em;
    }

    /* Report Form Modal (Concept) */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: var(--z-modal);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .modal.is-open {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background-color: var(--card);
      padding: var(--spacing-lg);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      width: 90%;
      max-width: 500px;
      transform: scale(0.95);
      transition: transform 0.3s ease;
    }

    .modal.is-open .modal-content {
      transform: scale(1);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-md);
    }

    .modal-header h3 {
      margin-bottom: 0;
    }

    .modal-body textarea {
      min-height: 100px;
      resize: vertical;
    }

    /* Admin Table */
    .table-responsive {
      overflow-x: auto;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: var(--spacing-md);
    }

    .table th,
    .table td {
      padding: var(--spacing-sm) var(--spacing-md);
      text-align: left;
      border-bottom: var(--border-width) solid var(--border);
      vertical-align: middle;
    }

    .table th {
      background-color: var(--secondary);
      font-weight: 600;
    }

    .table tbody tr:hover {
      background-color: hsl(var(--primary-hue), var(--primary-saturation), 97%);
    }

    .badge {
      display: inline-block;
      padding: var(--spacing-xs) var(--spacing-sm);
      font-size: var(--text-sm);
      font-weight: 600;
      line-height: 1;
      text-align: center;
      white-space: nowrap;
      vertical-align: baseline;
      border-radius: var(--radius-sm);
    }

    .badge-success {
      background-color: var(--success);
      color: var(--success-foreground);
    }

    .badge-warning {
      background-color: var(--warning);
      color: var(--warning-foreground);
    }

    .badge-danger {
      background-color: var(--danger);
      color: var(--danger-foreground);
    }

    .badge-primary {
      background-color: var(--primary);
      color: var(--primary-foreground);
    }

    /* Footer */
    .app-footer {
      background-color: var(--foreground);
      color: var(--secondary);
      /* Lighter text on dark background */
      padding: var(--spacing-lg) 0;
      text-align: center;
      font-size: var(--text-sm);
    }

    .app-footer p {
      margin-bottom: 0;
    }

    /* === Responsive Design === */
    @media (max-width: 1024px) {

      /* Tablet */
      .grid-cols-3 {
        grid-template-columns: repeat(2, 1fr);
      }

      .search-form-container .grid-cols-3 {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }
    }

    @media (max-width: 768px) {

      /* Mobile */
      h1 {
        font-size: 2rem;
      }

      h2 {
        font-size: 1.625rem;
      }

      .container {
        padding-left: var(--spacing-md);
        padding-right: var(--spacing-md);
      }

      .navbar {
        padding-left: var(--spacing-md);
        padding-right: var(--spacing-md);
      }

      .nav-brand {
        font-size: 1.5rem;
      }

      .nav-links {
        /* Basic mobile menu setup - can be enhanced with JS toggle */
        display: none;
        /* Initially hidden, JS can toggle to flex */
        flex-direction: column;
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        background: var(--background);
        box-shadow: var(--shadow-md);
        padding: var(--spacing-md);
      }

      .nav-links.is-open {
        display: flex;
      }

      .mobile-menu-button {
        display: block;
        /* Show hamburger */
        background: transparent;
        border: none;
        color: var(--primary);
        padding: var(--spacing-sm);
      }

      .mobile-menu-button .material-icons {
        font-size: 28px;
      }


      .grid-cols-3,
      .grid-cols-2,
      .grid-cols-auto-fit {
        grid-template-columns: 1fr;
      }

      .search-form-container .grid-cols-3 {
        grid-template-columns: 1fr;
      }

      .apartment-detail-grid {
        grid-template-columns: 1fr;
      }

      /* Assuming a class for apartment detail layout */

      .floating-chat-btn {
        width: 50px;
        height: 50px;
        bottom: var(--spacing-md);
        right: var(--spacing-md);
      }

      .floating-chat-btn .material-icons {
        font-size: 24px;
      }

      .chatbox-widget {
        width: calc(100vw - (2 * var(--spacing-md)));
        bottom: calc(var(--spacing-md) + 60px);
        right: var(--spacing-md);
        height: 70vh;
      }

      .payment-methods {
        flex-direction: column;
      }
    }

    /* === Accessibility === */
    @media (prefers-reduced-motion: reduce) {
      html {
        scroll-behavior: auto;
      }

      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }

    *:focus-visible {
      /* Modern focus outline */
      outline: 3px solid var(--primary-focus);
      outline-offset: 2px;
      box-shadow: 0 0 0 3px var(--background), 0 0 0 6px var(--primary-focus);
    }

    /* Fallback for older browsers that don't support :focus-visible */
    *:focus {
      outline: 2px solid var(--primary-focus);
      outline-offset: 1px;
    }

    /* Remove outline for elements that have custom focus styles or where it's not needed */
    .nav-link:focus,
    .btn:focus,
    .form-control:focus {
      outline: none;
      /* They have their own focus indicators */
    }
  </style>
</head>

<body>
  <!-- Navigation Bar -->
  <header class="navbar">
    <div class="container flex justify-between items-center">
      <a href="#home" class="nav-brand" aria-label="EliteRent Beranda">
        <span class="material-icons" aria-hidden="true">holiday_village</span>EliteRent
      </a>
      <button class="mobile-menu-button" aria-label="Buka menu navigasi" aria-expanded="false" aria-controls="navLinks">
        <span class="material-icons">menu</span>
      </button>
      <nav>
        <ul class="nav-links" id="navLinks">
          <li><a href="#home" class="nav-link is-active" data-page="home">Beranda</a></li>
          <li><a href="#search" class="nav-link" data-page="search">Pencarian</a></li>
          <li><a href="#profile" class="nav-link" data-page="profile">Profil</a></li>
          <li><a href="#support" class="nav-link" data-page="support">Dukungan</a></li>
          <li><a href="#admin" class="nav-link" data-page="admin">Admin</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Main Content Area (SPA Pages) -->
  <main>
    <!-- Home Page -->
    <section id="home" class="page section container">
      <header class="text-center mb-lg">
        <h1>Temukan Apartemen Impian Anda di EliteRent</h1>
        <p class="text-lg text-secondary-foreground">Jelajahi pilihan apartemen modern dengan fasilitas premium di
          lokasi strategis.</p>
      </header>

      <!-- Quick Search Form -->
      <form id="quickSearchForm" class="search-form-container mb-lg">
        <div class="grid grid-cols-3 gap-md items-end">
          <div class="form-group">
            <label for="quick-location">Lokasi</label>
            <input type="text" id="quick-location" class="form-control" placeholder="Contoh: Jakarta Pusat, Bandung"
              aria-label="Cari lokasi apartemen">
          </div>
          <div class="form-group">
            <label for="quick-checkin">Tanggal Check-in</label>
            <input type="date" id="quick-checkin" class="form-control" aria-label="Tanggal check-in">
          </div>
          <div class="form-group">
            <label for="quick-checkout">Tanggal Check-out</label>
            <input type="date" id="quick-checkout" class="form-control" aria-label="Tanggal check-out">
          </div>
        </div>
        <button type="submit" class="btn btn-primary w-full mt-md">
          <span class="material-icons" aria-hidden="true">search</span>Cari Sekarang
        </button>
      </form>

      <!-- Featured Properties Section -->
      <section aria-labelledby="featured-properties-title">
        <h2 id="featured-properties-title" class="mb-md">Properti Unggulan</h2>
        <div class="grid grid-cols-auto-fit" id="featuredPropertiesGrid">
          <!-- Property cards will be injected here by JavaScript -->
          <p>Memuat properti unggulan...</p>
        </div>
      </section>

      <!-- Why Choose Us Section -->
      <section aria-labelledby="why-choose-us-title" class="mt-xl">
        <h2 id="why-choose-us-title" class="text-center mb-lg">Mengapa Memilih EliteRent?</h2>
        <div class="grid grid-cols-3 gap-lg">
          <div class="card text-center">
            <div class="card-body">
              <span class="material-icons text-primary" style="font-size: 48px;" aria-hidden="true">verified_user</span>
              <h3 class="mt-sm">Pembayaran Aman</h3>
              <p class="text-secondary-foreground">Transaksi Anda dilindungi dengan sistem escrow terpercaya dan
                berbagai pilihan metode pembayaran.</p>
            </div>
          </div>
          <div class="card text-center">
            <div class="card-body">
              <span class="material-icons text-primary" style="font-size: 48px;" aria-hidden="true">support_agent</span>
              <h3 class="mt-sm">Dukungan 24/7</h3>
              <p class="text-secondary-foreground">Tim dukungan pelanggan kami siap membantu Anda kapan saja melalui
                chat, email, atau telepon.</p>
            </div>
          </div>
          <div class="card text-center">
            <div class="card-body">
              <span class="material-icons text-primary" style="font-size: 48px;" aria-hidden="true">apartment</span>
              <h3 class="mt-sm">Pilihan Terbaik</h3>
              <p class="text-secondary-foreground">Koleksi apartemen berkualitas tinggi dengan pemilik yang
                terverifikasi untuk kenyamanan Anda.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Testimonials Section -->
      <section aria-labelledby="testimonials-title" class="mt-xl">
        <h2 id="testimonials-title" class="text-center mb-lg">Apa Kata Mereka?</h2>
        <div class="grid grid-cols-2 gap-lg" id="testimonialsGrid">
          <!-- Testimonials will be injected here -->
          <p>Memuat testimoni...</p>
        </div>
      </section>
    </section>

    <!-- Search Page -->
    <section id="search" class="page section container hidden">
      <header class="mb-lg">
        <h1>Cari Apartemen</h1>
        <p class="text-lg text-secondary-foreground">Gunakan filter untuk menemukan apartemen yang sesuai dengan
          kebutuhan Anda.</p>
      </header>
      <div class="grid grid-cols-1" style="grid-template-columns: 300px 1fr; gap: var(--spacing-xl);">
        <aside class="search-filters-sidebar">
          <form id="fullSearchForm" class="search-form-container" style="padding: var(--spacing-md);">
            <h3 class="mb-md">Filter Pencarian</h3>
            <div class="form-group">
              <label for="search-location">Lokasi</label>
              <input type="text" id="search-location" class="form-control" placeholder="Kota atau area">
            </div>
            <div class="form-group">
              <label for="search-checkin">Check-in</label>
              <input type="date" id="search-checkin" class="form-control">
            </div>
            <div class="form-group">
              <label for="search-checkout">Check-out</label>
              <input type="date" id="search-checkout" class="form-control">
            </div>
            <div class="form-group">
              <label for="search-guests">Jumlah Tamu</label>
              <input type="number" id="search-guests" class="form-control" min="1" value="1">
            </div>
            <div class="form-group">
              <label for="priceRange">Rentang Harga (per malam)</label>
              <input type="range" id="priceRange" class="form-control" min="50" max="1000" value="500" step="10">
              <div class="flex justify-between text-sm mt-xs">
                <span>Rp <span id="priceRangeMinDisplay">50</span>K</span>
                <span>Rp <span id="priceRangeMaxDisplay">500</span>K</span>
              </div>
            </div>
            <div class="form-group">
              <label>Fasilitas</label>
              <div id="amenitiesFilterCheckboxes" class="flex flex-col gap-sm">
                <!-- Checkboxes injected by JS -->
              </div>
            </div>
            <div class="form-group">
              <label for="apartment-type">Tipe Apartemen</label>
              <select id="apartment-type" class="form-control">
                <option value="">Semua Tipe</option>
                <option value="studio">Studio</option>
                <option value="1br">1 Kamar Tidur</option>
                <option value="2br">2 Kamar Tidur</option>
                <option value="3br+">3+ Kamar Tidur</option>
                <option value="penthouse">Penthouse</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary w-full mt-md">
              <span class="material-icons" aria-hidden="true">filter_alt</span>Terapkan Filter
            </button>
            <button type="reset" id="resetFiltersBtn" class="btn btn-outline w-full mt-sm">
              Reset Filter
            </button>
          </form>
        </aside>
        <section aria-labelledby="search-results-title">
          <div class="flex justify-between items-center mb-md">
            <h2 id="search-results-title">Hasil Pencarian (<span id="searchResultsCount">0</span>)</h2>
            <div>
              <label for="sortBy" class="text-sm mr-sm">Urutkan:</label>
              <select id="sortBy" class="form-control" style="width: auto; display:inline-block;">
                <option value="relevance">Relevansi</option>
                <option value="price_asc">Harga Terendah</option>
                <option value="price_desc">Harga Tertinggi</option>
                <option value="rating_desc">Rating Tertinggi</option>
              </select>
            </div>
          </div>
          <div class="grid grid-cols-auto-fit" id="searchResultsGrid">
            <!-- Search results will be injected here -->
            <p>Silakan gunakan filter untuk memulai pencarian Anda.</p>
          </div>
          <div id="paginationControls" class="mt-lg text-center">
            <!-- Pagination buttons will be injected here -->
          </div>
        </section>
      </div>
    </section>

    <!-- Apartment Detail Page -->
    <section id="apartment" class="page section container hidden">
      <div id="apartmentDetailContent">
        <!-- Apartment details will be injected here -->
        <p class="text-center text-lg">Memuat detail apartemen...</p>
      </div>
    </section>

    <!-- Profile Page -->
    <section id="profile" class="page section container hidden">
      <header class="mb-lg">
        <h1>Profil Pengguna</h1>
      </header>
      <div class="grid grid-cols-1" style="grid-template-columns: 1fr 2fr; gap: var(--spacing-xl);">
        <div class="card">
          <div class="card-body text-center">
            <img src="https://source.unsplash.com/random/150x150/?portrait" alt="Foto profil Jane Doe"
              class="rounded-lg shadow-md mb-md mx-auto"
              style="border-radius: 50%; width:120px; height:120px; object-fit:cover;">
            <h2 class="text-xl mb-xs">Jane Doe</h2>
            <p class="text-secondary-foreground mb-sm">jane.doe@example.com</p>
            <p class="loyalty-badge mb-md"><span class="material-icons" aria-hidden="true">star</span>Poin Loyalitas:
              1500</p>
            <button class="btn btn-primary w-full mb-sm"><span class="material-icons" aria-hidden="true">edit</span>Edit
              Profil</button>
            <button class="btn btn-outline w-full"><span class="material-icons"
                aria-hidden="true">logout</span>Keluar</button>
          </div>
        </div>
        <div>
          <section aria-labelledby="booking-history-title" class="mb-lg">
            <h3 id="booking-history-title" class="mb-md">Riwayat Pemesanan</h3>
            <div id="bookingHistoryList" class="flex flex-col gap-md">
              <!-- Booking history items will be injected here -->
              <div class="card">
                <div class="card-body">
                  <p class="text-secondary-foreground">Tidak ada riwayat pemesanan.</p>
                </div>
              </div>
            </div>
          </section>

          <section aria-labelledby="user-messages-title">
            <h3 id="user-messages-title" class="mb-md">Pesan dengan Pemilik/Admin</h3>
            <div class="chat-window mb-sm" id="profileChatWindow" aria-live="polite">
              <div class="chat-message system">Mulai percakapan dengan pemilik atau tim dukungan.</div>
            </div>
            <form id="profileChatForm" class="chat-input-group">
              <input type="text" id="profileChatInput" class="form-control" placeholder="Ketik pesan Anda..."
                aria-label="Input pesan chat">
              <button type="submit" class="btn btn-primary"><span class="material-icons"
                  aria-hidden="true">send</span>Kirim</button>
            </form>
          </section>
        </div>
      </div>
    </section>

    <!-- Support Page -->
    <section id="support" class="page section container hidden">
      <header class="text-center mb-lg">
        <h1>Pusat Dukungan Pelanggan</h1>
        <p class="text-lg text-secondary-foreground">Kami siap membantu Anda dengan pertanyaan atau masalah apa pun.</p>
      </header>
      <div class="grid grid-cols-3 gap-lg">
        <div class="card text-center">
          <div class="card-body">
            <span class="material-icons text-primary" style="font-size: 48px;" aria-hidden="true">chat</span>
            <h3 class="mt-sm">Live Chat</h3>
            <p class="text-secondary-foreground mb-md">Dapatkan bantuan instan dari tim kami.</p>
            <button class="btn btn-primary" id="startLiveChatBtn"><span class="material-icons"
                aria-hidden="true">forum</span>Mulai Chat</button>
          </div>
        </div>
        <div class="card text-center">
          <div class="card-body">
            <span class="material-icons text-primary" style="font-size: 48px;" aria-hidden="true">email</span>
            <h3 class="mt-sm">Email Kami</h3>
            <p class="text-secondary-foreground mb-md">Kirimkan pertanyaan Anda ke alamat email kami.</p>
            <a href="mailto:support@eliterent.app" class="btn btn-outline"><span class="material-icons"
                aria-hidden="true">send</span>support@eliterent.app</a>
          </div>
        </div>
        <div class="card text-center">
          <div class="card-body">
            <span class="material-icons text-primary" style="font-size: 48px;" aria-hidden="true">call</span>
            <h3 class="mt-sm">Hubungi Kami</h3>
            <p class="text-secondary-foreground mb-md">Bicaralah langsung dengan agen dukungan kami.</p>
            <a href="tel:+628001234567" class="btn btn-outline"><span class="material-icons"
                aria-hidden="true">phone_in_talk</span>+62-800-123-4567</a>
          </div>
        </div>
      </div>

      <section aria-labelledby="faq-title" class="mt-xl">
        <h2 id="faq-title" class="text-center mb-lg">Pertanyaan yang Sering Diajukan (FAQ)</h2>
        <div id="faqAccordion" class="flex flex-col gap-sm">
          <!-- FAQ items will be injected here -->
        </div>
      </section>
    </section>

    <!-- Admin Page -->
    <section id="admin" class="page section container hidden">
      <header class="mb-lg">
        <h1>Dasbor Admin</h1>
      </header>
      <div class="grid grid-cols-3 gap-lg mb-lg">
        <div class="card">
          <div class="card-body text-center">
            <h4 class="text-secondary-foreground">Total Apartemen</h4>
            <p class="text-3xl font-bold text-primary mb-xs" id="adminTotalApartments">120</p>
            <span class="badge badge-primary">85 Tersedia</span>
          </div>
        </div>
        <div class="card">
          <div class="card-body text-center">
            <h4 class="text-secondary-foreground">Total Penyewa Aktif</h4>
            <p class="text-3xl font-bold text-success mb-xs" id="adminTotalTenants">234</p>
            <span class="badge badge-success">Online: 15</span>
          </div>
        </div>
        <div class="card">
          <div class="card-body text-center">
            <h4 class="text-secondary-foreground">Pesanan Bulan Ini</h4>
            <p class="text-3xl font-bold text-warning mb-xs" id="adminActiveBookings">78</p>
            <span class="badge badge-warning">Pending: 5</span>
          </div>
        </div>
      </div>

      <div class="card mb-lg">
        <div class="card-header flex justify-between items-center">
          <h3 class="mb-0">Manajemen Apartemen</h3>
          <button class="btn btn-sm btn-primary"><span class="material-icons" aria-hidden="true">add_circle</span>Tambah
            Apartemen</button>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nama Apartemen</th>
                  <th>Lokasi</th>
                  <th>Status</th>
                  <th>Harga/Malam</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody id="adminApartmentTableBody">
                <!-- Admin apartment data will be injected here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="alert alert-info p-md rounded mb-lg"
        style="background-color: hsl(var(--primary-hue), var(--primary-saturation), 95%); border-left: 4px solid var(--primary); color: var(--primary);">
        <span class="material-icons" style="vertical-align: middle; margin-right: var(--spacing-sm);">info</span>
        Data dashboard ini adalah contoh dan akan menampilkan statistik apartemen, penyewa, dan pesanan secara real-time
        pada implementasi backend.
      </div>
    </section>
  </main>

  <!-- Floating Chat Button -->
  <button id="floatingChatButton" class="btn btn-primary floating-chat-btn" aria-label="Buka chat dukungan">
    <span class="material-icons" aria-hidden="true">chat</span>
  </button>

  <!-- Chatbox Widget -->
  <aside id="chatboxWidget" class="chatbox-widget hidden" aria-labelledby="chatbox-title" role="dialog">
    <div class="chatbox-header">
      <h3 id="chatbox-title" class="text-lg mb-0">Dukungan Pelanggan</h3>
      <button id="closeChatboxButton" class="btn-icon" aria-label="Tutup chat">
        <span class="material-icons" aria-hidden="true">close</span>
      </button>
    </div>
    <div class="chatbox-body" id="chatboxMessages" aria-live="polite">
      <div class="chat-message system">Selamat datang di EliteRent! Ada yang bisa kami bantu?</div>
    </div>
    <form id="chatboxForm" class="chatbox-input-area chat-input-group">
      <input type="text" id="chatboxInput" class="form-control" placeholder="Ketik pesan Anda..."
        aria-label="Input pesan chat dukungan">
      <button type="submit" class="btn btn-primary"><span class="material-icons" aria-hidden="true">send</span></button>
    </form>
  </aside>

  <!-- Report Review Modal -->
  <div id="reportReviewModal" class="modal" aria-labelledby="reportReviewModalTitle" aria-modal="true" role="dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="reportReviewModalTitle">Laporkan Ulasan</h3>
        <button id="closeReportModalBtn" class="btn-icon" aria-label="Tutup modal pelaporan">
          <span class="material-icons">close</span>
        </button>
      </div>
      <form id="reportReviewForm">
        <input type="hidden" id="reportReviewId">
        <div class="form-group">
          <label for="report-reason">Alasan Pelaporan</label>
          <textarea id="report-reason" class="form-control" rows="4"
            placeholder="Jelaskan mengapa ulasan ini tidak pantas atau melanggar aturan." required
            aria-label="Alasan pelaporan ulasan"></textarea>
        </div>
        <div class="form-group">
          <label>Kategori Pelaporan:</label>
          <select id="report-category" class="form-control" required>
            <option value="">Pilih kategori...</option>
            <option value="spam">Spam atau Promosi</option>
            <option value="hateful">Ujaran Kebencian atau Diskriminasi</option>
            <option value="irrelevant">Tidak Relevan</option>
            <option value="false_info">Informasi Palsu</option>
            <option value="other">Lainnya</option>
          </select>
        </div>
        <div class="flex justify-end gap-sm">
          <button type="button" id="cancelReportBtn" class="btn btn-outline">Batal</button>
          <button type="submit" class="btn btn-danger">Kirim Laporan</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Footer -->
  <footer class="app-footer mt-auto">
    <div class="container">
      <p>&copy; <span id="currentYear"></span> EliteRent. Semua hak cipta dilindungi.</p>
      <p>Dirancang dengan ‚ù§Ô∏è untuk pengalaman sewa terbaik.</p>
    </div>
  </footer>

  <script>
    // === Global State & Configuration ===
    const AppState = {
      currentPage: 'home',
      apartments: [], // Will be populated by mock data
      filteredApartments: [],
      selectedApartmentId: null,
      searchFilters: {
        location: '',
        checkin: '',
        checkout: '',
        guests: 1,
        priceMax: 500, // in K (e.g., 500 means 500,000)
        amenities: [],
        type: '',
      },
      bookingHistory: [],
      userProfile: {
        name: 'Jane Doe',
        email: 'jane.doe@example.com',
        loyaltyPoints: 1500,
        profilePic: 'https://source.unsplash.com/random/150x150/?portrait'
      },
      chatMessages: {
        profile: [],
        support: [{ type: 'system', text: 'Selamat datang di EliteRent! Ada yang bisa kami bantu?', timestamp: Date.now() }]
      },
      itemsPerPage: 6,
      currentPageNumber: 1,
    };

    // === Mock Data ===
    const MOCK_APARTMENTS = [
      {
        id: 1,
        title: 'Penthouse Mewah Pusat Kota',
        location: 'Jakarta Pusat, DKI Jakarta',
        pricePerNight: 750, // in K (e.g., 750,000)
        type: 'penthouse',
        bedrooms: 3,
        bathrooms: 2,
        sqft: 200,
        amenities: ['wifi', 'pool', 'gym', 'parking', 'ac', 'kitchen', 'tv'],
        images: [
          'https://source.unsplash.com/random/800x600/?luxury,apartment,interior',
          'https://source.unsplash.com/random/800x600/?apartment,bedroom',
          'https://source.unsplash.com/random/800x600/?apartment,livingroom',
          'https://source.unsplash.com/random/800x600/?apartment,kitchen',
          'https://source.unsplash.com/random/800x600/?apartment,balcony'
        ],
        description: 'Nikmati kemewahan tak tertandingi di penthouse kami yang terletak strategis di jantung kota. Dengan pemandangan cakrawala yang memukau, interior yang dirancang elegan, dan fasilitas lengkap termasuk kolam renang pribadi mini dan akses gym eksklusif. Sempurna untuk keluarga atau grup yang mencari pengalaman menginap premium.',
        rating: 4.9,
        reviews: [
          { id: 'r1a1', user: 'Budi Santoso', comment: 'Pemandangan kota yang luar biasa dan fasilitas terbaik! Sangat direkomendasikan.', rating: 5, date: '2024-05-10', reported: false },
          { id: 'r2a1', user: 'Citra Lestari', comment: 'Apartemennya bersih, luas, dan sangat nyaman. Pelayanannya juga ramah.', rating: 4.8, date: '2024-05-01', reported: false }
        ],
        host: { name: 'PT Properti Jaya', verified: true },
        availability: { /* 'YYYY-MM-DD': 'booked' or 'unavailable' */ '2024-07-20': 'booked', '2024-07-21': 'booked' }
      },
      {
        id: 2,
        title: 'Studio Modern Dekat Kampus',
        location: 'Bandung, Jawa Barat',
        pricePerNight: 250,
        type: 'studio',
        bedrooms: 1, // Studio can be considered 1 effective bedroom for filtering
        bathrooms: 1,
        sqft: 45,
        amenities: ['wifi', 'ac', 'kitchenette', 'laundry_shared', 'study_desk'],
        images: [
          'https://source.unsplash.com/random/800x600/?modern,studio,apartment',
          'https://source.unsplash.com/random/800x600/?studio,interior',
          'https://source.unsplash.com/random/800x600/?compact,living'
        ],
        description: 'Studio modern dan fungsional, ideal untuk mahasiswa atau profesional muda. Dilengkapi dengan kitchenette, area belajar, dan akses mudah ke transportasi umum serta fasilitas kampus. Lingkungan yang tenang dan aman.',
        rating: 4.5,
        reviews: [
          { id: 'r1a2', user: 'Rina Amelia', comment: 'Lokasi strategis, sangat bersih, dan harganya terjangkau untuk mahasiswa.', rating: 4.5, date: '2024-04-20', reported: false },
          { id: 'r2a2', user: 'Agus Setiawan', comment: 'Cocok untuk tinggal sendiri, fasilitas cukup lengkap.', rating: 4, date: '2024-04-15', reported: false }
        ],
        host: { name: 'Ibu Wati', verified: true },
        availability: {}
      },
      {
        id: 3,
        title: 'Apartemen Keluarga Nyaman',
        location: 'Surabaya, Jawa Timur',
        pricePerNight: 450,
        type: '2br',
        bedrooms: 2,
        bathrooms: 1,
        sqft: 90,
        amenities: ['wifi', 'ac', 'kitchen', 'tv', 'parking', 'playground'],
        images: [
          'https://source.unsplash.com/random/800x600/?family,apartment,cozy',
          'https://source.unsplash.com/random/800x600/?kids,bedroom',
          'https://source.unsplash.com/random/800x600/?apartment,dining'
        ],
        description: 'Apartemen dua kamar yang luas dan nyaman, sempurna untuk liburan keluarga. Dilengkapi dapur lengkap, area bermain anak di kompleks, dan keamanan 24 jam. Dekat dengan pusat perbelanjaan dan tempat wisata.',
        rating: 4.7,
        reviews: [
          { id: 'r1a3', user: 'Keluarga Wijaya', comment: 'Tempatnya bersih, anak-anak suka ada playground. Recommended!', rating: 5, date: '2024-03-10', reported: false }
        ],
        host: { name: 'Manajemen Graha Indah', verified: false },
        availability: {}
      },
      {
        id: 4,
        title: 'Apartemen Minimalis di Segitiga Emas',
        location: 'Jakarta Selatan, DKI Jakarta',
        pricePerNight: 600,
        type: '1br',
        bedrooms: 1,
        bathrooms: 1,
        sqft: 60,
        amenities: ['wifi', 'pool', 'gym', 'ac', 'kitchen', 'smart_tv'],
        images: [
          'https://source.unsplash.com/random/800x600/?minimalist,apartment',
          'https://source.unsplash.com/random/800x600/?urban,living',
          'https://source.unsplash.com/random/800x600/?stylish,interior'
        ],
        description: 'Apartemen satu kamar tidur dengan desain minimalis modern di kawasan bisnis Jakarta. Akses mudah ke perkantoran, mal, dan hiburan. Fasilitas gedung termasuk kolam renang infinity dan pusat kebugaran.',
        rating: 4.8,
        reviews: [
          { id: 'r1a4', user: 'David Lee', comment: 'Desainnya keren, lokasi sangat strategis untuk bisnis.', rating: 5, date: '2024-06-01', reported: false }
        ],
        host: { name: 'UrbanLiving Spaces', verified: true },
        availability: { '2024-07-25': 'booked' }
      },
      {
        id: 5,
        title: 'Loft Artistik dengan Pemandangan Sungai',
        location: 'Yogyakarta, DIY',
        pricePerNight: 350,
        type: 'studio', // Loft can be considered studio type for simplicity
        bedrooms: 1,
        bathrooms: 1,
        sqft: 70,
        amenities: ['wifi', 'ac', 'kitchenette', 'balcony', 'art_supplies'],
        images: [
          'https://source.unsplash.com/random/800x600/?artistic,loft,apartment',
          'https://source.unsplash.com/random/800x600/?loft,interior,riverview',
          'https://source.unsplash.com/random/800x600/?creative,workspace'
        ],
        description: 'Sebuah loft unik dengan sentuhan artistik, menawarkan pemandangan sungai yang menenangkan. Ruang terbuka dengan langit-langit tinggi, dilengkapi perlengkapan seni dasar untuk inspirasi Anda. Balkon pribadi untuk menikmati senja.',
        rating: 4.9,
        reviews: [
          { id: 'r1a5', user: 'Sarah K√ºnstler', comment: 'Tempat yang sangat inspiratif! Suka sekali dengan detail seninya.', rating: 5, date: '2024-05-15', reported: false }
        ],
        host: { name: 'Galeri Sungai', verified: true },
        availability: {}
      },
      {
        id: 6,
        title: 'Kabin Modern Tepi Danau',
        location: 'Danau Toba, Sumatera Utara',
        pricePerNight: 900,
        type: '2br', // Can be categorized as a unique stay, but fits 2BR
        bedrooms: 2,
        bathrooms: 2,
        sqft: 120,
        amenities: ['wifi', 'fireplace', 'kitchen', 'patio', 'lake_access', 'bbq_grill'],
        images: [
          'https://source.unsplash.com/random/800x600/?modern,cabin,lake',
          'https://source.unsplash.com/random/800x600/?cabin,interior,lakeview',
          'https://source.unsplash.com/random/800x600/?cozy,fireplace,cabin'
        ],
        description: 'Melarikan diri ke kabin modern kami yang terletak di tepi Danau Toba yang indah. Menawarkan privasi total, pemandangan danau yang tak terhalang, dan akses langsung ke air. Sempurna untuk relaksasi dan petualangan alam.',
        rating: 5.0,
        reviews: [
          { id: 'r1a6', user: 'John Adventure', comment: 'Pengalaman menginap terbaik! Pemandangannya spektakuler.', rating: 5, date: '2024-06-10', reported: false }
        ],
        host: { name: 'Toba Retreats', verified: true },
        availability: { '2024-08-01': 'booked', '2024-08-02': 'booked', '2024-08-03': 'booked' }
      },
      // Add 10 more unique apartments
      {
        id: 7,
        title: 'Apartemen Sejarah di Kota Tua',
        location: 'Semarang, Jawa Tengah',
        pricePerNight: 400,
        type: '1br',
        bedrooms: 1,
        bathrooms: 1,
        sqft: 75,
        amenities: ['wifi', 'ac', 'kitchenette', 'heritage_building', 'city_view'],
        images: ['https://source.unsplash.com/random/800x600/?historic,apartment,city', 'https://source.unsplash.com/random/800x600/?vintage,interior', 'https://source.unsplash.com/random/800x600/?oldtown,view'],
        description: 'Rasakan pesona tinggal di gedung bersejarah yang telah direnovasi dengan indah di jantung Kota Tua Semarang. Interior klasik dengan kenyamanan modern.',
        rating: 4.6,
        reviews: [{ id: 'r1a7', user: 'Andi Sejarawan', comment: 'Sangat otentik dan nyaman.', rating: 4.5, date: '2024-05-20', reported: false }],
        host: { name: 'Warisan Kita', verified: true },
        availability: {}
      },
      {
        id: 8,
        title: 'Rumah Pantai Pribadi',
        location: 'Lombok, NTB',
        pricePerNight: 1200,
        type: '3br+', // Treat as large unit
        bedrooms: 4,
        bathrooms: 3,
        sqft: 250,
        amenities: ['wifi', 'pool', 'private_beach', 'kitchen', 'bbq_grill', 'ac'],
        images: ['https://source.unsplash.com/random/800x600/?beach,house,luxury', 'https://source.unsplash.com/random/800x600/?private,pool,ocean', 'https://source.unsplash.com/random/800x600/?tropical,bedroom'],
        description: 'Vila pantai eksklusif dengan kolam renang pribadi dan akses langsung ke pantai pasir putih. Ideal untuk grup besar atau keluarga yang mencari kemewahan tropis.',
        rating: 4.9,
        reviews: [{ id: 'r1a8', user: 'Keluarga Bahagia', comment: 'Surga dunia! Akan kembali lagi.', rating: 5, date: '2024-06-05', reported: false }],
        host: { name: 'Lombok Dreams', verified: true },
        availability: { '2024-09-10': 'booked' }
      },
      {
        id: 9,
        title: 'Apartemen Eco-Friendly di Pegunungan',
        location: 'Malang, Jawa Timur',
        pricePerNight: 300,
        type: 'studio',
        bedrooms: 1,
        bathrooms: 1,
        sqft: 50,
        amenities: ['solar_panel', 'rainwater_harvesting', 'organic_garden', 'mountain_view', 'kitchenette'],
        images: ['https://source.unsplash.com/random/800x600/?eco,apartment,mountain', 'https://source.unsplash.com/random/800x600/?sustainable,living', 'https://source.unsplash.com/random/800x600/?green,balcony'],
        description: 'Apartemen ramah lingkungan dengan pemandangan pegunungan yang menakjubkan. Menggunakan energi surya dan sistem panen air hujan. Nikmati udara segar dan ketenangan.',
        rating: 4.7,
        reviews: [{ id: 'r1a9', user: 'Eco Warrior', comment: 'Konsepnya luar biasa, tempatnya damai.', rating: 5, date: '2024-04-28', reported: false }],
        host: { name: 'Hijau Lestari Homestay', verified: false },
        availability: {}
      },
      {
        id: 10,
        title: 'Penthouse Duplex dengan Rooftop Garden',
        location: 'Medan, Sumatera Utara',
        pricePerNight: 850,
        type: 'penthouse',
        bedrooms: 3,
        bathrooms: 3,
        sqft: 220,
        amenities: ['wifi', 'pool_shared', 'gym_shared', 'private_rooftop', 'kitchen', 'ac', 'city_skyline'],
        images: ['https://source.unsplash.com/random/800x600/?duplex,penthouse,rooftop', 'https://source.unsplash.com/random/800x600/?rooftop,garden,city', 'https://source.unsplash.com/random/800x600/?luxury,livingroom,view'],
        description: 'Penthouse duplex yang menawan dengan taman atap pribadi yang menawarkan pemandangan kota 360 derajat. Ruang tamu yang luas dan desain interior yang mewah.',
        rating: 4.8,
        reviews: [{ id: 'r1a10', user: 'Mr. Bigshot', comment: 'Rooftopnya adalah highlight utama! Keren.', rating: 4.8, date: '2024-05-25', reported: false }],
        host: { name: 'SkyHigh Residences', verified: true },
        availability: {}
      },
      {
        id: 11,
        title: 'Apartemen Urban Chic dekat Stasiun',
        location: 'Jakarta Barat, DKI Jakarta',
        pricePerNight: 500,
        type: '1br',
        bedrooms: 1,
        bathrooms: 1,
        sqft: 55,
        amenities: ['wifi', 'ac', 'kitchenette', 'smart_lock', 'transit_access'],
        images: ['https://source.unsplash.com/random/800x600/?urban,chic,apartment', 'https://source.unsplash.com/random/800x600/?stylish,bedroom,city', 'https://source.unsplash.com/random/800x600/?modern,kitchenette,compact'],
        description: 'Apartemen satu kamar tidur yang stylish dan modern, sangat dekat dengan stasiun kereta dan pusat transportasi publik. Ideal untuk komuter dan pelancong bisnis.',
        rating: 4.5,
        reviews: [{ id: 'r1a11', user: 'Commuter Life', comment: 'Sangat praktis karena dekat stasiun.', rating: 4.5, date: '2024-06-12', reported: false }],
        host: { name: 'Transit Living', verified: true },
        availability: { '2024-07-30': 'booked', '2024-07-31': 'booked' }
      },
      {
        id: 12,
        title: 'Suite Bisnis Eksekutif',
        location: 'Makassar, Sulawesi Selatan',
        pricePerNight: 650,
        type: 'studio', // Executive suite often studio-like
        bedrooms: 1,
        bathrooms: 1,
        sqft: 65,
        amenities: ['wifi_highspeed', 'ac', 'meeting_room_access', 'gym', 'airport_shuttle_service', 'workstation'],
        images: ['https://source.unsplash.com/random/800x600/?executive,suite,business', 'https://source.unsplash.com/random/800x600/?business,hotel,room', 'https://source.unsplash.com/random/800x600/?modern,office,desk'],
        description: 'Suite eksekutif yang dirancang untuk pelancong bisnis. Dilengkapi dengan workstation, Wi-Fi kecepatan tinggi, dan akses ke ruang pertemuan. Layanan antar-jemput bandara tersedia.',
        rating: 4.7,
        reviews: [{ id: 'r1a12', user: 'CEO on the Go', comment: 'Fasilitas bisnisnya lengkap dan memadai.', rating: 4.7, date: '2024-05-05', reported: false }],
        host: { name: 'Makassar Business Suites', verified: true },
        availability: {}
      },
      {
        id: 13,
        title: 'Apartemen Tepi Sungai dengan Balkon Luas',
        location: 'Palembang, Sumatera Selatan',
        pricePerNight: 380,
        type: '2br',
        bedrooms: 2,
        bathrooms: 1,
        sqft: 80,
        amenities: ['wifi', 'ac', 'kitchen', 'large_balcony', 'river_view', 'fishing_spot_nearby'],
        images: ['https://source.unsplash.com/random/800x600/?riverside,apartment,balcony', 'https://source.unsplash.com/random/800x600/?apartment,river,view', 'https://source.unsplash.com/random/800x600/?cozy,livingroom,waterfront'],
        description: 'Apartemen dua kamar tidur yang nyaman dengan balkon luas yang menghadap langsung ke sungai. Nikmati pemandangan perahu lalu lalang dan aktivitas sungai dari kenyamanan rumah Anda.',
        rating: 4.4,
        reviews: [{ id: 'r1a13', user: 'Pencinta Sungai', comment: 'Balkonnya favorit saya! Bisa mancing juga.', rating: 4.5, date: '2024-04-10', reported: false }],
        host: { name: 'Riverside Living Palembang', verified: false },
        availability: {}
      },
      {
        id: 14,
        title: 'Glamping Mewah di Tengah Hutan Pinus',
        location: 'Lembang, Jawa Barat',
        pricePerNight: 700,
        type: 'studio', // Glamping tent
        bedrooms: 1,
        bathrooms: 1, // Private bathroom attached
        sqft: 40, // Tent size
        amenities: ['private_bathroom', 'bonfire_pit', 'bbq_facilities', 'nature_trails', 'stargazing_deck'],
        images: ['https://source.unsplash.com/random/800x600/?luxury,glamping,forest', 'https://source.unsplash.com/random/800x600/?glamping,tent,interior', 'https://source.unsplash.com/random/800x600/?forest,bonfire,night'],
        description: 'Pengalaman berkemah mewah (glamping) di tengah hutan pinus yang sejuk. Tenda dilengkapi fasilitas modern termasuk kamar mandi pribadi. Nikmati api unggun dan barbekyu di bawah bintang.',
        rating: 4.9,
        reviews: [{ id: 'r1a14', user: 'Nature Lover Family', comment: 'Anak-anak senang sekali! Pengalaman unik.', rating: 5, date: '2024-06-20', reported: false }],
        host: { name: 'Lembang Pine Forest Glamping', verified: true },
        availability: {}
      },
      {
        id: 15,
        title: 'Apartemen Cerdas dengan Teknologi Terkini',
        location: 'BSD City, Banten',
        pricePerNight: 550,
        type: '1br',
        bedrooms: 1,
        bathrooms: 1,
        sqft: 60,
        amenities: ['wifi', 'smart_lighting', 'voice_assistant', 'robotic_vacuum', 'smart_tv', 'gym', 'pool'],
        images: ['https://source.unsplash.com/random/800x600/?smart,home,apartment', 'https://source.unsplash.com/random/800x600/?tech,savvy,interior', 'https://source.unsplash.com/random/800x600/?futuristic,livingroom'],
        description: 'Apartemen satu kamar tidur yang sepenuhnya terintegrasi dengan teknologi rumah pintar. Kontrol pencahayaan, suhu, dan hiburan dengan suara Anda. Rasakan kenyamanan masa depan.',
        rating: 4.8,
        reviews: [{ id: 'r1a15', user: 'Tech Enthusiast', comment: 'Semua serba otomatis, keren banget!', rating: 5, date: '2024-05-30', reported: false }],
        host: { name: 'Future Living BSD', verified: true },
        availability: { '2024-08-15': 'booked' }
      },
      {
        id: 16,
        title: 'Kondominium Eksklusif dengan Lapangan Golf',
        location: 'Sentul, Jawa Barat',
        pricePerNight: 950,
        type: '3br+',
        bedrooms: 3,
        bathrooms: 2,
        sqft: 180,
        amenities: ['wifi', 'ac', 'kitchen', 'golf_course_access', 'clubhouse', 'private_pool_option'],
        images: ['https://source.unsplash.com/random/800x600/?golf,condominium,luxury', 'https://source.unsplash.com/random/800x600/?golf,course,view', 'https://source.unsplash.com/random/800x600/?exclusive,living,clubhouse'],
        description: 'Kondominium mewah yang terletak di dalam kompleks lapangan golf eksklusif. Nikmati pemandangan hijau yang menenangkan dan akses mudah ke fasilitas golf dan clubhouse.',
        rating: 4.9,
        reviews: [{ id: 'r1a16', user: 'Mr. Golfer', comment: 'Lokasi sempurna untuk pegolf. Fasilitasnya juga top.', rating: 5, date: '2024-06-08', reported: false }],
        host: { name: 'Sentul Golf View Residences', verified: true },
        availability: {}
      }
    ];

    const ALL_AMENITIES = {
      wifi: { icon: 'wifi', label: 'WiFi Gratis' },
      pool: { icon: 'pool', label: 'Kolam Renang' },
      gym: { icon: 'fitness_center', label: 'Gym/Pusat Kebugaran' },
      parking: { icon: 'local_parking', label: 'Parkir Gratis' },
      ac: { icon: 'ac_unit', label: 'Pendingin Ruangan (AC)' },
      kitchen: { icon: 'kitchen', label: 'Dapur Lengkap' },
      kitchenette: { icon: 'countertops', label: 'Dapur Kecil' },
      tv: { icon: 'tv', label: 'Televisi' },
      smart_tv: { icon: 'smart_display', label: 'Smart TV' },
      laundry_shared: { icon: 'local_laundry_service', label: 'Laundry Bersama' },
      laundry_in_unit: { icon: 'local_laundry_service', label: 'Mesin Cuci Pribadi' },
      study_desk: { icon: 'desk', label: 'Meja Belajar/Kerja' },
      playground: { icon: 'child_friendly', label: 'Area Bermain Anak' },
      balcony: { icon: 'balcony', label: 'Balkon/Teras' },
      art_supplies: { icon: 'palette', label: 'Perlengkapan Seni' },
      fireplace: { icon: 'fireplace', label: 'Perapian' },
      patio: { icon: 'deck', label: 'Patio' },
      lake_access: { icon: 'water', label: 'Akses Danau' },
      bbq_grill: { icon: 'outdoor_grill', label: 'Panggangan BBQ' },
      heritage_building: { icon: 'museum', label: 'Bangunan Bersejarah' },
      city_view: { icon: 'location_city', label: 'Pemandangan Kota' },
      private_beach: { icon: 'beach_access', label: 'Pantai Pribadi' },
      solar_panel: { icon: 'solar_power', label: 'Panel Surya' },
      rainwater_harvesting: { icon: 'water_drop', label: 'Panen Air Hujan' },
      organic_garden: { icon: 'eco', label: 'Kebun Organik' },
      mountain_view: { icon: 'landscape', label: 'Pemandangan Gunung' },
      private_rooftop: { icon: 'rooftop_garden', label: 'Rooftop Pribadi' },
      city_skyline: { icon: 'nightlife', label: 'Pemandangan Skyline' },
      smart_lock: { icon: 'lock_smart', label: 'Kunci Pintar' },
      transit_access: { icon: 'train', label: 'Akses Transportasi Umum' },
      wifi_highspeed: { icon: 'network_wifi_3_bar', label: 'WiFi Kecepatan Tinggi' },
      meeting_room_access: { icon: 'meeting_room', label: 'Akses Ruang Meeting' },
      airport_shuttle_service: { icon: 'airport_shuttle', label: 'Layanan Antar-Jemput Bandara' },
      workstation: { icon: 'workspaces', label: 'Workstation' },
      large_balcony: { icon: 'balcony', label: 'Balkon Luas' },
      river_view: { icon: 'waterfall_chart', label: 'Pemandangan Sungai' },
      fishing_spot_nearby: { icon: 'phishing', label: 'Area Memancing Dekat' },
      private_bathroom: { icon: 'bathtub', label: 'Kamar Mandi Pribadi' },
      bonfire_pit: { icon: 'local_fire_department', label: 'Area Api Unggun' },
      bbq_facilities: { icon: 'restaurant', label: 'Fasilitas BBQ' },
      nature_trails: { icon: 'hiking', label: 'Jalur Alam' },
      stargazing_deck: { icon: 'flare', label: 'Dek Observasi Bintang' },
      smart_lighting: { icon: 'lightbulb', label: 'Pencahayaan Pintar' },
      voice_assistant: { icon: 'mic', label: 'Asisten Suara' },
      robotic_vacuum: { icon: 'cleaning_services', label: 'Vakum Robotik' },
      golf_course_access: { icon: 'golf_course', label: 'Akses Lapangan Golf' },
      clubhouse: { icon: 'nightlife', label: 'Clubhouse' },
      private_pool_option: { icon: 'pool', label: 'Opsi Kolam Pribadi' }
    };

    const MOCK_TESTIMONIALS = [
      { user: 'Andi Pratama', comment: "Proses booking sangat mudah dan cepat. Apartemennya persis seperti di foto, bahkan lebih baik! Pasti akan sewa lagi dari EliteRent.", avatar: "https://source.unsplash.com/random/100x100/?man,smile" },
      { user: 'Siti Aminah', comment: "Customer service EliteRent sangat responsif dan membantu. Saya merasa aman bertransaksi di sini. Pengalaman yang menyenangkan!", avatar: "https://source.unsplash.com/random/100x100/?woman,professional" }
    ];

    const MOCK_FAQS = [
      { q: "Bagaimana cara melakukan pemesanan?", a: "Anda dapat mencari apartemen melalui halaman Pencarian, pilih tanggal dan apartemen yang diinginkan, lalu ikuti proses pemesanan hingga pembayaran." },
      { q: "Apakah pembayaran saya aman?", a: "Ya, semua pembayaran diproses melalui sistem escrow yang aman. Dana akan ditahan hingga Anda berhasil check-in." },
      { q: "Bisakah saya membatalkan pesanan?", a: "Kebijakan pembatalan bervariasi tergantung pada masing-masing properti. Silakan periksa detail kebijakan pembatalan pada halaman detail apartemen sebelum memesan." },
      { q: "Bagaimana cara menghubungi pemilik properti?", a: "Setelah pemesanan Anda dikonfirmasi, Anda akan mendapatkan informasi kontak pemilik atau Anda dapat mengirim pesan melalui sistem chat di profil Anda." }
    ];

    // === DOM Element Selectors ===
    const DOMElements = {
      navLinks: document.querySelectorAll('.nav-link'),
      mobileMenuButton: document.querySelector('.mobile-menu-button'),
      navLinksContainer: document.getElementById('navLinks'),
      pages: document.querySelectorAll('.page'),
      featuredPropertiesGrid: document.getElementById('featuredPropertiesGrid'),
      testimonialsGrid: document.getElementById('testimonialsGrid'),
      quickSearchForm: document.getElementById('quickSearchForm'),
      fullSearchForm: document.getElementById('fullSearchForm'),
      resetFiltersBtn: document.getElementById('resetFiltersBtn'),
      searchResultsGrid: document.getElementById('searchResultsGrid'),
      searchResultsCount: document.getElementById('searchResultsCount'),
      apartmentDetailContent: document.getElementById('apartmentDetailContent'),
      profileChatWindow: document.getElementById('profileChatWindow'),
      profileChatInput: document.getElementById('profileChatInput'),
      profileChatForm: document.getElementById('profileChatForm'),
      bookingHistoryList: document.getElementById('bookingHistoryList'),
      startLiveChatBtn: document.getElementById('startLiveChatBtn'),
      faqAccordion: document.getElementById('faqAccordion'),
      adminTotalApartments: document.getElementById('adminTotalApartments'),
      adminTotalTenants: document.getElementById('adminTotalTenants'),
      adminActiveBookings: document.getElementById('adminActiveBookings'),
      adminApartmentTableBody: document.getElementById('adminApartmentTableBody'),
      floatingChatButton: document.getElementById('floatingChatButton'),
      chatboxWidget: document.getElementById('chatboxWidget'),
      closeChatboxButton: document.getElementById('closeChatboxButton'),
      chatboxMessages: document.getElementById('chatboxMessages'),
      chatboxInput: document.getElementById('chatboxInput'),
      chatboxForm: document.getElementById('chatboxForm'),
      reportReviewModal: document.getElementById('reportReviewModal'),
      closeReportModalBtn: document.getElementById('closeReportModalBtn'),
      cancelReportBtn: document.getElementById('cancelReportBtn'),
      reportReviewForm: document.getElementById('reportReviewForm'),
      reportReviewIdInput: document.getElementById('reportReviewId'),
      currentYearSpan: document.getElementById('currentYear'),
      priceRangeSlider: document.getElementById('priceRange'),
      priceRangeMinDisplay: document.getElementById('priceRangeMinDisplay'),
      priceRangeMaxDisplay: document.getElementById('priceRangeMaxDisplay'),
      amenitiesFilterCheckboxes: document.getElementById('amenitiesFilterCheckboxes'),
      sortBySelect: document.getElementById('sortBy'),
      paginationControls: document.getElementById('paginationControls'),
    };

    // === Utility Functions ===
    const Utils = {
      // Format currency (simplified)
      formatCurrency: (amount) => `Rp ${amount.toLocaleString('id-ID')}K`,
      // Get date string in YYYY-MM-DD format
      getISODate: (date) => date.toISOString().split('T')[0],
      // Debounce function
      debounce: (func, delay) => {
        let timeout;
        return (...args) => {
          clearTimeout(timeout);
          timeout = setTimeout(() => func.apply(this, args), delay);
        };
      },
      // Sanitize HTML to prevent XSS (basic)
      sanitizeHTML: (str) => {
        const temp = document.createElement('div');
        temp.textContent = str;
        return temp.innerHTML;
      },
      // Generate unique ID
      generateId: (prefix = 'id') => `${prefix}-${Math.random().toString(36).substr(2, 9)}`,
    };


    // === SPA Navigation & Routing ===
    function navigateToPage(pageId) {
      DOMElements.pages.forEach(page => {
        page.classList.toggle('hidden', page.id !== pageId);
        if (page.id === pageId) {
          page.classList.remove('fade-in'); // Remove for re-animation
          void page.offsetWidth; // Trigger reflow
          page.classList.add('fade-in');
        }
      });
      DOMElements.navLinks.forEach(link => {
        link.classList.toggle('is-active', link.dataset.page === pageId);
      });

      // Close mobile menu if open
      if (DOMElements.navLinksContainer.classList.contains('is-open')) {
        DOMElements.navLinksContainer.classList.remove('is-open');
        DOMElements.mobileMenuButton.setAttribute('aria-expanded', 'false');
        DOMElements.mobileMenuButton.innerHTML = `<span class="material-icons">menu</span>`;
      }

      AppState.currentPage = pageId;
      window.location.hash = pageId;
      window.scrollTo({ top: 0, behavior: 'smooth' });
      loadPageContent(pageId);
    }

    function handleNavClick(event) {
      event.preventDefault();
      const targetPage = event.currentTarget.dataset.page || event.currentTarget.hash.substring(1);
      if (targetPage) {
        navigateToPage(targetPage);
      }
    }

    function handleHashChange() {
      const pageId = window.location.hash.substring(1) || 'home';
      navigateToPage(pageId);
    }

    // Mobile Menu Toggle
    DOMElements.mobileMenuButton.addEventListener('click', () => {
      const isOpen = DOMElements.navLinksContainer.classList.toggle('is-open');
      DOMElements.mobileMenuButton.setAttribute('aria-expanded', isOpen.toString());
      if (isOpen) {
        DOMElements.mobileMenuButton.innerHTML = `<span class="material-icons">close</span>`;
      } else {
        DOMElements.mobileMenuButton.innerHTML = `<span class="material-icons">menu</span>`;
      }
    });


    // === Dynamic Content Loading Per Page ===
    function loadPageContent(pageId) {
      switch (pageId) {
        case 'home':
          renderFeaturedProperties();
          renderTestimonials();
          break;
        case 'search':
          // Populate search filters from AppState if returning to search page
          document.getElementById('search-location').value = AppState.searchFilters.location;
          document.getElementById('search-checkin').value = AppState.searchFilters.checkin;
          document.getElementById('search-checkout').value = AppState.searchFilters.checkout;
          document.getElementById('search-guests').value = AppState.searchFilters.guests;
          DOMElements.priceRangeSlider.value = AppState.searchFilters.priceMax;
          updatePriceRangeDisplay();
          // Check amenity checkboxes
          const amenityInputs = DOMElements.amenitiesFilterCheckboxes.querySelectorAll('input[type="checkbox"]');
          amenityInputs.forEach(input => {
            input.checked = AppState.searchFilters.amenities.includes(input.value);
          });
          document.getElementById('apartment-type').value = AppState.searchFilters.type;

          applyFiltersAndRenderResults(); // Render initial results or based on stored filters
          break;
        case 'apartment':
          if (AppState.selectedApartmentId) {
            renderApartmentDetail(AppState.selectedApartmentId);
          } else {
            // If no apartment is selected, maybe redirect to search or show an error
            DOMElements.apartmentDetailContent.innerHTML = `<p class="text-center text-lg text-danger">Apartemen tidak ditemukan. Silakan kembali ke <a href="#search" data-page="search" class="nav-link-inline">pencarian</a>.</p>`;
            document.querySelectorAll('.nav-link-inline').forEach(link => link.addEventListener('click', handleNavClick));
          }
          break;
        case 'profile':
          renderProfileInfo();
          renderBookingHistory();
          renderChatMessages('profile', DOMElements.profileChatWindow);
          break;
        case 'support':
          renderFaqs();
          break;
        case 'admin':
          renderAdminDashboard();
          break;
        default:
          console.warn(`No specific content loader for page: ${pageId}`);
      }
    }

    // === Rendering Functions ===

    // Render Property Card (Reusable)
    function createPropertyCard(apartment, isFeatured = false) {
      const card = document.createElement('article');
      card.className = 'property-card card fade-in'; // Added fade-in for individual card animation
      card.innerHTML = `
        <figure>
          <img src="${apartment.images[0]}" alt="Tampilan depan ${Utils.sanitizeHTML(apartment.title)}" loading="lazy">
          <figcaption>
            <h3 class="font-bold">${Utils.sanitizeHTML(apartment.title)} ${apartment.host.verified ? '<span class="material-icons verified-icon" title="Pemilik Terverifikasi" aria-label="Pemilik Terverifikasi">verified_user</span>' : ''}</h3>
            <div class="property-details">
              <span class="price">${Utils.formatCurrency(apartment.pricePerNight)}/malam</span>
              <span class="location"><span class="material-icons" aria-hidden="true">location_on</span> ${Utils.sanitizeHTML(apartment.location)}</span>
            </div>
            <div class="property-features">
              <span><span class="material-icons" aria-hidden="true">hotel</span> ${apartment.bedrooms} KT</span>
              <span><span class="material-icons" aria-hidden="true">bathtub</span> ${apartment.bathrooms} KM</span>
              <span><span class="material-icons" aria-hidden="true">square_foot</span> ${apartment.sqft} m¬≤</span>
            </div>
            ${apartment.reviews.length > 0 && isFeatured ? `
            <blockquote class="text-sm">
              <p>"${Utils.sanitizeHTML(apartment.reviews[0].comment)}"</p>
              <footer>- ${Utils.sanitizeHTML(apartment.reviews[0].user)}</footer>
            </blockquote>
            ` : ''}
          </figcaption>
        </figure>
        <details>
          <summary>Detail Lebih Lanjut</summary>
          <div>
            <p class="text-sm text-secondary-foreground">${Utils.sanitizeHTML(apartment.description.substring(0, 100))}...</p>
            <button class="btn btn-primary btn-sm w-full mt-sm view-detail-btn" data-id="${apartment.id}">Lihat Detail & Pesan</button>
          </div>
        </details>
      `;
      card.querySelector('.view-detail-btn').addEventListener('click', () => {
        AppState.selectedApartmentId = apartment.id;
        navigateToPage('apartment');
      });
      return card;
    }

    function renderFeaturedProperties() {
      DOMElements.featuredPropertiesGrid.innerHTML = ''; // Clear previous
      const featured = AppState.apartments.sort((a, b) => b.rating - a.rating).slice(0, 3);
      featured.forEach(apt => {
        DOMElements.featuredPropertiesGrid.appendChild(createPropertyCard(apt, true));
      });
    }

    function renderTestimonials() {
      DOMElements.testimonialsGrid.innerHTML = '';
      MOCK_TESTIMONIALS.forEach(testimonial => {
        const testimonialEl = document.createElement('div');
        testimonialEl.className = 'card';
        testimonialEl.innerHTML = `
          <div class="card-body">
            <blockquote class="flex flex-col h-full">
              <img src="${testimonial.avatar}" alt="Foto ${Utils.sanitizeHTML(testimonial.user)}" class="rounded-lg shadow-md mb-sm" style="width:60px; height:60px; border-radius:50%; object-fit:cover; align-self:center;">
              <p class="text-secondary-foreground flex-grow">"${Utils.sanitizeHTML(testimonial.comment)}"</p>
              <footer class="mt-auto text-center font-medium text-primary">- ${Utils.sanitizeHTML(testimonial.user)}</footer>
            </blockquote>
          </div>
        `;
        DOMElements.testimonialsGrid.appendChild(testimonialEl);
      });
    }

    function renderSearchResults(apartmentsToRender) {
      DOMElements.searchResultsGrid.innerHTML = '';
      DOMElements.searchResultsCount.textContent = apartmentsToRender.length;

      if (apartmentsToRender.length === 0) {
        DOMElements.searchResultsGrid.innerHTML = '<p class="text-center col-span-full">Tidak ada apartemen yang cocok dengan kriteria pencarian Anda.</p>';
        DOMElements.paginationControls.innerHTML = '';
        return;
      }

      const paginatedResults = paginateResults(apartmentsToRender, AppState.currentPageNumber, AppState.itemsPerPage);

      paginatedResults.forEach(apt => {
        DOMElements.searchResultsGrid.appendChild(createPropertyCard(apt));
      });

      renderPaginationControls(apartmentsToRender.length, AppState.itemsPerPage);
    }

    function paginateResults(items, page, perPage) {
      const start = (page - 1) * perPage;
      const end = start + perPage;
      return items.slice(start, end);
    }

    function renderPaginationControls(totalItems, perPage) {
      DOMElements.paginationControls.innerHTML = '';
      const totalPages = Math.ceil(totalItems / perPage);

      if (totalPages <= 1) return;

      for (let i = 1; i <= totalPages; i++) {
        const button = document.createElement('button');
        button.textContent = i;
        button.className = `btn ${i === AppState.currentPageNumber ? 'btn-primary' : 'btn-outline'}`;
        button.style.margin = '0 5px';
        button.addEventListener('click', () => {
          AppState.currentPageNumber = i;
          applyFiltersAndRenderResults(); // Re-render with the new page
        });
        DOMElements.paginationControls.appendChild(button);
      }
    }


    function renderAmenityCheckboxes() {
      DOMElements.amenitiesFilterCheckboxes.innerHTML = '';
      Object.entries(ALL_AMENITIES).forEach(([key, { icon, label }]) => {
        const div = document.createElement('div');
        div.className = 'form-check';
        div.innerHTML = `
          <input type="checkbox" id="amenity-${key}" value="${key}" class="form-check-input">
          <label for="amenity-${key}" class="flex items-center gap-xs">
            <span class="material-icons text-sm" aria-hidden="true">${icon}</span>
            ${label}
          </label>
        `;
        DOMElements.amenitiesFilterCheckboxes.appendChild(div);
      });
    }


    function renderApartmentDetail(apartmentId) {
      const apartment = AppState.apartments.find(apt => apt.id === apartmentId);
      if (!apartment) {
        DOMElements.apartmentDetailContent.innerHTML = '<p class="text-center text-lg text-danger">Detail apartemen tidak ditemukan.</p>';
        return;
      }

      DOMElements.apartmentDetailContent.innerHTML = `
        <header class="mb-lg">
          <h1 class="text-3xl font-bold">${Utils.sanitizeHTML(apartment.title)}</h1>
          <div class="flex items-center gap-md text-secondary-foreground">
            <span><span class="material-icons" aria-hidden="true">star</span> ${apartment.rating}/5 (${apartment.reviews.length} ulasan)</span>
            <span><span class="material-icons" aria-hidden="true">location_on</span> ${Utils.sanitizeHTML(apartment.location)}</span>
            ${apartment.host.verified ? '<span><span class="material-icons verified-icon" title="Pemilik Terverifikasi">verified_user</span> Pemilik Terverifikasi</span>' : ''}
          </div>
        </header>

        <section class="gallery mb-lg" aria-label="Galeri foto apartemen">
          <div class="virtual-tour-placeholder" style="background-image: url('${apartment.images[0]}'); background-size: cover; background-position: center;">
            <!-- <span class="material-icons" aria-hidden="true">tour</span> -->
            <!-- <p>Tur Virtual 360¬∞ Tersedia</p> -->
            <!-- <button class="btn btn-primary btn-sm mt-sm">Mulai Tur</button> -->
          </div>
          ${apartment.images.slice(1, 5).map(img => `<img src="${img}" alt="Foto interior ${Utils.sanitizeHTML(apartment.title)}" loading="lazy" tabindex="0">`).join('')}
        </section>
        
        <div class="grid grid-cols-1 apartment-detail-grid" style="grid-template-columns: 2fr 1fr; gap: var(--spacing-xl);">
          <article>
            <h2 class="text-2xl mb-md">Deskripsi Apartemen</h2>
            <p class="text-secondary-foreground mb-md">${Utils.sanitizeHTML(apartment.description)}</p>
            
            <h3 class="text-xl mb-sm">Fasilitas Utama</h3>
            <ul class="grid grid-cols-2 gap-x-md gap-y-sm list-none mb-md text-secondary-foreground">
              ${apartment.amenities.map(key => `
                <li class="flex items-center gap-xs">
                  <span class="material-icons text-primary" aria-hidden="true">${ALL_AMENITIES[key]?.icon || 'check_box_outline_blank'}</span>
                  ${ALL_AMENITIES[key]?.label || key}
                </li>
              `).join('')}
            </ul>

            <h3 class="text-xl mb-sm">Peta Lokasi</h3>
            <div class="map-canvas mb-md" aria-label="Peta menunjukkan lokasi apartemen">
              Peta Interaktif Akan Ditampilkan Di Sini (Simulasi)
            </div>
            <a href="https://maps.google.com/?q=${encodeURIComponent(apartment.location)}" target="_blank" rel="noopener noreferrer" class="btn btn-outline btn-sm">
                <span class="material-icons" aria-hidden="true">map</span>Lihat di Google Maps
            </a>
            
            <h2 class="text-2xl mt-lg mb-md">Ulasan (${apartment.reviews.length})</h2>
            <div id="apartmentReviewsList" class="flex flex-col gap-md">
              ${apartment.reviews.length > 0 ? apartment.reviews.map(review => `
                <div class="card">
                  <div class="card-body">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-medium">${Utils.sanitizeHTML(review.user)} - <span class="text-sm text-secondary-foreground">${new Date(review.date).toLocaleDateString('id-ID')}</span></p>
                            <p class="text-sm text-yellow-500">${'‚òÖ'.repeat(Math.round(review.rating))}${'‚òÜ'.repeat(5 - Math.round(review.rating))}</p>
                        </div>
                        <button class="btn-icon report-review-btn" data-review-id="${review.id}" title="Laporkan ulasan ini" aria-label="Laporkan ulasan dari ${Utils.sanitizeHTML(review.user)}">
                            <span class="material-icons report-icon">flag</span>
                        </button>
                    </div>
                    <blockquote class="mt-xs mb-0 text-secondary-foreground text-sm"><p>"${Utils.sanitizeHTML(review.comment)}"</p></blockquote>
                  </div>
                </div>
              `).join('') : '<p class="text-secondary-foreground">Belum ada ulasan untuk properti ini.</p>'}
            </div>
          </article>

          <aside class="sticky-sidebar" style="position: sticky; top: calc(var(--spacing-xl) + 80px); /* 80px approx navbar height */">
            <form id="bookingForm" class="card">
              <div class="card-header">
                <h3 class="text-xl mb-0">Mulai dari <span class="text-primary font-bold">${Utils.formatCurrency(apartment.pricePerNight)}</span>/malam</h3>
              </div>
              <div class="card-body">
                <div class="form-group">
                  <label for="book-checkin">Check-in</label>
                  <input type="date" id="book-checkin" class="form-control" required aria-label="Tanggal check-in pemesanan">
                </div>
                <div class="form-group">
                  <label for="book-checkout">Check-out</label>
                  <input type="date" id="book-checkout" class="form-control" required aria-label="Tanggal check-out pemesanan">
                </div>
                <div class="form-group">
                  <label for="book-guests">Jumlah Tamu</label>
                  <input type="number" id="book-guests" class="form-control" min="1" value="1" required aria-label="Jumlah tamu">
                </div>
                <div class="form-group">
                  <label>Metode Pembayaran</label>
                  <div class="payment-methods" role="radiogroup" aria-label="Pilih metode pembayaran">
                    <div class="payment-method" data-method="credit_card" tabindex="0" role="radio" aria-checked="false">Kartu Kredit</div>
                    <div class="payment-method" data-method="bank_transfer" tabindex="0" role="radio" aria-checked="false">Transfer Bank</div>
                    <div class="payment-method" data-method="e_wallet" tabindex="0" role="radio" aria-checked="false">E-Wallet</div>
                  </div>
                </div>
                <div class="form-group form-check">
                  <input type="checkbox" id="booking-insurance" class="form-check-input">
                  <label for="booking-insurance">Tambah Asuransi Perjalanan (+10%)</label>
                </div>
                
                <div id="bookingCostBreakdown" class="cost-breakdown hidden">
                  <h4 class="font-medium">Rincian Biaya</h4>
                  <div class="cost-line"><span>Harga Dasar (<span id="bookingNumNights">0</span> malam)</span><span id="bookingBaseCost">Rp 0</span></div>
                  <div class="cost-line"><span>Biaya Layanan (5%)</span><span id="bookingServiceCost">Rp 0</span></div>
                  <div class="cost-line hidden" id="bookingInsuranceCostLine"><span>Asuransi</span><span id="bookingInsuranceCostVal">Rp 0</span></div>
                  <hr class="my-sm border-border">
                  <div class="cost-line total"><span>Total Pembayaran</span><span id="bookingTotalCost">Rp 0</span></div>
                </div>

                <p class="escrow-info text-sm mt-md"><span class="material-icons" aria-hidden="true">security</span>Pembayaran Anda dijamin aman melalui sistem escrow EliteRent hingga Anda berhasil check-in.</p>
              </div>
              <div class="card-footer">
                <button type="submit" class="btn btn-primary w-full">
                  <span class="material-icons" aria-hidden="true">event_available</span>Pesan Sekarang
                </button>
              </div>
            </form>
          </aside>
        </div>
      `;

      // Add event listeners for dynamic content
      document.querySelectorAll('.payment-method').forEach(method => {
        method.addEventListener('click', handlePaymentMethodSelect);
        method.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') method.click(); });
      });
      document.getElementById('bookingForm').addEventListener('submit', handleBookingSubmit);
      document.getElementById('book-checkin').addEventListener('change', updateBookingCost);
      document.getElementById('book-checkout').addEventListener('change', updateBookingCost);
      document.getElementById('booking-insurance').addEventListener('change', updateBookingCost);

      // Set min date for date pickers
      const today = Utils.getISODate(new Date());
      document.getElementById('book-checkin').min = today;
      document.getElementById('book-checkout').min = today;

      // Attach event listeners for report buttons
      document.querySelectorAll('.report-review-btn').forEach(button => {
        button.addEventListener('click', (e) => {
          const reviewId = e.currentTarget.dataset.reviewId;
          openReportModal(reviewId);
        });
      });

      // Simple image modal functionality (optional enhancement)
      const galleryImages = DOMElements.apartmentDetailContent.querySelectorAll('.gallery img');
      galleryImages.forEach(img => {
        img.addEventListener('click', () => { /* Logic to open image in a larger view/modal */ console.log('Image clicked:', img.src); });
        img.addEventListener('keydown', (e) => { if (e.key === 'Enter') img.click(); });
      });

    }

    function renderProfileInfo() {
      // Example: update elements if they exist
      const userNameEl = document.querySelector('#profile .card-body h2'); // More specific selector
      if (userNameEl) userNameEl.textContent = AppState.userProfile.name;
      // ... and so on for email, loyalty points, profile picture
    }

    function renderBookingHistory() {
      DOMElements.bookingHistoryList.innerHTML = '';
      if (AppState.bookingHistory.length === 0) {
        DOMElements.bookingHistoryList.innerHTML = `
          <div class="card"><div class="card-body"><p class="text-secondary-foreground">Anda belum memiliki riwayat pemesanan.</p></div></div>`;
        return;
      }
      AppState.bookingHistory.forEach(booking => {
        const apartment = AppState.apartments.find(apt => apt.id === booking.apartmentId);
        const item = document.createElement('div');
        item.className = 'card';
        item.innerHTML = `
          <div class="card-body flex gap-md items-center">
            <img src="${apartment.images[0]}" alt="${Utils.sanitizeHTML(apartment.title)}" style="width:100px; height:80px; object-fit:cover; border-radius:var(--radius-sm);">
            <div class="flex-grow">
              <h4 class="font-medium mb-xs">${Utils.sanitizeHTML(apartment.title)}</h4>
              <p class="text-sm text-secondary-foreground mb-xs">Check-in: ${new Date(booking.checkin).toLocaleDateString('id-ID')} | Check-out: ${new Date(booking.checkout).toLocaleDateString('id-ID')}</p>
              <p class="text-sm font-semibold">Total: ${Utils.formatCurrency(booking.totalCost / 1000)}</p>
            </div>
            <button class="btn btn-outline btn-sm view-booking-detail-btn" data-booking-id="${booking.id}">Lihat Detail</button>
          </div>
        `;
        DOMElements.bookingHistoryList.appendChild(item);
      });
    }

    function renderChatMessages(chatType, chatWindowElement) { // chatType: 'profile' or 'support'
      chatWindowElement.innerHTML = '';
      const messages = AppState.chatMessages[chatType];
      messages.forEach(msg => {
        const msgDiv = document.createElement('div');
        msgDiv.classList.add('chat-message', msg.type); // type can be 'sent', 'received', 'system'
        msgDiv.textContent = Utils.sanitizeHTML(msg.text);
        chatWindowElement.appendChild(msgDiv);
      });
      chatWindowElement.scrollTop = chatWindowElement.scrollHeight;
    }

    function renderFaqs() {
      DOMElements.faqAccordion.innerHTML = '';
      MOCK_FAQS.forEach((faq, index) => {
        const details = document.createElement('details');
        details.className = 'card'; // Style it like a card for consistency
        details.innerHTML = `
          <summary class="font-medium">${Utils.sanitizeHTML(faq.q)}</summary>
          <div class="p-md pt-0 text-secondary-foreground">
            <p>${Utils.sanitizeHTML(faq.a)}</p>
          </div>
        `;
        DOMElements.faqAccordion.appendChild(details);
      });
    }

    function renderAdminDashboard() {
      DOMElements.adminTotalApartments.textContent = AppState.apartments.length;
      // Mock other stats
      DOMElements.adminTotalTenants.textContent = Math.floor(Math.random() * 200) + 50;
      DOMElements.adminActiveBookings.textContent = Math.floor(Math.random() * 50) + 10;

      DOMElements.adminApartmentTableBody.innerHTML = '';
      AppState.apartments.slice(0, 5).forEach(apt => { // Show first 5 for demo
        const row = DOMElements.adminApartmentTableBody.insertRow();
        row.innerHTML = `
          <td>#${apt.id}</td>
          <td>${Utils.sanitizeHTML(apt.title)}</td>
          <td>${Utils.sanitizeHTML(apt.location)}</td>
          <td><span class="badge ${Object.keys(apt.availability).length > 0 ? 'badge-warning' : 'badge-success'}">${Object.keys(apt.availability).length > 0 ? 'Terpesan Sebagian' : 'Tersedia'}</span></td>
          <td>${Utils.formatCurrency(apt.pricePerNight)}</td>
          <td>
            <button class="btn btn-sm btn-outline" title="Edit"><span class="material-icons">edit</span></button>
            <button class="btn btn-sm btn-danger" title="Hapus"><span class="material-icons">delete</span></button>
          </td>
        `;
      });
    }

    // === Event Handlers & Logic ===

    // Price Range Slider
    function updatePriceRangeDisplay() {
      const maxPrice = parseInt(DOMElements.priceRangeSlider.value);
      AppState.searchFilters.priceMax = maxPrice;
      DOMElements.priceRangeMaxDisplay.textContent = `${maxPrice}`;
      // Min display is static or could be another slider
      DOMElements.priceRangeMinDisplay.textContent = `${DOMElements.priceRangeSlider.min}`;
    }


    // Search and Filtering Logic
    function handleFullSearchForm(event) {
      event.preventDefault();
      AppState.searchFilters.location = document.getElementById('search-location').value.trim().toLowerCase();
      AppState.searchFilters.checkin = document.getElementById('search-checkin').value;
      AppState.searchFilters.checkout = document.getElementById('search-checkout').value;
      AppState.searchFilters.guests = parseInt(document.getElementById('search-guests').value) || 1;
      AppState.searchFilters.priceMax = parseInt(DOMElements.priceRangeSlider.value);
      AppState.searchFilters.type = document.getElementById('apartment-type').value;

      AppState.searchFilters.amenities = [];
      DOMElements.amenitiesFilterCheckboxes.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
        AppState.searchFilters.amenities.push(cb.value);
      });

      AppState.currentPageNumber = 1; // Reset to first page on new filter
      applyFiltersAndRenderResults();
    }

    function applyFiltersAndRenderResults() {
      let results = AppState.apartments.filter(apt => {
        const matchesLocation = AppState.searchFilters.location ? apt.location.toLowerCase().includes(AppState.searchFilters.location) : true;
        const matchesPrice = apt.pricePerNight <= AppState.searchFilters.priceMax;
        const matchesType = AppState.searchFilters.type ? apt.type === AppState.searchFilters.type : true;
        const matchesAmenities = AppState.searchFilters.amenities.length > 0 ? AppState.searchFilters.amenities.every(am => apt.amenities.includes(am)) : true;

        // Date availability check (simplified for now, more robust check needed for ranges)
        let isAvailable = true;
        if (AppState.searchFilters.checkin) {
          // This is a basic check. A real check would iterate through the date range.
          isAvailable = !apt.availability[AppState.searchFilters.checkin];
        }
        if (AppState.searchFilters.checkout && isAvailable) {
          isAvailable = !apt.availability[AppState.searchFilters.checkout];
        }
        // TODO: More complex date range availability check involving AppState.searchFilters.checkout

        return matchesLocation && matchesPrice && matchesType && matchesAmenities && isAvailable;
      });

      // Sorting
      const sortBy = DOMElements.sortBySelect.value;
      if (sortBy === 'price_asc') {
        results.sort((a, b) => a.pricePerNight - b.pricePerNight);
      } else if (sortBy === 'price_desc') {
        results.sort((a, b) => b.pricePerNight - a.pricePerNight);
      } else if (sortBy === 'rating_desc') {
        results.sort((a, b) => b.rating - a.rating);
      } // Default 'relevance' (original order or backend logic)

      AppState.filteredApartments = results;
      renderSearchResults(AppState.filteredApartments);
    }

    function resetFilters() {
      DOMElements.fullSearchForm.reset(); // Resets form elements to their default values
      AppState.searchFilters = { // Reset AppState filters
        location: '',
        checkin: '',
        checkout: '',
        guests: 1,
        priceMax: 500, // Default max from slider
        amenities: [],
        type: '',
      };
      DOMElements.priceRangeSlider.value = 500; // Reset slider visually
      updatePriceRangeDisplay(); // Update display for slider
      AppState.currentPageNumber = 1; // Reset to first page
      applyFiltersAndRenderResults(); // Re-render with default/empty filters
    }


    function handleQuickSearchForm(event) {
      event.preventDefault();
      // Populate AppState.searchFilters from quick search
      AppState.searchFilters.location = document.getElementById('quick-location').value.trim().toLowerCase();
      AppState.searchFilters.checkin = document.getElementById('quick-checkin').value;
      AppState.searchFilters.checkout = document.getElementById('quick-checkout').value;
      // Reset other filters to default if necessary
      AppState.searchFilters.priceMax = parseInt(DOMElements.priceRangeSlider.max); // Max of range
      AppState.searchFilters.amenities = [];
      AppState.searchFilters.type = '';
      AppState.searchFilters.guests = 1;
      AppState.currentPageNumber = 1; // Reset to first page

      navigateToPage('search'); // This will trigger loadPageContent for 'search'
      // which then calls applyFiltersAndRenderResults
    }

    // Booking Logic
    function handlePaymentMethodSelect(event) {
      document.querySelectorAll('.payment-method').forEach(m => {
        m.classList.remove('selected');
        m.setAttribute('aria-checked', 'false');
      });
      event.currentTarget.classList.add('selected');
      event.currentTarget.setAttribute('aria-checked', 'true');
    }

    function updateBookingCost() {
      const apartment = AppState.apartments.find(apt => apt.id === AppState.selectedApartmentId);
      if (!apartment) return;

      const checkinDate = document.getElementById('book-checkin').value;
      const checkoutDate = document.getElementById('book-checkout').value;
      const insuranceChecked = document.getElementById('booking-insurance').checked;

      if (checkinDate && checkoutDate) {
        const date1 = new Date(checkinDate);
        const date2 = new Date(checkoutDate);
        if (date2 <= date1) {
          document.getElementById('bookingCostBreakdown').classList.add('hidden');
          // Optionally show an error message
          return;
        }

        const timeDiff = date2.getTime() - date1.getTime();
        const numNights = Math.ceil(timeDiff / (1000 * 3600 * 24));

        if (numNights > 0) {
          const baseCost = numNights * (apartment.pricePerNight * 1000); // price is in K
          const serviceFee = baseCost * 0.05; // 5% service fee
          let insuranceCost = 0;

          document.getElementById('bookingNumNights').textContent = numNights;
          document.getElementById('bookingBaseCost').textContent = `Rp ${baseCost.toLocaleString('id-ID')}`;
          document.getElementById('bookingServiceCost').textContent = `Rp ${serviceFee.toLocaleString('id-ID')}`;

          const insuranceCostLine = document.getElementById('bookingInsuranceCostLine');
          if (insuranceChecked) {
            insuranceCost = baseCost * 0.10; // 10% insurance
            document.getElementById('bookingInsuranceCostVal').textContent = `Rp ${insuranceCost.toLocaleString('id-ID')}`;
            insuranceCostLine.classList.remove('hidden');
          } else {
            insuranceCostLine.classList.add('hidden');
          }

          const totalCost = baseCost + serviceFee + insuranceCost;
          document.getElementById('bookingTotalCost').textContent = `Rp ${totalCost.toLocaleString('id-ID')}`;
          document.getElementById('bookingCostBreakdown').classList.remove('hidden');
          return; // Exit if calculation is successful
        }
      }
      // If dates are not valid or nights are zero, hide breakdown
      document.getElementById('bookingCostBreakdown').classList.add('hidden');
    }


    function handleBookingSubmit(event) {
      event.preventDefault();
      const apartment = AppState.apartments.find(apt => apt.id === AppState.selectedApartmentId);
      const checkin = document.getElementById('book-checkin').value;
      const checkout = document.getElementById('book-checkout').value;
      const guests = document.getElementById('book-guests').value;
      const paymentMethod = document.querySelector('.payment-method.selected')?.dataset.method;
      const insurance = document.getElementById('booking-insurance').checked;

      if (!checkin || !checkout || !guests || !paymentMethod) {
        alert('Harap lengkapi semua field yang diperlukan (tanggal, tamu, dan metode pembayaran).');
        return;
      }
      if (new Date(checkout) <= new Date(checkin)) {
        alert('Tanggal check-out harus setelah tanggal check-in.');
        return;
      }

      // Simulate date conflict check
      let conflict = false;
      let currentDate = new Date(checkin);
      let endDateLoop = new Date(checkout); // Exclusive of checkout day for nights
      while (currentDate < endDateLoop) {
        if (apartment.availability[Utils.getISODate(currentDate)] === 'booked') {
          conflict = true;
          break;
        }
        currentDate.setDate(currentDate.getDate() + 1);
      }

      if (conflict) {
        alert(`Maaf, tanggal antara ${new Date(checkin).toLocaleDateString('id-ID')} dan ${new Date(checkout).toLocaleDateString('id-ID')} tidak tersedia. Silakan pilih tanggal lain.`);
        return;
      }

      // If all good, proceed with booking simulation
      const timeDiff = new Date(checkout).getTime() - new Date(checkin).getTime();
      const numNights = Math.ceil(timeDiff / (1000 * 3600 * 24));
      const baseCost = numNights * (apartment.pricePerNight * 1000);
      const serviceFee = baseCost * 0.05;
      const insuranceCost = insurance ? baseCost * 0.10 : 0;
      const totalCost = baseCost + serviceFee + insuranceCost;

      const bookingId = Utils.generateId('bk');
      const newBooking = {
        id: bookingId,
        apartmentId: apartment.id,
        checkin,
        checkout,
        guests: parseInt(guests),
        totalCost,
        paymentMethod,
        status: 'confirmed'
      };
      AppState.bookingHistory.push(newBooking);

      // Mark dates as booked in mock data
      currentDate = new Date(checkin); // Reset current date for loop
      while (currentDate < endDateLoop) { // Loop through booked nights
        apartment.availability[Utils.getISODate(currentDate)] = 'booked';
        currentDate.setDate(currentDate.getDate() + 1);
      }

      alert(`Pemesanan Anda untuk ${Utils.sanitizeHTML(apartment.title)} dari tanggal ${new Date(checkin).toLocaleDateString('id-ID')} hingga ${new Date(checkout).toLocaleDateString('id-ID')} telah berhasil! Total: Rp ${totalCost.toLocaleString('id-ID')}. Detail akan dikirim ke email Anda.`);
      document.getElementById('bookingForm').reset(); // Reset form
      document.getElementById('bookingCostBreakdown').classList.add('hidden'); // Hide cost breakdown
      document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));

      // Optionally navigate to profile page to see booking history
      navigateToPage('profile');
    }

    // Chat Logic
    function handleChatSubmit(event, chatType, inputElement, windowElement) {
      event.preventDefault();
      const text = inputElement.value.trim();
      if (text) {
        AppState.chatMessages[chatType].push({ type: 'sent', text, timestamp: Date.now() });
        renderChatMessages(chatType, windowElement);
        inputElement.value = '';

        // Simulate reply
        setTimeout(() => {
          const replyText = chatType === 'profile' ?
            "Pemilik akan segera merespons pesan Anda." :
            "Terima kasih telah menghubungi kami. Seorang agen akan segera membantu Anda.";
          AppState.chatMessages[chatType].push({ type: 'received', text: replyText, timestamp: Date.now() });
          renderChatMessages(chatType, windowElement);
        }, 1500);
      }
    }

    // Report Review Modal Logic
    function openReportModal(reviewId) {
      const apartmentContainingReview = AppState.apartments.find(apt => apt.reviews.some(r => r.id === reviewId));
      if (!apartmentContainingReview) {
        console.error("Review ID not found in any apartment:", reviewId);
        return;
      }
      const review = apartmentContainingReview.reviews.find(r => r.id === reviewId);
      if (review.reported) {
        alert("Ulasan ini sudah pernah dilaporkan sebelumnya.");
        return;
      }

      DOMElements.reportReviewIdInput.value = reviewId;
      DOMElements.reportReviewForm.reset(); // Clear previous reasons
      DOMElements.reportReviewModal.classList.add('is-open');
      document.getElementById('report-reason').focus();
    }

    function closeReportModal() {
      DOMElements.reportReviewModal.classList.remove('is-open');
    }

    function handleReportReviewSubmit(event) {
      event.preventDefault();
      const reviewId = DOMElements.reportReviewIdInput.value;
      const reason = document.getElementById('report-reason').value.trim();
      const category = document.getElementById('report-category').value;

      if (!reason || !category) {
        alert("Mohon isi alasan dan pilih kategori pelaporan.");
        return;
      }

      // Find the apartment and the review, then mark as reported
      const apartmentContainingReview = AppState.apartments.find(apt => apt.reviews.some(r => r.id === reviewId));
      if (apartmentContainingReview) {
        const review = apartmentContainingReview.reviews.find(r => r.id === reviewId);
        if (review) {
          review.reported = true;
        }
      }

      console.log(`Review ${reviewId} reported. Reason: ${reason}, Category: ${category}`);
      alert("Laporan Anda telah dikirim. Terima kasih atas masukannya.");
      closeReportModal();
      // Re-render apartment details if on that page to reflect reported status (optional visual cue)
      if (AppState.currentPage === 'apartment' && AppState.selectedApartmentId === apartmentContainingReview.id) {
        renderApartmentDetail(AppState.selectedApartmentId);
      }
    }

    // Chatbox Widget
    function toggleChatbox() {
      DOMElements.chatboxWidget.classList.toggle('hidden');
      if (!DOMElements.chatboxWidget.classList.contains('hidden')) {
        DOMElements.chatboxInput.focus();
        renderChatMessages('support', DOMElements.chatboxMessages); // Re-render on open
      }
    }


    // === Initialization ===
    function initializeApp() {
      // Set current year in footer
      if (DOMElements.currentYearSpan) {
        DOMElements.currentYearSpan.textContent = new Date().getFullYear();
      }

      // Populate AppState with mock data
      AppState.apartments = MOCK_APARTMENTS;
      renderAmenityCheckboxes();

      // Attach event listeners
      DOMElements.navLinks.forEach(link => link.addEventListener('click', handleNavClick));
      window.addEventListener('hashchange', handleHashChange);

      if (DOMElements.quickSearchForm) DOMElements.quickSearchForm.addEventListener('submit', handleQuickSearchForm);
      if (DOMElements.fullSearchForm) DOMElements.fullSearchForm.addEventListener('submit', handleFullSearchForm);
      if (DOMElements.resetFiltersBtn) DOMElements.resetFiltersBtn.addEventListener('click', resetFilters);


      if (DOMElements.profileChatForm) {
        DOMElements.profileChatForm.addEventListener('submit', (e) => handleChatSubmit(e, 'profile', DOMElements.profileChatInput, DOMElements.profileChatWindow));
      }
      if (DOMElements.startLiveChatBtn) DOMElements.startLiveChatBtn.addEventListener('click', () => {
        if (DOMElements.chatboxWidget.classList.contains('hidden')) {
          toggleChatbox();
        }
        DOMElements.chatboxInput.focus();
      });

      if (DOMElements.priceRangeSlider) {
        DOMElements.priceRangeSlider.addEventListener('input', Utils.debounce(updatePriceRangeDisplay, 50));
        DOMElements.priceRangeSlider.addEventListener('change', () => { // For final value after drag
          updatePriceRangeDisplay();
          applyFiltersAndRenderResults(); // Trigger search on release
        });
        updatePriceRangeDisplay(); // Initial display
      }

      if (DOMElements.sortBySelect) {
        DOMElements.sortBySelect.addEventListener('change', () => {
          AppState.currentPageNumber = 1; // Reset to first page on sort change
          applyFiltersAndRenderResults();
        });
      }


      // Floating Chatbox
      if (DOMElements.floatingChatButton) DOMElements.floatingChatButton.addEventListener('click', toggleChatbox);
      if (DOMElements.closeChatboxButton) DOMElements.closeChatboxButton.addEventListener('click', toggleChatbox);
      if (DOMElements.chatboxForm) DOMElements.chatboxForm.addEventListener('submit', (e) => handleChatSubmit(e, 'support', DOMElements.chatboxInput, DOMElements.chatboxMessages));

      // Report Modal
      if (DOMElements.reportReviewModal) {
        DOMElements.closeReportModalBtn.addEventListener('click', closeReportModal);
        DOMElements.cancelReportBtn.addEventListener('click', closeReportModal);
        DOMElements.reportReviewForm.addEventListener('submit', handleReportReviewSubmit);
        // Close modal if backdrop is clicked
        DOMElements.reportReviewModal.addEventListener('click', (event) => {
          if (event.target === DOMElements.reportReviewModal) {
            closeReportModal();
          }
        });
      }


      // Load initial page based on hash or default to home
      const initialPageId = window.location.hash.substring(1) || 'home';
      navigateToPage(initialPageId);

      // Initial render for search page if it's the landing page with filters
      if (initialPageId === 'search') {
        applyFiltersAndRenderResults();
      }
    }

    // Start the application once the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', initializeApp);

  </script>
</body>

</html>