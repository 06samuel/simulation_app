<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="Rentelindo - Platform penyewaan apartemen modern dan terpercaya. Temukan apartemen impian Anda dengan mudah.">
  <meta name="keywords" content="sewa apartemen, apartemen, rental, properti, Rentelindo">
  <meta name="author" content="Rentelindo">
  <title>Rentelindo - Penyewaan Apartemen Premium</title>
  <!-- Ikon Material Google -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Font Inter Google -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* SISTEM DESAIN & VARIABEL GLOBAL */
    :root {
      --color-primary: hsl(210, 85%, 55%);
      /* Biru yang lebih modern */
      --color-primary-light: hsl(210, 85%, 95%);
      --color-primary-dark: hsl(210, 85%, 45%);
      --color-secondary: hsl(170, 70%, 45%);
      /* Teal/Hijau Mint */
      --color-accent: hsl(30, 90%, 60%);
      /* Oranye lembut */
      --color-background: hsl(0, 0%, 98%);
      --color-surface: hsl(0, 0%, 100%);
      --color-foreground: hsl(210, 15%, 25%);
      --color-foreground-muted: hsl(210, 15%, 55%);
      --color-border: hsl(210, 20%, 88%);
      --color-success: hsl(140, 60%, 50%);
      --color-error: hsl(0, 70%, 60%);
      --color-warning: hsl(40, 80%, 60%);

      --font-family-sans: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      --font-size-base: 1rem;
      /* 16px default */
      --line-height-base: 1.6;

      --space-xxs: 0.25rem;
      /* 4px */
      --space-xs: 0.5rem;
      /* 8px */
      --space-sm: 0.75rem;
      /* 12px */
      --space-md: 1rem;
      /* 16px */
      --space-lg: 1.5rem;
      /* 24px */
      --space-xl: 2rem;
      /* 32px */
      --space-xxl: 3rem;
      /* 48px */

      --radius-sm: 0.25rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-full: 9999px;

      --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.03);
      --shadow-sm: 0 2px 4px -1px rgba(0, 0, 0, 0.06), 0 2px 2px -1px rgba(0, 0, 0, 0.04);
      --shadow-md: 0 4px 8px -2px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

      --transition-base: all 0.25s ease-in-out;
      --transition-fast: all 0.15s ease-in-out;

      --z-index-dropdown: 1000;
      --z-index-sticky: 1020;
      --z-index-modal-backdrop: 1040;
      --z-index-modal: 1050;
      --z-index-popover: 1060;
      --z-index-tooltip: 1070;
      --z-index-chatbox: 1100;
    }

    /* RESET & DASAR */
    *,
    *::before,
    *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      font-size: var(--font-size-base);
    }

    body {
      font-family: var(--font-family-sans);
      background-color: var(--color-background);
      color: var(--color-foreground);
      line-height: var(--line-height-base);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    a {
      text-decoration: none;
      color: var(--color-primary);
      transition: var(--transition-fast);
    }

    a:hover {
      color: var(--color-primary-dark);
      text-decoration: underline;
    }

    img,
    picture,
    video,
    canvas,
    svg {
      display: block;
      max-width: 100%;
    }

    button,
    input,
    select,
    textarea {
      font-family: inherit;
      font-size: inherit;
      line-height: inherit;
      color: inherit;
      outline: none;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
    }

    button {
      cursor: pointer;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-weight: 600;
      line-height: 1.3;
      margin-bottom: var(--space-md);
    }

    h1 {
      font-size: 2.25rem;
    }

    /* 36px */
    h2 {
      font-size: 1.875rem;
    }

    /* 30px */
    h3 {
      font-size: 1.5rem;
    }

    /* 24px */
    p {
      margin-bottom: var(--space-md);
    }

    ul,
    ol {
      list-style: none;
    }

    /* KELAS UTILITAS */
    .container {
      width: 100%;
      max-width: 1280px;
      /* Lebar kontainer lebih besar */
      margin-left: auto;
      margin-right: auto;
      padding-left: var(--space-lg);
      padding-right: var(--space-lg);
    }

    .flex {
      display: flex;
    }

    .flex-col {
      flex-direction: column;
    }

    .items-center {
      align-items: center;
    }

    .justify-center {
      justify-content: center;
    }

    .justify-between {
      justify-content: space-between;
    }

    .gap-xs {
      gap: var(--space-xs);
    }

    .gap-sm {
      gap: var(--space-sm);
    }

    .gap-md {
      gap: var(--space-md);
    }

    .gap-lg {
      gap: var(--space-lg);
    }

    .gap-xl {
      gap: var(--space-xl);
    }

    .p-xs {
      padding: var(--space-xs);
    }

    .p-sm {
      padding: var(--space-sm);
    }

    .p-md {
      padding: var(--space-md);
    }

    .p-lg {
      padding: var(--space-lg);
    }

    .p-xl {
      padding: var(--space-xl);
    }

    .m-xs {
      margin: var(--space-xs);
    }

    .m-sm {
      margin: var(--space-sm);
    }

    .m-md {
      margin: var(--space-md);
    }

    .m-lg {
      margin: var(--space-lg);
    }

    .m-xl {
      margin: var(--space-xl);
    }

    .mt-xs {
      margin-top: var(--space-xs);
    }

    .mt-sm {
      margin-top: var(--space-sm);
    }

    .mt-md {
      margin-top: var(--space-md);
    }

    .mt-lg {
      margin-top: var(--space-lg);
    }

    .mt-xl {
      margin-top: var(--space-xl);
    }

    .mb-xs {
      margin-bottom: var(--space-xs);
    }

    .mb-sm {
      margin-bottom: var(--space-sm);
    }

    .mb-md {
      margin-bottom: var(--space-md);
    }

    .mb-lg {
      margin-bottom: var(--space-lg);
    }

    .mb-xl {
      margin-bottom: var(--space-xl);
    }

    .w-full {
      width: 100%;
    }

    .text-primary {
      color: var(--color-primary);
    }

    .text-secondary {
      color: var(--color-secondary);
    }

    .text-accent {
      color: var(--color-accent);
    }

    .text-muted {
      color: var(--color-foreground-muted);
    }

    .text-sm {
      font-size: 0.875rem;
    }

    /* 14px */
    .text-lg {
      font-size: 1.125rem;
    }

    /* 18px */
    .font-light {
      font-weight: 300;
    }

    .font-normal {
      font-weight: 400;
    }

    .font-medium {
      font-weight: 500;
    }

    .font-semibold {
      font-weight: 600;
    }

    .font-bold {
      font-weight: 700;
    }

    .rounded-sm {
      border-radius: var(--radius-sm);
    }

    .rounded-md {
      border-radius: var(--radius-md);
    }

    .rounded-lg {
      border-radius: var(--radius-lg);
    }

    .rounded-full {
      border-radius: var(--radius-full);
    }

    .shadow-sm {
      box-shadow: var(--shadow-sm);
    }

    .shadow-md {
      box-shadow: var(--shadow-md);
    }

    .shadow-lg {
      box-shadow: var(--shadow-lg);
    }

    .transition {
      transition: var(--transition-base);
    }

    .hidden {
      display: none !important;
    }

    .sr-only {
      /* Screen reader only */
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }

    .fade-in {
      opacity: 0;
      transform: translateY(15px);
      animation: fadeInAnimation 0.5s ease-out forwards;
    }

    @keyframes fadeInAnimation {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .text-center {
      text-align: center;
    }

    /* GRID SYSTEM */
    .grid {
      display: grid;
      gap: var(--space-lg);
    }

    .grid-cols-1 {
      grid-template-columns: repeat(1, 1fr);
    }

    .grid-cols-2 {
      grid-template-columns: repeat(2, 1fr);
    }

    .grid-cols-3 {
      grid-template-columns: repeat(3, 1fr);
    }

    .grid-cols-4 {
      grid-template-columns: repeat(4, 1fr);
    }

    .grid-cols-autofit-250 {
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    }

    .grid-cols-autofit-300 {
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }

    /* KOMPONEN: TOMBOL (BUTTON) */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-xs);
      padding: var(--space-sm) var(--space-lg);
      font-weight: 500;
      text-align: center;
      vertical-align: middle;
      cursor: pointer;
      border: 1px solid transparent;
      border-radius: var(--radius-md);
      transition: var(--transition-base);
      user-select: none;
      /* Mencegah teks terseleksi saat klik cepat */
    }

    .btn .material-icons {
      font-size: 1.25em;
      /* Relatif terhadap font size tombol */
    }

    .btn-primary {
      background-color: var(--color-primary);
      color: var(--color-surface);
      border-color: var(--color-primary);
    }

    .btn-primary:hover {
      background-color: var(--color-primary-dark);
      border-color: var(--color-primary-dark);
      transform: translateY(-2px);
      box-shadow: var(--shadow-sm);
    }

    .btn-primary:focus {
      outline: 2px solid var(--color-primary-light);
      outline-offset: 2px;
    }

    .btn-secondary {
      background-color: var(--color-secondary);
      color: var(--color-surface);
      border-color: var(--color-secondary);
    }

    .btn-secondary:hover {
      background-color: hsl(170, 70%, 35%);
      border-color: hsl(170, 70%, 35%);
      transform: translateY(-2px);
      box-shadow: var(--shadow-sm);
    }

    .btn-outline {
      background-color: transparent;
      border-color: var(--color-border);
      color: var(--color-foreground);
    }

    .btn-outline:hover {
      border-color: var(--color-primary);
      color: var(--color-primary);
      background-color: var(--color-primary-light);
    }

    .btn-link {
      background-color: transparent;
      border-color: transparent;
      color: var(--color-primary);
      padding-left: var(--space-xs);
      padding-right: var(--space-xs);
    }

    .btn-link:hover {
      color: var(--color-primary-dark);
      text-decoration: underline;
    }

    .btn-sm {
      padding: var(--space-xs) var(--space-sm);
      font-size: var(--text-sm);
    }

    .btn-lg {
      padding: var(--space-md) var(--space-xl);
      font-size: var(--text-lg);
    }

    .btn-full {
      width: 100%;
    }

    /* KOMPONEN: FORMULIR (FORM) */
    .form-group {
      margin-bottom: var(--space-lg);
    }

    .form-group label {
      display: block;
      font-weight: 500;
      margin-bottom: var(--space-xs);
      color: var(--color-foreground);
    }

    .form-group input[type="text"],
    .form-group input[type="email"],
    .form-group input[type="password"],
    .form-group input[type="date"],
    .form-group input[type="number"],
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: var(--space-sm) var(--space-md);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      background-color: var(--color-surface);
      transition: var(--transition-fast);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 0 2px var(--color-primary-light);
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }

    .form-group input[type="checkbox"],
    .form-group input[type="radio"] {
      margin-right: var(--space-xs);
      accent-color: var(--color-primary);
      /* Modern checkbox color */
    }

    .form-group .checkbox-label,
    .form-group .radio-label {
      display: flex;
      align-items: center;
      cursor: pointer;
    }

    /* KOMPONEN: KARTU (CARD) */
    .card {
      background-color: var(--color-surface);
      border-radius: var(--radius-lg);
      /* Lebih bulat */
      box-shadow: var(--shadow-md);
      overflow: hidden;
      transition: var(--transition-base);
      display: flex;
      flex-direction: column;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
    }

    .card-img {
      width: 100%;
      height: 220px;
      /* Lebih tinggi */
      object-fit: cover;
    }

    .card-body {
      padding: var(--space-lg);
      flex-grow: 1;
      /* Agar body mengisi sisa ruang */
      display: flex;
      flex-direction: column;
    }

    .card-title {
      font-size: 1.25rem;
      /* 20px */
      margin-bottom: var(--space-sm);
      color: var(--color-foreground);
      display: flex;
      align-items: center;
      gap: var(--space-xs);
    }

    .card-title .material-icons {
      color: var(--color-success);
      font-size: 1.1em;
    }

    .card-subtitle {
      font-size: 0.9rem;
      color: var(--color-foreground-muted);
      margin-bottom: var(--space-md);
    }

    .card-text {
      margin-bottom: var(--space-md);
      flex-grow: 1;
      /* Agar teks mengisi sebelum tombol */
    }

    .card-details {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-sm);
      font-size: var(--text-sm);
    }

    .card-price {
      color: var(--color-primary);
      font-weight: 600;
      font-size: 1.1rem;
    }

    .card-location {
      display: flex;
      align-items: center;
      gap: var(--space-xxs);
      color: var(--color-foreground-muted);
    }

    .card-location .material-icons {
      font-size: 1.1em;
    }

    .card-features {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-sm);
      color: var(--color-foreground-muted);
      font-size: var(--text-sm);
      margin-bottom: var(--space-md);
    }

    .card-features span {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xxs);
    }

    .card-features .material-icons {
      font-size: 1.1em;
    }

    .card-actions {
      margin-top: auto;
      /* Mendorong tombol ke bawah */
    }

    details.card-details-extra {
      padding: var(--space-md);
      border-top: 1px solid var(--color-border);
      margin-top: var(--space-md);
    }

    details.card-details-extra summary {
      cursor: pointer;
      color: var(--color-primary);
      font-weight: 500;
      list-style: none;
      /* Hapus marker default */
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    details.card-details-extra summary::-webkit-details-marker {
      display: none;
    }

    /* Chrome/Safari */
    details.card-details-extra summary::after {
      content: 'expand_more';
      font-family: 'Material Icons';
      font-weight: normal;
      font-style: normal;
      font-size: 24px;
      line-height: 1;
      letter-spacing: normal;
      text-transform: none;
      display: inline-block;
      white-space: nowrap;
      word-wrap: normal;
      direction: ltr;
      -webkit-font-feature-settings: 'liga';
      -webkit-font-smoothing: antialiased;
      transition: transform 0.2s ease-in-out;
    }

    details.card-details-extra[open] summary::after {
      transform: rotate(180deg);
    }

    details.card-details-extra p {
      margin-top: var(--space-sm);
    }

    /* KOMPONEN: KUTIPAN (QUOTE) */
    .quote {
      display: block;
      font-style: italic;
      margin: var(--space-md) 0;
      padding: var(--space-sm) var(--space-md);
      border-left: 4px solid var(--color-secondary);
      background-color: hsl(170, 70%, 95%);
      border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
      color: var(--color-foreground-muted);
    }

    .quote p {
      margin-bottom: 0;
    }

    /* Override default p margin */

    /* HEADER & NAVIGASI */
    .app-header {
      background-color: var(--color-surface);
      padding-top: var(--space-md);
      padding-bottom: var(--space-md);
      position: sticky;
      top: 0;
      z-index: var(--z-index-sticky);
      box-shadow: var(--shadow-sm);
      border-bottom: 1px solid var(--color-border);
    }

    .navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .nav-brand {
      font-size: 1.75rem;
      /* 28px */
      font-weight: 700;
      color: var(--color-primary);
      letter-spacing: -0.5px;
    }

    .nav-links {
      display: flex;
      gap: var(--space-lg);
      list-style: none;
    }

    .nav-link {
      font-weight: 500;
      color: var(--color-foreground);
      cursor: pointer;
      position: relative;
      padding-bottom: var(--space-xs);
      transition: var(--transition-fast);
    }

    .nav-link:hover,
    .nav-link.active {
      color: var(--color-primary);
    }

    .nav-link::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background-color: var(--color-primary);
      transition: width 0.3s ease;
    }

    .nav-link:hover::after,
    .nav-link.active::after {
      width: 100%;
    }

    .nav-toggle {
      display: none;
      /* Sembunyikan di desktop */
      background: none;
      border: none;
      color: var(--color-foreground);
      font-size: 1.8rem;
      /* Ukuran ikon menu */
    }

    /* KONTEN UTAMA (MAIN CONTENT) */
    .main-content {
      padding-top: var(--space-xl);
      padding-bottom: var(--space-xl);
    }

    .page {
      display: block;
      /* Defaultnya block, akan di-toggle ke none */
      animation: fadeInAnimation 0.5s ease-out forwards;
    }

    .page.hidden {
      display: none;
    }

    /* HALAMAN PENCARIAN */
    .search-filters {
      background-color: var(--color-surface);
      padding: var(--space-lg);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      position: sticky;
      /* Filter tetap terlihat saat scroll */
      top: calc(var(--space-md) * 2 + 60px);
      /* Sesuaikan dengan tinggi header */
      align-self: flex-start;
      /* Agar tidak stretch */
    }

    .map-canvas {
      width: 100%;
      height: 200px;
      background-color: hsl(200, 20%, 95%);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-md);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-foreground-muted);
      font-style: italic;
    }

    .radius-display,
    .price-display {
      display: inline-block;
      min-width: 50px;
      /* Agar tidak loncat-loncat saat nilai berubah */
      font-weight: 500;
    }

    /* KALENDER */
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: var(--space-xs);
      border: 1px solid var(--color-border);
      padding: var(--space-sm);
      border-radius: var(--radius-md);
    }

    .calendar-header {
      text-align: center;
      font-weight: 500;
      padding: var(--space-xs) 0;
      color: var(--color-foreground-muted);
    }

    .calendar-day {
      padding: var(--space-sm);
      text-align: center;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: var(--transition-fast);
      border: 1px solid transparent;
    }

    .calendar-day:hover:not(.empty):not(.booked) {
      background-color: var(--color-primary-light);
      border-color: var(--color-primary);
    }

    .calendar-day.empty {
      cursor: default;
      visibility: hidden;
      /* Sembunyikan hari kosong */
    }

    .calendar-day.available {
      /* Default state */
    }

    .calendar-day.booked {
      background-color: hsl(0, 0%, 90%);
      color: var(--color-foreground-muted);
      cursor: not-allowed;
      text-decoration: line-through;
    }

    .calendar-day.selected {
      background-color: var(--color-primary);
      color: var(--color-surface);
      border-color: var(--color-primary-dark);
    }

    .calendar-day.today {
      font-weight: bold;
      border: 1px dashed var(--color-secondary);
    }

    .calendar-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-md);
    }

    .calendar-nav button {
      background: none;
      border: none;
      padding: var(--space-xs);
    }

    .calendar-nav .material-icons {
      font-size: 1.5rem;
    }

    /* HALAMAN DETAIL APARTEMEN */
    .apartment-gallery {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr;
      /* Kolom utama besar, dua lainnya kecil */
      grid-template-rows: auto auto;
      gap: var(--space-sm);
      margin-bottom: var(--space-xl);
      max-height: 500px;
      /* Batasi tinggi galeri */
    }

    .gallery-item {
      overflow: hidden;
      border-radius: var(--radius-md);
      cursor: pointer;
    }

    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .gallery-item img:hover {
      transform: scale(1.05);
    }

    .gallery-item:first-child {
      grid-row: 1 / span 2;
      /* Gambar pertama mengisi 2 baris */
      grid-column: 1 / span 1;
      /* Gambar pertama mengisi 1 kolom */
    }

    /* Untuk 3 gambar atau kurang, agar tidak aneh */
    .apartment-gallery.single-image .gallery-item:first-child {
      grid-column: 1 / -1;
      grid-row: 1 / -1;
    }

    .apartment-gallery.two-images .gallery-item:nth-child(1) {
      grid-column: 1 / span 1;
      grid-row: 1 / -1;
    }

    .apartment-gallery.two-images .gallery-item:nth-child(2) {
      grid-column: 2 / -1;
      grid-row: 1 / -1;
    }

    .virtual-tour-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: var(--transition-base);
    }

    .gallery-item:first-child:hover .virtual-tour-overlay {
      opacity: 1;
    }

    .virtual-tour-overlay .material-icons {
      font-size: 3rem;
      margin-bottom: var(--space-xs);
    }

    .apartment-details-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      /* Konten utama lebih lebar dari sidebar booking */
      gap: var(--space-xl);
    }

    .booking-form-sticky {
      position: sticky;
      top: calc(var(--space-md) * 2 + 60px);
      /* Sesuaikan dengan tinggi header */
      align-self: flex-start;
      background-color: var(--color-surface);
      padding: var(--space-lg);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
    }

    .payment-methods {
      display: flex;
      gap: var(--space-sm);
      margin-bottom: var(--space-md);
    }

    .payment-method {
      padding: var(--space-sm) var(--space-md);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: var(--transition-fast);
      flex-grow: 1;
      text-align: center;
    }

    .payment-method:hover {
      border-color: var(--color-primary);
      background-color: var(--color-primary-light);
    }

    .payment-method.selected {
      border-color: var(--color-primary);
      background-color: var(--color-primary);
      color: var(--color-surface);
      font-weight: 500;
    }

    .cost-breakdown {
      background-color: var(--color-primary-light);
      padding: var(--space-md);
      border-radius: var(--radius-md);
      margin-top: var(--space-lg);
      border: 1px solid var(--color-primary);
    }

    .cost-line {
      display: flex;
      justify-content: space-between;
      margin-bottom: var(--space-xs);
      font-size: var(--text-sm);
    }

    .cost-line.total {
      font-weight: bold;
      font-size: 1rem;
      /* Default font size */
      margin-top: var(--space-sm);
      padding-top: var(--space-sm);
      border-top: 1px dashed var(--color-primary);
    }

    .escrow-info {
      background-color: var(--color-warning-light, hsl(40, 80%, 95%));
      /* Fallback jika variabel tidak ada */
      padding: var(--space-md);
      border-left: 4px solid var(--color-warning);
      margin: var(--space-lg) 0;
      border-radius: var(--radius-md);
      font-size: var(--text-sm);
    }

    .escrow-info p {
      margin-bottom: 0;
    }

    .review-item {
      border-bottom: 1px solid var(--color-border);
      padding-bottom: var(--space-md);
      margin-bottom: var(--space-md);
    }

    .review-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }

    .review-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-xs);
    }

    .review-user {
      font-weight: 500;
    }

    .review-rating .material-icons {
      color: var(--color-accent);
      font-size: 1.1em;
    }

    .review-comment {
      color: var(--color-foreground-muted);
    }

    .report-form-container {
      background-color: hsl(0, 70%, 97%);
      padding: var(--space-md);
      border-radius: var(--radius-md);
      margin-top: var(--space-lg);
      border: 1px solid var(--color-error);
    }

    /* HALAMAN PROFIL */
    .chat-window {
      height: 200px;
      overflow-y: auto;
      border: 1px solid var(--color-border);
      padding: var(--space-md);
      border-radius: var(--radius-md);
      background-color: hsl(0, 0%, 96%);
      margin-bottom: var(--space-sm);
    }

    .chat-message {
      margin-bottom: var(--space-sm);
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-md);
      max-width: 75%;
      word-wrap: break-word;
    }

    .chat-message.sent {
      background-color: var(--color-primary);
      color: var(--color-surface);
      margin-left: auto;
      /* Dorong ke kanan */
      border-bottom-right-radius: var(--radius-xs);
    }

    .chat-message.received {
      background-color: var(--color-surface);
      border: 1px solid var(--color-border);
      margin-right: auto;
      /* Dorong ke kiri */
      border-bottom-left-radius: var(--radius-xs);
    }

    .chat-message.system {
      background-color: var(--color-secondary-light, hsl(170, 70%, 95%));
      color: var(--color-secondary-dark, hsl(170, 70%, 35%));
      font-size: var(--text-sm);
      text-align: center;
      max-width: 100%;
      padding: var(--space-xs);
    }

    .chat-input-group {
      display: flex;
      gap: var(--space-sm);
    }

    .chat-input-group input {
      flex-grow: 1;
    }

    .loyalty-badge {
      background-color: var(--color-accent);
      color: var(--color-surface);
      padding: var(--space-xxs) var(--space-xs);
      border-radius: var(--radius-sm);
      font-size: 0.8rem;
      font-weight: 500;
    }

    .notification-item {
      background-color: var(--color-primary-light);
      padding: var(--space-md);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-sm);
      border-left: 4px solid var(--color-primary);
    }

    /* CHATBOX GLOBAL */
    .global-chat-btn {
      position: fixed;
      bottom: var(--space-lg);
      right: var(--space-lg);
      z-index: var(--z-index-chatbox);
      border-radius: var(--radius-full);
      width: 60px;
      height: 60px;
      padding: 0;
      /* Hapus padding default tombol */
      box-shadow: var(--shadow-lg);
    }

    .global-chat-btn .material-icons {
      font-size: 2rem;
    }

    .chatbox-widget {
      position: fixed;
      bottom: calc(var(--space-lg) + 70px);
      /* Di atas tombol chat */
      right: var(--space-lg);
      width: 320px;
      background-color: var(--color-surface);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-xl);
      display: flex;
      flex-direction: column;
      height: 450px;
      /* Tinggi chatbox */
      z-index: var(--z-index-chatbox);
      overflow: hidden;
      /* Mencegah konten keluar dari border radius */
      transform: translateY(20px) scale(0.95);
      opacity: 0;
      visibility: hidden;
      transition: transform 0.3s ease, opacity 0.3s ease, visibility 0s 0.3s;
    }

    .chatbox-widget.open {
      transform: translateY(0) scale(1);
      opacity: 1;
      visibility: visible;
      transition: transform 0.3s ease, opacity 0.3s ease, visibility 0s 0s;
    }

    .chatbox-header {
      background-color: var(--color-primary);
      color: var(--color-surface);
      padding: var(--space-md);
      font-weight: 500;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chatbox-header .close-chat-btn {
      background: none;
      border: none;
      color: var(--color-surface);
      opacity: 0.8;
    }

    .chatbox-header .close-chat-btn:hover {
      opacity: 1;
    }

    .chatbox-body {
      flex-grow: 1;
      overflow-y: auto;
      padding: var(--space-md);
      background-color: hsl(0, 0%, 96%);
    }

    .chatbox-input-area {
      display: flex;
      padding: var(--space-sm);
      border-top: 1px solid var(--color-border);
      background-color: var(--color-surface);
    }

    .chatbox-input-area input {
      flex-grow: 1;
      border-right: none;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }

    .chatbox-input-area button {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      padding-left: var(--space-md);
      padding-right: var(--space-md);
    }

    .chatbox-input-area button .material-icons {
      font-size: 1.5rem;
    }

    /* FOOTER */
    .app-footer {
      background-color: var(--color-foreground);
      color: hsl(0, 0%, 85%);
      padding: var(--space-xl) 0;
      text-align: center;
      font-size: var(--text-sm);
    }

    .app-footer p {
      margin-bottom: var(--space-xs);
    }

    .app-footer a {
      color: var(--color-surface);
      text-decoration: underline;
    }

    .app-footer a:hover {
      color: var(--color-primary-light);
    }

    /* MODAL (Untuk galeri atau notifikasi kustom) */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.6);
      z-index: var(--z-index-modal-backdrop);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0s 0.3s;
    }

    .modal-backdrop.open {
      opacity: 1;
      visibility: visible;
      transition-delay: 0s;
    }

    .modal-content {
      background-color: var(--color-surface);
      padding: var(--space-xl);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-xl);
      max-width: 90vw;
      max-height: 90vh;
      overflow-y: auto;
      transform: scale(0.95) translateY(20px);
      transition: transform 0.3s ease;
    }

    .modal-backdrop.open .modal-content {
      transform: scale(1) translateY(0);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-lg);
      padding-bottom: var(--space-md);
      border-bottom: 1px solid var(--color-border);
    }

    .modal-title {
      margin-bottom: 0;
    }

    .modal-close-btn {
      background: none;
      border: none;
      font-size: 1.8rem;
      color: var(--color-foreground-muted);
      padding: 0;
    }

    .modal-close-btn:hover {
      color: var(--color-foreground);
    }

    .modal-body img {
      max-width: 100%;
      max-height: 70vh;
      /* Batasi tinggi gambar dalam modal */
      object-fit: contain;
      /* Agar gambar tidak terpotong */
      border-radius: var(--radius-md);
    }


    /* RESPONSIVE DESIGN */
    @media (max-width: 1024px) {
      .apartment-details-grid {
        grid-template-columns: 1fr;
        /* Tumpuk di tablet */
      }

      .search-filters,
      .booking-form-sticky {
        position: static;
        /* Hapus sticky di tablet agar tidak mengganggu */
        width: 100%;
        margin-bottom: var(--space-xl);
      }

      .grid-cols-3 {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      }

      /* Lebih fleksibel */
    }

    @media (max-width: 768px) {
      .nav-links {
        display: none;
        /* Sembunyikan link navigasi default */
        flex-direction: column;
        position: absolute;
        top: 100%;
        /* Di bawah header */
        left: 0;
        right: 0;
        background-color: var(--color-surface);
        box-shadow: var(--shadow-md);
        padding: var(--space-md);
        border-top: 1px solid var(--color-border);
      }

      .nav-links.open {
        display: flex;
        /* Tampilkan saat menu dibuka */
      }

      .nav-link {
        padding: var(--space-sm) 0;
        width: 100%;
        text-align: center;
      }

      .nav-link::after {
        display: none;
        /* Hapus underline di mobile nav */
      }

      .nav-link.active {
        background-color: var(--color-primary-light);
        border-radius: var(--radius-sm);
      }

      .nav-toggle {
        display: block;
        /* Tampilkan tombol burger */
      }

      .grid-cols-2,
      .grid-cols-3,
      .grid-cols-4,
      .grid-cols-autofit-250,
      .grid-cols-autofit-300 {
        grid-template-columns: 1fr;
        /* Semua grid menjadi satu kolom */
      }

      .apartment-gallery {
        grid-template-columns: 1fr;
        /* Galeri jadi satu kolom */
        grid-template-rows: auto;
        max-height: none;
      }

      .gallery-item:first-child {
        grid-row: auto;
        grid-column: auto;
      }

      .chatbox-widget {
        width: 90vw;
        max-width: 300px;
        height: 70vh;
        max-height: 400px;
        bottom: calc(var(--space-lg) + 65px);
        right: var(--space-sm);
      }

      .global-chat-btn {
        width: 50px;
        height: 50px;
        bottom: var(--space-md);
        right: var(--space-md);
      }

      .global-chat-btn .material-icons {
        font-size: 1.5rem;
      }

      h1 {
        font-size: 1.875rem;
      }

      h2 {
        font-size: 1.5rem;
      }
    }

    /* AKSESIBILITAS */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }

    [tabindex="0"]:focus,
    button:focus,
    input:focus,
    select:focus,
    textarea:focus,
    a:focus {
      outline: 3px solid var(--color-accent);
      /* Outline yang lebih jelas */
      outline-offset: 2px;
      box-shadow: 0 0 0 3px var(--color-accent);
      /* Fallback untuk browser tanpa outline-offset */
    }

    /* Pastikan outline tidak terpotong oleh overflow:hidden pada parent */
    *:focus-visible {
      outline: 3px solid var(--color-accent);
      outline-offset: 2px;
    }
  </style>
</head>

<body>

  <!-- Header Aplikasi -->
  <header class="app-header">
    <div class="container">
      <nav class="navbar">
        <a href="#home" class="nav-brand">Rentelindo</a>
        <button class="nav-toggle" id="navToggleBtn" aria-label="Toggle navigasi" aria-expanded="false">
          <span class="material-icons">menu</span>
        </button>
        <ul class="nav-links" id="navLinksMenu">
          <li><a href="#home" class="nav-link active" data-page="home">Beranda</a></li>
          <li><a href="#search" class="nav-link" data-page="search">Pencarian</a></li>
          <li><a href="#profile" class="nav-link" data-page="profile">Profil</a></li>
          <li><a href="#support" class="nav-link" data-page="support">Dukungan</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Konten Utama Aplikasi -->
  <main class="main-content container">
    <!-- Halaman Beranda -->
    <section id="home" class="page">
      <h1 class="text-center font-bold mb-md">Temukan Apartemen Impian Anda di Rentelindo</h1>
      <p class="text-center text-lg text-muted mb-xl">Sewa apartemen modern dengan fasilitas premium, aman, dan
        terpercaya.</p>

      <!-- Pencarian Cepat -->
      <form class="search-form-quick card p-lg shadow-lg mb-xl" id="quickSearchForm">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-md items-end">
          <div class="form-group">
            <label for="quick-location">Lokasi Impian</label>
            <input type="text" id="quick-location" placeholder="Masukkan kota atau nama area" aria-label="Cari lokasi">
          </div>
          <div class="form-group">
            <label for="quick-checkin">Tanggal Check-in</label>
            <input type="date" id="quick-checkin" aria-label="Tanggal check-in">
          </div>
          <div class="form-group">
            <label for="quick-checkout">Tanggal Check-out</label>
            <input type="date" id="quick-checkout" aria-label="Tanggal check-out">
          </div>
        </div>
        <button type="submit" class="btn btn-primary btn-lg btn-full mt-lg">
          <span class="material-icons">search</span>Cari Apartemen
        </button>
      </form>

      <!-- Properti Unggulan -->
      <h2 class="font-semibold mt-xl mb-lg">Properti Unggulan Pilihan Kami</h2>
      <div class="grid grid-cols-autofit-300 gap-lg mb-xl" id="featuredProperties">
        <!-- Kartu properti akan dimuat oleh JavaScript -->
      </div>

      <!-- Testimoni -->
      <h2 class="font-semibold mt-xl mb-lg">Apa Kata Mereka Tentang Rentelindo?</h2>
      <div class="grid grid-cols-autofit-300 gap-lg">
        <div class="card p-lg">
          <quote>
            <p>"Proses pemesanan di Rentelindo sangat mudah dan cepat. Apartemennya juga sesuai dengan deskripsi. Sangat
              direkomendasikan!"</p>
          </quote>
          <p class="font-medium mt-md">- Anisa Wulandari</p>
          <p class="text-sm text-muted">Penyewa Terverifikasi</p>
        </div>
        <div class="card p-lg">
          <quote>
            <p>"Saya menemukan apartemen studio yang sempurna untuk perjalanan bisnis saya. Fasilitas lengkap dan lokasi
              strategis. Terima kasih Rentelindo!"</p>
          </quote>
          <p class="font-medium mt-md">- Budi Santoso</p>
          <p class="text-sm text-muted">Profesional Muda</p>
        </div>
        <div class="card p-lg">
          <quote>
            <p>"Pelayanan pelanggan sangat responsif. Mereka membantu saya menyelesaikan masalah kecil dengan cepat.
              Pengalaman yang menyenangkan!"</p>
          </quote>
          <p class="font-medium mt-md">- Citra Dewi</p>
          <p class="text-sm text-muted">Keluarga Bahagia</p>
        </div>
      </div>
    </section>

    <!-- Halaman Pencarian -->
    <section id="search" class="page hidden">
      <h1 class="font-bold mb-lg">Cari Apartemen Sesuai Keinginan Anda</h1>
      <div class="grid md:grid-cols-1 lg:grid-cols-12 gap-xl">
        <!-- Kolom Filter -->
        <aside class="lg:col-span-4">
          <form class="search-filters" id="detailedSearchForm">
            <h3 class="font-semibold mb-md">Filter Pencarian</h3>
            <div class="form-group">
              <label for="search-location">Lokasi</label>
              <input type="text" id="search-location" placeholder="cth: Jakarta Selatan">
              <div class="map-canvas mt-sm" id="searchMapCanvas" aria-label="Peta interaktif (simulasi)">Simulasi Peta
                Lokasi</div>
            </div>
            <div class="form-group">
              <label for="search-radius">Radius Pencarian</label>
              <input type="range" min="1" max="20" value="5" id="search-radius" class="w-full"
                aria-label="Filter radius">
              <p class="text-sm text-muted">Jarak: <span id="radiusValueDisplay" class="radius-display">5</span> km</p>
            </div>
            <div class="form-group">
              <label>Tanggal Ketersediaan</label>
              <div class="calendar-nav">
                <button type="button" id="prevMonthBtnCalendarSearch" aria-label="Bulan sebelumnya"><span
                    class="material-icons">chevron_left</span></button>
                <span id="currentMonthYearCalendarSearch" class="font-medium"></span>
                <button type="button" id="nextMonthBtnCalendarSearch" aria-label="Bulan berikutnya"><span
                    class="material-icons">chevron_right</span></button>
              </div>
              <div class="calendar" id="searchPageCalendar" role="grid" aria-label="Kalender ketersediaan">
                <!-- Hari kalender akan dimuat oleh JavaScript -->
              </div>
              <div class="flex gap-sm mt-sm">
                <input type="date" id="search-checkin-date" class="w-1/2" aria-label="Tanggal check-in terpilih">
                <input type="date" id="search-checkout-date" class="w-1/2" aria-label="Tanggal check-out terpilih">
              </div>
            </div>
            <div class="form-group">
              <label for="search-price">Rentang Harga (per bulan)</label>
              <input type="range" min="500" max="10000" value="5000" step="100" id="search-price" class="w-full"
                aria-label="Filter harga">
              <p class="text-sm text-muted">Maks: Rp <span id="priceValueDisplay" class="price-display">5,000</span>.000
              </p>
            </div>
            <div class="form-group">
              <label>Fasilitas Utama</label>
              <div class="grid grid-cols-2 gap-sm">
                <label class="checkbox-label text-sm"><input type="checkbox" name="amenities" value="pool"> Kolam
                  Renang</label>
                <label class="checkbox-label text-sm"><input type="checkbox" name="amenities" value="gym"> Gym</label>
                <label class="checkbox-label text-sm"><input type="checkbox" name="amenities" value="wifi"> WiFi
                  Cepat</label>
                <label class="checkbox-label text-sm"><input type="checkbox" name="amenities" value="parking"> Parkir
                  Gratis</label>
                <label class="checkbox-label text-sm"><input type="checkbox" name="amenities" value="ac"> AC</label>
                <label class="checkbox-label text-sm"><input type="checkbox" name="amenities" value="laundry">
                  Laundry</label>
                <label class="checkbox-label text-sm"><input type="checkbox" name="amenities" value="kitchen"> Dapur
                  Lengkap</label>
                <label class="checkbox-label text-sm"><input type="checkbox" name="amenities" value="pet-friendly">
                  Ramah Hewan</label>
              </div>
            </div>
            <div class="form-group">
              <label for="search-apartment-type">Tipe Apartemen</label>
              <select id="search-apartment-type">
                <option value="">Semua Tipe</option>
                <option value="studio">Studio</option>
                <option value="1br">1 Kamar Tidur</option>
                <option value="2br">2 Kamar Tidur</option>
                <option value="3br+">3+ Kamar Tidur</option>
                <option value="penthouse">Penthouse</option>
                <option value="loft">Loft</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary btn-full mt-md">
              <span class="material-icons">filter_alt</span>Terapkan Filter
            </button>
            <button type="reset" class="btn btn-outline btn-full mt-sm" id="resetSearchFiltersBtn">
              <span class="material-icons">refresh</span>Reset Filter
            </button>
          </form>
        </aside>
        <!-- Kolom Hasil Pencarian -->
        <div class="lg:col-span-8">
          <h2 class="font-semibold mb-md">Hasil Pencarian (<span id="searchResultsCount">0</span> apartemen ditemukan)
          </h2>
          <div class="grid grid-cols-autofit-250 gap-lg" id="searchResultsContainer">
            <!-- Hasil pencarian akan dimuat oleh JavaScript -->
            <p id="noResultsMessage" class="text-muted text-center col-span-full hidden">Maaf, tidak ada apartemen yang
              sesuai dengan kriteria Anda.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Halaman Detail Apartemen -->
    <section id="apartment" class="page hidden">
      <div id="apartmentDetailContent">
        <!-- Konten detail akan dimuat oleh JavaScript -->
        <p class="text-center text-lg text-muted">Memuat detail apartemen...</p>
      </div>
    </section>

    <!-- Halaman Profil Pengguna -->
    <section id="profile" class="page hidden">
      <h1 class="font-bold mb-lg">Profil Pengguna Rentelindo</h1>
      <div class="grid md:grid-cols-1 lg:grid-cols-3 gap-xl">
        <!-- Kolom Info Akun & Pesan -->
        <div class="lg:col-span-2">
          <div class="card p-lg mb-xl">
            <h2 class="font-semibold mb-md">Informasi Akun</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-md">
              <div>
                <p><strong>Nama:</strong> <span id="profileName">Ani Wulandari</span></p>
                <p><strong>Email:</strong> <span id="profileEmail">ani.wulandari@example.com</span></p>
                <p><strong>Telepon:</strong> <span id="profilePhone">+62 812 3456 7890</span></p>
              </div>
              <div>
                <p><strong>Poin Loyalitas:</strong> <span id="profileLoyaltyPoints" class="loyalty-badge">1250</span>
                </p>
                <p><strong>Member Sejak:</strong> <span id="profileMemberSince">15 Januari 2023</span></p>
              </div>
            </div>
            <button class="btn btn-outline mt-lg btn-sm">
              <span class="material-icons">edit</span>Edit Profil
            </button>
          </div>

          <div class="card p-lg mb-xl">
            <h2 class="font-semibold mb-md">Pesan dengan Pemilik/Admin</h2>
            <div class="chat-window" id="profileChatWindow">
              <div class="chat-message received">Halo! Ada yang bisa saya bantu terkait properti di Sudirman?</div>
              <div class="chat-message sent">Halo, saya ingin bertanya tentang ketersediaan parkir mobil. Apakah sudah
                termasuk dalam biaya sewa?</div>
              <div class="chat-message system">Admin telah membaca pesan Anda.</div>
            </div>
            <form id="profileChatForm" class="chat-input-group">
              <input type="text" id="profileChatInput" placeholder="Ketik pesan Anda di sini..."
                aria-label="Input pesan chat">
              <button type="submit" class="btn btn-primary">
                <span class="material-icons">send</span>Kirim
              </button>
            </form>
          </div>
        </div>

        <!-- Kolom Riwayat & Notifikasi -->
        <div class="lg:col-span-1">
          <div class="card p-lg mb-xl">
            <h2 class="font-semibold mb-md">Riwayat Pemesanan</h2>
            <div id="bookingHistoryContainer">
              <!-- Riwayat akan dimuat JavaScript -->
              <p class="text-sm text-muted">Tidak ada riwayat pemesanan.</p>
            </div>
            <button class="btn btn-link btn-sm mt-md" id="loadMoreBookingsBtn">Lihat Semua Riwayat</button>
          </div>

          <div class="card p-lg">
            <h2 class="font-semibold mb-md">Notifikasi Terbaru</h2>
            <div id="notificationsContainer">
              <div class="notification-item">
                <p class="font-medium">Pembayaran Berhasil!</p>
                <p class="text-sm">Pembayaran untuk "Apartemen Senayan View" telah dikonfirmasi.</p>
                <p class="text-xs text-muted mt-xs">2 jam lalu</p>
              </div>
              <div class="notification-item">
                <p class="font-medium">Pengingat Check-in</p>
                <p class="text-sm">Check-in Anda untuk "Studio Harmoni Pusat Kota" adalah besok.</p>
                <p class="text-xs text-muted mt-xs">1 hari lalu</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Halaman Dukungan Pelanggan -->
    <section id="support" class="page hidden">
      <h1 class="font-bold mb-lg text-center">Pusat Bantuan Rentelindo</h1>
      <p class="text-lg text-muted mb-xl text-center">Kami siap membantu Anda 24/7. Pilih metode dukungan yang paling
        nyaman.</p>
      <div class="grid grid-cols-autofit-300 gap-lg">
        <div class="card p-lg text-center">
          <span class="material-icons text-primary mb-md" style="font-size: 3rem;">chat</span>
          <h3 class="font-semibold">Live Chat</h3>
          <p class="text-muted">Dapatkan bantuan instan dari tim dukungan kami.</p>
          <button class="btn btn-primary mt-md" onclick="app.ui.openGlobalChat()">
            <span class="material-icons">question_answer</span>Mulai Chat Sekarang
          </button>
        </div>
        <div class="card p-lg text-center">
          <span class="material-icons text-primary mb-md" style="font-size: 3rem;">email</span>
          <h3 class="font-semibold">Kirim Email</h3>
          <p class="text-muted">Hubungi kami melalui email untuk pertanyaan lebih detail.</p>
          <a href="mailto:dukungan@rentelindo.com" class="btn btn-primary mt-md">
            <span class="material-icons">send</span>dukungan@rentelindo.com
          </a>
        </div>
        <div class="card p-lg text-center">
          <span class="material-icons text-primary mb-md" style="font-size: 3rem;">phone</span>
          <h3 class="font-semibold">Hubungi Kami</h3>
          <p class="text-muted">Bicaralah langsung dengan agen kami untuk solusi cepat.</p>
          <a href="tel:+6280012345678" class="btn btn-primary mt-md">
            <span class="material-icons">call</span>+62 800 1234 5678
          </a>
        </div>
      </div>

      <div class="mt-xl card p-lg">
        <h2 class="font-semibold mb-lg text-center">Pertanyaan Umum (FAQ)</h2>
        <details class="card-details-extra mb-sm">
          <summary>Bagaimana cara melakukan pemesanan?</summary>
          <p>Cari apartemen yang Anda inginkan, pilih tanggal, lalu klik tombol "Pesan Sekarang". Ikuti langkah-langkah
            pembayaran hingga selesai.</p>
        </details>
        <details class="card-details-extra mb-sm">
          <summary>Apakah pembayaran aman?</summary>
          <p>Ya, semua transaksi pembayaran di Rentelindo dijamin aman menggunakan enkripsi terkini dan sistem escrow
            untuk melindungi dana Anda.</p>
        </details>
        <details class="card-details-extra">
          <summary>Bagaimana jika saya ingin membatalkan pesanan?</summary>
          <p>Kebijakan pembatalan berbeda untuk setiap properti. Silakan cek detail kebijakan pembatalan pada halaman
            apartemen sebelum memesan atau hubungi tim dukungan kami.</p>
        </details>
      </div>
    </section>
  </main>

  <!-- Tombol Chat Global Mengambang -->
  <button class="btn btn-primary global-chat-btn" id="globalChatToggleBtn" aria-label="Buka chat dukungan">
    <span class="material-icons">chat</span>
  </button>

  <!-- Widget Chatbox Global -->
  <div class="chatbox-widget" id="globalChatbox">
    <div class="chatbox-header">
      <span>Dukungan Pelanggan Rentelindo</span>
      <button class="close-chat-btn" id="closeChatboxBtn" aria-label="Tutup chat">
        <span class="material-icons">close</span>
      </button>
    </div>
    <div class="chatbox-body" id="globalChatBody">
      <div class="chat-message system">Selamat datang di Rentelindo! Ada yang bisa kami bantu hari ini?</div>
      <!-- Pesan chat akan ditambahkan di sini oleh JavaScript -->
    </div>
    <form class="chatbox-input-area" id="globalChatForm">
      <input type="text" id="globalChatInput" placeholder="Ketik pertanyaan Anda..."
        aria-label="Input pesan chat dukungan">
      <button type="submit" class="btn btn-primary">
        <span class="material-icons">send</span>
      </button>
    </form>
  </div>

  <!-- Modal Universal -->
  <div class="modal-backdrop" id="universalModal" aria-labelledby="modalTitle" role="dialog" aria-modal="true">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle" class="modal-title font-semibold text-lg">Judul Modal</h2>
        <button class="modal-close-btn" aria-label="Tutup modal">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body" id="modalBody">
        <!-- Konten modal akan dimuat oleh JavaScript -->
      </div>
    </div>
  </div>


  <!-- Footer Aplikasi -->
  <footer class="app-footer">
    <div class="container">
      <p>&copy; <span id="currentYear"></span> Rentelindo. Semua hak cipta dilindungi undang-undang.</p>
      <p>
        <a href="#privacy" class="mr-sm">Kebijakan Privasi</a> |
        <a href="#terms" class="ml-sm">Syarat & Ketentuan</a>
      </p>
      <p class="mt-md">Dibuat dengan <span class="material-icons text-accent"
          style="font-size: 1em; vertical-align: middle;">favorite</span> untuk kemudahan Anda.</p>
    </div>
  </footer>

  <script>
    // MAIN APP SCRIPT (RENTELINDO NATIVE SPA)
    // Struktur aplikasi akan mengikuti paradigma modularitas sederhana
    // tanpa menggunakan sistem modul ES6 eksplisit untuk menjaga kesederhanaan monolith.

    const app = {
      // STATE: Menyimpan kondisi aplikasi saat ini
      state: {
        currentPage: 'home',
        apartments: [], // Akan diisi dengan data mock
        selectedApartmentId: null,
        searchFilters: {
          location: '',
          radius: 5,
          checkin: null,
          checkout: null,
          maxPrice: 5000,
          amenities: [],
          type: ''
        },
        bookingHistory: [], // Akan diisi dari localStorage atau mock
        currentCalendarMonth: new Date().getMonth(),
        currentCalendarYear: new Date().getFullYear(),
        globalChatOpen: false,
      },

      // CONFIG: Pengaturan aplikasi
      config: {
        currency: 'Rp',
        priceMultiplier: 1000000, // Untuk menampilkan harga dalam jutaan
        featuredPropertiesCount: 3,
        searchResultsPerPage: 9, // Jika ingin implementasi paginasi
        defaultMapMessage: 'Simulasi Peta Interaktif - Klik untuk interaksi (jika diimplementasikan)',
      },

      // MOCK DATA: Data simulasi untuk aplikasi
      mockData: {
        apartments: [
          {
            id: 1,
            title: 'Penthouse Mewah Sudirman',
            slug: 'penthouse-mewah-sudirman',
            price: 25, // dalam jutaan Rp
            location: 'Jakarta Pusat, Sudirman',
            coordinates: { lat: -6.2088, lng: 106.8456 },
            type: 'penthouse',
            bedrooms: 3,
            bathrooms: 3,
            sqft: 200,
            amenities: ['pool', 'gym', 'wifi', 'parking', 'ac', 'kitchen', 'pet-friendly'],
            images: [
              'https://source.unsplash.com/random/800x600/?luxury,apartment,interior',
              'https://source.unsplash.com/random/600x400/?modern,bedroom',
              'https://source.unsplash.com/random/600x400/?sleek,kitchen',
              'https://source.unsplash.com/random/600x400/?city,view,balcony',
              'https://source.unsplash.com/random/600x400/?luxury,bathroom'
            ],
            description: 'Nikmati kemewahan tinggal di jantung kota Jakarta. Penthouse eksklusif dengan pemandangan kota yang menakjubkan, fasilitas lengkap, dan desain interior modern. Keamanan 24 jam dan akses mudah ke pusat bisnis dan hiburan.',
            host: { name: 'Bapak Propertio', verified: true },
            reviews: [
              { user: 'Rina M.', rating: 5, comment: 'Pemandangan kota dari balkon sangat luar biasa! Fasilitas gym dan kolam renangnya juga top.', date: '2024-07-15' },
              { user: 'David K.', rating: 4, comment: 'Lokasi strategis, interior mewah. Sedikit bising karena di pusat kota, tapi terbayar dengan kenyamanan.', date: '2024-06-20' }
            ],
            bookedDates: ['2024-08-10', '2024-08-11', '2024-08-12', '2024-09-01', '2024-09-02'] // Format YYYY-MM-DD
          },
          {
            id: 2,
            title: 'Studio Modern Kemang Village',
            slug: 'studio-modern-kemang-village',
            price: 12,
            location: 'Jakarta Selatan, Kemang',
            coordinates: { lat: -6.2607, lng: 106.8101 },
            type: 'studio',
            bedrooms: 1, // Studio dihitung 1 kamar
            bathrooms: 1,
            sqft: 50,
            amenities: ['wifi', 'ac', 'kitchen', 'laundry'],
            images: [
              'https://source.unsplash.com/random/800x600/?modern,studio,apartment',
              'https://source.unsplash.com/random/600x400/?compact,living,room',
              'https://source.unsplash.com/random/600x400/?small,kitchenette'
            ],
            description: 'Studio apartemen yang chic dan modern di area Kemang yang trendi. Sempurna untuk profesional muda atau pasangan. Dilengkapi dengan dapur mini dan akses mudah ke kafe, restoran, dan pusat perbelanjaan.',
            host: { name: 'Ibu Gaya Hidup', verified: true },
            reviews: [
              { user: 'Sarah L.', rating: 4, comment: 'Cocok untuk solo traveler atau pasangan. Bersih dan nyaman.', date: '2024-07-01' }
            ],
            bookedDates: ['2024-08-05', '2024-08-06']
          },
          {
            id: 3,
            title: 'Apartemen Keluarga Nyaman BSD',
            slug: 'apartemen-keluarga-nyaman-bsd',
            price: 18,
            location: 'Tangerang Selatan, BSD City',
            coordinates: { lat: -6.3019, lng: 106.6533 },
            type: '2br',
            bedrooms: 2,
            bathrooms: 2,
            sqft: 120,
            amenities: ['pool', 'parking', 'ac', 'kitchen', 'laundry', 'playground'],
            images: [
              'https://source.unsplash.com/random/800x600/?family,apartment,livingroom',
              'https://source.unsplash.com/random/600x400/?kids,bedroom',
              'https://source.unsplash.com/random/600x400/?apartment,pool,area'
            ],
            description: 'Apartemen luas dan nyaman untuk keluarga Anda di BSD City. Dekat dengan sekolah internasional, rumah sakit, dan pusat perbelanjaan. Fasilitas ramah anak tersedia.',
            host: { name: 'Keluarga Harmoni', verified: false },
            reviews: [
              { user: 'Andi F.', rating: 5, comment: 'Sangat puas! Anak-anak suka kolam renang dan playgroundnya.', date: '2024-07-10' }
            ],
            bookedDates: []
          },
          {
            id: 4,
            title: 'Loft Artistik Cikini',
            slug: 'loft-artistik-cikini',
            price: 15,
            location: 'Jakarta Pusat, Cikini',
            coordinates: { lat: -6.1927, lng: 106.8402 },
            type: 'loft',
            bedrooms: 1,
            bathrooms: 1,
            sqft: 90,
            amenities: ['wifi', 'ac', 'kitchen', 'art-studio-space'],
            images: [
              'https://source.unsplash.com/random/800x600/?loft,apartment,artistic',
              'https://source.unsplash.com/random/600x400/?industrial,design,living',
              'https://source.unsplash.com/random/600x400/?workspace,creative'
            ],
            description: 'Loft unik dengan sentuhan artistik di area Cikini yang bersejarah. Ruang terbuka luas dengan langit-langit tinggi, cocok untuk para seniman atau mereka yang mencari inspirasi. Dekat dengan galeri seni dan pusat budaya.',
            host: { name: 'Sang Seniman', verified: true },
            reviews: [
              { user: 'Elisa G.', rating: 5, comment: 'Tempat ini luar biasa inspiratif! Suka sekali dengan desainnya.', date: '2024-06-28' }
            ],
            bookedDates: ['2024-08-20', '2024-08-21', '2024-08-22']
          },
          {
            id: 5,
            title: 'Apartemen Tepi Pantai Ancol',
            slug: 'apartemen-tepi-pantai-ancol',
            price: 20,
            location: 'Jakarta Utara, Ancol',
            coordinates: { lat: -6.1220, lng: 106.8421 },
            type: '3br+',
            bedrooms: 3,
            bathrooms: 2,
            sqft: 150,
            amenities: ['pool', 'wifi', 'parking', 'ac', 'kitchen', 'beach-access'],
            images: [
              'https://source.unsplash.com/random/800x600/?beachfront,apartment,view',
              'https://source.unsplash.com/random/600x400/?coastal,living,room',
              'https://source.unsplash.com/random/600x400/?balcony,ocean'
            ],
            description: 'Rasakan sensasi liburan setiap hari di apartemen tepi pantai Ancol. Pemandangan laut yang menenangkan, akses langsung ke pantai, dan fasilitas rekreasi keluarga. Ideal untuk liburan atau tinggal jangka panjang.',
            host: { name: 'Kapten Bahari', verified: true },
            reviews: [
              { user: 'Keluarga Siregar', rating: 4, comment: 'Anak-anak senang sekali bisa main di pantai setiap hari. Apartemennya bersih dan luas.', date: '2024-07-05' }
            ],
            bookedDates: ['2024-09-10', '2024-09-11', '2024-09-12', '2024-09-13', '2024-09-14']
          },
        ],
        bookingHistory: [
          { id: 'BK001', apartmentTitle: 'Penthouse Mewah Sudirman', checkin: '2024-05-01', checkout: '2024-05-07', totalCost: 175, status: 'Selesai' },
          { id: 'BK002', apartmentTitle: 'Studio Modern Kemang Village', checkin: '2024-06-10', checkout: '2024-06-15', totalCost: 60, status: 'Selesai' },
        ]
      },

      // UTILITIES: Fungsi bantuan umum
      utils: {
        formatPrice: (price, multiplier = app.config.priceMultiplier) => {
          const actualPrice = price * multiplier;
          return `${app.config.currency} ${actualPrice.toLocaleString('id-ID')}`;
        },
        formatDate: (dateString) => {
          if (!dateString) return 'N/A';
          const date = new Date(dateString);
          return date.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
        },
        getDaysDifference: (date1, date2) => {
          if (!date1 || !date2) return 0;
          const d1 = new Date(date1);
          const d2 = new Date(date2);
          const diffTime = Math.abs(d2 - d1);
          return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        },
        // Fungsi untuk "debounce" agar tidak memanggil fungsi terlalu sering
        debounce: (func, delay) => {
          let timeout;
          return function (...args) {
            const context = this;
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(context, args), delay);
          };
        },
        // Fungsi untuk "throttle" agar fungsi dipanggil maksimal sekali dalam interval tertentu
        throttle: (func, limit) => {
          let inThrottle;
          return function (...args) {
            const context = this;
            if (!inThrottle) {
              func.apply(context, args);
              inThrottle = true;
              setTimeout(() => inThrottle = false, limit);
            }
          };
        },
        // Generate ID unik sederhana
        generateId: (prefix = '') => {
          return prefix + Math.random().toString(36).substr(2, 9);
        },
        // Fungsi untuk scroll ke atas halaman
        scrollToTop: () => {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        },
        // Fungsi untuk mendapatkan tanggal hari ini dalam format YYYY-MM-DD
        getTodayDateString: () => {
          const today = new Date();
          const year = today.getFullYear();
          const month = String(today.getMonth() + 1).padStart(2, '0');
          const day = String(today.getDate()).padStart(2, '0');
          return `${year}-${month}-${day}`;
        }
      },

      // UI: Mengelola elemen dan interaksi antarmuka pengguna
      ui: {
        // Elemen DOM yang sering diakses
        elements: {
          // Navigasi
          navLinks: null,
          navToggleBtn: null,
          navLinksMenu: null,
          // Pages
          pages: null,
          // Beranda
          quickSearchForm: null,
          featuredPropertiesContainer: null,
          // Pencarian
          detailedSearchForm: null,
          searchLocationInput: null,
          searchMapCanvas: null,
          searchRadiusSlider: null,
          radiusValueDisplay: null,
          searchPageCalendarContainer: null,
          prevMonthBtnCalendarSearch: null,
          nextMonthBtnCalendarSearch: null,
          currentMonthYearCalendarSearch: null,
          searchCheckinDateInput: null,
          searchCheckoutDateInput: null,
          searchPriceSlider: null,
          priceValueDisplay: null,
          searchAmenitiesCheckboxes: null,
          searchApartmentTypeSelect: null,
          searchResultsContainer: null,
          searchResultsCountDisplay: null,
          noResultsMessage: null,
          resetSearchFiltersBtn: null,
          // Detail Apartemen
          apartmentDetailContainer: null,
          // Profil
          profileName: null,
          profileEmail: null,
          profilePhone: null,
          profileLoyaltyPoints: null,
          profileMemberSince: null,
          profileChatWindow: null,
          profileChatForm: null,
          profileChatInput: null,
          bookingHistoryContainer: null,
          notificationsContainer: null,
          // Chat Global
          globalChatToggleBtn: null,
          globalChatbox: null,
          closeChatboxBtn: null,
          globalChatBody: null,
          globalChatForm: null,
          globalChatInput: null,
          // Footer
          currentYearDisplay: null,
          // Modal
          universalModal: null,
          modalTitle: null,
          modalBody: null,
          modalCloseBtns: null,
        },

        // Inisialisasi elemen UI
        cacheElements: () => {
          const els = app.ui.elements;
          els.navLinks = document.querySelectorAll('.nav-link');
          els.navToggleBtn = document.getElementById('navToggleBtn');
          els.navLinksMenu = document.getElementById('navLinksMenu');
          els.pages = document.querySelectorAll('.page');

          els.quickSearchForm = document.getElementById('quickSearchForm');
          els.featuredPropertiesContainer = document.getElementById('featuredProperties');

          els.detailedSearchForm = document.getElementById('detailedSearchForm');
          els.searchLocationInput = document.getElementById('search-location');
          els.searchMapCanvas = document.getElementById('searchMapCanvas');
          els.searchRadiusSlider = document.getElementById('search-radius');
          els.radiusValueDisplay = document.getElementById('radiusValueDisplay');
          els.searchPageCalendarContainer = document.getElementById('searchPageCalendar');
          els.prevMonthBtnCalendarSearch = document.getElementById('prevMonthBtnCalendarSearch');
          els.nextMonthBtnCalendarSearch = document.getElementById('nextMonthBtnCalendarSearch');
          els.currentMonthYearCalendarSearch = document.getElementById('currentMonthYearCalendarSearch');
          els.searchCheckinDateInput = document.getElementById('search-checkin-date');
          els.searchCheckoutDateInput = document.getElementById('search-checkout-date');
          els.searchPriceSlider = document.getElementById('search-price');
          els.priceValueDisplay = document.getElementById('priceValueDisplay');
          els.searchAmenitiesCheckboxes = document.querySelectorAll('#detailedSearchForm input[name="amenities"]');
          els.searchApartmentTypeSelect = document.getElementById('search-apartment-type');
          els.searchResultsContainer = document.getElementById('searchResultsContainer');
          els.searchResultsCountDisplay = document.getElementById('searchResultsCount');
          els.noResultsMessage = document.getElementById('noResultsMessage');
          els.resetSearchFiltersBtn = document.getElementById('resetSearchFiltersBtn');

          els.apartmentDetailContainer = document.getElementById('apartmentDetailContent');

          els.profileName = document.getElementById('profileName');
          els.profileEmail = document.getElementById('profileEmail');
          els.profilePhone = document.getElementById('profilePhone');
          els.profileLoyaltyPoints = document.getElementById('profileLoyaltyPoints');
          els.profileMemberSince = document.getElementById('profileMemberSince');
          els.profileChatWindow = document.getElementById('profileChatWindow');
          els.profileChatForm = document.getElementById('profileChatForm');
          els.profileChatInput = document.getElementById('profileChatInput');
          els.bookingHistoryContainer = document.getElementById('bookingHistoryContainer');
          els.notificationsContainer = document.getElementById('notificationsContainer');

          els.globalChatToggleBtn = document.getElementById('globalChatToggleBtn');
          els.globalChatbox = document.getElementById('globalChatbox');
          els.closeChatboxBtn = document.getElementById('closeChatboxBtn');
          els.globalChatBody = document.getElementById('globalChatBody');
          els.globalChatForm = document.getElementById('globalChatForm');
          els.globalChatInput = document.getElementById('globalChatInput');

          els.currentYearDisplay = document.getElementById('currentYear');

          els.universalModal = document.getElementById('universalModal');
          els.modalTitle = document.getElementById('modalTitle');
          els.modalBody = document.getElementById('modalBody');
          els.modalCloseBtns = document.querySelectorAll('.modal-close-btn, .modal-backdrop'); // Menutup modal jika backdrop diklik
        },

        // Mengelola tampilan halaman
        showPage: (pageId) => {
          if (!pageId) pageId = 'home'; // Default ke home jika tidak ada
          app.state.currentPage = pageId;
          app.ui.elements.pages.forEach(page => {
            page.classList.toggle('hidden', page.id !== pageId);
            if (page.id === pageId) {
              page.classList.remove('fade-in'); // Hapus dulu agar animasi bisa berulang
              void page.offsetWidth; // Paksa reflow
              page.classList.add('fade-in');
            }
          });
          app.ui.updateNavLinks(pageId);
          app.utils.scrollToTop();
          app.services.loadPageSpecificData(pageId);

          // Tutup menu mobile jika terbuka
          if (app.ui.elements.navLinksMenu.classList.contains('open')) {
            app.ui.elements.navLinksMenu.classList.remove('open');
            app.ui.elements.navToggleBtn.setAttribute('aria-expanded', 'false');
            app.ui.elements.navToggleBtn.innerHTML = '<span class="material-icons">menu</span>';
          }
        },

        updateNavLinks: (activePageId) => {
          app.ui.elements.navLinks.forEach(link => {
            link.classList.toggle('active', link.dataset.page === activePageId);
          });
        },

        // Fungsi untuk render kartu apartemen
        renderApartmentCard: (apartment, isFeatured = false) => {
          const priceDisplay = app.utils.formatPrice(apartment.price);
          const amenitiesList = apartment.amenities.slice(0, 3).map(amenity => {
            const iconMap = { pool: 'pool', gym: 'fitness_center', wifi: 'wifi', parking: 'local_parking', ac: 'ac_unit', kitchen: 'kitchen', laundry: 'local_laundry_service', 'pet-friendly': 'pets', 'playground': 'child_friendly', 'beach-access': 'beach_access', 'art-studio-space': 'palette' };
            return `<span><i class="material-icons">${iconMap[amenity] || 'apartment'}</i> ${amenity.replace('-', ' ')}</span>`;
          }).join('');

          const cardHtml = `
            <article class="card" data-id="${apartment.id}" tabindex="0" aria-labelledby="title-${apartment.id}">
              <img src="${apartment.images[0]}" alt="Tampilan ${apartment.title}" class="card-img" loading="lazy">
              <div class="card-body">
                <h3 class="card-title" id="title-${apartment.id}">
                  ${apartment.title}
                  ${apartment.host.verified ? '<span class="material-icons" title="Pemilik Terverifikasi">verified_user</span>' : ''}
                </h3>
                <div class="card-details">
                  <span class="card-price">${priceDisplay}/bulan</span>
                  <span class="card-location"><i class="material-icons">location_on</i> ${apartment.location}</span>
                </div>
                <div class="card-features mb-md">
                  <span><i class="material-icons">hotel</i> ${apartment.bedrooms} KT</span>
                  <span><i class="material-icons">bathtub</i> ${apartment.bathrooms} KM</span>
                  <span><i class="material-icons">square_foot</i> ${apartment.sqft} m</span>
                </div>
                <p class="card-text text-sm text-muted">${apartment.description.substring(0, 100)}...</p>
                <div class="card-actions">
                  <a href="#apartment/${apartment.slug || apartment.id}" class="btn btn-primary btn-sm btn-full nav-link" data-page="apartment" data-id="${apartment.id}">
                    <span class="material-icons">visibility</span>Lihat Detail
                  </a>
                </div>
              </div>
              ${isFeatured ? `
                <details class="card-details-extra">
                  <summary>Fasilitas Tambahan</summary>
                  <div class="p-md text-sm">
                    <ul class="list-disc pl-md">
                      ${apartment.amenities.map(a => `<li>${a.replace('-', ' ')}</li>`).join('')}
                    </ul>
                  </div>
                </details>
              ` : ''}
            </article>
          `;
          return cardHtml;
        },

        // Render properti unggulan
        renderFeaturedProperties: () => {
          const container = app.ui.elements.featuredPropertiesContainer;
          if (!container) return;
          const featured = app.state.apartments.slice(0, app.config.featuredPropertiesCount);
          container.innerHTML = featured.map(apt => app.ui.renderApartmentCard(apt, true)).join('');
        },

        // Render hasil pencarian
        renderSearchResults: (results) => {
          const container = app.ui.elements.searchResultsContainer;
          const countDisplay = app.ui.elements.searchResultsCountDisplay;
          const noResultsMsg = app.ui.elements.noResultsMessage;

          if (!container || !countDisplay || !noResultsMsg) return;

          countDisplay.textContent = results.length;
          if (results.length === 0) {
            container.innerHTML = '';
            noResultsMsg.classList.remove('hidden');
          } else {
            container.innerHTML = results.map(apt => app.ui.renderApartmentCard(apt)).join('');
            noResultsMsg.classList.add('hidden');
          }
        },

        // Render Detail Apartemen
        renderApartmentDetail: (apartment) => {
          const container = app.ui.elements.apartmentDetailContainer;
          if (!container) return;

          const priceDisplay = app.utils.formatPrice(apartment.price);
          const amenitiesHtml = apartment.amenities.map(amenity => {
            const iconMap = { pool: 'pool', gym: 'fitness_center', wifi: 'wifi', parking: 'local_parking', ac: 'ac_unit', kitchen: 'kitchen', laundry: 'local_laundry_service', 'pet-friendly': 'pets', 'playground': 'child_friendly', 'beach-access': 'beach_access', 'art-studio-space': 'palette' };
            return `<li class="flex items-center gap-xs"><span class="material-icons text-primary">${iconMap[amenity] || 'check_circle'}</span> ${amenity.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</li>`;
          }).join('');

          const reviewsHtml = apartment.reviews.length > 0 ? apartment.reviews.map((review, index) => `
                <div class="review-item">
                    <div class="review-header">
                        <span class="review-user">${review.user}</span>
                        <span class="review-rating">
                            ${Array(5).fill(0).map((_, i) => `<span class="material-icons">${i < review.rating ? 'star' : 'star_border'}</span>`).join('')}
                        </span>
                    </div>
                    <p class="review-comment text-sm mb-xs">${review.comment}</p>
                    <p class="text-xs text-muted">Pada: ${app.utils.formatDate(review.date)}</p>
                    <button class="btn btn-link btn-sm text-error p-0 mt-xs" data-review-id="${index}" data-apartment-id="${apartment.id}" onclick="app.ui.showReportForm(this)">
                        <span class="material-icons text-sm">flag</span> Laporkan ulasan
                    </button>
                </div>
            `).join('') : '<p class="text-muted">Belum ada ulasan untuk properti ini.</p>';

          const galleryItemsHtml = apartment.images.map((img, index) => `
                <div class="gallery-item" onclick="app.ui.openImageModal('${img}', 'Gambar ${index + 1} dari ${apartment.title}')">
                    <img src="${img}" alt="Gambar ${index + 1} dari ${apartment.title}" loading="lazy">
                    ${index === 0 ? `
                        <div class="virtual-tour-overlay">
                            <span class="material-icons">visibility</span>
                            <span>Lihat Tur Virtual (Simulasi)</span>
                        </div>
                    ` : ''}
                </div>
            `).join('');

          // Tentukan kelas untuk galeri berdasarkan jumlah gambar
          let galleryClass = 'apartment-gallery';
          if (apartment.images.length === 1) galleryClass += ' single-image';
          else if (apartment.images.length === 2) galleryClass += ' two-images';
          // Untuk 3 gambar, defaultnya sudah cukup baik. Jika 4, bisa di-handle oleh CSS.
          // Untuk 5 atau lebih, style default grid-template-columns: 2fr 1fr 1fr; dan grid-template-rows: auto auto; akan menangani dengan baik.

          container.innerHTML = `
                <h1 class="font-bold text-2xl md:text-3xl mb-sm">${apartment.title}</h1>
                <div class="flex items-center gap-md mb-lg text-muted">
                    <span><i class="material-icons">location_on</i> ${apartment.location}</span>
                    <span><i class="material-icons">hotel</i> ${apartment.bedrooms} KT</span>
                    <span><i class="material-icons">bathtub</i> ${apartment.bathrooms} KM</span>
                    <span><i class="material-icons">square_foot</i> ${apartment.sqft} m</span>
                </div>

                <div class="${galleryClass} mb-xl">
                    ${galleryItemsHtml}
                </div>

                <div class="apartment-details-grid">
                    <div class="apartment-main-content">
                        <h2 class="font-semibold text-xl mb-md">Deskripsi Properti</h2>
                        <p class="text-muted mb-lg">${apartment.description}</p>

                        <h2 class="font-semibold text-xl mb-md">Fasilitas Unggulan</h2>
                        <ul class="grid grid-cols-2 sm:grid-cols-3 gap-md mb-lg">
                            ${amenitiesHtml}
                        </ul>
                        
                        <h2 class="font-semibold text-xl mb-md">Lokasi Properti</h2>
                        <div class="map-canvas mb-lg" id="apartmentDetailMapCanvas" aria-label="Peta lokasi properti (simulasi)">
                            ${app.config.defaultMapMessage} - Lokasi: ${apartment.location}
                        </div>

                        <h2 class="font-semibold text-xl mb-md">Ulasan dari Penyewa</h2>
                        <div id="apartmentReviewsContainer" class="mb-lg">
                            ${reviewsHtml}
                        </div>
                        <div id="reportFormContainer" class="report-form-container hidden">
                            <!-- Form laporan akan di-render di sini jika diperlukan -->
                        </div>

                    </div>
                    <aside class="apartment-booking-sidebar">
                        <form class="booking-form-sticky" id="apartmentBookingForm">
                            <h3 class="font-semibold text-lg mb-md">Pesan Apartemen Ini</h3>
                            <p class="text-2xl font-bold text-primary mb-lg">${priceDisplay}<span class="text-base font-normal text-muted">/bulan</span></p>
                            
                            <div class="form-group">
                                <label for="book-checkin">Tanggal Check-in</label>
                                <input type="date" id="book-checkin" required min="${app.utils.getTodayDateString()}">
                            </div>
                            <div class="form-group">
                                <label for="book-checkout">Tanggal Check-out</label>
                                <input type="date" id="book-checkout" required min="${app.utils.getTodayDateString()}">
                            </div>
                            <div class="form-group">
                                <label for="book-guests">Jumlah Tamu</label>
                                <input type="number" id="book-guests" min="1" value="1" max="${apartment.bedrooms * 2 || 2}" required>
                            </div>
                            <div class="form-group">
                                <label>Metode Pembayaran</label>
                                <div class="payment-methods">
                                    <div class="payment-method" data-method="credit-card" tabindex="0" role="button">Kartu Kredit</div>
                                    <div class="payment-method" data-method="bank-transfer" tabindex="0" role="button">Transfer</div>
                                    <div class="payment-method" data-method="e-wallet" tabindex="0" role="button">E-Wallet</div>
                                </div>
                                <input type="hidden" id="selected-payment-method" name="paymentMethod">
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label"><input type="checkbox" id="book-insurance"> Tambah Asuransi Perjalanan (+10%)</label>
                            </div>
                            
                            <div class="cost-breakdown hidden" id="bookingCostBreakdown">
                                <h4 class="font-medium mb-sm">Rincian Biaya</h4>
                                <div class="cost-line"><span>Harga Sewa (<span id="booking-duration">0</span> malam)</span><span id="base-cost-value">Rp 0</span></div>
                                <div class="cost-line"><span>Biaya Layanan (5%)</span><span id="service-cost-value">Rp 0</span></div>
                                <div class="cost-line hidden" id="insurance-cost-line"><span>Asuransi</span><span id="insurance-cost-value">Rp 0</span></div>
                                <div class="cost-line total"><span>Total Pembayaran</span><span id="total-cost-value">Rp 0</span></div>
                            </div>
                            
                            <div class="escrow-info">
                                <p><span class="material-icons" style="vertical-align: middle; font-size:1.2em; margin-right: var(--space-xs);">verified_user</span>Pembayaran Anda aman melalui sistem escrow Rentelindo. Dana akan diteruskan ke pemilik setelah Anda check-in.</p>
                            </div>
                            
                            <button type="submit" class="btn btn-primary btn-lg btn-full">
                                <span class="material-icons">event_available</span>Pesan Sekarang
                            </button>
                        </form>
                    </aside>
                </div>
            `;
          // Setelah innerHTML, elemen baru perlu di-cache atau event listener ditambahkan
          app.ui.setupApartmentDetailPageListeners(apartment);
          app.ui.initMap('apartmentDetailMapCanvas', apartment.coordinates);
          app.ui.renderCalendarForBooking(apartment.bookedDates); // Kalender untuk tanggal booking
        },

        showReportForm: (buttonElement) => {
          const reviewId = buttonElement.dataset.reviewId;
          const apartmentId = buttonElement.dataset.apartmentId;
          const apartment = app.state.apartments.find(a => a.id == apartmentId);
          if (!apartment) return;
          const review = apartment.reviews[reviewId];
          if (!review) return;

          const reportFormContainer = document.getElementById('reportFormContainer');
          if (!reportFormContainer) return;

          reportFormContainer.innerHTML = `
                <h3 class="font-semibold text-lg mb-md text-error">Laporkan Ulasan oleh ${review.user}</h3>
                <form id="reviewReportForm">
                    <input type="hidden" name="reviewId" value="${reviewId}">
                    <input type="hidden" name="apartmentId" value="${apartmentId}">
                    <div class="form-group">
                        <label for="report-reason">Alasan Pelaporan</label>
                        <textarea id="report-reason" name="reason" placeholder="Jelaskan mengapa ulasan ini tidak pantas atau melanggar ketentuan..." required></textarea>
                    </div>
                    <div class="flex gap-sm">
                        <button type="submit" class="btn btn-error">
                            <span class="material-icons">send</span> Kirim Laporan
                        </button>
                        <button type="button" class="btn btn-outline" onclick="app.ui.hideReportForm()">
                            Batal
                        </button>
                    </div>
                </form>
            `;
          reportFormContainer.classList.remove('hidden');
          document.getElementById('reviewReportForm').addEventListener('submit', app.handlers.handleReviewReportSubmit);
        },

        hideReportForm: () => {
          const reportFormContainer = document.getElementById('reportFormContainer');
          if (reportFormContainer) {
            reportFormContainer.classList.add('hidden');
            reportFormContainer.innerHTML = '';
          }
        },

        updateBookingCost: (apartment) => {
          const checkinDate = document.getElementById('book-checkin').value;
          const checkoutDate = document.getElementById('book-checkout').value;
          const insuranceChecked = document.getElementById('book-insurance').checked;
          const costBreakdownEl = document.getElementById('bookingCostBreakdown');

          if (!checkinDate || !checkoutDate || !costBreakdownEl) {
            costBreakdownEl.classList.add('hidden');
            return;
          }

          const startDate = new Date(checkinDate);
          const endDate = new Date(checkoutDate);

          if (endDate <= startDate) {
            costBreakdownEl.classList.add('hidden');
            return; // Tanggal tidak valid
          }

          const duration = app.utils.getDaysDifference(checkinDate, checkoutDate);
          document.getElementById('booking-duration').textContent = duration;

          const basePricePerNight = apartment.price; // Anggap harga per bulan / 30 ~ harga per malam
          const totalBaseCost = basePricePerNight * duration; // Ini harusnya per bulan, jadi logika perlu disesuaikan. Asumsi harga adalah per bulan.
          // Untuk sewa bulanan, durasi harusnya dalam bulan.
          // Mari sederhanakan: harga yang tertera adalah harga per bulan.
          // Jika sewa < 1 bulan, hitung prorata. > 1 bulan, kalikan.
          // Untuk demo ini, kita asumsikan harga = `apartment.price` adalah total untuk periode yang dipilih.
          // Atau, jika `apartment.price` adalah per bulan, maka totalBaseCost adalah `apartment.price * (duration / 30)`
          // Kita akan anggap `apartment.price` adalah per bulan, dan `duration` adalah hari.
          // Simplifikasi: Anggap harga yang ditampilkan adalah untuk 1 bulan.
          // Untuk kalkulasi ini, kita pakai harga / 30 * duration.

          const dailyRate = apartment.price / 30; // Harga per hari jika harga bulanan
          const calculatedBaseCost = dailyRate * duration; // Total biaya dasar
          const serviceFee = calculatedBaseCost * 0.05; // 5% biaya layanan
          const insuranceCost = insuranceChecked ? calculatedBaseCost * 0.10 : 0; // 10% biaya asuransi
          const totalCost = calculatedBaseCost + serviceFee + insuranceCost;

          document.getElementById('base-cost-value').textContent = app.utils.formatPrice(calculatedBaseCost / app.config.priceMultiplier, app.config.priceMultiplier); // Dibagi dulu agar formatPrice benar
          document.getElementById('service-cost-value').textContent = app.utils.formatPrice(serviceFee / app.config.priceMultiplier, app.config.priceMultiplier);

          const insuranceCostLine = document.getElementById('insurance-cost-line');
          if (insuranceChecked) {
            document.getElementById('insurance-cost-value').textContent = app.utils.formatPrice(insuranceCost / app.config.priceMultiplier, app.config.priceMultiplier);
            insuranceCostLine.classList.remove('hidden');
          } else {
            insuranceCostLine.classList.add('hidden');
          }

          document.getElementById('total-cost-value').textContent = app.utils.formatPrice(totalCost / app.config.priceMultiplier, app.config.priceMultiplier);
          costBreakdownEl.classList.remove('hidden');
        },

        // Render kalender
        renderCalendar: (container, year, month, bookedDates = [], onDateSelectCallback = null, calendarType = 'search') => {
          if (!container) return;
          container.innerHTML = ''; // Kosongkan dulu

          const monthNames = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
          const dayNames = ["Min", "Sen", "Sel", "Rab", "Kam", "Jum", "Sab"];

          // Update display bulan dan tahun di navigasi kalender (jika ada)
          if (calendarType === 'search' && app.ui.elements.currentMonthYearCalendarSearch) {
            app.ui.elements.currentMonthYearCalendarSearch.textContent = `${monthNames[month]} ${year}`;
          } else if (calendarType === 'booking' && document.getElementById('currentMonthYearBookingCalendar')) {
            document.getElementById('currentMonthYearBookingCalendar').textContent = `${monthNames[month]} ${year}`;
          }


          // Header hari (Sen, Sel, Rab, dst.)
          dayNames.forEach(dayName => {
            const dayHeaderEl = document.createElement('div');
            dayHeaderEl.classList.add('calendar-header');
            dayHeaderEl.textContent = dayName;
            container.appendChild(dayHeaderEl);
          });

          const firstDayOfMonth = new Date(year, month, 1).getDay(); // 0 (Minggu) - 6 (Sabtu)
          const daysInMonth = new Date(year, month + 1, 0).getDate();
          const today = new Date();
          today.setHours(0, 0, 0, 0); // Normalisasi tanggal hari ini

          // Kotak kosong sebelum hari pertama
          for (let i = 0; i < firstDayOfMonth; i++) {
            const emptyCell = document.createElement('div');
            emptyCell.classList.add('calendar-day', 'empty');
            container.appendChild(emptyCell);
          }

          // Hari-hari dalam sebulan
          for (let day = 1; day <= daysInMonth; day++) {
            const dayCell = document.createElement('div');
            dayCell.classList.add('calendar-day');
            dayCell.textContent = day;
            const currentDate = new Date(year, month, day);
            currentDate.setHours(0, 0, 0, 0); // Normalisasi
            const dateString = currentDate.toISOString().split('T')[0]; // YYYY-MM-DD

            dayCell.dataset.date = dateString;

            if (currentDate < today) { // Tanggal sudah lewat
              dayCell.classList.add('booked'); // Anggap sudah lewat = booked
              dayCell.setAttribute('aria-disabled', 'true');
            } else if (bookedDates.includes(dateString)) {
              dayCell.classList.add('booked');
              dayCell.setAttribute('aria-disabled', 'true');
            } else {
              dayCell.classList.add('available');
              dayCell.setAttribute('aria-disabled', 'false');
              if (onDateSelectCallback) {
                dayCell.addEventListener('click', () => {
                  if (!dayCell.classList.contains('booked')) {
                    onDateSelectCallback(dateString, calendarType);
                  }
                });
              }
            }

            if (currentDate.getTime() === today.getTime()) {
              dayCell.classList.add('today');
            }

            // Tandai tanggal yang dipilih (jika ada)
            if (calendarType === 'search') {
              if (app.state.searchFilters.checkin === dateString || app.state.searchFilters.checkout === dateString) {
                dayCell.classList.add('selected');
              }
            } else if (calendarType === 'booking') {
              const bookCheckin = document.getElementById('book-checkin')?.value;
              const bookCheckout = document.getElementById('book-checkout')?.value;
              if (bookCheckin === dateString || bookCheckout === dateString) {
                dayCell.classList.add('selected');
              }
            }

            container.appendChild(dayCell);
          }
        },

        renderCalendarForSearch: () => {
          app.ui.renderCalendar(
            app.ui.elements.searchPageCalendarContainer,
            app.state.currentCalendarYear,
            app.state.currentCalendarMonth,
            [], // Di sini bisa ditambahkan booked dates global jika ada
            app.handlers.handleCalendarDateSelect,
            'search'
          );
        },

        renderCalendarForBooking: (bookedDates = []) => {
          const calendarContainer = document.getElementById('bookingCalendar'); // Asumsi ada elemen ini di form booking
          const currentMonthYearEl = document.getElementById('currentMonthYearBookingCalendar');
          const prevBtn = document.getElementById('prevMonthBtnBookingCalendar');
          const nextBtn = document.getElementById('nextMonthBtnBookingCalendar');

          if (!calendarContainer || !currentMonthYearEl || !prevBtn || !nextBtn) return;

          let bookingCalendarYear = new Date().getFullYear();
          let bookingCalendarMonth = new Date().getMonth();

          const updateDisplay = () => {
            app.ui.renderCalendar(
              calendarContainer,
              bookingCalendarYear,
              bookingCalendarMonth,
              bookedDates,
              app.handlers.handleBookingCalendarDateSelect,
              'booking'
            );
          };

          prevBtn.onclick = () => {
            bookingCalendarMonth--;
            if (bookingCalendarMonth < 0) {
              bookingCalendarMonth = 11;
              bookingCalendarYear--;
            }
            updateDisplay();
          };
          nextBtn.onclick = () => {
            bookingCalendarMonth++;
            if (bookingCalendarMonth > 11) {
              bookingCalendarMonth = 0;
              bookingCalendarYear++;
            }
            updateDisplay();
          };
          updateDisplay();
        },

        // Render Riwayat Pemesanan
        renderBookingHistory: () => {
          const container = app.ui.elements.bookingHistoryContainer;
          if (!container) return;

          const history = app.state.bookingHistory; // Ambil dari state
          if (history.length === 0) {
            container.innerHTML = '<p class="text-sm text-muted">Tidak ada riwayat pemesanan.</p>';
            return;
          }

          container.innerHTML = history.map(booking => `
                <div class="card p-sm mb-sm shadow-xs">
                    <h4 class="font-medium text-sm mb-xs">${booking.apartmentTitle}</h4>
                    <p class="text-xs text-muted">ID: ${booking.id}</p>
                    <p class="text-xs text-muted">Check-in: ${app.utils.formatDate(booking.checkin)}</p>
                    <p class="text-xs text-muted">Check-out: ${app.utils.formatDate(booking.checkout)}</p>
                    <p class="text-xs font-semibold mt-xs">Total: ${app.utils.formatPrice(booking.totalCost / app.config.priceMultiplier, app.config.priceMultiplier)} (${booking.status})</p>
                </div>
            `).join('');
        },

        // Tambah pesan ke chat window
        addChatMessage: (message, type, chatBodyElement) => {
          if (!chatBodyElement) return;
          const messageEl = document.createElement('div');
          messageEl.classList.add('chat-message', type);
          messageEl.textContent = message;
          chatBodyElement.appendChild(messageEl);
          chatBodyElement.scrollTop = chatBodyElement.scrollHeight; // Auto scroll ke bawah
        },

        // Fungsi untuk membuka/menutup chat global
        toggleGlobalChat: (forceOpen = null) => {
          const isOpen = app.ui.elements.globalChatbox.classList.contains('open');
          if (forceOpen === true || (forceOpen === null && !isOpen)) {
            app.ui.elements.globalChatbox.classList.add('open');
            app.ui.elements.globalChatToggleBtn.innerHTML = '<span class="material-icons">close</span>';
            app.ui.elements.globalChatToggleBtn.setAttribute('aria-label', 'Tutup chat dukungan');
            app.state.globalChatOpen = true;
            app.ui.elements.globalChatInput.focus();
          } else if (forceOpen === false || (forceOpen === null && isOpen)) {
            app.ui.elements.globalChatbox.classList.remove('open');
            app.ui.elements.globalChatToggleBtn.innerHTML = '<span class="material-icons">chat</span>';
            app.ui.elements.globalChatToggleBtn.setAttribute('aria-label', 'Buka chat dukungan');
            app.state.globalChatOpen = false;
          }
        },
        openGlobalChat: () => app.ui.toggleGlobalChat(true), // Alias

        // Fungsi untuk membuka modal
        openModal: (title, contentHtml) => {
          if (!app.ui.elements.universalModal || !app.ui.elements.modalTitle || !app.ui.elements.modalBody) return;
          app.ui.elements.modalTitle.textContent = title;
          app.ui.elements.modalBody.innerHTML = contentHtml;
          app.ui.elements.universalModal.classList.add('open');
          // Fokus ke elemen pertama yang bisa difokus di dalam modal
          const focusableElements = app.ui.elements.universalModal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
          if (focusableElements.length) focusableElements[0].focus();
        },

        // Fungsi untuk menutup modal
        closeModal: () => {
          if (app.ui.elements.universalModal) {
            app.ui.elements.universalModal.classList.remove('open');
          }
        },

        openImageModal: (imageUrl, altText) => {
          app.ui.openModal(altText, `<img src="${imageUrl}" alt="${altText}" style="width:100%; height:auto; max-height: 80vh; object-fit:contain;">`);
        },

        // Inisialisasi Peta (Simulasi)
        initMap: (canvasId, coordinates = null) => {
          const canvas = document.getElementById(canvasId);
          if (!canvas) return;
          const ctx = canvas.getContext('2d');
          canvas.width = canvas.offsetWidth; // Set ukuran canvas sesuai elemennya
          canvas.height = canvas.offsetHeight;

          ctx.fillStyle = 'hsl(200, 30%, 92%)'; // Warna dasar peta
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          // Gambar beberapa jalan acak (simulasi)
          ctx.strokeStyle = 'hsl(200, 20%, 80%)';
          ctx.lineWidth = 4;
          for (let i = 0; i < 5; i++) {
            ctx.beginPath();
            ctx.moveTo(Math.random() * canvas.width, Math.random() * canvas.height);
            ctx.lineTo(Math.random() * canvas.width, Math.random() * canvas.height);
            ctx.stroke();
          }

          // Gambar marker lokasi
          if (coordinates) { // Jika ada koordinat (meskipun tidak dipakai untuk render 2D ini)
            const markerX = canvas.width / 2 + (Math.random() - 0.5) * 50; // Posisi marker sedikit acak di tengah
            const markerY = canvas.height / 2 + (Math.random() - 0.5) * 30;

            ctx.fillStyle = 'hsl(0, 70%, 60%)'; // Warna marker (merah)
            ctx.beginPath();
            ctx.arc(markerX, markerY, 8, 0, Math.PI * 2); // Lingkaran marker
            ctx.fill();
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.fillStyle = 'black';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            // canvas.dataset.message diambil dari textContent elemen saat di-render
            const message = canvas.textContent || app.config.defaultMapMessage;
            if (message.startsWith('Simulasi Peta')) { // Hanya tampilkan pesan default jika itu yang ada
              ctx.fillText(message, canvas.width / 2, canvas.height - 20);
            } else { // Jika ada info lokasi, tampilkan itu
              ctx.fillText(message, canvas.width / 2, canvas.height - 20);
            }
          } else {
            ctx.fillStyle = 'black';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(canvas.textContent || app.config.defaultMapMessage, canvas.width / 2, canvas.height - 20);
          }

          // Tambahkan interaktivitas simulasi
          canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            ctx.fillStyle = 'hsla(210, 85%, 55%, 0.5)'; // Biru transparan saat klik
            ctx.beginPath();
            ctx.arc(x, y, 15, 0, Math.PI * 2);
            ctx.fill();
            // Bisa tambahkan feedback ke UI, misal update input lokasi terdekat
            // console.log(`Peta diklik pada X:${x}, Y:${y}`);
          });
        },

        // Setup event listener spesifik untuk halaman detail apartemen
        setupApartmentDetailPageListeners: (apartment) => {
          // Listener untuk form booking
          const bookingForm = document.getElementById('apartmentBookingForm');
          if (bookingForm) {
            bookingForm.addEventListener('submit', (e) => app.handlers.handleBookingSubmit(e, apartment));
            // Listener untuk update rincian biaya secara dinamis
            ['book-checkin', 'book-checkout', 'book-insurance'].forEach(id => {
              const el = document.getElementById(id);
              if (el) el.addEventListener('change', () => app.ui.updateBookingCost(apartment));
            });
          }
          // Listener untuk metode pembayaran
          const paymentMethods = document.querySelectorAll('.payment-method');
          paymentMethods.forEach(method => {
            method.addEventListener('click', () => {
              paymentMethods.forEach(m => m.classList.remove('selected'));
              method.classList.add('selected');
              document.getElementById('selected-payment-method').value = method.dataset.method;
            });
            // Aksesibilitas keyboard
            method.addEventListener('keydown', (e) => {
              if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                method.click();
              }
            });
          });
        },

        updateFooterYear: () => {
          if (app.ui.elements.currentYearDisplay) {
            app.ui.elements.currentYearDisplay.textContent = new Date().getFullYear();
          }
        },

        // Inisialisasi semua UI
        init: () => {
          app.ui.cacheElements();
          app.ui.updateFooterYear();
          app.ui.renderCalendarForSearch(); // Render kalender di halaman search
          app.ui.initMap('searchMapCanvas'); // Inisialisasi peta di halaman search
        }
      },

      // HANDLERS: Menangani event dari pengguna
      handlers: {
        handleNavClick: (event) => {
          event.preventDefault();
          const targetLink = event.target.closest('.nav-link');
          if (targetLink && targetLink.dataset.page) {
            const pageId = targetLink.dataset.page;
            let apartmentId = targetLink.dataset.id; // Untuk link dari kartu properti

            if (pageId === 'apartment' && apartmentId) {
              app.state.selectedApartmentId = parseInt(apartmentId);
              window.location.hash = `${pageId}/${app.state.apartments.find(a => a.id === app.state.selectedApartmentId)?.slug || apartmentId}`;
            } else {
              window.location.hash = pageId;
            }
            // app.ui.showPage akan dipanggil oleh handleRouteChange
          }
        },

        handleNavToggle: () => {
          const isOpen = app.ui.elements.navLinksMenu.classList.toggle('open');
          app.ui.elements.navToggleBtn.setAttribute('aria-expanded', isOpen.toString());
          if (isOpen) {
            app.ui.elements.navToggleBtn.innerHTML = '<span class="material-icons">close</span>';
          } else {
            app.ui.elements.navToggleBtn.innerHTML = '<span class="material-icons">menu</span>';
          }
        },

        handleRouteChange: () => {
          const hash = window.location.hash.substring(1); // Hapus #
          let pageId = 'home'; // Default
          let slugOrId = null;

          if (hash) {
            const parts = hash.split('/');
            pageId = parts[0];
            if (parts.length > 1 && pageId === 'apartment') {
              slugOrId = parts[1];
              // Cari apartment berdasarkan slug atau ID
              const foundApartment = app.state.apartments.find(apt => apt.slug === slugOrId || apt.id == slugOrId);
              if (foundApartment) {
                app.state.selectedApartmentId = foundApartment.id;
              } else {
                console.warn(`Apartment with slug/id "${slugOrId}" not found. Redirecting to home.`);
                pageId = 'home'; // Jika tidak ditemukan, kembali ke home
                window.location.hash = 'home';
              }
            }
          }
          app.ui.showPage(pageId);
        },

        handleQuickSearch: (event) => {
          event.preventDefault();
          const location = document.getElementById('quick-location').value;
          const checkin = document.getElementById('quick-checkin').value;
          const checkout = document.getElementById('quick-checkout').value;

          // Simpan filter ini untuk digunakan di halaman pencarian
          app.state.searchFilters.location = location;
          app.state.searchFilters.checkin = checkin;
          app.state.searchFilters.checkout = checkout;

          // Update input di form pencarian detail jika elemen sudah ada
          if (app.ui.elements.searchLocationInput) app.ui.elements.searchLocationInput.value = location;
          if (app.ui.elements.searchCheckinDateInput) app.ui.elements.searchCheckinDateInput.value = checkin;
          if (app.ui.elements.searchCheckoutDateInput) app.ui.elements.searchCheckoutDateInput.value = checkout;

          // Pindah ke halaman pencarian dan trigger filter
          window.location.hash = 'search';
          // app.services.filterApartments(); // Akan dipanggil oleh loadPageSpecificData di showPage
        },

        handleDetailedSearch: (event) => {
          event.preventDefault();
          // Ambil semua nilai filter dari form pencarian detail
          app.state.searchFilters.location = app.ui.elements.searchLocationInput.value.trim().toLowerCase();
          app.state.searchFilters.radius = parseInt(app.ui.elements.searchRadiusSlider.value);
          // Tanggal sudah dihandle oleh handleCalendarDateSelect
          app.state.searchFilters.maxPrice = parseInt(app.ui.elements.searchPriceSlider.value);

          const selectedAmenities = [];
          app.ui.elements.searchAmenitiesCheckboxes.forEach(checkbox => {
            if (checkbox.checked) selectedAmenities.push(checkbox.value);
          });
          app.state.searchFilters.amenities = selectedAmenities;
          app.state.searchFilters.type = app.ui.elements.searchApartmentTypeSelect.value;

          app.services.filterApartments();
        },

        handleResetSearchFilters: () => {
          if (app.ui.elements.detailedSearchForm) {
            app.ui.elements.detailedSearchForm.reset(); // Reset form HTML
          }

          // Reset state filter manual untuk memastikan
          app.state.searchFilters = {
            location: '',
            radius: 5, // Default radius
            checkin: null,
            checkout: null,
            maxPrice: 5000, // Default max price
            amenities: [],
            type: ''
          };
          // Update tampilan slider dan input tanggal
          if (app.ui.elements.radiusValueDisplay) app.ui.elements.radiusValueDisplay.textContent = app.state.searchFilters.radius;
          if (app.ui.elements.priceValueDisplay) app.ui.elements.priceValueDisplay.textContent = app.state.searchFilters.maxPrice.toLocaleString('id-ID');
          if (app.ui.elements.searchCheckinDateInput) app.ui.elements.searchCheckinDateInput.value = '';
          if (app.ui.elements.searchCheckoutDateInput) app.ui.elements.searchCheckoutDateInput.value = '';

          app.ui.renderCalendarForSearch(); // Re-render kalender
          app.services.filterApartments(); // Terapkan filter default (semua)
        },

        handleCalendarDateSelect: (dateString, calendarType) => {
          // Digunakan untuk kalender di halaman search
          if (calendarType !== 'search') return;

          const { checkin, checkout } = app.state.searchFilters;
          const date = new Date(dateString);

          if (!checkin || (checkin && checkout)) { // Belum ada checkin ATAU sudah ada checkin & checkout (mulai dari awal)
            app.state.searchFilters.checkin = dateString;
            app.state.searchFilters.checkout = null;
          } else if (date > new Date(checkin)) { // Jika tanggal baru setelah checkin
            app.state.searchFilters.checkout = dateString;
          } else { // Jika tanggal baru sebelum atau sama dengan checkin (pilih checkin baru)
            app.state.searchFilters.checkin = dateString;
            app.state.searchFilters.checkout = null;
          }

          // Update input tanggal
          app.ui.elements.searchCheckinDateInput.value = app.state.searchFilters.checkin || '';
          app.ui.elements.searchCheckoutDateInput.value = app.state.searchFilters.checkout || '';

          // Re-render kalender untuk menampilkan tanggal terpilih
          app.ui.renderCalendarForSearch();
          app.services.filterApartments(); // Langsung filter setelah pilih tanggal
        },

        handleBookingCalendarDateSelect: (dateString, calendarType) => {
          // Digunakan untuk kalender di form booking halaman detail
          if (calendarType !== 'booking') return;

          const checkinInput = document.getElementById('book-checkin');
          const checkoutInput = document.getElementById('book-checkout');
          if (!checkinInput || !checkoutInput) return;

          const currentDate = new Date(dateString);

          if (!checkinInput.value || (checkinInput.value && checkoutInput.value)) {
            checkinInput.value = dateString;
            checkoutInput.value = '';
          } else if (currentDate > new Date(checkinInput.value)) {
            checkoutInput.value = dateString;
          } else { // User memilih tanggal sebelum checkin yg sudah ada, atau sama. Reset.
            checkinInput.value = dateString;
            checkoutInput.value = '';
          }
          // Re-render kalender booking (jika ada listener untuk apartment)
          const apartment = app.state.apartments.find(a => a.id === app.state.selectedApartmentId);
          if (apartment) {
            app.ui.renderCalendarForBooking(apartment.bookedDates);
            app.ui.updateBookingCost(apartment); // Update rincian biaya
          }
        },

        handleCalendarNav: (direction, calendarType) => {
          if (calendarType === 'search') {
            if (direction === 'prev') {
              app.state.currentCalendarMonth--;
              if (app.state.currentCalendarMonth < 0) {
                app.state.currentCalendarMonth = 11;
                app.state.currentCalendarYear--;
              }
            } else { // next
              app.state.currentCalendarMonth++;
              if (app.state.currentCalendarMonth > 11) {
                app.state.currentCalendarMonth = 0;
                app.state.currentCalendarYear++;
              }
            }
            app.ui.renderCalendarForSearch();
          }
          // Logika untuk kalender booking bisa ditambahkan di sini jika diperlukan
        },

        handleSliderInput: (event) => {
          const slider = event.target;
          if (slider.id === 'search-radius' && app.ui.elements.radiusValueDisplay) {
            app.ui.elements.radiusValueDisplay.textContent = slider.value;
          } else if (slider.id === 'search-price' && app.ui.elements.priceValueDisplay) {
            app.ui.elements.priceValueDisplay.textContent = parseInt(slider.value).toLocaleString('id-ID');
          }
          // Debounce filtering jika diperlukan agar tidak terlalu sering trigger
          // app.utils.debounce(app.services.filterApartments, 300)(); // Contoh debounce
          app.services.filterApartments(); // Untuk demo, filter langsung
        },

        handleBookingSubmit: (event, apartment) => {
          event.preventDefault();
          const form = event.target;
          const checkin = form.querySelector('#book-checkin').value;
          const checkout = form.querySelector('#book-checkout').value;
          const guests = form.querySelector('#book-guests').value;
          const paymentMethod = form.querySelector('#selected-payment-method').value; // Dari input hidden
          const insurance = form.querySelector('#book-insurance').checked;

          if (!checkin || !checkout || !guests || !paymentMethod) {
            app.ui.openModal('Error Pemesanan', '<p>Mohon lengkapi semua field yang diperlukan: tanggal check-in, check-out, jumlah tamu, dan metode pembayaran.</p>');
            return;
          }
          if (new Date(checkout) <= new Date(checkin)) {
            app.ui.openModal('Error Pemesanan', '<p>Tanggal check-out harus setelah tanggal check-in.</p>');
            return;
          }

          // Simulasi validasi ketersediaan (di dunia nyata ini akan dicek ke backend)
          let isDateRangeBooked = false;
          const startDate = new Date(checkin);
          const endDate = new Date(checkout);
          for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
            if (apartment.bookedDates.includes(d.toISOString().split('T')[0])) {
              isDateRangeBooked = true;
              break;
            }
          }
          if (isDateRangeBooked) {
            app.ui.openModal('Error Pemesanan', '<p>Maaf, sebagian atau seluruh tanggal yang Anda pilih sudah tidak tersedia untuk properti ini.</p>');
            return;
          }

          // Kalkulasi biaya (seharusnya sudah ada di UI, tapi kita re-kalkulasi untuk konfirmasi)
          const duration = app.utils.getDaysDifference(checkin, checkout);
          const dailyRate = apartment.price / 30;
          const calculatedBaseCost = dailyRate * duration;
          const serviceFee = calculatedBaseCost * 0.05;
          const insuranceCost = insurance ? calculatedBaseCost * 0.10 : 0;
          const totalCost = calculatedBaseCost + serviceFee + insuranceCost;

          // Tambahkan tanggal yang dibooking ke properti
          for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
            apartment.bookedDates.push(d.toISOString().split('T')[0]);
          }

          // Tambahkan ke riwayat booking
          const newBooking = {
            id: app.utils.generateId('BK'),
            apartmentId: apartment.id,
            apartmentTitle: apartment.title,
            checkin,
            checkout,
            guests,
            totalCost: totalCost * app.config.priceMultiplier, // Simpan dalam nilai absolut, bukan jutaan
            paymentMethod,
            insurance,
            status: 'Menunggu Pembayaran' // Atau 'Berhasil' jika simulasi langsung
          };
          app.state.bookingHistory.unshift(newBooking); // Tambah di awal array
          app.services.saveBookingHistory(); // Simpan ke localStorage

          app.ui.openModal(
            'Pemesanan Berhasil (Simulasi)',
            `<p>Selamat! Pemesanan Anda untuk <strong>${apartment.title}</strong> dari tanggal ${app.utils.formatDate(checkin)} hingga ${app.utils.formatDate(checkout)} telah berhasil diproses.</p>
                 <p>Total Pembayaran: <strong>${app.utils.formatPrice(totalCost)}</strong></p>
                 <p>Metode Pembayaran: ${paymentMethod.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}</p>
                 <p>Detail pemesanan telah dikirim ke email Anda dan dapat dilihat di halaman profil.</p>`
          );

          form.reset(); // Reset form booking
          document.getElementById('bookingCostBreakdown').classList.add('hidden'); // Sembunyikan rincian
          // Mungkin perlu re-render kalender di detail page jika ada
          app.ui.renderCalendarForBooking(apartment.bookedDates);
        },

        handleProfileChatSubmit: (event) => {
          event.preventDefault();
          const input = app.ui.elements.profileChatInput;
          const message = input.value.trim();
          if (message) {
            app.ui.addChatMessage(message, 'sent', app.ui.elements.profileChatWindow);
            input.value = '';
            // Simulasi balasan dari admin/pemilik
            setTimeout(() => {
              app.ui.addChatMessage('Terima kasih atas pesan Anda. Kami akan segera merespons.', 'received', app.ui.elements.profileChatWindow);
            }, 1500);
          }
        },

        handleGlobalChatSubmit: (event) => {
          event.preventDefault();
          const input = app.ui.elements.globalChatInput;
          const message = input.value.trim();
          if (message) {
            app.ui.addChatMessage(message, 'sent', app.ui.elements.globalChatBody);
            input.value = '';
            // Simulasi balasan otomatis
            setTimeout(() => {
              app.ui.addChatMessage('Terima kasih telah menghubungi dukungan Rentelindo. Seorang agen akan segera membantu Anda.', 'system', app.ui.elements.globalChatBody);
            }, 1000);
            setTimeout(() => {
              app.ui.addChatMessage('Halo! Saya agen Rentelindo. Ada yang bisa saya bantu?', 'received', app.ui.elements.globalChatBody);
            }, 2500);
          }
        },

        handleReviewReportSubmit: (event) => {
          event.preventDefault();
          const form = event.target;
          const reason = form.reason.value.trim();
          const reviewId = form.reviewId.value;
          const apartmentId = form.apartmentId.value;

          if (!reason) {
            app.ui.openModal('Error Laporan', '<p>Mohon isi alasan mengapa Anda melaporkan ulasan ini.</p>');
            return;
          }
          // Simulasi pengiriman laporan
          console.log(`Laporan dikirim untuk review ID ${reviewId} di apartemen ID ${apartmentId}. Alasan: ${reason}`);
          app.ui.openModal('Laporan Terkirim', '<p>Terima kasih atas laporan Anda. Tim kami akan meninjau ulasan tersebut.</p>');
          app.ui.hideReportForm();
        },

        handleModalClose: (event) => {
          // Hanya tutup jika yang diklik adalah backdrop langsung atau tombol close
          if (event.target === app.ui.elements.universalModal || event.target.closest('.modal-close-btn')) {
            app.ui.closeModal();
          }
        },

        // Listener umum dokumen untuk menutup elemen pop-up saat klik di luar
        handleDocumentClick: (event) => {
          // Menutup mobile nav jika klik di luar
          if (app.ui.elements.navLinksMenu.classList.contains('open') &&
            !app.ui.elements.navLinksMenu.contains(event.target) &&
            !app.ui.elements.navToggleBtn.contains(event.target)) {
            app.handlers.handleNavToggle();
          }
          // Menutup global chatbox jika klik di luar (kecuali tombol toggle nya)
          if (app.state.globalChatOpen &&
            app.ui.elements.globalChatbox &&
            !app.ui.elements.globalChatbox.contains(event.target) &&
            !app.ui.elements.globalChatToggleBtn.contains(event.target)) {
            app.ui.toggleGlobalChat(false);
          }
        },

        // Inisialisasi semua handler
        init: () => {
          // Navigasi utama dan hash change
          window.addEventListener('hashchange', app.handlers.handleRouteChange);
          document.body.addEventListener('click', (event) => { // Event delegation untuk nav links
            if (event.target.closest('.nav-link')) {
              app.handlers.handleNavClick(event);
            }
          });
          if (app.ui.elements.navToggleBtn) app.ui.elements.navToggleBtn.addEventListener('click', app.handlers.handleNavToggle);

          // Form
          if (app.ui.elements.quickSearchForm) app.ui.elements.quickSearchForm.addEventListener('submit', app.handlers.handleQuickSearch);
          if (app.ui.elements.detailedSearchForm) {
            app.ui.elements.detailedSearchForm.addEventListener('submit', app.handlers.handleDetailedSearch);
            // Listener untuk slider
            if (app.ui.elements.searchRadiusSlider) app.ui.elements.searchRadiusSlider.addEventListener('input', app.handlers.handleSliderInput);
            if (app.ui.elements.searchPriceSlider) app.ui.elements.searchPriceSlider.addEventListener('input', app.handlers.handleSliderInput);
            // Listener untuk reset filter
            if (app.ui.elements.resetSearchFiltersBtn) app.ui.elements.resetSearchFiltersBtn.addEventListener('click', app.handlers.handleResetSearchFilters);
          }

          // Kalender di halaman search
          if (app.ui.elements.prevMonthBtnCalendarSearch) app.ui.elements.prevMonthBtnCalendarSearch.addEventListener('click', () => app.handlers.handleCalendarNav('prev', 'search'));
          if (app.ui.elements.nextMonthBtnCalendarSearch) app.ui.elements.nextMonthBtnCalendarSearch.addEventListener('click', () => app.handlers.handleCalendarNav('next', 'search'));


          // Chat
          if (app.ui.elements.profileChatForm) app.ui.elements.profileChatForm.addEventListener('submit', app.handlers.handleProfileChatSubmit);
          if (app.ui.elements.globalChatToggleBtn) app.ui.elements.globalChatToggleBtn.addEventListener('click', () => app.ui.toggleGlobalChat());
          if (app.ui.elements.closeChatboxBtn) app.ui.elements.closeChatboxBtn.addEventListener('click', () => app.ui.toggleGlobalChat(false));
          if (app.ui.elements.globalChatForm) app.ui.elements.globalChatForm.addEventListener('submit', app.handlers.handleGlobalChatSubmit);

          // Modal
          if (app.ui.elements.universalModal) {
            app.ui.elements.universalModal.addEventListener('click', app.handlers.handleModalClose);
            // Tambahkan event listener untuk tombol close di dalam modal jika ada
            const internalCloseButtons = app.ui.elements.universalModal.querySelectorAll('.modal-close-btn');
            internalCloseButtons.forEach(btn => btn.addEventListener('click', app.ui.closeModal));
          }
          document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && app.ui.elements.universalModal.classList.contains('open')) {
              app.ui.closeModal();
            }
          });

          // Klik di luar elemen
          document.addEventListener('click', app.handlers.handleDocumentClick);
        }
      },

      // SERVICES: Logika bisnis, interaksi data
      services: {
        loadInitialData: () => {
          // Di aplikasi nyata, ini akan mengambil data dari API
          app.state.apartments = [...app.mockData.apartments]; // Salin array agar tidak memodifikasi mockData asli
          app.services.loadBookingHistory();
        },

        loadPageSpecificData: (pageId) => {
          switch (pageId) {
            case 'home':
              app.ui.renderFeaturedProperties();
              break;
            case 'search':
              app.services.filterApartments(); // Tampilkan semua atau berdasarkan filter sebelumnya
              app.ui.renderCalendarForSearch();
              app.ui.initMap('searchMapCanvas');
              break;
            case 'apartment':
              if (app.state.selectedApartmentId) {
                const apartment = app.state.apartments.find(a => a.id === app.state.selectedApartmentId);
                if (apartment) {
                  app.ui.renderApartmentDetail(apartment);
                } else {
                  // Jika apartemen tidak ditemukan (misal ID salah di URL), redirect atau tampilkan error
                  app.ui.elements.apartmentDetailContainer.innerHTML = '<p class="text-center text-lg text-error">Apartemen tidak ditemukan.</p>';
                  // window.location.hash = 'search'; // Opsional: redirect
                }
              } else {
                app.ui.elements.apartmentDetailContainer.innerHTML = '<p class="text-center text-lg text-muted">Silakan pilih apartemen untuk dilihat detailnya.</p>';
              }
              break;
            case 'profile':
              app.ui.renderBookingHistory();
              // Bisa tambahkan load data profil lain di sini
              break;
            case 'support':
              // Tidak ada data spesifik untuk dimuat saat ini
              break;
          }
        },

        filterApartments: () => {
          const filters = app.state.searchFilters;
          const filteredResults = app.state.apartments.filter(apt => {
            let match = true;

            // Filter Lokasi (pencocokan string sederhana)
            if (filters.location && !apt.location.toLowerCase().includes(filters.location)) {
              match = false;
            }
            // Filter Radius (simulasi, karena tidak ada data geo spasial nyata)
            // Di dunia nyata, ini akan query database geo. Di sini kita abaikan untuk penyederhanaan.

            // Filter Harga
            if (apt.price > filters.maxPrice) {
              match = false;
            }
            // Filter Tipe Apartemen
            if (filters.type && apt.type !== filters.type) {
              match = false;
            }
            // Filter Fasilitas (harus memiliki SEMUA fasilitas yang dipilih)
            if (filters.amenities.length > 0) {
              if (!filters.amenities.every(amenity => apt.amenities.includes(amenity))) {
                match = false;
              }
            }
            // Filter Tanggal Ketersediaan
            if (filters.checkin && filters.checkout) {
              const checkinDate = new Date(filters.checkin);
              const checkoutDate = new Date(filters.checkout);
              let isRangeBooked = false;
              for (let d = new Date(checkinDate); d < checkoutDate; d.setDate(d.getDate() + 1)) {
                if (apt.bookedDates.includes(d.toISOString().split('T')[0])) {
                  isRangeBooked = true;
                  break;
                }
              }
              if (isRangeBooked) match = false;
            } else if (filters.checkin) { // Hanya checkin, periksa apakah tanggal itu available
              if (apt.bookedDates.includes(filters.checkin)) {
                match = false;
              }
            }

            return match;
          });
          app.ui.renderSearchResults(filteredResults);
        },

        loadBookingHistory: () => {
          const storedHistory = localStorage.getItem('rentelindoBookingHistory');
          if (storedHistory) {
            app.state.bookingHistory = JSON.parse(storedHistory);
          } else {
            // Jika tidak ada di localStorage, gunakan mock data
            app.state.bookingHistory = [...app.mockData.bookingHistory];
          }
        },

        saveBookingHistory: () => {
          localStorage.setItem('rentelindoBookingHistory', JSON.stringify(app.state.bookingHistory));
        },

      },

      // INISIALISASI APLIKASI UTAMA
      init: () => {
        console.log("Rentelindo App Initializing...");
        app.services.loadInitialData();
        app.ui.init();
        app.handlers.init();

        // Tangani route awal saat halaman dimuat
        app.handlers.handleRouteChange();
        console.log("Rentelindo App Ready!");
      }
    };

    // Jalankan aplikasi setelah DOM sepenuhnya dimuat
    document.addEventListener('DOMContentLoaded', app.init);

  </script>
</body>

</html>