<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Green Valley - Manajemen Apartemen Modern & Fancy</title>

    <!-- SEO Meta Tags yang Ditingkatkan -->
    <meta name="description"
        content="Green Valley: Platform manajemen penyewaan apartemen Green Valley yang canggih, dengan desain fancy, responsif, dan fitur lengkap untuk pengelolaan penyewa, unit, pembayaran, serta analitik mendalam. Dibuat murni dengan Vanilla JS.">
    <meta name="keywords"
        content="rental apartemen, manajemen properti, green valley, sewa apartemen, apartemen modern, vanilla js, spa, desain fancy, apartemen mewah, manajemen penyewa, aplikasi properti, tanpa framework">
    <meta name="author" content="Tim Pengembang Ahli Green Valley">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <link rel="canonical" href="https://Green Valley.example.com/"> <!-- Ganti dengan URL asli saat deploy -->

    <!-- Open Graph untuk Media Sosial yang Lebih Kaya -->
    <meta property="og:title" content="Green Valley - Solusi Canggih Manajemen Apartemen Anda">
    <meta property="og:description"
        content="Kelola properti apartemen Anda dengan mudah, efisien, dan gaya menggunakan aplikasi Green Valley yang modern dan intuitif.">
    <meta property="og:image"
        content="https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?ixlib=rb-1.2.1&auto=format&fit=crop&w=1200&q=80">
    <!-- Gambar representatif yang menarik -->
    <meta property="og:url" content="https://Green Valley.example.com/"> <!-- Ganti dengan URL asli -->
    <meta property="og:type" content="website">
    <meta property="og:locale" content="id_ID">
    <meta property="og:site_name" content="Green Valley">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Green Valley - Manajemen Apartemen Masa Kini">
    <meta name="twitter:description"
        content="Fitur lengkap, desain memukau, dan performa optimal untuk manajemen apartemen Anda.">
    <meta name="twitter:image"
        content="https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?ixlib=rb-1.2.1&auto=format&fit=crop&w=1200&q=80">

    <!-- Favicon (Emoji sebagai Data URI - Ringan dan Tanpa File Eksternal, menghindari SVG sesuai permintaan ketat) -->
    <!-- Menggunakan emoji sebagai teks sederhana karena permintaan 'tidak boleh SVG'. 
         Alternatif terbaik adalah file .ico atau .png jika diizinkan.
         Data URI SVG adalah kompromi yang baik, tetapi karena dilarang keras:
    -->
    <link rel="icon"
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABFSURBVDhPYxgFo2AUjIJBAAAAAP//sysAAAAAAAAAAAAAAL4EjaAAYRxKAAAAAElFTkSuQmCC">
    <!-- Favicon kotak generik base64 -->
    <!-- Sebenarnya, emoji üè¢ dalam SVG lebih baik: <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè¢</text></svg>"> -->


    <!-- Google Fonts: Inter & Poppins (Fancy & Modern) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <!-- Font Awesome 6 (CDN Gratis untuk Ikon Fancy - versi CSS menggunakan webfont, bukan SVG inject) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* ========== LAYER 0: Reset Canggih & Base Styles ========== */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        html {
            scroll-behavior: smooth;
            font-size: 100%;
            /* 1rem = 16px by default */
            line-height: 1.6;
            text-rendering: optimizeLegibility;
        }

        body {
            font-family: var(--font-secondary);
            background-color: var(--body-bg);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            /* Untuk app-container mengambil tinggi penuh */
            transition: background-color 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), color 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            overflow-x: hidden;
            /* Mencegah scroll horizontal yang tidak diinginkan */
        }

        /* ========== LAYER 1: Custom Properties (Variabel Desain) ========== */
        :root {
            /* Palet Warna Dasar (Hue-Saturation-Lightness untuk fleksibilitas) */
            --hue-primary: 220;
            /* Biru Keunguan Modern */
            --hue-secondary: 260;
            /* Ungu Elegan */
            --hue-accent: 330;
            /* Pinkish-Red untuk Aksen */
            --hue-success: 130;
            --hue-danger: 0;
            --hue-warning: 40;
            --hue-info: 190;

            /* Warna Utama */
            --primary-color: hsl(var(--hue-primary), 75%, 55%);
            --primary-color-light: hsl(var(--hue-primary), 75%, 65%);
            --primary-color-dark: hsl(var(--hue-primary), 75%, 45%);
            --secondary-color: hsl(var(--hue-secondary), 60%, 60%);
            --accent-color: hsl(var(--hue-accent), 80%, 60%);

            /* Warna Netral & Fungsional */
            --success-color: hsl(var(--hue-success), 60%, 45%);
            --danger-color: hsl(var(--hue-danger), 70%, 50%);
            --warning-color: hsl(var(--hue-warning), 85%, 55%);
            --info-color: hsl(var(--hue-info), 70%, 55%);

            /* Gradien Mewah */
            --gradient-primary: linear-gradient(135deg, var(--primary-color), hsl(var(--hue-primary), 80%, 50%));
            --gradient-accent: linear-gradient(135deg, var(--accent-color), hsl(var(--hue-accent), 85%, 50%));
            --gradient-dark-glass: linear-gradient(145deg, hsla(var(--hue-primary), 30%, 20%, 0.8), hsla(var(--hue-primary), 35%, 15%, 0.9));

            /* Tipografi */
            --font-primary: 'Poppins', 'Inter', sans-serif;
            /* Poppins untuk heading, Inter fallback */
            --font-secondary: 'Inter', 'Poppins', sans-serif;
            /* Inter untuk body text */
            --font-size-base: 1rem;
            --font-size-sm: 0.875rem;
            --font-size-lg: 1.25rem;
            --font-size-xl: 1.5rem;
            --font-size-h1: 2.5rem;
            --font-size-h2: 2rem;
            --font-size-h3: 1.75rem;

            /* Spasi & Radius (Konsistensi Geometris) */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-xxl: 3rem;
            --border-radius-sm: 0.375rem;
            /* 6px */
            --border-radius-md: 0.75rem;
            /* 12px */
            --border-radius-lg: 1.25rem;
            /* 20px */
            --border-radius-pill: 50px;

            /* Bayangan (Shadows) - Efek Kedalaman Halus */
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.04);
            --shadow-sm: 0 2px 6px rgba(0, 0, 0, 0.07);
            --shadow-md: 0 5px 15px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.12);
            --shadow-xl: 0 20px 50px rgba(0, 0, 0, 0.15);
            --shadow-inner: inset 0 2px 4px rgba(0, 0, 0, 0.05);

            /* Transisi (Animasi Halus) */
            --transition-fast: 0.2s ease-in-out;
            --transition-base: 0.3s ease-in-out;
            --transition-slow: 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);

            /* Pengaturan Tema Awal (Light) */
            --body-bg: #f8f9fc;
            /* Abu-abu sangat muda */
            --surface-bg: #ffffff;
            /* Putih untuk card, modal */
            --text-color: #343a40;
            /* Abu-abu gelap untuk teks */
            --heading-color: #1a202c;
            /* Hitam lembut untuk judul */
            --muted-color: #6c757d;
            /* Abu-abu untuk teks sekunder */
            --border-color: #e9ecef;
            /* Abu-abu muda untuk border */
            --sidebar-bg: var(--gradient-primary);
            --sidebar-text-color: #ffffff;
            --sidebar-icon-color: #ffffff;
            --sidebar-active-bg: hsla(0, 0%, 100%, 0.15);
            --sidebar-active-indicator: var(--accent-color);
        }

        [data-theme="dark"] {
            --body-bg: #121826;
            /* Biru sangat gelap */
            --surface-bg: #1f2937;
            /* Biru gelap untuk card */
            --text-color: #e5e7eb;
            /* Abu-abu sangat muda untuk teks */
            --heading-color: #f9fafb;
            /* Putih lembut untuk judul */
            --muted-color: #9ca3af;
            /* Abu-abu muda untuk teks sekunder */
            --border-color: #374151;
            /* Abu-abu gelap untuk border */
            --sidebar-bg: var(--gradient-dark-glass);
            /* Gradien gelap untuk sidebar */
            --sidebar-text-color: #e5e7eb;
            --sidebar-icon-color: #e5e7eb;
            --sidebar-active-bg: hsla(var(--hue-primary), 20%, 30%, 0.5);
            --sidebar-active-indicator: var(--primary-color-light);
        }

        /* ========== LAYER 2: Tipografi yang Memanjakan Mata ========== */
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: var(--font-primary);
            color: var(--heading-color);
            font-weight: 700;
            /* Lebih tebal untuk judul */
            line-height: 1.3;
            margin-bottom: var(--spacing-md);
            letter-spacing: -0.02em;
            /* Sedikit merapatkan huruf untuk tampilan modern */
        }

        h1 {
            font-size: var(--font-size-h1);
            font-weight: 800;
        }

        h2 {
            font-size: var(--font-size-h2);
            font-weight: 700;
        }

        h3 {
            font-size: var(--font-size-h3);
            font-weight: 600;
        }

        p {
            margin-bottom: var(--spacing-md);
            color: var(--text-color);
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color var(--transition-fast), transform var(--transition-fast);
        }

        a:hover,
        .router-link:hover {
            color: var(--primary-color-dark);
            text-decoration: underline;
        }

        strong {
            font-weight: 600;
        }

        small {
            font-size: var(--font-size-sm);
            color: var(--muted-color);
        }

        /* ========== LAYER 3: Layout Global & Grid System Sederhana ========== */
        .app-container {
            display: flex;
            width: 100%;
            min-height: 100vh;
            position: relative;
            /* Untuk sidebar fixed */
        }

        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            color: var(--sidebar-text-color);
            padding: var(--spacing-lg) var(--spacing-md);
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            z-index: 1000;
            transition: transform var(--transition-base), width var(--transition-base);
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            /* Jika menu panjang */
        }

        .sidebar__header {
            margin-bottom: var(--spacing-xl);
            padding: 0 var(--spacing-sm);
        }

        .sidebar__brand {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: var(--sidebar-text-color);
            font-size: var(--font-size-xl);
            font-weight: 800;
            /* Brand lebih menonjol */
            font-family: var(--font-primary);
            text-decoration: none;
        }

        .sidebar__brand:hover {
            text-decoration: none;
        }


        .sidebar__brand i {
            font-size: 2rem;
            color: var(--accent-color);
            /* Ikon brand dengan warna aksen */
            transition: transform var(--transition-base);
        }

        .sidebar__brand:hover i {
            transform: rotate(15deg) scale(1.1);
        }

        .sidebar__nav {
            flex-grow: 1;
        }

        .sidebar__nav ul {
            list-style: none;
        }

        .sidebar__nav-link {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md) var(--spacing-lg);
            margin: var(--spacing-xs) 0;
            color: var(--sidebar-text-color);
            border-radius: var(--border-radius-md);
            transition: background-color var(--transition-fast), color var(--transition-fast), padding-left var(--transition-fast), box-shadow var(--transition-fast);
            font-weight: 500;
            position: relative;
            /* Untuk ::before indicator */
            text-decoration: none;
            cursor: pointer;
        }

        .sidebar__nav-link:hover {
            text-decoration: none;
        }


        .sidebar__nav-link i {
            width: 20px;
            /* Jaga alignment ikon */
            text-align: center;
            font-size: 1.1rem;
            color: var(--sidebar-icon-color);
            opacity: 0.8;
            transition: opacity var(--transition-fast), transform var(--transition-fast);
        }

        .sidebar__nav-link:hover,
        .sidebar__nav-link.router-link:hover {
            background-color: var(--sidebar-active-bg);
            color: #fff !important;
            /* Pastikan teks tetap putih di hover */
            padding-left: calc(var(--spacing-lg) + 4px);
            /* Efek geser sedikit */
        }

        .sidebar__nav-link:hover i {
            opacity: 1;
            transform: scale(1.1);
        }

        .sidebar__nav-link.active {
            background-color: var(--sidebar-active-bg);
            font-weight: 600;
            color: #fff !important;
            box-shadow: var(--shadow-sm);
            /* Bayangan halus untuk item aktif */
        }

        .sidebar__nav-link.active::before {
            /* Indikator modern */
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 5px;
            height: 70%;
            background-color: var(--sidebar-active-indicator);
            border-radius: 0 var(--border-radius-sm) var(--border-radius-sm) 0;
        }

        .sidebar__nav-link.active i {
            opacity: 1;
            color: var(--sidebar-active-indicator) !important;
        }

        .sidebar__footer {
            margin-top: auto;
            /* Dorong ke bawah */
            padding-top: var(--spacing-lg);
            border-top: 1px solid hsla(0, 0%, 100%, 0.1);
        }

        .main-content-wrapper {
            /* Wrapper untuk main content dan header */
            flex-grow: 1;
            margin-left: 280px;
            display: flex;
            flex-direction: column;
            transition: margin-left var(--transition-base);
            overflow-x: hidden;
            /* Mencegah konten meluber dan menyebabkan scrollbar horizontal */
        }

        .content-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-md) var(--spacing-lg);
            background-color: var(--surface-bg);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            /* Header tetap terlihat saat scroll */
            top: 0;
            z-index: 900;
            box-shadow: var(--shadow-sm);
            min-height: 70px;
            /* Tinggi minimum header */
        }

        .page-main-title {
            font-size: var(--font-size-xl);
            margin-bottom: 0;
            font-weight: 600;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .user-greeting-text {
            font-size: var(--font-size-sm);
            color: var(--muted-color);
        }

        .page-content-area {
            padding: var(--spacing-lg);
            flex-grow: 1;
            /* Mengisi sisa ruang vertikal */
            overflow-y: auto;
            /* Scroll hanya pada area konten jika perlu */
        }

        .app-footer {
            padding: var(--spacing-md) var(--spacing-lg);
            text-align: center;
            background-color: var(--surface-bg);
            border-top: 1px solid var(--border-color);
            color: var(--muted-color);
            font-size: var(--font-size-sm);
        }

        .app-footer i.fa-heart {
            color: var(--danger-color);
            animation: pulseHeart 1.5s infinite;
        }

        @keyframes pulseHeart {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        /* Grid System Sederhana (Mirip Bootstrap) */
        .container-fluid {
            width: 100%;
            padding-right: var(--spacing-md);
            padding-left: var(--spacing-md);
            margin-right: auto;
            margin-left: auto;
        }

        .grid-container {
            display: grid;
            gap: var(--spacing-lg);
        }

        .columns-1 {
            grid-template-columns: 1fr;
        }

        .columns-2 {
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 300px), 1fr));
        }

        /* Responsif otomatis */
        .columns-3 {
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 280px), 1fr));
        }

        .columns-4 {
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 220px), 1fr));
        }

        .gap-sm {
            gap: var(--spacing-sm);
        }

        .gap-md {
            gap: var(--spacing-md);
        }

        .gap-lg {
            gap: var(--spacing-lg);
        }

        /* Flexbox Utilities */
        .d-flex {
            display: flex !important;
        }

        .align-items-center {
            align-items: center !important;
        }

        .justify-content-between {
            justify-content: space-between !important;
        }

        .justify-content-center {
            justify-content: center !important;
        }

        .flex-column {
            flex-direction: column !important;
        }

        .flex-grow-1 {
            flex-grow: 1 !important;
        }

        .w-100 {
            width: 100% !important;
        }

        .mb-0 {
            margin-bottom: 0 !important;
        }

        .mt-0 {
            margin-top: 0 !important;
        }

        .mt-1 {
            margin-top: var(--spacing-sm) !important;
        }

        .mt-2 {
            margin-top: var(--spacing-md) !important;
        }

        .mt-3 {
            margin-top: var(--spacing-lg) !important;
        }

        .mb-1 {
            margin-bottom: var(--spacing-sm) !important;
        }

        .mb-2 {
            margin-bottom: var(--spacing-md) !important;
        }

        .mb-3 {
            margin-bottom: var(--spacing-lg) !important;
        }


        /* ========== LAYER 4: Komponen UI yang Fancy ========== */
        .card {
            background-color: var(--surface-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            /* Lebih bulat, lebih fancy */
            box-shadow: var(--shadow-md);
            transition: transform var(--transition-base), box-shadow var(--transition-base);
            overflow: hidden;
            /* Untuk gambar di dalam card */
            display: flex;
            flex-direction: column;
            /* Default card layout */
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02);
            /* Efek hover lebih dinamis */
            box-shadow: var(--shadow-xl);
        }

        .card__header,
        .card__body,
        .card__footer {
            padding: var(--spacing-lg);
        }

        .card__header {
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card__title {
            font-size: var(--font-size-lg);
            margin-bottom: 0;
            font-weight: 600;
        }

        .card__body {
            flex-grow: 1;
        }

        /* Agar body mengisi ruang jika card punya tinggi tetap */
        .card__image {
            width: 100%;
            height: 200px;
            /* Atau aspect-ratio jika didukung */
            object-fit: cover;
            /* Gambar tidak terdistorsi */
            border-bottom: 1px solid var(--border-color);
        }

        .card--stat {
            text-align: center;
            padding: var(--spacing-lg);
        }

        .card--stat .stat-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: var(--spacing-md);
            display: block;
            transition: transform var(--transition-base);
        }

        .card--stat:hover .stat-icon {
            transform: scale(1.2) rotate(5deg);
        }

        .card--stat .stat-value {
            font-size: var(--font-size-h2);
            font-weight: 700;
            color: var(--heading-color);
            margin-bottom: var(--spacing-xs);
        }

        .card--stat .stat-label {
            font-size: var(--font-size-sm);
            color: var(--muted-color);
        }

        .btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            /* Padding lebih besar */
            font-family: var(--font-primary);
            font-weight: 600;
            /* Tombol lebih tegas */
            font-size: var(--font-size-base);
            border-radius: var(--border-radius-pill);
            /* Tombol berbentuk pil */
            border: 2px solid transparent;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            text-transform: uppercase;
            /* Opsi: untuk gaya tertentu */
            letter-spacing: 0.05em;
            line-height: 1.5;
            /* Pastikan ikon dan teks sejajar */
            text-decoration: none;
        }

        .btn:hover {
            text-decoration: none;
        }


        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: none;
        }

        .btn i {
            font-size: 1.1em;
        }

        /* Ikon sedikit lebih besar dari teks */

        .btn--primary {
            background: var(--gradient-primary);
            color: #fff;
            border-color: transparent;
        }

        .btn--primary:hover {
            background: linear-gradient(135deg, var(--primary-color-light), var(--primary-color));
            color: #fff;
        }

        .btn--secondary {
            background-color: var(--secondary-color);
            color: #fff;
        }

        .btn--secondary:hover {
            background-color: hsl(var(--hue-secondary), 60%, 50%);
            color: #fff;
        }

        .btn--accent {
            background: var(--gradient-accent);
            color: #fff;
        }

        .btn--accent:hover {
            background: linear-gradient(135deg, hsl(var(--hue-accent), 80%, 65%), hsl(var(--hue-accent), 85%, 55%));
            color: #fff;
        }

        .btn--outline-primary {
            border-color: var(--primary-color);
            color: var(--primary-color);
            background-color: transparent;
        }

        .btn--outline-primary:hover {
            background-color: var(--primary-color);
            color: #fff !important;
        }

        .btn--outline-light {
            border-color: var(--sidebar-text-color);
            color: var(--sidebar-text-color);
            background-color: transparent;
        }

        .btn--outline-light:hover {
            background-color: var(--sidebar-text-color);
            color: var(--sidebar-bg) !important;
        }

        .btn--danger {
            background-color: var(--danger-color);
            color: #fff;
        }

        .btn--danger:hover {
            background-color: hsl(var(--hue-danger), 70%, 40%);
            color: #fff;
        }

        .btn--sm {
            padding: var(--spacing-xs) var(--spacing-md);
            font-size: var(--font-size-sm);
        }

        .btn--lg {
            padding: var(--spacing-md) var(--spacing-xl);
            font-size: var(--font-size-lg);
        }

        .btn-group {
            display: flex;
            gap: var(--spacing-md);
        }

        .btn-group .btn {
            margin-bottom: 0;
            /* Reset margin bottom jika ada dari .btn */
        }

        .btn-close {
            background: transparent;
            border: none;
            font-size: 1.5rem;
            color: var(--muted-color);
            padding: var(--spacing-xs);
            line-height: 1;
            cursor: pointer;
        }

        .btn-close:hover {
            color: var(--heading-color);
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 600;
            color: var(--heading-color);
        }

        .form-control {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-lg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            font-family: var(--font-secondary);
            font-size: var(--font-size-base);
            background-color: var(--surface-bg);
            /* Agar konsisten dengan dark mode */
            color: var(--text-color);
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem hsla(var(--hue-primary), 75%, 55%, 0.25);
            outline: none;
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        .form-control.is-invalid {
            border-color: var(--danger-color);
        }

        .form-control.is-invalid:focus {
            box-shadow: 0 0 0 0.25rem hsla(var(--hue-danger), 70%, 50%, 0.25);
        }

        .invalid-feedback {
            display: none;
            width: 100%;
            margin-top: var(--spacing-xs);
            font-size: var(--font-size-sm);
            color: var(--danger-color);
        }

        .form-control.is-invalid~.invalid-feedback {
            display: block;
        }


        .table-wrapper {
            overflow-x: auto;
            background-color: var(--surface-bg);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-sm);
            margin-top: var(--spacing-lg);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            /* Garis tabel lebih rapi */
            font-size: var(--font-size-base);
            min-width: 600px;
            /* Pastikan tabel tidak terlalu sempit di mobile */
        }

        .table th,
        .table td {
            padding: var(--spacing-md) var(--spacing-lg);
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }

        .table th {
            font-family: var(--font-primary);
            font-weight: 600;
            color: var(--heading-color);
            background-color: hsla(var(--hue-primary), 10%, 95%, 0.5);
            /* Header tabel sedikit berbeda */
            white-space: nowrap;
            /* Judul kolom tidak terpotong */
        }

        [data-theme="dark"] .table th {
            background-color: hsla(var(--hue-primary), 10%, 25%, 0.5);
        }

        .table tbody tr:hover {
            background-color: hsla(var(--hue-primary), 20%, 50%, 0.05);
        }

        [data-theme="dark"] .table tbody tr:hover {
            background-color: hsla(var(--hue-primary), 20%, 20%, 0.2);
        }

        .table td .btn {
            margin-right: var(--spacing-sm);
        }

        /* Jarak antar tombol aksi di tabel */
        .table td .btn:last-child {
            margin-right: 0;
        }

        .table-actions .btn {
            padding: var(--spacing-xs) var(--spacing-sm);
            /* Tombol aksi lebih kecil */
            font-size: var(--font-size-sm);
            text-transform: none;
            /* Tombol aksi tidak uppercase */
            letter-spacing: normal;
        }


        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            /* Vertikal tengah */
            justify-content: center;
            /* Horizontal tengah */
            background-color: rgba(20, 25, 35, 0.7);
            /* Overlay lebih gelap dan modern */
            backdrop-filter: blur(5px);
            /* Efek glassmorphism */
            z-index: 1050;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-base), visibility 0s var(--transition-base);
            padding: var(--spacing-md);
            /* Padding untuk viewport kecil */
        }

        .modal--open {
            opacity: 1;
            visibility: visible;
            transition-delay: 0s;
        }

        .modal__dialog {
            background-color: var(--surface-bg);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 600px;
            /* Lebar modal yang umum */
            overflow: hidden;
            /* Konten tidak meluber dari radius */
            transform: scale(0.95) translateY(20px);
            transition: transform var(--transition-base);
            display: flex;
            flex-direction: column;
            max-height: calc(100vh - (2 * var(--spacing-md)));
            /* Mencegah modal terlalu tinggi di layar kecil */
        }

        .modal--open .modal__dialog {
            transform: scale(1) translateY(0);
        }

        .modal__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
        }

        .modal__title {
            font-size: var(--font-size-lg);
            margin-bottom: 0;
            font-weight: 600;
        }

        .modal__body {
            padding: var(--spacing-lg);
            overflow-y: auto;
            /* Jika konten form panjang */
        }

        .modal__footer {
            padding: var(--spacing-lg);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            /* Tombol ke kanan */
            gap: var(--spacing-md);
            background-color: var(--surface-bg);
            /* Konsistensi background */
        }

        /* Styles for Toasts / Flash Messages / Notifications */
        .notification-area {
            position: fixed;
            top: var(--spacing-lg);
            right: var(--spacing-lg);
            z-index: 1060;
            /* Higher than modal backdrop but lower than modal itself if they overlap, or side by side */
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
            width: 100%;
            max-width: 380px;
        }

        .notification {
            background-color: var(--surface-bg);
            color: var(--text-color);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-md) var(--spacing-lg);
            opacity: 0;
            transform: translateX(100%);
            transition: opacity var(--transition-slow), transform var(--transition-slow);
            border-left: 5px solid var(--primary-color);
            /* Default type indicator */
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-md);
            position: relative;
            /* For absolute positioning of close button */
        }

        .notification i.fas {
            /* Icon for notification type */
            font-size: 1.5rem;
            margin-top: 0.125rem;
            flex-shrink: 0;
        }

        .notification p {
            margin-bottom: 0;
            flex-grow: 1;
        }

        .notification .btn-close {
            /* Close button for notification */
            font-size: 1.2rem;
            padding: 0.2rem;
            color: var(--muted-color);
            background: transparent;
            border: none;
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-sm);
            line-height: 1;
        }

        .notification .btn-close:hover {
            color: var(--heading-color);
        }


        .notification--success {
            border-left-color: var(--success-color);
        }

        .notification--success i.fas {
            color: var(--success-color);
        }

        .notification--danger {
            border-left-color: var(--danger-color);
        }

        .notification--danger i.fas {
            color: var(--danger-color);
        }

        .notification--info {
            border-left-color: var(--info-color);
        }

        .notification--info i.fas {
            color: var(--info-color);
        }

        .notification--warning {
            border-left-color: var(--warning-color);
        }

        .notification--warning i.fas {
            color: var(--warning-color);
        }

        .notification--show {
            opacity: 1;
            transform: translateX(0);
        }


        .placeholder-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 400px;
            /* Agar terlihat jelas */
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            color: var(--muted-color);
            background-color: var(--surface-bg);
        }

        .placeholder-content i {
            font-size: 4rem;
            margin-bottom: var(--spacing-lg);
            color: var(--primary-color-light);
        }

        .placeholder-content h3 {
            color: var(--heading-color);
            margin-bottom: var(--spacing-sm);
        }

        .placeholder-content p {
            max-width: 500px;
        }


        /* ========== LAYER 5: Responsivitas Cerdas ========== */
        /* Styles for Off-Canvas (Sidebar) Toggler */
        .sidebar-toggler {
            display: none;
            /* Sembunyikan di layar besar */
            font-size: 1.5rem;
            background: transparent;
            border: none;
            color: var(--heading-color);
            padding: var(--spacing-sm);
            z-index: 1001;
            /* Di atas sidebar saat tertutup */
            margin-right: var(--spacing-md);
            cursor: pointer;
        }

        @media (max-width: 991.98px) {

            /* Tablet dan di bawahnya */
            /* Off-Canvas (Sidebar) behavior */
            .sidebar {
                transform: translateX(-100%);
                box-shadow: none;
                /* Hilangkan shadow saat tersembunyi */
            }

            .sidebar--active {
                /* This class makes the off-canvas sidebar visible */
                transform: translateX(0);
                box-shadow: var(--shadow-lg);
                /* Tampilkan shadow saat aktif */
            }

            .main-content-wrapper {
                margin-left: 0;
                /* Content takes full width when sidebar is off-canvas */
                width: 100%;
            }

            .sidebar-toggler {
                /* Show the button to open the off-canvas sidebar */
                display: block;
            }

            .page-main-title {
                font-size: var(--font-size-lg);
                margin-left: 0;
            }

            .user-actions .btn span {
                display: none;
            }

            .user-actions .btn i {
                margin-right: 0;
            }

            .user-greeting-text {
                display: none;
            }

            .grid-container.columns-3,
            .grid-container.columns-4 {
                grid-template-columns: repeat(auto-fit, minmax(min(100%, 250px), 1fr));
            }

            .columns-2 {
                grid-template-columns: 1fr;
            }

            .card--stat {
                margin-bottom: var(--spacing-md);
            }

            /* Adjust notification area for smaller screens */
            .notification-area {
                right: var(--spacing-md);
                left: var(--spacing-md);
                width: auto;
                max-width: none;
            }
        }

        @media (max-width: 767.98px) {

            /* Mobile */
            :root {
                --font-size-h1: 2rem;
                --font-size-h2: 1.75rem;
                --font-size-h3: 1.5rem;
                --font-size-lg: 1.125rem;
                --font-size-base: 0.9375rem;
            }

            .content-header {
                padding-left: var(--spacing-md);
                padding-right: var(--spacing-md);
            }

            .page-content-area {
                padding: var(--spacing-md);
            }

            .app-footer {
                padding-left: var(--spacing-md);
                padding-right: var(--spacing-md);
            }

            .btn-group {
                flex-direction: column;
                align-items: stretch;
            }

            .btn-group .btn {
                width: 100%;
                margin-bottom: var(--spacing-sm);
            }

            .btn-group .btn:last-child {
                margin-bottom: 0;
            }

            .modal__dialog {
                width: calc(100% - (2 * var(--spacing-sm)));
                margin: var(--spacing-sm);
                max-height: calc(100vh - (2 * var(--spacing-sm)));
            }

            .table th,
            .table td {
                padding: var(--spacing-sm) var(--spacing-md);
            }

            .table {
                font-size: var(--font-size-sm);
            }

            .table-actions .btn {
                margin-bottom: var(--spacing-xs);
            }

            #landing-page-content .hero-banner__title {
                font-size: 2.2rem !important;
            }

            #landing-page-content .lead {
                font-size: 1.1rem !important;
            }

            .grid-container.columns-3,
            .grid-container.columns-4 {
                grid-template-columns: 1fr;
            }
        }


        /* ========== LAYER 6: Animasi & Efek Visual Halus ========== */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.6s var(--transition-slow) both;
        }

        .animate-fade-in-delay-1 {
            animation-delay: 0.1s;
        }

        .animate-fade-in-delay-2 {
            animation-delay: 0.2s;
        }

        .animate-fade-in-delay-3 {
            animation-delay: 0.3s;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-slide-in-up {
            animation: slideInUp 0.5s var(--transition-slow) both;
        }

        .hero-banner__title.animate-text-focus-in {
            animation: text-focus-in 1s cubic-bezier(0.550, 0.085, 0.680, 0.530) 0.2s both;
        }

        @keyframes text-focus-in {
            0% {
                filter: blur(12px);
                opacity: 0;
            }

            100% {
                filter: blur(0px);
                opacity: 1;
            }
        }

        .spinner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0s 0.3s;
        }

        .spinner-overlay.show {
            opacity: 1;
            visibility: visible;
            transition-delay: 0s;
        }

        .spinner {
            border: 4px solid hsla(var(--hue-primary), 20%, 80%, .3);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        [data-theme="dark"] .spinner {
            border: 4px solid hsla(var(--hue-primary), 20%, 30%, .3);
            border-top-color: var(--primary-color-light);
        }

        @keyframes spin {
            to {
                transform: rotate(300deg);
            }
        }

        .tabs-container {
            margin-bottom: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            gap: var(--spacing-xs);
        }

        .tab-button {
            padding: var(--spacing-sm) var(--spacing-lg);
            cursor: pointer;
            border: none;
            background-color: transparent;
            font-family: var(--font-primary);
            font-weight: 600;
            color: var(--muted-color);
            border-bottom: 3px solid transparent;
            transition: color var(--transition-fast), border-color var(--transition-fast);
            border-radius: var(--border-radius-sm) var(--border-radius-sm) 0 0;
        }

        .tab-button:hover {
            color: var(--primary-color);
        }

        .tab-button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s var(--transition-base) both;
        }
    </style>
</head>

<body data-theme="light">
    <div class="app-container">
        <!-- Sidebar (Off-Canvas on smaller screens) -->
        <aside class="sidebar" id="app-sidebar" aria-label="Main Navigation">
            <div class="sidebar__header">
                <a href="#landing" class="sidebar__brand router-link" data-page="landing">
                    <i class="fas fa-building-columns"></i>
                    <span>Green Valley</span>
                </a>
            </div>
            <nav class="sidebar__nav">
                <ul>
                    <li><a href="#landing" class="sidebar__nav-link router-link active" data-page="landing"><i
                                class="fas fa-home-lg-alt"></i> Halaman Utama</a></li>
                    <li><a href="#dashboard" class="sidebar__nav-link router-link" data-page="dashboard"><i
                                class="fas fa-tachometer-alt-fast"></i> Dashboard Utama</a></li>
                    <li><a href="#apartments" class="sidebar__nav-link router-link" data-page="apartments"><i
                                class="fas fa-city"></i> Galeri Apartemen</a></li>
                    <li><a href="#crud" class="sidebar__nav-link router-link" data-page="crud"><i
                                class="fas fa-edit"></i> Manajemen Data</a></li>
                    <li><a href="#dashboard_analytics" class="sidebar__nav-link router-link"
                            data-page="dashboard_analytics"><i class="fas fa-chart-pie-alt"></i> Dashboard Analitik</a>
                    </li>
                    <li><a href="#documentation" class="sidebar__nav-link router-link" data-page="documentation"><i
                                class="fas fa-book-open-reader"></i> Dokumentasi</a></li>

                </ul>
            </nav>
            <div class="sidebar__footer">
                <button class="btn btn--outline-light w-100" id="theme-toggle-btn" aria-label="Ganti Tema">
                    <i class="fas fa-moon"></i> <span id="theme-toggle-text">Tema Gelap</span>
                </button>
            </div>
        </aside>

        <div class="main-content-wrapper">
            <header class="content-header">
                <!-- Button to toggle Off-Canvas Sidebar -->
                <button class="btn sidebar-toggler" id="sidebar-toggle-btn" aria-label="Toggle Sidebar"
                    aria-expanded="false" aria-controls="app-sidebar">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 id="page-title" class="page-main-title">Halaman Utama</h1>
                <div class="user-actions">
                    <span id="user-greeting" class="user-greeting-text">Halo, Admin GreenValley!</span>
                    <button class="btn btn--outline-primary btn--sm" id="logout-btn" title="Keluar dari Aplikasi">
                        <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
                    </button>
                </div>
            </header>

            <main id="app-content" class="page-content-area">
                <!-- Dynamic content loaded here -->
            </main>

            <footer class="app-footer">
                <p>¬© <span id="current-year"></span> Green Valley. Dibuat dengan <i class="fas fa-heart"></i> oleh Tim
                    Pengembang Ahli.</p>
            </footer>
        </div>
    </div>

    <!-- Modal (Used for Alerts, Confirmations, Forms) -->
    <div class="modal" id="app-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-hidden="true">
        <div class="modal__dialog">
            <div class="modal__header">
                <h2 class="modal__title" id="modal-title">Judul Modal</h2>
                <button type="button" class="btn-close" data-dismiss="modal" aria-label="Tutup Modal"><i
                        class="fas fa-times"></i></button>
            </div>
            <div class="modal__body" id="modal-body-content">
                <!-- Dynamic modal content -->
            </div>
            <div class="modal__footer" id="modal-footer-content">
                <!-- Dynamic modal buttons -->
            </div>
        </div>
    </div>

    <!-- Notification Area (For Toasts / Flash Messages) -->
    <div class="notification-area" id="notification-container" aria-live="assertive">
        <!-- Notifications appear here -->
    </div>

    <!-- Spinner Overlay -->
    <div class="spinner-overlay" id="spinner-overlay">
        <div class="spinner"></div>
    </div>

    <script>
        (function () {
            'use strict';

            /**
             * RENTAL APARTEMEN - APLIKASI MANAJEMEN APARTEMEN MODERN
             * Dibuat murni dengan Vanilla JavaScript, HTML, dan CSS.
             * Fitur: SPA, CRUD, Tema Terang/Gelap, Responsif, Desain Fancy.
             *
             * Struktur Kode:
             * 1. STATE MANAGEMENT: `appState` untuk menyimpan data global aplikasi.
             * 2. DOM CACHE: `DOM` untuk menyimpan referensi elemen HTML yang sering diakses.
             * 3. UTILITIES: `utils` berisi fungsi-fungsi pembantu umum.
             * 4. UI MANAGER: `ui` mengelola semua interaksi dan pembaruan antarmuka pengguna.
             *    - Implements Toast/Flash Messages via `ui.showNotification`.
             *    - Implements Alerts/Confirmations via `ui.openModal`.
             *    - Implements Off-Canvas Sidebar via `ui.toggleSidebar`.
             * 5. PAGE RENDERERS: `pageRenderers` berisi fungsi untuk membuat konten setiap halaman.
             * 6. CRUD OPERATIONS: `crudOperations` untuk logika Tambah, Baca, Ubah, Hapus data.
             * 7. ROUTER: Mengelola navigasi antar halaman dalam SPA.
             * 8. EVENT LISTENERS: Menangani interaksi pengguna.
             * 9. INITIALIZATION: `init()` untuk memulai aplikasi.
             */

            // ========== 1. STATE MANAGEMENT ==========
            const appState = {
                theme: localStorage.getItem('Green ValleyTheme') || 'light',
                currentPage: 'landing',
                isSidebarOpen: window.innerWidth > 991.98, // For Off-Canvas state
                isModalOpen: false, // For Alert/Modal state
                currentUser: { name: 'Admin GreenValley' },
                data: {
                    apartments: [
                        { id: 'apt001', name: 'The Starlight Suite', type: '2BR', price: 12000000, status: 'Tersedia', image: 'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60', details: 'Apartemen 2 kamar tidur mewah dengan pemandangan kota dan fasilitas modern.' },
                        { id: 'apt002', name: 'Urban Oasis Loft', type: 'Studio', price: 7500000, status: 'Tersewa', image: 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60', details: 'Studio modern di pusat kota, cocok untuk profesional muda. Fasilitas lengkap termasuk gym dan kolam renang.' },
                        { id: 'apt003', name: 'Green Valley Penthouse', type: '3BR + Pool', price: 25000000, status: 'Tersedia', image: 'https://images.unsplash.com/photo-1493809842364-78817add7ffb?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60', details: 'Penthouse eksklusif dengan 3 kamar tidur, kolam renang pribadi, dan layanan concierge 24 jam.' },
                        { id: 'apt004', name: 'Skyview Residence', type: '1BR', price: 9500000, status: 'Tersedia', image: 'https://images.unsplash.com/photo-1501183638710-841dd1904471?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60', details: 'Apartemen 1 kamar tidur dengan balkon luas dan pemandangan cakrawala kota.' },
                    ],
                    tenants: [
                        { id: 'ten001', name: 'Budi Santoso', unitId: 'apt002', phone: '081234567890', entryDate: '2023-01-15', email: 'budi.s@example.com' },
                        { id: 'ten002', name: 'Citra Lestari', unitId: 'apt001', phone: '085678901234', entryDate: '2023-05-20', email: 'citra.l@example.com' }
                    ],
                },
                editingItemId: null,
                currentCrudTab: 'apartments',
            };

            // ========== 2. DOM CACHE ==========
            const DOM = {
                html: document.documentElement,
                body: document.body,
                sidebar: document.getElementById('app-sidebar'), // Off-Canvas element
                mainContentWrapper: document.querySelector('.main-content-wrapper'),
                pageTitle: document.getElementById('page-title'),
                appContent: document.getElementById('app-content'),
                themeToggleButton: document.getElementById('theme-toggle-btn'),
                themeToggleText: document.getElementById('theme-toggle-text'),
                sidebarToggleButton: document.getElementById('sidebar-toggle-btn'), // Toggles Off-Canvas
                navLinks: document.querySelectorAll('.sidebar__nav-link.router-link'),
                userGreeting: document.getElementById('user-greeting'),
                currentYearSpan: document.getElementById('current-year'),
                modal: document.getElementById('app-modal'), // Alert/Modal element
                modalTitle: document.getElementById('modal-title'),
                modalBody: document.getElementById('modal-body-content'),
                modalFooter: document.getElementById('modal-footer-content'),
                notificationContainer: document.getElementById('notification-container'), // Toast/Flash Message container
                logoutButton: document.getElementById('logout-btn'),
                spinnerOverlay: document.getElementById('spinner-overlay'),
            };

            // ========== 3. UTILITIES ==========
            const utils = {
                escapeHTML(str) {
                    if (str === null || typeof str === 'undefined') return '';
                    return String(str).replace(/[&<>"']/g, m => ({
                        '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'
                    })[m]);
                },
                formatCurrency(amount, currency = 'IDR') {
                    return new Intl.NumberFormat('id-ID', {
                        style: 'currency', currency: currency, minimumFractionDigits: 0
                    }).format(amount);
                },
                formatDate(dateString) {
                    if (!dateString) return '-';
                    const options = { year: 'numeric', month: 'long', day: 'numeric' };
                    return new Date(dateString).toLocaleDateString('id-ID', options);
                },
                generateId(prefix = 'id') {
                    return `${prefix}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                },
                getFormData(formElement) {
                    const formData = new FormData(formElement);
                    const data = {};
                    for (const [key, value] of formData.entries()) {
                        data[key] = typeof value === 'string' ? value.trim() : value;
                    }
                    return data;
                },
                validateURL(url) {
                    try {
                        new URL(url);
                        return /\.(jpeg|jpg|gif|png|webp)$/i.test(url);
                    } catch {
                        return false;
                    }
                },
                showLoading() {
                    if (DOM.spinnerOverlay) DOM.spinnerOverlay.classList.add('show');
                },
                hideLoading() {
                    if (DOM.spinnerOverlay) DOM.spinnerOverlay.classList.remove('show');
                },
                debounce(func, delay) {
                    let timeout;
                    return function (...args) {
                        clearTimeout(timeout);
                        timeout = setTimeout(() => func.apply(this, args), delay);
                    };
                }
            };

            // ========== 4. UI MANAGER ==========
            const ui = {
                setTheme(theme) {
                    DOM.body.setAttribute('data-theme', theme);
                    appState.theme = theme;
                    localStorage.setItem('Green ValleyTheme', theme);
                    const iconClass = theme === 'dark' ? 'fa-sun' : 'fa-moon';
                    const text = theme === 'dark' ? 'Tema Terang' : 'Tema Gelap';
                    if (DOM.themeToggleButton) {
                        DOM.themeToggleButton.querySelector('i').className = `fas ${iconClass}`;
                    }
                    if (DOM.themeToggleText) {
                        DOM.themeToggleText.textContent = text;
                    }
                },
                // Off-Canvas Sidebar Management
                toggleSidebar(forceOpen = null) {
                    const shouldBeOpen = forceOpen !== null ? forceOpen : !appState.isSidebarOpen;

                    if (appState.isSidebarOpen !== shouldBeOpen) {
                        appState.isSidebarOpen = shouldBeOpen;
                        if (DOM.sidebar) {
                            DOM.sidebar.classList.toggle('sidebar--active', appState.isSidebarOpen);
                        }
                        if (DOM.sidebarToggleButton) {
                            DOM.sidebarToggleButton.setAttribute('aria-expanded', appState.isSidebarOpen);
                        }
                        if (window.innerWidth > 991.98 && DOM.mainContentWrapper) {
                            DOM.mainContentWrapper.style.marginLeft = appState.isSidebarOpen ? '280px' : '0';
                        } else if (DOM.mainContentWrapper) { // For smaller screens, ensure margin is 0 when sidebar state changes
                            DOM.mainContentWrapper.style.marginLeft = '0';
                        }
                    }
                },
                updateActiveNavLink(pageId) {
                    DOM.navLinks.forEach(link => {
                        link.classList.toggle('active', link.dataset.page === pageId);
                    });
                },
                // Toast / Flash Message Implementation
                showNotification(message, type = 'info', duration = 5000) {
                    if (!DOM.notificationContainer) return;
                    const notifId = utils.generateId('notif');
                    const notification = document.createElement('div');
                    notification.id = notifId;
                    notification.className = `notification notification--${type}`;
                    notification.setAttribute('role', 'alert');

                    let iconClass = 'fa-info-circle';
                    if (type === 'success') iconClass = 'fa-check-circle';
                    else if (type === 'danger') iconClass = 'fa-exclamation-triangle';
                    else if (type === 'warning') iconClass = 'fa-exclamation-circle';

                    notification.innerHTML = `
                    <i class="fas ${iconClass}"></i>
                    <p>${utils.escapeHTML(message)}</p>
                    <button class="btn-close" data-dismiss-notification="${notifId}" aria-label="Tutup Notifikasi">&times;</button>
                `;

                    const closeButton = notification.querySelector(`[data-dismiss-notification="${notifId}"]`);
                    let timerId;

                    const removeNotification = () => {
                        clearTimeout(timerId);
                        notification.classList.remove('notification--show');
                        if (closeButton) closeButton.removeEventListener('click', removeNotification);
                        setTimeout(() => notification.remove(), 500);
                    };

                    if (closeButton) closeButton.addEventListener('click', removeNotification);

                    DOM.notificationContainer.appendChild(notification);
                    requestAnimationFrame(() => {
                        notification.classList.add('notification--show');
                    });

                    timerId = setTimeout(removeNotification, duration);
                },
                // Alert / Modal Implementation
                openModal(title, bodyContent, footerContentHTML = null) {
                    if (!DOM.modal) return;
                    DOM.modalTitle.textContent = utils.escapeHTML(title);
                    DOM.modalBody.innerHTML = '';
                    if (typeof bodyContent === 'string') {
                        DOM.modalBody.innerHTML = bodyContent;
                    } else if (bodyContent instanceof HTMLElement) {
                        DOM.modalBody.appendChild(bodyContent);
                    }

                    DOM.modalFooter.innerHTML = '';
                    if (footerContentHTML) {
                        DOM.modalFooter.innerHTML = footerContentHTML;
                    } else {
                        DOM.modalFooter.innerHTML = `
                        <button type="button" class="btn btn--outline-primary" data-dismiss="modal">Batal</button>
                        <button type="submit" class="btn btn--primary" id="modal-confirm-btn-dynamic">Simpan</button>
                    `;
                    }

                    DOM.modal.classList.add('modal--open');
                    DOM.modal.setAttribute('aria-hidden', 'false');
                    appState.isModalOpen = true;
                    document.body.style.overflow = 'hidden';

                    const modalCloseElements = DOM.modal.querySelectorAll('[data-dismiss="modal"], .modal__header .btn-close');
                    modalCloseElements.forEach(el => {
                        const newEl = el.cloneNode(true); // Simple way to remove old listeners
                        el.parentNode.replaceChild(newEl, el);
                        newEl.addEventListener('click', ui.closeModal);
                    });

                    const focusableElements = DOM.modal.querySelectorAll(
                        'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
                    );
                    if (focusableElements.length > 0) {
                        focusableElements[0].focus();
                    }
                },
                closeModal() {
                    if (!appState.isModalOpen || !DOM.modal) return;

                    DOM.modal.classList.remove('modal--open');
                    DOM.modal.setAttribute('aria-hidden', 'true');
                    appState.isModalOpen = false;
                    document.body.style.overflow = '';

                    DOM.modalTitle.textContent = '';
                    DOM.modalBody.innerHTML = '';
                    DOM.modalFooter.innerHTML = '';
                    appState.editingItemId = null;
                },
                renderPageContent(pageId, contentElementOrHTML) {
                    DOM.appContent.innerHTML = '';
                    if (typeof contentElementOrHTML === 'string') {
                        DOM.appContent.innerHTML = contentElementOrHTML;
                    } else if (contentElementOrHTML instanceof HTMLElement) {
                        DOM.appContent.appendChild(contentElementOrHTML);
                    }
                    DOM.appContent.classList.remove('animate-fade-in');
                    void DOM.appContent.offsetWidth;
                    DOM.appContent.classList.add('animate-fade-in');

                    DOM.appContent.scrollTop = 0;
                    if (DOM.mainContentWrapper) DOM.mainContentWrapper.scrollTop = 0;
                },
                updateGreeting() {
                    if (DOM.userGreeting) {
                        if (appState.currentUser && appState.currentUser.name) {
                            DOM.userGreeting.textContent = `Halo, ${utils.escapeHTML(appState.currentUser.name)}!`;
                        } else {
                            DOM.userGreeting.textContent = 'Halo, Pengguna!';
                        }
                    }
                },
                updateCurrentYear() {
                    if (DOM.currentYearSpan) {
                        DOM.currentYearSpan.textContent = new Date().getFullYear();
                    }
                }
            };

            // ========== 5. PAGE RENDERERS ==========
            const pageRenderers = {
                _createPlaceholderPage(title, iconClass = "fa-puzzle-piece", message = "Konten untuk halaman ini sedang dalam pengembangan atau belum tersedia.") {
                    const el = document.createElement('div');
                    el.className = 'placeholder-content animate-slide-in-up';
                    el.innerHTML = `
                    <i class="fas ${iconClass}"></i>
                    <h3>${utils.escapeHTML(title)}</h3>
                    <p>${utils.escapeHTML(message)}</p>
                    <p><small>Silakan periksa kembali nanti atau pilih menu lain.</small></p>
                `;
                    return el;
                },
                landing() {
                    const section = document.createElement('section');
                    section.id = 'landing-page-content';
                    section.innerHTML = `
                    <div class="card" style="background: var(--gradient-primary); color: white; text-align: center; padding: var(--spacing-xxl) var(--spacing-lg); border: none;">
                        <i class="fas fa-building-user fa-4x animate-fade-in" style="margin-bottom: var(--spacing-lg); color: var(--accent-color); text-shadow: 0 2px 4px rgba(0,0,0,0.2);"></i>
                        <h1 class="hero-banner__title animate-text-focus-in" style="color: white; font-size: clamp(2rem, 5vw, 2.8rem); margin-bottom: var(--spacing-sm);">Selamat Datang di Green Valley</h1>
                        <p class="lead animate-fade-in" style="animation-delay: 0.3s; color: hsla(0,0%,100%,0.85); font-size: clamp(1rem, 2.5vw, 1.3rem); max-width: 700px; margin: 0 auto var(--spacing-xl) auto;">
                            Platform canggih untuk manajemen penyewaan apartemen Green Valley. Modern, intuitif, dan penuh gaya.
                        </p>
                        <div class="btn-group animate-fade-in" style="animation-delay: 0.5s; justify-content: center;">
                            <a href="#apartments" class="btn btn--accent btn--lg router-link" data-page="apartments"><i class="fas fa-search-location"></i> Jelajahi Unit</a>
                            <a href="#dashboard" class="btn btn--outline-light btn--lg router-link" data-page="dashboard"><i class="fas fa-columns"></i> Masuk Dashboard</a>
                        </div>
                    </div>
                    <h2 style="text-align:center; margin-top: var(--spacing-xxl); margin-bottom: var(--spacing-lg);">Fitur Unggulan Kami</h2>
                    <div class="grid-container columns-3 gap-lg">
                        <div class="card feature-card animate-slide-in-up">
                            <div class="card__body" style="text-align:center;">
                                <i class="fas fa-cogs fa-3x" style="color: var(--primary-color); margin-bottom: 1rem;"></i>
                                <h3 class="card__title mb-1">Manajemen Intuitif</h3>
                                <p class="mb-0">Kelola unit, penyewa, dan pembayaran dengan antarmuka yang bersih dan mudah digunakan.</p>
                            </div>
                        </div>
                        <div class="card feature-card animate-slide-in-up" style="animation-delay: 0.15s;">
                            <div class="card__body" style="text-align:center;">
                                <i class="fas fa-shield-alt fa-3x" style="color: var(--success-color); margin-bottom: 1rem;"></i>
                                <h3 class="card__title mb-1">Keamanan Terdepan</h3>
                                <p class="mb-0">Data Anda terlindungi dengan praktik terbaik (simulasi untuk aplikasi frontend murni).</p>
                            </div>
                        </div>
                        <div class="card feature-card animate-slide-in-up" style="animation-delay: 0.3s;">
                            <div class="card__body" style="text-align:center;">
                                <i class="fas fa-mobile-alt fa-3x" style="color: var(--info-color); margin-bottom: 1rem;"></i>
                                <h3 class="card__title mb-1">Akses Responsif</h3>
                                <p class="mb-0">Nikmati pengalaman yang mulus di semua perangkat, dari desktop hingga mobile.</p>
                            </div>
                        </div>
                    </div>
                `;
                    return section;
                },
                dashboard() {
                    const totalApartments = appState.data.apartments.length;
                    const availableApartments = appState.data.apartments.filter(apt => apt.status === 'Tersedia').length;
                    const totalTenants = appState.data.tenants.length;

                    const section = document.createElement('section');
                    section.id = 'dashboard-content';
                    section.innerHTML = `
                    <div class="grid-container columns-3 gap-lg">
                        <div class="card card--stat animate-fade-in">
                            <i class="stat-icon fas fa-city"></i>
                            <div class="stat-value">${totalApartments}</div>
                            <div class="stat-label">Total Unit Apartemen</div>
                        </div>
                        <div class="card card--stat animate-fade-in" style="animation-delay: 0.1s;">
                            <i class="stat-icon fas fa-door-open" style="color: var(--success-color);"></i>
                            <div class="stat-value">${availableApartments}</div>
                            <div class="stat-label">Unit Tersedia</div>
                        </div>
                        <div class="card card--stat animate-fade-in" style="animation-delay: 0.2s;">
                            <i class="stat-icon fas fa-users" style="color: var(--info-color);"></i>
                            <div class="stat-value">${totalTenants}</div>
                            <div class="stat-label">Total Penyewa Aktif</div>
                        </div>
                    </div>
                    <div class="card animate-fade-in" style="margin-top: var(--spacing-xl); animation-delay: 0.3s;">
                        <div class="card__header"><h3 class="card__title mb-0">Ringkasan Aktivitas</h3></div>
                        <div class="card__body">
                            <p>Selamat datang kembali di dashboard Green Valley! Di sini Anda dapat melihat ringkasan cepat operasional properti Anda.</p>
                            <ul class="mb-0">
                                <li><strong>Pembaruan Terkini:</strong> Fungsionalitas CRUD dasar untuk apartemen dan penyewa telah ditambahkan.</li>
                                <li><strong>Perlu Perhatian:</strong> Ada <strong>${appState.data.apartments.length - availableApartments} unit</strong> yang saat ini tersewa.</li>
                                <li><strong>Tips:</strong> Gunakan halaman 'Manajemen Data' untuk menambah atau mengubah detail apartemen dan penyewa.</li>
                            </ul>
                        </div>
                    </div>
                     <div class="card animate-fade-in" style="margin-top: var(--spacing-xl); animation-delay: 0.4s;">
                        <div class="card__header"><h3 class="card__title mb-0">Pemberitahuan Penting</h3></div>
                        <div class="card__body">
                            <p class="mb-0">Aplikasi ini adalah versi demo yang berjalan sepenuhnya di sisi klien (browser Anda). Tidak ada data yang disimpan secara permanen di server.</p>
                        </div>
                    </div>
                `;
                    return section;
                },
                apartments() {
                    const section = document.createElement('div');
                    section.id = 'apartments-gallery';
                    section.className = 'grid-container columns-3 gap-lg';

                    if (appState.data.apartments.length === 0) {
                        section.innerHTML = `<p class="col-span-full" style="grid-column: 1 / -1;">Belum ada data apartemen. Silakan tambahkan melalui Manajemen Data.</p>`;
                    } else {
                        appState.data.apartments.forEach((apt, index) => {
                            const card = document.createElement('div');
                            card.className = 'card animate-slide-in-up';
                            card.style.animationDelay = `${index * 0.075}s`;
                            card.innerHTML = `
                            <img src="${utils.escapeHTML(apt.image) || 'https://via.placeholder.com/400x200.png?text=Gambar+Apartemen'}" alt="Foto ${utils.escapeHTML(apt.name)}" class="card__image">
                            <div class="card__body">
                                <h3 class="card__title" style="margin-bottom: var(--spacing-xs);">${utils.escapeHTML(apt.name)}</h3>
                                <p style="color: var(--muted-color); font-size: var(--font-size-sm); margin-bottom: var(--spacing-sm);">Tipe: ${utils.escapeHTML(apt.type)} &bull; Status: <span style="font-weight: bold; color: ${apt.status === 'Tersedia' ? 'var(--success-color)' : 'var(--danger-color)'}">${utils.escapeHTML(apt.status)}</span></p>
                                <p style="font-weight: bold; color: var(--primary-color); font-size: 1.125rem; margin-bottom: var(--spacing-md);">${utils.formatCurrency(apt.price)} / bulan</p>
                                <p style="font-size: var(--font-size-sm); margin-bottom:0;"><small>${utils.escapeHTML(apt.details.substring(0, 120))}...</small></p>
                            </div>
                            <div class="card__footer" style="text-align: center; padding-top: var(--spacing-sm); padding-bottom: var(--spacing-md);">
                                <button class="btn btn--sm btn--primary view-apartment-details-btn" data-apartment-id="${apt.id}"><i class="fas fa-eye"></i> Lihat Detail</button>
                            </div>
                        `;
                            section.appendChild(card);
                        });
                    }
                    return section;
                },
                crud() { return crudOperations.renderCrudPage(); },
                documentation() {
                    return pageRenderers._createPlaceholderPage(
                        "Dokumentasi Aplikasi",
                        "fa-book-open-reader",
                        "Halaman ini akan berisi panduan penggunaan aplikasi Green Valley, penjelasan fitur, serta informasi teknis bagi pengembang. Nantikan pembaruan selanjutnya!"
                    );
                },
                dashboard_analytics() {
                    const section = document.createElement('section');
                    section.id = 'analytics-dashboard-content';

                    const availableCount = appState.data.apartments.filter(a => a.status === 'Tersedia').length;
                    const rentedCount = appState.data.apartments.length - availableCount;
                    const totalApartments = appState.data.apartments.length;

                    const availablePercent = totalApartments > 0 ? (availableCount / totalApartments) * 100 : 0;
                    const rentedPercent = totalApartments > 0 ? (rentedCount / totalApartments) * 100 : 0;

                    section.innerHTML = `
                    <div class="grid-container columns-2 gap-lg">
                        <div class="card animate-slide-in-up">
                            <div class="card__header">
                                <h3 class="card__title mb-0">Status Unit Apartemen</h3>
                            </div>
                            <div class="card__body">
                                ${totalApartments === 0 ? '<p>Belum ada data apartemen untuk dianalisis.</p>' : `
                                <p>Total Unit: <strong>${totalApartments}</strong></p>
                                <div style="margin-bottom: var(--spacing-sm);">
                                    <div style="display: flex; justify-content: space-between; font-size: var(--font-size-sm); margin-bottom: var(--spacing-xs);">
                                        <span>Tersedia (${availableCount})</span>
                                        <span>${availablePercent.toFixed(1)}%</span>
                                    </div>
                                    <div style="background-color: var(--border-color); border-radius: var(--border-radius-pill); overflow: hidden; height: 20px;">
                                        <div style="width: ${availablePercent}%; background-color: var(--success-color); height: 100%; transition: width 0.5s ease-out;"></div>
                                    </div>
                                </div>
                                <div>
                                    <div style="display: flex; justify-content: space-between; font-size: var(--font-size-sm); margin-bottom: var(--spacing-xs);">
                                        <span>Tersewa (${rentedCount})</span>
                                        <span>${rentedPercent.toFixed(1)}%</span>
                                    </div>
                                    <div style="background-color: var(--border-color); border-radius: var(--border-radius-pill); overflow: hidden; height: 20px;">
                                        <div style="width: ${rentedPercent}%; background-color: var(--danger-color); height: 100%; transition: width 0.5s ease-out;"></div>
                                    </div>
                                </div>
                                `}
                            </div>
                        </div>
                         <div class="card animate-slide-in-up" style="animation-delay: 0.1s;">
                            <div class="card__header">
                                <h3 class="card__title mb-0">Analisis Harga Sewa (Contoh)</h3>
                            </div>
                            <div class="card__body">
                                ${totalApartments === 0 ? '<p>Belum ada data harga untuk dianalisis.</p>' : `
                                <p>Harga Rata-rata: <strong>${utils.formatCurrency(appState.data.apartments.reduce((sum, apt) => sum + apt.price, 0) / totalApartments)}</strong></p>
                                <p>Harga Tertinggi: <strong>${utils.formatCurrency(Math.max(...appState.data.apartments.map(apt => apt.price)))}</strong></p>
                                <p>Harga Terendah: <strong>${utils.formatCurrency(Math.min(...appState.data.apartments.map(apt => apt.price)))}</strong></p>
                                `}
                            </div>
                        </div>
                    </div>
                    <div class="placeholder-content animate-slide-in-up mt-3" style="animation-delay: 0.2s;">
                        <i class="fas fa-chart-line"></i>
                        <h3>Grafik Lebih Lanjut Segera Hadir</h3>
                        <p>Visualisasi data yang lebih canggih seperti tren penyewaan, pendapatan per periode, dan demografi penyewa akan ditambahkan di versi mendatang.</p>
                    </div>
                `;
                    return section;
                }
            };

            // ========== 6. CRUD OPERATIONS ==========
            const crudOperations = {
                renderCrudPage() {
                    const pageContainer = document.createElement('div');
                    pageContainer.id = 'crud-management-page';
                    pageContainer.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="tabs-container">
                            <button class="tab-button ${appState.currentCrudTab === 'apartments' ? 'active' : ''}" data-tab="apartments">
                                <i class="fas fa-building"></i> Apartemen
                            </button>
                            <button class="tab-button ${appState.currentCrudTab === 'tenants' ? 'active' : ''}" data-tab="tenants">
                                <i class="fas fa-users"></i> Penyewa
                            </button>
                        </div>
                        <button class="btn btn--primary" id="add-new-item-btn">
                            <i class="fas fa-plus-circle"></i> Tambah Baru
                        </button>
                    </div>

                    <div id="apartments-tab-content" class="tab-content ${appState.currentCrudTab === 'apartments' ? 'active' : ''}">
                        ${this.renderApartmentsTable(appState.data.apartments)}
                    </div>
                    <div id="tenants-tab-content" class="tab-content ${appState.currentCrudTab === 'tenants' ? 'active' : ''}">
                        ${this.renderTenantsTable(appState.data.tenants)}
                    </div>
                `;
                    return pageContainer;
                },

                renderApartmentsTable(apartments) {
                    if (apartments.length === 0) {
                        return '<div class="placeholder-content" style="min-height: 200px;"><i class="fas fa-folder-open"></i><h3>Data Apartemen Kosong</h3><p>Silakan tambahkan data apartemen baru.</p></div>';
                    }
                    let tableHTML = `
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Nama Apartemen</th>
                                    <th>Tipe</th>
                                    <th>Harga/Bulan</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>`;
                    apartments.forEach(apt => {
                        tableHTML += `
                        <tr>
                            <td>${utils.escapeHTML(apt.name)}</td>
                            <td>${utils.escapeHTML(apt.type)}</td>
                            <td>${utils.formatCurrency(apt.price)}</td>
                            <td><span style="color: ${apt.status === 'Tersedia' ? 'var(--success-color)' : 'var(--danger-color)'}; font-weight: bold;">${utils.escapeHTML(apt.status)}</span></td>
                            <td class="table-actions">
                                <button class="btn btn--sm btn--outline-primary edit-apartment-btn" data-id="${apt.id}" title="Edit"><i class="fas fa-edit"></i></button>
                                <button class="btn btn--sm btn--danger delete-apartment-btn" data-id="${apt.id}" title="Hapus"><i class="fas fa-trash-alt"></i></button>
                            </td>
                        </tr>`;
                    });
                    tableHTML += '</tbody></table></div>';
                    return tableHTML;
                },
                showApartmentForm(apartment = null) {
                    appState.editingItemId = apartment ? apartment.id : null;
                    const formId = 'apartment-form';
                    const modalTitle = apartment ? 'Edit Data Apartemen' : 'Tambah Apartemen Baru';
                    const formHTML = `
                    <form id="${formId}" novalidate>
                        <input type="hidden" name="id" value="${apartment ? utils.escapeHTML(apartment.id) : ''}">
                        <div class="form-group">
                            <label for="apt-name" class="form-label">Nama Apartemen</label>
                            <input type="text" id="apt-name" name="name" class="form-control" value="${apartment ? utils.escapeHTML(apartment.name) : ''}" required maxlength="100">
                            <div class="invalid-feedback">Nama apartemen wajib diisi.</div>
                        </div>
                        <div class="form-group">
                            <label for="apt-type" class="form-label">Tipe Unit</label>
                            <input type="text" id="apt-type" name="type" class="form-control" value="${apartment ? utils.escapeHTML(apartment.type) : ''}" required maxlength="50">
                             <div class="invalid-feedback">Tipe unit wajib diisi.</div>
                        </div>
                        <div class="form-group">
                            <label for="apt-price" class="form-label">Harga Sewa / Bulan (Rp)</label>
                            <input type="number" id="apt-price" name="price" class="form-control" value="${apartment ? apartment.price : ''}" required min="0">
                            <div class="invalid-feedback">Harga sewa wajib diisi dan harus angka positif.</div>
                        </div>
                        <div class="form-group">
                            <label for="apt-status" class="form-label">Status</label>
                            <select id="apt-status" name="status" class="form-control" required>
                                <option value="Tersedia" ${apartment && apartment.status === 'Tersedia' ? 'selected' : ''}>Tersedia</option>
                                <option value="Tersewa" ${apartment && apartment.status === 'Tersewa' ? 'selected' : ''}>Tersewa</option>
                            </select>
                            <div class="invalid-feedback">Status wajib dipilih.</div>
                        </div>
                        <div class="form-group">
                            <label for="apt-image" class="form-label">URL Gambar</label>
                            <input type="url" id="apt-image" name="image" class="form-control" value="${apartment ? utils.escapeHTML(apartment.image) : ''}">
                             <div class="invalid-feedback">URL gambar tidak valid. Pastikan menggunakan format gambar (jpg, png, webp).</div>
                        </div>
                        <div class="form-group">
                            <label for="apt-details" class="form-label">Deskripsi Detail</label>
                            <textarea id="apt-details" name="details" class="form-control" rows="4" required>${apartment ? utils.escapeHTML(apartment.details) : ''}</textarea>
                            <div class="invalid-feedback">Deskripsi wajib diisi.</div>
                        </div>
                    </form>
                `;
                    const footerHTML = `
                    <button type="button" class="btn btn--outline-primary" data-dismiss="modal">Batal</button>
                    <button type="submit" class="btn btn--primary" form="${formId}">${apartment ? 'Simpan Perubahan' : 'Tambah Apartemen'}</button>
                `;
                    ui.openModal(modalTitle, formHTML, footerHTML);
                },
                handleApartmentFormSubmit(event) {
                    event.preventDefault();
                    const form = event.target;
                    if (!this.validateForm(form)) return;

                    const formData = utils.getFormData(form);
                    formData.price = parseFloat(formData.price);

                    if (appState.editingItemId) {
                        const index = appState.data.apartments.findIndex(apt => apt.id === appState.editingItemId);
                        if (index !== -1) {
                            appState.data.apartments[index] = { ...appState.data.apartments[index], ...formData };
                            ui.showNotification('Data apartemen berhasil diperbarui!', 'success'); // Toast/Flash
                        }
                    } else {
                        formData.id = utils.generateId('apt');
                        appState.data.apartments.push(formData);
                        ui.showNotification('Apartemen baru berhasil ditambahkan!', 'success'); // Toast/Flash
                    }
                    ui.closeModal(); // Close Alert/Modal
                    this.refreshCrudTable('apartments');
                    if (appState.currentPage === 'apartments') router.navigateToPage('apartments', true);
                    if (appState.currentPage === 'dashboard') router.navigateToPage('dashboard', true);
                },
                deleteApartment(apartmentId) {
                    const apt = appState.data.apartments.find(a => a.id === apartmentId);
                    if (!apt) return;

                    const isRented = appState.data.tenants.some(t => t.unitId === apartmentId);
                    let message = `<p>Apakah Anda yakin ingin menghapus apartemen <strong>"${utils.escapeHTML(apt.name)}"</strong>?</ Tindakan ini tidak dapat diurungkan.</p>`;
                    if (isRented) {
                        message = `<p>Apartemen <strong>"${utils.escapeHTML(apt.name)}"</strong> saat ini sedang disewa. Menghapus data apartemen ini juga akan mempengaruhi data penyewa terkait. Apakah Anda yakin ingin melanjutkan?</p>
                         <p><small>Catatan: Data penyewa yang terkait tidak akan dihapus otomatis di versi demo ini, namun relasinya akan hilang.</small></p>`;
                    }

                    ui.openModal( // Alert/Confirmation Modal
                        'Konfirmasi Hapus Apartemen',
                        message,
                        `<button type="button" class="btn btn--outline-primary" data-dismiss="modal">Batal</button>
                         <button type="button" class="btn btn--danger" id="confirm-delete-btn">Ya, Hapus</button>`
                    );

                    const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
                    if (confirmDeleteBtn) {
                        confirmDeleteBtn.addEventListener('click', () => {
                            appState.data.apartments = appState.data.apartments.filter(a => a.id !== apartmentId);
                            ui.showNotification(`Apartemen "${utils.escapeHTML(apt.name)}" berhasil dihapus.`, 'success'); // Toast/Flash
                            ui.closeModal(); // Close Alert/Modal
                            this.refreshCrudTable('apartments');
                            if (appState.currentPage === 'apartments') router.navigateToPage('apartments', true);
                            if (appState.currentPage === 'dashboard') router.navigateToPage('dashboard', true);
                        });
                    }
                },

                renderTenantsTable(tenants) {
                    if (tenants.length === 0) {
                        return '<div class="placeholder-content" style="min-height: 200px;"><i class="fas fa-user-slash"></i><h3>Data Penyewa Kosong</h3><p>Silakan tambahkan data penyewa baru.</p></div>';
                    }
                    let tableHTML = `
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Nama Penyewa</th>
                                    <th>Unit Disewa</th>
                                    <th>No. Telepon</th>
                                    <th>Email</th>
                                    <th>Tanggal Masuk</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>`;
                    tenants.forEach(tenant => {
                        const apartment = appState.data.apartments.find(apt => apt.id === tenant.unitId);
                        tableHTML += `
                        <tr>
                            <td>${utils.escapeHTML(tenant.name)}</td>
                            <td>${apartment ? utils.escapeHTML(apartment.name) : 'Unit Tidak Diketahui'}</td>
                            <td>${utils.escapeHTML(tenant.phone)}</td>
                            <td>${utils.escapeHTML(tenant.email)}</td>
                            <td>${utils.formatDate(tenant.entryDate)}</td>
                            <td class="table-actions">
                                <button class="btn btn--sm btn--outline-primary edit-tenant-btn" data-id="${tenant.id}" title="Edit"><i class="fas fa-edit"></i></button>
                                <button class="btn btn--sm btn--danger delete-tenant-btn" data-id="${tenant.id}" title="Hapus"><i class="fas fa-trash-alt"></i></button>
                            </td>
                        </tr>`;
                    });
                    tableHTML += '</tbody></table></div>';
                    return tableHTML;
                },
                showTenantForm(tenant = null) {
                    appState.editingItemId = tenant ? tenant.id : null;
                    const formId = 'tenant-form';
                    const modalTitle = tenant ? 'Edit Data Penyewa' : 'Tambah Penyewa Baru';

                    let apartmentOptions = '<option value="">Pilih Unit Apartemen</option>';
                    appState.data.apartments.forEach(apt => {
                        const isSelected = tenant && tenant.unitId === apt.id;
                        if (apt.status === 'Tersedia' || isSelected) {
                            apartmentOptions += `<option value="${apt.id}" ${isSelected ? 'selected' : ''}>${utils.escapeHTML(apt.name)} (${utils.escapeHTML(apt.type)})</option>`;
                        }
                    });
                    if (appState.data.apartments.length === 0 && !tenant) { // only show if no apartments AND not editing an existing tenant who might have a unit
                        apartmentOptions = '<option value="">Belum ada data apartemen tersedia</option>';
                    }


                    const formHTML = `
                    <form id="${formId}" novalidate>
                        <input type="hidden" name="id" value="${tenant ? utils.escapeHTML(tenant.id) : ''}">
                        <div class="form-group">
                            <label for="tenant-name" class="form-label">Nama Lengkap Penyewa</label>
                            <input type="text" id="tenant-name" name="name" class="form-control" value="${tenant ? utils.escapeHTML(tenant.name) : ''}" required maxlength="100">
                            <div class="invalid-feedback">Nama penyewa wajib diisi.</div>
                        </div>
                        <div class="form-group">
                            <label for="tenant-unit" class="form-label">Unit yang Disewa</label>
                            <select id="tenant-unit" name="unitId" class="form-control" required>
                                ${apartmentOptions}
                            </select>
                            <div class="invalid-feedback">Unit yang disewa wajib dipilih.</div>
                        </div>
                         <div class="form-group">
                            <label for="tenant-phone" class="form-label">Nomor Telepon</label>
                            <input type="tel" id="tenant-phone" name="phone" class="form-control" value="${tenant ? utils.escapeHTML(tenant.phone) : ''}" required pattern="[0-9\\-\\+\\s()]{10,15}">
                            <div class="invalid-feedback">Nomor telepon wajib diisi (10-15 digit).</div>
                        </div>
                        <div class="form-group">
                            <label for="tenant-email" class="form-label">Alamat Email</label>
                            <input type="email" id="tenant-email" name="email" class="form-control" value="${tenant ? utils.escapeHTML(tenant.email) : ''}" required>
                             <div class="invalid-feedback">Alamat email wajib diisi dan valid.</div>
                        </div>
                        <div class="form-group">
                            <label for="tenant-entry-date" class="form-label">Tanggal Masuk</label>
                            <input type="date" id="tenant-entry-date" name="entryDate" class="form-control" value="${tenant ? tenant.entryDate : ''}" required>
                            <div class="invalid-feedback">Tanggal masuk wajib diisi.</div>
                        </div>
                    </form>
                `;
                    const footerHTML = `
                    <button type="button" class="btn btn--outline-primary" data-dismiss="modal">Batal</button>
                    <button type="submit" class="btn btn--primary" form="${formId}">${tenant ? 'Simpan Perubahan' : 'Tambah Penyewa'}</button>
                `;
                    ui.openModal(modalTitle, formHTML, footerHTML); // Alert/Modal for form
                },
                handleTenantFormSubmit(event) {
                    event.preventDefault();
                    const form = event.target;
                    if (!this.validateForm(form)) return;

                    const formData = utils.getFormData(form);
                    const oldUnitId = appState.editingItemId ? appState.data.tenants.find(t => t.id === appState.editingItemId)?.unitId : null;

                    if (appState.editingItemId) {
                        const index = appState.data.tenants.findIndex(t => t.id === appState.editingItemId);
                        if (index !== -1) {
                            appState.data.tenants[index] = { ...appState.data.tenants[index], ...formData };
                            ui.showNotification('Data penyewa berhasil diperbarui!', 'success'); // Toast/Flash
                        }
                    } else {
                        formData.id = utils.generateId('ten');
                        appState.data.tenants.push(formData);
                        ui.showNotification('Penyewa baru berhasil ditambahkan!', 'success'); // Toast/Flash
                    }

                    if (oldUnitId && oldUnitId !== formData.unitId) {
                        const oldApt = appState.data.apartments.find(apt => apt.id === oldUnitId);
                        if (oldApt) oldApt.status = 'Tersedia';
                    }
                    const newApt = appState.data.apartments.find(apt => apt.id === formData.unitId);
                    if (newApt) newApt.status = 'Tersewa';

                    ui.closeModal(); // Close Alert/Modal
                    this.refreshCrudTable('tenants');
                    if (appState.currentPage === 'dashboard') router.navigateToPage('dashboard', true);
                    if (appState.currentPage === 'apartments') router.navigateToPage('apartments', true); // Refresh gallery if unit status changed
                },
                deleteTenant(tenantId) {
                    const tenant = appState.data.tenants.find(t => t.id === tenantId);
                    if (!tenant) return;

                    ui.openModal( // Alert/Confirmation Modal
                        'Konfirmasi Hapus Penyewa',
                        `<p>Apakah Anda yakin ingin menghapus penyewa <strong>"${utils.escapeHTML(tenant.name)}"</strong>?</p>
                     <p><small>Menghapus penyewa akan mengubah status unit yang disewa menjadi "Tersedia".</small></p>`,
                        `<button type="button" class="btn btn--outline-primary" data-dismiss="modal">Batal</button>
                     <button type="button" class="btn btn--danger" id="confirm-delete-btn">Ya, Hapus</button>`
                    );

                    const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
                    if (confirmDeleteBtn) {
                        confirmDeleteBtn.addEventListener('click', () => {
                            const apartment = appState.data.apartments.find(apt => apt.id === tenant.unitId);
                            if (apartment) {
                                apartment.status = 'Tersedia';
                            }

                            appState.data.tenants = appState.data.tenants.filter(t => t.id !== tenantId);
                            ui.showNotification(`Penyewa "${utils.escapeHTML(tenant.name)}" berhasil dihapus.`, 'success'); // Toast/Flash
                            ui.closeModal(); // Close Alert/Modal
                            this.refreshCrudTable('tenants');
                            if (appState.currentPage === 'dashboard') router.navigateToPage('dashboard', true);
                            if (appState.currentPage === 'apartments') router.navigateToPage('apartments', true);
                        });
                    }
                },
                refreshCrudTable(type) {
                    const contentArea = document.getElementById(`${type}-tab-content`);
                    if (contentArea) {
                        if (type === 'apartments') {
                            contentArea.innerHTML = this.renderApartmentsTable(appState.data.apartments);
                        } else if (type === 'tenants') {
                            contentArea.innerHTML = this.renderTenantsTable(appState.data.tenants);
                        }
                    }
                },
                validateForm(formElement) {
                    let isValid = true;
                    formElement.querySelectorAll('[required], input[type="url"], input[type="tel"], input[type="number"]').forEach(input => {
                        input.classList.remove('is-invalid');
                        let validField = true;
                        if (input.required) {
                            if (input.type === 'checkbox' && !input.checked) validField = false;
                            else if (input.value.trim() === '') validField = false;
                        }
                        if (validField && input.type === 'email' && input.value.trim() !== '' && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input.value)) validField = false;
                        if (validField && input.type === 'url' && input.value.trim() !== '' && !utils.validateURL(input.value)) validField = false;
                        if (validField && input.type === 'tel' && input.value.trim() !== '' && !input.checkValidity()) validField = false; // Using native pattern check
                        if (validField && input.type === 'number' && input.value.trim() !== '' && (isNaN(parseFloat(input.value)) || (input.min && parseFloat(input.value) < parseFloat(input.min)))) validField = false;

                        if (!validField) {
                            input.classList.add('is-invalid');
                            isValid = false;
                        }
                    });
                    if (!isValid) {
                        ui.showNotification('Harap perbaiki data yang tidak valid pada form.', 'danger'); // Toast/Flash
                    }
                    return isValid;
                },
                viewApartmentDetails(apartmentId) {
                    const apt = appState.data.apartments.find(a => a.id === apartmentId);
                    if (!apt) {
                        ui.showNotification('Apartemen tidak ditemukan.', 'danger'); // Toast/Flash
                        return;
                    }

                    const bodyContent = `
                    <img src="${utils.escapeHTML(apt.image) || 'https://via.placeholder.com/400x200.png?text=Gambar+Apartemen'}" alt="Foto ${utils.escapeHTML(apt.name)}" style="width: 100%; max-height: 300px; object-fit: cover; border-radius: var(--border-radius-sm); margin-bottom: var(--spacing-md);">
                    <h4>${utils.escapeHTML(apt.name)}</h4>
                    <p><strong>Tipe:</strong> ${utils.escapeHTML(apt.type)}</p>
                    <p><strong>Harga:</strong> ${utils.formatCurrency(apt.price)} / bulan</p>
                    <p><strong>Status:</strong> <span style="font-weight: bold; color: ${apt.status === 'Tersedia' ? 'var(--success-color)' : 'var(--danger-color)'}">${utils.escapeHTML(apt.status)}</span></p>
                    <p><strong>Deskripsi:</strong><br>${utils.escapeHTML(apt.details)}</p>
                `;
                    const footerContent = `<button type="button" class="btn btn--outline-primary" data-dismiss="modal">Tutup</button>`;
                    ui.openModal(`Detail Apartemen: ${utils.escapeHTML(apt.name)}`, bodyContent, footerContent); // Alert/Modal for details
                }
            };

            // ========== 7. ROUTER ==========
            const router = {
                routes: {
                    'landing': { title: 'Halaman Utama', renderer: pageRenderers.landing },
                    'dashboard': { title: 'Dashboard Utama', renderer: pageRenderers.dashboard },
                    'apartments': { title: 'Galeri Apartemen', renderer: pageRenderers.apartments },
                    'crud': { title: 'Manajemen Data', renderer: pageRenderers.crud },
                    'documentation': { title: 'Dokumentasi', renderer: pageRenderers.documentation },
                    'dashboard_analytics': { title: 'Dashboard Analitik', renderer: pageRenderers.dashboard_analytics }
                },
                navigateToPage(pageId, isRefresh = false) {
                    if (!this.routes[pageId]) {
                        console.warn(`Halaman "${pageId}" tidak ditemukan. Kembali ke Halaman Utama.`);
                        pageId = 'landing';
                    }

                    if (!isRefresh && appState.currentPage === pageId) return;

                    utils.showLoading();

                    setTimeout(() => {
                        const route = this.routes[pageId];
                        DOM.pageTitle.textContent = route.title;
                        document.title = `Green Valley - ${route.title}`;

                        const content = route.renderer();
                        ui.renderPageContent(pageId, content);

                        appState.currentPage = pageId;
                        ui.updateActiveNavLink(pageId);

                        if (window.location.hash !== `#${pageId}`) {
                            window.location.hash = pageId;
                        }

                        if (window.innerWidth <= 991.98) {
                            ui.toggleSidebar(false); // Close Off-Canvas on navigation on small screens
                        }
                        utils.hideLoading();
                    }, 250);
                },
                handleHashChange() {
                    const pageId = window.location.hash.substring(1) || 'landing';
                    if (this.routes[pageId]) {
                        this.navigateToPage(pageId);
                    } else {
                        this.navigateToPage('landing');
                    }
                }
            };

            // ========== 8. EVENT LISTENERS ==========
            function setupEventListeners() {
                DOM.themeToggleButton.addEventListener('click', () => {
                    const newTheme = appState.theme === 'light' ? 'dark' : 'light';
                    ui.setTheme(newTheme);
                });

                DOM.sidebarToggleButton.addEventListener('click', () => ui.toggleSidebar()); // Off-Canvas toggle

                document.addEventListener('click', function (event) {
                    const target = event.target.closest('.router-link');
                    if (target && target.dataset.page) {
                        event.preventDefault();
                        router.navigateToPage(target.dataset.page);
                    }

                    if (event.target.closest('.edit-apartment-btn')) {
                        const id = event.target.closest('.edit-apartment-btn').dataset.id;
                        const apt = appState.data.apartments.find(a => a.id === id);
                        if (apt) crudOperations.showApartmentForm(apt);
                    } else if (event.target.closest('.delete-apartment-btn')) {
                        const id = event.target.closest('.delete-apartment-btn').dataset.id;
                        crudOperations.deleteApartment(id);
                    } else if (event.target.closest('.edit-tenant-btn')) {
                        const id = event.target.closest('.edit-tenant-btn').dataset.id;
                        const tenant = appState.data.tenants.find(t => t.id === id);
                        if (tenant) crudOperations.showTenantForm(tenant);
                    } else if (event.target.closest('.delete-tenant-btn')) {
                        const id = event.target.closest('.delete-tenant-btn').dataset.id;
                        crudOperations.deleteTenant(id);
                    } else if (event.target.closest('#add-new-item-btn')) {
                        if (appState.currentCrudTab === 'apartments') {
                            crudOperations.showApartmentForm();
                        } else {
                            crudOperations.showTenantForm();
                        }
                    } else if (event.target.closest('.view-apartment-details-btn')) {
                        const id = event.target.closest('.view-apartment-details-btn').dataset.id;
                        crudOperations.viewApartmentDetails(id);
                    }

                    if (event.target.classList.contains('tab-button')) {
                        const tabId = event.target.dataset.tab;
                        appState.currentCrudTab = tabId;
                        document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                        event.target.classList.add('active');
                        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                        const activeTabContent = document.getElementById(`${tabId}-tab-content`);
                        if (activeTabContent) activeTabContent.classList.add('active');
                    }
                });

                DOM.modal.addEventListener('submit', function (event) {
                    if (event.target.id === 'apartment-form') {
                        crudOperations.handleApartmentFormSubmit(event);
                    } else if (event.target.id === 'tenant-form') {
                        crudOperations.handleTenantFormSubmit(event);
                    }
                });


                window.addEventListener('hashchange', () => router.handleHashChange());

                DOM.logoutButton.addEventListener('click', () => {
                    ui.openModal( // Alert/Confirmation Modal for logout
                        'Konfirmasi Logout',
                        '<p>Apakah Anda yakin ingin keluar dari aplikasi Green Valley?</p>',
                        `<button type="button" class="btn btn--outline-primary" data-dismiss="modal">Batal</button>
                     <button type="button" class="btn btn--danger" id="confirm-logout-btn">Ya, Logout</button>`
                    );
                    const confirmBtn = document.getElementById('confirm-logout-btn');
                    if (confirmBtn) {
                        confirmBtn.addEventListener('click', () => {
                            ui.showNotification('Anda telah berhasil logout. Sesi demo berakhir.', 'info'); // Toast/Flash
                            ui.closeModal(); // Close Alert/Modal
                            router.navigateToPage('landing');
                            appState.currentUser = { name: 'Pengguna Tamu' };
                            ui.updateGreeting();
                        });
                    }
                });

                document.addEventListener('keydown', (event) => {
                    if (event.key === 'Escape' && appState.isModalOpen) {
                        ui.closeModal(); // Close Alert/Modal with Escape key
                    }
                });

                // Handle Off-Canvas behavior and main content margin on resize
                window.addEventListener('resize', utils.debounce(() => {
                    if (window.innerWidth > 991.98) {
                        // Desktop: Ensure sidebar state and margin are consistent
                        if (appState.isSidebarOpen) {
                            DOM.sidebar.classList.add('sidebar--active');
                            DOM.mainContentWrapper.style.marginLeft = '280px';
                        } else {
                            DOM.sidebar.classList.remove('sidebar--active'); // Ensure it's closed if state says so
                            DOM.mainContentWrapper.style.marginLeft = '0';
                        }
                        DOM.sidebarToggleButton.setAttribute('aria-expanded', appState.isSidebarOpen);
                    } else {
                        // Mobile/Tablet: Force sidebar closed, remove margin
                        ui.toggleSidebar(false); // This handles appState and classes
                        DOM.mainContentWrapper.style.marginLeft = '0';
                    }
                }, 200));

            }

            // ========== 9. INITIALIZATION ==========
            function init() {
                ui.setTheme(appState.theme);
                ui.updateGreeting();
                ui.updateCurrentYear();
                DOM.modal.setAttribute('aria-hidden', 'true'); // Ensure modal is hidden initially for accessibility

                if (window.innerWidth <= 991.98) {
                    appState.isSidebarOpen = false;
                    DOM.mainContentWrapper.style.marginLeft = '0';
                    DOM.sidebar.classList.remove('sidebar--active');
                } else {
                    appState.isSidebarOpen = true;
                    DOM.mainContentWrapper.style.marginLeft = '280px';
                    DOM.sidebar.classList.add('sidebar--active');
                }
                DOM.sidebarToggleButton.setAttribute('aria-expanded', appState.isSidebarOpen);


                setupEventListeners();
                router.handleHashChange();
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }

        })();
    </script>
</body>

</html>