<!DOCTYPE html>
<html lang="id" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Platform penyewaan apartemen modern dengan pencarian canggih, pembayaran aman, dan manajemen booking yang efisien. Temukan apartemen impian Anda dengan mudah.">
    <meta name="keywords"
        content="sewa apartemen, rental apartemen, cari apartemen, apartemen harian, apartemen bulanan, apartemen mingguan, akomodasi, properti, Rentelindo">
    <meta name="author" content="Rentelindo Global Team">
    <meta name="robots" content="index, follow">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Rentelindo - Platform Penyewaan Apartemen Modern & Terpercaya</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè¢</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preload"
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"
        as="style">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* ======= DESIGN TOKENS & GLOBAL STYLES ======= */
        :root {
            --color-primary: #3a86ff;
            --color-primary-dark: #2563eb;
            --color-primary-light: #60a5fa;
            --color-secondary: #ff006e;
            --color-secondary-dark: #db2777;
            --color-success: #06d6a0;
            --color-warning: #ffbe0b;
            --color-danger: #ef476f;

            --color-text: #212529;
            --color-text-muted: #6c757d;
            --color-background: #f8f9fa;
            --color-surface: #ffffff;
            --color-surface-dark: #e9ecef;
            --color-border: #dee2e6;

            --font-sans: 'Inter', 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            --font-serif: 'Playfair Display', Georgia, serif;

            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.12);

            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 16px;
            --radius-full: 9999px;

            --transition-fast: all 0.2s ease-out;
            --transition-base: all 0.3s ease-in-out;

            --space-1: 0.25rem;
            /* 4px */
            --space-2: 0.5rem;
            /* 8px */
            --space-3: 0.75rem;
            /* 12px */
            --space-4: 1rem;
            /* 16px */
            --space-5: 1.25rem;
            /* 20px */
            --space-6: 1.5rem;
            /* 24px */
            --space-8: 2rem;
            /* 32px */
            --space-10: 2.5rem;
            /* 40px */
            --space-12: 3rem;
            /* 48px */

            --text-xs: 0.75rem;
            --text-sm: 0.875rem;
            --text-base: 1rem;
            --text-lg: 1.125rem;
            --text-xl: 1.25rem;
            --text-2xl: 1.5rem;
            --text-3xl: 1.875rem;
            --text-4xl: 2.25rem;
            --text-5xl: 3rem;

            --header-height: 70px;
        }

        [data-theme="dark"] {
            --color-text: #f8f9fa;
            --color-text-muted: #adb5bd;
            --color-background: #1a202c;
            /* Slightly darker than original dark */
            --color-surface: #2d3748;
            /* Was surface-dark */
            --color-surface-dark: #1f2937;
            /* Even darker for subtle depth */
            --color-border: #4a5568;
        }

        /* ======= BASE STYLES ======= */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
            font-family: var(--font-sans);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            line-height: 1.6;
            color: var(--color-text);
            background-color: var(--color-background);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        main {
            flex-grow: 1;
            padding-top: var(--header-height);
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: var(--font-serif);
            color: var(--color-text);
            line-height: 1.3;
            font-weight: 600;
        }

        h1 {
            font-size: var(--text-4xl);
            margin-bottom: var(--space-6);
        }

        h2 {
            font-size: var(--text-3xl);
            margin-bottom: var(--space-5);
        }

        h3 {
            font-size: var(--text-2xl);
            margin-bottom: var(--space-4);
        }

        h4 {
            font-size: var(--text-xl);
            margin-bottom: var(--space-3);
        }

        p {
            margin-bottom: var(--space-4);
            font-size: var(--text-base);
        }

        a {
            color: var(--color-primary);
            text-decoration: none;
            transition: var(--transition-fast);
        }

        a:hover {
            color: var(--color-primary-dark);
            text-decoration: underline;
        }

        img,
        svg,
        video,
        canvas,
        audio,
        iframe,
        embed,
        object {
            max-width: 100%;
            height: auto;
            display: block;
        }

        ul,
        ol {
            list-style-position: inside;
            margin-bottom: var(--space-4);
        }

        input,
        button,
        select,
        textarea {
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
            color: inherit;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            padding: var(--space-2) var(--space-3);
            background-color: var(--color-surface);
        }

        input:focus,
        button:focus,
        select:focus,
        textarea:focus {
            outline: 2px solid var(--color-primary);
            outline-offset: 2px;
            border-color: var(--color-primary-light);
            box-shadow: 0 0 0 3px rgba(var(--color-primary-light), 0.3);
        }

        button,
        .btn {
            cursor: pointer;
            border: 1px solid transparent;
            transition: var(--transition-base);
        }

        /* ======= UTILITY CLASSES ======= */
        .container {
            width: 100%;
            max-width: 1280px;
            /* Increased max-width for a more spacious feel */
            margin-left: auto;
            margin-right: auto;
            padding-left: var(--space-4);
            padding-right: var(--space-4);
        }

        .d-flex {
            display: flex;
        }

        .flex-column {
            flex-direction: column;
        }

        .flex-wrap {
            flex-wrap: wrap;
        }

        .items-center {
            align-items: center;
        }

        .items-start {
            align-items: flex-start;
        }

        .items-end {
            align-items: flex-end;
        }

        .justify-center {
            justify-content: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-around {
            justify-content: space-around;
        }

        .justify-start {
            justify-content: flex-start;
        }

        .justify-end {
            justify-content: flex-end;
        }

        .gap-1 {
            gap: var(--space-1);
        }

        .gap-2 {
            gap: var(--space-2);
        }

        .gap-3 {
            gap: var(--space-3);
        }

        .gap-4 {
            gap: var(--space-4);
        }

        .gap-6 {
            gap: var(--space-6);
        }

        .gap-8 {
            gap: var(--space-8);
        }

        .d-grid {
            display: grid;
        }

        .grid-cols-1 {
            grid-template-columns: 1fr;
        }

        .grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .grid-cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        /* Add more as needed: grid-cols-auto-fit for responsive grids */
        .grid-cols-autofit-300 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }


        .m-0 {
            margin: 0 !important;
        }

        .my-4 {
            margin-top: var(--space-4);
            margin-bottom: var(--space-4);
        }

        .my-8 {
            margin-top: var(--space-8);
            margin-bottom: var(--space-8);
        }

        .mt-4 {
            margin-top: var(--space-4);
        }

        .mb-4 {
            margin-bottom: var(--space-4);
        }

        .mt-auto {
            margin-top: auto;
        }

        .p-0 {
            padding: 0 !important;
        }

        .p-2 {
            padding: var(--space-2);
        }

        .p-4 {
            padding: var(--space-4);
        }

        .p-6 {
            padding: var(--space-6);
        }

        .px-4 {
            padding-left: var(--space-4);
            padding-right: var(--space-4);
        }

        .py-4 {
            padding-top: var(--space-4);
            padding-bottom: var(--space-4);
        }

        .text-center {
            text-align: center;
        }

        .text-left {
            text-align: left;
        }

        .text-right {
            text-align: right;
        }

        .text-sm {
            font-size: var(--text-sm);
        }

        .text-lg {
            font-size: var(--text-lg);
        }

        .font-medium {
            font-weight: 500;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-bold {
            font-weight: 700;
        }

        .text-muted {
            color: var(--color-text-muted) !important;
        }

        .text-primary {
            color: var(--color-primary) !important;
        }

        .text-success {
            color: var(--color-success) !important;
        }

        .text-danger {
            color: var(--color-danger) !important;
        }

        .text-warning {
            color: var(--color-warning) !important;
        }


        .hidden {
            display: none !important;
        }

        .d-block {
            display: block !important;
        }

        .w-full {
            width: 100% !important;
        }

        .h-full {
            height: 100% !important;
        }

        .rounded-sm {
            border-radius: var(--radius-sm);
        }

        .rounded-md {
            border-radius: var(--radius-md);
        }

        .rounded-lg {
            border-radius: var(--radius-lg);
        }

        .rounded-full {
            border-radius: var(--radius-full);
        }

        .shadow-sm {
            box-shadow: var(--shadow-sm);
        }

        .shadow-md {
            box-shadow: var(--shadow-md);
        }

        .shadow-lg {
            box-shadow: var(--shadow-lg);
        }

        /* ======= COMPONENTS ======= */
        /* Header & Navbar */
        .app-header {
            background-color: var(--color-surface);
            box-shadow: var(--shadow-md);
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            z-index: 1000;
            height: var(--header-height);
            border-bottom: 1px solid var(--color-border);
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
        }

        .logo {
            font-size: var(--text-2xl);
            font-weight: bold;
            color: var(--color-primary);
            font-family: var(--font-serif);
        }

        .logo:hover {
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .nav-links a {
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            font-weight: 500;
            color: var(--color-text);
            position: relative;
        }

        .nav-links a:hover {
            background-color: var(--color-surface-dark);
            color: var(--color-primary);
            text-decoration: none;
        }

        .nav-links a.active {
            background-color: var(--color-primary);
            color: var(--color-surface);
            font-weight: 600;
        }

        .nav-links a.active:hover {
            background-color: var(--color-primary-dark);
        }

        .theme-toggle-btn {
            background: none;
            border: none;
            font-size: var(--text-lg);
            cursor: pointer;
            color: var(--color-text);
            padding: var(--space-2);
            border-radius: var(--radius-full);
        }

        .theme-toggle-btn:hover {
            background-color: var(--color-surface-dark);
        }

        /* Property Card */
        .property-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            /* Slightly larger minmax */
            gap: var(--space-6);
        }

        .property-card {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            /* More rounded */
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .property-card:hover {
            transform: translateY(-8px);
            /* More pronounced hover effect */
            box-shadow: var(--shadow-lg);
        }

        .property-image {
            height: 220px;
            /* Increased height */
            width: 100%;
            object-fit: cover;
            border-bottom: 1px solid var(--color-border);
        }

        .property-details {
            padding: var(--space-4);
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .property-details h3 {
            font-size: var(--text-xl);
            margin-bottom: var(--space-2);
        }

        .property-details p {
            font-size: var(--text-sm);
            margin-bottom: var(--space-2);
            color: var(--color-text-muted);
        }

        .property-price {
            font-size: var(--text-lg) !important;
            font-weight: bold;
            color: var(--color-primary) !important;
            margin-bottom: var(--space-3) !important;
        }

        .property-card .btn {
            margin-top: auto;
            /* Pushes button to bottom if card heights vary */
        }

        .property-card blockquote {
            font-style: italic;
            padding: var(--space-2) var(--space-3);
            background-color: var(--color-surface-dark);
            border-left: 3px solid var(--color-primary);
            border-radius: var(--radius-sm);
            margin: var(--space-3) 0;
        }

        .property-card blockquote p {
            margin-bottom: var(--space-1);
            font-size: var(--text-sm);
        }

        .property-card cite {
            font-size: var(--text-xs);
            color: var(--color-text-muted);
        }

        /* Forms */
        .form-section {
            /* Wrapper for search forms etc */
            background: var(--color-surface);
            padding: var(--space-6);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            margin-bottom: var(--space-8);
        }

        .form-group {
            margin-bottom: var(--space-4);
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-2);
            font-weight: 500;
            font-size: var(--text-sm);
        }

        .form-control {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            /* Slightly larger padding */
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            font-size: var(--text-base);
            transition: var(--transition-base);
            background-color: var(--color-surface);
            color: var(--color-text);
        }

        .form-control::placeholder {
            color: var(--color-text-muted);
        }

        .form-control:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(58, 134, 255, 0.25);
            /* Primary color shadow */
        }

        .form-select {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            font-size: var(--text-base);
            background-color: var(--color-surface);
            color: var(--color-text);
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%236c757d' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right var(--space-3) center;
            background-size: 16px 12px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
        }

        .form-select:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(58, 134, 255, 0.25);
        }

        /* Checkbox and Radio custom styling */
        .form-check {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-2);
        }

        .form-check input[type="checkbox"],
        .form-check input[type="radio"] {
            width: 1.25em;
            height: 1.25em;
            accent-color: var(--color-primary);
            /* Modern way to color checkboxes/radios */
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-3) var(--space-5);
            /* Larger buttons */
            border-radius: var(--radius-md);
            font-weight: 500;
            text-align: center;
            cursor: pointer;
            transition: var(--transition-base);
            border: 1px solid transparent;
            font-size: var(--text-base);
            line-height: 1;
            /* Ensure text is centered vertically */
        }

        .btn i {
            margin-right: var(--space-2);
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: #fff;
            /* Explicit white for primary buttons */
            border-color: var(--color-primary);
        }

        .btn-primary:hover {
            background-color: var(--color-primary-dark);
            border-color: var(--color-primary-dark);
            color: #fff;
            text-decoration: none;
        }

        .btn-secondary {
            background-color: var(--color-secondary);
            color: #fff;
            border-color: var(--color-secondary);
        }

        .btn-secondary:hover {
            background-color: var(--color-secondary-dark);
            border-color: var(--color-secondary-dark);
            color: #fff;
            text-decoration: none;
        }

        .btn-outline-primary {
            background-color: transparent;
            border: 1px solid var(--color-primary);
            color: var(--color-primary);
        }

        .btn-outline-primary:hover {
            background-color: var(--color-primary);
            color: var(--color-surface);
            text-decoration: none;
        }

        .btn-danger {
            background-color: var(--color-danger);
            color: #fff;
            border-color: var(--color-danger);
        }

        .btn-danger:hover {
            background-color: #c82333;
            /* Darker red */
            border-color: #bd2130;
            color: #fff;
            text-decoration: none;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: var(--space-1) var(--space-3);
            font-size: var(--text-xs);
            font-weight: 600;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: var(--radius-full);
        }

        .badge-success {
            background-color: var(--color-success);
            color: var(--color-surface);
        }

        .badge-warning {
            background-color: var(--color-warning);
            color: var(--color-text);
        }

        .badge-verified {
            background-color: var(--color-primary-light);
            color: var(--color-surface);
            font-size: var(--text-xs);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            margin-left: var(--space-1);
            vertical-align: middle;
        }


        /* Modals (Conceptual - not implemented in this SPA structure, but good to have styles) */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-base);
        }

        .modal-backdrop.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--color-surface);
            padding: var(--space-8);
            border-radius: var(--radius-lg);
            max-width: 600px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            transform: translateY(-20px);
            transition: var(--transition-base);
        }

        .modal-backdrop.active .modal-content {
            transform: translateY(0);
        }

        /* Map Placeholder */
        .map-canvas {
            height: 300px;
            background: var(--color-surface-dark);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-text-muted);
            border: 1px solid var(--color-border);
            margin: var(--space-4) 0;
        }

        /* Gallery */
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .gallery img {
            height: 150px;
            width: 100%;
            object-fit: cover;
            border-radius: var(--radius-md);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            border: 1px solid var(--color-border);
        }

        .gallery img:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-lg);
        }

        .gallery-main-image {
            grid-column: 1 / -1;
            /* Span full width if it's the first image */
            height: 400px !important;
            margin-bottom: var(--space-2);
        }


        /* Calendar */
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: var(--space-1);
            background-color: var(--color-surface);
            padding: var(--space-3);
            border-radius: var(--radius-md);
            border: 1px solid var(--color-border);
        }

        .calendar-header {
            text-align: center;
            font-weight: 600;
            padding: var(--space-2);
            font-size: var(--text-sm);
            color: var(--color-text-muted);
        }

        .calendar-day {
            padding: var(--space-2);
            text-align: center;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition-fast);
            border: 1px solid transparent;
        }

        .calendar-day:hover:not(.booked):not(.empty) {
            background-color: var(--color-primary-light);
            color: var(--color-surface);
        }

        .calendar-day.available {
            /* Default state */
        }

        .calendar-day.booked {
            background-color: var(--color-warning);
            color: var(--color-text);
            cursor: not-allowed;
            opacity: 0.7;
        }

        .calendar-day.selected {
            background-color: var(--color-primary);
            color: var(--color-surface);
            font-weight: bold;
        }

        .calendar-day.empty {
            visibility: hidden;
            cursor: default;
        }

        .calendar-day.today {
            border: 1px solid var(--color-primary);
            font-weight: bold;
        }


        /* Chat Window (in Profile or Chatbox) */
        .chat-container {
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            display: flex;
            flex-direction: column;
            height: 400px;
            /* Default height */
        }

        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: var(--space-4);
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .chat-message {
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-lg);
            max-width: 75%;
            word-wrap: break-word;
        }

        .chat-message.sent {
            background: var(--color-primary);
            color: var(--color-surface);
            align-self: flex-end;
            border-bottom-right-radius: var(--radius-sm);
        }

        .chat-message.received {
            background: var(--color-surface-dark);
            color: var(--color-text);
            align-self: flex-start;
            border-bottom-left-radius: var(--radius-sm);
        }

        .chat-message.system {
            background: var(--color-surface-dark);
            color: var(--color-text-muted);
            align-self: center;
            font-size: var(--text-xs);
            font-style: italic;
            padding: var(--space-1) var(--space-2);
        }

        .chat-input-area {
            display: flex;
            padding: var(--space-3);
            border-top: 1px solid var(--color-border);
            gap: var(--space-2);
        }

        .chat-input-area input {
            flex-grow: 1;
            border-right: none;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }

        .chat-input-area button {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }

        /* Payment Methods */
        .payment-methods {
            display: flex;
            gap: var(--space-3);
            flex-wrap: wrap;
            margin-bottom: var(--space-4);
        }

        .payment-method {
            padding: var(--space-3);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-base);
            display: flex;
            align-items: center;
            gap: var(--space-2);
            flex-grow: 1;
            /* Make them distribute space */
            min-width: 150px;
            /* Ensure they don't get too small */
        }

        .payment-method:hover {
            border-color: var(--color-primary-light);
            background-color: var(--color-surface-dark);
        }

        .payment-method.selected {
            border-color: var(--color-primary);
            background-color: var(--color-primary-light);
            color: var(--color-surface);
            font-weight: 500;
        }

        .payment-method i {
            font-size: var(--text-xl);
        }

        /* Cost Breakdown */
        .cost-breakdown {
            background: var(--color-surface-dark);
            padding: var(--space-4);
            border-radius: var(--radius-md);
            margin-top: var(--space-4);
            border: 1px solid var(--color-border);
        }

        .cost-breakdown h3 {
            font-size: var(--text-lg);
            margin-bottom: var(--space-3);
        }

        .cost-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--space-2);
            font-size: var(--text-sm);
        }

        .cost-line span:last-child {
            font-weight: 500;
        }

        .cost-line.total {
            font-size: var(--text-base);
            font-weight: bold;
            padding-top: var(--space-2);
            border-top: 1px dashed var(--color-border);
            margin-top: var(--space-2);
        }

        .cost-line.total span:last-child {
            color: var(--color-primary);
        }

        /* Escrow Info Box */
        .escrow-info {
            background: #fffbeb;
            /* Light yellow for info */
            color: #713f12;
            /* Dark yellow text */
            padding: var(--space-3) var(--space-4);
            border-left: 4px solid var(--color-warning);
            margin: var(--space-4) 0;
            border-radius: var(--radius-sm);
            font-size: var(--text-sm);
        }

        [data-theme="dark"] .escrow-info {
            background: #42310e;
            color: #fef3c7;
        }

        /* Floating Chatbox */
        .chatbox-toggle-btn {
            position: fixed;
            bottom: var(--space-6);
            right: var(--space-6);
            z-index: 1001;
            width: 60px;
            height: 60px;
            border-radius: var(--radius-full);
            font-size: var(--text-2xl);
            box-shadow: var(--shadow-lg);
        }

        .floating-chatbox {
            position: fixed;
            bottom: calc(var(--space-6) + 70px);
            /* Above toggle button */
            right: var(--space-6);
            background: var(--color-surface);
            width: 350px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            display: flex;
            /* Use flex for initial state if open by default */
            flex-direction: column;
            height: 450px;
            z-index: 1001;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            transform: translateY(20px);
            opacity: 0;
            visibility: hidden;
        }

        .floating-chatbox.open {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }

        .chatbox-header {
            background: var(--color-primary);
            color: var(--color-surface);
            padding: var(--space-3) var(--space-4);
            border-top-left-radius: var(--radius-lg);
            border-top-right-radius: var(--radius-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chatbox-header h4 {
            margin-bottom: 0;
            font-size: var(--text-lg);
        }

        .chatbox-close-btn {
            background: none;
            border: none;
            color: var(--color-surface);
            font-size: var(--text-xl);
            cursor: pointer;
        }

        /* Footer */
        .app-footer {
            background-color: var(--color-surface-dark);
            padding: var(--space-6) 0;
            text-align: center;
            font-size: var(--text-sm);
            color: var(--color-text-muted);
            border-top: 1px solid var(--color-border);
            margin-top: var(--space-12);
            /* Ensure space before footer */
        }

        /* ======= RESPONSIVE DESIGN ======= */
        @media (max-width: 1024px) {
            .property-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }

            .form-section.grid-cols-3,
            .form-section.grid-cols-4 {
                grid-template-columns: repeat(2, 1fr);
            }

            .gallery {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }

            .gallery-main-image {
                height: 300px !important;
            }
        }

        @media (max-width: 768px) {
            :root {
                --header-height: 60px;
                /* Adjust font sizes for smaller screens */
                --text-xl: 1.125rem;
                --text-2xl: 1.375rem;
                --text-3xl: 1.625rem;
                --text-4xl: 2rem;
            }

            h1 {
                font-size: var(--text-3xl);
            }

            h2 {
                font-size: var(--text-2xl);
            }

            .navbar {
                padding: 0 var(--space-2);
                /* Less padding on mobile */
            }

            .nav-links {
                /* Mobile menu - to be implemented with JS for toggle */
                display: none;
                /* Hidden by default, shown via JS */
                position: absolute;
                top: var(--header-height);
                left: 0;
                right: 0;
                background-color: var(--color-surface);
                flex-direction: column;
                align-items: stretch;
                /* Stretch links */
                padding: var(--space-4);
                box-shadow: var(--shadow-md);
                border-top: 1px solid var(--color-border);
            }

            .nav-links.open {
                display: flex;
            }

            .nav-links a {
                padding: var(--space-3);
                text-align: center;
                border-bottom: 1px solid var(--color-surface-dark);
            }

            .nav-links a:last-child {
                border-bottom: none;
            }

            .mobile-menu-toggle {
                /* Add a hamburger icon */
                display: block;
                /* Show on mobile */
                background: none;
                border: none;
                font-size: var(--text-2xl);
                cursor: pointer;
                color: var(--color-text);
            }

            .theme-toggle-btn {
                margin-left: auto;
                margin-right: var(--space-2);
            }

            /* Adjust theme toggle position */


            .property-grid,
            .grid-cols-2,
            .grid-cols-3,
            .grid-cols-4,
            .form-section.grid-cols-2,
            .form-section.grid-cols-3,
            .form-section.grid-cols-4 {
                grid-template-columns: 1fr;
            }

            #apartment-detail-content.grid-cols-2 {
                grid-template-columns: 1fr;
            }

            /* Specific for apartment detail */


            .floating-chatbox {
                width: calc(100% - var(--space-8));
                /* Almost full width */
                height: 70vh;
                bottom: var(--space-4);
                right: var(--space-4);
                left: var(--space-4);
            }

            .chatbox-toggle-btn {
                bottom: var(--space-4);
                right: var(--space-4);
            }

            .payment-method {
                min-width: 120px;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: var(--text-xl);
            }

            .btn {
                padding: var(--space-2) var(--space-4);
                font-size: var(--text-sm);
            }

            .form-control,
            .form-select {
                padding: var(--space-2) var(--space-3);
            }

            .gallery-main-image {
                height: 250px !important;
            }
        }


        /* ======= ACCESSIBILITY & ANIMATIONS ======= */
        @media (prefers-reduced-motion: reduce) {

            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        .sr-only {
            /* Screen reader only */
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="app-header">
        <div class="container">
            <nav class="navbar">
                <a href="#home" class="logo" aria-label="Rentelindo - Kembali ke Beranda">Rentelindo</a>
                <div class="d-flex items-center">
                    <button id="theme-toggle" class="theme-toggle-btn" aria-label="Toggle dark mode">
                        <i class="fas fa-moon"></i> <!-- Icon will change with JS -->
                    </button>
                    <button class="mobile-menu-toggle hidden" aria-label="Buka menu navigasi" aria-expanded="false">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="nav-links" id="main-nav-links">
                        <a href="#home" class="nav-item active" data-page="home">Beranda</a>
                        <a href="#search" class="nav-item" data-page="search">Cari Apartemen</a>
                        <a href="#profile" class="nav-item" data-page="profile">Profil Saya</a>
                        <a href="#support" class="nav-item" data-page="support">Dukungan</a>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content Area (SPA Views will be injected here or toggled) -->
    <main id="app-main-content">
        <!-- Home Section -->
        <section id="home" class="page-section container py-8">
            <header class="text-center my-8">
                <h1>Sewa Apartemen Impian Anda dengan Mudah</h1>
                <p class="text-lg text-muted">Temukan apartemen modern dengan fasilitas premium di lokasi strategis.
                    Proses cepat, aman, dan terpercaya.</p>
            </header>

            <form id="quick-search-form" class="form-section d-grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                <div class="form-group">
                    <label class="form-label" for="quick-location">Destinasi atau Nama Properti</label>
                    <input type="text" id="quick-location" class="form-control"
                        placeholder="Contoh: Jakarta, Apartemen Sudirman" aria-label="Cari lokasi atau nama properti">
                </div>
                <div class="form-group">
                    <label class="form-label" for="quick-checkin">Tanggal Check-in</label>
                    <input type="date" id="quick-checkin" class="form-control" aria-label="Tanggal check-in">
                </div>
                <div class="form-group">
                    <label class="form-label" for="quick-checkout">Tanggal Check-out</label>
                    <input type="date" id="quick-checkout" class="form-control" aria-label="Tanggal check-out">
                </div>
                <button type="submit" class="btn btn-primary btn-block"><i class="fas fa-search"></i> Cari
                    Sekarang</button>
            </form>

            <h2 class="mt-12 mb-6">Properti Unggulan Kami</h2>
            <div class="property-grid" id="featured-properties">
                <!-- Property cards will be injected by JavaScript -->
                <p>Memuat properti unggulan...</p>
            </div>
        </section>

        <!-- Search Results Section -->
        <section id="search" class="page-section container py-8 hidden">
            <h1 class="mb-6">Hasil Pencarian Apartemen</h1>
            <div class="d-grid grid-cols-1 lg:grid-cols-4 gap-8">
                <!-- Filters Column -->
                <aside class="lg:col-span-1">
                    <form id="filter-form" class="form-section p-6">
                        <h3 class="mb-4">Filter Pencarian</h3>
                        <div class="form-group">
                            <label class="form-label" for="filter-location">Lokasi</label>
                            <input type="text" id="filter-location" class="form-control" placeholder="Kota atau area">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="filter-price-range">Rentang Harga (per malam/bulan)</label>
                            <input type="range" id="filter-price-range" class="form-control" min="100000" max="20000000"
                                step="100000" value="5000000">
                            <p class="text-sm text-muted text-right">Maks: Rp<span
                                    id="price-range-value">5.000.000</span></p>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Fasilitas Unggulan</label>
                            <div id="filter-amenities" class="d-flex flex-column gap-2">
                                <label class="form-check"><input type="checkbox" name="amenity" value="pool"> Kolam
                                    Renang</label>
                                <label class="form-check"><input type="checkbox" name="amenity" value="gym"> Gym</label>
                                <label class="form-check"><input type="checkbox" name="amenity" value="wifi"> WiFi
                                    Cepat</label>
                                <label class="form-check"><input type="checkbox" name="amenity" value="parking"> Parkir
                                    Gratis</label>
                                <label class="form-check"><input type="checkbox" name="amenity" value="ac"> AC</label>
                                <label class="form-check"><input type="checkbox" name="amenity" value="kitchen"> Dapur
                                    Lengkap</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="filter-apartment-type">Tipe Apartemen</label>
                            <select id="filter-apartment-type" class="form-select">
                                <option value="">Semua Tipe</option>
                                <option value="studio">Studio</option>
                                <option value="1br">1 Kamar Tidur</option>
                                <option value="2br">2 Kamar Tidur</option>
                                <option value="3br">3+ Kamar Tidur</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block mt-6"><i class="fas fa-filter"></i>
                            Terapkan Filter</button>
                    </form>
                </aside>

                <!-- Results Column -->
                <div class="lg:col-span-3">
                    <div class="d-flex justify-between items-center mb-4">
                        <p id="search-results-info" class="text-muted">Menampilkan hasil...</p>
                        <div>
                            <label for="sort-by" class="sr-only">Urutkan berdasarkan</label>
                            <select id="sort-by" class="form-select" style="width: auto;">
                                <option value="relevance">Relevansi</option>
                                <option value="price_asc">Harga Terendah</option>
                                <option value="price_desc">Harga Tertinggi</option>
                                <option value="rating_desc">Rating Tertinggi</option>
                            </select>
                        </div>
                    </div>
                    <div class="property-grid" id="search-results-grid">
                        <!-- Search results will be injected by JavaScript -->
                        <p>Memuat hasil pencarian...</p>
                    </div>
                    <div id="pagination-controls" class="d-flex justify-center mt-8 gap-2">
                        <!-- Pagination buttons will be injected by JavaScript -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Apartment Detail Section -->
        <section id="apartment-detail" class="page-section container py-8 hidden">
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="d-flex gap-2 text-sm text-muted">
                    <li><a href="#search" data-page="search">Hasil Pencarian</a></li>
                    <li><span aria-hidden="true">/</span></li>
                    <li id="breadcrumb-apartment-name" aria-current="page">Detail Apartemen</li>
                </ol>
            </nav>
            <h1 id="apartment-title" class="mb-2">Nama Apartemen Detail</h1>
            <div class="d-flex items-center gap-4 mb-6">
                <p class="text-muted mb-0" id="apartment-location-subheader"><i class="fas fa-map-marker-alt"></i>
                    Lokasi Apartemen</p>
                <p class="text-muted mb-0" id="apartment-rating-subheader"><i class="fas fa-star text-warning"></i> 4.5
                    (20 ulasan)</p>
            </div>

            <div class="gallery mb-8" id="apartment-gallery">
                <!-- Gallery images will be injected by JavaScript -->
            </div>
            <div id="apartment-detail-content" class="d-grid grid-cols-1 md:grid-cols-3 gap-8">
                <article class="md:col-span-2">
                    <h2 class="mb-4">Deskripsi Apartemen</h2>
                    <p id="apartment-description">Deskripsi lengkap mengenai apartemen, fasilitas, dan lingkungan
                        sekitar...</p>

                    <h3 class="mt-6 mb-3">Fasilitas Utama</h3>
                    <ul id="apartment-amenities-list" class="d-grid grid-cols-2 md:grid-cols-3 gap-3 text-sm">
                        <!-- Amenities will be injected by JavaScript -->
                    </ul>

                    <h3 class="mt-6 mb-3">Peta Lokasi</h3>
                    <div class="map-canvas" id="apartment-map-canvas" aria-label="Peta lokasi apartemen">Peta Lokasi
                        Apartemen (Simulasi)</div>
                    <p><a href="#" id="apartment-gmaps-link" target="_blank" rel="noopener noreferrer"
                            class="btn btn-outline-primary btn-sm"><i class="fas fa-map-marked-alt"></i> Lihat di Google
                            Maps</a></p>

                    <h3 class="mt-8 mb-4">Ulasan Tamu (<span id="review-count">0</span>)</h3>
                    <div id="apartment-reviews-container">
                        <!-- Reviews will be injected by JavaScript -->
                    </div>
                    <button class="btn btn-outline-primary mt-4" id="load-more-reviews">Lihat Semua Ulasan</button>

                    <div id="report-review-form-container" class="form-section mt-6 hidden">
                        <h4>Laporkan Ulasan</h4>
                        <form id="report-review-form">
                            <input type="hidden" id="report-review-id">
                            <div class="form-group">
                                <label for="report-reason" class="form-label">Alasan Pelaporan</label>
                                <textarea id="report-reason" class="form-control" rows="3"
                                    placeholder="Jelaskan mengapa ulasan ini tidak pantas..." required></textarea>
                            </div>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-danger">Kirim Laporan</button>
                                <button type="button" class="btn btn-outline-primary"
                                    id="cancel-report-review">Batal</button>
                            </div>
                        </form>
                    </div>
                </article>

                <aside class="md:col-span-1">
                    <div class="form-section p-6 sticky-sidebar"
                        style="top: calc(var(--header-height) + var(--space-4));">
                        <h3 class="mb-1">Mulai dari <span id="apartment-price-display" class="text-primary font-bold">Rp
                                0</span></h3>
                        <p class="text-sm text-muted mb-4">per malam/bulan (sesuai pilihan)</p>
                        <form id="booking-form">
                            <input type="hidden" id="apartment-id-booking">
                            <div class="form-group">
                                <label class="form-label" for="book-checkin">Check-in</label>
                                <input type="date" id="book-checkin" class="form-control" required
                                    aria-label="Tanggal check-in pemesanan">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="book-checkout">Check-out</label>
                                <input type="date" id="book-checkout" class="form-control" required
                                    aria-label="Tanggal check-out pemesanan">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="book-guests">Jumlah Tamu</label>
                                <input type="number" id="book-guests" class="form-control" min="1" value="1" required
                                    aria-label="Jumlah tamu">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Metode Pembayaran</label>
                                <div id="payment-methods-container" class="payment-methods" role="radiogroup"
                                    aria-label="Pilih metode pembayaran">
                                    <!-- Payment methods will be injected by JavaScript -->
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-check"><input type="checkbox" id="book-insurance"
                                        aria-label="Tambah asuransi perjalanan"> Tambah Asuransi Perjalanan
                                    (+10%)</label>
                            </div>

                            <div class="cost-breakdown hidden my-4" id="cost-breakdown-summary">
                                <h4 class="text-base font-semibold">Rincian Biaya</h4>
                                <div class="cost-line"><span>Harga Sewa</span><span id="base-cost-value">Rp 0</span>
                                </div>
                                <div class="cost-line"><span>Biaya Layanan (5%)</span><span id="service-cost-value">Rp
                                        0</span></div>
                                <div class="cost-line hidden" id="insurance-cost-line"><span>Asuransi</span><span
                                        id="insurance-cost-value">Rp 0</span></div>
                                <hr class="my-2 border-dashed">
                                <div class="cost-line total"><span>Total Pembayaran</span><span id="total-cost-value">Rp
                                        0</span></div>
                            </div>

                            <p class="escrow-info"><i class="fas fa-shield-alt"></i> Pembayaran Anda dijamin aman
                                melalui sistem escrow kami hingga proses check-in selesai.</p>
                            <button type="submit" class="btn btn-primary btn-block"><i
                                    class="fas fa-calendar-check"></i> Pesan Sekarang</button>
                        </form>
                    </div>
                </aside>
            </div>
        </section>

        <!-- Profile Section -->
        <section id="profile" class="page-section container py-8 hidden">
            <h1 class="mb-6">Profil Pengguna</h1>
            <div class="d-grid grid-cols-1 md:grid-cols-3 gap-8">
                <article class="md:col-span-1 form-section p-6">
                    <h2 class="text-2xl mb-4">Informasi Akun</h2>
                    <div class="d-flex items-center gap-4 mb-4">
                        <img src="https://source.unsplash.com/random/100x100/?portrait" alt="Foto Profil John Doe"
                            class="rounded-full" style="width:80px; height:80px; object-fit:cover;">
                        <div>
                            <h3 id="user-profile-name" class="text-xl mb-1">John Doe</h3>
                            <p id="user-profile-email" class="text-sm text-muted mb-0">john.doe@example.com</p>
                        </div>
                    </div>
                    <p><i class="fas fa-medal text-warning"></i> Poin Loyalitas: <span class="badge badge-warning"
                            id="user-loyalty-points">1250</span></p>
                    <p><i class="fas fa-user-check text-success"></i> Status Akun: <span
                            class="badge badge-success">Terverifikasi</span></p>
                    <button class="btn btn-outline-primary btn-block mt-6" id="edit-profile-btn"><i
                            class="fas fa-edit"></i> Edit Profil</button>
                    <button class="btn btn-danger btn-block mt-2" id="logout-btn"><i class="fas fa-sign-out-alt"></i>
                        Keluar</button>
                </article>

                <article class="md:col-span-2 form-section p-6">
                    <h2 class="text-2xl mb-4">Riwayat Pemesanan Anda</h2>
                    <div id="booking-history-container" class="d-flex flex-column gap-4">
                        <!-- Booking history items will be injected by JavaScript -->
                        <p>Tidak ada riwayat pemesanan.</p>
                    </div>
                </article>
            </div>

            <article class="form-section p-6 mt-8">
                <h2 class="text-2xl mb-4">Pesan dengan Admin/Pemilik Properti</h2>
                <div class="chat-container">
                    <div class="chat-messages" id="profile-chat-messages">
                        <div class="chat-message received">Halo! Ada yang bisa kami bantu terkait pemesanan Anda?</div>
                        <div class="chat-message sent">Saya ingin bertanya tentang fasilitas parkir di Apartemen
                            Sudirman.</div>
                    </div>
                    <div class="chat-input-area">
                        <input type="text" id="profile-chat-input" class="form-control"
                            placeholder="Ketik pesan Anda..." aria-label="Input chat profil">
                        <button id="profile-send-chat-btn" class="btn btn-primary"><i class="fas fa-paper-plane"></i>
                            Kirim</button>
                    </div>
                </div>
            </article>
        </section>

        <!-- Support Section -->
        <section id="support" class="page-section container py-8 hidden">
            <header class="text-center my-8">
                <h1 class="mb-4">Pusat Bantuan Rentelindo</h1>
                <p class="text-lg text-muted">Kami siap membantu Anda 24/7. Temukan jawaban atas pertanyaan Anda atau
                    hubungi tim dukungan kami.</p>
            </header>

            <div class="d-grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <article class="form-section p-6 text-center">
                    <i class="fas fa-comments fa-3x text-primary mb-3"></i>
                    <h3 class="text-xl mb-2">Live Chat</h3>
                    <p class="text-sm text-muted mb-3">Dapatkan bantuan instan dari tim kami.</p>
                    <button class="btn btn-primary" id="support-open-chat-btn"><i class="fas fa-comment-dots"></i> Mulai
                        Chat Sekarang</button>
                </article>
                <article class="form-section p-6 text-center">
                    <i class="fas fa-envelope fa-3x text-primary mb-3"></i>
                    <h3 class="text-xl mb-2">Email Dukungan</h3>
                    <p class="text-sm text-muted mb-3">Kirimkan pertanyaan Anda melalui email.</p>
                    <a href="mailto:dukungan@rentelindo.com" class="btn btn-primary"><i class="fas fa-paper-plane"></i>
                        Kirim Email</a>
                </article>
                <article class="form-section p-6 text-center">
                    <i class="fas fa-phone-alt fa-3x text-primary mb-3"></i>
                    <h3 class="text-xl mb-2">Hotline Telepon</h3>
                    <p class="text-sm text-muted mb-3">Hubungi kami langsung (08:00 - 22:00 WIB).</p>
                    <a href="tel:+628001234567" class="btn btn-primary"><i class="fas fa-phone"></i>
                        +62-800-123-4567</a>
                </article>
            </div>

            <div class="form-section p-6">
                <h2 class="text-2xl mb-4">Pertanyaan Umum (FAQ)</h2>
                <div id="faq-container" class="d-flex flex-column gap-3">
                    <!-- FAQ items will be injected by JavaScript -->
                    <details class="faq-item">
                        <summary class="font-semibold cursor-pointer p-3 rounded-md hover:bg-surface-dark">Bagaimana
                            cara melakukan pemesanan?</summary>
                        <p class="p-3 text-sm">Anda dapat mencari properti, memilih tanggal, dan mengikuti proses
                            pemesanan di halaman detail properti.</p>
                    </details>
                </div>
            </div>
        </section>
    </main>

    <!-- Floating Chatbox Button -->
    <button class="btn btn-primary chatbox-toggle-btn" id="chatbox-toggle" aria-label="Buka chat dukungan">
        <i class="fas fa-comments"></i>
    </button>

    <!-- Floating Chatbox -->
    <aside class="floating-chatbox" id="floating-chatbox-container" aria-live="polite" aria-atomic="true">
        <header class="chatbox-header">
            <h4>Butuh Bantuan?</h4>
            <button id="chatbox-close" class="chatbox-close-btn" aria-label="Tutup chat dukungan"><i
                    class="fas fa-times"></i></button>
        </header>
        <div class="chat-messages" id="floating-chat-messages">
            <div class="chat-message system">Selamat datang di Rentelindo! Ada yang bisa kami bantu?</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="floating-chat-input" class="form-control" placeholder="Ketik pesan Anda..."
                aria-label="Input chat dukungan">
            <button id="floating-send-chat-btn" class="btn btn-primary"><i class="fas fa-paper-plane"></i></button>
        </div>
    </aside>

    <!-- Footer -->
    <footer class="app-footer">
        <div class="container">
            <p>&copy; <span id="current-year">2024</span> Rentelindo Global. Hak cipta dilindungi undang-undang.</p>
            <p class="text-xs">Platform Penyewaan Apartemen Modern & Terpercaya Se-Indonesia</p>
        </div>
    </footer>

    <script>
        // Namespace untuk aplikasi (mencegah polusi global scope)
        const RentelindoApp = (() => {
            // ======= STATE MANAGEMENT =======
            const state = {
                currentPage: 'home',
                properties: [],
                featuredProperties: [],
                searchResults: [],
                currentApartment: null,
                bookingHistory: [],
                userProfile: {
                    name: "Pengguna Rentelindo",
                    email: "pengguna@example.com",
                    loyaltyPoints: 0,
                    isVerified: false,
                    avatar: "https://source.unsplash.com/random/100x100/?user"
                },
                searchFilters: {
                    location: '',
                    checkin: '',
                    checkout: '',
                    priceMax: 20000000,
                    amenities: [],
                    type: '',
                    sortBy: 'relevance',
                    currentPage: 1,
                    itemsPerPage: 6
                },
                ui: {
                    isMobileMenuOpen: false,
                    isChatboxOpen: false,
                    theme: localStorage.getItem('theme') || 'light'
                }
            };

            // ======= MOCK DATA & SERVICES =======
            const MOCK_PROPERTIES = [
                // ... (Data properti yang lebih banyak dan detail ada di bawah)
            ]; // Akan diisi di init()

            const PaymentService = {
                processPayment: async (amount, paymentMethod, cardDetails = null) => {
                    // Simulasi proses pembayaran
                    console.log(`Memproses pembayaran Rp ${amount.toLocaleString('id-ID')} via ${paymentMethod}`);
                    await new Promise(resolve => setTimeout(resolve, 1500)); // Jeda simulasi
                    if (Math.random() > 0.1) { // 90% success rate
                        return { success: true, transactionId: 'TXN' + Date.now() + Math.random().toString(36).substr(2, 9).toUpperCase(), message: "Pembayaran berhasil!" };
                    } else {
                        return { success: false, message: "Pembayaran gagal. Silakan coba metode lain atau periksa detail Anda." };
                    }
                }
            };

            const MapService = {
                initMap: (elementId, locationName, coordinates = { lat: -6.200000, lng: 106.816666 }) => {
                    const mapElement = document.getElementById(elementId);
                    if (mapElement) {
                        mapElement.innerHTML = `
                            <div style="width:100%; height:100%; background-color: #e0e0e0; display:flex; align-items:center; justify-content:center; text-align:center; flex-direction:column;">
                                <i class="fas fa-map-marked-alt fa-3x text-muted mb-2"></i>
                                <p class="text-muted">Peta Lokasi (Simulasi)<br><strong>${locationName}</strong></p>
                                <p class="text-xs text-muted">Lat: ${coordinates.lat.toFixed(4)}, Lng: ${coordinates.lng.toFixed(4)}</p>
                            </div>
                        `;
                        // Di aplikasi nyata, di sini akan ada inisialisasi Google Maps, Leaflet, dll.
                    }
                }
            };

            const ChatService = {
                sendMessage: async (message, recipient = 'support') => {
                    console.log(`Mengirim pesan "${message}" ke ${recipient}`);
                    await new Promise(resolve => setTimeout(resolve, 700));
                    const responses = [
                        "Baik, kami catat pesan Anda.",
                        "Terima kasih atas informasinya, akan segera kami tindak lanjuti.",
                        "Mohon tunggu sebentar, kami sedang memeriksa permintaan Anda.",
                        "Ada lagi yang bisa kami bantu?",
                        `Kami mengerti. Mengenai "${message.substring(0, 20)}...", tim kami akan segera menghubungi Anda.`
                    ];
                    return { success: true, reply: responses[Math.floor(Math.random() * responses.length)] };
                }
            };

            // ======= UTILITIES =======
            const Utils = {
                $: (selector, parent = document) => parent.querySelector(selector),
                $$: (selector, parent = document) => Array.from(parent.querySelectorAll(selector)),
                formatCurrency: (amount, locale = 'id-ID', currency = 'IDR') => {
                    return new Intl.NumberFormat(locale, { style: 'currency', currency: currency, minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(amount);
                },
                formatDate: (dateString) => {
                    if (!dateString) return 'N/A';
                    const date = new Date(dateString);
                    return date.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
                },
                daysBetween: (date1, date2) => {
                    const d1 = new Date(date1);
                    const d2 = new Date(date2);
                    if (isNaN(d1) || isNaN(d2) || d2 <= d1) return 0;
                    return Math.ceil((d2 - d1) / (1000 * 60 * 60 * 24));
                },
                // Simple debounce function
                debounce: (func, delay) => {
                    let timeout;
                    return function (...args) {
                        const context = this;
                        clearTimeout(timeout);
                        timeout = setTimeout(() => func.apply(context, args), delay);
                    };
                },
                // Sanitize HTML to prevent XSS (basic version for demo)
                sanitizeHTML: (str) => {
                    const temp = document.createElement('div');
                    temp.textContent = str;
                    return temp.innerHTML;
                },
                // Generate a unique ID
                generateId: () => '_' + Math.random().toString(36).substr(2, 9),
                // Get today's date in YYYY-MM-DD format for date inputs
                getTodayDate: () => new Date().toISOString().split('T')[0],
                // Get date N days from today
                getDateAfterDays: (days) => {
                    const date = new Date();
                    date.setDate(date.getDate() + days);
                    return date.toISOString().split('T')[0];
                }
            };

            // ======= DOM ELEMENTS CACHE =======
            // Cache frequently accessed DOM elements after document is ready
            const DOMElements = {};
            function cacheDOMElements() {
                DOMElements.appHeader = Utils.$('.app-header');
                DOMElements.mainNavLinks = Utils.$('#main-nav-links');
                DOMElements.mobileMenuToggle = Utils.$('.mobile-menu-toggle');
                DOMElements.themeToggleButton = Utils.$('#theme-toggle');
                DOMElements.appMainContent = Utils.$('#app-main-content');
                DOMElements.pageSections = Utils.$$('#app-main-content > .page-section');
                DOMElements.currentYearSpan = Utils.$('#current-year');

                // Home Page
                DOMElements.quickSearchForm = Utils.$('#quick-search-form');
                DOMElements.quickLocationInput = Utils.$('#quick-location');
                DOMElements.quickCheckinInput = Utils.$('#quick-checkin');
                DOMElements.quickCheckoutInput = Utils.$('#quick-checkout');
                DOMElements.featuredPropertiesGrid = Utils.$('#featured-properties');

                // Search Page
                DOMElements.filterForm = Utils.$('#filter-form');
                DOMElements.filterLocationInput = Utils.$('#filter-location');
                DOMElements.filterPriceRangeInput = Utils.$('#filter-price-range');
                DOMElements.priceRangeValueSpan = Utils.$('#price-range-value');
                DOMElements.filterAmenitiesContainer = Utils.$('#filter-amenities');
                DOMElements.filterApartmentTypeSelect = Utils.$('#filter-apartment-type');
                DOMElements.searchResultsInfo = Utils.$('#search-results-info');
                DOMElements.sortBySelect = Utils.$('#sort-by');
                DOMElements.searchResultsGrid = Utils.$('#search-results-grid');
                DOMElements.paginationControls = Utils.$('#pagination-controls');

                // Apartment Detail Page
                DOMElements.breadcrumbApartmentName = Utils.$('#breadcrumb-apartment-name');
                DOMElements.apartmentTitle = Utils.$('#apartment-title');
                DOMElements.apartmentLocationSubheader = Utils.$('#apartment-location-subheader');
                DOMElements.apartmentRatingSubheader = Utils.$('#apartment-rating-subheader');
                DOMElements.apartmentGallery = Utils.$('#apartment-gallery');
                DOMElements.apartmentDescription = Utils.$('#apartment-description');
                DOMElements.apartmentAmenitiesList = Utils.$('#apartment-amenities-list');
                DOMElements.apartmentMapCanvas = Utils.$('#apartment-map-canvas');
                DOMElements.apartmentGmapsLink = Utils.$('#apartment-gmaps-link');
                DOMElements.reviewCountSpan = Utils.$('#review-count');
                DOMElements.apartmentReviewsContainer = Utils.$('#apartment-reviews-container');
                DOMElements.loadMoreReviewsButton = Utils.$('#load-more-reviews');
                DOMElements.reportReviewFormContainer = Utils.$('#report-review-form-container');
                DOMElements.reportReviewForm = Utils.$('#report-review-form');
                DOMElements.reportReviewIdInput = Utils.$('#report-review-id');
                DOMElements.reportReasonTextarea = Utils.$('#report-reason');
                DOMElements.cancelReportReviewButton = Utils.$('#cancel-report-review');

                DOMElements.apartmentPriceDisplay = Utils.$('#apartment-price-display');
                DOMElements.bookingForm = Utils.$('#booking-form');
                DOMElements.apartmentIdBookingInput = Utils.$('#apartment-id-booking');
                DOMElements.bookCheckinInput = Utils.$('#book-checkin');
                DOMElements.bookCheckoutInput = Utils.$('#book-checkout');
                DOMElements.bookGuestsInput = Utils.$('#book-guests');
                DOMElements.paymentMethodsContainer = Utils.$('#payment-methods-container');
                DOMElements.bookInsuranceCheckbox = Utils.$('#book-insurance');
                DOMElements.costBreakdownSummary = Utils.$('#cost-breakdown-summary');
                DOMElements.baseCostValue = Utils.$('#base-cost-value');
                DOMElements.serviceCostValue = Utils.$('#service-cost-value');
                DOMElements.insuranceCostLine = Utils.$('#insurance-cost-line');
                DOMElements.insuranceCostValue = Utils.$('#insurance-cost-value');
                DOMElements.totalCostValue = Utils.$('#total-cost-value');

                // Profile Page
                DOMElements.userProfileName = Utils.$('#user-profile-name');
                DOMElements.userProfileEmail = Utils.$('#user-profile-email');
                DOMElements.userLoyaltyPoints = Utils.$('#user-loyalty-points');
                // DOMElements.userProfileAvatar = Utils.$('#user-profile-avatar'); // Assuming img src is set dynamically
                DOMElements.editProfileButton = Utils.$('#edit-profile-btn');
                DOMElements.logoutButton = Utils.$('#logout-btn');
                DOMElements.bookingHistoryContainer = Utils.$('#booking-history-container');
                DOMElements.profileChatMessages = Utils.$('#profile-chat-messages');
                DOMElements.profileChatInput = Utils.$('#profile-chat-input');
                DOMElements.profileSendChatButton = Utils.$('#profile-send-chat-btn');

                // Support Page
                DOMElements.supportOpenChatButton = Utils.$('#support-open-chat-btn');
                DOMElements.faqContainer = Utils.$('#faq-container');

                // Floating Chatbox
                DOMElements.chatboxToggleButton = Utils.$('#chatbox-toggle');
                DOMElements.floatingChatboxContainer = Utils.$('#floating-chatbox-container');
                DOMElements.chatboxCloseButton = Utils.$('#chatbox-close');
                DOMElements.floatingChatMessages = Utils.$('#floating-chat-messages');
                DOMElements.floatingChatInput = Utils.$('#floating-chat-input');
                DOMElements.floatingSendChatButton = Utils.$('#floating-send-chat-btn');
            }

            // ======= RENDERING FUNCTIONS =======
            const Render = {
                propertyCard: (property) => {
                    const avgRating = property.reviews.length > 0 ? (property.reviews.reduce((acc, r) => acc + r.rating, 0) / property.reviews.length).toFixed(1) : 'Baru';
                    const reviewCount = property.reviews.length;
                    const verifiedBadge = property.ownerVerified ? `<span class="badge-verified" title="Pemilik Terverifikasi"><i class="fas fa-check-circle"></i> Terverifikasi</span>` : '';

                    return `
                        <article class="property-card" data-id="${property.id}" tabindex="0" aria-labelledby="property-title-${property.id}">
                            <img src="${property.images[0]}" alt="Tampilan ${property.title}" class="property-image" loading="lazy">
                            <div class="property-details">
                                <h3 id="property-title-${property.id}">${Utils.sanitizeHTML(property.title)} ${verifiedBadge}</h3>
                                <p class="text-sm text-muted"><i class="fas fa-map-marker-alt"></i> ${Utils.sanitizeHTML(property.location)}</p>
                                <p class="property-price">${Utils.formatCurrency(property.price)} / ${property.priceType || 'malam'}</p>
                                <div class="d-flex items-center gap-2 text-sm text-muted mb-2">
                                    <span><i class="fas fa-bed"></i> ${property.bedrooms || 'Studio'}</span>
                                    <span><i class="fas fa-bath"></i> ${property.bathrooms || 1} Kamar Mandi</span>
                                    <span><i class="fas fa-users"></i> ${property.maxGuests || 2} Tamu</span>
                                </div>
                                <div class="d-flex items-center gap-1 text-sm mb-3">
                                    <i class="fas fa-star text-warning"></i> ${avgRating} 
                                    <span class="text-muted">(${reviewCount} ulasan)</span>
                                </div>
                                <button class="btn btn-primary btn-sm view-detail-btn" data-id="${property.id}" aria-label="Lihat detail untuk ${Utils.sanitizeHTML(property.title)}">
                                    <i class="fas fa-eye"></i> Lihat Detail
                                </button>
                            </div>
                        </article>
                    `;
                },
                featuredProperties: () => {
                    if (!DOMElements.featuredPropertiesGrid) return;
                    if (state.featuredProperties.length === 0) {
                        DOMElements.featuredPropertiesGrid.innerHTML = '<p class="text-muted col-span-full text-center">Tidak ada properti unggulan saat ini.</p>';
                        return;
                    }
                    DOMElements.featuredPropertiesGrid.innerHTML = state.featuredProperties
                        .slice(0, 4) // Show max 4 featured
                        .map(Render.propertyCard)
                        .join('');
                },
                searchResults: () => {
                    if (!DOMElements.searchResultsGrid) return;

                    const { currentPage, itemsPerPage } = state.searchFilters;
                    const totalItems = state.searchResults.length;
                    const totalPages = Math.ceil(totalItems / itemsPerPage);
                    const startIndex = (currentPage - 1) * itemsPerPage;
                    const endIndex = startIndex + itemsPerPage;
                    const paginatedResults = state.searchResults.slice(startIndex, endIndex);

                    if (totalItems === 0) {
                        DOMElements.searchResultsGrid.innerHTML = '<p class="text-muted col-span-full text-center">Tidak ada properti yang cocok dengan kriteria pencarian Anda.</p>';
                        DOMElements.searchResultsInfo.textContent = '0 hasil ditemukan.';
                    } else {
                        DOMElements.searchResultsGrid.innerHTML = paginatedResults.map(Render.propertyCard).join('');
                        DOMElements.searchResultsInfo.textContent = `Menampilkan ${startIndex + 1}-${Math.min(endIndex, totalItems)} dari ${totalItems} hasil.`;
                    }
                    Render.pagination(totalPages);
                },
                pagination: (totalPages) => {
                    if (!DOMElements.paginationControls) return;
                    let html = '';
                    const currentPage = state.searchFilters.currentPage;

                    if (totalPages <= 1) {
                        DOMElements.paginationControls.innerHTML = '';
                        return;
                    }

                    // Previous button
                    html += `<button class="btn btn-outline-primary btn-sm pagination-btn" data-page="${currentPage - 1}" ${currentPage === 1 ? 'disabled' : ''} aria-label="Halaman sebelumnya">
                                <i class="fas fa-chevron-left"></i>
                             </button>`;

                    // Page numbers
                    // Show first, last, current, and +/- 1 or 2 pages around current
                    const pagesToShow = [];
                    pagesToShow.push(1);
                    if (totalPages > 1) pagesToShow.push(totalPages);

                    for (let i = Math.max(2, currentPage - 2); i <= Math.min(totalPages - 1, currentPage + 2); i++) {
                        pagesToShow.push(i);
                    }
                    // Remove duplicates and sort
                    const uniquePages = [...new Set(pagesToShow)].sort((a, b) => a - b);

                    let lastPage = 0;
                    uniquePages.forEach(page => {
                        if (page - lastPage > 1) {
                            html += `<span class="pagination-ellipsis p-2">...</span>`;
                        }
                        html += `<button class="btn btn-sm pagination-btn ${page === currentPage ? 'btn-primary' : 'btn-outline-primary'}" data-page="${page}" aria-label="Halaman ${page}" ${page === currentPage ? 'aria-current="page"' : ''}>
                                    ${page}
                                 </button>`;
                        lastPage = page;
                    });


                    // Next button
                    html += `<button class="btn btn-outline-primary btn-sm pagination-btn" data-page="${currentPage + 1}" ${currentPage === totalPages ? 'disabled' : ''} aria-label="Halaman berikutnya">
                                <i class="fas fa-chevron-right"></i>
                             </button>`;

                    DOMElements.paginationControls.innerHTML = html;
                },
                apartmentDetail: () => {
                    const property = state.currentApartment;
                    if (!property || !DOMElements.apartmentTitle) return;

                    DOMElements.breadcrumbApartmentName.textContent = Utils.sanitizeHTML(property.title);
                    DOMElements.apartmentTitle.textContent = Utils.sanitizeHTML(property.title);
                    if (property.ownerVerified) {
                        const verifiedBadge = document.createElement('span');
                        verifiedBadge.className = 'badge-verified';
                        verifiedBadge.innerHTML = '<i class="fas fa-check-circle"></i> Terverifikasi';
                        verifiedBadge.title = 'Pemilik Terverifikasi';
                        DOMElements.apartmentTitle.appendChild(verifiedBadge);
                    }

                    DOMElements.apartmentLocationSubheader.innerHTML = `<i class="fas fa-map-marker-alt"></i> ${Utils.sanitizeHTML(property.location)}`;

                    const avgRating = property.reviews.length > 0 ? (property.reviews.reduce((acc, r) => acc + r.rating, 0) / property.reviews.length).toFixed(1) : 'Baru';
                    const reviewCount = property.reviews.length;
                    DOMElements.apartmentRatingSubheader.innerHTML = `<i class="fas fa-star text-warning"></i> ${avgRating} (${reviewCount} ulasan)`;

                    // Gallery
                    let galleryHTML = `<img src="${property.images[0]}" alt="Tampilan utama ${property.title}" class="gallery-main-image" loading="lazy">`;
                    property.images.slice(1, 5).forEach(imgUrl => { // Show up to 4 thumbnails
                        galleryHTML += `<img src="${imgUrl}" alt="Detail ${property.title}" loading="lazy">`;
                    });
                    DOMElements.apartmentGallery.innerHTML = galleryHTML;

                    DOMElements.apartmentDescription.innerHTML = Utils.sanitizeHTML(property.description).replace(/\n/g, '<br>');

                    const amenitiesMap = { pool: "Kolam Renang", gym: "Gym", wifi: "WiFi Cepat", parking: "Parkir", ac: "AC", kitchen: "Dapur", elevator: "Lift", balcony: "Balkon", tv: "TV Kabel" };
                    DOMElements.apartmentAmenitiesList.innerHTML = property.amenities.map(amenity =>
                        `<li class="d-flex items-center gap-2"><i class="fas fa-check text-success"></i> ${amenitiesMap[amenity] || amenity}</li>`
                    ).join('');

                    MapService.initMap('apartment-map-canvas', property.location, property.coordinates);
                    DOMElements.apartmentGmapsLink.href = `https://maps.google.com/?q=${property.coordinates.lat},${property.coordinates.lng}`;

                    Render.reviews(property.reviews);

                    DOMElements.apartmentPriceDisplay.textContent = Utils.formatCurrency(property.price);
                    DOMElements.apartmentIdBookingInput.value = property.id;

                    // Set min dates for booking form
                    const today = Utils.getTodayDate();
                    DOMElements.bookCheckinInput.min = today;
                    DOMElements.bookCheckoutInput.min = Utils.getDateAfterDays(1); // Checkout at least 1 day after today

                    // Pre-fill dates if passed from search
                    if (state.searchFilters.checkin) DOMElements.bookCheckinInput.value = state.searchFilters.checkin;
                    if (state.searchFilters.checkout) DOMElements.bookCheckoutInput.value = state.searchFilters.checkout;

                    Handlers.updateBookingCost(); // Initial cost calculation
                },
                reviews: (reviews, limit = 3) => {
                    DOMElements.reviewCountSpan.textContent = reviews.length;
                    if (reviews.length === 0) {
                        DOMElements.apartmentReviewsContainer.innerHTML = '<p class="text-muted">Belum ada ulasan untuk properti ini.</p>';
                        DOMElements.loadMoreReviewsButton.classList.add('hidden');
                        return;
                    }

                    const reviewsToShow = reviews.slice(0, limit);
                    DOMElements.apartmentReviewsContainer.innerHTML = reviewsToShow.map(review => `
                        <article class="mb-4 p-4 border rounded-md bg-surface">
                            <div class="d-flex justify-between items-center mb-2">
                                <h5 class="font-semibold text-md mb-0">${Utils.sanitizeHTML(review.user)}</h5>
                                <span class="text-xs text-muted">${Utils.formatDate(review.date)}</span>
                            </div>
                            <div class="mb-1">
                                ${Array(5).fill(0).map((_, i) => `<i class="fas fa-star ${i < review.rating ? 'text-warning' : 'text-muted'}"></i>`).join('')}
                            </div>
                            <p class="text-sm mb-0">${Utils.sanitizeHTML(review.comment)}</p>
                            <button class="btn btn-outline-primary btn-sm mt-2 report-review-btn" data-review-id="${review.id}" data-review-user="${Utils.sanitizeHTML(review.user)}">
                                <i class="fas fa-flag"></i> Laporkan
                            </button>
                        </article>
                    `).join('');

                    if (reviews.length > limit) {
                        DOMElements.loadMoreReviewsButton.classList.remove('hidden');
                        DOMElements.loadMoreReviewsButton.textContent = `Lihat Semua ${reviews.length} Ulasan`;
                    } else {
                        DOMElements.loadMoreReviewsButton.classList.add('hidden');
                    }
                },
                paymentMethods: () => {
                    const methods = [
                        { id: 'credit_card', name: 'Kartu Kredit/Debit', icon: 'fa-credit-card' },
                        { id: 'bank_transfer', name: 'Transfer Bank', icon: 'fa-university' },
                        { id: 'e_wallet', name: 'E-Wallet (OVO, GoPay)', icon: 'fa-wallet' }
                    ];
                    DOMElements.paymentMethodsContainer.innerHTML = methods.map((method, index) => `
                        <div class="payment-method ${index === 0 ? 'selected' : ''}" data-method="${method.id}" role="radio" aria-checked="${index === 0}" tabindex="0">
                            <i class="fas ${method.icon}"></i> ${method.name}
                        </div>
                    `).join('');
                },
                bookingHistory: () => {
                    if (state.bookingHistory.length === 0) {
                        DOMElements.bookingHistoryContainer.innerHTML = '<p class="text-muted">Anda belum memiliki riwayat pemesanan.</p>';
                        return;
                    }
                    DOMElements.bookingHistoryContainer.innerHTML = state.bookingHistory.map(booking => {
                        const property = state.properties.find(p => p.id === booking.propertyId);
                        return `
                        <article class="p-4 border rounded-md bg-surface d-flex gap-4 items-start">
                            <img src="${property?.images[0] || 'https://source.unsplash.com/random/100x100/?apartment'}" alt="${property?.title || 'Apartemen'}" class="rounded-md" style="width:100px; height:80px; object-fit:cover;">
                            <div>
                                <h4 class="text-md font-semibold mb-1">${property?.title || 'Nama Properti Tidak Ditemukan'}</h4>
                                <p class="text-xs text-muted mb-1">ID Pemesanan: ${booking.id}</p>
                                <p class="text-sm mb-1">Check-in: ${Utils.formatDate(booking.checkin)} | Check-out: ${Utils.formatDate(booking.checkout)}</p>
                                <p class="text-sm font-semibold">Total: ${Utils.formatCurrency(booking.totalAmount)}</p>
                                <span class="badge ${booking.status === 'confirmed' ? 'badge-success' : 'badge-warning'}">${booking.status === 'confirmed' ? 'Terkonfirmasi' : 'Pending'}</span>
                            </div>
                        </article>
                    `;
                    }).join('');
                },
                userProfile: () => {
                    DOMElements.userProfileName.textContent = state.userProfile.name;
                    DOMElements.userProfileEmail.textContent = state.userProfile.email;
                    DOMElements.userLoyaltyPoints.textContent = state.userProfile.loyaltyPoints.toLocaleString('id-ID');
                    Utils.$('img', DOMElements.userProfileName.closest('.form-section')).src = state.userProfile.avatar; // Assuming avatar img is sibling/parent context
                    // Update status badge dynamically if needed
                },
                chatMessage: (message, type, container) => {
                    const messageDiv = document.createElement('div');
                    messageDiv.classList.add('chat-message', type); // type: 'sent', 'received', or 'system'
                    messageDiv.textContent = Utils.sanitizeHTML(message);
                    container.appendChild(messageDiv);
                    container.scrollTop = container.scrollHeight; // Auto-scroll
                },
                faqItems: () => {
                    const faqs = [
                        { q: "Bagaimana cara mengubah atau membatalkan pemesanan?", a: "Untuk mengubah atau membatalkan pemesanan, silakan masuk ke halaman Profil Anda, pilih pemesanan yang ingin diubah/dibatalkan, dan ikuti instruksi yang ada. Perhatikan bahwa kebijakan pembatalan mungkin berlaku." },
                        { q: "Apakah harga yang tertera sudah termasuk pajak dan biaya layanan?", a: "Ya, harga yang ditampilkan biasanya sudah merupakan harga final. Rincian biaya akan ditampilkan sebelum Anda melakukan pembayaran." },
                        { q: "Bagaimana jika saya terlambat check-in?", a: "Kami sarankan untuk menghubungi pemilik properti atau layanan pelanggan Rentelindo jika Anda akan terlambat check-in. Beberapa properti mungkin memiliki batas waktu check-in." },
                        { q: "Metode pembayaran apa saja yang diterima?", a: "Kami menerima berbagai metode pembayaran termasuk Kartu Kredit/Debit, Transfer Bank Virtual Account, dan E-Wallet populer seperti GoPay dan OVO." }
                    ];
                    DOMElements.faqContainer.innerHTML = faqs.map(faq => `
                        <details class="faq-item p-1 border-bottom">
                            <summary class="font-semibold cursor-pointer p-3 rounded-md hover:bg-surface-dark d-flex justify-between items-center">
                                ${Utils.sanitizeHTML(faq.q)}
                                <i class="fas fa-chevron-down transition-transform"></i>
                            </summary>
                            <p class="p-3 text-sm text-muted">${Utils.sanitizeHTML(faq.a)}</p>
                        </details>
                    `).join('');
                    // Add event listener for accordion icon rotation
                    Utils.$$('.faq-item summary').forEach(summary => {
                        summary.addEventListener('click', () => {
                            const icon = summary.querySelector('i.fas');
                            const details = summary.closest('details');
                            if (details.hasAttribute('open')) { // This check is before the toggle happens
                                icon.style.transform = 'rotate(0deg)';
                            } else {
                                icon.style.transform = 'rotate(-180deg)';
                            }
                        });
                    });
                },
                theme: () => {
                    document.documentElement.setAttribute('data-theme', state.ui.theme);
                    DOMElements.themeToggleButton.innerHTML = state.ui.theme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
                    DOMElements.themeToggleButton.setAttribute('aria-label', state.ui.theme === 'dark' ? 'Ganti ke mode terang' : 'Ganti ke mode gelap');
                }
            };

            // ======= EVENT HANDLERS & LOGIC =======
            const Handlers = {
                navigate: (e) => {
                    if (e.target.matches('a[data-page]')) {
                        e.preventDefault();
                        const page = e.target.dataset.page;
                        AppLogic.switchPage(page);
                        // Close mobile menu if open
                        if (state.ui.isMobileMenuOpen) Handlers.toggleMobileMenu();
                    } else if (e.target.closest('.view-detail-btn')) {
                        e.preventDefault();
                        const propertyId = parseInt(e.target.closest('.view-detail-btn').dataset.id);
                        AppLogic.switchPage('apartment-detail', { id: propertyId });
                    }
                },
                handleHashChange: () => {
                    const hash = window.location.hash.substring(1);
                    const [page, paramString] = hash.split('/');
                    let params = {};
                    if (paramString) {
                        const [key, value] = paramString.split('=');
                        if (key && value) params[key] = value;
                    }

                    if (page && Utils.$$('section.page-section').find(s => s.id === page)) {
                        AppLogic.switchPage(page, params, true); // true to indicate it's from hash change
                    } else {
                        AppLogic.switchPage('home', {}, true); // Default to home
                    }
                },
                toggleMobileMenu: () => {
                    state.ui.isMobileMenuOpen = !state.ui.isMobileMenuOpen;
                    DOMElements.mainNavLinks.classList.toggle('open', state.ui.isMobileMenuOpen);
                    DOMElements.mobileMenuToggle.setAttribute('aria-expanded', state.ui.isMobileMenuOpen);
                    DOMElements.mobileMenuToggle.innerHTML = state.ui.isMobileMenuOpen ? '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
                },
                toggleTheme: () => {
                    state.ui.theme = state.ui.theme === 'light' ? 'dark' : 'light';
                    localStorage.setItem('theme', state.ui.theme);
                    Render.theme();
                },
                handleQuickSearch: (e) => {
                    e.preventDefault();
                    state.searchFilters.location = DOMElements.quickLocationInput.value.trim();
                    state.searchFilters.checkin = DOMElements.quickCheckinInput.value;
                    state.searchFilters.checkout = DOMElements.quickCheckoutInput.value;
                    state.searchFilters.currentPage = 1; // Reset to first page for new search
                    AppLogic.performSearch();
                    AppLogic.switchPage('search');
                },
                handleFilterChange: Utils.debounce(() => { // Debounce to avoid too many re-renders
                    state.searchFilters.location = DOMElements.filterLocationInput.value.trim();
                    state.searchFilters.priceMax = parseInt(DOMElements.filterPriceRangeInput.value);
                    state.searchFilters.amenities = Utils.$$('input[name="amenity"]:checked', DOMElements.filterAmenitiesContainer).map(cb => cb.value);
                    state.searchFilters.type = DOMElements.filterApartmentTypeSelect.value;
                    state.searchFilters.currentPage = 1; // Reset to first page on filter change
                    AppLogic.performSearch();
                }, 500),
                handleFilterFormSubmit: (e) => {
                    e.preventDefault();
                    Handlers.handleFilterChange(); // Call the debounced version or directly call performSearch
                },
                updatePriceRangeValue: () => {
                    DOMElements.priceRangeValueSpan.textContent = parseInt(DOMElements.filterPriceRangeInput.value).toLocaleString('id-ID');
                },
                handleSortChange: () => {
                    state.searchFilters.sortBy = DOMElements.sortBySelect.value;
                    AppLogic.performSearch(); // Re-sort and re-render
                },
                handlePagination: (e) => {
                    if (e.target.classList.contains('pagination-btn') || e.target.closest('.pagination-btn')) {
                        const button = e.target.closest('.pagination-btn');
                        if (button.disabled) return;
                        state.searchFilters.currentPage = parseInt(button.dataset.page);
                        Render.searchResults();
                        DOMElements.searchResultsGrid.scrollIntoView({ behavior: 'smooth' });
                    }
                },
                handleViewDetail: (e) => { // This is a general click listener on main content
                    const viewDetailButton = e.target.closest('.view-detail-btn');
                    if (viewDetailButton) {
                        e.preventDefault();
                        const propertyId = parseInt(viewDetailButton.dataset.id);
                        AppLogic.switchPage('apartment-detail', { id: propertyId });
                    }
                },
                updateBookingCost: () => {
                    const property = state.currentApartment;
                    if (!property || !DOMElements.bookCheckinInput) return;

                    const checkinDate = DOMElements.bookCheckinInput.value;
                    const checkoutDate = DOMElements.bookCheckoutInput.value;
                    const guests = parseInt(DOMElements.bookGuestsInput.value) || 1;
                    const addInsurance = DOMElements.bookInsuranceCheckbox.checked;

                    const numNights = Utils.daysBetween(checkinDate, checkoutDate);

                    if (numNights <= 0 && checkinDate && checkoutDate) {
                        DOMElements.costBreakdownSummary.classList.add('hidden');
                        // Optionally show an error message
                        return;
                    }

                    const baseCost = property.price * numNights * (property.priceType === 'bulan' ? 1 / 30 : 1); // Simplification for monthly price
                    const serviceFee = baseCost * 0.05; // 5% service fee
                    const insuranceCost = addInsurance ? baseCost * 0.1 : 0; // 10% for insurance
                    const totalCost = baseCost + serviceFee + insuranceCost;

                    DOMElements.baseCostValue.textContent = Utils.formatCurrency(baseCost);
                    DOMElements.serviceCostValue.textContent = Utils.formatCurrency(serviceFee);
                    if (addInsurance) {
                        DOMElements.insuranceCostValue.textContent = Utils.formatCurrency(insuranceCost);
                        DOMElements.insuranceCostLine.classList.remove('hidden');
                    } else {
                        DOMElements.insuranceCostLine.classList.add('hidden');
                    }
                    DOMElements.totalCostValue.textContent = Utils.formatCurrency(totalCost);
                    DOMElements.costBreakdownSummary.classList.remove('hidden');
                },
                handleBookingFormSubmit: async (e) => {
                    e.preventDefault();
                    const property = state.currentApartment;
                    if (!property) {
                        alert("Properti tidak ditemukan. Silakan coba lagi.");
                        return;
                    }

                    const checkin = DOMElements.bookCheckinInput.value;
                    const checkout = DOMElements.bookCheckoutInput.value;
                    const guests = parseInt(DOMElements.bookGuestsInput.value);
                    const selectedPaymentMethodDiv = Utils.$('.payment-method.selected', DOMElements.paymentMethodsContainer);

                    if (!checkin || !checkout || !guests) {
                        alert("Harap lengkapi semua field yang diperlukan (tanggal dan jumlah tamu).");
                        return;
                    }
                    if (!selectedPaymentMethodDiv) {
                        alert("Harap pilih metode pembayaran.");
                        return;
                    }
                    const paymentMethod = selectedPaymentMethodDiv.dataset.method;

                    const numNights = Utils.daysBetween(checkin, checkout);
                    if (numNights <= 0) {
                        alert("Tanggal check-out harus setelah tanggal check-in.");
                        return;
                    }
                    // Additional validation for availability (simplified)
                    const isDateBooked = property.bookedDates.some(bookedRange => {
                        const bookingStart = new Date(checkin);
                        const bookingEnd = new Date(checkout);
                        const bookedStart = new Date(bookedRange.start);
                        const bookedEnd = new Date(bookedRange.end);
                        // Check for overlap
                        return (bookingStart < bookedEnd && bookingEnd > bookedStart);
                    });

                    if (isDateBooked) {
                        alert("Maaf, tanggal yang Anda pilih sudah tidak tersedia atau tumpang tindih dengan pemesanan lain.");
                        return;
                    }


                    const totalCost = parseFloat(DOMElements.totalCostValue.textContent.replace(/[^0-9,-]+/g, "").replace(',', '.')); // Extract number

                    const submitButton = Utils.$('button[type="submit"]', DOMElements.bookingForm);
                    const originalButtonText = submitButton.innerHTML;
                    submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memproses...';
                    submitButton.disabled = true;

                    try {
                        const paymentResult = await PaymentService.processPayment(totalCost, paymentMethod);
                        if (paymentResult.success) {
                            // Add to booking history
                            const newBooking = {
                                id: 'BOOK-' + Utils.generateId().toUpperCase(),
                                propertyId: property.id,
                                checkin,
                                checkout,
                                guests,
                                totalAmount: totalCost,
                                paymentMethod,
                                transactionId: paymentResult.transactionId,
                                status: 'confirmed', // 'pending' if requires confirmation
                                bookingDate: new Date().toISOString()
                            };
                            state.bookingHistory.push(newBooking);
                            localStorage.setItem('rentelindoBookingHistory', JSON.stringify(state.bookingHistory));

                            // Mark dates as booked for this property (in-memory)
                            property.bookedDates.push({ start: checkin, end: checkout });

                            alert(`Pemesanan berhasil! ID Transaksi: ${paymentResult.transactionId}. Rincian pemesanan telah dikirim ke email Anda.`);
                            AppLogic.switchPage('profile'); // Navigate to profile to see booking history
                        } else {
                            alert(`Pembayaran gagal: ${paymentResult.message}`);
                        }
                    } catch (error) {
                        console.error("Error during booking:", error);
                        alert("Terjadi kesalahan saat memproses pemesanan. Silakan coba lagi.");
                    } finally {
                        submitButton.innerHTML = originalButtonText;
                        submitButton.disabled = false;
                    }
                },
                selectPaymentMethod: (e) => {
                    const targetMethod = e.target.closest('.payment-method');
                    if (targetMethod) {
                        Utils.$$('.payment-method', DOMElements.paymentMethodsContainer).forEach(m => {
                            m.classList.remove('selected');
                            m.setAttribute('aria-checked', 'false');
                        });
                        targetMethod.classList.add('selected');
                        targetMethod.setAttribute('aria-checked', 'true');
                    }
                },
                handleProfileChatSend: async () => {
                    const message = DOMElements.profileChatInput.value.trim();
                    if (!message) return;

                    Render.chatMessage(message, 'sent', DOMElements.profileChatMessages);
                    DOMElements.profileChatInput.value = '';
                    DOMElements.profileChatInput.focus();

                    const response = await ChatService.sendMessage(message, 'owner_property_X');
                    if (response.success) {
                        Render.chatMessage(response.reply, 'received', DOMElements.profileChatMessages);
                    }
                },
                toggleChatbox: () => {
                    state.ui.isChatboxOpen = !state.ui.isChatboxOpen;
                    DOMElements.floatingChatboxContainer.classList.toggle('open', state.ui.isChatboxOpen);
                    DOMElements.chatboxToggleButton.setAttribute('aria-expanded', state.ui.isChatboxOpen);
                    DOMElements.chatboxToggleButton.innerHTML = state.ui.isChatboxOpen ? '<i class="fas fa-times"></i>' : '<i class="fas fa-comments"></i>';
                    if (state.ui.isChatboxOpen) {
                        DOMElements.floatingChatInput.focus();
                    }
                },
                handleFloatingChatSend: async () => {
                    const message = DOMElements.floatingChatInput.value.trim();
                    if (!message) return;

                    Render.chatMessage(message, 'sent', DOMElements.floatingChatMessages);
                    DOMElements.floatingChatInput.value = '';
                    DOMElements.floatingChatInput.focus();

                    const response = await ChatService.sendMessage(message, 'support');
                    if (response.success) {
                        Render.chatMessage(response.reply, 'received', DOMElements.floatingChatMessages);
                    }
                },
                handleLoadMoreReviews: () => {
                    Render.reviews(state.currentApartment.reviews, state.currentApartment.reviews.length); // Show all
                    DOMElements.loadMoreReviewsButton.classList.add('hidden');
                },
                handleReportReviewClick: (e) => {
                    const reportButton = e.target.closest('.report-review-btn');
                    if (reportButton) {
                        const reviewId = reportButton.dataset.reviewId;
                        const reviewUser = reportButton.dataset.reviewUser;
                        DOMElements.reportReviewIdInput.value = reviewId;
                        DOMElements.reportReasonTextarea.placeholder = `Jelaskan mengapa ulasan dari ${reviewUser} ini tidak pantas...`;
                        DOMElements.reportReviewFormContainer.classList.remove('hidden');
                        DOMElements.reportReasonTextarea.focus();
                        // Scroll to form if needed
                        DOMElements.reportReviewFormContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                },
                handleCancelReportReview: () => {
                    DOMElements.reportReviewFormContainer.classList.add('hidden');
                    DOMElements.reportReviewForm.reset();
                },
                handleReportReviewSubmit: (e) => {
                    e.preventDefault();
                    const reviewId = DOMElements.reportReviewIdInput.value;
                    const reason = DOMElements.reportReasonTextarea.value.trim();
                    if (!reason) {
                        alert("Mohon masukkan alasan pelaporan.");
                        return;
                    }
                    // Simulate report submission
                    console.log(`Ulasan ID ${reviewId} dilaporkan. Alasan: ${reason}`);
                    alert("Laporan Anda telah dikirim. Terima kasih atas masukannya.");
                    Handlers.handleCancelReportReview();
                },
                handleLogout: () => {
                    if (confirm("Apakah Anda yakin ingin keluar?")) {
                        // Clear user-specific state (e.g., from localStorage if implementing real auth)
                        state.userProfile = { name: "Guest", email: "", loyaltyPoints: 0, isVerified: false, avatar: "https://source.unsplash.com/random/100x100/?avatar" };
                        state.bookingHistory = [];
                        localStorage.removeItem('rentelindoBookingHistory'); // if stored
                        // Potentially clear other sensitive data
                        alert("Anda telah berhasil keluar.");
                        AppLogic.switchPage('home');
                    }
                },
                handleEditProfile: () => {
                    // This would typically open a modal or navigate to an edit profile page.
                    // For this demo, we'll just simulate with a prompt.
                    const newName = prompt("Masukkan nama baru Anda:", state.userProfile.name);
                    if (newName && newName.trim() !== "") {
                        state.userProfile.name = newName.trim();
                        const newEmail = prompt("Masukkan email baru Anda:", state.userProfile.email);
                        if (newEmail && newEmail.trim() !== "" && newEmail.includes('@')) { // Basic email validation
                            state.userProfile.email = newEmail.trim();
                            Render.userProfile(); // Re-render the profile section
                            alert("Profil berhasil diperbarui.");
                        } else if (newEmail !== null) { // User didn't cancel email prompt
                            alert("Format email tidak valid. Perubahan email dibatalkan.");
                        }
                    } else if (newName !== null) { // User didn't cancel name prompt
                        alert("Nama tidak boleh kosong.");
                    }
                },

            };

            // ======= APPLICATION LOGIC & ROUTING =======
            const AppLogic = {
                init: () => {
                    console.log("Rentelindo App Initializing...");
                    // Load data
                    AppLogic.loadInitialData();
                    cacheDOMElements(); // Cache DOM elements after document is ready
                    Render.theme(); // Set initial theme

                    // Set default dates for quick search and booking forms
                    const today = Utils.getTodayDate();
                    const tomorrow = Utils.getDateAfterDays(1);
                    if (DOMElements.quickCheckinInput) DOMElements.quickCheckinInput.min = today;
                    if (DOMElements.quickCheckinInput) DOMElements.quickCheckinInput.value = today;
                    if (DOMElements.quickCheckoutInput) DOMElements.quickCheckoutInput.min = tomorrow;
                    if (DOMElements.quickCheckoutInput) DOMElements.quickCheckoutInput.value = tomorrow;


                    // Setup event listeners
                    AppLogic.setupEventListeners();

                    // Initial Page Load / Routing
                    Handlers.handleHashChange(); // Load page based on current hash or default

                    // Initial Renders for Home page (if it's the default)
                    if (state.currentPage === 'home') {
                        Render.featuredProperties();
                    }

                    DOMElements.currentYearSpan.textContent = new Date().getFullYear();
                    console.log("Rentelindo App Ready!");
                },
                loadInitialData: () => {
                    // In a real app, this would be an API call
                    // For now, use more detailed MOCK_PROPERTIES
                    state.properties = [
                        { id: 1, title: "Apartemen Sudirman Park View", location: "Jakarta Pusat", price: 750000, priceType: 'malam', bedrooms: 2, bathrooms: 1, maxGuests: 4, type: "2br", amenities: ["pool", "gym", "wifi", "parking", "ac", "kitchen"], images: ["https://images.unsplash.com/photo-1522708323590-d2400b670150?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8YXBhcnRtZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=60", "https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8YXBhcnRtZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=60", "https://images.unsplash.com/photo-1493809842364-78817add7ffb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTB8fGFwYXJ0bWVudCUyMGludGVyaW9yfGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=60"], description: "Apartemen modern di jantung kota Jakarta dengan pemandangan menakjubkan. Dilengkapi fasilitas lengkap untuk kenyamanan tinggal Anda, baik untuk bisnis maupun liburan.\nDekat dengan pusat perbelanjaan dan transportasi umum.", reviews: [{ id: 'r1', user: "Budi Santoso", rating: 5, comment: "Sangat memuaskan! Lokasi strategis, bersih, dan fasilitasnya top.", date: "2023-10-15" }, { id: 'r2', user: "Citra Lestari", rating: 4, comment: "Tempatnya nyaman, viewnya bagus. Hanya saja proses check-in agak lama.", date: "2023-11-01" }], coordinates: { lat: -6.2088, lng: 106.8456 }, ownerVerified: true, bookedDates: [{ start: '2024-08-10', end: '2024-08-12' }] },
                        { id: 2, title: "Studio Cozy Dago, Bandung", location: "Bandung Utara", price: 450000, priceType: 'malam', bedrooms: 0, bathrooms: 1, maxGuests: 2, type: "studio", amenities: ["wifi", "ac", "kitchen", "tv"], images: ["https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTJ8fGFwYXJ0bWVudHxlbnwwfHwwfHx8MA&auto=format&fit=crop&w=800&q=60", "https://images.unsplash.com/photo-1600585152915-d208bec867a1?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MjB8fGFwYXJ0bWVudCUyMGludGVyaW9yfGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=60"], description: "Studio minimalis yang nyaman di area Dago, Bandung. Cocok untuk pasangan atau solo traveler. Udara sejuk dan lingkungan tenang.", reviews: [{ id: 'r3', user: "Rina Amelia", rating: 4, comment: "Bersih dan sesuai foto. Host ramah.", date: "2023-09-20" }], coordinates: { lat: -6.8700, lng: 107.6098 }, ownerVerified: false, bookedDates: [] },
                        { id: 3, title: "Apartemen Keluarga Surabaya Timur", location: "Surabaya Timur", price: 9000000, priceType: 'bulan', bedrooms: 3, bathrooms: 2, maxGuests: 6, type: "3br", amenities: ["pool", "parking", "ac", "kitchen", "elevator"], images: ["https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTV8fGFwYXJ0bWVudHxlbnwwfHwwfHx8MA&auto=format&fit=crop&w=800&q=60", "https://images.unsplash.com/photo-1598928649000-281afe365858?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8YXBhcnRtZW50JTIwa2l0Y2hlbnxlbnwwfHwwfHx8MA&auto=format&fit=crop&w=800&q=60"], description: "Apartemen luas dengan 3 kamar tidur, ideal untuk keluarga. Fasilitas lengkap dan lokasi strategis dekat mal dan universitas.", reviews: [{ id: 'r4', user: "Keluarga Wijaya", rating: 5, comment: "Sangat cocok untuk liburan keluarga. Anak-anak suka kolam renangnya.", date: "2023-12-05" }], coordinates: { lat: -7.2575, lng: 112.7521 }, ownerVerified: true, bookedDates: [{ start: '2024-09-01', end: '2024-09-30' }] },
                        { id: 4, title: "Modern Loft Yogyakarta", location: "Yogyakarta Kota", price: 600000, priceType: 'malam', bedrooms: 1, bathrooms: 1, maxGuests: 3, type: "1br", amenities: ["wifi", "ac", "kitchen", "balcony"], images: ["https://images.unsplash.com/photo-1616046229478-9901c5536a45?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8YXBhcnRtZW50JTIwbG9mdHxlbnwwfHwwfHx8MA&auto=format&fit=crop&w=800&q=60", "https://images.unsplash.com/photo-1588794019333-8d7a5c005039?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTF8fGFwYXJ0bWVudCUyMGJhbGNvbnl8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=800&q=60"], description: "Loft stylish dengan desain industrial modern di pusat kota Yogyakarta. Nikmati suasana kota dari balkon pribadi Anda.", reviews: [{ id: 'r5', user: "Dewi Sartika", rating: 5, comment: "Desainnya keren banget! Instagrammable. Bersih dan nyaman.", date: "2024-01-10" }], coordinates: { lat: -7.7956, lng: 110.3695 }, ownerVerified: true, bookedDates: [] },
                        // Add more diverse properties
                        { id: 5, title: "Villa Pribadi Seminyak, Bali", location: "Seminyak, Bali", price: 2500000, priceType: 'malam', bedrooms: 2, bathrooms: 2, maxGuests: 4, type: "villa", amenities: ["pool", "wifi", "parking", "ac", "kitchen", "balcony"], images: ["https://images.unsplash.com/photo-1580034782100-d191d27178c6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8YmFsaSUyMHZpbGxhfGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=60", "https://images.unsplash.com/photo-1570129477492-45c003edd2be?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8cHJpdmF0ZSUyMHBvb2x8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=800&q=60"], description: "Villa mewah dengan kolam renang pribadi di area Seminyak yang trendi. Nikmati privasi dan kemewahan selama liburan Anda di Bali.", reviews: [{ id: 'r6', user: "Michael Chen", rating: 5, comment: "Absolutely stunning villa! The private pool was amazing.", date: "2024-02-20" }], coordinates: { lat: -8.6910, lng: 115.1668 }, ownerVerified: true, bookedDates: [{ start: '2024-07-15', end: '2024-07-20' }] },
                        { id: 6, title: "Apartemen Ekonomis Depok", location: "Depok, Jawa Barat", price: 3500000, priceType: 'bulan', bedrooms: 1, bathrooms: 1, maxGuests: 2, type: "1br", amenities: ["wifi", "ac", "parking"], images: ["https://images.unsplash.com/photo-1567016432779-176a1ca8ef25?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTd8fHNpbXBsZSUyMGFwYXJ0bWVudHxlbnwwfHwwfHx8MA&auto=format&fit=crop&w=800&q=60", "https://images.unsplash.com/photo-1526925539332-aa3b66e35444?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8YmVGUm9vbSUyMHdpdGglMjBkZXNrfGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=60"], description: "Pilihan ekonomis untuk mahasiswa atau karyawan di Depok. Dekat dengan kampus UI dan stasiun kereta.", reviews: [{ id: 'r7', user: "Andi Pratama", rating: 3, comment: "Cukup baik untuk harga segitu. Fasilitas standar.", date: "2024-01-05" }], coordinates: { lat: -6.4025, lng: 106.7942 }, ownerVerified: false, bookedDates: [] },
                    ];
                    state.featuredProperties = state.properties.filter(p => p.reviews.length > 0 && p.reviews.reduce((acc, r) => acc + r.rating, 0) / p.reviews.length >= 4.5); // Example: rating >= 4.5
                    state.searchResults = [...state.properties]; // Initially show all

                    // Load booking history from localStorage
                    const storedHistory = localStorage.getItem('rentelindoBookingHistory');
                    if (storedHistory) {
                        state.bookingHistory = JSON.parse(storedHistory);
                    }
                    // Load user profile (simplified)
                    const storedProfile = localStorage.getItem('rentelindoUserProfile');
                    if (storedProfile) {
                        state.userProfile = JSON.parse(storedProfile);
                    } else {
                        // Default user profile if nothing in local storage
                        state.userProfile = {
                            name: "Pengguna Rentelindo",
                            email: "pengguna@example.com",
                            loyaltyPoints: Math.floor(Math.random() * 2000), // Random points for demo
                            isVerified: Math.random() > 0.3, // 70% chance of being verified
                            avatar: `https://source.unsplash.com/random/100x100/?person,face&sig=${Math.random()}` // Random avatar
                        };
                        localStorage.setItem('rentelindoUserProfile', JSON.stringify(state.userProfile));
                    }

                },
                setupEventListeners: () => {
                    // Navigation
                    DOMElements.appHeader.addEventListener('click', Handlers.navigate);
                    window.addEventListener('hashchange', Handlers.handleHashChange);
                    DOMElements.mobileMenuToggle.addEventListener('click', Handlers.toggleMobileMenu);
                    DOMElements.themeToggleButton.addEventListener('click', Handlers.toggleTheme);

                    // Home Page
                    if (DOMElements.quickSearchForm) DOMElements.quickSearchForm.addEventListener('submit', Handlers.handleQuickSearch);

                    // Search Page
                    if (DOMElements.filterForm) DOMElements.filterForm.addEventListener('submit', Handlers.handleFilterFormSubmit);
                    if (DOMElements.filterPriceRangeInput) {
                        DOMElements.filterPriceRangeInput.addEventListener('input', Handlers.updatePriceRangeValue);
                        DOMElements.filterPriceRangeInput.addEventListener('change', Handlers.handleFilterChange); // Use change for final value
                    }
                    if (DOMElements.filterLocationInput) DOMElements.filterLocationInput.addEventListener('input', Handlers.handleFilterChange); // Live search for location
                    if (DOMElements.filterAmenitiesContainer) DOMElements.filterAmenitiesContainer.addEventListener('change', Handlers.handleFilterChange);
                    if (DOMElements.filterApartmentTypeSelect) DOMElements.filterApartmentTypeSelect.addEventListener('change', Handlers.handleFilterChange);
                    if (DOMElements.sortBySelect) DOMElements.sortBySelect.addEventListener('change', Handlers.handleSortChange);
                    if (DOMElements.paginationControls) DOMElements.paginationControls.addEventListener('click', Handlers.handlePagination);

                    // Apartment Detail Page Specific (listen on a parent that's always there)
                    DOMElements.appMainContent.addEventListener('click', Handlers.handleViewDetail); // For .view-detail-btn
                    if (DOMElements.bookingForm) {
                        DOMElements.bookingForm.addEventListener('submit', Handlers.handleBookingFormSubmit);
                        Utils.$$('input[type="date"], input[type="number"], input[type="checkbox"]', DOMElements.bookingForm)
                            .forEach(el => el.addEventListener('change', Handlers.updateBookingCost));
                    }
                    if (DOMElements.paymentMethodsContainer) DOMElements.paymentMethodsContainer.addEventListener('click', Handlers.selectPaymentMethod);
                    if (DOMElements.loadMoreReviewsButton) DOMElements.loadMoreReviewsButton.addEventListener('click', Handlers.handleLoadMoreReviews);
                    // Event delegation for report review buttons
                    if (DOMElements.apartmentReviewsContainer) DOMElements.apartmentReviewsContainer.addEventListener('click', Handlers.handleReportReviewClick);
                    if (DOMElements.reportReviewForm) DOMElements.reportReviewForm.addEventListener('submit', Handlers.handleReportReviewSubmit);
                    if (DOMElements.cancelReportReviewButton) DOMElements.cancelReportReviewButton.addEventListener('click', Handlers.handleCancelReportReview);


                    // Profile Page
                    if (DOMElements.profileSendChatButton) DOMElements.profileSendChatButton.addEventListener('click', Handlers.handleProfileChatSend);
                    if (DOMElements.profileChatInput) DOMElements.profileChatInput.addEventListener('keypress', (e) => e.key === 'Enter' && Handlers.handleProfileChatSend());
                    if (DOMElements.logoutButton) DOMElements.logoutButton.addEventListener('click', Handlers.handleLogout);
                    if (DOMElements.editProfileButton) DOMElements.editProfileButton.addEventListener('click', Handlers.handleEditProfile);


                    // Support Page
                    if (DOMElements.supportOpenChatButton) DOMElements.supportOpenChatButton.addEventListener('click', Handlers.toggleChatbox);

                    // Floating Chatbox
                    DOMElements.chatboxToggleButton.addEventListener('click', Handlers.toggleChatbox);
                    DOMElements.chatboxCloseButton.addEventListener('click', Handlers.toggleChatbox);
                    DOMElements.floatingSendChatButton.addEventListener('click', Handlers.handleFloatingChatSend);
                    DOMElements.floatingChatInput.addEventListener('keypress', (e) => e.key === 'Enter' && Handlers.handleFloatingChatSend());
                },
                switchPage: (pageId, params = {}, fromHashChange = false) => {
                    if (state.currentPage === pageId && Object.keys(params).length === 0 && !fromHashChange && pageId !== 'apartment-detail') { // Avoid re-rendering same page unless it's detail or forced
                        // If it's apartment detail, always re-evaluate params.id
                        if (pageId === 'apartment-detail' && params.id && (!state.currentApartment || state.currentApartment.id !== parseInt(params.id))) {
                            // Continue to load apartment detail
                        } else {
                            // return; // Already on this page
                        }
                    }

                    state.currentPage = pageId;
                    const targetPage = Utils.$(`#${pageId}`);

                    DOMElements.pageSections.forEach(section => section.classList.add('hidden'));
                    if (targetPage) {
                        targetPage.classList.remove('hidden');
                        document.title = `Rentelindo - ${pageId.charAt(0).toUpperCase() + pageId.slice(1).replace('-', ' ')}`;
                    } else {
                        Utils.$('#home').classList.remove('hidden'); // Fallback to home
                        state.currentPage = 'home';
                        document.title = 'Rentelindo - Beranda';
                    }

                    // Update active nav link
                    Utils.$$('.nav-item', DOMElements.mainNavLinks).forEach(link => {
                        link.classList.toggle('active', link.dataset.page === state.currentPage);
                    });

                    // Update URL hash if not triggered by hashchange itself
                    if (!fromHashChange) {
                        let hash = `#${pageId}`;
                        if (params.id) hash += `/id=${params.id}`; // Simple param for apartment ID
                        window.location.hash = hash;
                    }

                    // Scroll to top
                    window.scrollTo(0, 0);

                    // Page specific logic/render
                    switch (pageId) {
                        case 'home':
                            Render.featuredProperties();
                            break;
                        case 'search':
                            // Pre-fill filters if coming from quick search (already in state.searchFilters)
                            if (DOMElements.filterLocationInput) DOMElements.filterLocationInput.value = state.searchFilters.location;
                            // Potentially pre-fill date filters too
                            Render.searchResults();
                            break;
                        case 'apartment-detail':
                            if (params.id) {
                                state.currentApartment = state.properties.find(p => p.id === parseInt(params.id));
                                if (state.currentApartment) {
                                    Render.apartmentDetail();
                                    Render.paymentMethods(); // Render payment methods for booking form
                                } else {
                                    // Handle apartment not found - redirect or show error
                                    alert("Apartemen tidak ditemukan.");
                                    AppLogic.switchPage('search');
                                }
                            } else {
                                // Handle no ID provided - redirect or show error
                                AppLogic.switchPage('search');
                            }
                            break;
                        case 'profile':
                            Render.userProfile();
                            Render.bookingHistory();
                            break;
                        case 'support':
                            Render.faqItems();
                            break;
                    }
                },
                performSearch: () => {
                    const { location, priceMax, amenities, type, sortBy, checkin, checkout } = state.searchFilters;

                    let results = state.properties.filter(prop => {
                        const matchLocation = !location || prop.location.toLowerCase().includes(location.toLowerCase()) || prop.title.toLowerCase().includes(location.toLowerCase());
                        const matchPrice = prop.price <= priceMax;
                        const matchAmenities = amenities.length === 0 || amenities.every(am => prop.amenities.includes(am));
                        const matchType = !type || prop.type === type;

                        // Date availability check (simplified: assumes property.bookedDates is array of {start, end} objects)
                        let matchDates = true;
                        if (checkin && checkout) {
                            const searchStart = new Date(checkin);
                            const searchEnd = new Date(checkout);
                            if (searchStart >= searchEnd) { // Invalid date range from filter
                                matchDates = false;
                            } else {
                                matchDates = !prop.bookedDates.some(booked => {
                                    const bookedStart = new Date(booked.start);
                                    const bookedEnd = new Date(booked.end);
                                    // Check for overlap: (StartA < EndB) and (EndA > StartB)
                                    return searchStart < bookedEnd && searchEnd > bookedStart;
                                });
                            }
                        }
                        return matchLocation && matchPrice && matchAmenities && matchType && matchDates;
                    });

                    // Sorting
                    switch (sortBy) {
                        case 'price_asc':
                            results.sort((a, b) => a.price - b.price);
                            break;
                        case 'price_desc':
                            results.sort((a, b) => b.price - a.price);
                            break;
                        case 'rating_desc':
                            results.sort((a, b) => {
                                const ratingA = a.reviews.length > 0 ? a.reviews.reduce((acc, r) => acc + r.rating, 0) / a.reviews.length : 0;
                                const ratingB = b.reviews.length > 0 ? b.reviews.reduce((acc, r) => acc + r.rating, 0) / b.reviews.length : 0;
                                return ratingB - ratingA;
                            });
                            break;
                        case 'relevance': // Default, could be based on a more complex algorithm in real app
                        default:
                            // No specific sort, or could implement a basic relevance (e.g. featured first)
                            break;
                    }
                    state.searchResults = results;
                    Render.searchResults();
                }
            };

            // ======= PUBLIC API (Initialize App) =======
            return {
                init: AppLogic.init,
                // Expose state for debugging if needed:
                // getState: () => state 
            };
        })();

        // Initialize the app once the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', RentelindoApp.init);
    </script>
</body>

</html>